<html>
<head>
<title>fontBuilder.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #6a8759;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
fontBuilder.py</font>
</center></td></tr></table>
<pre><span class="s0">__all__ = [</span><span class="s1">&quot;FontBuilder&quot;</span><span class="s0">]</span>

<span class="s1">&quot;&quot;&quot; 
This module is *experimental*, meaning it still may evolve and change. 
 
The `FontBuilder` class is a convenient helper to construct working TTF or 
OTF fonts from scratch. 
 
Note that the various setup methods cannot be called in arbitrary order, 
due to various interdependencies between OpenType tables. Here is an order 
that works: 
 
    fb = FontBuilder(...) 
    fb.setupGlyphOrder(...) 
    fb.setupCharacterMap(...) 
    fb.setupGlyf(...) --or-- fb.setupCFF(...) 
    fb.setupHorizontalMetrics(...) 
    fb.setupHorizontalHeader() 
    fb.setupNameTable(...) 
    fb.setupOS2() 
    fb.addOpenTypeFeatures(...) 
    fb.setupPost() 
    fb.save(...) 
 
Here is how to build a minimal TTF: 
 
```python 
from fontTools.fontBuilder import FontBuilder 
from fontTools.pens.ttGlyphPen import TTGlyphPen 
 
 
def drawTestGlyph(pen): 
    pen.moveTo((100, 100)) 
    pen.lineTo((100, 1000)) 
    pen.qCurveTo((200, 900), (400, 900), (500, 1000)) 
    pen.lineTo((500, 100)) 
    pen.closePath() 
 
 
fb = FontBuilder(1024, isTTF=True) 
fb.setupGlyphOrder([&quot;.notdef&quot;, &quot;.null&quot;, &quot;space&quot;, &quot;A&quot;, &quot;a&quot;]) 
fb.setupCharacterMap({32: &quot;space&quot;, 65: &quot;A&quot;, 97: &quot;a&quot;}) 
advanceWidths = {&quot;.notdef&quot;: 600, &quot;space&quot;: 500, &quot;A&quot;: 600, &quot;a&quot;: 600, &quot;.null&quot;: 0} 
 
familyName = &quot;HelloTestFont&quot; 
styleName = &quot;TotallyNormal&quot; 
version = &quot;0.1&quot; 
 
nameStrings = dict( 
    familyName=dict(en=familyName, nl=&quot;HalloTestFont&quot;), 
    styleName=dict(en=styleName, nl=&quot;TotaalNormaal&quot;), 
    uniqueFontIdentifier=&quot;fontBuilder: &quot; + familyName + &quot;.&quot; + styleName, 
    fullName=familyName + &quot;-&quot; + styleName, 
    psName=familyName + &quot;-&quot; + styleName, 
    version=&quot;Version &quot; + version, 
) 
 
pen = TTGlyphPen(None) 
drawTestGlyph(pen) 
glyph = pen.glyph() 
glyphs = {&quot;.notdef&quot;: glyph, &quot;space&quot;: glyph, &quot;A&quot;: glyph, &quot;a&quot;: glyph, &quot;.null&quot;: glyph} 
fb.setupGlyf(glyphs) 
metrics = {} 
glyphTable = fb.font[&quot;glyf&quot;] 
for gn, advanceWidth in advanceWidths.items(): 
    metrics[gn] = (advanceWidth, glyphTable[gn].xMin) 
fb.setupHorizontalMetrics(metrics) 
fb.setupHorizontalHeader(ascent=824, descent=-200) 
fb.setupNameTable(nameStrings) 
fb.setupOS2(sTypoAscender=824, usWinAscent=824, usWinDescent=200) 
fb.setupPost() 
fb.save(&quot;test.ttf&quot;) 
``` 
 
And here's how to build a minimal OTF: 
 
```python 
from fontTools.fontBuilder import FontBuilder 
from fontTools.pens.t2CharStringPen import T2CharStringPen 
 
 
def drawTestGlyph(pen): 
    pen.moveTo((100, 100)) 
    pen.lineTo((100, 1000)) 
    pen.curveTo((200, 900), (400, 900), (500, 1000)) 
    pen.lineTo((500, 100)) 
    pen.closePath() 
 
 
fb = FontBuilder(1024, isTTF=False) 
fb.setupGlyphOrder([&quot;.notdef&quot;, &quot;.null&quot;, &quot;space&quot;, &quot;A&quot;, &quot;a&quot;]) 
fb.setupCharacterMap({32: &quot;space&quot;, 65: &quot;A&quot;, 97: &quot;a&quot;}) 
advanceWidths = {&quot;.notdef&quot;: 600, &quot;space&quot;: 500, &quot;A&quot;: 600, &quot;a&quot;: 600, &quot;.null&quot;: 0} 
 
familyName = &quot;HelloTestFont&quot; 
styleName = &quot;TotallyNormal&quot; 
version = &quot;0.1&quot; 
 
nameStrings = dict( 
    familyName=dict(en=familyName, nl=&quot;HalloTestFont&quot;), 
    styleName=dict(en=styleName, nl=&quot;TotaalNormaal&quot;), 
    uniqueFontIdentifier=&quot;fontBuilder: &quot; + familyName + &quot;.&quot; + styleName, 
    fullName=familyName + &quot;-&quot; + styleName, 
    psName=familyName + &quot;-&quot; + styleName, 
    version=&quot;Version &quot; + version, 
) 
 
pen = T2CharStringPen(600, None) 
drawTestGlyph(pen) 
charString = pen.getCharString() 
charStrings = { 
    &quot;.notdef&quot;: charString, 
    &quot;space&quot;: charString, 
    &quot;A&quot;: charString, 
    &quot;a&quot;: charString, 
    &quot;.null&quot;: charString, 
} 
fb.setupCFF(nameStrings[&quot;psName&quot;], {&quot;FullName&quot;: nameStrings[&quot;psName&quot;]}, charStrings, {}) 
lsb = {gn: cs.calcBounds(None)[0] for gn, cs in charStrings.items()} 
metrics = {} 
for gn, advanceWidth in advanceWidths.items(): 
    metrics[gn] = (advanceWidth, lsb[gn]) 
fb.setupHorizontalMetrics(metrics) 
fb.setupHorizontalHeader(ascent=824, descent=200) 
fb.setupNameTable(nameStrings) 
fb.setupOS2(sTypoAscender=824, usWinAscent=824, usWinDescent=200) 
fb.setupPost() 
fb.save(&quot;test.otf&quot;) 
``` 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s0">.ttLib </span><span class="s2">import </span><span class="s0">TTFont</span><span class="s2">, </span><span class="s0">newTable</span>
<span class="s2">from </span><span class="s0">.ttLib.tables._c_m_a_p </span><span class="s2">import </span><span class="s0">cmap_classes</span>
<span class="s2">from </span><span class="s0">.misc.timeTools </span><span class="s2">import </span><span class="s0">timestampNow</span>
<span class="s2">import </span><span class="s0">struct</span>
<span class="s2">from </span><span class="s0">collections </span><span class="s2">import </span><span class="s0">OrderedDict</span>


<span class="s0">_headDefaults = dict(</span>
    <span class="s0">tableVersion=</span><span class="s3">1.0</span><span class="s2">,</span>
    <span class="s0">fontRevision=</span><span class="s3">1.0</span><span class="s2">,</span>
    <span class="s0">checkSumAdjustment=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">magicNumber=</span><span class="s3">0x5F0F3CF5</span><span class="s2">,</span>
    <span class="s0">flags=</span><span class="s3">0x0003</span><span class="s2">,</span>
    <span class="s0">unitsPerEm=</span><span class="s3">1000</span><span class="s2">,</span>
    <span class="s0">created=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">modified=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">xMin=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">yMin=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">xMax=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">yMax=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">macStyle=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">lowestRecPPEM=</span><span class="s3">3</span><span class="s2">,</span>
    <span class="s0">fontDirectionHint=</span><span class="s3">2</span><span class="s2">,</span>
    <span class="s0">indexToLocFormat=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">glyphDataFormat=</span><span class="s3">0</span><span class="s2">,</span>
<span class="s0">)</span>

<span class="s0">_maxpDefaultsTTF = dict(</span>
    <span class="s0">tableVersion=</span><span class="s3">0x00010000</span><span class="s2">,</span>
    <span class="s0">numGlyphs=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxPoints=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxContours=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxCompositePoints=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxCompositeContours=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxZones=</span><span class="s3">2</span><span class="s2">,</span>
    <span class="s0">maxTwilightPoints=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxStorage=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxFunctionDefs=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxInstructionDefs=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxStackElements=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxSizeOfInstructions=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxComponentElements=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxComponentDepth=</span><span class="s3">0</span><span class="s2">,</span>
<span class="s0">)</span>
<span class="s0">_maxpDefaultsOTF = dict(</span>
    <span class="s0">tableVersion=</span><span class="s3">0x00005000</span><span class="s2">,</span>
    <span class="s0">numGlyphs=</span><span class="s3">0</span><span class="s2">,</span>
<span class="s0">)</span>

<span class="s0">_postDefaults = dict(</span>
    <span class="s0">formatType=</span><span class="s3">3.0</span><span class="s2">,</span>
    <span class="s0">italicAngle=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">underlinePosition=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">underlineThickness=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">isFixedPitch=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">minMemType42=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxMemType42=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">minMemType1=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">maxMemType1=</span><span class="s3">0</span><span class="s2">,</span>
<span class="s0">)</span>

<span class="s0">_hheaDefaults = dict(</span>
    <span class="s0">tableVersion=</span><span class="s3">0x00010000</span><span class="s2">,</span>
    <span class="s0">ascent=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">descent=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">lineGap=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">advanceWidthMax=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">minLeftSideBearing=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">minRightSideBearing=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">xMaxExtent=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">caretSlopeRise=</span><span class="s3">1</span><span class="s2">,</span>
    <span class="s0">caretSlopeRun=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">caretOffset=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved0=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved1=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved2=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved3=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">metricDataFormat=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">numberOfHMetrics=</span><span class="s3">0</span><span class="s2">,</span>
<span class="s0">)</span>

<span class="s0">_vheaDefaults = dict(</span>
    <span class="s0">tableVersion=</span><span class="s3">0x00010000</span><span class="s2">,</span>
    <span class="s0">ascent=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">descent=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">lineGap=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">advanceHeightMax=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">minTopSideBearing=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">minBottomSideBearing=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">yMaxExtent=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">caretSlopeRise=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">caretSlopeRun=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved0=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved1=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved2=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved3=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">reserved4=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">metricDataFormat=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">numberOfVMetrics=</span><span class="s3">0</span><span class="s2">,</span>
<span class="s0">)</span>

<span class="s0">_nameIDs = dict(</span>
    <span class="s0">copyright=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">familyName=</span><span class="s3">1</span><span class="s2">,</span>
    <span class="s0">styleName=</span><span class="s3">2</span><span class="s2">,</span>
    <span class="s0">uniqueFontIdentifier=</span><span class="s3">3</span><span class="s2">,</span>
    <span class="s0">fullName=</span><span class="s3">4</span><span class="s2">,</span>
    <span class="s0">version=</span><span class="s3">5</span><span class="s2">,</span>
    <span class="s0">psName=</span><span class="s3">6</span><span class="s2">,</span>
    <span class="s0">trademark=</span><span class="s3">7</span><span class="s2">,</span>
    <span class="s0">manufacturer=</span><span class="s3">8</span><span class="s2">,</span>
    <span class="s0">designer=</span><span class="s3">9</span><span class="s2">,</span>
    <span class="s0">description=</span><span class="s3">10</span><span class="s2">,</span>
    <span class="s0">vendorURL=</span><span class="s3">11</span><span class="s2">,</span>
    <span class="s0">designerURL=</span><span class="s3">12</span><span class="s2">,</span>
    <span class="s0">licenseDescription=</span><span class="s3">13</span><span class="s2">,</span>
    <span class="s0">licenseInfoURL=</span><span class="s3">14</span><span class="s2">,</span>
    <span class="s4"># reserved = 15,</span>
    <span class="s0">typographicFamily=</span><span class="s3">16</span><span class="s2">,</span>
    <span class="s0">typographicSubfamily=</span><span class="s3">17</span><span class="s2">,</span>
    <span class="s0">compatibleFullName=</span><span class="s3">18</span><span class="s2">,</span>
    <span class="s0">sampleText=</span><span class="s3">19</span><span class="s2">,</span>
    <span class="s0">postScriptCIDFindfontName=</span><span class="s3">20</span><span class="s2">,</span>
    <span class="s0">wwsFamilyName=</span><span class="s3">21</span><span class="s2">,</span>
    <span class="s0">wwsSubfamilyName=</span><span class="s3">22</span><span class="s2">,</span>
    <span class="s0">lightBackgroundPalette=</span><span class="s3">23</span><span class="s2">,</span>
    <span class="s0">darkBackgroundPalette=</span><span class="s3">24</span><span class="s2">,</span>
    <span class="s0">variationsPostScriptNamePrefix=</span><span class="s3">25</span><span class="s2">,</span>
<span class="s0">)</span>

<span class="s4"># to insert in setupNameTable doc string:</span>
<span class="s4"># print(&quot;\n&quot;.join((&quot;%s (nameID %s)&quot; % (k, v)) for k, v in sorted(_nameIDs.items(), key=lambda x: x[1])))</span>

<span class="s0">_panoseDefaults = dict(</span>
    <span class="s0">bFamilyType=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bSerifStyle=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bWeight=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bProportion=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bContrast=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bStrokeVariation=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bArmStyle=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bLetterForm=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bMidline=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">bXHeight=</span><span class="s3">0</span><span class="s2">,</span>
<span class="s0">)</span>

<span class="s0">_OS2Defaults = dict(</span>
    <span class="s0">version=</span><span class="s3">3</span><span class="s2">,</span>
    <span class="s0">xAvgCharWidth=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">usWeightClass=</span><span class="s3">400</span><span class="s2">,</span>
    <span class="s0">usWidthClass=</span><span class="s3">5</span><span class="s2">,</span>
    <span class="s0">fsType=</span><span class="s3">0x0004</span><span class="s2">,  </span><span class="s4"># default: Preview &amp; Print embedding</span>
    <span class="s0">ySubscriptXSize=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ySubscriptYSize=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ySubscriptXOffset=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ySubscriptYOffset=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ySuperscriptXSize=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ySuperscriptYSize=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ySuperscriptXOffset=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ySuperscriptYOffset=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">yStrikeoutSize=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">yStrikeoutPosition=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">sFamilyClass=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">panose=_panoseDefaults</span><span class="s2">,</span>
    <span class="s0">ulUnicodeRange1=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ulUnicodeRange2=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ulUnicodeRange3=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ulUnicodeRange4=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">achVendID=</span><span class="s1">&quot;????&quot;</span><span class="s2">,</span>
    <span class="s0">fsSelection=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">usFirstCharIndex=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">usLastCharIndex=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">sTypoAscender=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">sTypoDescender=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">sTypoLineGap=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">usWinAscent=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">usWinDescent=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ulCodePageRange1=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">ulCodePageRange2=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">sxHeight=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">sCapHeight=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">usDefaultChar=</span><span class="s3">0</span><span class="s2">,  </span><span class="s4"># .notdef</span>
    <span class="s0">usBreakChar=</span><span class="s3">32</span><span class="s2">,  </span><span class="s4"># space</span>
    <span class="s0">usMaxContext=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">usLowerOpticalPointSize=</span><span class="s3">0</span><span class="s2">,</span>
    <span class="s0">usUpperOpticalPointSize=</span><span class="s3">0</span><span class="s2">,</span>
<span class="s0">)</span>


<span class="s2">class </span><span class="s0">FontBuilder(object):</span>
    <span class="s2">def </span><span class="s0">__init__(self</span><span class="s2">, </span><span class="s0">unitsPerEm=</span><span class="s2">None, </span><span class="s0">font=</span><span class="s2">None, </span><span class="s0">isTTF=</span><span class="s2">True</span><span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Initialize a FontBuilder instance. 
 
        If the `font` argument is not given, a new `TTFont` will be 
        constructed, and `unitsPerEm` must be given. If `isTTF` is True, 
        the font will be a glyf-based TTF; if `isTTF` is False it will be 
        a CFF-based OTF. 
 
        If `font` is given, it must be a `TTFont` instance and `unitsPerEm` 
        must _not_ be given. The `isTTF` argument will be ignored. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s0">font </span><span class="s2">is None</span><span class="s0">:</span>
            <span class="s0">self.font = TTFont(recalcTimestamp=</span><span class="s2">False</span><span class="s0">)</span>
            <span class="s0">self.isTTF = isTTF</span>
            <span class="s0">now = timestampNow()</span>
            <span class="s2">assert </span><span class="s0">unitsPerEm </span><span class="s2">is not None</span>
            <span class="s0">self.setupHead(unitsPerEm=unitsPerEm</span><span class="s2">, </span><span class="s0">created=now</span><span class="s2">, </span><span class="s0">modified=now)</span>
            <span class="s0">self.setupMaxp()</span>
        <span class="s2">else</span><span class="s0">:</span>
            <span class="s2">assert </span><span class="s0">unitsPerEm </span><span class="s2">is None</span>
            <span class="s0">self.font = font</span>
            <span class="s0">self.isTTF = </span><span class="s1">&quot;glyf&quot; </span><span class="s2">in </span><span class="s0">font</span>

    <span class="s2">def </span><span class="s0">save(self</span><span class="s2">, </span><span class="s0">file):</span>
        <span class="s5">&quot;&quot;&quot;Save the font. The 'file' argument can be either a pathname or a 
        writable file object. 
        &quot;&quot;&quot;</span>
        <span class="s0">self.font.save(file)</span>

    <span class="s2">def </span><span class="s0">_initTableWithValues(self</span><span class="s2">, </span><span class="s0">tableTag</span><span class="s2">, </span><span class="s0">defaults</span><span class="s2">, </span><span class="s0">values):</span>
        <span class="s0">table = self.font[tableTag] = newTable(tableTag)</span>
        <span class="s2">for </span><span class="s0">k</span><span class="s2">, </span><span class="s0">v </span><span class="s2">in </span><span class="s0">defaults.items():</span>
            <span class="s0">setattr(table</span><span class="s2">, </span><span class="s0">k</span><span class="s2">, </span><span class="s0">v)</span>
        <span class="s2">for </span><span class="s0">k</span><span class="s2">, </span><span class="s0">v </span><span class="s2">in </span><span class="s0">values.items():</span>
            <span class="s0">setattr(table</span><span class="s2">, </span><span class="s0">k</span><span class="s2">, </span><span class="s0">v)</span>
        <span class="s2">return </span><span class="s0">table</span>

    <span class="s2">def </span><span class="s0">_updateTableWithValues(self</span><span class="s2">, </span><span class="s0">tableTag</span><span class="s2">, </span><span class="s0">values):</span>
        <span class="s0">table = self.font[tableTag]</span>
        <span class="s2">for </span><span class="s0">k</span><span class="s2">, </span><span class="s0">v </span><span class="s2">in </span><span class="s0">values.items():</span>
            <span class="s0">setattr(table</span><span class="s2">, </span><span class="s0">k</span><span class="s2">, </span><span class="s0">v)</span>

    <span class="s2">def </span><span class="s0">setupHead(self</span><span class="s2">, </span><span class="s0">**values):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `head` table and initialize it with default values, 
        which can be overridden by keyword arguments. 
        &quot;&quot;&quot;</span>
        <span class="s0">self._initTableWithValues(</span><span class="s1">&quot;head&quot;</span><span class="s2">, </span><span class="s0">_headDefaults</span><span class="s2">, </span><span class="s0">values)</span>

    <span class="s2">def </span><span class="s0">updateHead(self</span><span class="s2">, </span><span class="s0">**values):</span>
        <span class="s5">&quot;&quot;&quot;Update the head table with the fields and values passed as 
        keyword arguments. 
        &quot;&quot;&quot;</span>
        <span class="s0">self._updateTableWithValues(</span><span class="s1">&quot;head&quot;</span><span class="s2">, </span><span class="s0">values)</span>

    <span class="s2">def </span><span class="s0">setupGlyphOrder(self</span><span class="s2">, </span><span class="s0">glyphOrder):</span>
        <span class="s5">&quot;&quot;&quot;Set the glyph order for the font.&quot;&quot;&quot;</span>
        <span class="s0">self.font.setGlyphOrder(glyphOrder)</span>

    <span class="s2">def </span><span class="s0">setupCharacterMap(self</span><span class="s2">, </span><span class="s0">cmapping</span><span class="s2">, </span><span class="s0">uvs=</span><span class="s2">None, </span><span class="s0">allowFallback=</span><span class="s2">False</span><span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Build the `cmap` table for the font. The `cmapping` argument should 
        be a dict mapping unicode code points as integers to glyph names. 
 
        The `uvs` argument, when passed, must be a list of tuples, describing 
        Unicode Variation Sequences. These tuples have three elements: 
            (unicodeValue, variationSelector, glyphName) 
        `unicodeValue` and `variationSelector` are integer code points. 
        `glyphName` may be None, to indicate this is the default variation. 
        Text processors will then use the cmap to find the glyph name. 
        Each Unicode Variation Sequence should be an officially supported 
        sequence, but this is not policed. 
        &quot;&quot;&quot;</span>
        <span class="s0">subTables = []</span>
        <span class="s0">highestUnicode = max(cmapping) </span><span class="s2">if </span><span class="s0">cmapping </span><span class="s2">else </span><span class="s3">0</span>
        <span class="s2">if </span><span class="s0">highestUnicode &gt; </span><span class="s3">0xFFFF</span><span class="s0">:</span>
            <span class="s0">cmapping_3_1 = dict((k</span><span class="s2">, </span><span class="s0">v) </span><span class="s2">for </span><span class="s0">k</span><span class="s2">, </span><span class="s0">v </span><span class="s2">in </span><span class="s0">cmapping.items() </span><span class="s2">if </span><span class="s0">k &lt; </span><span class="s3">0x10000</span><span class="s0">)</span>
            <span class="s0">subTable_3_10 = buildCmapSubTable(cmapping</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">10</span><span class="s0">)</span>
            <span class="s0">subTables.append(subTable_3_10)</span>
        <span class="s2">else</span><span class="s0">:</span>
            <span class="s0">cmapping_3_1 = cmapping</span>
        <span class="s0">format = </span><span class="s3">4</span>
        <span class="s0">subTable_3_1 = buildCmapSubTable(cmapping_3_1</span><span class="s2">, </span><span class="s0">format</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s0">)</span>
        <span class="s2">try</span><span class="s0">:</span>
            <span class="s0">subTable_3_1.compile(self.font)</span>
        <span class="s2">except </span><span class="s0">struct.error:</span>
            <span class="s4"># format 4 overflowed, fall back to format 12</span>
            <span class="s2">if not </span><span class="s0">allowFallback:</span>
                <span class="s2">raise </span><span class="s0">ValueError(</span>
                    <span class="s1">&quot;cmap format 4 subtable overflowed; sort glyph order by unicode to fix.&quot;</span>
                <span class="s0">)</span>
            <span class="s0">format = </span><span class="s3">12</span>
            <span class="s0">subTable_3_1 = buildCmapSubTable(cmapping_3_1</span><span class="s2">, </span><span class="s0">format</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s0">)</span>
        <span class="s0">subTables.append(subTable_3_1)</span>
        <span class="s0">subTable_0_3 = buildCmapSubTable(cmapping_3_1</span><span class="s2">, </span><span class="s0">format</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">3</span><span class="s0">)</span>
        <span class="s0">subTables.append(subTable_0_3)</span>

        <span class="s2">if </span><span class="s0">uvs </span><span class="s2">is not None</span><span class="s0">:</span>
            <span class="s0">uvsDict = {}</span>
            <span class="s2">for </span><span class="s0">unicodeValue</span><span class="s2">, </span><span class="s0">variationSelector</span><span class="s2">, </span><span class="s0">glyphName </span><span class="s2">in </span><span class="s0">uvs:</span>
                <span class="s2">if </span><span class="s0">cmapping.get(unicodeValue) == glyphName:</span>
                    <span class="s4"># this is a default variation</span>
                    <span class="s0">glyphName = </span><span class="s2">None</span>
                <span class="s2">if </span><span class="s0">variationSelector </span><span class="s2">not in </span><span class="s0">uvsDict:</span>
                    <span class="s0">uvsDict[variationSelector] = []</span>
                <span class="s0">uvsDict[variationSelector].append((unicodeValue</span><span class="s2">, </span><span class="s0">glyphName))</span>
            <span class="s0">uvsSubTable = buildCmapSubTable({}</span><span class="s2">, </span><span class="s3">14</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">5</span><span class="s0">)</span>
            <span class="s0">uvsSubTable.uvsDict = uvsDict</span>
            <span class="s0">subTables.append(uvsSubTable)</span>

        <span class="s0">self.font[</span><span class="s1">&quot;cmap&quot;</span><span class="s0">] = newTable(</span><span class="s1">&quot;cmap&quot;</span><span class="s0">)</span>
        <span class="s0">self.font[</span><span class="s1">&quot;cmap&quot;</span><span class="s0">].tableVersion = </span><span class="s3">0</span>
        <span class="s0">self.font[</span><span class="s1">&quot;cmap&quot;</span><span class="s0">].tables = subTables</span>

    <span class="s2">def </span><span class="s0">setupNameTable(self</span><span class="s2">, </span><span class="s0">nameStrings</span><span class="s2">, </span><span class="s0">windows=</span><span class="s2">True, </span><span class="s0">mac=</span><span class="s2">True</span><span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Create the `name` table for the font. The `nameStrings` argument must 
        be a dict, mapping nameIDs or descriptive names for the nameIDs to name 
        record values. A value is either a string, or a dict, mapping language codes 
        to strings, to allow localized name table entries. 
 
        By default, both Windows (platformID=3) and Macintosh (platformID=1) name 
        records are added, unless any of `windows` or `mac` arguments is False. 
 
        The following descriptive names are available for nameIDs: 
 
            copyright (nameID 0) 
            familyName (nameID 1) 
            styleName (nameID 2) 
            uniqueFontIdentifier (nameID 3) 
            fullName (nameID 4) 
            version (nameID 5) 
            psName (nameID 6) 
            trademark (nameID 7) 
            manufacturer (nameID 8) 
            designer (nameID 9) 
            description (nameID 10) 
            vendorURL (nameID 11) 
            designerURL (nameID 12) 
            licenseDescription (nameID 13) 
            licenseInfoURL (nameID 14) 
            typographicFamily (nameID 16) 
            typographicSubfamily (nameID 17) 
            compatibleFullName (nameID 18) 
            sampleText (nameID 19) 
            postScriptCIDFindfontName (nameID 20) 
            wwsFamilyName (nameID 21) 
            wwsSubfamilyName (nameID 22) 
            lightBackgroundPalette (nameID 23) 
            darkBackgroundPalette (nameID 24) 
            variationsPostScriptNamePrefix (nameID 25) 
        &quot;&quot;&quot;</span>
        <span class="s0">nameTable = self.font[</span><span class="s1">&quot;name&quot;</span><span class="s0">] = newTable(</span><span class="s1">&quot;name&quot;</span><span class="s0">)</span>
        <span class="s0">nameTable.names = []</span>

        <span class="s2">for </span><span class="s0">nameName</span><span class="s2">, </span><span class="s0">nameValue </span><span class="s2">in </span><span class="s0">nameStrings.items():</span>
            <span class="s2">if </span><span class="s0">isinstance(nameName</span><span class="s2">, </span><span class="s0">int):</span>
                <span class="s0">nameID = nameName</span>
            <span class="s2">else</span><span class="s0">:</span>
                <span class="s0">nameID = _nameIDs[nameName]</span>
            <span class="s2">if </span><span class="s0">isinstance(nameValue</span><span class="s2">, </span><span class="s0">str):</span>
                <span class="s0">nameValue = dict(en=nameValue)</span>
            <span class="s0">nameTable.addMultilingualName(</span>
                <span class="s0">nameValue</span><span class="s2">, </span><span class="s0">ttFont=self.font</span><span class="s2">, </span><span class="s0">nameID=nameID</span><span class="s2">, </span><span class="s0">windows=windows</span><span class="s2">, </span><span class="s0">mac=mac</span>
            <span class="s0">)</span>

    <span class="s2">def </span><span class="s0">setupOS2(self</span><span class="s2">, </span><span class="s0">**values):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `OS/2` table and initialize it with default values, 
        which can be overridden by keyword arguments. 
        &quot;&quot;&quot;</span>
        <span class="s0">self._initTableWithValues(</span><span class="s1">&quot;OS/2&quot;</span><span class="s2">, </span><span class="s0">_OS2Defaults</span><span class="s2">, </span><span class="s0">values)</span>
        <span class="s2">if </span><span class="s1">&quot;xAvgCharWidth&quot; </span><span class="s2">not in </span><span class="s0">values:</span>
            <span class="s2">assert </span><span class="s0">(</span>
                <span class="s1">&quot;hmtx&quot; </span><span class="s2">in </span><span class="s0">self.font</span>
            <span class="s0">)</span><span class="s2">, </span><span class="s1">&quot;the 'hmtx' table must be setup before the 'OS/2' table&quot;</span>
            <span class="s0">self.font[</span><span class="s1">&quot;OS/2&quot;</span><span class="s0">].recalcAvgCharWidth(self.font)</span>
        <span class="s2">if not </span><span class="s0">(</span>
            <span class="s1">&quot;ulUnicodeRange1&quot; </span><span class="s2">in </span><span class="s0">values</span>
            <span class="s2">or </span><span class="s1">&quot;ulUnicodeRange2&quot; </span><span class="s2">in </span><span class="s0">values</span>
            <span class="s2">or </span><span class="s1">&quot;ulUnicodeRange3&quot; </span><span class="s2">in </span><span class="s0">values</span>
            <span class="s2">or </span><span class="s1">&quot;ulUnicodeRange3&quot; </span><span class="s2">in </span><span class="s0">values</span>
        <span class="s0">):</span>
            <span class="s2">assert </span><span class="s0">(</span>
                <span class="s1">&quot;cmap&quot; </span><span class="s2">in </span><span class="s0">self.font</span>
            <span class="s0">)</span><span class="s2">, </span><span class="s1">&quot;the 'cmap' table must be setup before the 'OS/2' table&quot;</span>
            <span class="s0">self.font[</span><span class="s1">&quot;OS/2&quot;</span><span class="s0">].recalcUnicodeRanges(self.font)</span>

    <span class="s2">def </span><span class="s0">setupCFF(self</span><span class="s2">, </span><span class="s0">psName</span><span class="s2">, </span><span class="s0">fontInfo</span><span class="s2">, </span><span class="s0">charStringsDict</span><span class="s2">, </span><span class="s0">privateDict):</span>
        <span class="s2">from </span><span class="s0">.cffLib </span><span class="s2">import </span><span class="s0">(</span>
            <span class="s0">CFFFontSet</span><span class="s2">,</span>
            <span class="s0">TopDictIndex</span><span class="s2">,</span>
            <span class="s0">TopDict</span><span class="s2">,</span>
            <span class="s0">CharStrings</span><span class="s2">,</span>
            <span class="s0">GlobalSubrsIndex</span><span class="s2">,</span>
            <span class="s0">PrivateDict</span><span class="s2">,</span>
        <span class="s0">)</span>

        <span class="s2">assert not </span><span class="s0">self.isTTF</span>
        <span class="s0">self.font.sfntVersion = </span><span class="s1">&quot;OTTO&quot;</span>
        <span class="s0">fontSet = CFFFontSet()</span>
        <span class="s0">fontSet.major = </span><span class="s3">1</span>
        <span class="s0">fontSet.minor = </span><span class="s3">0</span>
        <span class="s0">fontSet.otFont = self.font</span>
        <span class="s0">fontSet.fontNames = [psName]</span>
        <span class="s0">fontSet.topDictIndex = TopDictIndex()</span>

        <span class="s0">globalSubrs = GlobalSubrsIndex()</span>
        <span class="s0">fontSet.GlobalSubrs = globalSubrs</span>
        <span class="s0">private = PrivateDict()</span>
        <span class="s2">for </span><span class="s0">key</span><span class="s2">, </span><span class="s0">value </span><span class="s2">in </span><span class="s0">privateDict.items():</span>
            <span class="s0">setattr(private</span><span class="s2">, </span><span class="s0">key</span><span class="s2">, </span><span class="s0">value)</span>
        <span class="s0">fdSelect = </span><span class="s2">None</span>
        <span class="s0">fdArray = </span><span class="s2">None</span>

        <span class="s0">topDict = TopDict()</span>
        <span class="s0">topDict.charset = self.font.getGlyphOrder()</span>
        <span class="s0">topDict.Private = private</span>
        <span class="s0">topDict.GlobalSubrs = fontSet.GlobalSubrs</span>
        <span class="s2">for </span><span class="s0">key</span><span class="s2">, </span><span class="s0">value </span><span class="s2">in </span><span class="s0">fontInfo.items():</span>
            <span class="s0">setattr(topDict</span><span class="s2">, </span><span class="s0">key</span><span class="s2">, </span><span class="s0">value)</span>
        <span class="s2">if </span><span class="s1">&quot;FontMatrix&quot; </span><span class="s2">not in </span><span class="s0">fontInfo:</span>
            <span class="s0">scale = </span><span class="s3">1 </span><span class="s0">/ self.font[</span><span class="s1">&quot;head&quot;</span><span class="s0">].unitsPerEm</span>
            <span class="s0">topDict.FontMatrix = [scale</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s0">scale</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s0">]</span>

        <span class="s0">charStrings = CharStrings(</span>
            <span class="s2">None, </span><span class="s0">topDict.charset</span><span class="s2">, </span><span class="s0">globalSubrs</span><span class="s2">, </span><span class="s0">private</span><span class="s2">, </span><span class="s0">fdSelect</span><span class="s2">, </span><span class="s0">fdArray</span>
        <span class="s0">)</span>
        <span class="s2">for </span><span class="s0">glyphName</span><span class="s2">, </span><span class="s0">charString </span><span class="s2">in </span><span class="s0">charStringsDict.items():</span>
            <span class="s0">charString.private = private</span>
            <span class="s0">charString.globalSubrs = globalSubrs</span>
            <span class="s0">charStrings[glyphName] = charString</span>
        <span class="s0">topDict.CharStrings = charStrings</span>

        <span class="s0">fontSet.topDictIndex.append(topDict)</span>

        <span class="s0">self.font[</span><span class="s1">&quot;CFF &quot;</span><span class="s0">] = newTable(</span><span class="s1">&quot;CFF &quot;</span><span class="s0">)</span>
        <span class="s0">self.font[</span><span class="s1">&quot;CFF &quot;</span><span class="s0">].cff = fontSet</span>

    <span class="s2">def </span><span class="s0">setupCFF2(self</span><span class="s2">, </span><span class="s0">charStringsDict</span><span class="s2">, </span><span class="s0">fdArrayList=</span><span class="s2">None, </span><span class="s0">regions=</span><span class="s2">None</span><span class="s0">):</span>
        <span class="s2">from </span><span class="s0">.cffLib </span><span class="s2">import </span><span class="s0">(</span>
            <span class="s0">CFFFontSet</span><span class="s2">,</span>
            <span class="s0">TopDictIndex</span><span class="s2">,</span>
            <span class="s0">TopDict</span><span class="s2">,</span>
            <span class="s0">CharStrings</span><span class="s2">,</span>
            <span class="s0">GlobalSubrsIndex</span><span class="s2">,</span>
            <span class="s0">PrivateDict</span><span class="s2">,</span>
            <span class="s0">FDArrayIndex</span><span class="s2">,</span>
            <span class="s0">FontDict</span><span class="s2">,</span>
        <span class="s0">)</span>

        <span class="s2">assert not </span><span class="s0">self.isTTF</span>
        <span class="s0">self.font.sfntVersion = </span><span class="s1">&quot;OTTO&quot;</span>
        <span class="s0">fontSet = CFFFontSet()</span>
        <span class="s0">fontSet.major = </span><span class="s3">2</span>
        <span class="s0">fontSet.minor = </span><span class="s3">0</span>

        <span class="s0">cff2GetGlyphOrder = self.font.getGlyphOrder</span>
        <span class="s0">fontSet.topDictIndex = TopDictIndex(</span><span class="s2">None, </span><span class="s0">cff2GetGlyphOrder</span><span class="s2">, None</span><span class="s0">)</span>

        <span class="s0">globalSubrs = GlobalSubrsIndex()</span>
        <span class="s0">fontSet.GlobalSubrs = globalSubrs</span>

        <span class="s2">if </span><span class="s0">fdArrayList </span><span class="s2">is None</span><span class="s0">:</span>
            <span class="s0">fdArrayList = [{}]</span>
        <span class="s0">fdSelect = </span><span class="s2">None</span>
        <span class="s0">fdArray = FDArrayIndex()</span>
        <span class="s0">fdArray.strings = </span><span class="s2">None</span>
        <span class="s0">fdArray.GlobalSubrs = globalSubrs</span>
        <span class="s2">for </span><span class="s0">privateDict </span><span class="s2">in </span><span class="s0">fdArrayList:</span>
            <span class="s0">fontDict = FontDict()</span>
            <span class="s0">fontDict.setCFF2(</span><span class="s2">True</span><span class="s0">)</span>
            <span class="s0">private = PrivateDict()</span>
            <span class="s2">for </span><span class="s0">key</span><span class="s2">, </span><span class="s0">value </span><span class="s2">in </span><span class="s0">privateDict.items():</span>
                <span class="s0">setattr(private</span><span class="s2">, </span><span class="s0">key</span><span class="s2">, </span><span class="s0">value)</span>
            <span class="s0">fontDict.Private = private</span>
            <span class="s0">fdArray.append(fontDict)</span>

        <span class="s0">topDict = TopDict()</span>
        <span class="s0">topDict.cff2GetGlyphOrder = cff2GetGlyphOrder</span>
        <span class="s0">topDict.FDArray = fdArray</span>
        <span class="s0">scale = </span><span class="s3">1 </span><span class="s0">/ self.font[</span><span class="s1">&quot;head&quot;</span><span class="s0">].unitsPerEm</span>
        <span class="s0">topDict.FontMatrix = [scale</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s0">scale</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s0">]</span>

        <span class="s0">private = fdArray[</span><span class="s3">0</span><span class="s0">].Private</span>
        <span class="s0">charStrings = CharStrings(</span><span class="s2">None, None, </span><span class="s0">globalSubrs</span><span class="s2">, </span><span class="s0">private</span><span class="s2">, </span><span class="s0">fdSelect</span><span class="s2">, </span><span class="s0">fdArray)</span>
        <span class="s2">for </span><span class="s0">glyphName</span><span class="s2">, </span><span class="s0">charString </span><span class="s2">in </span><span class="s0">charStringsDict.items():</span>
            <span class="s0">charString.private = private</span>
            <span class="s0">charString.globalSubrs = globalSubrs</span>
            <span class="s0">charStrings[glyphName] = charString</span>
        <span class="s0">topDict.CharStrings = charStrings</span>

        <span class="s0">fontSet.topDictIndex.append(topDict)</span>

        <span class="s0">self.font[</span><span class="s1">&quot;CFF2&quot;</span><span class="s0">] = newTable(</span><span class="s1">&quot;CFF2&quot;</span><span class="s0">)</span>
        <span class="s0">self.font[</span><span class="s1">&quot;CFF2&quot;</span><span class="s0">].cff = fontSet</span>

        <span class="s2">if </span><span class="s0">regions:</span>
            <span class="s0">self.setupCFF2Regions(regions)</span>

    <span class="s2">def </span><span class="s0">setupCFF2Regions(self</span><span class="s2">, </span><span class="s0">regions):</span>
        <span class="s2">from </span><span class="s0">.varLib.builder </span><span class="s2">import </span><span class="s0">buildVarRegionList</span><span class="s2">, </span><span class="s0">buildVarData</span><span class="s2">, </span><span class="s0">buildVarStore</span>
        <span class="s2">from </span><span class="s0">.cffLib </span><span class="s2">import </span><span class="s0">VarStoreData</span>

        <span class="s2">assert </span><span class="s1">&quot;fvar&quot; </span><span class="s2">in </span><span class="s0">self.font</span><span class="s2">, </span><span class="s1">&quot;fvar must to be set up first&quot;</span>
        <span class="s2">assert </span><span class="s1">&quot;CFF2&quot; </span><span class="s2">in </span><span class="s0">self.font</span><span class="s2">, </span><span class="s1">&quot;CFF2 must to be set up first&quot;</span>
        <span class="s0">axisTags = [a.axisTag </span><span class="s2">for </span><span class="s0">a </span><span class="s2">in </span><span class="s0">self.font[</span><span class="s1">&quot;fvar&quot;</span><span class="s0">].axes]</span>
        <span class="s0">varRegionList = buildVarRegionList(regions</span><span class="s2">, </span><span class="s0">axisTags)</span>
        <span class="s0">varData = buildVarData(list(range(len(regions)))</span><span class="s2">, None, </span><span class="s0">optimize=</span><span class="s2">False</span><span class="s0">)</span>
        <span class="s0">varStore = buildVarStore(varRegionList</span><span class="s2">, </span><span class="s0">[varData])</span>
        <span class="s0">vstore = VarStoreData(otVarStore=varStore)</span>
        <span class="s0">topDict = self.font[</span><span class="s1">&quot;CFF2&quot;</span><span class="s0">].cff.topDictIndex[</span><span class="s3">0</span><span class="s0">]</span>
        <span class="s0">topDict.VarStore = vstore</span>
        <span class="s2">for </span><span class="s0">fontDict </span><span class="s2">in </span><span class="s0">topDict.FDArray:</span>
            <span class="s0">fontDict.Private.vstore = vstore</span>

    <span class="s2">def </span><span class="s0">setupGlyf(self</span><span class="s2">, </span><span class="s0">glyphs</span><span class="s2">, </span><span class="s0">calcGlyphBounds=</span><span class="s2">True</span><span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Create the `glyf` table from a dict, that maps glyph names 
        to `fontTools.ttLib.tables._g_l_y_f.Glyph` objects, for example 
        as made by `fontTools.pens.ttGlyphPen.TTGlyphPen`. 
 
        If `calcGlyphBounds` is True, the bounds of all glyphs will be 
        calculated. Only pass False if your glyph objects already have 
        their bounding box values set. 
        &quot;&quot;&quot;</span>
        <span class="s2">assert </span><span class="s0">self.isTTF</span>
        <span class="s0">self.font[</span><span class="s1">&quot;loca&quot;</span><span class="s0">] = newTable(</span><span class="s1">&quot;loca&quot;</span><span class="s0">)</span>
        <span class="s0">self.font[</span><span class="s1">&quot;glyf&quot;</span><span class="s0">] = newTable(</span><span class="s1">&quot;glyf&quot;</span><span class="s0">)</span>
        <span class="s0">self.font[</span><span class="s1">&quot;glyf&quot;</span><span class="s0">].glyphs = glyphs</span>
        <span class="s2">if </span><span class="s0">hasattr(self.font</span><span class="s2">, </span><span class="s1">&quot;glyphOrder&quot;</span><span class="s0">):</span>
            <span class="s0">self.font[</span><span class="s1">&quot;glyf&quot;</span><span class="s0">].glyphOrder = self.font.glyphOrder</span>
        <span class="s2">if </span><span class="s0">calcGlyphBounds:</span>
            <span class="s0">self.calcGlyphBounds()</span>

    <span class="s2">def </span><span class="s0">setupFvar(self</span><span class="s2">, </span><span class="s0">axes</span><span class="s2">, </span><span class="s0">instances):</span>
        <span class="s5">&quot;&quot;&quot;Adds an font variations table to the font. 
 
        Args: 
            axes (list): See below. 
            instances (list): See below. 
 
        ``axes`` should be a list of axes, with each axis either supplied as 
        a py:class:`.designspaceLib.AxisDescriptor` object, or a tuple in the 
        format ```tupletag, minValue, defaultValue, maxValue, name``. 
        The ``name`` is either a string, or a dict, mapping language codes 
        to strings, to allow localized name table entries. 
 
        ```instances`` should be a list of instances, with each instance either 
        supplied as a py:class:`.designspaceLib.InstanceDescriptor` object, or a 
        dict with keys ``location`` (mapping of axis tags to float values), 
        ``stylename`` and (optionally) ``postscriptfontname``. 
        The ``stylename`` is either a string, or a dict, mapping language codes 
        to strings, to allow localized name table entries. 
        &quot;&quot;&quot;</span>

        <span class="s0">addFvar(self.font</span><span class="s2">, </span><span class="s0">axes</span><span class="s2">, </span><span class="s0">instances)</span>

    <span class="s2">def </span><span class="s0">setupAvar(self</span><span class="s2">, </span><span class="s0">axes):</span>
        <span class="s5">&quot;&quot;&quot;Adds an axis variations table to the font. 
 
        Args: 
            axes (list): A list of py:class:`.designspaceLib.AxisDescriptor` objects. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s0">.varLib </span><span class="s2">import </span><span class="s0">_add_avar</span>

        <span class="s0">_add_avar(self.font</span><span class="s2">, </span><span class="s0">OrderedDict(enumerate(axes)))  </span><span class="s4"># Only values are used</span>

    <span class="s2">def </span><span class="s0">setupGvar(self</span><span class="s2">, </span><span class="s0">variations):</span>
        <span class="s0">gvar = self.font[</span><span class="s1">&quot;gvar&quot;</span><span class="s0">] = newTable(</span><span class="s1">&quot;gvar&quot;</span><span class="s0">)</span>
        <span class="s0">gvar.version = </span><span class="s3">1</span>
        <span class="s0">gvar.reserved = </span><span class="s3">0</span>
        <span class="s0">gvar.variations = variations</span>

    <span class="s2">def </span><span class="s0">calcGlyphBounds(self):</span>
        <span class="s5">&quot;&quot;&quot;Calculate the bounding boxes of all glyphs in the `glyf` table. 
        This is usually not called explicitly by client code. 
        &quot;&quot;&quot;</span>
        <span class="s0">glyphTable = self.font[</span><span class="s1">&quot;glyf&quot;</span><span class="s0">]</span>
        <span class="s2">for </span><span class="s0">glyph </span><span class="s2">in </span><span class="s0">glyphTable.glyphs.values():</span>
            <span class="s0">glyph.recalcBounds(glyphTable)</span>

    <span class="s2">def </span><span class="s0">setupHorizontalMetrics(self</span><span class="s2">, </span><span class="s0">metrics):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `hmtx` table, for horizontal metrics. 
 
        The `metrics` argument must be a dict, mapping glyph names to 
        `(width, leftSidebearing)` tuples. 
        &quot;&quot;&quot;</span>
        <span class="s0">self.setupMetrics(</span><span class="s1">&quot;hmtx&quot;</span><span class="s2">, </span><span class="s0">metrics)</span>

    <span class="s2">def </span><span class="s0">setupVerticalMetrics(self</span><span class="s2">, </span><span class="s0">metrics):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `vmtx` table, for horizontal metrics. 
 
        The `metrics` argument must be a dict, mapping glyph names to 
        `(height, topSidebearing)` tuples. 
        &quot;&quot;&quot;</span>
        <span class="s0">self.setupMetrics(</span><span class="s1">&quot;vmtx&quot;</span><span class="s2">, </span><span class="s0">metrics)</span>

    <span class="s2">def </span><span class="s0">setupMetrics(self</span><span class="s2">, </span><span class="s0">tableTag</span><span class="s2">, </span><span class="s0">metrics):</span>
        <span class="s5">&quot;&quot;&quot;See `setupHorizontalMetrics()` and `setupVerticalMetrics()`.&quot;&quot;&quot;</span>
        <span class="s2">assert </span><span class="s0">tableTag </span><span class="s2">in </span><span class="s0">(</span><span class="s1">&quot;hmtx&quot;</span><span class="s2">, </span><span class="s1">&quot;vmtx&quot;</span><span class="s0">)</span>
        <span class="s0">mtxTable = self.font[tableTag] = newTable(tableTag)</span>
        <span class="s0">roundedMetrics = {}</span>
        <span class="s2">for </span><span class="s0">gn </span><span class="s2">in </span><span class="s0">metrics:</span>
            <span class="s0">w</span><span class="s2">, </span><span class="s0">lsb = metrics[gn]</span>
            <span class="s0">roundedMetrics[gn] = int(round(w))</span><span class="s2">, </span><span class="s0">int(round(lsb))</span>
        <span class="s0">mtxTable.metrics = roundedMetrics</span>

    <span class="s2">def </span><span class="s0">setupHorizontalHeader(self</span><span class="s2">, </span><span class="s0">**values):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `hhea` table initialize it with default values, 
        which can be overridden by keyword arguments. 
        &quot;&quot;&quot;</span>
        <span class="s0">self._initTableWithValues(</span><span class="s1">&quot;hhea&quot;</span><span class="s2">, </span><span class="s0">_hheaDefaults</span><span class="s2">, </span><span class="s0">values)</span>

    <span class="s2">def </span><span class="s0">setupVerticalHeader(self</span><span class="s2">, </span><span class="s0">**values):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `vhea` table initialize it with default values, 
        which can be overridden by keyword arguments. 
        &quot;&quot;&quot;</span>
        <span class="s0">self._initTableWithValues(</span><span class="s1">&quot;vhea&quot;</span><span class="s2">, </span><span class="s0">_vheaDefaults</span><span class="s2">, </span><span class="s0">values)</span>

    <span class="s2">def </span><span class="s0">setupVerticalOrigins(self</span><span class="s2">, </span><span class="s0">verticalOrigins</span><span class="s2">, </span><span class="s0">defaultVerticalOrigin=</span><span class="s2">None</span><span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `VORG` table. The `verticalOrigins` argument must be 
        a dict, mapping glyph names to vertical origin values. 
 
        The `defaultVerticalOrigin` argument should be the most common vertical 
        origin value. If omitted, this value will be derived from the actual 
        values in the `verticalOrigins` argument. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s0">defaultVerticalOrigin </span><span class="s2">is None</span><span class="s0">:</span>
            <span class="s4"># find the most frequent vorg value</span>
            <span class="s0">bag = {}</span>
            <span class="s2">for </span><span class="s0">gn </span><span class="s2">in </span><span class="s0">verticalOrigins:</span>
                <span class="s0">vorg = verticalOrigins[gn]</span>
                <span class="s2">if </span><span class="s0">vorg </span><span class="s2">not in </span><span class="s0">bag:</span>
                    <span class="s0">bag[vorg] = </span><span class="s3">1</span>
                <span class="s2">else</span><span class="s0">:</span>
                    <span class="s0">bag[vorg] += </span><span class="s3">1</span>
            <span class="s0">defaultVerticalOrigin = sorted(</span>
                <span class="s0">bag</span><span class="s2">, </span><span class="s0">key=</span><span class="s2">lambda </span><span class="s0">vorg: bag[vorg]</span><span class="s2">, </span><span class="s0">reverse=</span><span class="s2">True</span>
            <span class="s0">)[</span><span class="s3">0</span><span class="s0">]</span>
        <span class="s0">self._initTableWithValues(</span>
            <span class="s1">&quot;VORG&quot;</span><span class="s2">,</span>
            <span class="s0">{}</span><span class="s2">,</span>
            <span class="s0">dict(VOriginRecords={}</span><span class="s2">, </span><span class="s0">defaultVertOriginY=defaultVerticalOrigin)</span><span class="s2">,</span>
        <span class="s0">)</span>
        <span class="s0">vorgTable = self.font[</span><span class="s1">&quot;VORG&quot;</span><span class="s0">]</span>
        <span class="s0">vorgTable.majorVersion = </span><span class="s3">1</span>
        <span class="s0">vorgTable.minorVersion = </span><span class="s3">0</span>
        <span class="s2">for </span><span class="s0">gn </span><span class="s2">in </span><span class="s0">verticalOrigins:</span>
            <span class="s0">vorgTable[gn] = verticalOrigins[gn]</span>

    <span class="s2">def </span><span class="s0">setupPost(self</span><span class="s2">, </span><span class="s0">keepGlyphNames=</span><span class="s2">True, </span><span class="s0">**values):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `post` table and initialize it with default values, 
        which can be overridden by keyword arguments. 
        &quot;&quot;&quot;</span>
        <span class="s0">isCFF2 = </span><span class="s1">&quot;CFF2&quot; </span><span class="s2">in </span><span class="s0">self.font</span>
        <span class="s0">postTable = self._initTableWithValues(</span><span class="s1">&quot;post&quot;</span><span class="s2">, </span><span class="s0">_postDefaults</span><span class="s2">, </span><span class="s0">values)</span>
        <span class="s2">if </span><span class="s0">(self.isTTF </span><span class="s2">or </span><span class="s0">isCFF2) </span><span class="s2">and </span><span class="s0">keepGlyphNames:</span>
            <span class="s0">postTable.formatType = </span><span class="s3">2.0</span>
            <span class="s0">postTable.extraNames = []</span>
            <span class="s0">postTable.mapping = {}</span>
        <span class="s2">else</span><span class="s0">:</span>
            <span class="s0">postTable.formatType = </span><span class="s3">3.0</span>

    <span class="s2">def </span><span class="s0">setupMaxp(self):</span>
        <span class="s5">&quot;&quot;&quot;Create a new `maxp` table. This is called implicitly by FontBuilder 
        itself and is usually not called by client code. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s0">self.isTTF:</span>
            <span class="s0">defaults = _maxpDefaultsTTF</span>
        <span class="s2">else</span><span class="s0">:</span>
            <span class="s0">defaults = _maxpDefaultsOTF</span>
        <span class="s0">self._initTableWithValues(</span><span class="s1">&quot;maxp&quot;</span><span class="s2">, </span><span class="s0">defaults</span><span class="s2">, </span><span class="s0">{})</span>

    <span class="s2">def </span><span class="s0">setupDummyDSIG(self):</span>
        <span class="s5">&quot;&quot;&quot;This adds an empty DSIG table to the font to make some MS applications 
        happy. This does not properly sign the font. 
        &quot;&quot;&quot;</span>
        <span class="s0">values = dict(</span>
            <span class="s0">ulVersion=</span><span class="s3">1</span><span class="s2">,</span>
            <span class="s0">usFlag=</span><span class="s3">0</span><span class="s2">,</span>
            <span class="s0">usNumSigs=</span><span class="s3">0</span><span class="s2">,</span>
            <span class="s0">signatureRecords=[]</span><span class="s2">,</span>
        <span class="s0">)</span>
        <span class="s0">self._initTableWithValues(</span><span class="s1">&quot;DSIG&quot;</span><span class="s2">, </span><span class="s0">{}</span><span class="s2">, </span><span class="s0">values)</span>

    <span class="s2">def </span><span class="s0">addOpenTypeFeatures(self</span><span class="s2">, </span><span class="s0">features</span><span class="s2">, </span><span class="s0">filename=</span><span class="s2">None, </span><span class="s0">tables=</span><span class="s2">None</span><span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Add OpenType features to the font from a string containing 
        Feature File syntax. 
 
        The `filename` argument is used in error messages and to determine 
        where to look for &quot;include&quot; files. 
 
        The optional `tables` argument can be a list of OTL tables tags to 
        build, allowing the caller to only build selected OTL tables. See 
        `fontTools.feaLib` for details. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s0">.feaLib.builder </span><span class="s2">import </span><span class="s0">addOpenTypeFeaturesFromString</span>

        <span class="s0">addOpenTypeFeaturesFromString(</span>
            <span class="s0">self.font</span><span class="s2">, </span><span class="s0">features</span><span class="s2">, </span><span class="s0">filename=filename</span><span class="s2">, </span><span class="s0">tables=tables</span>
        <span class="s0">)</span>

    <span class="s2">def </span><span class="s0">addFeatureVariations(self</span><span class="s2">, </span><span class="s0">conditionalSubstitutions</span><span class="s2">, </span><span class="s0">featureTag=</span><span class="s1">&quot;rvrn&quot;</span><span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Add conditional substitutions to a Variable Font. 
 
        See `fontTools.varLib.featureVars.addFeatureVariations`. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s0">.varLib </span><span class="s2">import </span><span class="s0">featureVars</span>

        <span class="s2">if </span><span class="s1">&quot;fvar&quot; </span><span class="s2">not in </span><span class="s0">self.font:</span>
            <span class="s2">raise </span><span class="s0">KeyError(</span><span class="s1">&quot;'fvar' table is missing; can't add FeatureVariations.&quot;</span><span class="s0">)</span>

        <span class="s0">featureVars.addFeatureVariations(</span>
            <span class="s0">self.font</span><span class="s2">, </span><span class="s0">conditionalSubstitutions</span><span class="s2">, </span><span class="s0">featureTag=featureTag</span>
        <span class="s0">)</span>

    <span class="s2">def </span><span class="s0">setupCOLR(</span>
        <span class="s0">self</span><span class="s2">,</span>
        <span class="s0">colorLayers</span><span class="s2">,</span>
        <span class="s0">version=</span><span class="s2">None,</span>
        <span class="s0">varStore=</span><span class="s2">None,</span>
        <span class="s0">varIndexMap=</span><span class="s2">None,</span>
        <span class="s0">clipBoxes=</span><span class="s2">None,</span>
        <span class="s0">allowLayerReuse=</span><span class="s2">True,</span>
    <span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Build new COLR table using color layers dictionary. 
 
        Cf. `fontTools.colorLib.builder.buildCOLR`. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s0">fontTools.colorLib.builder </span><span class="s2">import </span><span class="s0">buildCOLR</span>

        <span class="s0">glyphMap = self.font.getReverseGlyphMap()</span>
        <span class="s0">self.font[</span><span class="s1">&quot;COLR&quot;</span><span class="s0">] = buildCOLR(</span>
            <span class="s0">colorLayers</span><span class="s2">,</span>
            <span class="s0">version=version</span><span class="s2">,</span>
            <span class="s0">glyphMap=glyphMap</span><span class="s2">,</span>
            <span class="s0">varStore=varStore</span><span class="s2">,</span>
            <span class="s0">varIndexMap=varIndexMap</span><span class="s2">,</span>
            <span class="s0">clipBoxes=clipBoxes</span><span class="s2">,</span>
            <span class="s0">allowLayerReuse=allowLayerReuse</span><span class="s2">,</span>
        <span class="s0">)</span>

    <span class="s2">def </span><span class="s0">setupCPAL(</span>
        <span class="s0">self</span><span class="s2">,</span>
        <span class="s0">palettes</span><span class="s2">,</span>
        <span class="s0">paletteTypes=</span><span class="s2">None,</span>
        <span class="s0">paletteLabels=</span><span class="s2">None,</span>
        <span class="s0">paletteEntryLabels=</span><span class="s2">None,</span>
    <span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Build new CPAL table using list of palettes. 
 
        Optionally build CPAL v1 table using paletteTypes, paletteLabels and 
        paletteEntryLabels. 
 
        Cf. `fontTools.colorLib.builder.buildCPAL`. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s0">fontTools.colorLib.builder </span><span class="s2">import </span><span class="s0">buildCPAL</span>

        <span class="s0">self.font[</span><span class="s1">&quot;CPAL&quot;</span><span class="s0">] = buildCPAL(</span>
            <span class="s0">palettes</span><span class="s2">,</span>
            <span class="s0">paletteTypes=paletteTypes</span><span class="s2">,</span>
            <span class="s0">paletteLabels=paletteLabels</span><span class="s2">,</span>
            <span class="s0">paletteEntryLabels=paletteEntryLabels</span><span class="s2">,</span>
            <span class="s0">nameTable=self.font.get(</span><span class="s1">&quot;name&quot;</span><span class="s0">)</span><span class="s2">,</span>
        <span class="s0">)</span>

    <span class="s2">def </span><span class="s0">setupStat(self</span><span class="s2">, </span><span class="s0">axes</span><span class="s2">, </span><span class="s0">locations=</span><span class="s2">None, </span><span class="s0">elidedFallbackName=</span><span class="s3">2</span><span class="s0">):</span>
        <span class="s5">&quot;&quot;&quot;Build a new 'STAT' table. 
 
        See `fontTools.otlLib.builder.buildStatTable` for details about 
        the arguments. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s0">.otlLib.builder </span><span class="s2">import </span><span class="s0">buildStatTable</span>

        <span class="s0">buildStatTable(self.font</span><span class="s2">, </span><span class="s0">axes</span><span class="s2">, </span><span class="s0">locations</span><span class="s2">, </span><span class="s0">elidedFallbackName)</span>


<span class="s2">def </span><span class="s0">buildCmapSubTable(cmapping</span><span class="s2">, </span><span class="s0">format</span><span class="s2">, </span><span class="s0">platformID</span><span class="s2">, </span><span class="s0">platEncID):</span>
    <span class="s0">subTable = cmap_classes[format](format)</span>
    <span class="s0">subTable.cmap = cmapping</span>
    <span class="s0">subTable.platformID = platformID</span>
    <span class="s0">subTable.platEncID = platEncID</span>
    <span class="s0">subTable.language = </span><span class="s3">0</span>
    <span class="s2">return </span><span class="s0">subTable</span>


<span class="s2">def </span><span class="s0">addFvar(font</span><span class="s2">, </span><span class="s0">axes</span><span class="s2">, </span><span class="s0">instances):</span>
    <span class="s2">from </span><span class="s0">.ttLib.tables._f_v_a_r </span><span class="s2">import </span><span class="s0">Axis</span><span class="s2">, </span><span class="s0">NamedInstance</span>

    <span class="s2">assert </span><span class="s0">axes</span>

    <span class="s0">fvar = newTable(</span><span class="s1">&quot;fvar&quot;</span><span class="s0">)</span>
    <span class="s0">nameTable = font[</span><span class="s1">&quot;name&quot;</span><span class="s0">]</span>

    <span class="s2">for </span><span class="s0">axis_def </span><span class="s2">in </span><span class="s0">axes:</span>
        <span class="s0">axis = Axis()</span>

        <span class="s2">if </span><span class="s0">isinstance(axis_def</span><span class="s2">, </span><span class="s0">tuple):</span>
            <span class="s0">(</span>
                <span class="s0">axis.axisTag</span><span class="s2">,</span>
                <span class="s0">axis.minValue</span><span class="s2">,</span>
                <span class="s0">axis.defaultValue</span><span class="s2">,</span>
                <span class="s0">axis.maxValue</span><span class="s2">,</span>
                <span class="s0">name</span><span class="s2">,</span>
            <span class="s0">) = axis_def</span>
        <span class="s2">else</span><span class="s0">:</span>
            <span class="s0">(axis.axisTag</span><span class="s2">, </span><span class="s0">axis.minValue</span><span class="s2">, </span><span class="s0">axis.defaultValue</span><span class="s2">, </span><span class="s0">axis.maxValue</span><span class="s2">, </span><span class="s0">name) = (</span>
                <span class="s0">axis_def.tag</span><span class="s2">,</span>
                <span class="s0">axis_def.minimum</span><span class="s2">,</span>
                <span class="s0">axis_def.default</span><span class="s2">,</span>
                <span class="s0">axis_def.maximum</span><span class="s2">,</span>
                <span class="s0">axis_def.name</span><span class="s2">,</span>
            <span class="s0">)</span>

        <span class="s2">if </span><span class="s0">isinstance(name</span><span class="s2">, </span><span class="s0">str):</span>
            <span class="s0">name = dict(en=name)</span>

        <span class="s0">axis.axisNameID = nameTable.addMultilingualName(name</span><span class="s2">, </span><span class="s0">ttFont=font)</span>
        <span class="s0">fvar.axes.append(axis)</span>

    <span class="s2">for </span><span class="s0">instance </span><span class="s2">in </span><span class="s0">instances:</span>
        <span class="s2">if </span><span class="s0">isinstance(instance</span><span class="s2">, </span><span class="s0">dict):</span>
            <span class="s0">coordinates = instance[</span><span class="s1">&quot;location&quot;</span><span class="s0">]</span>
            <span class="s0">name = instance[</span><span class="s1">&quot;stylename&quot;</span><span class="s0">]</span>
            <span class="s0">psname = instance.get(</span><span class="s1">&quot;postscriptfontname&quot;</span><span class="s0">)</span>
        <span class="s2">else</span><span class="s0">:</span>
            <span class="s0">coordinates = instance.location</span>
            <span class="s0">name = instance.localisedStyleName </span><span class="s2">or </span><span class="s0">instance.styleName</span>
            <span class="s0">psname = instance.postScriptFontName</span>

        <span class="s2">if </span><span class="s0">isinstance(name</span><span class="s2">, </span><span class="s0">str):</span>
            <span class="s0">name = dict(en=name)</span>

        <span class="s0">inst = NamedInstance()</span>
        <span class="s0">inst.subfamilyNameID = nameTable.addMultilingualName(name</span><span class="s2">, </span><span class="s0">ttFont=font)</span>
        <span class="s2">if </span><span class="s0">psname </span><span class="s2">is not None</span><span class="s0">:</span>
            <span class="s0">inst.postscriptNameID = nameTable.addName(psname)</span>
        <span class="s0">inst.coordinates = coordinates</span>
        <span class="s0">fvar.instances.append(inst)</span>

    <span class="s0">font[</span><span class="s1">&quot;fvar&quot;</span><span class="s0">] = fvar</span>
</pre>
</body>
</html>