<html>
<head>
<title>test_colorbar.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_colorbar.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">platform</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">_api</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">cm</span>
<span class="s0">import </span><span class="s1">matplotlib.colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>


<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">rc_context</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib.colors </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">BoundaryNorm</span><span class="s0">, </span><span class="s1">LogNorm</span><span class="s0">, </span><span class="s1">PowerNorm</span><span class="s0">, </span><span class="s1">Normalize</span><span class="s0">, </span><span class="s1">NoNorm</span>
<span class="s1">)</span>
<span class="s0">from </span><span class="s1">matplotlib.colorbar </span><span class="s0">import </span><span class="s1">Colorbar</span>
<span class="s0">from </span><span class="s1">matplotlib.ticker </span><span class="s0">import </span><span class="s1">FixedLocator</span><span class="s0">, </span><span class="s1">LogFormatter</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span>


<span class="s0">def </span><span class="s1">_get_cmap_norms():</span>
    <span class="s2">&quot;&quot;&quot; 
    Define a colormap and appropriate norms for each of the four 
    possible settings of the extend keyword. 
 
    Helper function for _colorbar_extension_shape and 
    colorbar_extension_length. 
    &quot;&quot;&quot;</span>
    <span class="s3"># Create a colormap and specify the levels it represents.</span>
    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">&quot;RdBu&quot;</span><span class="s1">].resampled(</span><span class="s5">5</span><span class="s1">)</span>
    <span class="s1">clevs = [-</span><span class="s5">5.</span><span class="s0">, </span><span class="s1">-</span><span class="s5">2.5</span><span class="s0">, </span><span class="s1">-</span><span class="s5">.5</span><span class="s0">, </span><span class="s5">.5</span><span class="s0">, </span><span class="s5">1.5</span><span class="s0">, </span><span class="s5">3.5</span><span class="s1">]</span>
    <span class="s3"># Define norms for the colormaps.</span>
    <span class="s1">norms = dict()</span>
    <span class="s1">norms[</span><span class="s4">'neither'</span><span class="s1">] = BoundaryNorm(clevs</span><span class="s0">, </span><span class="s1">len(clevs) - </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">norms[</span><span class="s4">'min'</span><span class="s1">] = BoundaryNorm([-</span><span class="s5">10</span><span class="s1">] + clevs[</span><span class="s5">1</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">len(clevs) - </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">norms[</span><span class="s4">'max'</span><span class="s1">] = BoundaryNorm(clevs[:-</span><span class="s5">1</span><span class="s1">] + [</span><span class="s5">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">len(clevs) - </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">norms[</span><span class="s4">'both'</span><span class="s1">] = BoundaryNorm([-</span><span class="s5">10</span><span class="s1">] + clevs[</span><span class="s5">1</span><span class="s1">:-</span><span class="s5">1</span><span class="s1">] + [</span><span class="s5">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">len(clevs) - </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s0">return </span><span class="s1">cmap</span><span class="s0">, </span><span class="s1">norms</span>


<span class="s0">def </span><span class="s1">_colorbar_extension_shape(spacing):</span>
    <span class="s2">&quot;&quot;&quot; 
    Produce 4 colorbars with rectangular extensions for either uniform 
    or proportional spacing. 
 
    Helper function for test_colorbar_extension_shape. 
    &quot;&quot;&quot;</span>
    <span class="s3"># Get a colormap and appropriate norms for each extension type.</span>
    <span class="s1">cmap</span><span class="s0">, </span><span class="s1">norms = _get_cmap_norms()</span>
    <span class="s3"># Create a figure and adjust whitespace for subplots.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.subplots_adjust(hspace=</span><span class="s5">4</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">extension_type </span><span class="s0">in </span><span class="s1">enumerate((</span><span class="s4">'neither'</span><span class="s0">, </span><span class="s4">'min'</span><span class="s0">, </span><span class="s4">'max'</span><span class="s0">, </span><span class="s4">'both'</span><span class="s1">)):</span>
        <span class="s3"># Get the appropriate norm and use it to get colorbar boundaries.</span>
        <span class="s1">norm = norms[extension_type]</span>
        <span class="s1">boundaries = values = norm.boundaries</span>
        <span class="s3"># note that the last value was silently dropped pre 3.3:</span>
        <span class="s1">values = values[:-</span><span class="s5">1</span><span class="s1">]</span>
        <span class="s3"># Create a subplot.</span>
        <span class="s1">cax = fig.add_subplot(</span><span class="s5">4</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">i + </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s3"># Generate the colorbar.</span>
        <span class="s1">Colorbar(cax</span><span class="s0">, </span><span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm</span><span class="s0">,</span>
                 <span class="s1">boundaries=boundaries</span><span class="s0">, </span><span class="s1">values=values</span><span class="s0">,</span>
                 <span class="s1">extend=extension_type</span><span class="s0">, </span><span class="s1">extendrect=</span><span class="s0">True,</span>
                 <span class="s1">orientation=</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s1">spacing=spacing)</span>
        <span class="s3"># Turn off text and ticks.</span>
        <span class="s1">cax.tick_params(left=</span><span class="s0">False, </span><span class="s1">labelleft=</span><span class="s0">False,</span>
                        <span class="s1">bottom=</span><span class="s0">False, </span><span class="s1">labelbottom=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s3"># Return the figure to the caller.</span>
    <span class="s0">return </span><span class="s1">fig</span>


<span class="s0">def </span><span class="s1">_colorbar_extension_length(spacing):</span>
    <span class="s2">&quot;&quot;&quot; 
    Produce 12 colorbars with variable length extensions for either 
    uniform or proportional spacing. 
 
    Helper function for test_colorbar_extension_length. 
    &quot;&quot;&quot;</span>
    <span class="s3"># Get a colormap and appropriate norms for each extension type.</span>
    <span class="s1">cmap</span><span class="s0">, </span><span class="s1">norms = _get_cmap_norms()</span>
    <span class="s3"># Create a figure and adjust whitespace for subplots.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.subplots_adjust(hspace=</span><span class="s5">.6</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">extension_type </span><span class="s0">in </span><span class="s1">enumerate((</span><span class="s4">'neither'</span><span class="s0">, </span><span class="s4">'min'</span><span class="s0">, </span><span class="s4">'max'</span><span class="s0">, </span><span class="s4">'both'</span><span class="s1">)):</span>
        <span class="s3"># Get the appropriate norm and use it to get colorbar boundaries.</span>
        <span class="s1">norm = norms[extension_type]</span>
        <span class="s1">boundaries = values = norm.boundaries</span>
        <span class="s1">values = values[:-</span><span class="s5">1</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">j</span><span class="s0">, </span><span class="s1">extendfrac </span><span class="s0">in </span><span class="s1">enumerate((</span><span class="s0">None, </span><span class="s4">'auto'</span><span class="s0">, </span><span class="s5">0.1</span><span class="s1">)):</span>
            <span class="s3"># Create a subplot.</span>
            <span class="s1">cax = fig.add_subplot(</span><span class="s5">12</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">i*</span><span class="s5">3 </span><span class="s1">+ j + </span><span class="s5">1</span><span class="s1">)</span>
            <span class="s3"># Generate the colorbar.</span>
            <span class="s1">Colorbar(cax</span><span class="s0">, </span><span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm</span><span class="s0">,</span>
                     <span class="s1">boundaries=boundaries</span><span class="s0">, </span><span class="s1">values=values</span><span class="s0">,</span>
                     <span class="s1">extend=extension_type</span><span class="s0">, </span><span class="s1">extendfrac=extendfrac</span><span class="s0">,</span>
                     <span class="s1">orientation=</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s1">spacing=spacing)</span>
            <span class="s3"># Turn off text and ticks.</span>
            <span class="s1">cax.tick_params(left=</span><span class="s0">False, </span><span class="s1">labelleft=</span><span class="s0">False,</span>
                              <span class="s1">bottom=</span><span class="s0">False, </span><span class="s1">labelbottom=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s3"># Return the figure to the caller.</span>
    <span class="s0">return </span><span class="s1">fig</span>


<span class="s1">@image_comparison([</span><span class="s4">'colorbar_extensions_shape_uniform.png'</span><span class="s0">,</span>
                   <span class="s4">'colorbar_extensions_shape_proportional.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_extension_shape():</span>
    <span class="s2">&quot;&quot;&quot;Test rectangular colorbar extensions.&quot;&quot;&quot;</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s3"># Create figures for uniform and proportionally spaced colorbars.</span>
    <span class="s1">_colorbar_extension_shape(</span><span class="s4">'uniform'</span><span class="s1">)</span>
    <span class="s1">_colorbar_extension_shape(</span><span class="s4">'proportional'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'colorbar_extensions_uniform.png'</span><span class="s0">,</span>
                   <span class="s4">'colorbar_extensions_proportional.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s5">1.0</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_extension_length():</span>
    <span class="s2">&quot;&quot;&quot;Test variable length colorbar extensions.&quot;&quot;&quot;</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s3"># Create figures for uniform and proportionally spaced colorbars.</span>
    <span class="s1">_colorbar_extension_length(</span><span class="s4">'uniform'</span><span class="s1">)</span>
    <span class="s1">_colorbar_extension_length(</span><span class="s4">'proportional'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;orientation&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;horizontal&quot;</span><span class="s0">, </span><span class="s4">&quot;vertical&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;extend,expected&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">&quot;min&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">))</span><span class="s0">,</span>
                                             <span class="s1">(</span><span class="s4">&quot;max&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s1">))</span><span class="s0">,</span>
                                             <span class="s1">(</span><span class="s4">&quot;both&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s1">))])</span>
<span class="s0">def </span><span class="s1">test_colorbar_extension_inverted_axis(orientation</span><span class="s0">, </span><span class="s1">extend</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s2">&quot;&quot;&quot;Test extension color with an inverted axis&quot;&quot;&quot;</span>
    <span class="s1">data = np.arange(</span><span class="s5">12</span><span class="s1">).reshape(</span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">&quot;viridis&quot;</span><span class="s1">].with_extremes(under=(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span><span class="s0">,</span>
                                                  <span class="s1">over=(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">1</span><span class="s1">))</span>
    <span class="s1">im = ax.imshow(data</span><span class="s0">, </span><span class="s1">cmap=cmap)</span>
    <span class="s1">cbar = fig.colorbar(im</span><span class="s0">, </span><span class="s1">orientation=orientation</span><span class="s0">, </span><span class="s1">extend=extend)</span>
    <span class="s0">if </span><span class="s1">orientation == </span><span class="s4">&quot;horizontal&quot;</span><span class="s1">:</span>
        <span class="s1">cbar.ax.invert_xaxis()</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">cbar.ax.invert_yaxis()</span>
    <span class="s0">assert </span><span class="s1">cbar._extend_patches[</span><span class="s5">0</span><span class="s1">].get_facecolor() == expected</span>
    <span class="s0">if </span><span class="s1">extend == </span><span class="s4">&quot;both&quot;</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">len(cbar._extend_patches) == </span><span class="s5">2</span>
        <span class="s0">assert </span><span class="s1">cbar._extend_patches[</span><span class="s5">1</span><span class="s1">].get_facecolor() == (</span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">len(cbar._extend_patches) == </span><span class="s5">1</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'use_gridspec'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s1">@image_comparison([</span><span class="s4">'cbar_with_orientation'</span><span class="s0">,</span>
                   <span class="s4">'cbar_locationing'</span><span class="s0">,</span>
                   <span class="s4">'double_cbar'</span><span class="s0">,</span>
                   <span class="s4">'cbar_sharing'</span><span class="s0">,</span>
                   <span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s4">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s4">'dpi'</span><span class="s1">: </span><span class="s5">40</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_colorbar_positioning(use_gridspec):</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">data = np.arange(</span><span class="s5">1200</span><span class="s1">).reshape(</span><span class="s5">30</span><span class="s0">, </span><span class="s5">40</span><span class="s1">)</span>
    <span class="s1">levels = [</span><span class="s5">0</span><span class="s0">, </span><span class="s5">200</span><span class="s0">, </span><span class="s5">400</span><span class="s0">, </span><span class="s5">600</span><span class="s0">, </span><span class="s5">800</span><span class="s0">, </span><span class="s5">1000</span><span class="s0">, </span><span class="s5">1200</span><span class="s1">]</span>

    <span class="s3"># -------------------</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">plt.colorbar(orientation=</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s1">use_gridspec=use_gridspec)</span>

    <span class="s1">locations = [</span><span class="s4">'left'</span><span class="s0">, </span><span class="s4">'right'</span><span class="s0">, </span><span class="s4">'top'</span><span class="s0">, </span><span class="s4">'bottom'</span><span class="s1">]</span>
    <span class="s1">plt.figure()</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">location </span><span class="s0">in </span><span class="s1">enumerate(locations):</span>
        <span class="s1">plt.subplot(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">i + </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
        <span class="s1">plt.colorbar(location=location</span><span class="s0">, </span><span class="s1">use_gridspec=use_gridspec)</span>

    <span class="s3"># -------------------</span>
    <span class="s1">plt.figure()</span>
    <span class="s3"># make some other data (random integers)</span>
    <span class="s1">data_2nd = np.array([[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">1.5</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s1">]])</span>
    <span class="s3"># make the random data expand to the shape of the main data</span>
    <span class="s1">data_2nd = np.repeat(np.repeat(data_2nd</span><span class="s0">, </span><span class="s5">10</span><span class="s0">, </span><span class="s1">axis=</span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s5">10</span><span class="s0">, </span><span class="s1">axis=</span><span class="s5">0</span><span class="s1">)</span>

    <span class="s1">color_mappable = plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s3"># test extend frac here</span>
    <span class="s1">hatch_mappable = plt.contourf(data_2nd</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">colors=</span><span class="s4">'none'</span><span class="s0">,</span>
                                  <span class="s1">hatches=[</span><span class="s4">'/'</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s4">'+'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'max'</span><span class="s1">)</span>
    <span class="s1">plt.contour(hatch_mappable</span><span class="s0">, </span><span class="s1">colors=</span><span class="s4">'black'</span><span class="s1">)</span>

    <span class="s1">plt.colorbar(color_mappable</span><span class="s0">, </span><span class="s1">location=</span><span class="s4">'left'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'variable 1'</span><span class="s0">,</span>
                 <span class="s1">use_gridspec=use_gridspec)</span>
    <span class="s1">plt.colorbar(hatch_mappable</span><span class="s0">, </span><span class="s1">location=</span><span class="s4">'right'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'variable 2'</span><span class="s0">,</span>
                 <span class="s1">use_gridspec=use_gridspec)</span>

    <span class="s3"># -------------------</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">ax1 = plt.subplot(</span><span class="s5">211</span><span class="s0">, </span><span class="s1">anchor=</span><span class="s4">'NE'</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s4">'equal'</span><span class="s1">)</span>
    <span class="s1">plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">ax2 = plt.subplot(</span><span class="s5">223</span><span class="s1">)</span>
    <span class="s1">plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">ax3 = plt.subplot(</span><span class="s5">224</span><span class="s1">)</span>
    <span class="s1">plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>

    <span class="s1">plt.colorbar(ax=[ax2</span><span class="s0">, </span><span class="s1">ax3</span><span class="s0">, </span><span class="s1">ax1]</span><span class="s0">, </span><span class="s1">location=</span><span class="s4">'right'</span><span class="s0">, </span><span class="s1">pad=</span><span class="s5">0.0</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s5">0.5</span><span class="s0">,</span>
                 <span class="s1">panchor=</span><span class="s0">False, </span><span class="s1">use_gridspec=use_gridspec)</span>
    <span class="s1">plt.colorbar(ax=[ax2</span><span class="s0">, </span><span class="s1">ax3</span><span class="s0">, </span><span class="s1">ax1]</span><span class="s0">, </span><span class="s1">location=</span><span class="s4">'left'</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s5">0.5</span><span class="s0">,</span>
                 <span class="s1">panchor=</span><span class="s0">False, </span><span class="s1">use_gridspec=use_gridspec)</span>
    <span class="s1">plt.colorbar(ax=[ax1]</span><span class="s0">, </span><span class="s1">location=</span><span class="s4">'bottom'</span><span class="s0">, </span><span class="s1">panchor=</span><span class="s0">False,</span>
                 <span class="s1">anchor=(</span><span class="s5">0.8</span><span class="s0">, </span><span class="s5">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s5">0.6</span><span class="s0">, </span><span class="s1">use_gridspec=use_gridspec)</span>


<span class="s0">def </span><span class="s1">test_colorbar_single_ax_panchor_false():</span>
    <span class="s3"># Note that this differs from the tests above with panchor=False because</span>
    <span class="s3"># there use_gridspec is actually ineffective: passing *ax* as lists always</span>
    <span class="s3"># disables use_gridspec.</span>
    <span class="s1">ax = plt.subplot(</span><span class="s5">111</span><span class="s0">, </span><span class="s1">anchor=</span><span class="s4">'N'</span><span class="s1">)</span>
    <span class="s1">plt.imshow([[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]])</span>
    <span class="s1">plt.colorbar(panchor=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_anchor() == </span><span class="s4">'N'</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'constrained'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">ids=[</span><span class="s4">'standard'</span><span class="s0">, </span><span class="s4">'constrained'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_single_ax_panchor_east(constrained):</span>
    <span class="s1">fig = plt.figure(constrained_layout=constrained)</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s5">111</span><span class="s0">, </span><span class="s1">anchor=</span><span class="s4">'N'</span><span class="s1">)</span>
    <span class="s1">plt.imshow([[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]])</span>
    <span class="s1">plt.colorbar(panchor=</span><span class="s4">'E'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_anchor() == </span><span class="s4">'E'</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s4">'contour_colorbar.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
    <span class="s1">tol=</span><span class="s5">0.01 </span><span class="s0">if </span><span class="s1">platform.machine() </span><span class="s0">in </span><span class="s1">(</span><span class="s4">'aarch64'</span><span class="s0">, </span><span class="s4">'ppc64le'</span><span class="s0">, </span><span class="s4">'s390x'</span><span class="s1">) </span><span class="s0">else </span><span class="s5">0</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_colorbar():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s5">4</span><span class="s0">, </span><span class="s5">2</span><span class="s1">))</span>
    <span class="s1">data = np.arange(</span><span class="s5">1200</span><span class="s1">).reshape(</span><span class="s5">30</span><span class="s0">, </span><span class="s5">40</span><span class="s1">) - </span><span class="s5">500</span>
    <span class="s1">levels = np.array([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">200</span><span class="s0">, </span><span class="s5">400</span><span class="s0">, </span><span class="s5">600</span><span class="s0">, </span><span class="s5">800</span><span class="s0">, </span><span class="s5">1000</span><span class="s0">, </span><span class="s5">1200</span><span class="s1">]) - </span><span class="s5">500</span>

    <span class="s1">CS = ax.contour(data</span><span class="s0">, </span><span class="s1">levels=levels</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(CS</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(CS</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'cbar_with_subplots_adjust.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s4">'dpi'</span><span class="s1">: </span><span class="s5">40</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_gridspec_make_colorbar():</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">data = np.arange(</span><span class="s5">1200</span><span class="s1">).reshape(</span><span class="s5">30</span><span class="s0">, </span><span class="s5">40</span><span class="s1">)</span>
    <span class="s1">levels = [</span><span class="s5">0</span><span class="s0">, </span><span class="s5">200</span><span class="s0">, </span><span class="s5">400</span><span class="s0">, </span><span class="s5">600</span><span class="s0">, </span><span class="s5">800</span><span class="s0">, </span><span class="s5">1000</span><span class="s0">, </span><span class="s5">1200</span><span class="s1">]</span>

    <span class="s1">plt.subplot(</span><span class="s5">121</span><span class="s1">)</span>
    <span class="s1">plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">plt.colorbar(use_gridspec=</span><span class="s0">True, </span><span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s1">)</span>

    <span class="s1">plt.subplot(</span><span class="s5">122</span><span class="s1">)</span>
    <span class="s1">plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">plt.colorbar(use_gridspec=</span><span class="s0">True, </span><span class="s1">orientation=</span><span class="s4">'horizontal'</span><span class="s1">)</span>

    <span class="s1">plt.subplots_adjust(top=</span><span class="s5">0.95</span><span class="s0">, </span><span class="s1">right=</span><span class="s5">0.95</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s5">0.2</span><span class="s0">, </span><span class="s1">hspace=</span><span class="s5">0.25</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'colorbar_single_scatter.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s4">'dpi'</span><span class="s1">: </span><span class="s5">40</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_colorbar_single_scatter():</span>
    <span class="s3"># Issue #2642: if a path collection has only one entry,</span>
    <span class="s3"># the norm scaling within the colorbar must ensure a</span>
    <span class="s3"># finite range, otherwise a zero denominator will occur in _locate.</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">x = y = [</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s1">z = [</span><span class="s5">50</span><span class="s1">]</span>
    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">'jet'</span><span class="s1">].resampled(</span><span class="s5">16</span><span class="s1">)</span>
    <span class="s1">cs = plt.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">c=z</span><span class="s0">, </span><span class="s1">cmap=cmap)</span>
    <span class="s1">plt.colorbar(cs)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'use_gridspec'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">ids=[</span><span class="s4">'no gridspec'</span><span class="s0">, </span><span class="s4">'with gridspec'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_remove_from_figure(use_gridspec):</span>
    <span class="s2">&quot;&quot;&quot; 
    Test `remove` with the specified ``use_gridspec`` setting 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">sc = ax.scatter([</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s1">])</span>
    <span class="s1">sc.set_array(np.array([</span><span class="s5">5</span><span class="s0">, </span><span class="s5">6</span><span class="s1">]))</span>
    <span class="s1">pre_position = ax.get_position()</span>
    <span class="s1">cb = fig.colorbar(sc</span><span class="s0">, </span><span class="s1">use_gridspec=use_gridspec)</span>
    <span class="s1">fig.subplots_adjust()</span>
    <span class="s1">cb.remove()</span>
    <span class="s1">fig.subplots_adjust()</span>
    <span class="s1">post_position = ax.get_position()</span>
    <span class="s0">assert </span><span class="s1">(pre_position.get_points() == post_position.get_points()).all()</span>


<span class="s0">def </span><span class="s1">test_remove_from_figure_cl():</span>
    <span class="s2">&quot;&quot;&quot; 
    Test `remove` with constrained_layout 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">sc = ax.scatter([</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s1">])</span>
    <span class="s1">sc.set_array(np.array([</span><span class="s5">5</span><span class="s0">, </span><span class="s5">6</span><span class="s1">]))</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">pre_position = ax.get_position()</span>
    <span class="s1">cb = fig.colorbar(sc)</span>
    <span class="s1">cb.remove()</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">post_position = ax.get_position()</span>
    <span class="s1">np.testing.assert_allclose(pre_position.get_points()</span><span class="s0">,</span>
                               <span class="s1">post_position.get_points())</span>


<span class="s0">def </span><span class="s1">test_colorbarbase():</span>
    <span class="s3"># smoke test from #3805</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">Colorbar(ax</span><span class="s0">, </span><span class="s1">cmap=plt.cm.bone)</span>


<span class="s0">def </span><span class="s1">test_parentless_mappable():</span>
    <span class="s1">pc = mpl.collections.PatchCollection([]</span><span class="s0">, </span><span class="s1">cmap=plt.get_cmap(</span><span class="s4">'viridis'</span><span class="s1">))</span>
    <span class="s1">pc.set_array([])</span>

    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s4">'Unable to determine Axes to steal'</span><span class="s1">):</span>
        <span class="s1">plt.colorbar(pc)</span>


<span class="s1">@image_comparison([</span><span class="s4">'colorbar_closed_patch.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_closed_patch():</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">fig = plt.figure(figsize=(</span><span class="s5">8</span><span class="s0">, </span><span class="s5">6</span><span class="s1">))</span>
    <span class="s1">ax1 = fig.add_axes([</span><span class="s5">0.05</span><span class="s0">, </span><span class="s5">0.85</span><span class="s0">, </span><span class="s5">0.9</span><span class="s0">, </span><span class="s5">0.1</span><span class="s1">])</span>
    <span class="s1">ax2 = fig.add_axes([</span><span class="s5">0.1</span><span class="s0">, </span><span class="s5">0.65</span><span class="s0">, </span><span class="s5">0.75</span><span class="s0">, </span><span class="s5">0.1</span><span class="s1">])</span>
    <span class="s1">ax3 = fig.add_axes([</span><span class="s5">0.05</span><span class="s0">, </span><span class="s5">0.45</span><span class="s0">, </span><span class="s5">0.9</span><span class="s0">, </span><span class="s5">0.1</span><span class="s1">])</span>
    <span class="s1">ax4 = fig.add_axes([</span><span class="s5">0.05</span><span class="s0">, </span><span class="s5">0.25</span><span class="s0">, </span><span class="s5">0.9</span><span class="s0">, </span><span class="s5">0.1</span><span class="s1">])</span>
    <span class="s1">ax5 = fig.add_axes([</span><span class="s5">0.05</span><span class="s0">, </span><span class="s5">0.05</span><span class="s0">, </span><span class="s5">0.9</span><span class="s0">, </span><span class="s5">0.1</span><span class="s1">])</span>

    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">&quot;RdBu&quot;</span><span class="s1">].resampled(</span><span class="s5">5</span><span class="s1">)</span>

    <span class="s1">im = ax1.pcolormesh(np.linspace(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">10</span><span class="s0">, </span><span class="s5">16</span><span class="s1">).reshape((</span><span class="s5">4</span><span class="s0">, </span><span class="s5">4</span><span class="s1">))</span><span class="s0">, </span><span class="s1">cmap=cmap)</span>

    <span class="s3"># The use of a &quot;values&quot; kwarg here is unusual.  It works only</span>
    <span class="s3"># because it is matched to the data range in the image and to</span>
    <span class="s3"># the number of colors in the LUT.</span>
    <span class="s1">values = np.linspace(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">10</span><span class="s0">, </span><span class="s5">5</span><span class="s1">)</span>
    <span class="s1">cbar_kw = dict(orientation=</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s1">values=values</span><span class="s0">, </span><span class="s1">ticks=[])</span>

    <span class="s3"># The wide line is to show that the closed path is being handled</span>
    <span class="s3"># correctly.  See PR #4186.</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s4">'axes.linewidth'</span><span class="s1">: </span><span class="s5">16</span><span class="s1">}):</span>
        <span class="s1">plt.colorbar(im</span><span class="s0">, </span><span class="s1">cax=ax2</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">, </span><span class="s1">extendfrac=</span><span class="s5">0.5</span><span class="s0">, </span><span class="s1">**cbar_kw)</span>
        <span class="s1">plt.colorbar(im</span><span class="s0">, </span><span class="s1">cax=ax3</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">, </span><span class="s1">**cbar_kw)</span>
        <span class="s1">plt.colorbar(im</span><span class="s0">, </span><span class="s1">cax=ax4</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">, </span><span class="s1">extendrect=</span><span class="s0">True, </span><span class="s1">**cbar_kw)</span>
        <span class="s1">plt.colorbar(im</span><span class="s0">, </span><span class="s1">cax=ax5</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'neither'</span><span class="s0">, </span><span class="s1">**cbar_kw)</span>


<span class="s0">def </span><span class="s1">test_colorbar_ticks():</span>
    <span class="s3"># test fix for #5673</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(-</span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">4.001</span><span class="s1">)</span>
    <span class="s1">y = np.arange(-</span><span class="s5">4.0</span><span class="s0">, </span><span class="s5">3.001</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z = X * Y</span>
    <span class="s1">clevs = np.array([-</span><span class="s5">12</span><span class="s0">, </span><span class="s1">-</span><span class="s5">5</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=float)</span>
    <span class="s1">colors = [</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s0">, </span><span class="s4">'c'</span><span class="s1">]</span>
    <span class="s1">cs = ax.contourf(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">clevs</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'neither'</span><span class="s1">)</span>
    <span class="s1">cbar = fig.colorbar(cs</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s1">ticks=clevs)</span>
    <span class="s0">assert </span><span class="s1">len(cbar.ax.xaxis.get_ticklocs()) == len(clevs)</span>


<span class="s0">def </span><span class="s1">test_colorbar_minorticks_on_off():</span>
    <span class="s3"># test for github issue #11510 and PR #11584</span>
    <span class="s1">np.random.seed(seed=</span><span class="s5">12345</span><span class="s1">)</span>
    <span class="s1">data = np.random.randn(</span><span class="s5">20</span><span class="s0">, </span><span class="s5">20</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s4">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s3"># purposefully setting vmin and vmax to odd fractions</span>
        <span class="s3"># so as to check for the correct locations of the minor ticks</span>
        <span class="s1">im = ax.pcolormesh(data</span><span class="s0">, </span><span class="s1">vmin=-</span><span class="s5">2.3</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s5">3.3</span><span class="s1">)</span>

        <span class="s1">cbar = fig.colorbar(im</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
        <span class="s3"># testing after minorticks_on()</span>
        <span class="s1">cbar.minorticks_on()</span>
        <span class="s1">np.testing.assert_almost_equal(</span>
            <span class="s1">cbar.ax.yaxis.get_minorticklocs()</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s5">2.2</span><span class="s0">, </span><span class="s1">-</span><span class="s5">1.8</span><span class="s0">, </span><span class="s1">-</span><span class="s5">1.6</span><span class="s0">, </span><span class="s1">-</span><span class="s5">1.4</span><span class="s0">, </span><span class="s1">-</span><span class="s5">1.2</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.8</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.6</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.4</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.2</span><span class="s0">,</span>
             <span class="s5">0.2</span><span class="s0">, </span><span class="s5">0.4</span><span class="s0">, </span><span class="s5">0.6</span><span class="s0">, </span><span class="s5">0.8</span><span class="s0">, </span><span class="s5">1.2</span><span class="s0">, </span><span class="s5">1.4</span><span class="s0">, </span><span class="s5">1.6</span><span class="s0">, </span><span class="s5">1.8</span><span class="s0">, </span><span class="s5">2.2</span><span class="s0">, </span><span class="s5">2.4</span><span class="s0">, </span><span class="s5">2.6</span><span class="s0">, </span><span class="s5">2.8</span><span class="s0">, </span><span class="s5">3.2</span><span class="s1">])</span>
        <span class="s3"># testing after minorticks_off()</span>
        <span class="s1">cbar.minorticks_off()</span>
        <span class="s1">np.testing.assert_almost_equal(cbar.ax.yaxis.get_minorticklocs()</span><span class="s0">, </span><span class="s1">[])</span>

        <span class="s1">im.set_clim(vmin=-</span><span class="s5">1.2</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s5">1.2</span><span class="s1">)</span>
        <span class="s1">cbar.minorticks_on()</span>
        <span class="s1">np.testing.assert_almost_equal(</span>
            <span class="s1">cbar.ax.yaxis.get_minorticklocs()</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s5">1.1</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.9</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.8</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.7</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.6</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.4</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.3</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.2</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.1</span><span class="s0">,</span>
             <span class="s5">0.1</span><span class="s0">, </span><span class="s5">0.2</span><span class="s0">, </span><span class="s5">0.3</span><span class="s0">, </span><span class="s5">0.4</span><span class="s0">, </span><span class="s5">0.6</span><span class="s0">, </span><span class="s5">0.7</span><span class="s0">, </span><span class="s5">0.8</span><span class="s0">, </span><span class="s5">0.9</span><span class="s0">, </span><span class="s5">1.1</span><span class="s0">, </span><span class="s5">1.2</span><span class="s0">, </span><span class="s5">1.3</span><span class="s1">])</span>

    <span class="s3"># tests for github issue #13257 and PR #13265</span>
    <span class="s1">data = np.random.uniform(low=</span><span class="s5">1</span><span class="s0">, </span><span class="s1">high=</span><span class="s5">10</span><span class="s0">, </span><span class="s1">size=(</span><span class="s5">20</span><span class="s0">, </span><span class="s5">20</span><span class="s1">))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.pcolormesh(data</span><span class="s0">, </span><span class="s1">norm=LogNorm())</span>
    <span class="s1">cbar = fig.colorbar(im)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">default_minorticklocks = cbar.ax.yaxis.get_minorticklocs()</span>
    <span class="s3"># test that minorticks turn off for LogNorm</span>
    <span class="s1">cbar.minorticks_off()</span>
    <span class="s1">np.testing.assert_equal(cbar.ax.yaxis.get_minorticklocs()</span><span class="s0">, </span><span class="s1">[])</span>

    <span class="s3"># test that minorticks turn back on for LogNorm</span>
    <span class="s1">cbar.minorticks_on()</span>
    <span class="s1">np.testing.assert_equal(cbar.ax.yaxis.get_minorticklocs()</span><span class="s0">,</span>
                            <span class="s1">default_minorticklocks)</span>

    <span class="s3"># test issue #13339: minorticks for LogNorm should stay off</span>
    <span class="s1">cbar.minorticks_off()</span>
    <span class="s1">cbar.set_ticks([</span><span class="s5">3</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">7</span><span class="s0">, </span><span class="s5">9</span><span class="s1">])</span>
    <span class="s1">np.testing.assert_equal(cbar.ax.yaxis.get_minorticklocs()</span><span class="s0">, </span><span class="s1">[])</span>


<span class="s0">def </span><span class="s1">test_cbar_minorticks_for_rc_xyminortickvisible():</span>
    <span class="s2">&quot;&quot;&quot; 
    issue gh-16468. 
 
    Making sure that minor ticks on the colorbar are turned on 
    (internally) using the cbar.minorticks_on() method when 
    rcParams['xtick.minor.visible'] = True (for horizontal cbar) 
    rcParams['ytick.minor.visible'] = True (for vertical cbar). 
    Using cbar.minorticks_on() ensures that the minor ticks 
    don't overflow into the extend regions of the colorbar. 
    &quot;&quot;&quot;</span>

    <span class="s1">plt.rcParams[</span><span class="s4">'ytick.minor.visible'</span><span class="s1">] = </span><span class="s0">True</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'xtick.minor.visible'</span><span class="s1">] = </span><span class="s0">True</span>

    <span class="s1">vmin</span><span class="s0">, </span><span class="s1">vmax = </span><span class="s5">0.4</span><span class="s0">, </span><span class="s5">2.6</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.pcolormesh([[</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">vmin=vmin</span><span class="s0">, </span><span class="s1">vmax=vmax)</span>

    <span class="s1">cbar = fig.colorbar(im</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.yaxis.get_minorticklocs()[</span><span class="s5">0</span><span class="s1">] &gt;= vmin</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.yaxis.get_minorticklocs()[-</span><span class="s5">1</span><span class="s1">] &lt;= vmax</span>

    <span class="s1">cbar = fig.colorbar(im</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s4">'horizontal'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.xaxis.get_minorticklocs()[</span><span class="s5">0</span><span class="s1">] &gt;= vmin</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.xaxis.get_minorticklocs()[-</span><span class="s5">1</span><span class="s1">] &lt;= vmax</span>


<span class="s0">def </span><span class="s1">test_colorbar_autoticks():</span>
    <span class="s3"># Test new autotick modes. Needs to be classic because</span>
    <span class="s3"># non-classic doesn't go this route.</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s4">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">x = np.arange(-</span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">4.001</span><span class="s1">)</span>
        <span class="s1">y = np.arange(-</span><span class="s5">4.0</span><span class="s0">, </span><span class="s5">3.001</span><span class="s1">)</span>
        <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">Z = X * Y</span>
        <span class="s1">Z = Z[:-</span><span class="s5">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s5">1</span><span class="s1">]</span>
        <span class="s1">pcm = ax[</span><span class="s5">0</span><span class="s1">].pcolormesh(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z)</span>
        <span class="s1">cbar = fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">,</span>
                            <span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s1">)</span>

        <span class="s1">pcm = ax[</span><span class="s5">1</span><span class="s1">].pcolormesh(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z)</span>
        <span class="s1">cbar2 = fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">,</span>
                             <span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s5">0.4</span><span class="s1">)</span>
        <span class="s3"># note only -10 to 10 are visible,</span>
        <span class="s1">np.testing.assert_almost_equal(cbar.ax.yaxis.get_ticklocs()</span><span class="s0">,</span>
                                       <span class="s1">np.arange(-</span><span class="s5">15</span><span class="s0">, </span><span class="s5">16</span><span class="s0">, </span><span class="s5">5</span><span class="s1">))</span>
        <span class="s3"># note only -10 to 10 are visible</span>
        <span class="s1">np.testing.assert_almost_equal(cbar2.ax.yaxis.get_ticklocs()</span><span class="s0">,</span>
                                       <span class="s1">np.arange(-</span><span class="s5">20</span><span class="s0">, </span><span class="s5">21</span><span class="s0">, </span><span class="s5">10</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_colorbar_autotickslog():</span>
    <span class="s3"># Test new autotick modes...</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s4">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">x = np.arange(-</span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">4.001</span><span class="s1">)</span>
        <span class="s1">y = np.arange(-</span><span class="s5">4.0</span><span class="s0">, </span><span class="s5">3.001</span><span class="s1">)</span>
        <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">Z = X * Y</span>
        <span class="s1">Z = Z[:-</span><span class="s5">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s5">1</span><span class="s1">]</span>
        <span class="s1">pcm = ax[</span><span class="s5">0</span><span class="s1">].pcolormesh(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s5">10</span><span class="s1">**Z</span><span class="s0">, </span><span class="s1">norm=LogNorm())</span>
        <span class="s1">cbar = fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">,</span>
                            <span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s1">)</span>

        <span class="s1">pcm = ax[</span><span class="s5">1</span><span class="s1">].pcolormesh(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s5">10</span><span class="s1">**Z</span><span class="s0">, </span><span class="s1">norm=LogNorm())</span>
        <span class="s1">cbar2 = fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">,</span>
                             <span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s5">0.4</span><span class="s1">)</span>
        <span class="s3"># note only -12 to +12 are visible</span>
        <span class="s1">np.testing.assert_almost_equal(cbar.ax.yaxis.get_ticklocs()</span><span class="s0">,</span>
                                       <span class="s5">10</span><span class="s1">**np.arange(-</span><span class="s5">16.</span><span class="s0">, </span><span class="s5">16.2</span><span class="s0">, </span><span class="s5">4.</span><span class="s1">))</span>
        <span class="s3"># note only -24 to +24 are visible</span>
        <span class="s1">np.testing.assert_almost_equal(cbar2.ax.yaxis.get_ticklocs()</span><span class="s0">,</span>
                                       <span class="s5">10</span><span class="s1">**np.arange(-</span><span class="s5">24.</span><span class="s0">, </span><span class="s5">25.</span><span class="s0">, </span><span class="s5">12.</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_colorbar_get_ticks():</span>
    <span class="s3"># test feature for #5792</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">data = np.arange(</span><span class="s5">1200</span><span class="s1">).reshape(</span><span class="s5">30</span><span class="s0">, </span><span class="s5">40</span><span class="s1">)</span>
    <span class="s1">levels = [</span><span class="s5">0</span><span class="s0">, </span><span class="s5">200</span><span class="s0">, </span><span class="s5">400</span><span class="s0">, </span><span class="s5">600</span><span class="s0">, </span><span class="s5">800</span><span class="s0">, </span><span class="s5">1000</span><span class="s0">, </span><span class="s5">1200</span><span class="s1">]</span>

    <span class="s1">plt.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>

    <span class="s3"># testing getter for user set ticks</span>
    <span class="s1">userTicks = plt.colorbar(ticks=[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">600</span><span class="s0">, </span><span class="s5">1200</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">userTicks.get_ticks().tolist() == [</span><span class="s5">0</span><span class="s0">, </span><span class="s5">600</span><span class="s0">, </span><span class="s5">1200</span><span class="s1">]</span>

    <span class="s3"># testing for getter after calling set_ticks</span>
    <span class="s1">userTicks.set_ticks([</span><span class="s5">600</span><span class="s0">, </span><span class="s5">700</span><span class="s0">, </span><span class="s5">800</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">userTicks.get_ticks().tolist() == [</span><span class="s5">600</span><span class="s0">, </span><span class="s5">700</span><span class="s0">, </span><span class="s5">800</span><span class="s1">]</span>

    <span class="s3"># testing for getter after calling set_ticks with some ticks out of bounds</span>
    <span class="s3"># removed #20054: other axes don't trim fixed lists, so colorbars</span>
    <span class="s3"># should not either:</span>
    <span class="s3"># userTicks.set_ticks([600, 1300, 1400, 1500])</span>
    <span class="s3"># assert userTicks.get_ticks().tolist() == [600]</span>

    <span class="s3"># testing getter when no ticks are assigned</span>
    <span class="s1">defTicks = plt.colorbar(orientation=</span><span class="s4">'horizontal'</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(defTicks.get_ticks().tolist()</span><span class="s0">, </span><span class="s1">levels)</span>

    <span class="s3"># test normal ticks and minor ticks</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(-</span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">4.001</span><span class="s1">)</span>
    <span class="s1">y = np.arange(-</span><span class="s5">4.0</span><span class="s0">, </span><span class="s5">3.001</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z = X * Y</span>
    <span class="s1">Z = Z[:-</span><span class="s5">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s5">1</span><span class="s1">]</span>
    <span class="s1">pcm = ax.pcolormesh(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z)</span>
    <span class="s1">cbar = fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">,</span>
                        <span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s1">)</span>
    <span class="s1">ticks = cbar.get_ticks()</span>
    <span class="s1">np.testing.assert_allclose(ticks</span><span class="s0">, </span><span class="s1">np.arange(-</span><span class="s5">15</span><span class="s0">, </span><span class="s5">16</span><span class="s0">, </span><span class="s5">5</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">len(cbar.get_ticks(minor=</span><span class="s0">True</span><span class="s1">)) == </span><span class="s5">0</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;extend&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'both'</span><span class="s0">, </span><span class="s4">'min'</span><span class="s0">, </span><span class="s4">'max'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_lognorm_extension(extend):</span>
    <span class="s3"># Test that colorbar with lognorm is extended correctly</span>
    <span class="s1">f</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cb = Colorbar(ax</span><span class="s0">, </span><span class="s1">norm=LogNorm(vmin=</span><span class="s5">0.1</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s5">1000.0</span><span class="s1">)</span><span class="s0">,</span>
                  <span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s0">, </span><span class="s1">extend=extend)</span>
    <span class="s0">assert </span><span class="s1">cb._values[</span><span class="s5">0</span><span class="s1">] &gt;= </span><span class="s5">0.0</span>


<span class="s0">def </span><span class="s1">test_colorbar_powernorm_extension():</span>
    <span class="s3"># Test that colorbar with powernorm is extended correctly</span>
    <span class="s1">f</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cb = Colorbar(ax</span><span class="s0">, </span><span class="s1">norm=PowerNorm(gamma=</span><span class="s5">0.5</span><span class="s0">, </span><span class="s1">vmin=</span><span class="s5">0.0</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s5">1.0</span><span class="s1">)</span><span class="s0">,</span>
                  <span class="s1">orientation=</span><span class="s4">'vertical'</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cb._values[</span><span class="s5">0</span><span class="s1">] &gt;= </span><span class="s5">0.0</span>


<span class="s0">def </span><span class="s1">test_colorbar_axes_kw():</span>
    <span class="s3"># test fix for #8493: This does only test, that axes-related keywords pass</span>
    <span class="s3"># and do not raise an exception.</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.imshow([[</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s1">]])</span>
    <span class="s1">plt.colorbar(orientation=</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s1">fraction=</span><span class="s5">0.2</span><span class="s0">, </span><span class="s1">pad=</span><span class="s5">0.2</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s5">0.5</span><span class="s0">,</span>
                 <span class="s1">aspect=</span><span class="s5">10</span><span class="s0">, </span><span class="s1">anchor=(</span><span class="s5">0.</span><span class="s0">, </span><span class="s5">0.</span><span class="s1">)</span><span class="s0">, </span><span class="s1">panchor=(</span><span class="s5">0.</span><span class="s0">, </span><span class="s5">1.</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_colorbar_log_minortick_labels():</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s4">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">pcm = ax.imshow([[</span><span class="s5">10000</span><span class="s0">, </span><span class="s5">50000</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">norm=LogNorm())</span>
        <span class="s1">cb = fig.colorbar(pcm)</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">lb = [l.get_text() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">cb.ax.yaxis.get_ticklabels(which=</span><span class="s4">'both'</span><span class="s1">)]</span>
        <span class="s1">expected = [</span><span class="s4">r'$\mathdefault{10^{4}}$'</span><span class="s0">,</span>
                    <span class="s4">r'$\mathdefault{2\times10^{4}}$'</span><span class="s0">,</span>
                    <span class="s4">r'$\mathdefault{3\times10^{4}}$'</span><span class="s0">,</span>
                    <span class="s4">r'$\mathdefault{4\times10^{4}}$'</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">exp </span><span class="s0">in </span><span class="s1">expected:</span>
            <span class="s0">assert </span><span class="s1">exp </span><span class="s0">in </span><span class="s1">lb</span>


<span class="s0">def </span><span class="s1">test_colorbar_renorm():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.ogrid[-</span><span class="s5">4</span><span class="s1">:</span><span class="s5">4</span><span class="s1">:</span><span class="s5">31j</span><span class="s0">, </span><span class="s1">-</span><span class="s5">4</span><span class="s1">:</span><span class="s5">4</span><span class="s1">:</span><span class="s5">31j</span><span class="s1">]</span>
    <span class="s1">z = </span><span class="s5">120000</span><span class="s1">*np.exp(-x**</span><span class="s5">2 </span><span class="s1">- y**</span><span class="s5">2</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.imshow(z)</span>
    <span class="s1">cbar = fig.colorbar(im)</span>
    <span class="s1">np.testing.assert_allclose(cbar.ax.yaxis.get_majorticklocs()</span><span class="s0">,</span>
                               <span class="s1">np.arange(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">120000.1</span><span class="s0">, </span><span class="s5">20000</span><span class="s1">))</span>

    <span class="s1">cbar.set_ticks([</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">isinstance(cbar.locator</span><span class="s0">, </span><span class="s1">FixedLocator)</span>

    <span class="s1">norm = LogNorm(z.min()</span><span class="s0">, </span><span class="s1">z.max())</span>
    <span class="s1">im.set_norm(norm)</span>
    <span class="s1">np.testing.assert_allclose(cbar.ax.yaxis.get_majorticklocs()</span><span class="s0">,</span>
                               <span class="s1">np.logspace(-</span><span class="s5">10</span><span class="s0">, </span><span class="s5">7</span><span class="s0">, </span><span class="s5">18</span><span class="s1">))</span>
    <span class="s3"># note that set_norm removes the FixedLocator...</span>
    <span class="s0">assert </span><span class="s1">np.isclose(cbar.vmin</span><span class="s0">, </span><span class="s1">z.min())</span>
    <span class="s1">cbar.set_ticks([</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">isinstance(cbar.locator</span><span class="s0">, </span><span class="s1">FixedLocator)</span>
    <span class="s1">np.testing.assert_allclose(cbar.ax.yaxis.get_majorticklocs()</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s5">1.0</span><span class="s0">, </span><span class="s5">2.0</span><span class="s0">, </span><span class="s5">3.0</span><span class="s1">])</span>

    <span class="s1">norm = LogNorm(z.min() * </span><span class="s5">1000</span><span class="s0">, </span><span class="s1">z.max() * </span><span class="s5">1000</span><span class="s1">)</span>
    <span class="s1">im.set_norm(norm)</span>
    <span class="s0">assert </span><span class="s1">np.isclose(cbar.vmin</span><span class="s0">, </span><span class="s1">z.min() * </span><span class="s5">1000</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">np.isclose(cbar.vmax</span><span class="s0">, </span><span class="s1">z.max() * </span><span class="s5">1000</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'fmt'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'%4.2e'</span><span class="s0">, </span><span class="s4">'{x:.2e}'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_format(fmt):</span>
    <span class="s3"># make sure that format is passed properly</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.ogrid[-</span><span class="s5">4</span><span class="s1">:</span><span class="s5">4</span><span class="s1">:</span><span class="s5">31j</span><span class="s0">, </span><span class="s1">-</span><span class="s5">4</span><span class="s1">:</span><span class="s5">4</span><span class="s1">:</span><span class="s5">31j</span><span class="s1">]</span>
    <span class="s1">z = </span><span class="s5">120000</span><span class="s1">*np.exp(-x**</span><span class="s5">2 </span><span class="s1">- y**</span><span class="s5">2</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.imshow(z)</span>
    <span class="s1">cbar = fig.colorbar(im</span><span class="s0">, </span><span class="s1">format=fmt)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.yaxis.get_ticklabels()[</span><span class="s5">4</span><span class="s1">].get_text() == </span><span class="s4">'8.00e+04'</span>

    <span class="s3"># make sure that if we change the clim of the mappable that the</span>
    <span class="s3"># formatting is *not* lost:</span>
    <span class="s1">im.set_clim([</span><span class="s5">4</span><span class="s0">, </span><span class="s5">200</span><span class="s1">])</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.yaxis.get_ticklabels()[</span><span class="s5">4</span><span class="s1">].get_text() == </span><span class="s4">'2.00e+02'</span>

    <span class="s3"># but if we change the norm:</span>
    <span class="s1">im.set_norm(LogNorm(vmin=</span><span class="s5">0.1</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s5">10</span><span class="s1">))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">(cbar.ax.yaxis.get_ticklabels()[</span><span class="s5">0</span><span class="s1">].get_text() ==</span>
            <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{10^{-2}}$'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_scale_reset():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.ogrid[-</span><span class="s5">4</span><span class="s1">:</span><span class="s5">4</span><span class="s1">:</span><span class="s5">31j</span><span class="s0">, </span><span class="s1">-</span><span class="s5">4</span><span class="s1">:</span><span class="s5">4</span><span class="s1">:</span><span class="s5">31j</span><span class="s1">]</span>
    <span class="s1">z = </span><span class="s5">120000</span><span class="s1">*np.exp(-x**</span><span class="s5">2 </span><span class="s1">- y**</span><span class="s5">2</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">pcm = ax.pcolormesh(z</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s0">, </span><span class="s1">rasterized=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">cbar = fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax)</span>
    <span class="s1">cbar.outline.set_edgecolor(</span><span class="s4">'red'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.yaxis.get_scale() == </span><span class="s4">'linear'</span>

    <span class="s1">pcm.set_norm(LogNorm(vmin=</span><span class="s5">1</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s5">100</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.yaxis.get_scale() == </span><span class="s4">'log'</span>
    <span class="s1">pcm.set_norm(Normalize(vmin=-</span><span class="s5">20</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s5">20</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.yaxis.get_scale() == </span><span class="s4">'linear'</span>

    <span class="s0">assert </span><span class="s1">cbar.outline.get_edgecolor() == mcolors.to_rgba(</span><span class="s4">'red'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_get_ticks_2():</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'_internal.classic_mode'</span><span class="s1">] = </span><span class="s0">False</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">pc = ax.pcolormesh([[</span><span class="s5">.05</span><span class="s0">, </span><span class="s5">.95</span><span class="s1">]])</span>
    <span class="s1">cb = fig.colorbar(pc)</span>
    <span class="s1">np.testing.assert_allclose(cb.get_ticks()</span><span class="s0">, </span><span class="s1">[</span><span class="s5">0.</span><span class="s0">, </span><span class="s5">0.2</span><span class="s0">, </span><span class="s5">0.4</span><span class="s0">, </span><span class="s5">0.6</span><span class="s0">, </span><span class="s5">0.8</span><span class="s0">, </span><span class="s5">1.0</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_colorbar_inverted_ticks():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s1">ax = axs[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s1">pc = ax.pcolormesh(</span><span class="s5">10</span><span class="s1">**np.arange(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s1">).reshape(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">norm=LogNorm())</span>
    <span class="s1">cbar = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s1">ticks = cbar.get_ticks()</span>
    <span class="s1">cbar.ax.invert_yaxis()</span>
    <span class="s1">np.testing.assert_allclose(ticks</span><span class="s0">, </span><span class="s1">cbar.get_ticks())</span>

    <span class="s1">ax = axs[</span><span class="s5">1</span><span class="s1">]</span>
    <span class="s1">pc = ax.pcolormesh(np.arange(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s1">).reshape(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">2</span><span class="s1">))</span>
    <span class="s1">cbar = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s1">cbar.minorticks_on()</span>
    <span class="s1">ticks = cbar.get_ticks()</span>
    <span class="s1">minorticks = cbar.get_ticks(minor=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(minorticks</span><span class="s0">, </span><span class="s1">np.ndarray)</span>
    <span class="s1">cbar.ax.invert_yaxis()</span>
    <span class="s1">np.testing.assert_allclose(ticks</span><span class="s0">, </span><span class="s1">cbar.get_ticks())</span>
    <span class="s1">np.testing.assert_allclose(minorticks</span><span class="s0">, </span><span class="s1">cbar.get_ticks(minor=</span><span class="s0">True</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_mappable_no_alpha():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">sm = cm.ScalarMappable(norm=mcolors.Normalize()</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'viridis'</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(sm</span><span class="s0">, </span><span class="s1">ax=ax)</span>
    <span class="s1">sm.set_cmap(</span><span class="s4">'plasma'</span><span class="s1">)</span>
    <span class="s1">plt.draw()</span>


<span class="s0">def </span><span class="s1">test_mappable_2d_alpha():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">5</span><span class="s1">).reshape(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">2</span><span class="s1">)/</span><span class="s5">4</span>
    <span class="s1">pc = ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">alpha=x)</span>
    <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax)</span>
    <span class="s3"># The colorbar's alpha should be None and the mappable should still have</span>
    <span class="s3"># the original alpha array</span>
    <span class="s0">assert </span><span class="s1">cb.alpha </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">pc.get_alpha() </span><span class="s0">is </span><span class="s1">x</span>
    <span class="s1">fig.draw_without_rendering()</span>


<span class="s0">def </span><span class="s1">test_colorbar_label():</span>
    <span class="s2">&quot;&quot;&quot; 
    Test the label parameter. It should just be mapped to the xlabel/ylabel of 
    the axes, depending on the orientation. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.imshow([[</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s1">]])</span>
    <span class="s1">cbar = fig.colorbar(im</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'cbar'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.get_ylabel() == </span><span class="s4">'cbar'</span>
    <span class="s1">cbar.set_label(</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.get_ylabel() == </span><span class="s4">''</span>
    <span class="s1">cbar.set_label(</span><span class="s4">'cbar 2'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.get_ylabel() == </span><span class="s4">'cbar 2'</span>

    <span class="s1">cbar2 = fig.colorbar(im</span><span class="s0">, </span><span class="s1">label=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cbar2.ax.get_ylabel() == </span><span class="s4">''</span>

    <span class="s1">cbar3 = fig.colorbar(im</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'horizontal cbar'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cbar3.ax.get_xlabel() == </span><span class="s4">'horizontal cbar'</span>


<span class="s1">@image_comparison([</span><span class="s4">'colorbar_keeping_xlabel.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s4">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_keeping_xlabel():</span>
    <span class="s3"># github issue #23398 - xlabels being ignored in colorbar axis</span>
    <span class="s1">arr = np.arange(</span><span class="s5">25</span><span class="s1">).reshape((</span><span class="s5">5</span><span class="s0">, </span><span class="s5">5</span><span class="s1">))</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.imshow(arr)</span>
    <span class="s1">cbar = plt.colorbar(im)</span>
    <span class="s1">cbar.ax.set_xlabel(</span><span class="s4">'Visible Xlabel'</span><span class="s1">)</span>
    <span class="s1">cbar.set_label(</span><span class="s4">'YLabel'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;clim&quot;</span><span class="s0">, </span><span class="s1">[(-</span><span class="s5">20000</span><span class="s0">, </span><span class="s5">20000</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s5">32768</span><span class="s0">, </span><span class="s5">0</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_colorbar_int(clim):</span>
    <span class="s3"># Check that we cast to float early enough to not</span>
    <span class="s3"># overflow ``int16(20000) - int16(-20000)`` or</span>
    <span class="s3"># run into ``abs(int16(-32768)) == -32768``.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.imshow([[*map(np.int16</span><span class="s0">, </span><span class="s1">clim)]])</span>
    <span class="s1">fig.colorbar(im)</span>
    <span class="s0">assert </span><span class="s1">(im.norm.vmin</span><span class="s0">, </span><span class="s1">im.norm.vmax) == clim</span>


<span class="s0">def </span><span class="s1">test_anchored_cbar_position_using_specgrid():</span>
    <span class="s1">data = np.arange(</span><span class="s5">1200</span><span class="s1">).reshape(</span><span class="s5">30</span><span class="s0">, </span><span class="s5">40</span><span class="s1">)</span>
    <span class="s1">levels = [</span><span class="s5">0</span><span class="s0">, </span><span class="s5">200</span><span class="s0">, </span><span class="s5">400</span><span class="s0">, </span><span class="s5">600</span><span class="s0">, </span><span class="s5">800</span><span class="s0">, </span><span class="s5">1000</span><span class="s0">, </span><span class="s5">1200</span><span class="s1">]</span>
    <span class="s1">shrink = </span><span class="s5">0.5</span>
    <span class="s1">anchor_y = </span><span class="s5">0.3</span>
    <span class="s3"># right</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cs = ax.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">cbar = plt.colorbar(</span>
            <span class="s1">cs</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">use_gridspec=</span><span class="s0">True,</span>
            <span class="s1">location=</span><span class="s4">'right'</span><span class="s0">, </span><span class="s1">anchor=(</span><span class="s5">1</span><span class="s0">, </span><span class="s1">anchor_y)</span><span class="s0">, </span><span class="s1">shrink=shrink)</span>

    <span class="s3"># the bottom left corner of one ax is (x0, y0)</span>
    <span class="s3"># the top right corner of one ax is (x1, y1)</span>
    <span class="s3"># p0: the vertical / horizontal position of anchor</span>
    <span class="s1">x0</span><span class="s0">, </span><span class="s1">y0</span><span class="s0">, </span><span class="s1">x1</span><span class="s0">, </span><span class="s1">y1 = ax.get_position().extents</span>
    <span class="s1">cx0</span><span class="s0">, </span><span class="s1">cy0</span><span class="s0">, </span><span class="s1">cx1</span><span class="s0">, </span><span class="s1">cy1 = cbar.ax.get_position().extents</span>
    <span class="s1">p0 = (y1 - y0) * anchor_y + y0</span>

    <span class="s1">np.testing.assert_allclose(</span>
            <span class="s1">[cy1</span><span class="s0">, </span><span class="s1">cy0]</span><span class="s0">,</span>
            <span class="s1">[y1 * shrink + (</span><span class="s5">1 </span><span class="s1">- shrink) * p0</span><span class="s0">, </span><span class="s1">p0 * (</span><span class="s5">1 </span><span class="s1">- shrink) + y0 * shrink])</span>

    <span class="s3"># left</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cs = ax.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">cbar = plt.colorbar(</span>
            <span class="s1">cs</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">use_gridspec=</span><span class="s0">True,</span>
            <span class="s1">location=</span><span class="s4">'left'</span><span class="s0">, </span><span class="s1">anchor=(</span><span class="s5">1</span><span class="s0">, </span><span class="s1">anchor_y)</span><span class="s0">, </span><span class="s1">shrink=shrink)</span>

    <span class="s3"># the bottom left corner of one ax is (x0, y0)</span>
    <span class="s3"># the top right corner of one ax is (x1, y1)</span>
    <span class="s3"># p0: the vertical / horizontal position of anchor</span>
    <span class="s1">x0</span><span class="s0">, </span><span class="s1">y0</span><span class="s0">, </span><span class="s1">x1</span><span class="s0">, </span><span class="s1">y1 = ax.get_position().extents</span>
    <span class="s1">cx0</span><span class="s0">, </span><span class="s1">cy0</span><span class="s0">, </span><span class="s1">cx1</span><span class="s0">, </span><span class="s1">cy1 = cbar.ax.get_position().extents</span>
    <span class="s1">p0 = (y1 - y0) * anchor_y + y0</span>

    <span class="s1">np.testing.assert_allclose(</span>
            <span class="s1">[cy1</span><span class="s0">, </span><span class="s1">cy0]</span><span class="s0">,</span>
            <span class="s1">[y1 * shrink + (</span><span class="s5">1 </span><span class="s1">- shrink) * p0</span><span class="s0">, </span><span class="s1">p0 * (</span><span class="s5">1 </span><span class="s1">- shrink) + y0 * shrink])</span>

    <span class="s3"># top</span>
    <span class="s1">shrink = </span><span class="s5">0.5</span>
    <span class="s1">anchor_x = </span><span class="s5">0.3</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cs = ax.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">cbar = plt.colorbar(</span>
            <span class="s1">cs</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">use_gridspec=</span><span class="s0">True,</span>
            <span class="s1">location=</span><span class="s4">'top'</span><span class="s0">, </span><span class="s1">anchor=(anchor_x</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">shrink=shrink)</span>

    <span class="s3"># the bottom left corner of one ax is (x0, y0)</span>
    <span class="s3"># the top right corner of one ax is (x1, y1)</span>
    <span class="s3"># p0: the vertical / horizontal position of anchor</span>
    <span class="s1">x0</span><span class="s0">, </span><span class="s1">y0</span><span class="s0">, </span><span class="s1">x1</span><span class="s0">, </span><span class="s1">y1 = ax.get_position().extents</span>
    <span class="s1">cx0</span><span class="s0">, </span><span class="s1">cy0</span><span class="s0">, </span><span class="s1">cx1</span><span class="s0">, </span><span class="s1">cy1 = cbar.ax.get_position().extents</span>
    <span class="s1">p0 = (x1 - x0) * anchor_x + x0</span>

    <span class="s1">np.testing.assert_allclose(</span>
            <span class="s1">[cx1</span><span class="s0">, </span><span class="s1">cx0]</span><span class="s0">,</span>
            <span class="s1">[x1 * shrink + (</span><span class="s5">1 </span><span class="s1">- shrink) * p0</span><span class="s0">, </span><span class="s1">p0 * (</span><span class="s5">1 </span><span class="s1">- shrink) + x0 * shrink])</span>

    <span class="s3"># bottom</span>
    <span class="s1">shrink = </span><span class="s5">0.5</span>
    <span class="s1">anchor_x = </span><span class="s5">0.3</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cs = ax.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels)</span>
    <span class="s1">cbar = plt.colorbar(</span>
            <span class="s1">cs</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">use_gridspec=</span><span class="s0">True,</span>
            <span class="s1">location=</span><span class="s4">'bottom'</span><span class="s0">, </span><span class="s1">anchor=(anchor_x</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">shrink=shrink)</span>

    <span class="s3"># the bottom left corner of one ax is (x0, y0)</span>
    <span class="s3"># the top right corner of one ax is (x1, y1)</span>
    <span class="s3"># p0: the vertical / horizontal position of anchor</span>
    <span class="s1">x0</span><span class="s0">, </span><span class="s1">y0</span><span class="s0">, </span><span class="s1">x1</span><span class="s0">, </span><span class="s1">y1 = ax.get_position().extents</span>
    <span class="s1">cx0</span><span class="s0">, </span><span class="s1">cy0</span><span class="s0">, </span><span class="s1">cx1</span><span class="s0">, </span><span class="s1">cy1 = cbar.ax.get_position().extents</span>
    <span class="s1">p0 = (x1 - x0) * anchor_x + x0</span>

    <span class="s1">np.testing.assert_allclose(</span>
            <span class="s1">[cx1</span><span class="s0">, </span><span class="s1">cx0]</span><span class="s0">,</span>
            <span class="s1">[x1 * shrink + (</span><span class="s5">1 </span><span class="s1">- shrink) * p0</span><span class="s0">, </span><span class="s1">p0 * (</span><span class="s5">1 </span><span class="s1">- shrink) + x0 * shrink])</span>


<span class="s1">@image_comparison([</span><span class="s4">'colorbar_change_lim_scale.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=</span><span class="s4">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_change_lim_scale():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">pc = ax[</span><span class="s5">0</span><span class="s1">].pcolormesh(np.arange(</span><span class="s5">100</span><span class="s1">).reshape(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">)+</span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s1">cb.ax.set_yscale(</span><span class="s4">'log'</span><span class="s1">)</span>

    <span class="s1">pc = ax[</span><span class="s5">1</span><span class="s1">].pcolormesh(np.arange(</span><span class="s5">100</span><span class="s1">).reshape(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">)+</span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s1">cb.ax.set_ylim([</span><span class="s5">20</span><span class="s0">, </span><span class="s5">90</span><span class="s1">])</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s4">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_axes_handles_same_functions(fig_ref</span><span class="s0">, </span><span class="s1">fig_test):</span>
    <span class="s3"># prove that cax and cb.ax are functionally the same</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">fig </span><span class="s0">in </span><span class="s1">enumerate([fig_ref</span><span class="s0">, </span><span class="s1">fig_test]):</span>
        <span class="s1">ax = fig.add_subplot()</span>
        <span class="s1">pc = ax.pcolormesh(np.ones(</span><span class="s5">300</span><span class="s1">).reshape(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">30</span><span class="s1">))</span>
        <span class="s1">cax = fig.add_axes([</span><span class="s5">0.9</span><span class="s0">, </span><span class="s5">0.1</span><span class="s0">, </span><span class="s5">0.03</span><span class="s0">, </span><span class="s5">0.8</span><span class="s1">])</span>
        <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">cax=cax)</span>
        <span class="s0">if </span><span class="s1">nn == </span><span class="s5">0</span><span class="s1">:</span>
            <span class="s1">caxx = cax</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">caxx = cb.ax</span>
        <span class="s1">caxx.set_yticks(np.arange(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">20</span><span class="s1">))</span>
        <span class="s1">caxx.set_yscale(</span><span class="s4">'log'</span><span class="s1">)</span>
        <span class="s1">caxx.set_position([</span><span class="s5">0.92</span><span class="s0">, </span><span class="s5">0.1</span><span class="s0">, </span><span class="s5">0.02</span><span class="s0">, </span><span class="s5">0.7</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_inset_colorbar_layout():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(constrained_layout=</span><span class="s0">True, </span><span class="s1">figsize=(</span><span class="s5">3</span><span class="s0">, </span><span class="s5">6</span><span class="s1">))</span>
    <span class="s1">pc = ax.imshow(np.arange(</span><span class="s5">100</span><span class="s1">).reshape(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">))</span>
    <span class="s1">cax = ax.inset_axes([</span><span class="s5">1.02</span><span class="s0">, </span><span class="s5">0.1</span><span class="s0">, </span><span class="s5">0.03</span><span class="s0">, </span><span class="s5">0.8</span><span class="s1">])</span>
    <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">cax=cax)</span>

    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s3"># make sure this is in the figure. In the colorbar swapping</span>
    <span class="s3"># it was being dropped from the list of children...</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_position().bounds</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s5">0.87</span><span class="s0">, </span><span class="s5">0.342</span><span class="s0">, </span><span class="s5">0.0237</span><span class="s0">, </span><span class="s5">0.315</span><span class="s1">]</span><span class="s0">, </span><span class="s1">atol=</span><span class="s5">0.01</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">cb.ax </span><span class="s0">in </span><span class="s1">ax.child_axes</span>


<span class="s1">@image_comparison([</span><span class="s4">'colorbar_twoslope.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=</span><span class="s4">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_twoslope_colorbar():</span>
    <span class="s3"># Note that the second tick = 20, and should be in the middle</span>
    <span class="s3"># of the colorbar (white)</span>
    <span class="s3"># There should be no tick right at the bottom, nor at the top.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">norm = mcolors.TwoSlopeNorm(</span><span class="s5">20</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s5">95</span><span class="s1">)</span>
    <span class="s1">pc = ax.pcolormesh(np.arange(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">11</span><span class="s1">)</span><span class="s0">,</span>
                       <span class="s1">np.arange(</span><span class="s5">100</span><span class="s1">).reshape(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">)</span><span class="s0">,</span>
                       <span class="s1">norm=norm</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pc)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s4">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_remove_cb_whose_mappable_has_no_figure(fig_ref</span><span class="s0">, </span><span class="s1">fig_test):</span>
    <span class="s1">ax = fig_test.add_subplot()</span>
    <span class="s1">cb = fig_test.colorbar(cm.ScalarMappable()</span><span class="s0">, </span><span class="s1">cax=ax)</span>
    <span class="s1">cb.remove()</span>


<span class="s0">def </span><span class="s1">test_aspects():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s5">3</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s5">8</span><span class="s0">, </span><span class="s5">8</span><span class="s1">))</span>
    <span class="s1">aspects = [</span><span class="s5">20</span><span class="s0">, </span><span class="s5">20</span><span class="s0">, </span><span class="s5">10</span><span class="s1">]</span>
    <span class="s1">extends = [</span><span class="s4">'neither'</span><span class="s0">, </span><span class="s4">'both'</span><span class="s0">, </span><span class="s4">'both'</span><span class="s1">]</span>
    <span class="s1">cb = [[</span><span class="s0">None, None, None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, None, None</span><span class="s1">]]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">orient </span><span class="s0">in </span><span class="s1">enumerate([</span><span class="s4">'vertical'</span><span class="s0">, </span><span class="s4">'horizontal'</span><span class="s1">]):</span>
        <span class="s0">for </span><span class="s1">mm</span><span class="s0">, </span><span class="s1">(aspect</span><span class="s0">, </span><span class="s1">extend) </span><span class="s0">in </span><span class="s1">enumerate(zip(aspects</span><span class="s0">, </span><span class="s1">extends)):</span>
            <span class="s1">pc = ax[mm</span><span class="s0">, </span><span class="s1">nn].pcolormesh(np.arange(</span><span class="s5">100</span><span class="s1">).reshape(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">))</span>
            <span class="s1">cb[nn][mm] = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax[mm</span><span class="s0">, </span><span class="s1">nn]</span><span class="s0">, </span><span class="s1">orientation=orient</span><span class="s0">,</span>
                                      <span class="s1">aspect=aspect</span><span class="s0">, </span><span class="s1">extend=extend)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s3"># check the extends are right ratio:</span>
    <span class="s1">np.testing.assert_almost_equal(cb[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].ax.get_position().height</span><span class="s0">,</span>
                                   <span class="s1">cb[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">0</span><span class="s1">].ax.get_position().height * </span><span class="s5">0.9</span><span class="s0">,</span>
                                   <span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s3"># horizontal</span>
    <span class="s1">np.testing.assert_almost_equal(cb[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].ax.get_position().width</span><span class="s0">,</span>
                                   <span class="s1">cb[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">0</span><span class="s1">].ax.get_position().width * </span><span class="s5">0.9</span><span class="s0">,</span>
                                   <span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s3"># check correct aspect:</span>
    <span class="s1">pos = cb[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">0</span><span class="s1">].ax.get_position(original=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_almost_equal(pos.height</span><span class="s0">, </span><span class="s1">pos.width * </span><span class="s5">20</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s1">pos = cb[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">0</span><span class="s1">].ax.get_position(original=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_almost_equal(pos.height * </span><span class="s5">20</span><span class="s0">, </span><span class="s1">pos.width</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s3"># check twice as wide if aspect is 10 instead of 20</span>
    <span class="s1">np.testing.assert_almost_equal(</span>
        <span class="s1">cb[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">0</span><span class="s1">].ax.get_position(original=</span><span class="s0">False</span><span class="s1">).width * </span><span class="s5">2</span><span class="s0">,</span>
        <span class="s1">cb[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">2</span><span class="s1">].ax.get_position(original=</span><span class="s0">False</span><span class="s1">).width</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_almost_equal(</span>
        <span class="s1">cb[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">0</span><span class="s1">].ax.get_position(original=</span><span class="s0">False</span><span class="s1">).height * </span><span class="s5">2</span><span class="s0">,</span>
        <span class="s1">cb[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">2</span><span class="s1">].ax.get_position(original=</span><span class="s0">False</span><span class="s1">).height</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s5">2</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'proportional_colorbars.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=</span><span class="s4">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_proportional_colorbars():</span>

    <span class="s1">x = y = np.arange(-</span><span class="s5">3.0</span><span class="s0">, </span><span class="s5">3.01</span><span class="s0">, </span><span class="s5">0.025</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z1 = np.exp(-X**</span><span class="s5">2 </span><span class="s1">- Y**</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s1">Z2 = np.exp(-(X - </span><span class="s5">1</span><span class="s1">)**</span><span class="s5">2 </span><span class="s1">- (Y - </span><span class="s5">1</span><span class="s1">)**</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s1">Z = (Z1 - Z2) * </span><span class="s5">2</span>

    <span class="s1">levels = [-</span><span class="s5">1.25</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.5</span><span class="s0">, </span><span class="s1">-</span><span class="s5">0.125</span><span class="s0">, </span><span class="s5">0.125</span><span class="s0">, </span><span class="s5">0.5</span><span class="s0">, </span><span class="s5">1.25</span><span class="s1">]</span>
    <span class="s1">cmap = mcolors.ListedColormap(</span>
        <span class="s1">[</span><span class="s4">'0.3'</span><span class="s0">, </span><span class="s4">'0.5'</span><span class="s0">, </span><span class="s4">'white'</span><span class="s0">, </span><span class="s4">'lightblue'</span><span class="s0">, </span><span class="s4">'steelblue'</span><span class="s1">])</span>
    <span class="s1">cmap.set_under(</span><span class="s4">'darkred'</span><span class="s1">)</span>
    <span class="s1">cmap.set_over(</span><span class="s4">'crimson'</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(levels</span><span class="s0">, </span><span class="s1">cmap.N)</span>

    <span class="s1">extends = [</span><span class="s4">'neither'</span><span class="s0">, </span><span class="s4">'both'</span><span class="s1">]</span>
    <span class="s1">spacings = [</span><span class="s4">'uniform'</span><span class="s0">, </span><span class="s4">'proportional'</span><span class="s1">]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s5">2</span><span class="s1">):</span>
        <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s5">2</span><span class="s1">):</span>
            <span class="s1">CS3 = axs[i</span><span class="s0">, </span><span class="s1">j].contourf(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">levels</span><span class="s0">, </span><span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm</span><span class="s0">,</span>
                                     <span class="s1">extend=extends[i])</span>
            <span class="s1">fig.colorbar(CS3</span><span class="s0">, </span><span class="s1">spacing=spacings[j]</span><span class="s0">, </span><span class="s1">ax=axs[i</span><span class="s0">, </span><span class="s1">j])</span>


<span class="s1">@image_comparison([</span><span class="s4">'extend_drawedges.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s4">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_extend_drawedges():</span>
    <span class="s1">params = [</span>
        <span class="s1">(</span><span class="s4">'both'</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s1">[[[</span><span class="s5">1.1</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">1.1</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]]</span><span class="s0">,</span>
                     <span class="s1">[[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]]</span><span class="s0">,</span>
                     <span class="s1">[[</span><span class="s5">2.9</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2.9</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]]])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">'min'</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">[[[</span><span class="s5">1.1</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">1.1</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]]</span><span class="s0">,</span>
                    <span class="s1">[[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]]])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">'max'</span><span class="s0">, </span><span class="s5">0</span><span class="s0">, </span><span class="s1">[[[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]]</span><span class="s0">,</span>
                    <span class="s1">[[</span><span class="s5">2.9</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2.9</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]]])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">'neither'</span><span class="s0">, </span><span class="s1">-</span><span class="s5">1</span><span class="s0">, </span><span class="s1">[[[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]]])</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s1">plt.rcParams[</span><span class="s4">'axes.linewidth'</span><span class="s1">] = </span><span class="s5">2</span>

    <span class="s1">fig = plt.figure(figsize=(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">4</span><span class="s1">))</span>
    <span class="s1">subfigs = fig.subfigures(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">orientation</span><span class="s0">, </span><span class="s1">subfig </span><span class="s0">in </span><span class="s1">zip([</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s4">'vertical'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">subfigs):</span>
        <span class="s0">if </span><span class="s1">orientation == </span><span class="s4">'horizontal'</span><span class="s1">:</span>
            <span class="s1">axs = subfig.subplots(</span><span class="s5">4</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">axs = subfig.subplots(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">4</span><span class="s1">)</span>
        <span class="s1">fig.subplots_adjust(left=</span><span class="s5">0.05</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s5">0.05</span><span class="s0">, </span><span class="s1">right=</span><span class="s5">0.95</span><span class="s0">, </span><span class="s1">top=</span><span class="s5">0.95</span><span class="s1">)</span>

        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">(extend</span><span class="s0">, </span><span class="s1">coloroffset</span><span class="s0">, </span><span class="s1">res) </span><span class="s0">in </span><span class="s1">zip(axs</span><span class="s0">, </span><span class="s1">params):</span>
            <span class="s1">cmap = mpl.colormaps[</span><span class="s4">&quot;viridis&quot;</span><span class="s1">]</span>
            <span class="s1">bounds = np.arange(</span><span class="s5">5</span><span class="s1">)</span>
            <span class="s1">nb_colors = len(bounds) + coloroffset</span>
            <span class="s1">colors = cmap(np.linspace(</span><span class="s5">100</span><span class="s0">, </span><span class="s5">255</span><span class="s0">, </span><span class="s1">nb_colors).astype(int))</span>
            <span class="s1">cmap</span><span class="s0">, </span><span class="s1">norm = mcolors.from_levels_and_colors(bounds</span><span class="s0">, </span><span class="s1">colors</span><span class="s0">,</span>
                                                        <span class="s1">extend=extend)</span>

            <span class="s1">cbar = Colorbar(ax</span><span class="s0">, </span><span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm</span><span class="s0">, </span><span class="s1">orientation=orientation</span><span class="s0">,</span>
                            <span class="s1">drawedges=</span><span class="s0">True</span><span class="s1">)</span>
            <span class="s3"># Set limits such that only two colours are visible, and the</span>
            <span class="s3"># dividers would be outside the Axes, to ensure that a) they are</span>
            <span class="s3"># not drawn outside, and b) a divider still appears between the</span>
            <span class="s3"># main colour and the extension.</span>
            <span class="s0">if </span><span class="s1">orientation == </span><span class="s4">'horizontal'</span><span class="s1">:</span>
                <span class="s1">ax.set_xlim(</span><span class="s5">1.1</span><span class="s0">, </span><span class="s5">2.9</span><span class="s1">)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">ax.set_ylim(</span><span class="s5">1.1</span><span class="s0">, </span><span class="s5">2.9</span><span class="s1">)</span>
                <span class="s1">res = np.array(res)[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">[</span><span class="s5">1</span><span class="s0">, </span><span class="s5">0</span><span class="s1">]]</span>
            <span class="s1">np.testing.assert_array_equal(cbar.dividers.get_segments()</span><span class="s0">, </span><span class="s1">res)</span>


<span class="s1">@image_comparison([</span><span class="s4">'contourf_extend_patches.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=</span><span class="s4">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_contourf_extend_patches():</span>
    <span class="s1">params = [</span>
        <span class="s1">(</span><span class="s4">'both'</span><span class="s0">, </span><span class="s5">5</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'//'</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">'min'</span><span class="s0">, </span><span class="s5">7</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'+'</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">'max'</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'|'</span><span class="s0">, </span><span class="s4">'-'</span><span class="s0">, </span><span class="s4">'/'</span><span class="s0">, </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'//'</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">'neither'</span><span class="s0">, </span><span class="s5">10</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'//'</span><span class="s0">, </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s0">, </span><span class="s4">'||'</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s1">plt.rcParams[</span><span class="s4">'axes.linewidth'</span><span class="s1">] = </span><span class="s5">2</span>

    <span class="s1">fig = plt.figure(figsize=(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">4</span><span class="s1">))</span>
    <span class="s1">subfigs = fig.subfigures(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s1">)</span>
    <span class="s1">fig.subplots_adjust(left=</span><span class="s5">0.05</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s5">0.05</span><span class="s0">, </span><span class="s1">right=</span><span class="s5">0.95</span><span class="s0">, </span><span class="s1">top=</span><span class="s5">0.95</span><span class="s1">)</span>

    <span class="s1">x = np.linspace(-</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">50</span><span class="s1">)</span>
    <span class="s1">y = np.linspace(-</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">30</span><span class="s1">)</span>
    <span class="s1">z = np.cos(x[np.newaxis</span><span class="s0">, </span><span class="s1">:]) + np.sin(y[:</span><span class="s0">, </span><span class="s1">np.newaxis])</span>

    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">&quot;viridis&quot;</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">orientation</span><span class="s0">, </span><span class="s1">subfig </span><span class="s0">in </span><span class="s1">zip([</span><span class="s4">'horizontal'</span><span class="s0">, </span><span class="s4">'vertical'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">subfigs):</span>
        <span class="s1">axs = subfig.subplots(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">2</span><span class="s1">).ravel()</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">(extend</span><span class="s0">, </span><span class="s1">levels</span><span class="s0">, </span><span class="s1">hatches) </span><span class="s0">in </span><span class="s1">zip(axs</span><span class="s0">, </span><span class="s1">params):</span>
            <span class="s1">cs = ax.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">levels</span><span class="s0">, </span><span class="s1">hatches=hatches</span><span class="s0">,</span>
                             <span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">extend=extend)</span>
            <span class="s1">subfig.colorbar(cs</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">orientation=orientation</span><span class="s0">, </span><span class="s1">fraction=</span><span class="s5">0.4</span><span class="s0">,</span>
                            <span class="s1">extendfrac=</span><span class="s5">0.2</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s5">5</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_negative_boundarynorm():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">3</span><span class="s1">))</span>
    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">&quot;viridis&quot;</span><span class="s1">]</span>

    <span class="s1">clevs = np.arange(-</span><span class="s5">94</span><span class="s0">, </span><span class="s1">-</span><span class="s5">85</span><span class="s1">)</span>
    <span class="s1">norm = BoundaryNorm(clevs</span><span class="s0">, </span><span class="s1">cmap.N)</span>
    <span class="s1">cb = fig.colorbar(cm.ScalarMappable(cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm)</span><span class="s0">, </span><span class="s1">cax=ax)</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_ylim()</span><span class="s0">, </span><span class="s1">[clevs[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">clevs[-</span><span class="s5">1</span><span class="s1">]])</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_yticks()</span><span class="s0">, </span><span class="s1">clevs)</span>

    <span class="s1">clevs = np.arange(</span><span class="s5">85</span><span class="s0">, </span><span class="s5">94</span><span class="s1">)</span>
    <span class="s1">norm = BoundaryNorm(clevs</span><span class="s0">, </span><span class="s1">cmap.N)</span>
    <span class="s1">cb = fig.colorbar(cm.ScalarMappable(cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm)</span><span class="s0">, </span><span class="s1">cax=ax)</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_ylim()</span><span class="s0">, </span><span class="s1">[clevs[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">clevs[-</span><span class="s5">1</span><span class="s1">]])</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_yticks()</span><span class="s0">, </span><span class="s1">clevs)</span>

    <span class="s1">clevs = np.arange(-</span><span class="s5">3</span><span class="s0">, </span><span class="s5">3</span><span class="s1">)</span>
    <span class="s1">norm = BoundaryNorm(clevs</span><span class="s0">, </span><span class="s1">cmap.N)</span>
    <span class="s1">cb = fig.colorbar(cm.ScalarMappable(cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm)</span><span class="s0">, </span><span class="s1">cax=ax)</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_ylim()</span><span class="s0">, </span><span class="s1">[clevs[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">clevs[-</span><span class="s5">1</span><span class="s1">]])</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_yticks()</span><span class="s0">, </span><span class="s1">clevs)</span>

    <span class="s1">clevs = np.arange(-</span><span class="s5">8</span><span class="s0">, </span><span class="s5">1</span><span class="s1">)</span>
    <span class="s1">norm = BoundaryNorm(clevs</span><span class="s0">, </span><span class="s1">cmap.N)</span>
    <span class="s1">cb = fig.colorbar(cm.ScalarMappable(cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm)</span><span class="s0">, </span><span class="s1">cax=ax)</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_ylim()</span><span class="s0">, </span><span class="s1">[clevs[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">clevs[-</span><span class="s5">1</span><span class="s1">]])</span>
    <span class="s1">np.testing.assert_allclose(cb.ax.get_yticks()</span><span class="s0">, </span><span class="s1">clevs)</span>


<span class="s0">def </span><span class="s1">test_centerednorm():</span>
    <span class="s3"># Test default centered norm gets expanded with non-singular limits</span>
    <span class="s3"># when plot data is all equal (autoscale halfrange == 0)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s5">1</span><span class="s0">, </span><span class="s5">3</span><span class="s1">))</span>

    <span class="s1">norm = mcolors.CenteredNorm()</span>
    <span class="s1">mappable = ax.pcolormesh(np.zeros((</span><span class="s5">3</span><span class="s0">, </span><span class="s5">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">norm=norm)</span>
    <span class="s1">fig.colorbar(mappable)</span>
    <span class="s0">assert </span><span class="s1">(norm.vmin</span><span class="s0">, </span><span class="s1">norm.vmax) == (-</span><span class="s5">0.1</span><span class="s0">, </span><span class="s5">0.1</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'nonorm_colorbars.svg'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s4">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_nonorm():</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'svg.fonttype'</span><span class="s1">] = </span><span class="s4">'none'</span>
    <span class="s1">data = [</span><span class="s5">1</span><span class="s0">, </span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">4</span><span class="s0">, </span><span class="s5">5</span><span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s5">6</span><span class="s0">, </span><span class="s5">1</span><span class="s1">))</span>
    <span class="s1">fig.subplots_adjust(bottom=</span><span class="s5">0.5</span><span class="s1">)</span>

    <span class="s1">norm = NoNorm(vmin=min(data)</span><span class="s0">, </span><span class="s1">vmax=max(data))</span>
    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">&quot;viridis&quot;</span><span class="s1">].resampled(len(data))</span>
    <span class="s1">mappable = cm.ScalarMappable(norm=norm</span><span class="s0">, </span><span class="s1">cmap=cmap)</span>
    <span class="s1">cbar = fig.colorbar(mappable</span><span class="s0">, </span><span class="s1">cax=ax</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s4">&quot;horizontal&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'test_boundaries.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=</span><span class="s4">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boundaries():</span>
    <span class="s1">np.random.seed(seed=</span><span class="s5">19680808</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s5">2</span><span class="s0">, </span><span class="s5">2</span><span class="s1">))</span>
    <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s1">)</span>
    <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">boundaries=np.linspace(-</span><span class="s5">3</span><span class="s0">, </span><span class="s5">3</span><span class="s0">, </span><span class="s5">7</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_colorbar_no_warning_rcparams_grid_true():</span>
    <span class="s3"># github issue #21723 - If mpl style has 'axes.grid' = True,</span>
    <span class="s3"># fig.colorbar raises a warning about Auto-removal of grids</span>
    <span class="s3"># by pcolor() and pcolormesh(). This is fixed by PR #22216.</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'axes.grid'</span><span class="s1">] = </span><span class="s0">True</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.grid(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">im = ax.pcolormesh([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s5">1</span><span class="s1">]])</span>
    <span class="s3"># make sure that no warning is raised by fig.colorbar</span>
    <span class="s1">fig.colorbar(im)</span>


<span class="s0">def </span><span class="s1">test_colorbar_set_formatter_locator():</span>
    <span class="s3"># check that the locator properties echo what is on the axis:</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">))</span>
    <span class="s1">cb = fig.colorbar(pc)</span>
    <span class="s1">cb.ax.yaxis.set_major_locator(FixedLocator(np.arange(</span><span class="s5">10</span><span class="s1">)))</span>
    <span class="s1">cb.ax.yaxis.set_minor_locator(FixedLocator(np.arange(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">10</span><span class="s0">, </span><span class="s5">0.2</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">cb.locator </span><span class="s0">is </span><span class="s1">cb.ax.yaxis.get_major_locator()</span>
    <span class="s0">assert </span><span class="s1">cb.minorlocator </span><span class="s0">is </span><span class="s1">cb.ax.yaxis.get_minor_locator()</span>
    <span class="s1">cb.ax.yaxis.set_major_formatter(LogFormatter())</span>
    <span class="s1">cb.ax.yaxis.set_minor_formatter(LogFormatter())</span>
    <span class="s0">assert </span><span class="s1">cb.formatter </span><span class="s0">is </span><span class="s1">cb.ax.yaxis.get_major_formatter()</span>
    <span class="s0">assert </span><span class="s1">cb.minorformatter </span><span class="s0">is </span><span class="s1">cb.ax.yaxis.get_minor_formatter()</span>

    <span class="s3"># check that the setter works as expected:</span>
    <span class="s1">loc = FixedLocator(np.arange(</span><span class="s5">7</span><span class="s1">))</span>
    <span class="s1">cb.locator = loc</span>
    <span class="s0">assert </span><span class="s1">cb.ax.yaxis.get_major_locator() </span><span class="s0">is </span><span class="s1">loc</span>
    <span class="s1">loc = FixedLocator(np.arange(</span><span class="s5">0</span><span class="s0">, </span><span class="s5">7</span><span class="s0">, </span><span class="s5">0.1</span><span class="s1">))</span>
    <span class="s1">cb.minorlocator = loc</span>
    <span class="s0">assert </span><span class="s1">cb.ax.yaxis.get_minor_locator() </span><span class="s0">is </span><span class="s1">loc</span>
    <span class="s1">fmt = LogFormatter()</span>
    <span class="s1">cb.formatter = fmt</span>
    <span class="s0">assert </span><span class="s1">cb.ax.yaxis.get_major_formatter() </span><span class="s0">is </span><span class="s1">fmt</span>
    <span class="s1">fmt = LogFormatter()</span>
    <span class="s1">cb.minorformatter = fmt</span>
    <span class="s0">assert </span><span class="s1">cb.ax.yaxis.get_minor_formatter() </span><span class="s0">is </span><span class="s1">fmt</span>


<span class="s1">@image_comparison([</span><span class="s4">'colorbar_extend_alpha.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s4">'dpi'</span><span class="s1">: </span><span class="s5">40</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_colorbar_extend_alpha():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.imshow([[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s5">0.3</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s4">&quot;none&quot;</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s0">, </span><span class="s1">boundaries=[</span><span class="s5">0.5</span><span class="s0">, </span><span class="s5">1.5</span><span class="s0">, </span><span class="s5">2.5</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_offset_text_loc():</span>
    <span class="s1">plt.style.use(</span><span class="s4">'mpl20'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">np.random.seed(seed=</span><span class="s5">19680808</span><span class="s1">)</span>
    <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">)*</span><span class="s5">1e6</span><span class="s1">)</span>
    <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">location=</span><span class="s4">'right'</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'max'</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s3"># check that the offsetText is in the proper place above the</span>
    <span class="s3"># colorbar axes.  In this case the colorbar axes is the same</span>
    <span class="s3"># height as the parent, so use the parents bbox.</span>
    <span class="s0">assert </span><span class="s1">cb.ax.yaxis.offsetText.get_position()[</span><span class="s5">1</span><span class="s1">] &gt; ax.bbox.y1</span>


<span class="s0">def </span><span class="s1">test_title_text_loc():</span>
    <span class="s1">plt.style.use(</span><span class="s4">'mpl20'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">np.random.seed(seed=</span><span class="s5">19680808</span><span class="s1">)</span>
    <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s5">10</span><span class="s0">, </span><span class="s5">10</span><span class="s1">))</span>
    <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">location=</span><span class="s4">'right'</span><span class="s0">, </span><span class="s1">extend=</span><span class="s4">'max'</span><span class="s1">)</span>
    <span class="s1">cb.ax.set_title(</span><span class="s4">'Aardvark'</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s3"># check that the title is in the proper place above the</span>
    <span class="s3"># colorbar axes, including its extend triangles....</span>
    <span class="s0">assert </span><span class="s1">(cb.ax.title.get_window_extent(fig.canvas.get_renderer()).ymax &gt;</span>
            <span class="s1">cb.ax.spines[</span><span class="s4">'outline'</span><span class="s1">].get_window_extent().ymax)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s4">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_passing_location(fig_ref</span><span class="s0">, </span><span class="s1">fig_test):</span>
    <span class="s1">ax_ref = fig_ref.add_subplot()</span>
    <span class="s1">im = ax_ref.imshow([[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]])</span>
    <span class="s1">ax_ref.figure.colorbar(im</span><span class="s0">, </span><span class="s1">cax=ax_ref.inset_axes([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1.05</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">0.05</span><span class="s1">])</span><span class="s0">,</span>
                           <span class="s1">orientation=</span><span class="s4">&quot;horizontal&quot;</span><span class="s0">, </span><span class="s1">ticklocation=</span><span class="s4">&quot;top&quot;</span><span class="s1">)</span>
    <span class="s1">ax_test = fig_test.add_subplot()</span>
    <span class="s1">im = ax_test.imshow([[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]])</span>
    <span class="s1">ax_test.figure.colorbar(im</span><span class="s0">, </span><span class="s1">cax=ax_test.inset_axes([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1.05</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">0.05</span><span class="s1">])</span><span class="s0">,</span>
                            <span class="s1">location=</span><span class="s4">&quot;top&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;kwargs,error,message&quot;</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">({</span><span class="s4">'location'</span><span class="s1">: </span><span class="s4">'top'</span><span class="s0">, </span><span class="s4">'orientation'</span><span class="s1">: </span><span class="s4">'vertical'</span><span class="s1">}</span><span class="s0">, </span><span class="s1">TypeError</span><span class="s0">,</span>
     <span class="s4">&quot;location and orientation are mutually exclusive&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">({</span><span class="s4">'location'</span><span class="s1">: </span><span class="s4">'top'</span><span class="s0">, </span><span class="s4">'orientation'</span><span class="s1">: </span><span class="s4">'vertical'</span><span class="s0">, </span><span class="s4">'cax'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}</span><span class="s0">, </span><span class="s1">TypeError</span><span class="s0">,</span>
     <span class="s4">&quot;location and orientation are mutually exclusive&quot;</span><span class="s1">)</span><span class="s0">,  </span><span class="s3"># Different to above</span>
    <span class="s1">({</span><span class="s4">'ticklocation'</span><span class="s1">: </span><span class="s4">'top'</span><span class="s0">, </span><span class="s4">'orientation'</span><span class="s1">: </span><span class="s4">'vertical'</span><span class="s0">, </span><span class="s4">'cax'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}</span><span class="s0">,</span>
     <span class="s1">ValueError</span><span class="s0">, </span><span class="s4">&quot;'top' is not a valid value for position&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">({</span><span class="s4">'location'</span><span class="s1">: </span><span class="s4">'top'</span><span class="s0">, </span><span class="s4">'extendfrac'</span><span class="s1">: (</span><span class="s5">0</span><span class="s0">, None</span><span class="s1">)}</span><span class="s0">, </span><span class="s1">ValueError</span><span class="s0">,</span>
     <span class="s4">&quot;invalid value for extendfrac&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_errors(kwargs</span><span class="s0">, </span><span class="s1">error</span><span class="s0">, </span><span class="s1">message):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.imshow([[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]])</span>
    <span class="s0">if </span><span class="s1">kwargs.get(</span><span class="s4">'cax'</span><span class="s0">, None</span><span class="s1">) </span><span class="s0">is True</span><span class="s1">:</span>
        <span class="s1">kwargs[</span><span class="s4">'cax'</span><span class="s1">] = ax.inset_axes([</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1.05</span><span class="s0">, </span><span class="s5">1</span><span class="s0">, </span><span class="s5">0.05</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(error</span><span class="s0">, </span><span class="s1">match=message):</span>
        <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">test_colorbar_axes_parmeters():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s5">2</span><span class="s1">)</span>
    <span class="s1">im = ax[</span><span class="s5">0</span><span class="s1">].imshow([[</span><span class="s5">0</span><span class="s0">, </span><span class="s5">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s5">2</span><span class="s0">, </span><span class="s5">3</span><span class="s1">]])</span>
    <span class="s3"># colorbar should accept any form of axes sequence:</span>
    <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">ax=ax)</span>
    <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">ax=ax[</span><span class="s5">0</span><span class="s1">])</span>
    <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">ax=[_ax </span><span class="s0">for </span><span class="s1">_ax </span><span class="s0">in </span><span class="s1">ax])</span>
    <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">ax=(ax[</span><span class="s5">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax[</span><span class="s5">1</span><span class="s1">]))</span>
    <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">ax={i: _ax </span><span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">_ax </span><span class="s0">in </span><span class="s1">enumerate(ax)}.values())</span>
    <span class="s1">fig.draw_without_rendering()</span>
</pre>
</body>
</html>