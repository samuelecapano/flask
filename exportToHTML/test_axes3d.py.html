<html>
<head>
<title>test_axes3d.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_axes3d.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">functools</span>
<span class="s0">import </span><span class="s1">itertools</span>

<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">mpl_toolkits.mplot3d </span><span class="s0">import </span><span class="s1">Axes3D</span><span class="s0">, </span><span class="s1">axes3d</span><span class="s0">, </span><span class="s1">proj3d</span><span class="s0">, </span><span class="s1">art3d</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib.backend_bases </span><span class="s0">import </span><span class="s1">(MouseButton</span><span class="s0">, </span><span class="s1">MouseEvent</span><span class="s0">,</span>
                                      <span class="s1">NavigationToolbar2)</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">cm</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">colors </span><span class="s0">as </span><span class="s1">mcolors</span><span class="s0">, </span><span class="s1">patches </span><span class="s0">as </span><span class="s1">mpatch</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">image_comparison</span><span class="s0">, </span><span class="s1">check_figures_equal</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.widgets </span><span class="s0">import </span><span class="s1">mock_event</span>
<span class="s0">from </span><span class="s1">matplotlib.collections </span><span class="s0">import </span><span class="s1">LineCollection</span><span class="s0">, </span><span class="s1">PolyCollection</span>
<span class="s0">from </span><span class="s1">matplotlib.patches </span><span class="s0">import </span><span class="s1">Circle</span><span class="s0">, </span><span class="s1">PathPatch</span>
<span class="s0">from </span><span class="s1">matplotlib.path </span><span class="s0">import </span><span class="s1">Path</span>
<span class="s0">from </span><span class="s1">matplotlib.text </span><span class="s0">import </span><span class="s1">Text</span>

<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>


<span class="s1">mpl3d_image_comparison = functools.partial(</span>
    <span class="s1">image_comparison</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s2">'default'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_invisible_axes(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots(subplot_kw=dict(projection=</span><span class="s2">'3d'</span><span class="s1">))</span>
    <span class="s1">ax.set_visible(</span><span class="s0">False</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'aspects.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_aspects():</span>
    <span class="s1">aspects = (</span><span class="s2">'auto'</span><span class="s0">, </span><span class="s2">'equal'</span><span class="s0">, </span><span class="s2">'equalxy'</span><span class="s0">, </span><span class="s2">'equalyz'</span><span class="s0">, </span><span class="s2">'equalxz'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">len(aspects)</span><span class="s0">, </span><span class="s1">subplot_kw={</span><span class="s2">'projection'</span><span class="s1">: </span><span class="s2">'3d'</span><span class="s1">})</span>

    <span class="s4"># Draw rectangular cuboid with side lengths [1, 1, 5]</span>
    <span class="s1">r = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">scale = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span>
    <span class="s1">pts = itertools.combinations(np.array(list(itertools.product(r</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">r)))</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">start</span><span class="s0">, </span><span class="s1">end </span><span class="s0">in </span><span class="s1">pts:</span>
        <span class="s0">if </span><span class="s1">np.sum(np.abs(start - end)) == r[</span><span class="s3">1</span><span class="s1">] - r[</span><span class="s3">0</span><span class="s1">]:</span>
            <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs:</span>
                <span class="s1">ax.plot3D(*zip(start*scale</span><span class="s0">, </span><span class="s1">end*scale))</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs):</span>
        <span class="s1">ax.set_box_aspect((</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
        <span class="s1">ax.set_aspect(aspects[i]</span><span class="s0">, </span><span class="s1">adjustable=</span><span class="s2">'datalim'</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'aspects_adjust_box.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_aspects_adjust_box():</span>
    <span class="s1">aspects = (</span><span class="s2">'auto'</span><span class="s0">, </span><span class="s2">'equal'</span><span class="s0">, </span><span class="s2">'equalxy'</span><span class="s0">, </span><span class="s2">'equalyz'</span><span class="s0">, </span><span class="s2">'equalxz'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">len(aspects)</span><span class="s0">, </span><span class="s1">subplot_kw={</span><span class="s2">'projection'</span><span class="s1">: </span><span class="s2">'3d'</span><span class="s1">}</span><span class="s0">,</span>
                            <span class="s1">figsize=(</span><span class="s3">11</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>

    <span class="s4"># Draw rectangular cuboid with side lengths [4, 3, 5]</span>
    <span class="s1">r = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">scale = np.array([</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span>
    <span class="s1">pts = itertools.combinations(np.array(list(itertools.product(r</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">r)))</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">start</span><span class="s0">, </span><span class="s1">end </span><span class="s0">in </span><span class="s1">pts:</span>
        <span class="s0">if </span><span class="s1">np.sum(np.abs(start - end)) == r[</span><span class="s3">1</span><span class="s1">] - r[</span><span class="s3">0</span><span class="s1">]:</span>
            <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs:</span>
                <span class="s1">ax.plot3D(*zip(start*scale</span><span class="s0">, </span><span class="s1">end*scale))</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs):</span>
        <span class="s1">ax.set_aspect(aspects[i]</span><span class="s0">, </span><span class="s1">adjustable=</span><span class="s2">'box'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_axes3d_repr():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.set_label(</span><span class="s2">'label'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">'title'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s2">'x'</span><span class="s1">)</span>
    <span class="s1">ax.set_ylabel(</span><span class="s2">'y'</span><span class="s1">)</span>
    <span class="s1">ax.set_zlabel(</span><span class="s2">'z'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">repr(ax) == (</span>
        <span class="s2">&quot;&lt;Axes3D: label='label', &quot;</span>
        <span class="s2">&quot;title={'center': 'title'}, xlabel='x', ylabel='y', zlabel='z'&gt;&quot;</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'axes3d_primary_views.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_axes3d_primary_views():</span>
    <span class="s4"># (elev, azim, roll)</span>
    <span class="s1">views = [(</span><span class="s3">90</span><span class="s0">, </span><span class="s1">-</span><span class="s3">90</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># XY</span>
             <span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">90</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,   </span><span class="s4"># XZ</span>
             <span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,     </span><span class="s4"># YZ</span>
             <span class="s1">(-</span><span class="s3">90</span><span class="s0">, </span><span class="s3">90</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># -XY</span>
             <span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">90</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,    </span><span class="s4"># -XZ</span>
             <span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">180</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)]   </span><span class="s4"># -YZ</span>
    <span class="s4"># When viewing primary planes, draw the two visible axes so they intersect</span>
    <span class="s4"># at their low values</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">subplot_kw={</span><span class="s2">'projection'</span><span class="s1">: </span><span class="s2">'3d'</span><span class="s1">})</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">ax.set_xlabel(</span><span class="s2">'x'</span><span class="s1">)</span>
        <span class="s1">ax.set_ylabel(</span><span class="s2">'y'</span><span class="s1">)</span>
        <span class="s1">ax.set_zlabel(</span><span class="s2">'z'</span><span class="s1">)</span>
        <span class="s1">ax.set_proj_type(</span><span class="s2">'ortho'</span><span class="s1">)</span>
        <span class="s1">ax.view_init(elev=views[i][</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">azim=views[i][</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">roll=views[i][</span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">plt.tight_layout()</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'bar3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar3d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">c</span><span class="s0">, </span><span class="s1">z </span><span class="s0">in </span><span class="s1">zip([</span><span class="s2">'r'</span><span class="s0">, </span><span class="s2">'g'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">30</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]):</span>
        <span class="s1">xs = np.arange(</span><span class="s3">20</span><span class="s1">)</span>
        <span class="s1">ys = np.arange(</span><span class="s3">20</span><span class="s1">)</span>
        <span class="s1">cs = [c] * len(xs)</span>
        <span class="s1">cs[</span><span class="s3">0</span><span class="s1">] = </span><span class="s2">'c'</span>
        <span class="s1">ax.bar(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs=z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'y'</span><span class="s0">, </span><span class="s1">align=</span><span class="s2">'edge'</span><span class="s0">, </span><span class="s1">color=cs</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.8</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_bar3d_colors():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s0">, </span><span class="s2">'yellow'</span><span class="s1">]:</span>
        <span class="s1">xs = np.arange(len(c))</span>
        <span class="s1">ys = np.zeros_like(xs)</span>
        <span class="s1">zs = np.zeros_like(ys)</span>
        <span class="s4"># Color names with same length as xs/ys/zs should not be split into</span>
        <span class="s4"># individual letters.</span>
        <span class="s1">ax.bar3d(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">color=c)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'bar3d_shaded.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar3d_shaded():</span>
    <span class="s1">x = np.arange(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">x2d</span><span class="s0">, </span><span class="s1">y2d = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">x2d</span><span class="s0">, </span><span class="s1">y2d = x2d.ravel()</span><span class="s0">, </span><span class="s1">y2d.ravel()</span>
    <span class="s1">z = x2d + y2d + </span><span class="s3">1  </span><span class="s4"># Avoid triggering bug with zero-depth boxes.</span>

    <span class="s1">views = [(</span><span class="s3">30</span><span class="s0">, </span><span class="s1">-</span><span class="s3">60</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s1">-</span><span class="s3">90</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">300</span><span class="s0">, </span><span class="s1">-</span><span class="s3">30</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)]</span>
    <span class="s1">fig = plt.figure(figsize=plt.figaspect(</span><span class="s3">1 </span><span class="s1">/ len(views)))</span>
    <span class="s1">axs = fig.subplots(</span>
        <span class="s3">1</span><span class="s0">, </span><span class="s1">len(views)</span><span class="s0">,</span>
        <span class="s1">subplot_kw=dict(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">(elev</span><span class="s0">, </span><span class="s1">azim</span><span class="s0">, </span><span class="s1">roll) </span><span class="s0">in </span><span class="s1">zip(axs</span><span class="s0">, </span><span class="s1">views):</span>
        <span class="s1">ax.bar3d(x2d</span><span class="s0">, </span><span class="s1">y2d</span><span class="s0">, </span><span class="s1">x2d * </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">shade=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">ax.view_init(elev=elev</span><span class="s0">, </span><span class="s1">azim=azim</span><span class="s0">, </span><span class="s1">roll=roll)</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'bar3d_notshaded.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar3d_notshaded():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">x = np.arange(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">x2d</span><span class="s0">, </span><span class="s1">y2d = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">x2d</span><span class="s0">, </span><span class="s1">y2d = x2d.ravel()</span><span class="s0">, </span><span class="s1">y2d.ravel()</span>
    <span class="s1">z = x2d + y2d</span>
    <span class="s1">ax.bar3d(x2d</span><span class="s0">, </span><span class="s1">y2d</span><span class="s0">, </span><span class="s1">x2d * </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">shade=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s0">def </span><span class="s1">test_bar3d_lightsource():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>

    <span class="s1">ls = mcolors.LightSource(azdeg=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">altdeg=</span><span class="s3">90</span><span class="s1">)</span>

    <span class="s1">length</span><span class="s0">, </span><span class="s1">width = </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span>
    <span class="s1">area = length * width</span>

    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(np.arange(length)</span><span class="s0">, </span><span class="s1">np.arange(width))</span>
    <span class="s1">x = x.ravel()</span>
    <span class="s1">y = y.ravel()</span>
    <span class="s1">dz = x + y</span>

    <span class="s1">color = [cm.coolwarm(i/area) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(area)]</span>

    <span class="s1">collection = ax.bar3d(x=x</span><span class="s0">, </span><span class="s1">y=y</span><span class="s0">, </span><span class="s1">z=</span><span class="s3">0</span><span class="s0">,</span>
                          <span class="s1">dx=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">dy=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">dz=dz</span><span class="s0">,</span>
                          <span class="s1">color=color</span><span class="s0">, </span><span class="s1">shade=</span><span class="s0">True, </span><span class="s1">lightsource=ls)</span>

    <span class="s4"># Testing that the custom 90° lightsource produces different shading on</span>
    <span class="s4"># the top facecolors compared to the default, and that those colors are</span>
    <span class="s4"># precisely the colors from the colormap, due to the illumination parallel</span>
    <span class="s4"># to the z-axis.</span>
    <span class="s1">np.testing.assert_array_equal(color</span><span class="s0">, </span><span class="s1">collection._facecolor3d[</span><span class="s3">1</span><span class="s1">::</span><span class="s3">6</span><span class="s1">])</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'contour3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contour3d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z = axes3d.get_test_data(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s1">ax.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'z'</span><span class="s0">, </span><span class="s1">offset=-</span><span class="s3">100</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm)</span>
    <span class="s1">ax.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'x'</span><span class="s0">, </span><span class="s1">offset=-</span><span class="s3">40</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm)</span>
    <span class="s1">ax.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'y'</span><span class="s0">, </span><span class="s1">offset=</span><span class="s3">40</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm)</span>
    <span class="s1">ax.set_xlim(-</span><span class="s3">40</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">40</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(-</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'contour3d_extend3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contour3d_extend3d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z = axes3d.get_test_data(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s1">ax.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'z'</span><span class="s0">, </span><span class="s1">offset=-</span><span class="s3">100</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm</span><span class="s0">, </span><span class="s1">extend3d=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(-</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">20</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(-</span><span class="s3">80</span><span class="s0">, </span><span class="s3">80</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'contourf3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contourf3d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z = axes3d.get_test_data(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s1">ax.contourf(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'z'</span><span class="s0">, </span><span class="s1">offset=-</span><span class="s3">100</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm)</span>
    <span class="s1">ax.contourf(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'x'</span><span class="s0">, </span><span class="s1">offset=-</span><span class="s3">40</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm)</span>
    <span class="s1">ax.contourf(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'y'</span><span class="s0">, </span><span class="s1">offset=</span><span class="s3">40</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm)</span>
    <span class="s1">ax.set_xlim(-</span><span class="s3">40</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">40</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(-</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'contourf3d_fill.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contourf3d_fill():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(np.arange(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">))</span>
    <span class="s1">Z = X.clip(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s4"># This produces holes in the z=0 surface that causes rendering errors if</span>
    <span class="s4"># the Poly3DCollection is not aware of path code information (issue #4784)</span>
    <span class="s1">Z[::</span><span class="s3">5</span><span class="s0">, </span><span class="s1">::</span><span class="s3">5</span><span class="s1">] = </span><span class="s3">0.1</span>
    <span class="s1">ax.contourf(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">offset=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">levels=[-</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm)</span>
    <span class="s1">ax.set_xlim(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'extend, levels'</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">'both'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]]</span><span class="s0">,</span>
                                            <span class="s1">[</span><span class="s2">'min'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]]</span><span class="s0">,</span>
                                            <span class="s1">[</span><span class="s2">'max'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]]])</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contourf3d_extend(fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">extend</span><span class="s0">, </span><span class="s1">levels):</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(np.arange(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">))</span>
    <span class="s4"># Z is in the range [0, 8]</span>
    <span class="s1">Z = X**</span><span class="s3">2 </span><span class="s1">+ Y**</span><span class="s3">2</span>

    <span class="s4"># Manually set the over/under colors to be the end of the colormap</span>
    <span class="s1">cmap = mpl.colormaps[</span><span class="s2">'viridis'</span><span class="s1">].copy()</span>
    <span class="s1">cmap.set_under(cmap(</span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">cmap.set_over(cmap(</span><span class="s3">255</span><span class="s1">))</span>
    <span class="s4"># Set vmin/max to be the min/max values plotted on the reference image</span>
    <span class="s1">kwargs = {</span><span class="s2">'vmin'</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s2">'vmax'</span><span class="s1">: </span><span class="s3">7</span><span class="s0">, </span><span class="s2">'cmap'</span><span class="s1">: cmap}</span>

    <span class="s1">ax_ref = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_ref.contourf(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">**kwargs)</span>

    <span class="s1">ax_test = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_test.contourf(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">levels</span><span class="s0">, </span><span class="s1">extend=extend</span><span class="s0">, </span><span class="s1">**kwargs)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">[ax_ref</span><span class="s0">, </span><span class="s1">ax_test]:</span>
        <span class="s1">ax.set_xlim(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">ax.set_ylim(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">ax.set_zlim(-</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'tricontour.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s3">0.02</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_tricontour():</span>
    <span class="s1">fig = plt.figure()</span>

    <span class="s1">np.random.seed(</span><span class="s3">19680801</span><span class="s1">)</span>
    <span class="s1">x = np.random.rand(</span><span class="s3">1000</span><span class="s1">) - </span><span class="s3">0.5</span>
    <span class="s1">y = np.random.rand(</span><span class="s3">1000</span><span class="s1">) - </span><span class="s3">0.5</span>
    <span class="s1">z = -(x**</span><span class="s3">2 </span><span class="s1">+ y**</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.tricontour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.tricontourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>


<span class="s0">def </span><span class="s1">test_contour3d_1d_input():</span>
    <span class="s4"># Check that 1D sequences of different length for {x, y} doesn't error</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">nx</span><span class="s0">, </span><span class="s1">ny = </span><span class="s3">30</span><span class="s0">, </span><span class="s3">20</span>
    <span class="s1">x = np.linspace(-</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s1">nx)</span>
    <span class="s1">y = np.linspace(-</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s1">ny)</span>
    <span class="s1">z = np.random.randint(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">[ny</span><span class="s0">, </span><span class="s1">nx])</span>
    <span class="s1">ax.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.5</span><span class="s1">])</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'lines3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_lines3d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">theta = np.linspace(-</span><span class="s3">4 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s3">4 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">z = np.linspace(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">r = z ** </span><span class="s3">2 </span><span class="s1">+ </span><span class="s3">1</span>
    <span class="s1">x = r * np.sin(theta)</span>
    <span class="s1">y = r * np.cos(theta)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_plot_scalar(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax1 = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax1.plot([</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s2">&quot;o&quot;</span><span class="s1">)</span>
    <span class="s1">ax2 = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax2.plot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;o&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_invalid_line_data():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'x must be'</span><span class="s1">):</span>
        <span class="s1">art3d.Line3D(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'y must be'</span><span class="s1">):</span>
        <span class="s1">art3d.Line3D([]</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'z must be'</span><span class="s1">):</span>
        <span class="s1">art3d.Line3D([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s1">line = art3d.Line3D([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'x must be'</span><span class="s1">):</span>
        <span class="s1">line.set_data_3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'y must be'</span><span class="s1">):</span>
        <span class="s1">line.set_data_3d([]</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'z must be'</span><span class="s1">):</span>
        <span class="s1">line.set_data_3d([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'mixedsubplot.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_mixedsubplots():</span>
    <span class="s0">def </span><span class="s1">f(t):</span>
        <span class="s0">return </span><span class="s1">np.cos(</span><span class="s3">2</span><span class="s1">*np.pi*t) * np.exp(-t)</span>

    <span class="s1">t1 = np.arange(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span>
    <span class="s1">t2 = np.arange(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s3">0.02</span><span class="s1">)</span>

    <span class="s1">fig = plt.figure(figsize=plt.figaspect(</span><span class="s3">2.</span><span class="s1">))</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.plot(t1</span><span class="s0">, </span><span class="s1">f(t1)</span><span class="s0">, </span><span class="s2">'bo'</span><span class="s0">, </span><span class="s1">t2</span><span class="s0">, </span><span class="s1">f(t2)</span><span class="s0">, </span><span class="s2">'k--'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s2">'green'</span><span class="s1">)</span>
    <span class="s1">ax.grid(</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">ax = fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(np.arange(-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">))</span>
    <span class="s1">R = np.hypot(X</span><span class="s0">, </span><span class="s1">Y)</span>
    <span class="s1">Z = np.sin(R)</span>

    <span class="s1">ax.plot_surface(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">rcount=</span><span class="s3">40</span><span class="s0">, </span><span class="s1">ccount=</span><span class="s3">40</span><span class="s0">,</span>
                    <span class="s1">linewidth=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">antialiased=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">ax.set_zlim3d(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_tight_layout_text(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s4"># text is currently ignored in tight layout. So the order of text() and</span>
    <span class="s4"># tight_layout() calls should not influence the result.</span>
    <span class="s1">ax1 = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax1.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s1">s=</span><span class="s2">'some string'</span><span class="s1">)</span>
    <span class="s1">fig_test.tight_layout()</span>

    <span class="s1">ax2 = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">fig_ref.tight_layout()</span>
    <span class="s1">ax2.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s1">s=</span><span class="s2">'some string'</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'scatter3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_scatter3d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
               <span class="s1">c=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'o'</span><span class="s1">)</span>
    <span class="s1">x = y = z = np.arange(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">'b'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'^'</span><span class="s1">)</span>
    <span class="s1">z[-</span><span class="s3">1</span><span class="s1">] = </span><span class="s3">0  </span><span class="s4"># Check that scatter() copies the data.</span>
    <span class="s4"># Ensure empty scatters do not break.</span>
    <span class="s1">ax.scatter([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'X'</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'scatter3d_color.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_scatter3d_color():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s4"># Check that 'none' color works; these two should overlay to produce the</span>
    <span class="s4"># same as setting just `color`.</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
               <span class="s1">facecolor=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s2">'none'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'o'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
               <span class="s1">facecolor=</span><span class="s2">'none'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'o'</span><span class="s1">)</span>

    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
               <span class="s1">color=</span><span class="s2">'b'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'s'</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'scatter3d_linewidth.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_scatter3d_linewidth():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s4"># Check that array-like linewidth can be set</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
               <span class="s1">marker=</span><span class="s2">'o'</span><span class="s0">, </span><span class="s1">linewidth=np.arange(</span><span class="s3">10</span><span class="s1">))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_scatter3d_linewidth_modification(fig_ref</span><span class="s0">, </span><span class="s1">fig_test):</span>
    <span class="s4"># Changing Path3DCollection linewidths with array-like post-creation</span>
    <span class="s4"># should work correctly.</span>
    <span class="s1">ax_test = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">c = ax_test.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">marker=</span><span class="s2">'o'</span><span class="s1">)</span>
    <span class="s1">c.set_linewidths(np.arange(</span><span class="s3">10</span><span class="s1">))</span>

    <span class="s1">ax_ref = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_ref.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'o'</span><span class="s0">,</span>
                   <span class="s1">linewidths=np.arange(</span><span class="s3">10</span><span class="s1">))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_scatter3d_modification(fig_ref</span><span class="s0">, </span><span class="s1">fig_test):</span>
    <span class="s4"># Changing Path3DCollection properties post-creation should work correctly.</span>
    <span class="s1">ax_test = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">c = ax_test.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">marker=</span><span class="s2">'o'</span><span class="s1">)</span>
    <span class="s1">c.set_facecolor(</span><span class="s2">'C1'</span><span class="s1">)</span>
    <span class="s1">c.set_edgecolor(</span><span class="s2">'C2'</span><span class="s1">)</span>
    <span class="s1">c.set_alpha([</span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.7</span><span class="s1">] * </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">c.get_depthshade()</span>
    <span class="s1">c.set_depthshade(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">c.get_depthshade()</span>
    <span class="s1">c.set_sizes(np.full(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">75</span><span class="s1">))</span>
    <span class="s1">c.set_linewidths(</span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">ax_ref = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_ref.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'o'</span><span class="s0">,</span>
                   <span class="s1">facecolor=</span><span class="s2">'C1'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s2">'C2'</span><span class="s0">, </span><span class="s1">alpha=[</span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.7</span><span class="s1">] * </span><span class="s3">5</span><span class="s0">,</span>
                   <span class="s1">depthshade=</span><span class="s0">False, </span><span class="s1">s=</span><span class="s3">75</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s3">3</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'depthshade'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_scatter3d_sorting(fig_ref</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">depthshade):</span>
    <span class="s5">&quot;&quot;&quot;Test that marker properties are correctly sorted.&quot;&quot;&quot;</span>

    <span class="s1">y</span><span class="s0">, </span><span class="s1">x = np.mgrid[:</span><span class="s3">10</span><span class="s0">, </span><span class="s1">:</span><span class="s3">10</span><span class="s1">]</span>
    <span class="s1">z = np.arange(x.size).reshape(x.shape)</span>

    <span class="s1">sizes = np.full(z.shape</span><span class="s0">, </span><span class="s3">25</span><span class="s1">)</span>
    <span class="s1">sizes[</span><span class="s3">0</span><span class="s1">::</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">::</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">100</span>
    <span class="s1">sizes[</span><span class="s3">1</span><span class="s1">::</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">::</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">100</span>

    <span class="s1">facecolors = np.full(z.shape</span><span class="s0">, </span><span class="s2">'C0'</span><span class="s1">)</span>
    <span class="s1">facecolors[:</span><span class="s3">5</span><span class="s0">, </span><span class="s1">:</span><span class="s3">5</span><span class="s1">] = </span><span class="s2">'C1'</span>
    <span class="s1">facecolors[</span><span class="s3">6</span><span class="s1">:</span><span class="s0">, </span><span class="s1">:</span><span class="s3">4</span><span class="s1">] = </span><span class="s2">'C2'</span>
    <span class="s1">facecolors[</span><span class="s3">6</span><span class="s1">:</span><span class="s0">, </span><span class="s3">6</span><span class="s1">:] = </span><span class="s2">'C3'</span>

    <span class="s1">edgecolors = np.full(z.shape</span><span class="s0">, </span><span class="s2">'C4'</span><span class="s1">)</span>
    <span class="s1">edgecolors[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">:</span><span class="s3">5</span><span class="s1">] = </span><span class="s2">'C5'</span>
    <span class="s1">edgecolors[</span><span class="s3">5</span><span class="s1">:</span><span class="s3">9</span><span class="s0">, </span><span class="s3">1</span><span class="s1">:</span><span class="s3">5</span><span class="s1">] = </span><span class="s2">'C6'</span>
    <span class="s1">edgecolors[</span><span class="s3">5</span><span class="s1">:</span><span class="s3">9</span><span class="s0">, </span><span class="s3">5</span><span class="s1">:</span><span class="s3">9</span><span class="s1">] = </span><span class="s2">'C7'</span>

    <span class="s1">linewidths = np.full(z.shape</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">linewidths[</span><span class="s3">0</span><span class="s1">::</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">::</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">5</span>
    <span class="s1">linewidths[</span><span class="s3">1</span><span class="s1">::</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">::</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">5</span>

    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">sizes</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors</span><span class="s0">, </span><span class="s1">linewidths = [</span>
        <span class="s1">a.flatten()</span>
        <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">[x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">sizes</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors</span><span class="s0">, </span><span class="s1">linewidths]</span>
    <span class="s1">]</span>

    <span class="s1">ax_ref = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">sets = (np.unique(a) </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">[sizes</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors</span><span class="s0">, </span><span class="s1">linewidths])</span>
    <span class="s0">for </span><span class="s1">s</span><span class="s0">, </span><span class="s1">fc</span><span class="s0">, </span><span class="s1">ec</span><span class="s0">, </span><span class="s1">lw </span><span class="s0">in </span><span class="s1">itertools.product(*sets):</span>
        <span class="s1">subset = (</span>
            <span class="s1">(sizes != s) |</span>
            <span class="s1">(facecolors != fc) |</span>
            <span class="s1">(edgecolors != ec) |</span>
            <span class="s1">(linewidths != lw)</span>
        <span class="s1">)</span>
        <span class="s1">subset = np.ma.masked_array(z</span><span class="s0">, </span><span class="s1">subset</span><span class="s0">, </span><span class="s1">dtype=float)</span>

        <span class="s4"># When depth shading is disabled, the colors are passed through as</span>
        <span class="s4"># single-item lists; this triggers single path optimization. The</span>
        <span class="s4"># following reshaping is a hack to disable that, since the optimization</span>
        <span class="s4"># would not occur for the full scatter which has multiple colors.</span>
        <span class="s1">fc = np.repeat(fc</span><span class="s0">, </span><span class="s1">sum(~subset.mask))</span>

        <span class="s1">ax_ref.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">subset</span><span class="s0">, </span><span class="s1">s=s</span><span class="s0">, </span><span class="s1">fc=fc</span><span class="s0">, </span><span class="s1">ec=ec</span><span class="s0">, </span><span class="s1">lw=lw</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">1</span><span class="s0">,</span>
                       <span class="s1">depthshade=depthshade)</span>

    <span class="s1">ax_test = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_test.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">s=sizes</span><span class="s0">, </span><span class="s1">fc=facecolors</span><span class="s0">, </span><span class="s1">ec=edgecolors</span><span class="s0">,</span>
                    <span class="s1">lw=linewidths</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">depthshade=depthshade)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'azim'</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">50</span><span class="s0">, </span><span class="s3">130</span><span class="s1">])  </span><span class="s4"># yellow first, blue first</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_marker_draw_order_data_reversed(fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">azim):</span>
    <span class="s5">&quot;&quot;&quot; 
    Test that the draw order does not depend on the data point order. 
 
    For the given viewing angle at azim=-50, the yellow marker should be in 
    front. For azim=130, the blue marker should be in front. 
    &quot;&quot;&quot;</span>
    <span class="s1">x = [-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">z = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">color = [</span><span class="s2">'b'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s1">]</span>
    <span class="s1">ax = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">3500</span><span class="s0">, </span><span class="s1">c=color)</span>
    <span class="s1">ax.view_init(elev=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">azim=azim</span><span class="s0">, </span><span class="s1">roll=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">ax = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(x[::-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[::-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">z[::-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">3500</span><span class="s0">, </span><span class="s1">c=color[::-</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax.view_init(elev=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">azim=azim</span><span class="s0">, </span><span class="s1">roll=</span><span class="s3">0</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_marker_draw_order_view_rotated(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s5">&quot;&quot;&quot; 
    Test that the draw order changes with the direction. 
 
    If we rotate *azim* by 180 degrees and exchange the colors, the plot 
    plot should look the same again. 
    &quot;&quot;&quot;</span>
    <span class="s1">azim = </span><span class="s3">130</span>
    <span class="s1">x = [-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">z = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">color = [</span><span class="s2">'b'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s1">]</span>
    <span class="s1">ax = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s4"># axis are not exactly invariant under 180 degree rotation -&gt; deactivate</span>
    <span class="s1">ax.set_axis_off()</span>
    <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">3500</span><span class="s0">, </span><span class="s1">c=color)</span>
    <span class="s1">ax.view_init(elev=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">azim=azim</span><span class="s0">, </span><span class="s1">roll=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">ax = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.set_axis_off()</span>
    <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">3500</span><span class="s0">, </span><span class="s1">c=color[::-</span><span class="s3">1</span><span class="s1">])  </span><span class="s4"># color reversed</span>
    <span class="s1">ax.view_init(elev=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">azim=azim - </span><span class="s3">180</span><span class="s0">, </span><span class="s1">roll=</span><span class="s3">0</span><span class="s1">)  </span><span class="s4"># view rotated by 180 deg</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'plot_3d_from_2d.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s3">0.015</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_plot_3d_from_2d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">xs = np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">ys = np.arange(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.plot(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'x'</span><span class="s1">)</span>
    <span class="s1">ax.plot(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'y'</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'surface3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_surface3d():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X = np.arange(-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span>
    <span class="s1">Y = np.arange(-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(X</span><span class="s0">, </span><span class="s1">Y)</span>
    <span class="s1">R = np.hypot(X</span><span class="s0">, </span><span class="s1">Y)</span>
    <span class="s1">Z = np.sin(R)</span>
    <span class="s1">surf = ax.plot_surface(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">rcount=</span><span class="s3">40</span><span class="s0">, </span><span class="s1">ccount=</span><span class="s3">40</span><span class="s0">, </span><span class="s1">cmap=cm.coolwarm</span><span class="s0">,</span>
                           <span class="s1">lw=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">antialiased=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(-</span><span class="s3">1.01</span><span class="s0">, </span><span class="s3">1.01</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(surf</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s3">5</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'surface3d_shaded.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_surface3d_shaded():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X = np.arange(-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span>
    <span class="s1">Y = np.arange(-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(X</span><span class="s0">, </span><span class="s1">Y)</span>
    <span class="s1">R = np.sqrt(X ** </span><span class="s3">2 </span><span class="s1">+ Y ** </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">Z = np.sin(R)</span>
    <span class="s1">ax.plot_surface(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">rstride=</span><span class="s3">5</span><span class="s0">, </span><span class="s1">cstride=</span><span class="s3">5</span><span class="s0">,</span>
                    <span class="s1">color=[</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">antialiased=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(-</span><span class="s3">1.01</span><span class="s0">, </span><span class="s3">1.01</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'surface3d_masked.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_surface3d_masked():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">x = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">11</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s1">]</span>

    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">matrix = np.array(</span>
        <span class="s1">[</span>
            <span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">16</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">16</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">16</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">11</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">22</span><span class="s0">, </span><span class="s3">24</span><span class="s0">, </span><span class="s3">22</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">18</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">28</span><span class="s0">, </span><span class="s3">26</span><span class="s0">, </span><span class="s3">25</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">z = np.ma.masked_less(matrix</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.Normalize(vmax=z.max()</span><span class="s0">, </span><span class="s1">vmin=z.min())</span>
    <span class="s1">colors = mpl.colormaps[</span><span class="s2">&quot;plasma&quot;</span><span class="s1">](norm(z))</span>
    <span class="s1">ax.plot_surface(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">facecolors=colors)</span>
    <span class="s1">ax.view_init(</span><span class="s3">30</span><span class="s0">, </span><span class="s1">-</span><span class="s3">80</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_plot_surface_None_arg(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(np.arange(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">z = x + y</span>
    <span class="s1">ax_test = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_test.plot_surface(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">facecolors=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">ax_ref = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_ref.plot_surface(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'surface3d_masked_strides.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_surface3d_masked_strides():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.mgrid[-</span><span class="s3">6</span><span class="s1">:</span><span class="s3">6.1</span><span class="s1">:</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">6</span><span class="s1">:</span><span class="s3">6.1</span><span class="s1">:</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">z = np.ma.masked_less(x * y</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">ax.plot_surface(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">rstride=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">cstride=</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">ax.view_init(</span><span class="s3">60</span><span class="s0">, </span><span class="s1">-</span><span class="s3">45</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'text3d.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_text3d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">zdirs = (</span><span class="s0">None, </span><span class="s2">'x'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">, </span><span class="s2">'z'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">xs = (</span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ys = (</span><span class="s3">6</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">zs = (</span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">7</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">zdir</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z </span><span class="s0">in </span><span class="s1">zip(zdirs</span><span class="s0">, </span><span class="s1">xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs):</span>
        <span class="s1">label = </span><span class="s2">'(%d, %d, %d), dir=%s' </span><span class="s1">% (x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zdir)</span>
        <span class="s1">ax.text(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">label</span><span class="s0">, </span><span class="s1">zdir)</span>

    <span class="s1">ax.text(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;red&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'red'</span><span class="s1">)</span>
    <span class="s1">ax.text2D(</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.95</span><span class="s0">, </span><span class="s2">&quot;2D Text&quot;</span><span class="s0">, </span><span class="s1">transform=ax.transAxes)</span>
    <span class="s1">ax.set_xlim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s2">'X axis'</span><span class="s1">)</span>
    <span class="s1">ax.set_ylabel(</span><span class="s2">'Y axis'</span><span class="s1">)</span>
    <span class="s1">ax.set_zlabel(</span><span class="s2">'Z axis'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_text3d_modification(fig_ref</span><span class="s0">, </span><span class="s1">fig_test):</span>
    <span class="s4"># Modifying the Text position after the fact should work the same as</span>
    <span class="s4"># setting it directly.</span>
    <span class="s1">zdirs = (</span><span class="s0">None, </span><span class="s2">'x'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">, </span><span class="s2">'z'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">xs = (</span><span class="s3">2</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ys = (</span><span class="s3">6</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">zs = (</span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">7</span><span class="s1">)</span>

    <span class="s1">ax_test = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_test.set_xlim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax_test.set_ylim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax_test.set_zlim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">zdir</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z </span><span class="s0">in </span><span class="s1">zip(zdirs</span><span class="s0">, </span><span class="s1">xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs):</span>
        <span class="s1">t = ax_test.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">f'(</span><span class="s0">{</span><span class="s1">x</span><span class="s0">}</span><span class="s2">, </span><span class="s0">{</span><span class="s1">y</span><span class="s0">}</span><span class="s2">, </span><span class="s0">{</span><span class="s1">z</span><span class="s0">}</span><span class="s2">), dir=</span><span class="s0">{</span><span class="s1">zdir</span><span class="s0">}</span><span class="s2">'</span><span class="s1">)</span>
        <span class="s1">t.set_position_3d((x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span><span class="s0">, </span><span class="s1">zdir=zdir)</span>

    <span class="s1">ax_ref = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_ref.set_xlim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax_ref.set_ylim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax_ref.set_zlim3d(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">zdir</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z </span><span class="s0">in </span><span class="s1">zip(zdirs</span><span class="s0">, </span><span class="s1">xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs):</span>
        <span class="s1">ax_ref.text(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s2">f'(</span><span class="s0">{</span><span class="s1">x</span><span class="s0">}</span><span class="s2">, </span><span class="s0">{</span><span class="s1">y</span><span class="s0">}</span><span class="s2">, </span><span class="s0">{</span><span class="s1">z</span><span class="s0">}</span><span class="s2">), dir=</span><span class="s0">{</span><span class="s1">zdir</span><span class="s0">}</span><span class="s2">'</span><span class="s0">, </span><span class="s1">zdir=zdir)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'trisurf3d.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s3">0.061</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_trisurf3d():</span>
    <span class="s1">n_angles = </span><span class="s3">36</span>
    <span class="s1">n_radii = </span><span class="s3">8</span>
    <span class="s1">radii = np.linspace(</span><span class="s3">0.125</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">n_radii)</span>
    <span class="s1">angles = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi</span><span class="s0">, </span><span class="s1">n_angles</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">angles = np.repeat(angles[...</span><span class="s0">, </span><span class="s1">np.newaxis]</span><span class="s0">, </span><span class="s1">n_radii</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">angles[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">::</span><span class="s3">2</span><span class="s1">] += np.pi/n_angles</span>

    <span class="s1">x = np.append(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">(radii*np.cos(angles)).flatten())</span>
    <span class="s1">y = np.append(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">(radii*np.sin(angles)).flatten())</span>
    <span class="s1">z = np.sin(-x*y)</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.plot_trisurf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">cmap=cm.jet</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s3">0.2</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'trisurf3d_shaded.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s3">0.03</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_trisurf3d_shaded():</span>
    <span class="s1">n_angles = </span><span class="s3">36</span>
    <span class="s1">n_radii = </span><span class="s3">8</span>
    <span class="s1">radii = np.linspace(</span><span class="s3">0.125</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">n_radii)</span>
    <span class="s1">angles = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi</span><span class="s0">, </span><span class="s1">n_angles</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">angles = np.repeat(angles[...</span><span class="s0">, </span><span class="s1">np.newaxis]</span><span class="s0">, </span><span class="s1">n_radii</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">angles[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">::</span><span class="s3">2</span><span class="s1">] += np.pi/n_angles</span>

    <span class="s1">x = np.append(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">(radii*np.cos(angles)).flatten())</span>
    <span class="s1">y = np.append(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">(radii*np.sin(angles)).flatten())</span>
    <span class="s1">z = np.sin(-x*y)</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.plot_trisurf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">color=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s3">0.2</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'wireframe3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_wireframe3d():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z = axes3d.get_test_data(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s1">ax.plot_wireframe(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">rcount=</span><span class="s3">13</span><span class="s0">, </span><span class="s1">ccount=</span><span class="s3">13</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'wireframe3dzerocstride.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_wireframe3dzerocstride():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z = axes3d.get_test_data(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s1">ax.plot_wireframe(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">rcount=</span><span class="s3">13</span><span class="s0">, </span><span class="s1">ccount=</span><span class="s3">0</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'wireframe3dzerorstride.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_wireframe3dzerorstride():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z = axes3d.get_test_data(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s1">ax.plot_wireframe(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">rstride=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">cstride=</span><span class="s3">10</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_wireframe3dzerostrideraises():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z = axes3d.get_test_data(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.plot_wireframe(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">rstride=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">cstride=</span><span class="s3">0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_mixedsamplesraises():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z = axes3d.get_test_data(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.plot_wireframe(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">rstride=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">ccount=</span><span class="s3">50</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.plot_surface(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">cstride=</span><span class="s3">50</span><span class="s0">, </span><span class="s1">rcount=</span><span class="s3">10</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison(</span>
    <span class="s1">[</span><span class="s2">'quiver3d.png'</span><span class="s0">, </span><span class="s2">'quiver3d_pivot_middle.png'</span><span class="s0">, </span><span class="s2">'quiver3d_pivot_tail.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_quiver3d():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.ogrid[-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0.8</span><span class="s1">:</span><span class="s3">10j</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0.8</span><span class="s1">:</span><span class="s3">10j</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0.6</span><span class="s1">:</span><span class="s3">3j</span><span class="s1">]</span>
    <span class="s1">u = np.sin(np.pi * x) * np.cos(np.pi * y) * np.cos(np.pi * z)</span>
    <span class="s1">v = -np.cos(np.pi * x) * np.sin(np.pi * y) * np.cos(np.pi * z)</span>
    <span class="s1">w = (</span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s1">)**</span><span class="s3">0.5 </span><span class="s1">* np.cos(np.pi * x) * np.cos(np.pi * y) * np.sin(np.pi * z)</span>
    <span class="s0">for </span><span class="s1">pivot </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'tip'</span><span class="s0">, </span><span class="s2">'middle'</span><span class="s0">, </span><span class="s2">'tail'</span><span class="s1">]:</span>
        <span class="s1">ax = plt.figure().add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
        <span class="s1">ax.quiver(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">u</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">length=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">pivot=pivot</span><span class="s0">, </span><span class="s1">normalize=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_quiver3d_empty(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">x = y = z = u = v = w = []</span>
    <span class="s1">ax = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.quiver(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">u</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">length=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">pivot=</span><span class="s2">'tip'</span><span class="s0">, </span><span class="s1">normalize=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'quiver3d_masked.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_quiver3d_masked():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s4"># Using mgrid here instead of ogrid because masked_where doesn't</span>
    <span class="s4"># seem to like broadcasting very much...</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.mgrid[-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0.8</span><span class="s1">:</span><span class="s3">10j</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0.8</span><span class="s1">:</span><span class="s3">10j</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0.6</span><span class="s1">:</span><span class="s3">3j</span><span class="s1">]</span>

    <span class="s1">u = np.sin(np.pi * x) * np.cos(np.pi * y) * np.cos(np.pi * z)</span>
    <span class="s1">v = -np.cos(np.pi * x) * np.sin(np.pi * y) * np.cos(np.pi * z)</span>
    <span class="s1">w = (</span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s1">)**</span><span class="s3">0.5 </span><span class="s1">* np.cos(np.pi * x) * np.cos(np.pi * y) * np.sin(np.pi * z)</span>
    <span class="s1">u = np.ma.masked_where((-</span><span class="s3">0.4 </span><span class="s1">&lt; x) &amp; (x &lt; </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">u</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">v = np.ma.masked_where((</span><span class="s3">0.1 </span><span class="s1">&lt; y) &amp; (y &lt; </span><span class="s3">0.7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">copy=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">ax.quiver(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">u</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">length=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">pivot=</span><span class="s2">'tip'</span><span class="s0">, </span><span class="s1">normalize=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_patch_modification():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">circle = Circle((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">ax.add_patch(circle)</span>
    <span class="s1">art3d.patch_2d_to_3d(circle)</span>
    <span class="s1">circle.set_facecolor((</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>

    <span class="s0">assert </span><span class="s1">mcolors.same_color(circle.get_facecolor()</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">mcolors.same_color(circle.get_facecolor()</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_patch_collection_modification(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s4"># Test that modifying Patch3DCollection properties after creation works.</span>
    <span class="s1">patch1 = Circle((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s1">patch2 = Circle((</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.03</span><span class="s1">)</span>
    <span class="s1">facecolors = np.array([[</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]])</span>
    <span class="s1">c = art3d.Patch3DCollection([patch1</span><span class="s0">, </span><span class="s1">patch2]</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">ax_test = fig_test.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_test.add_collection3d(c)</span>
    <span class="s1">c.set_edgecolor(</span><span class="s2">'C2'</span><span class="s1">)</span>
    <span class="s1">c.set_facecolor(facecolors)</span>
    <span class="s1">c.set_alpha(</span><span class="s3">0.7</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">c.get_depthshade()</span>
    <span class="s1">c.set_depthshade(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">c.get_depthshade()</span>

    <span class="s1">patch1 = Circle((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s1">patch2 = Circle((</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.03</span><span class="s1">)</span>
    <span class="s1">facecolors = np.array([[</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]])</span>
    <span class="s1">c = art3d.Patch3DCollection([patch1</span><span class="s0">, </span><span class="s1">patch2]</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s3">3</span><span class="s0">,</span>
                                <span class="s1">edgecolor=</span><span class="s2">'C2'</span><span class="s0">, </span><span class="s1">facecolor=facecolors</span><span class="s0">,</span>
                                <span class="s1">alpha=</span><span class="s3">0.7</span><span class="s0">, </span><span class="s1">depthshade=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">ax_ref = fig_ref.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax_ref.add_collection3d(c)</span>


<span class="s0">def </span><span class="s1">test_poly3dcollection_verts_validation():</span>
    <span class="s1">poly = [[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">r'list of \(N, 3\) array-like'</span><span class="s1">):</span>
        <span class="s1">art3d.Poly3DCollection(poly)  </span><span class="s4"># should be Poly3DCollection([poly])</span>

    <span class="s1">poly = np.array(poly</span><span class="s0">, </span><span class="s1">dtype=float)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">r'list of \(N, 3\) array-like'</span><span class="s1">):</span>
        <span class="s1">art3d.Poly3DCollection(poly)  </span><span class="s4"># should be Poly3DCollection([poly])</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'poly3dcollection_closed.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_poly3dcollection_closed():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">poly1 = np.array([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">float)</span>
    <span class="s1">poly2 = np.array([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">float)</span>
    <span class="s1">c1 = art3d.Poly3DCollection([poly1]</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s2">'k'</span><span class="s0">,</span>
                                <span class="s1">facecolor=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">closed=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">c2 = art3d.Poly3DCollection([poly2]</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s2">'k'</span><span class="s0">,</span>
                                <span class="s1">facecolor=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">closed=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.add_collection3d(c1)</span>
    <span class="s1">ax.add_collection3d(c2)</span>


<span class="s0">def </span><span class="s1">test_poly_collection_2d_to_3d_empty():</span>
    <span class="s1">poly = PolyCollection([])</span>
    <span class="s1">art3d.poly_collection_2d_to_3d(poly)</span>
    <span class="s0">assert </span><span class="s1">isinstance(poly</span><span class="s0">, </span><span class="s1">art3d.Poly3DCollection)</span>
    <span class="s0">assert </span><span class="s1">poly.get_paths() == []</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(projection=</span><span class="s2">'3d'</span><span class="s1">))</span>
    <span class="s1">ax.add_artist(poly)</span>
    <span class="s1">minz = poly.do_3d_projection()</span>
    <span class="s0">assert </span><span class="s1">np.isnan(minz)</span>

    <span class="s4"># Ensure drawing actually works.</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'poly3dcollection_alpha.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_poly3dcollection_alpha():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">poly1 = np.array([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">float)</span>
    <span class="s1">poly2 = np.array([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">float)</span>
    <span class="s1">c1 = art3d.Poly3DCollection([poly1]</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s2">'k'</span><span class="s0">,</span>
                                <span class="s1">facecolor=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">closed=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">c1.set_alpha(</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">c2 = art3d.Poly3DCollection([poly2]</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">closed=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s4"># Post-creation modification should work.</span>
    <span class="s1">c2.set_facecolor((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">))</span>
    <span class="s1">c2.set_edgecolor(</span><span class="s2">'k'</span><span class="s1">)</span>
    <span class="s1">c2.set_alpha(</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">ax.add_collection3d(c1)</span>
    <span class="s1">ax.add_collection3d(c2)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'add_collection3d_zs_array.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_add_collection3d_zs_array():</span>
    <span class="s1">theta = np.linspace(-</span><span class="s3">4 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s3">4 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">z = np.linspace(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">r = z**</span><span class="s3">2 </span><span class="s1">+ </span><span class="s3">1</span>
    <span class="s1">x = r * np.sin(theta)</span>
    <span class="s1">y = r * np.cos(theta)</span>

    <span class="s1">points = np.column_stack([x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z]).reshape(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">segments = np.concatenate([points[:-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">points[</span><span class="s3">1</span><span class="s1">:]]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">norm = plt.Normalize(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi)</span>
    <span class="s4"># 2D LineCollection from x &amp; y values</span>
    <span class="s1">lc = LineCollection(segments[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s1">:</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'twilight'</span><span class="s0">, </span><span class="s1">norm=norm)</span>
    <span class="s1">lc.set_array(np.mod(theta</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi))</span>
    <span class="s4"># Add 2D collection at z values to ax</span>
    <span class="s1">line = ax.add_collection3d(lc</span><span class="s0">, </span><span class="s1">zs=segments[:</span><span class="s0">, </span><span class="s1">:</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>

    <span class="s0">assert </span><span class="s1">line </span><span class="s0">is not None</span>

    <span class="s1">ax.set_xlim(-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'add_collection3d_zs_scalar.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_add_collection3d_zs_scalar():</span>
    <span class="s1">theta = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">z = </span><span class="s3">1</span>
    <span class="s1">r = z**</span><span class="s3">2 </span><span class="s1">+ </span><span class="s3">1</span>
    <span class="s1">x = r * np.sin(theta)</span>
    <span class="s1">y = r * np.cos(theta)</span>

    <span class="s1">points = np.column_stack([x</span><span class="s0">, </span><span class="s1">y]).reshape(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">segments = np.concatenate([points[:-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">points[</span><span class="s3">1</span><span class="s1">:]]</span><span class="s0">, </span><span class="s1">axis=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">norm = plt.Normalize(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi)</span>
    <span class="s1">lc = LineCollection(segments</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'twilight'</span><span class="s0">, </span><span class="s1">norm=norm)</span>
    <span class="s1">lc.set_array(theta)</span>
    <span class="s1">line = ax.add_collection3d(lc</span><span class="s0">, </span><span class="s1">zs=z)</span>

    <span class="s0">assert </span><span class="s1">line </span><span class="s0">is not None</span>

    <span class="s1">ax.set_xlim(-</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'axes3d_labelpad.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axes3d_labelpad():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_axes(Axes3D(fig))</span>
    <span class="s4"># labelpad respects rcParams</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.labelpad == mpl.rcParams[</span><span class="s2">'axes.labelpad'</span><span class="s1">]</span>
    <span class="s4"># labelpad can be set in set_label</span>
    <span class="s1">ax.set_xlabel(</span><span class="s2">'X LABEL'</span><span class="s0">, </span><span class="s1">labelpad=</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.labelpad == </span><span class="s3">10</span>
    <span class="s1">ax.set_ylabel(</span><span class="s2">'Y LABEL'</span><span class="s1">)</span>
    <span class="s1">ax.set_zlabel(</span><span class="s2">'Z LABEL'</span><span class="s0">, </span><span class="s1">labelpad=</span><span class="s3">20</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.zaxis.labelpad == </span><span class="s3">20</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlabel() == </span><span class="s2">'Z LABEL'</span>
    <span class="s4"># or manually</span>
    <span class="s1">ax.yaxis.labelpad = </span><span class="s3">20</span>
    <span class="s1">ax.zaxis.labelpad = -</span><span class="s3">40</span>

    <span class="s4"># Tick labels also respect tick.pad (also from rcParams)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">enumerate(ax.yaxis.get_major_ticks()):</span>
        <span class="s1">tick.set_pad(tick.get_pad() - i * </span><span class="s3">5</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'axes3d_cla.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axes3d_cla():</span>
    <span class="s4"># fixed in pull request 4553</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.set_axis_off()</span>
    <span class="s1">ax.cla()  </span><span class="s4"># make sure the axis displayed is 3D (not 2D)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'axes3d_rotated.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axes3d_rotated():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.view_init(</span><span class="s3">90</span><span class="s0">, </span><span class="s3">45</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)  </span><span class="s4"># look down, rotated. Should be square</span>


<span class="s0">def </span><span class="s1">test_plotsurface_1d_raises():</span>
    <span class="s1">x = np.linspace(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s1">num=</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">y = np.linspace(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s1">num=</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">z = np.random.randn(</span><span class="s3">100</span><span class="s1">)</span>

    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">14</span><span class="s0">, </span><span class="s3">6</span><span class="s1">))</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.plot_surface(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">z)</span>


<span class="s0">def </span><span class="s1">_test_proj_make_M():</span>
    <span class="s4"># eye point</span>
    <span class="s1">E = np.array([</span><span class="s3">1000</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1000</span><span class="s0">, </span><span class="s3">2000</span><span class="s1">])</span>
    <span class="s1">R = np.array([</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">])</span>
    <span class="s1">V = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">roll = </span><span class="s3">0</span>
    <span class="s1">u</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">w = proj3d._view_axes(E</span><span class="s0">, </span><span class="s1">R</span><span class="s0">, </span><span class="s1">V</span><span class="s0">, </span><span class="s1">roll)</span>
    <span class="s1">viewM = proj3d._view_transformation_uvw(u</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">E)</span>
    <span class="s1">perspM = proj3d.persp_transformation(</span><span class="s3">100</span><span class="s0">, </span><span class="s1">-</span><span class="s3">100</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">M = np.dot(perspM</span><span class="s0">, </span><span class="s1">viewM)</span>
    <span class="s0">return </span><span class="s1">M</span>


<span class="s0">def </span><span class="s1">test_proj_transform():</span>
    <span class="s1">M = _test_proj_make_M()</span>

    <span class="s1">xs = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]) * </span><span class="s3">300.0</span>
    <span class="s1">ys = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]) * </span><span class="s3">300.0</span>
    <span class="s1">zs = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]) * </span><span class="s3">300.0</span>

    <span class="s1">txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">tzs = proj3d.proj_transform(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs</span><span class="s0">, </span><span class="s1">M)</span>
    <span class="s1">ixs</span><span class="s0">, </span><span class="s1">iys</span><span class="s0">, </span><span class="s1">izs = proj3d.inv_transform(txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">tzs</span><span class="s0">, </span><span class="s1">M)</span>

    <span class="s1">np.testing.assert_almost_equal(ixs</span><span class="s0">, </span><span class="s1">xs)</span>
    <span class="s1">np.testing.assert_almost_equal(iys</span><span class="s0">, </span><span class="s1">ys)</span>
    <span class="s1">np.testing.assert_almost_equal(izs</span><span class="s0">, </span><span class="s1">zs)</span>


<span class="s0">def </span><span class="s1">_test_proj_draw_axes(M</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">*args</span><span class="s0">, </span><span class="s1">**kwargs):</span>
    <span class="s1">xs = [</span><span class="s3">0</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">ys = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">zs = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">s]</span>
    <span class="s1">txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">tzs = proj3d.proj_transform(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs</span><span class="s0">, </span><span class="s1">M)</span>
    <span class="s1">o</span><span class="s0">, </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">ay</span><span class="s0">, </span><span class="s1">az = zip(txs</span><span class="s0">, </span><span class="s1">tys)</span>
    <span class="s1">lines = [(o</span><span class="s0">, </span><span class="s1">ax)</span><span class="s0">, </span><span class="s1">(o</span><span class="s0">, </span><span class="s1">ay)</span><span class="s0">, </span><span class="s1">(o</span><span class="s0">, </span><span class="s1">az)]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(*args</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">linec = LineCollection(lines)</span>
    <span class="s1">ax.add_collection(linec)</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">t </span><span class="s0">in </span><span class="s1">zip(txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'o'</span><span class="s0">, </span><span class="s2">'x'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">, </span><span class="s2">'z'</span><span class="s1">]):</span>
        <span class="s1">ax.text(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">t)</span>

    <span class="s0">return </span><span class="s1">fig</span><span class="s0">, </span><span class="s1">ax</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'proj3d_axes_cube.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_proj_axes_cube():</span>
    <span class="s1">M = _test_proj_make_M()</span>

    <span class="s1">ts = </span><span class="s2">'0 1 2 3 0 4 5 6 7 4'</span><span class="s1">.split()</span>
    <span class="s1">xs = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]) * </span><span class="s3">300.0</span>
    <span class="s1">ys = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]) * </span><span class="s3">300.0</span>
    <span class="s1">zs = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]) * </span><span class="s3">300.0</span>

    <span class="s1">txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">tzs = proj3d.proj_transform(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs</span><span class="s0">, </span><span class="s1">M)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = _test_proj_draw_axes(M</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">400</span><span class="s1">)</span>

    <span class="s1">ax.scatter(txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">c=tzs)</span>
    <span class="s1">ax.plot(txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">t </span><span class="s0">in </span><span class="s1">zip(txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">ts):</span>
        <span class="s1">ax.text(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">t)</span>

    <span class="s1">ax.set_xlim(-</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'proj3d_axes_cube_ortho.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_proj_axes_cube_ortho():</span>
    <span class="s1">E = np.array([</span><span class="s3">200</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">])</span>
    <span class="s1">R = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">V = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">roll = </span><span class="s3">0</span>
    <span class="s1">u</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">w = proj3d._view_axes(E</span><span class="s0">, </span><span class="s1">R</span><span class="s0">, </span><span class="s1">V</span><span class="s0">, </span><span class="s1">roll)</span>
    <span class="s1">viewM = proj3d._view_transformation_uvw(u</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">E)</span>
    <span class="s1">orthoM = proj3d.ortho_transformation(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">M = np.dot(orthoM</span><span class="s0">, </span><span class="s1">viewM)</span>

    <span class="s1">ts = </span><span class="s2">'0 1 2 3 0 4 5 6 7 4'</span><span class="s1">.split()</span>
    <span class="s1">xs = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]) * </span><span class="s3">100</span>
    <span class="s1">ys = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]) * </span><span class="s3">100</span>
    <span class="s1">zs = np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]) * </span><span class="s3">100</span>

    <span class="s1">txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">tzs = proj3d.proj_transform(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">zs</span><span class="s0">, </span><span class="s1">M)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = _test_proj_draw_axes(M</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">150</span><span class="s1">)</span>

    <span class="s1">ax.scatter(txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">300</span><span class="s1">-tzs)</span>
    <span class="s1">ax.plot(txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">t </span><span class="s0">in </span><span class="s1">zip(txs</span><span class="s0">, </span><span class="s1">tys</span><span class="s0">, </span><span class="s1">ts):</span>
        <span class="s1">ax.text(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">t)</span>

    <span class="s1">ax.set_xlim(-</span><span class="s3">200</span><span class="s0">, </span><span class="s3">200</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">200</span><span class="s0">, </span><span class="s3">200</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_rot():</span>
    <span class="s1">V = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">rotated_V = proj3d.rot_x(V</span><span class="s0">, </span><span class="s1">np.pi / </span><span class="s3">6</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(rotated_V</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>

    <span class="s1">V = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">rotated_V = proj3d.rot_x(V</span><span class="s0">, </span><span class="s1">np.pi / </span><span class="s3">6</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(rotated_V</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.sqrt(</span><span class="s3">3</span><span class="s1">) / </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_world():</span>
    <span class="s1">xmin</span><span class="s0">, </span><span class="s1">xmax = </span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span>
    <span class="s1">ymin</span><span class="s0">, </span><span class="s1">ymax = -</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span>
    <span class="s1">zmin</span><span class="s0">, </span><span class="s1">zmax = </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span>
    <span class="s1">M = proj3d.world_transformation(xmin</span><span class="s0">, </span><span class="s1">xmax</span><span class="s0">, </span><span class="s1">ymin</span><span class="s0">, </span><span class="s1">ymax</span><span class="s0">, </span><span class="s1">zmin</span><span class="s0">, </span><span class="s1">zmax)</span>
    <span class="s1">np.testing.assert_allclose(M</span><span class="s0">,</span>
                               <span class="s1">[[</span><span class="s3">5e-2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">5</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5e-3</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">5e-1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1e1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]])</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'proj3d_lines_dists.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_lines_dists():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">subplot_kw=dict(aspect=</span><span class="s2">'equal'</span><span class="s1">))</span>

    <span class="s1">xs = (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span>
    <span class="s1">ys = (</span><span class="s3">20</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span>
    <span class="s1">ax.plot(xs</span><span class="s0">, </span><span class="s1">ys)</span>
    <span class="s1">p0</span><span class="s0">, </span><span class="s1">p1 = zip(xs</span><span class="s0">, </span><span class="s1">ys)</span>

    <span class="s1">xs = (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span>
    <span class="s1">ys = (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">200</span><span class="s1">)</span>
    <span class="s1">ax.scatter(xs</span><span class="s0">, </span><span class="s1">ys)</span>

    <span class="s1">dist0 = proj3d._line2d_seg_dist((xs[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">p0</span><span class="s0">, </span><span class="s1">p1)</span>
    <span class="s1">dist = proj3d._line2d_seg_dist(np.array((xs</span><span class="s0">, </span><span class="s1">ys)).T</span><span class="s0">, </span><span class="s1">p0</span><span class="s0">, </span><span class="s1">p1)</span>
    <span class="s0">assert </span><span class="s1">dist0 == dist[</span><span class="s3">0</span><span class="s1">]</span>

    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">d </span><span class="s0">in </span><span class="s1">zip(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">dist):</span>
        <span class="s1">c = Circle((x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">d</span><span class="s0">, </span><span class="s1">fill=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">ax.add_patch(c)</span>

    <span class="s1">ax.set_xlim(-</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">300</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_lines_dists_nowarning():</span>
    <span class="s4"># No RuntimeWarning must be emitted for degenerate segments, see GH#22624.</span>
    <span class="s1">s0 = (</span><span class="s3">10</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span>
    <span class="s1">p = (</span><span class="s3">20</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">180</span><span class="s1">)</span>
    <span class="s1">proj3d._line2d_seg_dist(p</span><span class="s0">, </span><span class="s1">s0</span><span class="s0">, </span><span class="s1">s0)</span>
    <span class="s1">proj3d._line2d_seg_dist(np.array(p)</span><span class="s0">, </span><span class="s1">s0</span><span class="s0">, </span><span class="s1">s0)</span>


<span class="s0">def </span><span class="s1">test_autoscale():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">ax.get_zscale() == </span><span class="s2">'linear'</span>
    <span class="s1">ax.margins(x=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">y=</span><span class="s3">.1</span><span class="s0">, </span><span class="s1">z=</span><span class="s3">.2</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_w_lims() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">1.1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">.2</span><span class="s0">, </span><span class="s3">1.2</span><span class="s1">)</span>
    <span class="s1">ax.autoscale(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.set_autoscalez_on(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_w_lims() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">1.1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">.4</span><span class="s0">, </span><span class="s3">2.4</span><span class="s1">)</span>
    <span class="s1">ax.autoscale(axis=</span><span class="s2">'x'</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_w_lims() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">1.1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">.4</span><span class="s0">, </span><span class="s3">2.4</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'axis'</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'x'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">, </span><span class="s2">'z'</span><span class="s1">))</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'auto'</span><span class="s0">, </span><span class="s1">(</span><span class="s0">True, False, None</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_unautoscale(axis</span><span class="s0">, </span><span class="s1">auto):</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">x = np.arange(</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">y = np.linspace(-</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">get_autoscale_on = getattr(ax</span><span class="s0">, </span><span class="s2">f'get_autoscale</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s2">_on'</span><span class="s1">)</span>
    <span class="s1">set_lim = getattr(ax</span><span class="s0">, </span><span class="s2">f'set_</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s2">lim'</span><span class="s1">)</span>
    <span class="s1">get_lim = getattr(ax</span><span class="s0">, </span><span class="s2">f'get_</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s2">lim'</span><span class="s1">)</span>

    <span class="s1">post_auto = get_autoscale_on() </span><span class="s0">if </span><span class="s1">auto </span><span class="s0">is None else </span><span class="s1">auto</span>

    <span class="s1">set_lim((-</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">auto=auto)</span>
    <span class="s0">assert </span><span class="s1">post_auto == get_autoscale_on()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">np.testing.assert_array_equal(get_lim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_axes3d_focal_length_checks():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.set_proj_type(</span><span class="s2">'persp'</span><span class="s0">, </span><span class="s1">focal_length=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.set_proj_type(</span><span class="s2">'ortho'</span><span class="s0">, </span><span class="s1">focal_length=</span><span class="s3">1</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'axes3d_focal_length.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axes3d_focal_length():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">subplot_kw={</span><span class="s2">'projection'</span><span class="s1">: </span><span class="s2">'3d'</span><span class="s1">})</span>
    <span class="s1">axs[</span><span class="s3">0</span><span class="s1">].set_proj_type(</span><span class="s2">'persp'</span><span class="s0">, </span><span class="s1">focal_length=np.inf)</span>
    <span class="s1">axs[</span><span class="s3">1</span><span class="s1">].set_proj_type(</span><span class="s2">'persp'</span><span class="s0">, </span><span class="s1">focal_length=</span><span class="s3">0.15</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'axes3d_ortho.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axes3d_ortho():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.set_proj_type(</span><span class="s2">'ortho'</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'axes3d_isometric.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_axes3d_isometric():</span>
    <span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">combinations</span><span class="s0">, </span><span class="s1">product</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw=dict(</span>
        <span class="s1">projection=</span><span class="s2">'3d'</span><span class="s0">,</span>
        <span class="s1">proj_type=</span><span class="s2">'ortho'</span><span class="s0">,</span>
        <span class="s1">box_aspect=(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">))</span>
    <span class="s1">r = (-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)  </span><span class="s4"># stackoverflow.com/a/11156353</span>
    <span class="s0">for </span><span class="s1">s</span><span class="s0">, </span><span class="s1">e </span><span class="s0">in </span><span class="s1">combinations(np.array(list(product(r</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">r)))</span><span class="s0">, </span><span class="s3">2</span><span class="s1">):</span>
        <span class="s0">if </span><span class="s1">abs(s - e).sum() == r[</span><span class="s3">1</span><span class="s1">] - r[</span><span class="s3">0</span><span class="s1">]:</span>
            <span class="s1">ax.plot3D(*zip(s</span><span class="s0">, </span><span class="s1">e)</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">'k'</span><span class="s1">)</span>
    <span class="s1">ax.view_init(elev=np.degrees(np.arctan(</span><span class="s3">1. </span><span class="s1">/ np.sqrt(</span><span class="s3">2</span><span class="s1">)))</span><span class="s0">, </span><span class="s1">azim=-</span><span class="s3">45</span><span class="s0">, </span><span class="s1">roll=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">ax.grid(</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'value'</span><span class="s0">, </span><span class="s1">[np.inf</span><span class="s0">, </span><span class="s1">np.nan])</span>
<span class="s1">@pytest.mark.parametrize((</span><span class="s2">'setter'</span><span class="s0">, </span><span class="s2">'side'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s2">'set_xlim3d'</span><span class="s0">, </span><span class="s2">'left'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'set_xlim3d'</span><span class="s0">, </span><span class="s2">'right'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'set_ylim3d'</span><span class="s0">, </span><span class="s2">'bottom'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'set_ylim3d'</span><span class="s0">, </span><span class="s2">'top'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'set_zlim3d'</span><span class="s0">, </span><span class="s2">'bottom'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'set_zlim3d'</span><span class="s0">, </span><span class="s2">'top'</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_invalid_axes_limits(setter</span><span class="s0">, </span><span class="s1">side</span><span class="s0">, </span><span class="s1">value):</span>
    <span class="s1">limit = {side: value}</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">obj = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">getattr(obj</span><span class="s0">, </span><span class="s1">setter)(**limit)</span>


<span class="s0">class </span><span class="s1">TestVoxels:</span>
    <span class="s1">@mpl3d_image_comparison([</span><span class="s2">'voxels-simple.png'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_simple(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>

        <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.indices((</span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
        <span class="s1">voxels = (x == y) | (y == z)</span>
        <span class="s1">ax.voxels(voxels)</span>

    <span class="s1">@mpl3d_image_comparison([</span><span class="s2">'voxels-edge-style.png'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_edge_style(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>

        <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.indices((</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>
        <span class="s1">voxels = ((x - </span><span class="s3">2</span><span class="s1">)**</span><span class="s3">2 </span><span class="s1">+ (y - </span><span class="s3">2</span><span class="s1">)**</span><span class="s3">2 </span><span class="s1">+ (z-</span><span class="s3">1.5</span><span class="s1">)**</span><span class="s3">2</span><span class="s1">) &lt; </span><span class="s3">2.2</span><span class="s1">**</span><span class="s3">2</span>
        <span class="s1">v = ax.voxels(voxels</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s2">'C1'</span><span class="s1">)</span>

        <span class="s4"># change the edge color of one voxel</span>
        <span class="s1">v[max(v.keys())].set_edgecolor(</span><span class="s2">'C2'</span><span class="s1">)</span>

    <span class="s1">@mpl3d_image_comparison([</span><span class="s2">'voxels-named-colors.png'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_named_colors(self):</span>
        <span class="s5">&quot;&quot;&quot;Test with colors set to a 3D object array of strings.&quot;&quot;&quot;</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>

        <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.indices((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>
        <span class="s1">voxels = (x == y) | (y == z)</span>
        <span class="s1">voxels = voxels &amp; ~(x * y * z &lt; </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">colors = np.full((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'C0'</span><span class="s0">, </span><span class="s1">dtype=np.object_)</span>
        <span class="s1">colors[(x &lt; </span><span class="s3">5</span><span class="s1">) &amp; (y &lt; </span><span class="s3">5</span><span class="s1">)] = </span><span class="s2">'0.25'</span>
        <span class="s1">colors[(x + z) &lt; </span><span class="s3">10</span><span class="s1">] = </span><span class="s2">'cyan'</span>
        <span class="s1">ax.voxels(voxels</span><span class="s0">, </span><span class="s1">facecolors=colors)</span>

    <span class="s1">@mpl3d_image_comparison([</span><span class="s2">'voxels-rgb-data.png'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_rgb_data(self):</span>
        <span class="s5">&quot;&quot;&quot;Test with colors set to a 4d float array of rgb data.&quot;&quot;&quot;</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>

        <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.indices((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>
        <span class="s1">voxels = (x == y) | (y == z)</span>
        <span class="s1">colors = np.zeros((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
        <span class="s1">colors[...</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] = x / </span><span class="s3">9</span>
        <span class="s1">colors[...</span><span class="s0">, </span><span class="s3">1</span><span class="s1">] = y / </span><span class="s3">9</span>
        <span class="s1">colors[...</span><span class="s0">, </span><span class="s3">2</span><span class="s1">] = z / </span><span class="s3">9</span>
        <span class="s1">ax.voxels(voxels</span><span class="s0">, </span><span class="s1">facecolors=colors)</span>

    <span class="s1">@mpl3d_image_comparison([</span><span class="s2">'voxels-alpha.png'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_alpha(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>

        <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.indices((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>
        <span class="s1">v1 = x == y</span>
        <span class="s1">v2 = np.abs(x - y) &lt; </span><span class="s3">2</span>
        <span class="s1">voxels = v1 | v2</span>
        <span class="s1">colors = np.zeros((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>
        <span class="s1">colors[v2] = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span>
        <span class="s1">colors[v1] = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span>
        <span class="s1">v = ax.voxels(voxels</span><span class="s0">, </span><span class="s1">facecolors=colors)</span>

        <span class="s0">assert </span><span class="s1">type(v) </span><span class="s0">is </span><span class="s1">dict</span>
        <span class="s0">for </span><span class="s1">coord</span><span class="s0">, </span><span class="s1">poly </span><span class="s0">in </span><span class="s1">v.items():</span>
            <span class="s0">assert </span><span class="s1">voxels[coord]</span><span class="s0">, </span><span class="s2">&quot;faces returned for absent voxel&quot;</span>
            <span class="s0">assert </span><span class="s1">isinstance(poly</span><span class="s0">, </span><span class="s1">art3d.Poly3DCollection)</span>

    <span class="s1">@mpl3d_image_comparison([</span><span class="s2">'voxels-xyz.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s3">0.01</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_xyz(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>

        <span class="s0">def </span><span class="s1">midpoints(x):</span>
            <span class="s1">sl = ()</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(x.ndim):</span>
                <span class="s1">x = (x[sl + np.index_exp[:-</span><span class="s3">1</span><span class="s1">]] +</span>
                     <span class="s1">x[sl + np.index_exp[</span><span class="s3">1</span><span class="s1">:]]) / </span><span class="s3">2.0</span>
                <span class="s1">sl += np.index_exp[:]</span>
            <span class="s0">return </span><span class="s1">x</span>

        <span class="s4"># prepare some coordinates, and attach rgb values to each</span>
        <span class="s1">r</span><span class="s0">, </span><span class="s1">g</span><span class="s0">, </span><span class="s1">b = np.indices((</span><span class="s3">17</span><span class="s0">, </span><span class="s3">17</span><span class="s0">, </span><span class="s3">17</span><span class="s1">)) / </span><span class="s3">16.0</span>
        <span class="s1">rc = midpoints(r)</span>
        <span class="s1">gc = midpoints(g)</span>
        <span class="s1">bc = midpoints(b)</span>

        <span class="s4"># define a sphere about [0.5, 0.5, 0.5]</span>
        <span class="s1">sphere = (rc - </span><span class="s3">0.5</span><span class="s1">)**</span><span class="s3">2 </span><span class="s1">+ (gc - </span><span class="s3">0.5</span><span class="s1">)**</span><span class="s3">2 </span><span class="s1">+ (bc - </span><span class="s3">0.5</span><span class="s1">)**</span><span class="s3">2 </span><span class="s1">&lt; </span><span class="s3">0.5</span><span class="s1">**</span><span class="s3">2</span>

        <span class="s4"># combine the color components</span>
        <span class="s1">colors = np.zeros(sphere.shape + (</span><span class="s3">3</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">colors[...</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] = rc</span>
        <span class="s1">colors[...</span><span class="s0">, </span><span class="s3">1</span><span class="s1">] = gc</span>
        <span class="s1">colors[...</span><span class="s0">, </span><span class="s3">2</span><span class="s1">] = bc</span>

        <span class="s4"># and plot everything</span>
        <span class="s1">ax.voxels(r</span><span class="s0">, </span><span class="s1">g</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">sphere</span><span class="s0">,</span>
                  <span class="s1">facecolors=colors</span><span class="s0">,</span>
                  <span class="s1">edgecolors=np.clip(</span><span class="s3">2</span><span class="s1">*colors - </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># brighter</span>
                  <span class="s1">linewidth=</span><span class="s3">0.5</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_calling_conventions(self):</span>
        <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.indices((</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
        <span class="s1">filled = np.ones((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>

        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>

        <span class="s4"># all the valid calling conventions</span>
        <span class="s0">for </span><span class="s1">kw </span><span class="s0">in </span><span class="s1">(dict()</span><span class="s0">, </span><span class="s1">dict(edgecolor=</span><span class="s2">'k'</span><span class="s1">)):</span>
            <span class="s1">ax.voxels(filled</span><span class="s0">, </span><span class="s1">**kw)</span>
            <span class="s1">ax.voxels(filled=filled</span><span class="s0">, </span><span class="s1">**kw)</span>
            <span class="s1">ax.voxels(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">filled</span><span class="s0">, </span><span class="s1">**kw)</span>
            <span class="s1">ax.voxels(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">filled=filled</span><span class="s0">, </span><span class="s1">**kw)</span>

        <span class="s4"># duplicate argument</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'voxels'</span><span class="s1">):</span>
            <span class="s1">ax.voxels(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">filled</span><span class="s0">, </span><span class="s1">filled=filled)</span>
        <span class="s4"># missing arguments</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'voxels'</span><span class="s1">):</span>
            <span class="s1">ax.voxels(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s4"># x, y, z are positional only - this passes them on as attributes of</span>
        <span class="s4"># Poly3DCollection</span>
        <span class="s0">with </span><span class="s1">pytest.raises(AttributeError):</span>
            <span class="s1">ax.voxels(filled=filled</span><span class="s0">, </span><span class="s1">x=x</span><span class="s0">, </span><span class="s1">y=y</span><span class="s0">, </span><span class="s1">z=z)</span>


<span class="s0">def </span><span class="s1">test_line3d_set_get_data_3d():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span>
    <span class="s1">x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">z2 = [</span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">8</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">11</span><span class="s1">]</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">lines = ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">line = lines[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">np.testing.assert_array_equal((x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span><span class="s0">, </span><span class="s1">line.get_data_3d())</span>
    <span class="s1">line.set_data_3d(x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">z2)</span>
    <span class="s1">np.testing.assert_array_equal((x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">z2)</span><span class="s0">, </span><span class="s1">line.get_data_3d())</span>
    <span class="s1">line.set_xdata(x)</span>
    <span class="s1">line.set_ydata(y)</span>
    <span class="s1">line.set_3d_properties(zs=z</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'z'</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_array_equal((x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span><span class="s0">, </span><span class="s1">line.get_data_3d())</span>
    <span class="s1">line.set_3d_properties(zs=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'z'</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_array_equal((x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">np.zeros_like(z))</span><span class="s0">, </span><span class="s1">line.get_data_3d())</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_inverted(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s4"># Plot then invert.</span>
    <span class="s1">ax = fig_test.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s1">])</span>
    <span class="s1">ax.invert_yaxis()</span>
    <span class="s4"># Invert then plot.</span>
    <span class="s1">ax = fig_ref.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">ax.invert_yaxis()</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_inverted_cla():</span>
    <span class="s4"># GitHub PR #5450. Setting autoscale should reset</span>
    <span class="s4"># axes to be non-inverted.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>
    <span class="s4"># 1. test that a new axis is not inverted per default</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis_inverted()</span>
    <span class="s0">assert not </span><span class="s1">ax.yaxis_inverted()</span>
    <span class="s0">assert not </span><span class="s1">ax.zaxis_inverted()</span>
    <span class="s1">ax.set_xlim(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.zaxis_inverted()</span>
    <span class="s1">ax.cla()</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis_inverted()</span>
    <span class="s0">assert not </span><span class="s1">ax.yaxis_inverted()</span>
    <span class="s0">assert not </span><span class="s1">ax.zaxis_inverted()</span>


<span class="s0">def </span><span class="s1">test_ax3d_tickcolour():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = Axes3D(fig)</span>

    <span class="s1">ax.tick_params(axis=</span><span class="s2">'x'</span><span class="s0">, </span><span class="s1">colors=</span><span class="s2">'red'</span><span class="s1">)</span>
    <span class="s1">ax.tick_params(axis=</span><span class="s2">'y'</span><span class="s0">, </span><span class="s1">colors=</span><span class="s2">'red'</span><span class="s1">)</span>
    <span class="s1">ax.tick_params(axis=</span><span class="s2">'z'</span><span class="s0">, </span><span class="s1">colors=</span><span class="s2">'red'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax.xaxis.get_major_ticks():</span>
        <span class="s0">assert </span><span class="s1">tick.tick1line._color == </span><span class="s2">'red'</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax.yaxis.get_major_ticks():</span>
        <span class="s0">assert </span><span class="s1">tick.tick1line._color == </span><span class="s2">'red'</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax.zaxis.get_major_ticks():</span>
        <span class="s0">assert </span><span class="s1">tick.tick1line._color == </span><span class="s2">'red'</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_ticklabel_format(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">axs = fig_test.subplots(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s1">subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">ax.set_xlim(</span><span class="s3">1e7</span><span class="s0">, </span><span class="s3">1e7 </span><span class="s1">+ </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">row</span><span class="s0">, </span><span class="s1">name </span><span class="s0">in </span><span class="s1">zip(axs</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s2">&quot;z&quot;</span><span class="s0">, </span><span class="s2">&quot;both&quot;</span><span class="s1">]):</span>
        <span class="s1">row[</span><span class="s3">0</span><span class="s1">].ticklabel_format(</span>
            <span class="s1">axis=name</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">&quot;plain&quot;</span><span class="s1">)</span>
        <span class="s1">row[</span><span class="s3">1</span><span class="s1">].ticklabel_format(</span>
            <span class="s1">axis=name</span><span class="s0">, </span><span class="s1">scilimits=(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">row[</span><span class="s3">2</span><span class="s1">].ticklabel_format(</span>
            <span class="s1">axis=name</span><span class="s0">, </span><span class="s1">useOffset=</span><span class="s0">not </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;axes.formatter.useoffset&quot;</span><span class="s1">])</span>
        <span class="s1">row[</span><span class="s3">3</span><span class="s1">].ticklabel_format(</span>
            <span class="s1">axis=name</span><span class="s0">, </span><span class="s1">useLocale=</span><span class="s0">not </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;axes.formatter.use_locale&quot;</span><span class="s1">])</span>
        <span class="s1">row[</span><span class="s3">4</span><span class="s1">].ticklabel_format(</span>
            <span class="s1">axis=name</span><span class="s0">,</span>
            <span class="s1">useMathText=</span><span class="s0">not </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;axes.formatter.use_mathtext&quot;</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">get_formatters(ax</span><span class="s0">, </span><span class="s1">names):</span>
        <span class="s0">return </span><span class="s1">[getattr(ax</span><span class="s0">, </span><span class="s1">name).get_major_formatter() </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names]</span>

    <span class="s1">axs = fig_ref.subplots(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s1">subplot_kw={</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;3d&quot;</span><span class="s1">})</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">ax.set_xlim(</span><span class="s3">1e7</span><span class="s0">, </span><span class="s3">1e7 </span><span class="s1">+ </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">row</span><span class="s0">, </span><span class="s1">names </span><span class="s0">in </span><span class="s1">zip(</span>
            <span class="s1">axs</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;xaxis&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;yaxis&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;zaxis&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;xaxis&quot;</span><span class="s0">, </span><span class="s2">&quot;yaxis&quot;</span><span class="s0">, </span><span class="s2">&quot;zaxis&quot;</span><span class="s1">]]</span>
    <span class="s1">):</span>
        <span class="s0">for </span><span class="s1">fmt </span><span class="s0">in </span><span class="s1">get_formatters(row[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">names):</span>
            <span class="s1">fmt.set_scientific(</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">fmt </span><span class="s0">in </span><span class="s1">get_formatters(row[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">names):</span>
            <span class="s1">fmt.set_powerlimits((-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">fmt </span><span class="s0">in </span><span class="s1">get_formatters(row[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">names):</span>
            <span class="s1">fmt.set_useOffset(</span><span class="s0">not </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;axes.formatter.useoffset&quot;</span><span class="s1">])</span>
        <span class="s0">for </span><span class="s1">fmt </span><span class="s0">in </span><span class="s1">get_formatters(row[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">names):</span>
            <span class="s1">fmt.set_useLocale(</span><span class="s0">not </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;axes.formatter.use_locale&quot;</span><span class="s1">])</span>
        <span class="s0">for </span><span class="s1">fmt </span><span class="s0">in </span><span class="s1">get_formatters(row[</span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">names):</span>
            <span class="s1">fmt.set_useMathText(</span>
                <span class="s0">not </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;axes.formatter.use_mathtext&quot;</span><span class="s1">])</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_quiver3D_smoke(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">pivot = </span><span class="s2">&quot;middle&quot;</span>
    <span class="s4"># Make the grid</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.meshgrid(</span>
        <span class="s1">np.arange(-</span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">np.arange(-</span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">np.arange(-</span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.8</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">u = v = w = np.ones_like(x)</span>

    <span class="s0">for </span><span class="s1">fig</span><span class="s0">, </span><span class="s1">length </span><span class="s0">in </span><span class="s1">zip((fig_ref</span><span class="s0">, </span><span class="s1">fig_test)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)):</span>
        <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
        <span class="s1">ax.quiver(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">u</span><span class="s0">, </span><span class="s1">v</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">length=length</span><span class="s0">, </span><span class="s1">pivot=pivot)</span>


<span class="s1">@image_comparison([</span><span class="s2">&quot;minor_ticks.png&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">&quot;mpl20&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_minor_ticks():</span>
    <span class="s1">ax = plt.figure().add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_xticks([</span><span class="s3">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_xticklabels([</span><span class="s2">&quot;quarter&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_yticks([</span><span class="s3">0.33</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_yticklabels([</span><span class="s2">&quot;third&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_zticks([</span><span class="s3">0.50</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_zticklabels([</span><span class="s2">&quot;half&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'errorbar3d_errorevery.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_errorbar3d_errorevery():</span>
    <span class="s5">&quot;&quot;&quot;Tests errorevery functionality for 3D errorbars.&quot;&quot;&quot;</span>
    <span class="s1">t = np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi+</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">0.01</span><span class="s1">)</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.sin(t)</span><span class="s0">, </span><span class="s1">np.cos(</span><span class="s3">3</span><span class="s1">*t)</span><span class="s0">, </span><span class="s1">np.sin(</span><span class="s3">5</span><span class="s1">*t)</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">estep = </span><span class="s3">15</span>
    <span class="s1">i = np.arange(t.size)</span>
    <span class="s1">zuplims = (i % estep == </span><span class="s3">0</span><span class="s1">) &amp; (i // estep % </span><span class="s3">3 </span><span class="s1">== </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">zlolims = (i % estep == </span><span class="s3">0</span><span class="s1">) &amp; (i // estep % </span><span class="s3">3 </span><span class="s1">== </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s1">zuplims=zuplims</span><span class="s0">, </span><span class="s1">zlolims=zlolims</span><span class="s0">,</span>
                <span class="s1">errorevery=estep)</span>


<span class="s1">@mpl3d_image_comparison([</span><span class="s2">'errorbar3d.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_errorbar3d():</span>
    <span class="s5">&quot;&quot;&quot;Tests limits, color styling, and legend for 3D errorbars.&quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>

    <span class="s1">d = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span>
    <span class="s1">e = [</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">]</span>
    <span class="s1">ax.errorbar(x=d</span><span class="s0">, </span><span class="s1">y=d</span><span class="s0">, </span><span class="s1">z=d</span><span class="s0">, </span><span class="s1">xerr=e</span><span class="s0">, </span><span class="s1">yerr=e</span><span class="s0">, </span><span class="s1">zerr=e</span><span class="s0">, </span><span class="s1">capsize=</span><span class="s3">3</span><span class="s0">,</span>
                <span class="s1">zuplims=[</span><span class="s0">False, True, False, True, True</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">zlolims=[</span><span class="s0">True, False, False, True, False</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">yuplims=</span><span class="s0">True,</span>
                <span class="s1">ecolor=</span><span class="s2">'purple'</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'Error lines'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>


<span class="s1">@image_comparison([</span><span class="s2">'stem3d.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s3">0.003</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_stem3d():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">8</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)</span><span class="s0">,</span>
                            <span class="s1">constrained_layout=</span><span class="s0">True,</span>
                            <span class="s1">subplot_kw={</span><span class="s2">'projection'</span><span class="s1">: </span><span class="s2">'3d'</span><span class="s1">})</span>

    <span class="s1">theta = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi)</span>
    <span class="s1">x = np.cos(theta - np.pi/</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">y = np.sin(theta - np.pi/</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">z = theta</span>

    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">zdir </span><span class="s0">in </span><span class="s1">zip(axs[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'x'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">, </span><span class="s2">'z'</span><span class="s1">]):</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">orientation=zdir)</span>
        <span class="s1">ax.set_title(</span><span class="s2">f'orientation=</span><span class="s0">{</span><span class="s1">zdir</span><span class="s0">}</span><span class="s2">'</span><span class="s1">)</span>

    <span class="s1">x = np.linspace(-np.pi/</span><span class="s3">2</span><span class="s0">, </span><span class="s1">np.pi/</span><span class="s3">2</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">y = np.ones_like(x)</span>
    <span class="s1">z = np.cos(x)</span>

    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">zdir </span><span class="s0">in </span><span class="s1">zip(axs[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'x'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">, </span><span class="s2">'z'</span><span class="s1">]):</span>
        <span class="s1">markerline</span><span class="s0">, </span><span class="s1">stemlines</span><span class="s0">, </span><span class="s1">baseline = ax.stem(</span>
            <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">,</span>
            <span class="s1">linefmt=</span><span class="s2">'C4-.'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s2">'C1D'</span><span class="s0">, </span><span class="s1">basefmt=</span><span class="s2">'C2'</span><span class="s0">,</span>
            <span class="s1">orientation=zdir)</span>
        <span class="s1">ax.set_title(</span><span class="s2">f'orientation=</span><span class="s0">{</span><span class="s1">zdir</span><span class="s0">}</span><span class="s2">'</span><span class="s1">)</span>
        <span class="s1">markerline.set(markerfacecolor=</span><span class="s2">'none'</span><span class="s0">, </span><span class="s1">markeredgewidth=</span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">baseline.set_linewidth(</span><span class="s3">3</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">&quot;equal_box_aspect.png&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">&quot;mpl20&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_equal_box_aspect():</span>
    <span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">product</span><span class="s0">, </span><span class="s1">combinations</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>

    <span class="s4"># Make data</span>
    <span class="s1">u = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">v = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.pi</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">x = np.outer(np.cos(u)</span><span class="s0">, </span><span class="s1">np.sin(v))</span>
    <span class="s1">y = np.outer(np.sin(u)</span><span class="s0">, </span><span class="s1">np.sin(v))</span>
    <span class="s1">z = np.outer(np.ones_like(u)</span><span class="s0">, </span><span class="s1">np.cos(v))</span>

    <span class="s4"># Plot the surface</span>
    <span class="s1">ax.plot_surface(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>

    <span class="s4"># draw cube</span>
    <span class="s1">r = [-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">s</span><span class="s0">, </span><span class="s1">e </span><span class="s0">in </span><span class="s1">combinations(np.array(list(product(r</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s1">r)))</span><span class="s0">, </span><span class="s3">2</span><span class="s1">):</span>
        <span class="s0">if </span><span class="s1">np.sum(np.abs(s - e)) == r[</span><span class="s3">1</span><span class="s1">] - r[</span><span class="s3">0</span><span class="s1">]:</span>
            <span class="s1">ax.plot3D(*zip(s</span><span class="s0">, </span><span class="s1">e)</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">&quot;b&quot;</span><span class="s1">)</span>

    <span class="s4"># Make axes limits</span>
    <span class="s1">xyzlim = np.column_stack(</span>
        <span class="s1">[ax.get_xlim3d()</span><span class="s0">, </span><span class="s1">ax.get_ylim3d()</span><span class="s0">, </span><span class="s1">ax.get_zlim3d()]</span>
    <span class="s1">)</span>
    <span class="s1">XYZlim = [min(xyzlim[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">max(xyzlim[</span><span class="s3">1</span><span class="s1">])]</span>
    <span class="s1">ax.set_xlim3d(XYZlim)</span>
    <span class="s1">ax.set_ylim3d(XYZlim)</span>
    <span class="s1">ax.set_zlim3d(XYZlim)</span>
    <span class="s1">ax.axis(</span><span class="s2">'off'</span><span class="s1">)</span>
    <span class="s1">ax.set_box_aspect((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;Argument zoom =&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_box_aspect((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">zoom=-</span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_pos():</span>
    <span class="s1">num_plots = </span><span class="s3">2</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">num_plots</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
                            <span class="s1">constrained_layout=</span><span class="s0">True,</span>
                            <span class="s1">subplot_kw={</span><span class="s2">'projection'</span><span class="s1">: </span><span class="s2">'3d'</span><span class="s1">})</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs:</span>
        <span class="s1">p_tri = ax.plot_trisurf(np.random.randn(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.random.randn(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
                                <span class="s1">np.random.randn(</span><span class="s3">5</span><span class="s1">))</span>

    <span class="s1">cbar = plt.colorbar(p_tri</span><span class="s0">, </span><span class="s1">ax=axs</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s2">'horizontal'</span><span class="s1">)</span>

    <span class="s1">fig.canvas.draw()</span>
    <span class="s4"># check that actually on the bottom</span>
    <span class="s0">assert </span><span class="s1">cbar.ax.get_position().extents[</span><span class="s3">1</span><span class="s1">] &lt; </span><span class="s3">0.2</span>


<span class="s0">def </span><span class="s1">test_inverted_zaxis():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">ax.zaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zbound() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s4"># Change bound</span>
    <span class="s1">ax.set_zbound((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s0">assert not </span><span class="s1">ax.zaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zbound() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># Change invert</span>
    <span class="s1">ax.invert_zaxis()</span>
    <span class="s0">assert </span><span class="s1">ax.zaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim() == (</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zbound() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># Set upper bound</span>
    <span class="s1">ax.set_zbound(upper=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.zaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim() == (</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zbound() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s4"># Set lower bound</span>
    <span class="s1">ax.set_zbound(lower=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.zaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim() == (</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zbound() == (</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_set_zlim():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(zmax=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax.set_zlim(zmin=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim() == (</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(</span>
            <span class="s1">TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;Cannot pass both 'bottom' and 'zmin'&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_zlim(bottom=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">zmin=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(</span>
            <span class="s1">TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;Cannot pass both 'top' and 'zmax'&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_zlim(top=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">zmax=</span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_shared_axes_retick():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">211</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">ax2 = fig.add_subplot(</span><span class="s3">212</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">&quot;3d&quot;</span><span class="s0">, </span><span class="s1">sharez=ax1)</span>
    <span class="s1">ax1.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">ax2.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">ax1.set_zticks([-</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">])</span>
    <span class="s4"># check that setting ticks on a shared axis is synchronized</span>
    <span class="s0">assert </span><span class="s1">ax1.get_zlim() == (-</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax2.get_zlim() == (-</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_pan():</span>
    <span class="s5">&quot;&quot;&quot;Test mouse panning using the middle mouse button.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">convert_lim(dmin</span><span class="s0">, </span><span class="s1">dmax):</span>
        <span class="s5">&quot;&quot;&quot;Convert min/max limits to center and range.&quot;&quot;&quot;</span>
        <span class="s1">center = (dmin + dmax) / </span><span class="s3">2</span>
        <span class="s1">range_ = dmax - dmin</span>
        <span class="s0">return </span><span class="s1">center</span><span class="s0">, </span><span class="s1">range_</span>

    <span class="s1">ax = plt.figure().add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">ax.figure.canvas.draw()</span>

    <span class="s1">x_center0</span><span class="s0">, </span><span class="s1">x_range0 = convert_lim(*ax.get_xlim3d())</span>
    <span class="s1">y_center0</span><span class="s0">, </span><span class="s1">y_range0 = convert_lim(*ax.get_ylim3d())</span>
    <span class="s1">z_center0</span><span class="s0">, </span><span class="s1">z_range0 = convert_lim(*ax.get_zlim3d())</span>

    <span class="s4"># move mouse diagonally to pan along all axis.</span>
    <span class="s1">ax._button_press(</span>
        <span class="s1">mock_event(ax</span><span class="s0">, </span><span class="s1">button=MouseButton.MIDDLE</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">ax._on_move(</span>
        <span class="s1">mock_event(ax</span><span class="s0">, </span><span class="s1">button=MouseButton.MIDDLE</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">1</span><span class="s1">))</span>

    <span class="s1">x_center</span><span class="s0">, </span><span class="s1">x_range = convert_lim(*ax.get_xlim3d())</span>
    <span class="s1">y_center</span><span class="s0">, </span><span class="s1">y_range = convert_lim(*ax.get_ylim3d())</span>
    <span class="s1">z_center</span><span class="s0">, </span><span class="s1">z_range = convert_lim(*ax.get_zlim3d())</span>

    <span class="s4"># Ranges have not changed</span>
    <span class="s0">assert </span><span class="s1">x_range == pytest.approx(x_range0)</span>
    <span class="s0">assert </span><span class="s1">y_range == pytest.approx(y_range0)</span>
    <span class="s0">assert </span><span class="s1">z_range == pytest.approx(z_range0)</span>

    <span class="s4"># But center positions have</span>
    <span class="s0">assert </span><span class="s1">x_center != pytest.approx(x_center0)</span>
    <span class="s0">assert </span><span class="s1">y_center != pytest.approx(y_center0)</span>
    <span class="s0">assert </span><span class="s1">z_center != pytest.approx(z_center0)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tool,button,key,expected&quot;</span><span class="s0">,</span>
                         <span class="s1">[(</span><span class="s2">&quot;zoom&quot;</span><span class="s0">, </span><span class="s1">MouseButton.LEFT</span><span class="s0">, None,  </span><span class="s4"># zoom in</span>
                          <span class="s1">((</span><span class="s3">0.00</span><span class="s0">, </span><span class="s3">0.06</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.01</span><span class="s0">, </span><span class="s3">0.07</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.02</span><span class="s0">, </span><span class="s3">0.08</span><span class="s1">)))</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s2">&quot;zoom&quot;</span><span class="s0">, </span><span class="s1">MouseButton.LEFT</span><span class="s0">, </span><span class="s2">'x'</span><span class="s0">,  </span><span class="s4"># zoom in</span>
                          <span class="s1">((-</span><span class="s3">0.01</span><span class="s0">, </span><span class="s3">0.10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.03</span><span class="s0">, </span><span class="s3">0.08</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.06</span><span class="s0">, </span><span class="s3">0.06</span><span class="s1">)))</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s2">&quot;zoom&quot;</span><span class="s0">, </span><span class="s1">MouseButton.LEFT</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">,  </span><span class="s4"># zoom in</span>
                          <span class="s1">((-</span><span class="s3">0.07</span><span class="s0">, </span><span class="s3">0.04</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.03</span><span class="s0">, </span><span class="s3">0.08</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.00</span><span class="s0">, </span><span class="s3">0.11</span><span class="s1">)))</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s2">&quot;zoom&quot;</span><span class="s0">, </span><span class="s1">MouseButton.RIGHT</span><span class="s0">, None,  </span><span class="s4"># zoom out</span>
                          <span class="s1">((-</span><span class="s3">0.09</span><span class="s0">, </span><span class="s3">0.15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.07</span><span class="s0">, </span><span class="s3">0.17</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.06</span><span class="s0">, </span><span class="s3">0.18</span><span class="s1">)))</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s2">&quot;pan&quot;</span><span class="s0">, </span><span class="s1">MouseButton.LEFT</span><span class="s0">, None,</span>
                          <span class="s1">((-</span><span class="s3">0.70</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.58</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1.03</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.91</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1.27</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.15</span><span class="s1">)))</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s2">&quot;pan&quot;</span><span class="s0">, </span><span class="s1">MouseButton.LEFT</span><span class="s0">, </span><span class="s2">'x'</span><span class="s0">,</span>
                          <span class="s1">((-</span><span class="s3">0.96</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.84</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.58</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.46</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.06</span><span class="s0">, </span><span class="s3">0.06</span><span class="s1">)))</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s2">&quot;pan&quot;</span><span class="s0">, </span><span class="s1">MouseButton.LEFT</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">,</span>
                          <span class="s1">((</span><span class="s3">0.20</span><span class="s0">, </span><span class="s3">0.32</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">0.51</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.39</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1.27</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.15</span><span class="s1">)))])</span>
<span class="s0">def </span><span class="s1">test_toolbar_zoom_pan(tool</span><span class="s0">, </span><span class="s1">button</span><span class="s0">, </span><span class="s1">key</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s4"># NOTE: The expected zoom values are rough ballparks of moving in the view</span>
    <span class="s4">#       to make sure we are getting the right direction of motion.</span>
    <span class="s4">#       The specific values can and should change if the zoom movement</span>
    <span class="s4">#       scaling factor gets updated.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">xlim0</span><span class="s0">, </span><span class="s1">ylim0</span><span class="s0">, </span><span class="s1">zlim0 = ax.get_xlim3d()</span><span class="s0">, </span><span class="s1">ax.get_ylim3d()</span><span class="s0">, </span><span class="s1">ax.get_zlim3d()</span>

    <span class="s4"># Mouse from (0, 0) to (1, 1)</span>
    <span class="s1">d0 = (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">d1 = (</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s4"># Convert to screen coordinates (&quot;s&quot;).  Events are defined only with pixel</span>
    <span class="s4"># precision, so round the pixel values, and below, check against the</span>
    <span class="s4"># corresponding xdata/ydata, which are close but not equal to d0/d1.</span>
    <span class="s1">s0 = ax.transData.transform(d0).astype(int)</span>
    <span class="s1">s1 = ax.transData.transform(d1).astype(int)</span>

    <span class="s4"># Set up the mouse movements</span>
    <span class="s1">start_event = MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*s0</span><span class="s0">, </span><span class="s1">button</span><span class="s0">, </span><span class="s1">key=key)</span>
    <span class="s1">stop_event = MouseEvent(</span>
        <span class="s2">&quot;button_release_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*s1</span><span class="s0">, </span><span class="s1">button</span><span class="s0">, </span><span class="s1">key=key)</span>

    <span class="s1">tb = NavigationToolbar2(fig.canvas)</span>
    <span class="s0">if </span><span class="s1">tool == </span><span class="s2">&quot;zoom&quot;</span><span class="s1">:</span>
        <span class="s1">tb.zoom()</span>
        <span class="s1">tb.press_zoom(start_event)</span>
        <span class="s1">tb.drag_zoom(stop_event)</span>
        <span class="s1">tb.release_zoom(stop_event)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">tb.pan()</span>
        <span class="s1">tb.press_pan(start_event)</span>
        <span class="s1">tb.drag_pan(stop_event)</span>
        <span class="s1">tb.release_pan(stop_event)</span>

    <span class="s4"># Should be close, but won't be exact due to screen integer resolution</span>
    <span class="s1">xlim</span><span class="s0">, </span><span class="s1">ylim</span><span class="s0">, </span><span class="s1">zlim = expected</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim3d() == pytest.approx(xlim</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.01</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim3d() == pytest.approx(ylim</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.01</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim3d() == pytest.approx(zlim</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.01</span><span class="s1">)</span>

    <span class="s4"># Ensure that back, forward, and home buttons work</span>
    <span class="s1">tb.back()</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim3d() == pytest.approx(xlim0)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim3d() == pytest.approx(ylim0)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim3d() == pytest.approx(zlim0)</span>

    <span class="s1">tb.forward()</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim3d() == pytest.approx(xlim</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.01</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim3d() == pytest.approx(ylim</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.01</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim3d() == pytest.approx(zlim</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.01</span><span class="s1">)</span>

    <span class="s1">tb.home()</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim3d() == pytest.approx(xlim0)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim3d() == pytest.approx(ylim0)</span>
    <span class="s0">assert </span><span class="s1">ax.get_zlim3d() == pytest.approx(zlim0)</span>


<span class="s1">@mpl.style.context(</span><span class="s2">'default'</span><span class="s1">)</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_scalarmap_update(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>

    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = np.array((list(itertools.product(*[np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                                 <span class="s1">np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                                 <span class="s1">np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)])))).T</span>
    <span class="s1">c = x + y</span>

    <span class="s4"># test</span>
    <span class="s1">ax_test = fig_test.add_subplot(</span><span class="s3">111</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">sc_test = ax_test.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">c=c</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">40</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'viridis'</span><span class="s1">)</span>
    <span class="s4"># force a draw</span>
    <span class="s1">fig_test.canvas.draw()</span>
    <span class="s4"># mark it as &quot;stale&quot;</span>
    <span class="s1">sc_test.changed()</span>

    <span class="s4"># ref</span>
    <span class="s1">ax_ref = fig_ref.add_subplot(</span><span class="s3">111</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">sc_ref = ax_ref.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">c=c</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">40</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'viridis'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_subfigure_simple():</span>
    <span class="s4"># smoketest that subfigures can work...</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">sf = fig.subfigures(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax = sf[</span><span class="s3">0</span><span class="s1">].add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax = sf[</span><span class="s3">1</span><span class="s1">].add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'other'</span><span class="s1">)</span>


<span class="s4"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison(baseline_images=[</span><span class="s2">'computed_zorder'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">extensions=[</span><span class="s2">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=(</span><span class="s2">'classic'</span><span class="s0">, </span><span class="s2">'_classic_test_patch'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_computed_zorder():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">221</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax2 = fig.add_subplot(</span><span class="s3">222</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax2.computed_zorder = </span><span class="s0">False</span>

    <span class="s4"># create a horizontal plane</span>
    <span class="s1">corners = ((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2):</span>
        <span class="s1">tri = art3d.Poly3DCollection([corners]</span><span class="s0">,</span>
                                     <span class="s1">facecolors=</span><span class="s2">'white'</span><span class="s0">,</span>
                                     <span class="s1">edgecolors=</span><span class="s2">'black'</span><span class="s0">,</span>
                                     <span class="s1">zorder=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">ax.add_collection3d(tri)</span>

        <span class="s4"># plot a vector</span>
        <span class="s1">ax.plot((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">'red'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s3">2</span><span class="s1">)</span>

        <span class="s4"># plot some points</span>
        <span class="s1">ax.scatter((</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">'red'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s3">10</span><span class="s1">)</span>

        <span class="s1">ax.set_xlim((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">))</span>
        <span class="s1">ax.set_ylim((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">))</span>
        <span class="s1">ax.set_zlim((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">))</span>

    <span class="s1">ax3 = fig.add_subplot(</span><span class="s3">223</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax4 = fig.add_subplot(</span><span class="s3">224</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax4.computed_zorder = </span><span class="s0">False</span>

    <span class="s1">dim = </span><span class="s3">10</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid((-dim</span><span class="s0">, </span><span class="s1">dim)</span><span class="s0">, </span><span class="s1">(-dim</span><span class="s0">, </span><span class="s1">dim))</span>
    <span class="s1">Z = np.zeros((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>

    <span class="s1">angle = </span><span class="s3">0.5</span>
    <span class="s1">X2</span><span class="s0">, </span><span class="s1">Y2 = np.meshgrid((-dim</span><span class="s0">, </span><span class="s1">dim)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">dim))</span>
    <span class="s1">Z2 = Y2 * angle</span>
    <span class="s1">X3</span><span class="s0">, </span><span class="s1">Y3 = np.meshgrid((-dim</span><span class="s0">, </span><span class="s1">dim)</span><span class="s0">, </span><span class="s1">(-dim</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">Z3 = Y3 * angle</span>

    <span class="s1">r = </span><span class="s3">7</span>
    <span class="s1">M = </span><span class="s3">1000</span>
    <span class="s1">th = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s1">M)</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = r * np.cos(th)</span><span class="s0">,  </span><span class="s1">r * np.sin(th)</span><span class="s0">, </span><span class="s1">angle * r * np.sin(th)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">(ax3</span><span class="s0">, </span><span class="s1">ax4):</span>
        <span class="s1">ax.plot_surface(X2</span><span class="s0">, </span><span class="s1">Y3</span><span class="s0">, </span><span class="s1">Z3</span><span class="s0">,</span>
                        <span class="s1">color=</span><span class="s2">'blue'</span><span class="s0">,</span>
                        <span class="s1">alpha=</span><span class="s3">0.5</span><span class="s0">,</span>
                        <span class="s1">linewidth=</span><span class="s3">0</span><span class="s0">,</span>
                        <span class="s1">zorder=-</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">ax.plot(x[y &lt; </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[y &lt; </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">z[y &lt; </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">lw=</span><span class="s3">5</span><span class="s0">,</span>
                <span class="s1">linestyle=</span><span class="s2">'--'</span><span class="s0">,</span>
                <span class="s1">color=</span><span class="s2">'green'</span><span class="s0">,</span>
                <span class="s1">zorder=</span><span class="s3">0</span><span class="s1">)</span>

        <span class="s1">ax.plot_surface(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">,</span>
                        <span class="s1">color=</span><span class="s2">'red'</span><span class="s0">,</span>
                        <span class="s1">alpha=</span><span class="s3">0.5</span><span class="s0">,</span>
                        <span class="s1">linewidth=</span><span class="s3">0</span><span class="s0">,</span>
                        <span class="s1">zorder=</span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">ax.plot(r * np.sin(th)</span><span class="s0">, </span><span class="s1">r * np.cos(th)</span><span class="s0">, </span><span class="s1">np.zeros(M)</span><span class="s0">,</span>
                <span class="s1">lw=</span><span class="s3">5</span><span class="s0">,</span>
                <span class="s1">linestyle=</span><span class="s2">'--'</span><span class="s0">,</span>
                <span class="s1">color=</span><span class="s2">'black'</span><span class="s0">,</span>
                <span class="s1">zorder=</span><span class="s3">2</span><span class="s1">)</span>

        <span class="s1">ax.plot_surface(X2</span><span class="s0">, </span><span class="s1">Y2</span><span class="s0">, </span><span class="s1">Z2</span><span class="s0">,</span>
                        <span class="s1">color=</span><span class="s2">'blue'</span><span class="s0">,</span>
                        <span class="s1">alpha=</span><span class="s3">0.5</span><span class="s0">,</span>
                        <span class="s1">linewidth=</span><span class="s3">0</span><span class="s0">,</span>
                        <span class="s1">zorder=</span><span class="s3">3</span><span class="s1">)</span>

        <span class="s1">ax.plot(x[y &gt; </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[y &gt; </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">z[y &gt; </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">5</span><span class="s0">,</span>
                <span class="s1">linestyle=</span><span class="s2">'--'</span><span class="s0">,</span>
                <span class="s1">color=</span><span class="s2">'green'</span><span class="s0">,</span>
                <span class="s1">zorder=</span><span class="s3">4</span><span class="s1">)</span>
        <span class="s1">ax.view_init(elev=</span><span class="s3">20</span><span class="s0">, </span><span class="s1">azim=-</span><span class="s3">20</span><span class="s0">, </span><span class="s1">roll=</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">ax.axis(</span><span class="s2">'off'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_format_coord():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">x = np.arange(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">np.sin(x))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.format_coord(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">) == </span><span class="s2">'x=1.8066, y=1.0367, z=−0.0553'</span>
    <span class="s4"># Modify parameters</span>
    <span class="s1">ax.view_init(roll=</span><span class="s3">30</span><span class="s0">, </span><span class="s1">vertical_axis=</span><span class="s2">&quot;y&quot;</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.format_coord(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">) == </span><span class="s2">'x=9.1651, y=−0.9215, z=−0.0359'</span>
    <span class="s4"># Reset parameters</span>
    <span class="s1">ax.view_init()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.format_coord(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">) == </span><span class="s2">'x=1.8066, y=1.0367, z=−0.0553'</span>


<span class="s0">def </span><span class="s1">test_get_axis_position():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">x = np.arange(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">np.sin(x))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.get_axis_position() == (</span><span class="s0">False, True, False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_margins():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.margins(</span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.margins() == (</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">ax.margins(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.margins() == (</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s1">ax.margins(x=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.margins() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s1">ax.margins(y=</span><span class="s3">0.1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.margins() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s1">ax.margins(z=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.margins() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'err, args, kwargs, match'</span><span class="s0">, </span><span class="s1">(</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s2">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s2">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s2">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">tuple()</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'x'</span><span class="s1">: -</span><span class="s3">1</span><span class="s1">}</span><span class="s0">, </span><span class="s2">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">tuple()</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'y'</span><span class="s1">: -</span><span class="s3">1</span><span class="s1">}</span><span class="s0">, </span><span class="s2">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">tuple()</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'z'</span><span class="s1">: -</span><span class="s3">1</span><span class="s1">}</span><span class="s0">, </span><span class="s2">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'x'</span><span class="s1">: </span><span class="s3">1</span><span class="s1">}</span><span class="s0">,</span>
         <span class="s2">'Cannot pass both positional and keyword'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'x'</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s2">'y'</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s2">'z'</span><span class="s1">: </span><span class="s3">1</span><span class="s1">}</span><span class="s0">,</span>
         <span class="s2">'Cannot pass both positional and keyword'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'x'</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s2">'y'</span><span class="s1">: </span><span class="s3">1</span><span class="s1">}</span><span class="s0">,</span>
         <span class="s2">'Cannot pass both positional and keyword'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s2">'Must pass a single positional argument for'</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_margins_errors(err</span><span class="s0">, </span><span class="s1">args</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">match):</span>
    <span class="s0">with </span><span class="s1">pytest.raises(err</span><span class="s0">, </span><span class="s1">match=match):</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
        <span class="s1">ax.margins(*args</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_text_3d(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_ref.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">txt = Text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">r'Foo bar $\int$'</span><span class="s1">)</span>
    <span class="s1">art3d.text_2d_to_3d(txt</span><span class="s0">, </span><span class="s1">z=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.add_artist(txt)</span>
    <span class="s0">assert </span><span class="s1">txt.get_position_3d() == (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">ax = fig_test.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">t3d = art3d.Text3D(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">r'Foo bar $\int$'</span><span class="s1">)</span>
    <span class="s1">ax.add_artist(t3d)</span>
    <span class="s0">assert </span><span class="s1">t3d.get_position_3d() == (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_draw_single_lines_from_Nx1():</span>
    <span class="s4"># Smoke test for GH#23459</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax.plot([[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s1">]])</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_pathpatch_3d(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_ref.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">path = Path.unit_rectangle()</span>
    <span class="s1">patch = PathPatch(path)</span>
    <span class="s1">art3d.pathpatch_2d_to_3d(patch</span><span class="s0">, </span><span class="s1">z=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.7</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'y'</span><span class="s1">)</span>
    <span class="s1">ax.add_artist(patch)</span>

    <span class="s1">ax = fig_test.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">pp3d = art3d.PathPatch3D(path</span><span class="s0">, </span><span class="s1">zs=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.7</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'y'</span><span class="s1">)</span>
    <span class="s1">ax.add_artist(pp3d)</span>


<span class="s1">@image_comparison(baseline_images=[</span><span class="s2">'scatter_spiral.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=</span><span class="s2">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_scatter_spiral():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">th = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* np.pi * </span><span class="s3">6</span><span class="s0">, </span><span class="s3">256</span><span class="s1">)</span>
    <span class="s1">sc = ax.scatter(np.sin(th)</span><span class="s0">, </span><span class="s1">np.cos(th)</span><span class="s0">, </span><span class="s1">th</span><span class="s0">, </span><span class="s1">s=(</span><span class="s3">1 </span><span class="s1">+ th * </span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=th ** </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># force at least 1 draw!</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s0">def </span><span class="s1">test_Poly3DCollection_get_facecolor():</span>
    <span class="s4"># Smoke test to see that get_facecolor does not raise</span>
    <span class="s4"># See GH#4067</span>
    <span class="s1">y</span><span class="s0">, </span><span class="s1">x = np.ogrid[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">10</span><span class="s1">:</span><span class="s3">100j</span><span class="s0">, </span><span class="s3">1</span><span class="s1">:</span><span class="s3">10</span><span class="s1">:</span><span class="s3">100j</span><span class="s1">]</span>
    <span class="s1">z2 = np.cos(x) ** </span><span class="s3">3 </span><span class="s1">- np.sin(y) ** </span><span class="s3">2</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">111</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">r = ax.plot_surface(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z2</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'hot'</span><span class="s1">)</span>
    <span class="s1">r.get_facecolor()</span>


<span class="s0">def </span><span class="s1">test_Poly3DCollection_get_edgecolor():</span>
    <span class="s4"># Smoke test to see that get_edgecolor does not raise</span>
    <span class="s4"># See GH#4067</span>
    <span class="s1">y</span><span class="s0">, </span><span class="s1">x = np.ogrid[</span><span class="s3">1</span><span class="s1">:</span><span class="s3">10</span><span class="s1">:</span><span class="s3">100j</span><span class="s0">, </span><span class="s3">1</span><span class="s1">:</span><span class="s3">10</span><span class="s1">:</span><span class="s3">100j</span><span class="s1">]</span>
    <span class="s1">z2 = np.cos(x) ** </span><span class="s3">3 </span><span class="s1">- np.sin(y) ** </span><span class="s3">2</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">111</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">r = ax.plot_surface(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z2</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'hot'</span><span class="s1">)</span>
    <span class="s1">r.get_edgecolor()</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;vertical_axis, proj_expected, axis_lines_expected, tickdirs_expected&quot;</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span>
            <span class="s2">&quot;z&quot;</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.142857</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.571429</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.857143</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.428571</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">10.0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[-</span><span class="s3">1.142857</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">10.571429</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">([</span><span class="s3">0.05617978</span><span class="s0">, </span><span class="s3">0.06329114</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">0.04213483</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.04746835</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">([-</span><span class="s3">0.06329114</span><span class="s0">, </span><span class="s3">0.06329114</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">0.04746835</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.04746835</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">([-</span><span class="s3">0.06329114</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.06329114</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">0.04746835</span><span class="s0">, </span><span class="s3">0.04746835</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s2">&quot;y&quot;</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">[</span><span class="s3">1.142857</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.571429</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.857143</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.428571</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">10.0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.142857</span><span class="s0">, </span><span class="s3">10.571429</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">([-</span><span class="s3">0.06329114</span><span class="s0">, </span><span class="s3">0.06329114</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.04746835</span><span class="s0">, </span><span class="s3">0.04746835</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">([</span><span class="s3">0.06329114</span><span class="s0">, </span><span class="s3">0.06329114</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">0.04746835</span><span class="s0">, </span><span class="s3">0.04746835</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">([-</span><span class="s3">0.05617978</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.06329114</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.04213483</span><span class="s0">, </span><span class="s3">0.04746835</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span>
            <span class="s2">&quot;x&quot;</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.142857</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.571429</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">0.857143</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.428571</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">10.0</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.142857</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">10.571429</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span>
                <span class="s1">([-</span><span class="s3">0.06329114</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.06329114</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.04746835</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.04746835</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">([</span><span class="s3">0.06329114</span><span class="s0">, </span><span class="s3">0.05617978</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.04746835</span><span class="s0">, </span><span class="s3">0.04213483</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s1">([</span><span class="s3">0.06329114</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.06329114</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.04746835</span><span class="s0">, </span><span class="s3">0.04746835</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">,</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_view_init_vertical_axis(</span>
    <span class="s1">vertical_axis</span><span class="s0">, </span><span class="s1">proj_expected</span><span class="s0">, </span><span class="s1">axis_lines_expected</span><span class="s0">, </span><span class="s1">tickdirs_expected</span>
<span class="s1">):</span>
    <span class="s5">&quot;&quot;&quot; 
    Test the actual projection, axis lines and ticks matches expected values. 
 
    Parameters 
    ---------- 
    vertical_axis : str 
        Axis to align vertically. 
    proj_expected : ndarray 
        Expected values from ax.get_proj(). 
    axis_lines_expected : tuple of arrays 
        Edgepoints of the axis line. Expected values retrieved according 
        to ``ax.get_[xyz]axis().line.get_data()``. 
    tickdirs_expected : list of int 
        indexes indicating which axis to create a tick line along. 
    &quot;&quot;&quot;</span>
    <span class="s1">rtol = </span><span class="s3">2e-06</span>
    <span class="s1">ax = plt.subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">ax.view_init(elev=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">azim=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">roll=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">vertical_axis=vertical_axis)</span>
    <span class="s1">ax.figure.canvas.draw()</span>

    <span class="s4"># Assert the projection matrix:</span>
    <span class="s1">proj_actual = ax.get_proj()</span>
    <span class="s1">np.testing.assert_allclose(proj_expected</span><span class="s0">, </span><span class="s1">proj_actual</span><span class="s0">, </span><span class="s1">rtol=rtol)</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">enumerate([ax.get_xaxis()</span><span class="s0">, </span><span class="s1">ax.get_yaxis()</span><span class="s0">, </span><span class="s1">ax.get_zaxis()]):</span>
        <span class="s4"># Assert black lines are correctly aligned:</span>
        <span class="s1">axis_line_expected = axis_lines_expected[i]</span>
        <span class="s1">axis_line_actual = axis.line.get_data()</span>
        <span class="s1">np.testing.assert_allclose(axis_line_expected</span><span class="s0">, </span><span class="s1">axis_line_actual</span><span class="s0">,</span>
                                   <span class="s1">rtol=rtol)</span>

        <span class="s4"># Assert ticks are correctly aligned:</span>
        <span class="s1">tickdir_expected = tickdirs_expected[i]</span>
        <span class="s1">tickdir_actual = axis._get_tickdir()</span>
        <span class="s1">np.testing.assert_array_equal(tickdir_expected</span><span class="s0">, </span><span class="s1">tickdir_actual)</span>


<span class="s1">@image_comparison(baseline_images=[</span><span class="s2">'arc_pathpatch.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=</span><span class="s2">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_arc_pathpatch():</span>
    <span class="s1">ax = plt.subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s1">a = mpatch.Arc((</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">0.9</span><span class="s0">,</span>
                   <span class="s1">angle=</span><span class="s3">20</span><span class="s0">, </span><span class="s1">theta1=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">theta2=</span><span class="s3">130</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(a)</span>
    <span class="s1">art3d.pathpatch_2d_to_3d(a</span><span class="s0">, </span><span class="s1">z=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">zdir=</span><span class="s2">'z'</span><span class="s1">)</span>


<span class="s1">@image_comparison(baseline_images=[</span><span class="s2">'panecolor_rcparams.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_panecolor_rcparams():</span>
    <span class="s0">with </span><span class="s1">plt.rc_context({</span><span class="s2">'axes3d.xaxis.panecolor'</span><span class="s1">: </span><span class="s2">'r'</span><span class="s0">,</span>
                         <span class="s2">'axes3d.yaxis.panecolor'</span><span class="s1">: </span><span class="s2">'g'</span><span class="s0">,</span>
                         <span class="s2">'axes3d.zaxis.panecolor'</span><span class="s1">: </span><span class="s2">'b'</span><span class="s1">}):</span>
        <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
        <span class="s1">fig.add_subplot(projection=</span><span class="s2">'3d'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_mutating_input_arrays_y_and_z(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s5">&quot;&quot;&quot; 
    Test to see if the `z` axis does not get mutated 
    after a call to `Axes3D.plot` 
 
    test cases came from GH#8990 
    &quot;&quot;&quot;</span>
    <span class="s1">ax1 = fig_test.add_subplot(</span><span class="s3">111</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">x = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">]</span>
    <span class="s1">z = [</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">]</span>
    <span class="s1">ax1.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s2">'o-'</span><span class="s1">)</span>

    <span class="s4"># mutate y,z to get a nontrivial line</span>
    <span class="s1">y[:] = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">z[:] = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>

    <span class="s4"># draw the same plot without mutating x and y</span>
    <span class="s1">ax2 = fig_ref.add_subplot(</span><span class="s3">111</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">x = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">]</span>
    <span class="s1">z = [</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">]</span>
    <span class="s1">ax2.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s2">'o-'</span><span class="s1">)</span>
</pre>
</body>
</html>