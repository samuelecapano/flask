<html>
<head>
<title>test_rcparams.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_rcparams.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">copy</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>
<span class="s0">import </span><span class="s1">re</span>
<span class="s0">import </span><span class="s1">subprocess</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">from </span><span class="s1">unittest </span><span class="s0">import </span><span class="s1">mock</span>

<span class="s0">from </span><span class="s1">cycler </span><span class="s0">import </span><span class="s1">cycler</span><span class="s0">, </span><span class="s1">Cycler</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">_api</span><span class="s0">, </span><span class="s1">_c_internal_utils</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib.colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">matplotlib.rcsetup </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">validate_bool</span><span class="s0">,</span>
    <span class="s1">validate_color</span><span class="s0">,</span>
    <span class="s1">validate_colorlist</span><span class="s0">,</span>
    <span class="s1">_validate_color_or_linecolor</span><span class="s0">,</span>
    <span class="s1">validate_cycler</span><span class="s0">,</span>
    <span class="s1">validate_float</span><span class="s0">,</span>
    <span class="s1">validate_fontstretch</span><span class="s0">,</span>
    <span class="s1">validate_fontweight</span><span class="s0">,</span>
    <span class="s1">validate_hatch</span><span class="s0">,</span>
    <span class="s1">validate_hist_bins</span><span class="s0">,</span>
    <span class="s1">validate_int</span><span class="s0">,</span>
    <span class="s1">validate_markevery</span><span class="s0">,</span>
    <span class="s1">validate_stringlist</span><span class="s0">,</span>
    <span class="s1">_validate_linestyle</span><span class="s0">,</span>
    <span class="s1">_listify_validator)</span>


<span class="s0">def </span><span class="s1">test_rcparams(tmpdir):</span>
    <span class="s1">mpl.rc(</span><span class="s2">'text'</span><span class="s0">, </span><span class="s1">usetex=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">mpl.rc(</span><span class="s2">'lines'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s3">22</span><span class="s1">)</span>

    <span class="s1">usetex = mpl.rcParams[</span><span class="s2">'text.usetex'</span><span class="s1">]</span>
    <span class="s1">linewidth = mpl.rcParams[</span><span class="s2">'lines.linewidth'</span><span class="s1">]</span>

    <span class="s1">rcpath = Path(tmpdir) / </span><span class="s2">'test_rcparams.rc'</span>
    <span class="s1">rcpath.write_text(</span><span class="s2">'lines.linewidth: 33'</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">'utf-8'</span><span class="s1">)</span>

    <span class="s4"># test context given dictionary</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context(rc={</span><span class="s2">'text.usetex'</span><span class="s1">: </span><span class="s0">not </span><span class="s1">usetex}):</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'text.usetex'</span><span class="s1">] == (</span><span class="s0">not </span><span class="s1">usetex)</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'text.usetex'</span><span class="s1">] == usetex</span>

    <span class="s4"># test context given filename (mpl.rc sets linewidth to 33)</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context(fname=rcpath):</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'lines.linewidth'</span><span class="s1">] == </span><span class="s3">33</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'lines.linewidth'</span><span class="s1">] == linewidth</span>

    <span class="s4"># test context given filename and dictionary</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context(fname=rcpath</span><span class="s0">, </span><span class="s1">rc={</span><span class="s2">'lines.linewidth'</span><span class="s1">: </span><span class="s3">44</span><span class="s1">}):</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'lines.linewidth'</span><span class="s1">] == </span><span class="s3">44</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'lines.linewidth'</span><span class="s1">] == linewidth</span>

    <span class="s4"># test context as decorator (and test reusability, by calling func twice)</span>
    <span class="s1">@mpl.rc_context({</span><span class="s2">'lines.linewidth'</span><span class="s1">: </span><span class="s3">44</span><span class="s1">})</span>
    <span class="s0">def </span><span class="s1">func():</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'lines.linewidth'</span><span class="s1">] == </span><span class="s3">44</span>

    <span class="s1">func()</span>
    <span class="s1">func()</span>

    <span class="s4"># test rc_file</span>
    <span class="s1">mpl.rc_file(rcpath)</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'lines.linewidth'</span><span class="s1">] == </span><span class="s3">33</span>


<span class="s0">def </span><span class="s1">test_RcParams_class():</span>
    <span class="s1">rc = mpl.RcParams({</span><span class="s2">'font.cursive'</span><span class="s1">: [</span><span class="s2">'Apple Chancery'</span><span class="s0">,</span>
                                        <span class="s2">'Textile'</span><span class="s0">,</span>
                                        <span class="s2">'Zapf Chancery'</span><span class="s0">,</span>
                                        <span class="s2">'cursive'</span><span class="s1">]</span><span class="s0">,</span>
                       <span class="s2">'font.family'</span><span class="s1">: </span><span class="s2">'sans-serif'</span><span class="s0">,</span>
                       <span class="s2">'font.weight'</span><span class="s1">: </span><span class="s2">'normal'</span><span class="s0">,</span>
                       <span class="s2">'font.size'</span><span class="s1">: </span><span class="s3">12</span><span class="s1">})</span>

    <span class="s1">expected_repr = </span><span class="s2">&quot;&quot;&quot; 
RcParams({'font.cursive': ['Apple Chancery', 
                           'Textile', 
                           'Zapf Chancery', 
                           'cursive'], 
          'font.family': ['sans-serif'], 
          'font.size': 12.0, 
          'font.weight': 'normal'})&quot;&quot;&quot;</span><span class="s1">.lstrip()</span>

    <span class="s0">assert </span><span class="s1">expected_repr == repr(rc)</span>

    <span class="s1">expected_str = </span><span class="s2">&quot;&quot;&quot; 
font.cursive: ['Apple Chancery', 'Textile', 'Zapf Chancery', 'cursive'] 
font.family: ['sans-serif'] 
font.size: 12.0 
font.weight: normal&quot;&quot;&quot;</span><span class="s1">.lstrip()</span>

    <span class="s0">assert </span><span class="s1">expected_str == str(rc)</span>

    <span class="s4"># test the find_all functionality</span>
    <span class="s0">assert </span><span class="s1">[</span><span class="s2">'font.cursive'</span><span class="s0">, </span><span class="s2">'font.size'</span><span class="s1">] == sorted(rc.find_all(</span><span class="s2">'i[vz]'</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">[</span><span class="s2">'font.family'</span><span class="s1">] == list(rc.find_all(</span><span class="s2">'family'</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_rcparams_update():</span>
    <span class="s1">rc = mpl.RcParams({</span><span class="s2">'figure.figsize'</span><span class="s1">: (</span><span class="s3">3.5</span><span class="s0">, </span><span class="s3">42</span><span class="s1">)})</span>
    <span class="s1">bad_dict = {</span><span class="s2">'figure.figsize'</span><span class="s1">: (</span><span class="s3">3.5</span><span class="s0">, </span><span class="s3">42</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)}</span>
    <span class="s4"># make sure validation happens on input</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError)</span><span class="s0">, </span><span class="s1">\</span>
         <span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;validate&quot;</span><span class="s1">):</span>
        <span class="s1">rc.update(bad_dict)</span>


<span class="s0">def </span><span class="s1">test_rcparams_init():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError)</span><span class="s0">, </span><span class="s1">\</span>
         <span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;validate&quot;</span><span class="s1">):</span>
        <span class="s1">mpl.RcParams({</span><span class="s2">'figure.figsize'</span><span class="s1">: (</span><span class="s3">3.5</span><span class="s0">, </span><span class="s3">42</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)})</span>


<span class="s0">def </span><span class="s1">test_Bug_2543():</span>
    <span class="s4"># Test that it possible to add all values to itself / deepcopy</span>
    <span class="s4"># https://github.com/matplotlib/matplotlib/issues/2543</span>
    <span class="s4"># We filter warnings at this stage since a number of them are raised</span>
    <span class="s4"># for deprecated rcparams as they should. We don't want these in the</span>
    <span class="s4"># printed in the test suite.</span>
    <span class="s0">with </span><span class="s1">_api.suppress_matplotlib_deprecation_warning():</span>
        <span class="s0">with </span><span class="s1">mpl.rc_context():</span>
            <span class="s1">_copy = mpl.rcParams.copy()</span>
            <span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">_copy:</span>
                <span class="s1">mpl.rcParams[key] = _copy[key]</span>
        <span class="s0">with </span><span class="s1">mpl.rc_context():</span>
            <span class="s1">copy.deepcopy(mpl.rcParams)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">validate_bool(</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s0">with </span><span class="s1">mpl.rc_context():</span>
            <span class="s1">mpl.rcParams[</span><span class="s2">'svg.fonttype'</span><span class="s1">] = </span><span class="s0">True</span>


<span class="s1">legend_color_tests = [</span>
    <span class="s1">(</span><span class="s2">'face'</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'color'</span><span class="s1">: </span><span class="s2">'r'</span><span class="s1">}</span><span class="s0">, </span><span class="s1">mcolors.to_rgba(</span><span class="s2">'r'</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'face'</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'color'</span><span class="s1">: </span><span class="s2">'inherit'</span><span class="s0">, </span><span class="s2">'axes.facecolor'</span><span class="s1">: </span><span class="s2">'r'</span><span class="s1">}</span><span class="s0">,</span>
     <span class="s1">mcolors.to_rgba(</span><span class="s2">'r'</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'face'</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'color'</span><span class="s1">: </span><span class="s2">'g'</span><span class="s0">, </span><span class="s2">'axes.facecolor'</span><span class="s1">: </span><span class="s2">'r'</span><span class="s1">}</span><span class="s0">, </span><span class="s1">mcolors.to_rgba(</span><span class="s2">'g'</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'edge'</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'color'</span><span class="s1">: </span><span class="s2">'r'</span><span class="s1">}</span><span class="s0">, </span><span class="s1">mcolors.to_rgba(</span><span class="s2">'r'</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'edge'</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'color'</span><span class="s1">: </span><span class="s2">'inherit'</span><span class="s0">, </span><span class="s2">'axes.edgecolor'</span><span class="s1">: </span><span class="s2">'r'</span><span class="s1">}</span><span class="s0">,</span>
     <span class="s1">mcolors.to_rgba(</span><span class="s2">'r'</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'edge'</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'color'</span><span class="s1">: </span><span class="s2">'g'</span><span class="s0">, </span><span class="s2">'axes.facecolor'</span><span class="s1">: </span><span class="s2">'r'</span><span class="s1">}</span><span class="s0">, </span><span class="s1">mcolors.to_rgba(</span><span class="s2">'g'</span><span class="s1">))</span>
<span class="s1">]</span>
<span class="s1">legend_color_test_ids = [</span>
    <span class="s2">'same facecolor'</span><span class="s0">,</span>
    <span class="s2">'inherited facecolor'</span><span class="s0">,</span>
    <span class="s2">'different facecolor'</span><span class="s0">,</span>
    <span class="s2">'same edgecolor'</span><span class="s0">,</span>
    <span class="s2">'inherited edgecolor'</span><span class="s0">,</span>
    <span class="s2">'different facecolor'</span><span class="s0">,</span>
<span class="s1">]</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'color_type, param_dict, target'</span><span class="s0">, </span><span class="s1">legend_color_tests</span><span class="s0">,</span>
                         <span class="s1">ids=legend_color_test_ids)</span>
<span class="s0">def </span><span class="s1">test_legend_colors(color_type</span><span class="s0">, </span><span class="s1">param_dict</span><span class="s0">, </span><span class="s1">target):</span>
    <span class="s1">param_dict[</span><span class="s2">f'legend.</span><span class="s0">{</span><span class="s1">color_type</span><span class="s0">}</span><span class="s2">color'</span><span class="s1">] = param_dict.pop(</span><span class="s2">'color'</span><span class="s1">)</span>
    <span class="s1">get_func = </span><span class="s2">f'get_</span><span class="s0">{</span><span class="s1">color_type</span><span class="s0">}</span><span class="s2">color'</span>

    <span class="s0">with </span><span class="s1">mpl.rc_context(param_dict):</span>
        <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">ax.plot(range(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'test'</span><span class="s1">)</span>
        <span class="s1">leg = ax.legend()</span>
        <span class="s0">assert </span><span class="s1">getattr(leg.legendPatch</span><span class="s0">, </span><span class="s1">get_func)() == target</span>


<span class="s0">def </span><span class="s1">test_mfc_rcparams():</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">'lines.markerfacecolor'</span><span class="s1">] = </span><span class="s2">'r'</span>
    <span class="s1">ln = mpl.lines.Line2D([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ln.get_markerfacecolor() == </span><span class="s2">'r'</span>


<span class="s0">def </span><span class="s1">test_mec_rcparams():</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">'lines.markeredgecolor'</span><span class="s1">] = </span><span class="s2">'r'</span>
    <span class="s1">ln = mpl.lines.Line2D([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ln.get_markeredgecolor() == </span><span class="s2">'r'</span>


<span class="s0">def </span><span class="s1">test_axes_titlecolor_rcparams():</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">'axes.titlecolor'</span><span class="s1">] = </span><span class="s2">'r'</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">title = ax.set_title(</span><span class="s2">&quot;Title&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">title.get_color() == </span><span class="s2">'r'</span>


<span class="s0">def </span><span class="s1">test_Issue_1713(tmpdir):</span>
    <span class="s1">rcpath = Path(tmpdir) / </span><span class="s2">'test_rcparams.rc'</span>
    <span class="s1">rcpath.write_text(</span><span class="s2">'timezone: UTC'</span><span class="s0">, </span><span class="s1">encoding=</span><span class="s2">'utf-8'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s2">'locale.getpreferredencoding'</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s2">'UTF-32-BE'</span><span class="s1">):</span>
        <span class="s1">rc = mpl.rc_params_from_file(rcpath</span><span class="s0">, True, False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">rc.get(</span><span class="s2">'timezone'</span><span class="s1">) == </span><span class="s2">'UTC'</span>


<span class="s0">def </span><span class="s1">test_animation_frame_formats():</span>
    <span class="s4"># Animation frame_format should allow any of the following</span>
    <span class="s4"># if any of these are not allowed, an exception will be raised</span>
    <span class="s4"># test for gh issue #17908</span>
    <span class="s0">for </span><span class="s1">fmt </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'png'</span><span class="s0">, </span><span class="s2">'jpeg'</span><span class="s0">, </span><span class="s2">'tiff'</span><span class="s0">, </span><span class="s2">'raw'</span><span class="s0">, </span><span class="s2">'rgba'</span><span class="s0">, </span><span class="s2">'ppm'</span><span class="s0">,</span>
                <span class="s2">'sgi'</span><span class="s0">, </span><span class="s2">'bmp'</span><span class="s0">, </span><span class="s2">'pbm'</span><span class="s0">, </span><span class="s2">'svg'</span><span class="s1">]:</span>
        <span class="s1">mpl.rcParams[</span><span class="s2">'animation.frame_format'</span><span class="s1">] = fmt</span>


<span class="s0">def </span><span class="s1">generate_validator_testcases(valid):</span>
    <span class="s1">validation_tests = (</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: validate_bool</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: (*((_</span><span class="s0">, True</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in</span>
                       <span class="s1">(</span><span class="s2">'t'</span><span class="s0">, </span><span class="s2">'y'</span><span class="s0">, </span><span class="s2">'yes'</span><span class="s0">, </span><span class="s2">'on'</span><span class="s0">, </span><span class="s2">'true'</span><span class="s0">, </span><span class="s2">'1'</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, True</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">*((_</span><span class="s0">, False</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in</span>
                       <span class="s1">(</span><span class="s2">'f'</span><span class="s0">, </span><span class="s2">'n'</span><span class="s0">, </span><span class="s2">'no'</span><span class="s0">, </span><span class="s2">'off'</span><span class="s0">, </span><span class="s2">'false'</span><span class="s0">, </span><span class="s2">'0'</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, False</span><span class="s1">)))</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((_</span><span class="s0">, </span><span class="s1">ValueError)</span>
                  <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'aardvark'</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">))</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: validate_stringlist</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s2">''</span><span class="s0">, </span><span class="s1">[])</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'a,b'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'aardvark'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'aardvark'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'aardvark, '</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'aardvark'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'aardvark, ,'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'aardvark'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">([</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">((</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">(iter([</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">(np.array([</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((set()</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">)</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: _listify_validator(validate_int</span><span class="s0">, </span><span class="s1">n=</span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((_</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
                     <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'1, 2'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.5</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))))</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((_</span><span class="s0">, </span><span class="s1">ValueError)</span>
                  <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'aardvark'</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'a'</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                            <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
                            <span class="s1">))</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: _listify_validator(validate_float</span><span class="s0">, </span><span class="s1">n=</span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((_</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.5</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">])</span>
                     <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'1.5, 2.5'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.5</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.5</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">(</span><span class="s3">1.5</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.array((</span><span class="s3">1.5</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">))))</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((_</span><span class="s0">, </span><span class="s1">ValueError)</span>
                  <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'aardvark'</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'a'</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None, </span><span class="s1">)</span><span class="s0">, None</span><span class="s1">))</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: validate_cycler</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s2">'cycler(&quot;color&quot;, &quot;rgb&quot;)'</span><span class="s0">,</span>
                      <span class="s1">cycler(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">'rgb'</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">(cycler(</span><span class="s2">'linestyle'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'-'</span><span class="s0">, </span><span class="s2">'--'</span><span class="s1">])</span><span class="s0">,</span>
                      <span class="s1">cycler(</span><span class="s2">'linestyle'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'-'</span><span class="s0">, </span><span class="s2">'--'</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">&quot;&quot;&quot;(cycler(&quot;color&quot;, [&quot;r&quot;, &quot;g&quot;, &quot;b&quot;]) + 
                          cycler(&quot;mew&quot;, [2, 3, 5]))&quot;&quot;&quot;</span><span class="s0">,</span>
                      <span class="s1">(cycler(</span><span class="s2">&quot;color&quot;</span><span class="s0">, </span><span class="s2">'rgb'</span><span class="s1">) +</span>
                       <span class="s1">cycler(</span><span class="s2">&quot;markeredgewidth&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])))</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">&quot;cycler(c='rgb', lw=[1, 2, 3])&quot;</span><span class="s0">,</span>
                      <span class="s1">cycler(</span><span class="s2">'color'</span><span class="s0">, </span><span class="s2">'rgb'</span><span class="s1">) + cycler(</span><span class="s2">'linewidth'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">&quot;cycler('c', 'rgb') * cycler('linestyle', ['-', '--'])&quot;</span><span class="s0">,</span>
                      <span class="s1">(cycler(</span><span class="s2">'color'</span><span class="s0">, </span><span class="s2">'rgb'</span><span class="s1">) *</span>
                       <span class="s1">cycler(</span><span class="s2">'linestyle'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'-'</span><span class="s0">, </span><span class="s2">'--'</span><span class="s1">])))</span><span class="s0">,</span>
                     <span class="s1">(cycler(</span><span class="s2">'ls'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'-'</span><span class="s0">, </span><span class="s2">'--'</span><span class="s1">])</span><span class="s0">,</span>
                      <span class="s1">cycler(</span><span class="s2">'linestyle'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'-'</span><span class="s0">, </span><span class="s2">'--'</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s1">(cycler(mew=[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span><span class="s0">,</span>
                      <span class="s1">cycler(</span><span class="s2">'markeredgewidth'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s1">)</span><span class="s0">,</span>
         <span class="s4"># This is *so* incredibly important: validate_cycler() eval's</span>
         <span class="s4"># an arbitrary string! I think I have it locked down enough,</span>
         <span class="s4"># and that is what this is testing.</span>
         <span class="s4"># TODO: Note that these tests are actually insufficient, as it may</span>
         <span class="s4"># be that they raised errors, but still did an action prior to</span>
         <span class="s4"># raising the exception. We should devise some additional tests</span>
         <span class="s4"># for that...</span>
         <span class="s2">'fail'</span><span class="s1">: ((</span><span class="s3">4</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># Gotta be a string or Cycler object</span>
                  <span class="s1">(</span><span class="s2">'cycler(&quot;bleh, [])'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># syntax error</span>
                  <span class="s1">(</span><span class="s2">'Cycler(&quot;linewidth&quot;, [1, 2, 3])'</span><span class="s0">,</span>
                   <span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># only 'cycler()' function is allowed</span>
                  <span class="s4"># do not allow dunder in string literals</span>
                  <span class="s1">(</span><span class="s2">&quot;cycler('c', [j.__class__(j) for j in ['r', 'b']])&quot;</span><span class="s0">,</span>
                   <span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">&quot;cycler('c', [j. __class__(j) for j in ['r', 'b']])&quot;</span><span class="s0">,</span>
                   <span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">&quot;cycler('c', [j.</span><span class="s0">\t</span><span class="s2">__class__(j) for j in ['r', 'b']])&quot;</span><span class="s0">,</span>
                   <span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">&quot;cycler('c', [j.</span><span class="s0">\u000c</span><span class="s2">__class__(j) for j in ['r', 'b']])&quot;</span><span class="s0">,</span>
                   <span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">&quot;cycler('c', [j.__class__(j).lower() for j in ['r', 'b']])&quot;</span><span class="s0">,</span>
                   <span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">'1 + 2'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># doesn't produce a Cycler object</span>
                  <span class="s1">(</span><span class="s2">'os.system(&quot;echo Gotcha&quot;)'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># os not available</span>
                  <span class="s1">(</span><span class="s2">'import os'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># should not be able to import</span>
                  <span class="s1">(</span><span class="s2">'def badjuju(a): return a; badjuju(cycler(&quot;color&quot;, &quot;rgb&quot;))'</span><span class="s0">,</span>
                   <span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># Should not be able to define anything</span>
                  <span class="s4"># even if it does return a cycler</span>
                  <span class="s1">(</span><span class="s2">'cycler(&quot;waka&quot;, [1, 2, 3])'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># not a property</span>
                  <span class="s1">(</span><span class="s2">'cycler(c=[1, 2, 3])'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># invalid values</span>
                  <span class="s1">(</span><span class="s2">&quot;cycler(lw=['a', 'b', 'c'])&quot;</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># invalid values</span>
                  <span class="s1">(cycler(</span><span class="s2">'waka'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># not a property</span>
                  <span class="s1">(cycler(</span><span class="s2">'color'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'C1'</span><span class="s0">, </span><span class="s2">'r'</span><span class="s0">, </span><span class="s2">'g'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ValueError)  </span><span class="s4"># no CN</span>
                  <span class="s1">)</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: validate_hatch</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s2">'--|'</span><span class="s0">, </span><span class="s2">'--|'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'</span><span class="s0">\\</span><span class="s2">oO'</span><span class="s0">, </span><span class="s2">'</span><span class="s0">\\</span><span class="s2">oO'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'/+*/.x'</span><span class="s0">, </span><span class="s2">'/+*/.x'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">''</span><span class="s0">, </span><span class="s2">''</span><span class="s1">))</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((</span><span class="s2">'--_'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s3">8</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">'X'</span><span class="s0">, </span><span class="s1">ValueError))</span><span class="s0">,</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: validate_colorlist</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s2">'r,g,b'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'r'</span><span class="s0">, </span><span class="s2">'g'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">([</span><span class="s2">'r'</span><span class="s0">, </span><span class="s2">'g'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'r'</span><span class="s0">, </span><span class="s2">'g'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'r, ,'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'r'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">([</span><span class="s2">''</span><span class="s0">, </span><span class="s2">'g'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'g'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">([np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])]</span><span class="s0">,</span>
                     <span class="s1">np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]))</span><span class="s0">,</span>
                     <span class="s1">(np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]])</span><span class="s0">,</span>
                     <span class="s1">np.array([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]]))</span><span class="s0">,</span>
                     <span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((</span><span class="s2">'fish'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">)</span><span class="s0">,</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: validate_color</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s2">'None'</span><span class="s0">, </span><span class="s2">'none'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'none'</span><span class="s0">, </span><span class="s2">'none'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'AABBCC'</span><span class="s0">, </span><span class="s2">'#AABBCC'</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># RGB hex code</span>
                     <span class="s1">(</span><span class="s2">'AABBCC00'</span><span class="s0">, </span><span class="s2">'#AABBCC00'</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># RGBA hex code</span>
                     <span class="s1">(</span><span class="s2">'tab:blue'</span><span class="s0">, </span><span class="s2">'tab:blue'</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># named color</span>
                     <span class="s1">(</span><span class="s2">'C12'</span><span class="s0">, </span><span class="s2">'C12'</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># color from cycle</span>
                     <span class="s1">(</span><span class="s2">'(0, 1, 0)'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># RGB tuple</span>
                     <span class="s1">((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># non-string version</span>
                     <span class="s1">(</span><span class="s2">'(0, 1, 0, 1)'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># RGBA tuple</span>
                     <span class="s1">((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># non-string version</span>
                     <span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((</span><span class="s2">'tab:veryblue'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># invalid name</span>
                  <span class="s1">(</span><span class="s2">'(0, 1)'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># tuple with length &lt; 3</span>
                  <span class="s1">(</span><span class="s2">'(0, 1, 0, 1, 0)'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># tuple with length &gt; 4</span>
                  <span class="s1">(</span><span class="s2">'(0, 1, none)'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># cannot cast none to float</span>
                  <span class="s1">(</span><span class="s2">'(0, 1, &quot;0.5&quot;)'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># last one not a float</span>
                  <span class="s1">)</span><span class="s0">,</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: _validate_color_or_linecolor</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s2">'linecolor'</span><span class="s0">, </span><span class="s2">'linecolor'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'markerfacecolor'</span><span class="s0">, </span><span class="s2">'markerfacecolor'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'mfc'</span><span class="s0">, </span><span class="s2">'markerfacecolor'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'markeredgecolor'</span><span class="s0">, </span><span class="s2">'markeredgecolor'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'mec'</span><span class="s0">, </span><span class="s2">'markeredgecolor'</span><span class="s1">)</span>
                     <span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((</span><span class="s2">'line'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">'marker'</span><span class="s0">, </span><span class="s1">ValueError)</span>
                  <span class="s1">)</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: validate_hist_bins</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s2">'auto'</span><span class="s0">, </span><span class="s2">'auto'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'fd'</span><span class="s0">, </span><span class="s2">'fd'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'10'</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'1, 2, 3'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">(np.arange(</span><span class="s3">15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">15</span><span class="s1">))</span>
                     <span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((</span><span class="s2">'aardvark'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">)</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: validate_markevery</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s0">None, None</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">((</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
                     <span class="s1">(slice(</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s0">None, </span><span class="s3">2</span><span class="s0">, None</span><span class="s1">))</span><span class="s0">,</span>
                     <span class="s1">(slice(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slice(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
                     <span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: (((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">([</span><span class="s2">'a'</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s2">'a'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s2">'abc'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s3">1</span><span class="s0">, </span><span class="s2">'a'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s3">0.1</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s2">'a'</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">((</span><span class="s2">'a'</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">'abc'</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">'a'</span><span class="s0">, </span><span class="s1">TypeError)</span><span class="s0">,</span>
                  <span class="s1">(object()</span><span class="s0">, </span><span class="s1">TypeError)</span>
                  <span class="s1">)</span>
         <span class="s1">}</span><span class="s0">,</span>
        <span class="s1">{</span><span class="s2">'validator'</span><span class="s1">: _validate_linestyle</span><span class="s0">,</span>
         <span class="s2">'success'</span><span class="s1">: ((</span><span class="s2">'-'</span><span class="s0">, </span><span class="s2">'-'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'solid'</span><span class="s0">, </span><span class="s2">'solid'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'--'</span><span class="s0">, </span><span class="s2">'--'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'dashed'</span><span class="s0">, </span><span class="s2">'dashed'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'-.'</span><span class="s0">, </span><span class="s2">'-.'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'dashdot'</span><span class="s0">, </span><span class="s2">'dashdot'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">':'</span><span class="s0">, </span><span class="s2">':'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'dotted'</span><span class="s0">, </span><span class="s2">'dotted'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">''</span><span class="s0">, </span><span class="s2">''</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">' '</span><span class="s0">, </span><span class="s2">' '</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'None'</span><span class="s0">, </span><span class="s2">'none'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'none'</span><span class="s0">, </span><span class="s2">'none'</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">(</span><span class="s2">'DoTtEd'</span><span class="s0">, </span><span class="s2">'dotted'</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># case-insensitive</span>
                     <span class="s1">(</span><span class="s2">'1, 3'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)))</span><span class="s0">,</span>
                     <span class="s1">([</span><span class="s3">1.23</span><span class="s0">, </span><span class="s3">456</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.23</span><span class="s0">, </span><span class="s3">456.0</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">3.0</span><span class="s0">, </span><span class="s3">4.0</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s1">((</span><span class="s3">0</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s1">((-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]))</span><span class="s0">,</span>
                     <span class="s1">)</span><span class="s0">,</span>
         <span class="s2">'fail'</span><span class="s1">: ((</span><span class="s2">'aardvark'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># not a valid string</span>
                  <span class="s1">(</span><span class="s5">b'dotted'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">(</span><span class="s2">'dotted'</span><span class="s1">.encode(</span><span class="s2">'utf-16'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
                  <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># sequence with odd length</span>
                  <span class="s1">(</span><span class="s3">1.23</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># not a sequence</span>
                  <span class="s1">((</span><span class="s2">&quot;a&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># wrong explicit offset</span>
                  <span class="s1">((</span><span class="s0">None, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># wrong explicit offset</span>
                  <span class="s1">((</span><span class="s3">1</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># odd length sequence</span>
                  <span class="s1">(([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># inverted offset/onoff</span>
                  <span class="s1">)</span>
         <span class="s1">}</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">validator_dict </span><span class="s0">in </span><span class="s1">validation_tests:</span>
        <span class="s1">validator = validator_dict[</span><span class="s2">'validator'</span><span class="s1">]</span>
        <span class="s0">if </span><span class="s1">valid:</span>
            <span class="s0">for </span><span class="s1">arg</span><span class="s0">, </span><span class="s1">target </span><span class="s0">in </span><span class="s1">validator_dict[</span><span class="s2">'success'</span><span class="s1">]:</span>
                <span class="s0">yield </span><span class="s1">validator</span><span class="s0">, </span><span class="s1">arg</span><span class="s0">, </span><span class="s1">target</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">for </span><span class="s1">arg</span><span class="s0">, </span><span class="s1">error_type </span><span class="s0">in </span><span class="s1">validator_dict[</span><span class="s2">'fail'</span><span class="s1">]:</span>
                <span class="s0">yield </span><span class="s1">validator</span><span class="s0">, </span><span class="s1">arg</span><span class="s0">, </span><span class="s1">error_type</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'validator, arg, target'</span><span class="s0">,</span>
                         <span class="s1">generate_validator_testcases(</span><span class="s0">True</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_validator_valid(validator</span><span class="s0">, </span><span class="s1">arg</span><span class="s0">, </span><span class="s1">target):</span>
    <span class="s1">res = validator(arg)</span>
    <span class="s0">if </span><span class="s1">isinstance(target</span><span class="s0">, </span><span class="s1">np.ndarray):</span>
        <span class="s1">np.testing.assert_equal(res</span><span class="s0">, </span><span class="s1">target)</span>
    <span class="s0">elif not </span><span class="s1">isinstance(target</span><span class="s0">, </span><span class="s1">Cycler):</span>
        <span class="s0">assert </span><span class="s1">res == target</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s4"># Cyclers can't simply be asserted equal. They don't implement __eq__</span>
        <span class="s0">assert </span><span class="s1">list(res) == list(target)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'validator, arg, exception_type'</span><span class="s0">,</span>
                         <span class="s1">generate_validator_testcases(</span><span class="s0">False</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_validator_invalid(validator</span><span class="s0">, </span><span class="s1">arg</span><span class="s0">, </span><span class="s1">exception_type):</span>
    <span class="s0">with </span><span class="s1">pytest.raises(exception_type):</span>
        <span class="s1">validator(arg)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'weight, parsed_weight'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s2">'bold'</span><span class="s0">, </span><span class="s2">'bold'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'BOLD'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># weight is case-sensitive</span>
    <span class="s1">(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'100'</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(np.array(</span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s4"># fractional fontweights are not defined. This should actually raise a</span>
    <span class="s4"># ValueError, but historically did not.</span>
    <span class="s1">(</span><span class="s3">20.6</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'20.6'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
    <span class="s1">([</span><span class="s3">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_validate_fontweight(weight</span><span class="s0">, </span><span class="s1">parsed_weight):</span>
    <span class="s0">if </span><span class="s1">parsed_weight </span><span class="s0">is </span><span class="s1">ValueError:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">validate_fontweight(weight)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">validate_fontweight(weight) == parsed_weight</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'stretch, parsed_stretch'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s2">'expanded'</span><span class="s0">, </span><span class="s2">'expanded'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'EXPANDED'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,  </span><span class="s4"># stretch is case-sensitive</span>
    <span class="s1">(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'100'</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(np.array(</span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s4"># fractional fontweights are not defined. This should actually raise a</span>
    <span class="s4"># ValueError, but historically did not.</span>
    <span class="s1">(</span><span class="s3">20.6</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'20.6'</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
    <span class="s1">([</span><span class="s3">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ValueError)</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_validate_fontstretch(stretch</span><span class="s0">, </span><span class="s1">parsed_stretch):</span>
    <span class="s0">if </span><span class="s1">parsed_stretch </span><span class="s0">is </span><span class="s1">ValueError:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">validate_fontstretch(stretch)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">validate_fontstretch(stretch) == parsed_stretch</span>


<span class="s0">def </span><span class="s1">test_keymaps():</span>
    <span class="s1">key_list = [k </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">mpl.rcParams </span><span class="s0">if </span><span class="s2">'keymap' </span><span class="s0">in </span><span class="s1">k]</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">key_list:</span>
        <span class="s0">assert </span><span class="s1">isinstance(mpl.rcParams[k]</span><span class="s0">, </span><span class="s1">list)</span>


<span class="s0">def </span><span class="s1">test_no_backend_reset_rccontext():</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'backend'</span><span class="s1">] != </span><span class="s2">'module://aardvark'</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context():</span>
        <span class="s1">mpl.rcParams[</span><span class="s2">'backend'</span><span class="s1">] = </span><span class="s2">'module://aardvark'</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'backend'</span><span class="s1">] == </span><span class="s2">'module://aardvark'</span>


<span class="s0">def </span><span class="s1">test_rcparams_reset_after_fail():</span>
    <span class="s4"># There was previously a bug that meant that if rc_context failed and</span>
    <span class="s4"># raised an exception due to issues in the supplied rc parameters, the</span>
    <span class="s4"># global rc parameters were left in a modified state.</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context(rc={</span><span class="s2">'text.usetex'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'text.usetex'</span><span class="s1">] </span><span class="s0">is False</span>
        <span class="s0">with </span><span class="s1">pytest.raises(KeyError):</span>
            <span class="s0">with </span><span class="s1">mpl.rc_context(rc={</span><span class="s2">'text.usetex'</span><span class="s1">: </span><span class="s0">True, </span><span class="s2">'test.blah'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}):</span>
                <span class="s0">pass</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">'text.usetex'</span><span class="s1">] </span><span class="s0">is False</span>


<span class="s1">@pytest.mark.skipif(sys.platform != </span><span class="s2">&quot;linux&quot;</span><span class="s0">, </span><span class="s1">reason=</span><span class="s2">&quot;Linux only&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_backend_fallback_headless(tmpdir):</span>
    <span class="s1">env = {**os.environ</span><span class="s0">,</span>
           <span class="s2">&quot;DISPLAY&quot;</span><span class="s1">: </span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;WAYLAND_DISPLAY&quot;</span><span class="s1">: </span><span class="s2">&quot;&quot;</span><span class="s0">,</span>
           <span class="s2">&quot;MPLBACKEND&quot;</span><span class="s1">: </span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;MPLCONFIGDIR&quot;</span><span class="s1">: str(tmpdir)}</span>
    <span class="s0">with </span><span class="s1">pytest.raises(subprocess.CalledProcessError):</span>
        <span class="s1">subprocess.run(</span>
            <span class="s1">[sys.executable</span><span class="s0">, </span><span class="s2">&quot;-c&quot;</span><span class="s0">,</span>
             <span class="s2">&quot;import matplotlib;&quot;</span>
             <span class="s2">&quot;matplotlib.use('tkagg');&quot;</span>
             <span class="s2">&quot;import matplotlib.pyplot;&quot;</span>
             <span class="s2">&quot;matplotlib.pyplot.plot(42);&quot;</span>
             <span class="s1">]</span><span class="s0">,</span>
            <span class="s1">env=env</span><span class="s0">, </span><span class="s1">check=</span><span class="s0">True, </span><span class="s1">stderr=subprocess.DEVNULL)</span>


<span class="s1">@pytest.mark.skipif(</span>
    <span class="s1">sys.platform == </span><span class="s2">&quot;linux&quot; </span><span class="s0">and not </span><span class="s1">_c_internal_utils.display_is_valid()</span><span class="s0">,</span>
    <span class="s1">reason=</span><span class="s2">&quot;headless&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_backend_fallback_headful(tmpdir):</span>
    <span class="s1">pytest.importorskip(</span><span class="s2">&quot;tkinter&quot;</span><span class="s1">)</span>
    <span class="s1">env = {**os.environ</span><span class="s0">, </span><span class="s2">&quot;MPLBACKEND&quot;</span><span class="s1">: </span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;MPLCONFIGDIR&quot;</span><span class="s1">: str(tmpdir)}</span>
    <span class="s1">backend = subprocess.check_output(</span>
        <span class="s1">[sys.executable</span><span class="s0">, </span><span class="s2">&quot;-c&quot;</span><span class="s0">,</span>
         <span class="s2">&quot;import matplotlib as mpl; &quot;</span>
         <span class="s2">&quot;sentinel = mpl.rcsetup._auto_backend_sentinel; &quot;</span>
         <span class="s4"># Check that access on another instance does not resolve the sentinel.</span>
         <span class="s2">&quot;assert mpl.RcParams({'backend': sentinel})['backend'] == sentinel; &quot;</span>
         <span class="s2">&quot;assert mpl.rcParams._get('backend') == sentinel; &quot;</span>
         <span class="s2">&quot;import matplotlib.pyplot; &quot;</span>
         <span class="s2">&quot;print(matplotlib.get_backend())&quot;</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">env=env</span><span class="s0">, </span><span class="s1">universal_newlines=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># The actual backend will depend on what's installed, but at least tkagg is</span>
    <span class="s4"># present.</span>
    <span class="s0">assert </span><span class="s1">backend.strip().lower() != </span><span class="s2">&quot;agg&quot;</span>


<span class="s0">def </span><span class="s1">test_deprecation(monkeypatch):</span>
    <span class="s1">monkeypatch.setitem(</span>
        <span class="s1">mpl._deprecated_map</span><span class="s0">, </span><span class="s2">&quot;patch.linewidth&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;0.0&quot;</span><span class="s0">, </span><span class="s2">&quot;axes.linewidth&quot;</span><span class="s0">, lambda </span><span class="s1">old: </span><span class="s3">2 </span><span class="s1">* old</span><span class="s0">, lambda </span><span class="s1">new: new / </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning):</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;patch.linewidth&quot;</span><span class="s1">] \</span>
            <span class="s1">== mpl.rcParams[</span><span class="s2">&quot;axes.linewidth&quot;</span><span class="s1">] / </span><span class="s3">2</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning):</span>
        <span class="s1">mpl.rcParams[</span><span class="s2">&quot;patch.linewidth&quot;</span><span class="s1">] = </span><span class="s3">1</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;axes.linewidth&quot;</span><span class="s1">] == </span><span class="s3">2</span>

    <span class="s1">monkeypatch.setitem(</span>
        <span class="s1">mpl._deprecated_ignore_map</span><span class="s0">, </span><span class="s2">&quot;patch.edgecolor&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;0.0&quot;</span><span class="s0">, </span><span class="s2">&quot;axes.edgecolor&quot;</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning):</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;patch.edgecolor&quot;</span><span class="s1">] \</span>
            <span class="s1">== mpl.rcParams[</span><span class="s2">&quot;axes.edgecolor&quot;</span><span class="s1">]</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning):</span>
        <span class="s1">mpl.rcParams[</span><span class="s2">&quot;patch.edgecolor&quot;</span><span class="s1">] = </span><span class="s2">&quot;#abcd&quot;</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;axes.edgecolor&quot;</span><span class="s1">] != </span><span class="s2">&quot;#abcd&quot;</span>

    <span class="s1">monkeypatch.setitem(</span>
        <span class="s1">mpl._deprecated_ignore_map</span><span class="s0">, </span><span class="s2">&quot;patch.force_edgecolor&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;0.0&quot;</span><span class="s0">, None</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning):</span>
        <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;patch.force_edgecolor&quot;</span><span class="s1">] </span><span class="s0">is None</span>

    <span class="s1">monkeypatch.setitem(</span>
        <span class="s1">mpl._deprecated_remain_as_none</span><span class="s0">, </span><span class="s2">&quot;svg.hashsalt&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">&quot;0.0&quot;</span><span class="s0">,</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning):</span>
        <span class="s1">mpl.rcParams[</span><span class="s2">&quot;svg.hashsalt&quot;</span><span class="s1">] = </span><span class="s2">&quot;foobar&quot;</span>
    <span class="s0">assert </span><span class="s1">mpl.rcParams[</span><span class="s2">&quot;svg.hashsalt&quot;</span><span class="s1">] == </span><span class="s2">&quot;foobar&quot;  </span><span class="s4"># Doesn't warn.</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">&quot;svg.hashsalt&quot;</span><span class="s1">] = </span><span class="s0">None  </span><span class="s4"># Doesn't warn.</span>

    <span class="s1">mpl.rcParams.update(mpl.rcParams.copy())  </span><span class="s4"># Doesn't warn.</span>
    <span class="s4"># Note that the warning suppression actually arises from the</span>
    <span class="s4"># iteration over the updater rcParams being protected by</span>
    <span class="s4"># suppress_matplotlib_deprecation_warning, rather than any explicit check.</span>


<span class="s0">def </span><span class="s1">test_rcparams_legend_loc():</span>
    <span class="s1">value = (</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">.7</span><span class="s1">)</span>
    <span class="s1">match_str = </span><span class="s2">f&quot;</span><span class="s0">{</span><span class="s1">value</span><span class="s0">} </span><span class="s2">is not a valid value for legend.loc;&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=re.escape(match_str)):</span>
        <span class="s1">mpl.RcParams({</span><span class="s2">'legend.loc'</span><span class="s1">: value})</span>
</pre>
</body>
</html>