<html>
<head>
<title>test_backend_bases.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_backend_bases.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">re</span>

<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">path</span><span class="s0">, </span><span class="s1">transforms</span>
<span class="s0">from </span><span class="s1">matplotlib.backend_bases </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">FigureCanvasBase</span><span class="s0">, </span><span class="s1">KeyEvent</span><span class="s0">, </span><span class="s1">LocationEvent</span><span class="s0">, </span><span class="s1">MouseButton</span><span class="s0">, </span><span class="s1">MouseEvent</span><span class="s0">,</span>
    <span class="s1">NavigationToolbar2</span><span class="s0">, </span><span class="s1">RendererBase)</span>
<span class="s0">from </span><span class="s1">matplotlib.backend_tools </span><span class="s0">import </span><span class="s1">RubberbandBase</span>
<span class="s0">from </span><span class="s1">matplotlib.figure </span><span class="s0">import </span><span class="s1">Figure</span>
<span class="s0">from </span><span class="s1">matplotlib.testing._markers </span><span class="s0">import </span><span class="s1">needs_pgf_xelatex</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>


<span class="s1">_EXPECTED_WARNING_TOOLMANAGER = (</span>
    <span class="s2">r&quot;Treat the new Tool classes introduced in &quot;</span>
    <span class="s2">r&quot;v[0-9]*.[0-9]* as experimental for now; &quot;</span>
    <span class="s2">&quot;the API and rcParam may change in future versions.&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_uses_per_path():</span>
    <span class="s1">id = transforms.Affine2D()</span>
    <span class="s1">paths = [path.Path.unit_regular_polygon(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">7</span><span class="s1">)]</span>
    <span class="s1">tforms_matrices = [id.rotate(i).get_matrix().copy() </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)]</span>
    <span class="s1">offsets = np.arange(</span><span class="s3">20</span><span class="s1">).reshape((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">facecolors = [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s1">]</span>
    <span class="s1">edgecolors = [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">check(master_transform</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">all_transforms</span><span class="s0">,</span>
              <span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors):</span>
        <span class="s1">rb = RendererBase()</span>
        <span class="s1">raw_paths = list(rb._iter_collection_raw_paths(</span>
            <span class="s1">master_transform</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">all_transforms))</span>
        <span class="s1">gc = rb.new_gc()</span>
        <span class="s1">ids = [path_id </span><span class="s0">for </span><span class="s1">xo</span><span class="s0">, </span><span class="s1">yo</span><span class="s0">, </span><span class="s1">path_id</span><span class="s0">, </span><span class="s1">gc0</span><span class="s0">, </span><span class="s1">rgbFace </span><span class="s0">in</span>
               <span class="s1">rb._iter_collection(</span>
                   <span class="s1">gc</span><span class="s0">, </span><span class="s1">range(len(raw_paths))</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">,</span>
                   <span class="s1">transforms.AffineDeltaTransform(master_transform)</span><span class="s0">,</span>
                   <span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[]</span><span class="s0">, </span><span class="s2">'screen'</span><span class="s1">)]</span>
        <span class="s1">uses = rb._iter_collection_uses_per_path(</span>
            <span class="s1">paths</span><span class="s0">, </span><span class="s1">all_transforms</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors)</span>
        <span class="s0">if </span><span class="s1">raw_paths:</span>
            <span class="s1">seen = np.bincount(ids</span><span class="s0">, </span><span class="s1">minlength=len(raw_paths))</span>
            <span class="s0">assert </span><span class="s1">set(seen).issubset([uses - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">uses])</span>

    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">tforms_matrices</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors)</span>
    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths[</span><span class="s3">0</span><span class="s1">:</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tforms_matrices</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors)</span>
    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">tforms_matrices</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors)</span>
    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">tforms_matrices[</span><span class="s3">0</span><span class="s1">:</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors)</span>
    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors)</span>
    <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">offsets.shape[</span><span class="s3">0</span><span class="s1">]):</span>
        <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">tforms_matrices</span><span class="s0">, </span><span class="s1">offsets[</span><span class="s3">0</span><span class="s1">:n</span><span class="s0">, </span><span class="s1">:]</span><span class="s0">,</span>
              <span class="s1">facecolors</span><span class="s0">, </span><span class="s1">edgecolors)</span>
    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">tforms_matrices</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">edgecolors)</span>
    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">tforms_matrices</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">tforms_matrices</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">check(id</span><span class="s0">, </span><span class="s1">paths</span><span class="s0">, </span><span class="s1">tforms_matrices</span><span class="s0">, </span><span class="s1">offsets</span><span class="s0">, </span><span class="s1">facecolors[</span><span class="s3">0</span><span class="s1">:</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">edgecolors)</span>


<span class="s0">def </span><span class="s1">test_canvas_ctor():</span>
    <span class="s0">assert </span><span class="s1">isinstance(FigureCanvasBase().figure</span><span class="s0">, </span><span class="s1">Figure)</span>


<span class="s0">def </span><span class="s1">test_get_default_filename():</span>
    <span class="s0">assert </span><span class="s1">plt.figure().canvas.get_default_filename() == </span><span class="s2">'image.png'</span>


<span class="s0">def </span><span class="s1">test_canvas_change():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s4"># Replaces fig.canvas</span>
    <span class="s1">canvas = FigureCanvasBase(fig)</span>
    <span class="s4"># Should still work.</span>
    <span class="s1">plt.close(fig)</span>
    <span class="s0">assert not </span><span class="s1">plt.fignum_exists(fig.number)</span>


<span class="s1">@pytest.mark.backend(</span><span class="s2">'pdf'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_non_gui_warning(monkeypatch):</span>
    <span class="s1">plt.subplots()</span>

    <span class="s1">monkeypatch.setenv(</span><span class="s2">&quot;DISPLAY&quot;</span><span class="s0">, </span><span class="s2">&quot;:999&quot;</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning) </span><span class="s0">as </span><span class="s1">rec:</span>
        <span class="s1">plt.show()</span>
        <span class="s0">assert </span><span class="s1">len(rec) == </span><span class="s3">1</span>
        <span class="s0">assert </span><span class="s1">(</span><span class="s2">'Matplotlib is currently using pdf, which is a non-GUI backend'</span>
                <span class="s0">in </span><span class="s1">str(rec[</span><span class="s3">0</span><span class="s1">].message))</span>

    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning) </span><span class="s0">as </span><span class="s1">rec:</span>
        <span class="s1">plt.gcf().show()</span>
        <span class="s0">assert </span><span class="s1">len(rec) == </span><span class="s3">1</span>
        <span class="s0">assert </span><span class="s1">(</span><span class="s2">'Matplotlib is currently using pdf, which is a non-GUI backend'</span>
                <span class="s0">in </span><span class="s1">str(rec[</span><span class="s3">0</span><span class="s1">].message))</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;x, y&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">42</span><span class="s0">, </span><span class="s3">24</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None, </span><span class="s3">42</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None, None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">200</span><span class="s0">, </span><span class="s3">100.01</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">205.75</span><span class="s0">, </span><span class="s3">2.0</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_location_event_position(x</span><span class="s0">, </span><span class="s1">y):</span>
    <span class="s4"># LocationEvent should cast its x and y arguments to int unless it is None.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">canvas = FigureCanvasBase(fig)</span>
    <span class="s1">event = LocationEvent(</span><span class="s2">&quot;test_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s0">if </span><span class="s1">x </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">event.x </span><span class="s0">is None</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">event.x == int(x)</span>
        <span class="s0">assert </span><span class="s1">isinstance(event.x</span><span class="s0">, </span><span class="s1">int)</span>
    <span class="s0">if </span><span class="s1">y </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">event.y </span><span class="s0">is None</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">event.y == int(y)</span>
        <span class="s0">assert </span><span class="s1">isinstance(event.y</span><span class="s0">, </span><span class="s1">int)</span>
    <span class="s0">if </span><span class="s1">x </span><span class="s0">is not None and </span><span class="s1">y </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">re.match(</span>
            <span class="s2">&quot;x={} +y={}&quot;</span><span class="s1">.format(ax.format_xdata(x)</span><span class="s0">, </span><span class="s1">ax.format_ydata(y))</span><span class="s0">,</span>
            <span class="s1">ax.format_coord(x</span><span class="s0">, </span><span class="s1">y))</span>
        <span class="s1">ax.fmt_xdata = ax.fmt_ydata = </span><span class="s0">lambda </span><span class="s1">x: </span><span class="s2">&quot;foo&quot;</span>
        <span class="s0">assert </span><span class="s1">re.match(</span><span class="s2">&quot;x=foo +y=foo&quot;</span><span class="s0">, </span><span class="s1">ax.format_coord(x</span><span class="s0">, </span><span class="s1">y))</span>


<span class="s0">def </span><span class="s1">test_pick():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">&quot;hello&quot;</span><span class="s0">, </span><span class="s1">ha=</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s1">picker=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s1">picks = []</span>
    <span class="s0">def </span><span class="s1">handle_pick(event):</span>
        <span class="s0">assert </span><span class="s1">event.mouseevent.key == </span><span class="s2">&quot;a&quot;</span>
        <span class="s1">picks.append(event)</span>
    <span class="s1">fig.canvas.mpl_connect(</span><span class="s2">&quot;pick_event&quot;</span><span class="s0">, </span><span class="s1">handle_pick)</span>

    <span class="s1">KeyEvent(</span><span class="s2">&quot;key_press_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)._process()</span>
    <span class="s1">MouseEvent(</span><span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">,</span>
               <span class="s1">*fig.transFigure.transform((</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">))</span><span class="s0">,</span>
               <span class="s1">MouseButton.LEFT)._process()</span>
    <span class="s1">KeyEvent(</span><span class="s2">&quot;key_release_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">)._process()</span>
    <span class="s0">assert </span><span class="s1">len(picks) == </span><span class="s3">1</span>


<span class="s0">def </span><span class="s1">test_interactive_zoom():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set(xscale=</span><span class="s2">&quot;logit&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate_mode() </span><span class="s0">is None</span>

    <span class="s1">tb = NavigationToolbar2(fig.canvas)</span>
    <span class="s1">tb.zoom()</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate_mode() == </span><span class="s2">'ZOOM'</span>

    <span class="s1">xlim0 = ax.get_xlim()</span>
    <span class="s1">ylim0 = ax.get_ylim()</span>

    <span class="s4"># Zoom from x=1e-6, y=0.1 to x=1-1e-5, 0.8 (data coordinates, &quot;d&quot;).</span>
    <span class="s1">d0 = (</span><span class="s3">1e-6</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span>
    <span class="s1">d1 = (</span><span class="s3">1</span><span class="s1">-</span><span class="s3">1e-5</span><span class="s0">, </span><span class="s3">0.8</span><span class="s1">)</span>
    <span class="s4"># Convert to screen coordinates (&quot;s&quot;).  Events are defined only with pixel</span>
    <span class="s4"># precision, so round the pixel values, and below, check against the</span>
    <span class="s4"># corresponding xdata/ydata, which are close but not equal to d0/d1.</span>
    <span class="s1">s0 = ax.transData.transform(d0).astype(int)</span>
    <span class="s1">s1 = ax.transData.transform(d1).astype(int)</span>

    <span class="s4"># Zoom in.</span>
    <span class="s1">start_event = MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*s0</span><span class="s0">, </span><span class="s1">MouseButton.LEFT)</span>
    <span class="s1">fig.canvas.callbacks.process(start_event.name</span><span class="s0">, </span><span class="s1">start_event)</span>
    <span class="s1">stop_event = MouseEvent(</span>
        <span class="s2">&quot;button_release_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*s1</span><span class="s0">, </span><span class="s1">MouseButton.LEFT)</span>
    <span class="s1">fig.canvas.callbacks.process(stop_event.name</span><span class="s0">, </span><span class="s1">stop_event)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (start_event.xdata</span><span class="s0">, </span><span class="s1">stop_event.xdata)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (start_event.ydata</span><span class="s0">, </span><span class="s1">stop_event.ydata)</span>

    <span class="s4"># Zoom out.</span>
    <span class="s1">start_event = MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*s1</span><span class="s0">, </span><span class="s1">MouseButton.RIGHT)</span>
    <span class="s1">fig.canvas.callbacks.process(start_event.name</span><span class="s0">, </span><span class="s1">start_event)</span>
    <span class="s1">stop_event = MouseEvent(</span>
        <span class="s2">&quot;button_release_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*s0</span><span class="s0">, </span><span class="s1">MouseButton.RIGHT)</span>
    <span class="s1">fig.canvas.callbacks.process(stop_event.name</span><span class="s0">, </span><span class="s1">stop_event)</span>
    <span class="s4"># Absolute tolerance much less than original xmin (1e-7).</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == pytest.approx(xlim0</span><span class="s0">, </span><span class="s1">rel=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">1e-10</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == pytest.approx(ylim0</span><span class="s0">, </span><span class="s1">rel=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">1e-10</span><span class="s1">)</span>

    <span class="s1">tb.zoom()</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate_mode() </span><span class="s0">is None</span>

    <span class="s0">assert not </span><span class="s1">ax.get_autoscalex_on() </span><span class="s0">and not </span><span class="s1">ax.get_autoscaley_on()</span>


<span class="s0">def </span><span class="s1">test_widgetlock_zoompan():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">fig.canvas.widgetlock(ax)</span>
    <span class="s1">tb = NavigationToolbar2(fig.canvas)</span>
    <span class="s1">tb.zoom()</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate_mode() </span><span class="s0">is None</span>
    <span class="s1">tb.pan()</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate_mode() </span><span class="s0">is None</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;plot_func&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;imshow&quot;</span><span class="s0">, </span><span class="s2">&quot;contourf&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;orientation&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;vertical&quot;</span><span class="s0">, </span><span class="s2">&quot;horizontal&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;tool,button,expected&quot;</span><span class="s0">,</span>
                         <span class="s1">[(</span><span class="s2">&quot;zoom&quot;</span><span class="s0">, </span><span class="s1">MouseButton.LEFT</span><span class="s0">, </span><span class="s1">(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># zoom in</span>
                          <span class="s1">(</span><span class="s2">&quot;zoom&quot;</span><span class="s0">, </span><span class="s1">MouseButton.RIGHT</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># zoom out</span>
                          <span class="s1">(</span><span class="s2">&quot;pan&quot;</span><span class="s0">, </span><span class="s1">MouseButton.LEFT</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">8</span><span class="s1">))</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s2">&quot;pan&quot;</span><span class="s0">, </span><span class="s1">MouseButton.RIGHT</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1.47</span><span class="s0">, </span><span class="s3">7.78</span><span class="s1">))])  </span><span class="s4"># zoom</span>
<span class="s0">def </span><span class="s1">test_interactive_colorbar(plot_func</span><span class="s0">, </span><span class="s1">orientation</span><span class="s0">, </span><span class="s1">tool</span><span class="s0">, </span><span class="s1">button</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">data = np.arange(</span><span class="s3">12</span><span class="s1">).reshape((</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
    <span class="s1">vmin0</span><span class="s0">, </span><span class="s1">vmax0 = </span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span>
    <span class="s1">coll = getattr(ax</span><span class="s0">, </span><span class="s1">plot_func)(data</span><span class="s0">, </span><span class="s1">vmin=vmin0</span><span class="s0">, </span><span class="s1">vmax=vmax0)</span>

    <span class="s1">cb = fig.colorbar(coll</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">orientation=orientation)</span>
    <span class="s0">if </span><span class="s1">plot_func == </span><span class="s2">&quot;contourf&quot;</span><span class="s1">:</span>
        <span class="s4"># Just determine we can't navigate and exit out of the test</span>
        <span class="s0">assert not </span><span class="s1">cb.ax.get_navigate()</span>
        <span class="s0">return</span>

    <span class="s0">assert </span><span class="s1">cb.ax.get_navigate()</span>

    <span class="s4"># Mouse from 4 to 6 (data coordinates, &quot;d&quot;).</span>
    <span class="s1">vmin</span><span class="s0">, </span><span class="s1">vmax = </span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span>
    <span class="s4"># The y coordinate doesn't matter, it just needs to be between 0 and 1</span>
    <span class="s4"># However, we will set d0/d1 to the same y coordinate to test that small</span>
    <span class="s4"># pixel changes in that coordinate doesn't cancel the zoom like a normal</span>
    <span class="s4"># axes would.</span>
    <span class="s1">d0 = (vmin</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">d1 = (vmax</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s4"># Swap them if the orientation is vertical</span>
    <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;vertical&quot;</span><span class="s1">:</span>
        <span class="s1">d0 = d0[::-</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">d1 = d1[::-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s4"># Convert to screen coordinates (&quot;s&quot;).  Events are defined only with pixel</span>
    <span class="s4"># precision, so round the pixel values, and below, check against the</span>
    <span class="s4"># corresponding xdata/ydata, which are close but not equal to d0/d1.</span>
    <span class="s1">s0 = cb.ax.transData.transform(d0).astype(int)</span>
    <span class="s1">s1 = cb.ax.transData.transform(d1).astype(int)</span>

    <span class="s4"># Set up the mouse movements</span>
    <span class="s1">start_event = MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*s0</span><span class="s0">, </span><span class="s1">button)</span>
    <span class="s1">stop_event = MouseEvent(</span>
        <span class="s2">&quot;button_release_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*s1</span><span class="s0">, </span><span class="s1">button)</span>

    <span class="s1">tb = NavigationToolbar2(fig.canvas)</span>
    <span class="s0">if </span><span class="s1">tool == </span><span class="s2">&quot;zoom&quot;</span><span class="s1">:</span>
        <span class="s1">tb.zoom()</span>
        <span class="s1">tb.press_zoom(start_event)</span>
        <span class="s1">tb.drag_zoom(stop_event)</span>
        <span class="s1">tb.release_zoom(stop_event)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">tb.pan()</span>
        <span class="s1">tb.press_pan(start_event)</span>
        <span class="s1">tb.drag_pan(stop_event)</span>
        <span class="s1">tb.release_pan(stop_event)</span>

    <span class="s4"># Should be close, but won't be exact due to screen integer resolution</span>
    <span class="s0">assert </span><span class="s1">(cb.vmin</span><span class="s0">, </span><span class="s1">cb.vmax) == pytest.approx(expected</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.15</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_toolbar_zoompan():</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=_EXPECTED_WARNING_TOOLMANAGER):</span>
        <span class="s1">plt.rcParams[</span><span class="s2">'toolbar'</span><span class="s1">] = </span><span class="s2">'toolmanager'</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate_mode() </span><span class="s0">is None</span>
    <span class="s1">ax.figure.canvas.manager.toolmanager.trigger_tool(</span><span class="s2">'zoom'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate_mode() == </span><span class="s2">&quot;ZOOM&quot;</span>
    <span class="s1">ax.figure.canvas.manager.toolmanager.trigger_tool(</span><span class="s2">'pan'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate_mode() == </span><span class="s2">&quot;PAN&quot;</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;backend&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'svg'</span><span class="s0">, </span><span class="s2">'ps'</span><span class="s0">, </span><span class="s2">'pdf'</span><span class="s0">,</span>
                <span class="s1">pytest.param(</span><span class="s2">'pgf'</span><span class="s0">, </span><span class="s1">marks=needs_pgf_xelatex)]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_draw(backend):</span>
    <span class="s0">from </span><span class="s1">matplotlib.figure </span><span class="s0">import </span><span class="s1">Figure</span>
    <span class="s0">from </span><span class="s1">matplotlib.backends.backend_agg </span><span class="s0">import </span><span class="s1">FigureCanvas</span>
    <span class="s1">test_backend = pytest.importorskip(</span>
        <span class="s2">f'matplotlib.backends.backend_</span><span class="s0">{</span><span class="s1">backend</span><span class="s0">}</span><span class="s2">'</span>
    <span class="s1">)</span>
    <span class="s1">TestCanvas = test_backend.FigureCanvas</span>
    <span class="s1">fig_test = Figure(constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">TestCanvas(fig_test)</span>
    <span class="s1">axes_test = fig_test.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># defaults to FigureCanvasBase</span>
    <span class="s1">fig_agg = Figure(constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># put a backends.backend_agg.FigureCanvas on it</span>
    <span class="s1">FigureCanvas(fig_agg)</span>
    <span class="s1">axes_agg = fig_agg.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">init_pos = [ax.get_position() </span><span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axes_test.ravel()]</span>

    <span class="s1">fig_test.canvas.draw()</span>
    <span class="s1">fig_agg.canvas.draw()</span>

    <span class="s1">layed_out_pos_test = [ax.get_position() </span><span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axes_test.ravel()]</span>
    <span class="s1">layed_out_pos_agg = [ax.get_position() </span><span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axes_agg.ravel()]</span>

    <span class="s0">for </span><span class="s1">init</span><span class="s0">, </span><span class="s1">placed </span><span class="s0">in </span><span class="s1">zip(init_pos</span><span class="s0">, </span><span class="s1">layed_out_pos_test):</span>
        <span class="s0">assert not </span><span class="s1">np.allclose(init</span><span class="s0">, </span><span class="s1">placed</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">0.005</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">ref</span><span class="s0">, </span><span class="s1">test </span><span class="s0">in </span><span class="s1">zip(layed_out_pos_agg</span><span class="s0">, </span><span class="s1">layed_out_pos_test):</span>
        <span class="s1">np.testing.assert_allclose(ref</span><span class="s0">, </span><span class="s1">test</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">0.005</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s2">&quot;key,mouseend,expectedxlim,expectedylim&quot;</span><span class="s0">,</span>
    <span class="s1">[(</span><span class="s0">None, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.7</span><span class="s0">, </span><span class="s3">11.7</span><span class="s1">))</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s0">None, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">))</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s0">None, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.7</span><span class="s0">, </span><span class="s3">11.7</span><span class="s1">))</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s0">None, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># No move</span>
     <span class="s1">(</span><span class="s0">None, </span><span class="s1">(</span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">3.47</span><span class="s0">, </span><span class="s3">5.53</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.25</span><span class="s0">, </span><span class="s3">11.25</span><span class="s1">))</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s0">None, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.25</span><span class="s0">, </span><span class="s3">11.25</span><span class="s1">))</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s0">None, </span><span class="s1">(</span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">0.85</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">3.47</span><span class="s0">, </span><span class="s3">5.53</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">3.14</span><span class="s0">, </span><span class="s3">5.86</span><span class="s1">))</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s0">None, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.85</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">3.14</span><span class="s0">, </span><span class="s3">5.86</span><span class="s1">))</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s2">&quot;shift&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># snap to x</span>
     <span class="s1">(</span><span class="s2">&quot;shift&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.7</span><span class="s0">, </span><span class="s3">11.7</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># snap to y</span>
     <span class="s1">(</span><span class="s2">&quot;shift&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># snap to diagonal</span>
     <span class="s1">(</span><span class="s2">&quot;shift&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">3.47</span><span class="s0">, </span><span class="s3">5.53</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.47</span><span class="s0">, </span><span class="s3">12.47</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># snap to diagonal</span>
     <span class="s1">(</span><span class="s2">&quot;shift&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">3.58</span><span class="s0">, </span><span class="s3">5.41</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">3.58</span><span class="s0">, </span><span class="s3">5.41</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># snap to diagonal</span>
     <span class="s1">(</span><span class="s2">&quot;shift&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.85</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">5.51</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># snap to diagonal</span>
     <span class="s1">(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># only x</span>
     <span class="s1">(</span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.7</span><span class="s0">, </span><span class="s3">11.7</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># only y</span>
     <span class="s1">(</span><span class="s2">&quot;control&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3.49</span><span class="s0">, </span><span class="s3">12.49</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># diagonal</span>
     <span class="s1">(</span><span class="s2">&quot;control&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.72</span><span class="s0">, </span><span class="s3">11.72</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.72</span><span class="s0">, </span><span class="s3">11.72</span><span class="s1">))</span><span class="s0">,  </span><span class="s4"># diagonal</span>
     <span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_interactive_pan(key</span><span class="s0">, </span><span class="s1">mouseend</span><span class="s0">, </span><span class="s1">expectedxlim</span><span class="s0">, </span><span class="s1">expectedylim):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">ax.get_navigate()</span>
    <span class="s4"># Set equal aspect ratio to easier see diagonal snap</span>
    <span class="s1">ax.set_aspect(</span><span class="s2">'equal'</span><span class="s1">)</span>

    <span class="s4"># Mouse move starts from 0.5, 0.5</span>
    <span class="s1">mousestart = (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s4"># Convert to screen coordinates (&quot;s&quot;).  Events are defined only with pixel</span>
    <span class="s4"># precision, so round the pixel values, and below, check against the</span>
    <span class="s4"># corresponding xdata/ydata, which are close but not equal to d0/d1.</span>
    <span class="s1">sstart = ax.transData.transform(mousestart).astype(int)</span>
    <span class="s1">send = ax.transData.transform(mouseend).astype(int)</span>

    <span class="s4"># Set up the mouse movements</span>
    <span class="s1">start_event = MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*sstart</span><span class="s0">, </span><span class="s1">button=MouseButton.LEFT</span><span class="s0">,</span>
        <span class="s1">key=key)</span>
    <span class="s1">stop_event = MouseEvent(</span>
        <span class="s2">&quot;button_release_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*send</span><span class="s0">, </span><span class="s1">button=MouseButton.LEFT</span><span class="s0">,</span>
        <span class="s1">key=key)</span>

    <span class="s1">tb = NavigationToolbar2(fig.canvas)</span>
    <span class="s1">tb.pan()</span>
    <span class="s1">tb.press_pan(start_event)</span>
    <span class="s1">tb.drag_pan(stop_event)</span>
    <span class="s1">tb.release_pan(stop_event)</span>
    <span class="s4"># Should be close, but won't be exact due to screen integer resolution</span>
    <span class="s0">assert </span><span class="s1">tuple(ax.get_xlim()) == pytest.approx(expectedxlim</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.02</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">tuple(ax.get_ylim()) == pytest.approx(expectedylim</span><span class="s0">, </span><span class="s1">abs=</span><span class="s3">0.02</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_toolmanager_remove():</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=_EXPECTED_WARNING_TOOLMANAGER):</span>
        <span class="s1">plt.rcParams[</span><span class="s2">'toolbar'</span><span class="s1">] = </span><span class="s2">'toolmanager'</span>
    <span class="s1">fig = plt.gcf()</span>
    <span class="s1">initial_len = len(fig.canvas.manager.toolmanager.tools)</span>
    <span class="s0">assert </span><span class="s2">'forward' </span><span class="s0">in </span><span class="s1">fig.canvas.manager.toolmanager.tools</span>
    <span class="s1">fig.canvas.manager.toolmanager.remove_tool(</span><span class="s2">'forward'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(fig.canvas.manager.toolmanager.tools) == initial_len - </span><span class="s3">1</span>
    <span class="s0">assert </span><span class="s2">'forward' </span><span class="s0">not in </span><span class="s1">fig.canvas.manager.toolmanager.tools</span>


<span class="s0">def </span><span class="s1">test_toolmanager_get_tool():</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=_EXPECTED_WARNING_TOOLMANAGER):</span>
        <span class="s1">plt.rcParams[</span><span class="s2">'toolbar'</span><span class="s1">] = </span><span class="s2">'toolmanager'</span>
    <span class="s1">fig = plt.gcf()</span>
    <span class="s1">rubberband = fig.canvas.manager.toolmanager.get_tool(</span><span class="s2">'rubberband'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(rubberband</span><span class="s0">, </span><span class="s1">RubberbandBase)</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.manager.toolmanager.get_tool(rubberband) </span><span class="s0">is </span><span class="s1">rubberband</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">&quot;ToolManager does not control tool 'foo'&quot;</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">fig.canvas.manager.toolmanager.get_tool(</span><span class="s2">'foo'</span><span class="s1">) </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.manager.toolmanager.get_tool(</span><span class="s2">'foo'</span><span class="s0">, </span><span class="s1">warn=</span><span class="s0">False</span><span class="s1">) </span><span class="s0">is None</span>

    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">&quot;ToolManager does not control tool 'foo'&quot;</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">fig.canvas.manager.toolmanager.trigger_tool(</span><span class="s2">'foo'</span><span class="s1">) </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_toolmanager_update_keymap():</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=_EXPECTED_WARNING_TOOLMANAGER):</span>
        <span class="s1">plt.rcParams[</span><span class="s2">'toolbar'</span><span class="s1">] = </span><span class="s2">'toolmanager'</span>
    <span class="s1">fig = plt.gcf()</span>
    <span class="s0">assert </span><span class="s2">'v' </span><span class="s0">in </span><span class="s1">fig.canvas.manager.toolmanager.get_tool_keymap(</span><span class="s2">'forward'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">&quot;Key c changed from back to forward&quot;</span><span class="s1">):</span>
        <span class="s1">fig.canvas.manager.toolmanager.update_keymap(</span><span class="s2">'forward'</span><span class="s0">, </span><span class="s2">'c'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.manager.toolmanager.get_tool_keymap(</span><span class="s2">'forward'</span><span class="s1">) == [</span><span class="s2">'c'</span><span class="s1">]</span>
    <span class="s0">with </span><span class="s1">pytest.raises(KeyError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;'foo' not in Tools&quot;</span><span class="s1">):</span>
        <span class="s1">fig.canvas.manager.toolmanager.update_keymap(</span><span class="s2">'foo'</span><span class="s0">, </span><span class="s2">'c'</span><span class="s1">)</span>
</pre>
</body>
</html>