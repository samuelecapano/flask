<html>
<head>
<title>test_constrainedlayout.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_constrainedlayout.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib.transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">gridspec</span><span class="s0">, </span><span class="s1">ticker</span>


<span class="s0">def </span><span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">12</span><span class="s0">, </span><span class="s1">nodec=</span><span class="s0">False</span><span class="s1">):</span>
    <span class="s1">ax.plot([</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
    <span class="s1">ax.locator_params(nbins=</span><span class="s2">3</span><span class="s1">)</span>
    <span class="s0">if not </span><span class="s1">nodec:</span>
        <span class="s1">ax.set_xlabel(</span><span class="s3">'x-label'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>
        <span class="s1">ax.set_ylabel(</span><span class="s3">'y-label'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>
        <span class="s1">ax.set_title(</span><span class="s3">'Title'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">ax.set_xticklabels([])</span>
        <span class="s1">ax.set_yticklabels([])</span>


<span class="s0">def </span><span class="s1">example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">12</span><span class="s1">):</span>
    <span class="s1">dx</span><span class="s0">, </span><span class="s1">dy = </span><span class="s2">0.6</span><span class="s0">, </span><span class="s2">0.6</span>
    <span class="s1">y</span><span class="s0">, </span><span class="s1">x = np.mgrid[slice(-</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3 </span><span class="s1">+ dy</span><span class="s0">, </span><span class="s1">dy)</span><span class="s0">,</span>
                    <span class="s1">slice(-</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3 </span><span class="s1">+ dx</span><span class="s0">, </span><span class="s1">dx)]</span>
    <span class="s1">z = (</span><span class="s2">1 </span><span class="s1">- x / </span><span class="s2">2. </span><span class="s1">+ x ** </span><span class="s2">5 </span><span class="s1">+ y ** </span><span class="s2">3</span><span class="s1">) * np.exp(-x ** </span><span class="s2">2 </span><span class="s1">- y ** </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">pcm = ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z[:-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s3">'RdBu_r'</span><span class="s0">, </span><span class="s1">vmin=-</span><span class="s2">1.</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s2">1.</span><span class="s0">,</span>
                        <span class="s1">rasterized=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'x-label'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">'y-label'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'Title'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>
    <span class="s0">return </span><span class="s1">pcm</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout1.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout1():</span>
    <span class="s4">&quot;&quot;&quot;Test constrained_layout for a single subplot&quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">ax = fig.add_subplot()</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">24</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout2.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout2():</span>
    <span class="s4">&quot;&quot;&quot;Test constrained_layout for 2x2 subplots&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">24</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout3.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout3():</span>
    <span class="s4">&quot;&quot;&quot;Test constrained_layout for colorbars with subplots&quot;&quot;&quot;</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">24</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">nn == </span><span class="s2">3</span><span class="s1">:</span>
            <span class="s1">pad = </span><span class="s2">0.08</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">pad = </span><span class="s2">0.02  </span><span class="s5"># default</span>
        <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">pad=pad)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout4.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout4():</span>
    <span class="s4">&quot;&quot;&quot;Test constrained_layout for a single colorbar with subplots&quot;&quot;&quot;</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">24</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs</span><span class="s0">, </span><span class="s1">pad=</span><span class="s2">0.01</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout5.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s2">0.002</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_constrained_layout5():</span>
    <span class="s4">&quot;&quot;&quot; 
    Test constrained_layout for a single colorbar with subplots, 
    colorbar bottom 
    &quot;&quot;&quot;</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">24</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs</span><span class="s0">,</span>
                 <span class="s1">use_gridspec=</span><span class="s0">False, </span><span class="s1">pad=</span><span class="s2">0.01</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s0">,</span>
                 <span class="s1">location=</span><span class="s3">'bottom'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout6.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s2">0.002</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_constrained_layout6():</span>
    <span class="s4">&quot;&quot;&quot;Test constrained_layout for nested gridspecs&quot;&quot;&quot;</span>
    <span class="s5"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">fig = plt.figure(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">gs = fig.add_gridspec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">figure=fig)</span>
    <span class="s1">gsl = gs[</span><span class="s2">0</span><span class="s1">].subgridspec(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">gsr = gs[</span><span class="s2">1</span><span class="s1">].subgridspec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">axsl = []</span>
    <span class="s0">for </span><span class="s1">gs </span><span class="s0">in </span><span class="s1">gsl:</span>
        <span class="s1">ax = fig.add_subplot(gs)</span>
        <span class="s1">axsl += [ax]</span>
        <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">12</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'x-label</span><span class="s0">\n</span><span class="s3">MultiLine'</span><span class="s1">)</span>
    <span class="s1">axsr = []</span>
    <span class="s0">for </span><span class="s1">gs </span><span class="s0">in </span><span class="s1">gsr:</span>
        <span class="s1">ax = fig.add_subplot(gs)</span>
        <span class="s1">axsr += [ax]</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">12</span><span class="s1">)</span>

    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axsr</span><span class="s0">,</span>
                 <span class="s1">pad=</span><span class="s2">0.01</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.99</span><span class="s0">, </span><span class="s1">location=</span><span class="s3">'bottom'</span><span class="s0">,</span>
                 <span class="s1">ticks=ticker.MaxNLocator(nbins=</span><span class="s2">5</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_identical_subgridspec():</span>

    <span class="s1">fig = plt.figure(constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">GS = fig.add_gridspec(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>

    <span class="s1">GSA = GS[</span><span class="s2">0</span><span class="s1">].subgridspec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
    <span class="s1">GSB = GS[</span><span class="s2">1</span><span class="s1">].subgridspec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>

    <span class="s1">axa = []</span>
    <span class="s1">axb = []</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">3</span><span class="s1">):</span>
        <span class="s1">axa += [fig.add_subplot(GSA[i])]</span>
        <span class="s1">axb += [fig.add_subplot(GSB[i])]</span>

    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s5"># check first row above second</span>
    <span class="s0">assert </span><span class="s1">axa[</span><span class="s2">0</span><span class="s1">].get_position().y0 &gt; axb[</span><span class="s2">0</span><span class="s1">].get_position().y1</span>


<span class="s0">def </span><span class="s1">test_constrained_layout7():</span>
    <span class="s4">&quot;&quot;&quot;Test for proper warning if fig not set in GridSpec&quot;&quot;&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.warns(</span>
        <span class="s1">UserWarning</span><span class="s0">, </span><span class="s1">match=(</span><span class="s3">'There are no gridspecs with layoutgrids. '</span>
                            <span class="s3">'Possibly did not call parent GridSpec with '</span>
                            <span class="s3">'the &quot;figure&quot; keyword'</span><span class="s1">)):</span>
        <span class="s1">fig = plt.figure(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
        <span class="s1">gs = gridspec.GridSpec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">gsl = gridspec.GridSpecFromSubplotSpec(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">gs[</span><span class="s2">0</span><span class="s1">])</span>
        <span class="s1">gsr = gridspec.GridSpecFromSubplotSpec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">gs[</span><span class="s2">1</span><span class="s1">])</span>
        <span class="s0">for </span><span class="s1">gs </span><span class="s0">in </span><span class="s1">gsl:</span>
            <span class="s1">fig.add_subplot(gs)</span>
        <span class="s5"># need to trigger a draw to get warning</span>
        <span class="s1">fig.draw_without_rendering()</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout8.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout8():</span>
    <span class="s4">&quot;&quot;&quot;Test for gridspecs that are not completely full&quot;&quot;&quot;</span>

    <span class="s1">fig = plt.figure(figsize=(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">gs = gridspec.GridSpec(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s1">figure=fig)</span>
    <span class="s1">axs = []</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]:</span>
        <span class="s0">if </span><span class="s1">j == </span><span class="s2">0</span><span class="s1">:</span>
            <span class="s1">ilist = [</span><span class="s2">1</span><span class="s1">]</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">ilist = [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">ilist:</span>
            <span class="s1">ax = fig.add_subplot(gs[j</span><span class="s0">, </span><span class="s1">i])</span>
            <span class="s1">axs += [ax]</span>
            <span class="s1">example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">i &gt; </span><span class="s2">0</span><span class="s1">:</span>
                <span class="s1">ax.set_ylabel(</span><span class="s3">''</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">j &lt; </span><span class="s2">1</span><span class="s1">:</span>
                <span class="s1">ax.set_xlabel(</span><span class="s3">''</span><span class="s1">)</span>
            <span class="s1">ax.set_title(</span><span class="s3">''</span><span class="s1">)</span>
    <span class="s1">ax = fig.add_subplot(gs[</span><span class="s2">2</span><span class="s0">, </span><span class="s1">:])</span>
    <span class="s1">axs += [ax]</span>
    <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s1">)</span>

    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs</span><span class="s0">, </span><span class="s1">pad=</span><span class="s2">0.01</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout9.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout9():</span>
    <span class="s4">&quot;&quot;&quot;Test for handling suptitle and for sharex and sharey&quot;&quot;&quot;</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s0">,</span>
                            <span class="s1">sharex=</span><span class="s0">False, </span><span class="s1">sharey=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">24</span><span class="s1">)</span>
        <span class="s1">ax.set_xlabel(</span><span class="s3">''</span><span class="s1">)</span>
        <span class="s1">ax.set_ylabel(</span><span class="s3">''</span><span class="s1">)</span>
    <span class="s1">ax.set_aspect(</span><span class="s2">2.</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs</span><span class="s0">, </span><span class="s1">pad=</span><span class="s2">0.01</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s1">)</span>
    <span class="s1">fig.suptitle(</span><span class="s3">'Test Suptitle'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">28</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout10.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout10():</span>
    <span class="s4">&quot;&quot;&quot;Test for handling legend outside axis&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">ax.plot(np.arange(</span><span class="s2">12</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'This is a label'</span><span class="s1">)</span>
    <span class="s1">ax.legend(loc=</span><span class="s3">'center left'</span><span class="s0">, </span><span class="s1">bbox_to_anchor=(</span><span class="s2">0.8</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout11.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout11():</span>
    <span class="s4">&quot;&quot;&quot;Test for multiple nested gridspecs&quot;&quot;&quot;</span>

    <span class="s1">fig = plt.figure(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s2">13</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
    <span class="s1">gs0 = gridspec.GridSpec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">figure=fig)</span>
    <span class="s1">gsl = gridspec.GridSpecFromSubplotSpec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">gs0[</span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">gsl0 = gridspec.GridSpecFromSubplotSpec(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">gsl[</span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">ax = fig.add_subplot(gs0[</span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s1">)</span>
    <span class="s1">axs = []</span>
    <span class="s0">for </span><span class="s1">gs </span><span class="s0">in </span><span class="s1">gsl0:</span>
        <span class="s1">ax = fig.add_subplot(gs)</span>
        <span class="s1">axs += [ax]</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s2">70.</span><span class="s1">)</span>
    <span class="s1">ax = fig.add_subplot(gsl[</span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout11rat.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout11rat():</span>
    <span class="s4">&quot;&quot;&quot;Test for multiple nested gridspecs with width_ratios&quot;&quot;&quot;</span>

    <span class="s1">fig = plt.figure(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span>
    <span class="s1">gs0 = gridspec.GridSpec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">figure=fig</span><span class="s0">, </span><span class="s1">width_ratios=[</span><span class="s2">6</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">gsl = gridspec.GridSpecFromSubplotSpec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">gs0[</span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">gsl0 = gridspec.GridSpecFromSubplotSpec(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">gsl[</span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">height_ratios=[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">ax = fig.add_subplot(gs0[</span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s1">)</span>
    <span class="s1">axs = []</span>
    <span class="s0">for </span><span class="s1">gs </span><span class="s0">in </span><span class="s1">gsl0:</span>
        <span class="s1">ax = fig.add_subplot(gs)</span>
        <span class="s1">axs += [ax]</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s2">70.</span><span class="s1">)</span>
    <span class="s1">ax = fig.add_subplot(gsl[</span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout12.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout12():</span>
    <span class="s4">&quot;&quot;&quot;Test that very unbalanced labeling still works.&quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">8</span><span class="s1">))</span>

    <span class="s1">gs0 = gridspec.GridSpec(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">figure=fig)</span>

    <span class="s1">ax1 = fig.add_subplot(gs0[:</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">ax2 = fig.add_subplot(gs0[</span><span class="s2">3</span><span class="s1">:</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">example_plot(ax1</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">18</span><span class="s1">)</span>
    <span class="s1">example_plot(ax2</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">18</span><span class="s1">)</span>

    <span class="s1">ax = fig.add_subplot(gs0[</span><span class="s2">0</span><span class="s1">:</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">nodec=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax = fig.add_subplot(gs0[</span><span class="s2">2</span><span class="s1">:</span><span class="s2">4</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">nodec=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax = fig.add_subplot(gs0[</span><span class="s2">4</span><span class="s1">:</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">nodec=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'x-label'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout13.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s2">2.e-2</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_constrained_layout13():</span>
    <span class="s4">&quot;&quot;&quot;Test that padding works.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">12</span><span class="s1">)</span>
        <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s2">20.</span><span class="s0">, </span><span class="s1">pad=</span><span class="s2">0.02</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">fig.get_layout_engine().set(wpad=</span><span class="s2">1</span><span class="s0">, </span><span class="s1">hpad=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">fig.get_layout_engine().set(w_pad=</span><span class="s2">24.</span><span class="s1">/</span><span class="s2">72.</span><span class="s0">, </span><span class="s1">h_pad=</span><span class="s2">24.</span><span class="s1">/</span><span class="s2">72.</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout14.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout14():</span>
    <span class="s4">&quot;&quot;&quot;Test that padding works.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pcm = example_pcolor(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">12</span><span class="s1">)</span>
        <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s2">20.</span><span class="s0">, </span><span class="s1">pad=</span><span class="s2">0.02</span><span class="s1">)</span>
    <span class="s1">fig.get_layout_engine().set(</span>
            <span class="s1">w_pad=</span><span class="s2">3.</span><span class="s1">/</span><span class="s2">72.</span><span class="s0">, </span><span class="s1">h_pad=</span><span class="s2">3.</span><span class="s1">/</span><span class="s2">72.</span><span class="s0">,</span>
            <span class="s1">hspace=</span><span class="s2">0.2</span><span class="s0">, </span><span class="s1">wspace=</span><span class="s2">0.2</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout15.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout15():</span>
    <span class="s4">&quot;&quot;&quot;Test that rcparams work.&quot;&quot;&quot;</span>
    <span class="s1">mpl.rcParams[</span><span class="s3">'figure.constrained_layout.use'</span><span class="s1">] = </span><span class="s0">True</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">12</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout16.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout16():</span>
    <span class="s4">&quot;&quot;&quot;Test ax.set_position.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">example_plot(ax</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">12</span><span class="s1">)</span>
    <span class="s1">ax2 = fig.add_axes([</span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.4</span><span class="s0">, </span><span class="s2">0.4</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">'constrained_layout17.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_constrained_layout17():</span>
    <span class="s4">&quot;&quot;&quot;Test uneven gridspecs&quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">gs = gridspec.GridSpec(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">figure=fig)</span>

    <span class="s1">ax1 = fig.add_subplot(gs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">ax2 = fig.add_subplot(gs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">:])</span>
    <span class="s1">ax3 = fig.add_subplot(gs[</span><span class="s2">1</span><span class="s1">:</span><span class="s0">, </span><span class="s2">0</span><span class="s1">:</span><span class="s2">2</span><span class="s1">])</span>
    <span class="s1">ax4 = fig.add_subplot(gs[</span><span class="s2">1</span><span class="s1">:</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1</span><span class="s1">])</span>

    <span class="s1">example_plot(ax1)</span>
    <span class="s1">example_plot(ax2)</span>
    <span class="s1">example_plot(ax3)</span>
    <span class="s1">example_plot(ax4)</span>


<span class="s0">def </span><span class="s1">test_constrained_layout18():</span>
    <span class="s4">&quot;&quot;&quot;Test twinx&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">ax2 = ax.twinx()</span>
    <span class="s1">example_plot(ax)</span>
    <span class="s1">example_plot(ax2</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">24</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">assert </span><span class="s1">all(ax.get_position().extents == ax2.get_position().extents)</span>


<span class="s0">def </span><span class="s1">test_constrained_layout19():</span>
    <span class="s4">&quot;&quot;&quot;Test twiny&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">ax2 = ax.twiny()</span>
    <span class="s1">example_plot(ax)</span>
    <span class="s1">example_plot(ax2</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">24</span><span class="s1">)</span>
    <span class="s1">ax2.set_title(</span><span class="s3">''</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">''</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">assert </span><span class="s1">all(ax.get_position().extents == ax2.get_position().extents)</span>


<span class="s0">def </span><span class="s1">test_constrained_layout20():</span>
    <span class="s4">&quot;&quot;&quot;Smoke test cl does not mess up added axes&quot;&quot;&quot;</span>
    <span class="s1">gx = np.linspace(-</span><span class="s2">5</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>
    <span class="s1">img = np.hypot(gx</span><span class="s0">, </span><span class="s1">gx[:</span><span class="s0">, None</span><span class="s1">])</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_axes([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">mesh = ax.pcolormesh(gx</span><span class="s0">, </span><span class="s1">gx</span><span class="s0">, </span><span class="s1">img[:-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">fig.colorbar(mesh)</span>


<span class="s0">def </span><span class="s1">test_constrained_layout21():</span>
    <span class="s4">&quot;&quot;&quot;#11035: repeated calls to suptitle should not alter the layout&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>

    <span class="s1">fig.suptitle(</span><span class="s3">&quot;Suptitle0&quot;</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">extents0 = np.copy(ax.get_position().extents)</span>

    <span class="s1">fig.suptitle(</span><span class="s3">&quot;Suptitle1&quot;</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">extents1 = np.copy(ax.get_position().extents)</span>

    <span class="s1">np.testing.assert_allclose(extents0</span><span class="s0">, </span><span class="s1">extents1)</span>


<span class="s0">def </span><span class="s1">test_constrained_layout22():</span>
    <span class="s4">&quot;&quot;&quot;#11035: suptitle should not be include in CL if manually positioned&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>

    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">extents0 = np.copy(ax.get_position().extents)</span>

    <span class="s1">fig.suptitle(</span><span class="s3">&quot;Suptitle&quot;</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">0.5</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">extents1 = np.copy(ax.get_position().extents)</span>

    <span class="s1">np.testing.assert_allclose(extents0</span><span class="s0">, </span><span class="s1">extents1)</span>


<span class="s0">def </span><span class="s1">test_constrained_layout23():</span>
    <span class="s4">&quot;&quot;&quot; 
    Comment in #11035: suptitle used to cause an exception when 
    reusing a figure w/ CL with ``clear=True``. 
    &quot;&quot;&quot;</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">2</span><span class="s1">):</span>
        <span class="s1">fig = plt.figure(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s0">, </span><span class="s1">clear=</span><span class="s0">True, </span><span class="s1">num=</span><span class="s3">&quot;123&quot;</span><span class="s1">)</span>
        <span class="s1">gs = fig.add_gridspec(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">sub = gs[</span><span class="s2">0</span><span class="s1">].subgridspec(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
        <span class="s1">fig.suptitle(</span><span class="s3">&quot;Suptitle{}&quot;</span><span class="s1">.format(i))</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_colorbar_location.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_location():</span>
    <span class="s4">&quot;&quot;&quot; 
    Test that colorbar handling is as expected for various complicated 
    cases... 
    &quot;&quot;&quot;</span>
    <span class="s5"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pcm = example_pcolor(ax)</span>
        <span class="s1">ax.set_xlabel(</span><span class="s3">''</span><span class="s1">)</span>
        <span class="s1">ax.set_ylabel(</span><span class="s3">''</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs[:</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.4</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs[-</span><span class="s2">1</span><span class="s0">, </span><span class="s1">:</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.5</span><span class="s0">, </span><span class="s1">location=</span><span class="s3">'bottom'</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.5</span><span class="s0">, </span><span class="s1">location=</span><span class="s3">'bottom'</span><span class="s0">, </span><span class="s1">pad=</span><span class="s2">0.05</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs[-</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.5</span><span class="s0">, </span><span class="s1">location=</span><span class="s3">'top'</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.5</span><span class="s0">, </span><span class="s1">location=</span><span class="s3">'left'</span><span class="s1">)</span>
    <span class="s1">fig.colorbar(pcm</span><span class="s0">, </span><span class="s1">ax=axs[</span><span class="s2">1</span><span class="s1">:</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.5</span><span class="s0">, </span><span class="s1">location=</span><span class="s3">'right'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hidden_axes():</span>
    <span class="s5"># test that if we make an Axes not visible that constrained_layout</span>
    <span class="s5"># still works.  Note the axes still takes space in the layout</span>
    <span class="s5"># (as does a gridspec slot that is empty)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">].set_visible(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">extents1 = np.copy(axs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">].get_position().extents)</span>

    <span class="s1">np.testing.assert_allclose(</span>
        <span class="s1">extents1</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.045552</span><span class="s0">, </span><span class="s2">0.543288</span><span class="s0">, </span><span class="s2">0.47819</span><span class="s0">, </span><span class="s2">0.982638</span><span class="s1">]</span><span class="s0">, </span><span class="s1">rtol=</span><span class="s2">1e-5</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_align():</span>
    <span class="s0">for </span><span class="s1">location </span><span class="s0">in </span><span class="s1">[</span><span class="s3">'right'</span><span class="s0">, </span><span class="s3">'left'</span><span class="s0">, </span><span class="s3">'top'</span><span class="s0">, </span><span class="s3">'bottom'</span><span class="s1">]:</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
        <span class="s1">cbs = []</span>
        <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
            <span class="s1">ax.tick_params(direction=</span><span class="s3">'in'</span><span class="s1">)</span>
            <span class="s1">pc = example_pcolor(ax)</span>
            <span class="s1">cb = fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">location=location</span><span class="s0">, </span><span class="s1">shrink=</span><span class="s2">0.6</span><span class="s0">,</span>
                              <span class="s1">pad=</span><span class="s2">0.04</span><span class="s1">)</span>
            <span class="s1">cbs += [cb]</span>
            <span class="s1">cb.ax.tick_params(direction=</span><span class="s3">'in'</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">nn != </span><span class="s2">1</span><span class="s1">:</span>
                <span class="s1">cb.ax.xaxis.set_ticks([])</span>
                <span class="s1">cb.ax.yaxis.set_ticks([])</span>
                <span class="s1">ax.set_xticklabels([])</span>
                <span class="s1">ax.set_yticklabels([])</span>
        <span class="s1">fig.get_layout_engine().set(w_pad=</span><span class="s2">4 </span><span class="s1">/ </span><span class="s2">72</span><span class="s0">, </span><span class="s1">h_pad=</span><span class="s2">4 </span><span class="s1">/ </span><span class="s2">72</span><span class="s0">,</span>
                                    <span class="s1">hspace=</span><span class="s2">0.1</span><span class="s0">, </span><span class="s1">wspace=</span><span class="s2">0.1</span><span class="s1">)</span>

        <span class="s1">fig.draw_without_rendering()</span>
        <span class="s0">if </span><span class="s1">location </span><span class="s0">in </span><span class="s1">[</span><span class="s3">'left'</span><span class="s0">, </span><span class="s3">'right'</span><span class="s1">]:</span>
            <span class="s1">np.testing.assert_allclose(cbs[</span><span class="s2">0</span><span class="s1">].ax.get_position().x0</span><span class="s0">,</span>
                                       <span class="s1">cbs[</span><span class="s2">2</span><span class="s1">].ax.get_position().x0)</span>
            <span class="s1">np.testing.assert_allclose(cbs[</span><span class="s2">1</span><span class="s1">].ax.get_position().x0</span><span class="s0">,</span>
                                       <span class="s1">cbs[</span><span class="s2">3</span><span class="s1">].ax.get_position().x0)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">np.testing.assert_allclose(cbs[</span><span class="s2">0</span><span class="s1">].ax.get_position().y0</span><span class="s0">,</span>
                                       <span class="s1">cbs[</span><span class="s2">1</span><span class="s1">].ax.get_position().y0)</span>
            <span class="s1">np.testing.assert_allclose(cbs[</span><span class="s2">2</span><span class="s1">].ax.get_position().y0</span><span class="s0">,</span>
                                       <span class="s1">cbs[</span><span class="s2">3</span><span class="s1">].ax.get_position().y0)</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_colorbars_no_overlapV.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_colorbars_no_overlapV():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">axs = fig.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs:</span>
        <span class="s1">ax.yaxis.set_major_formatter(ticker.NullFormatter())</span>
        <span class="s1">ax.tick_params(axis=</span><span class="s3">'both'</span><span class="s0">, </span><span class="s1">direction=</span><span class="s3">'in'</span><span class="s1">)</span>
        <span class="s1">im = ax.imshow([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span>
        <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">&quot;vertical&quot;</span><span class="s1">)</span>
    <span class="s1">fig.suptitle(</span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_colorbars_no_overlapH.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_colorbars_no_overlapH():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">fig.suptitle(</span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span>
    <span class="s1">axs = fig.subplots(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs:</span>
        <span class="s1">ax.yaxis.set_major_formatter(ticker.NullFormatter())</span>
        <span class="s1">ax.tick_params(axis=</span><span class="s3">'both'</span><span class="s0">, </span><span class="s1">direction=</span><span class="s3">'in'</span><span class="s1">)</span>
        <span class="s1">im = ax.imshow([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]])</span>
        <span class="s1">fig.colorbar(im</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">&quot;horizontal&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_manually_set_position():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s2">0</span><span class="s1">].set_position([</span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.3</span><span class="s0">, </span><span class="s2">0.3</span><span class="s1">])</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">pp = axs[</span><span class="s2">0</span><span class="s1">].get_position()</span>
    <span class="s1">np.testing.assert_allclose(pp</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s2">0</span><span class="s1">].set_position([</span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.3</span><span class="s0">, </span><span class="s2">0.3</span><span class="s1">])</span>
    <span class="s1">pc = axs[</span><span class="s2">0</span><span class="s1">].pcolormesh(np.random.rand(</span><span class="s2">20</span><span class="s0">, </span><span class="s2">20</span><span class="s1">))</span>
    <span class="s1">fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=axs[</span><span class="s2">0</span><span class="s1">])</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">pp = axs[</span><span class="s2">0</span><span class="s1">].get_position()</span>
    <span class="s1">np.testing.assert_allclose(pp</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.44</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">]])</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_bboxtight.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'bbox_inches'</span><span class="s1">: </span><span class="s3">'tight'</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_bboxtight():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_aspect(</span><span class="s2">1.</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_bbox.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'bbox_inches'</span><span class="s1">:</span>
                                 <span class="s1">mtransforms.Bbox([[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2.5</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]])})</span>
<span class="s0">def </span><span class="s1">test_bbox():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_aspect(</span><span class="s2">1.</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_align_labels():</span>
    <span class="s4">&quot;&quot;&quot; 
    Tests for a bug in which constrained layout and align_ylabels on 
    three unevenly sized subplots, one of whose y tick labels include 
    negative numbers, drives the non-negative subplots' y labels off 
    the edge of the plot 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax3</span><span class="s0">, </span><span class="s1">ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s0">,</span>
                                        <span class="s1">figsize=(</span><span class="s2">6.4</span><span class="s0">, </span><span class="s2">8</span><span class="s1">)</span><span class="s0">,</span>
                                        <span class="s1">gridspec_kw={</span><span class="s3">&quot;height_ratios&quot;</span><span class="s1">: (</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">,</span>
                                                                       <span class="s2">0.7</span><span class="s1">)})</span>

    <span class="s1">ax1.set_ylim(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">ax1.set_ylabel(</span><span class="s3">&quot;Label&quot;</span><span class="s1">)</span>

    <span class="s1">ax2.set_ylim(-</span><span class="s2">1.5</span><span class="s0">, </span><span class="s2">1.5</span><span class="s1">)</span>
    <span class="s1">ax2.set_ylabel(</span><span class="s3">&quot;Label&quot;</span><span class="s1">)</span>

    <span class="s1">ax3.set_ylim(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">ax3.set_ylabel(</span><span class="s3">&quot;Label&quot;</span><span class="s1">)</span>

    <span class="s1">fig.align_ylabels(axs=(ax3</span><span class="s0">, </span><span class="s1">ax1</span><span class="s0">, </span><span class="s1">ax2))</span>

    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">after_align = [ax1.yaxis.label.get_window_extent()</span><span class="s0">,</span>
                   <span class="s1">ax2.yaxis.label.get_window_extent()</span><span class="s0">,</span>
                   <span class="s1">ax3.yaxis.label.get_window_extent()]</span>
    <span class="s5"># ensure labels are approximately aligned</span>
    <span class="s1">np.testing.assert_allclose([after_align[</span><span class="s2">0</span><span class="s1">].x0</span><span class="s0">, </span><span class="s1">after_align[</span><span class="s2">2</span><span class="s1">].x0]</span><span class="s0">,</span>
                               <span class="s1">after_align[</span><span class="s2">1</span><span class="s1">].x0</span><span class="s0">, </span><span class="s1">rtol=</span><span class="s2">0</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">1e-05</span><span class="s1">)</span>
    <span class="s5"># ensure labels do not go off the edge</span>
    <span class="s0">assert </span><span class="s1">after_align[</span><span class="s2">0</span><span class="s1">].x0 &gt;= </span><span class="s2">1</span>


<span class="s0">def </span><span class="s1">test_suplabels():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">pos0 = ax.get_tightbbox(fig.canvas.get_renderer())</span>
    <span class="s1">fig.supxlabel(</span><span class="s3">'Boo'</span><span class="s1">)</span>
    <span class="s1">fig.supylabel(</span><span class="s3">'Booy'</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">pos = ax.get_tightbbox(fig.canvas.get_renderer())</span>
    <span class="s0">assert </span><span class="s1">pos.y0 &gt; pos0.y0 + </span><span class="s2">10.0</span>
    <span class="s0">assert </span><span class="s1">pos.x0 &gt; pos0.x0 + </span><span class="s2">10.0</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">pos0 = ax.get_tightbbox(fig.canvas.get_renderer())</span>
    <span class="s5"># check that specifying x (y) doesn't ruin the layout</span>
    <span class="s1">fig.supxlabel(</span><span class="s3">'Boo'</span><span class="s0">, </span><span class="s1">x=</span><span class="s2">0.5</span><span class="s1">)</span>
    <span class="s1">fig.supylabel(</span><span class="s3">'Boo'</span><span class="s0">, </span><span class="s1">y=</span><span class="s2">0.5</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">pos = ax.get_tightbbox(fig.canvas.get_renderer())</span>
    <span class="s0">assert </span><span class="s1">pos.y0 &gt; pos0.y0 + </span><span class="s2">10.0</span>
    <span class="s0">assert </span><span class="s1">pos.x0 &gt; pos0.x0 + </span><span class="s2">10.0</span>


<span class="s0">def </span><span class="s1">test_gridspec_addressing():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">gs = fig.add_gridspec(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
    <span class="s1">sp = fig.add_subplot(gs[</span><span class="s2">0</span><span class="s1">:</span><span class="s0">, </span><span class="s2">1</span><span class="s1">:])</span>
    <span class="s1">fig.draw_without_rendering()</span>


<span class="s0">def </span><span class="s1">test_discouraged_api():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>

    <span class="s0">with </span><span class="s1">pytest.warns(PendingDeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s3">&quot;will be deprecated&quot;</span><span class="s1">):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">fig.set_constrained_layout(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">fig.draw_without_rendering()</span>

    <span class="s0">with </span><span class="s1">pytest.warns(PendingDeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s3">&quot;will be deprecated&quot;</span><span class="s1">):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">fig.set_constrained_layout({</span><span class="s3">'w_pad'</span><span class="s1">: </span><span class="s2">0.02</span><span class="s0">, </span><span class="s3">'h_pad'</span><span class="s1">: </span><span class="s2">0.02</span><span class="s1">})</span>
        <span class="s1">fig.draw_without_rendering()</span>


<span class="s0">def </span><span class="s1">test_kwargs():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(constrained_layout={</span><span class="s3">'h_pad'</span><span class="s1">: </span><span class="s2">0.02</span><span class="s1">})</span>
    <span class="s1">fig.draw_without_rendering()</span>


<span class="s0">def </span><span class="s1">test_rect():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">'constrained'</span><span class="s1">)</span>
    <span class="s1">fig.get_layout_engine().set(rect=[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0.5</span><span class="s1">])</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">ppos = ax.get_position()</span>
    <span class="s0">assert </span><span class="s1">ppos.x1 &lt; </span><span class="s2">0.5</span>
    <span class="s0">assert </span><span class="s1">ppos.y1 &lt; </span><span class="s2">0.5</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s3">'constrained'</span><span class="s1">)</span>
    <span class="s1">fig.get_layout_engine().set(rect=[</span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.2</span><span class="s0">, </span><span class="s2">0.3</span><span class="s0">, </span><span class="s2">0.3</span><span class="s1">])</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">ppos = ax.get_position()</span>
    <span class="s0">assert </span><span class="s1">ppos.x1 &lt; </span><span class="s2">0.5</span>
    <span class="s0">assert </span><span class="s1">ppos.y1 &lt; </span><span class="s2">0.5</span>
    <span class="s0">assert </span><span class="s1">ppos.x0 &gt; </span><span class="s2">0.2</span>
    <span class="s0">assert </span><span class="s1">ppos.y0 &gt; </span><span class="s2">0.2</span>


<span class="s0">def </span><span class="s1">test_compressed1():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">'compressed'</span><span class="s0">,</span>
                            <span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pc = ax.imshow(np.random.randn(</span><span class="s2">20</span><span class="s0">, </span><span class="s2">20</span><span class="s1">))</span>

    <span class="s1">fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=axs)</span>
    <span class="s1">fig.draw_without_rendering()</span>

    <span class="s1">pos = axs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">].get_position()</span>
    <span class="s1">np.testing.assert_allclose(pos.x0</span><span class="s0">, </span><span class="s2">0.2344</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">1e-3</span><span class="s1">)</span>
    <span class="s1">pos = axs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s1">].get_position()</span>
    <span class="s1">np.testing.assert_allclose(pos.x1</span><span class="s0">, </span><span class="s2">0.7024</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">1e-3</span><span class="s1">)</span>

    <span class="s5"># wider than tall</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">layout=</span><span class="s3">'compressed'</span><span class="s0">,</span>
                            <span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True, </span><span class="s1">figsize=(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pc = ax.imshow(np.random.randn(</span><span class="s2">20</span><span class="s0">, </span><span class="s2">20</span><span class="s1">))</span>

    <span class="s1">fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=axs)</span>
    <span class="s1">fig.draw_without_rendering()</span>

    <span class="s1">pos = axs[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">].get_position()</span>
    <span class="s1">np.testing.assert_allclose(pos.x0</span><span class="s0">, </span><span class="s2">0.06195</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">1e-3</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(pos.y1</span><span class="s0">, </span><span class="s2">0.8537</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">1e-3</span><span class="s1">)</span>
    <span class="s1">pos = axs[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">].get_position()</span>
    <span class="s1">np.testing.assert_allclose(pos.x1</span><span class="s0">, </span><span class="s2">0.8618</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">1e-3</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(pos.y0</span><span class="s0">, </span><span class="s2">0.1934</span><span class="s0">, </span><span class="s1">atol=</span><span class="s2">1e-3</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'arg, state'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s0">True, True</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s0">False, False</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">({}</span><span class="s0">, True</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">({</span><span class="s3">'rect'</span><span class="s1">: </span><span class="s0">None</span><span class="s1">}</span><span class="s0">, True</span><span class="s1">)</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_set_constrained_layout(arg</span><span class="s0">, </span><span class="s1">state):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(constrained_layout=arg)</span>
    <span class="s0">assert </span><span class="s1">fig.get_constrained_layout() </span><span class="s0">is </span><span class="s1">state</span>


<span class="s0">def </span><span class="s1">test_constrained_toggle():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.warns(PendingDeprecationWarning):</span>
        <span class="s1">fig.set_constrained_layout(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">fig.get_constrained_layout()</span>
        <span class="s1">fig.set_constrained_layout(</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">assert not </span><span class="s1">fig.get_constrained_layout()</span>
        <span class="s1">fig.set_constrained_layout(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">fig.get_constrained_layout()</span>
</pre>
</body>
</html>