<html>
<head>
<title>validators.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
.s6 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
validators.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Various low level data validators.&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">calendar</span>
<span class="s2">from </span><span class="s1">io </span><span class="s2">import </span><span class="s1">open</span>
<span class="s2">import </span><span class="s1">fs.base</span>
<span class="s2">import </span><span class="s1">fs.osfs</span>

<span class="s2">from </span><span class="s1">collections.abc </span><span class="s2">import </span><span class="s1">Mapping</span>
<span class="s2">from </span><span class="s1">fontTools.ufoLib.utils </span><span class="s2">import </span><span class="s1">numberTypes</span>


<span class="s3"># -------</span>
<span class="s3"># Generic</span>
<span class="s3"># -------</span>

<span class="s2">def </span><span class="s1">isDictEnough(value):</span>
    <span class="s0">&quot;&quot;&quot; 
    Some objects will likely come in that aren't 
    dicts but are dict-ish enough. 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">Mapping):</span>
        <span class="s2">return True</span>
    <span class="s2">for </span><span class="s1">attr </span><span class="s2">in </span><span class="s1">(</span><span class="s4">&quot;keys&quot;</span><span class="s2">, </span><span class="s4">&quot;values&quot;</span><span class="s2">, </span><span class="s4">&quot;items&quot;</span><span class="s1">):</span>
        <span class="s2">if not </span><span class="s1">hasattr(value</span><span class="s2">, </span><span class="s1">attr):</span>
            <span class="s2">return False</span>
    <span class="s2">return True</span>

<span class="s2">def </span><span class="s1">genericTypeValidator(value</span><span class="s2">, </span><span class="s1">typ):</span>
	<span class="s0">&quot;&quot;&quot; 
    Generic. (Added at version 2.) 
    &quot;&quot;&quot;</span>
	<span class="s2">return </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">typ)</span>

<span class="s2">def </span><span class="s1">genericIntListValidator(values</span><span class="s2">, </span><span class="s1">validValues):</span>
	<span class="s0">&quot;&quot;&quot; 
    Generic. (Added at version 2.) 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(values</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
		<span class="s2">return False</span>
	<span class="s1">valuesSet = set(values)</span>
	<span class="s1">validValuesSet = set(validValues)</span>
	<span class="s2">if </span><span class="s1">valuesSet - validValuesSet:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">value </span><span class="s2">in </span><span class="s1">values:</span>
		<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">int):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">genericNonNegativeIntValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Generic. (Added at version 3.) 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">int):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">value &lt; </span><span class="s5">0</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">genericNonNegativeNumberValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Generic. (Added at version 3.) 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">numberTypes):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">value &lt; </span><span class="s5">0</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">prototype):</span>
	<span class="s0">&quot;&quot;&quot; 
    Generic. (Added at version 3.) 
    &quot;&quot;&quot;</span>
	<span class="s3"># not a dict</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">Mapping):</span>
		<span class="s2">return False</span>
	<span class="s3"># missing required keys</span>
	<span class="s2">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">(typ</span><span class="s2">, </span><span class="s1">required) </span><span class="s2">in </span><span class="s1">prototype.items():</span>
		<span class="s2">if not </span><span class="s1">required:</span>
			<span class="s2">continue</span>
		<span class="s2">if </span><span class="s1">key </span><span class="s2">not in </span><span class="s1">value:</span>
			<span class="s2">return False</span>
	<span class="s3"># unknown keys</span>
	<span class="s2">for </span><span class="s1">key </span><span class="s2">in </span><span class="s1">value.keys():</span>
		<span class="s2">if </span><span class="s1">key </span><span class="s2">not in </span><span class="s1">prototype:</span>
			<span class="s2">return False</span>
	<span class="s3"># incorrect types</span>
	<span class="s2">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">v </span><span class="s2">in </span><span class="s1">value.items():</span>
		<span class="s1">prototypeType</span><span class="s2">, </span><span class="s1">required = prototype[key]</span>
		<span class="s2">if </span><span class="s1">v </span><span class="s2">is None and not </span><span class="s1">required:</span>
			<span class="s2">continue</span>
		<span class="s2">if not </span><span class="s1">isinstance(v</span><span class="s2">, </span><span class="s1">prototypeType):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s3"># --------------</span>
<span class="s3"># fontinfo.plist</span>
<span class="s3"># --------------</span>

<span class="s3"># Data Validators</span>

<span class="s2">def </span><span class="s1">fontInfoStyleMapStyleNameValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s1">options = [</span><span class="s4">&quot;regular&quot;</span><span class="s2">, </span><span class="s4">&quot;italic&quot;</span><span class="s2">, </span><span class="s4">&quot;bold&quot;</span><span class="s2">, </span><span class="s4">&quot;bold italic&quot;</span><span class="s1">]</span>
	<span class="s2">return </span><span class="s1">value </span><span class="s2">in </span><span class="s1">options</span>

<span class="s2">def </span><span class="s1">fontInfoOpenTypeGaspRangeRecordsValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">list):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(value) == </span><span class="s5">0</span><span class="s1">:</span>
		<span class="s2">return True</span>
	<span class="s1">validBehaviors = [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s1">]</span>
	<span class="s1">dictPrototype = dict(rangeMaxPPEM=(int</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">rangeGaspBehavior=(list</span><span class="s2">, True</span><span class="s1">))</span>
	<span class="s1">ppemOrder = []</span>
	<span class="s2">for </span><span class="s1">rangeRecord </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s2">if not </span><span class="s1">genericDictValidator(rangeRecord</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
			<span class="s2">return False</span>
		<span class="s1">ppem = rangeRecord[</span><span class="s4">&quot;rangeMaxPPEM&quot;</span><span class="s1">]</span>
		<span class="s1">behavior = rangeRecord[</span><span class="s4">&quot;rangeGaspBehavior&quot;</span><span class="s1">]</span>
		<span class="s1">ppemValidity = genericNonNegativeIntValidator(ppem)</span>
		<span class="s2">if not </span><span class="s1">ppemValidity:</span>
			<span class="s2">return False</span>
		<span class="s1">behaviorValidity = genericIntListValidator(behavior</span><span class="s2">, </span><span class="s1">validBehaviors)</span>
		<span class="s2">if not </span><span class="s1">behaviorValidity:</span>
			<span class="s2">return False</span>
		<span class="s1">ppemOrder.append(ppem)</span>
	<span class="s2">if </span><span class="s1">ppemOrder != sorted(ppemOrder):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoOpenTypeHeadCreatedValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s3"># format: 0000/00/00 00:00:00</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">str):</span>
		<span class="s2">return False</span>
	<span class="s3"># basic formatting</span>
	<span class="s2">if not </span><span class="s1">len(value) == </span><span class="s5">19</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">value.count(</span><span class="s4">&quot; &quot;</span><span class="s1">) != </span><span class="s5">1</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s1">date</span><span class="s2">, </span><span class="s1">time = value.split(</span><span class="s4">&quot; &quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">date.count(</span><span class="s4">&quot;/&quot;</span><span class="s1">) != </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">time.count(</span><span class="s4">&quot;:&quot;</span><span class="s1">) != </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s3"># date</span>
	<span class="s1">year</span><span class="s2">, </span><span class="s1">month</span><span class="s2">, </span><span class="s1">day = date.split(</span><span class="s4">&quot;/&quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">len(year) != </span><span class="s5">4</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(month) != </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(day) != </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">try</span><span class="s1">:</span>
		<span class="s1">year = int(year)</span>
		<span class="s1">month = int(month)</span>
		<span class="s1">day = int(day)</span>
	<span class="s2">except </span><span class="s1">ValueError:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">month &lt; </span><span class="s5">1 </span><span class="s2">or </span><span class="s1">month &gt; </span><span class="s5">12</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s1">monthMaxDay = calendar.monthrange(year</span><span class="s2">, </span><span class="s1">month)[</span><span class="s5">1</span><span class="s1">]</span>
	<span class="s2">if </span><span class="s1">day &lt; </span><span class="s5">1 </span><span class="s2">or </span><span class="s1">day &gt; monthMaxDay:</span>
		<span class="s2">return False</span>
	<span class="s3"># time</span>
	<span class="s1">hour</span><span class="s2">, </span><span class="s1">minute</span><span class="s2">, </span><span class="s1">second = time.split(</span><span class="s4">&quot;:&quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">len(hour) != </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(minute) != </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(second) != </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">try</span><span class="s1">:</span>
		<span class="s1">hour = int(hour)</span>
		<span class="s1">minute = int(minute)</span>
		<span class="s1">second = int(second)</span>
	<span class="s2">except </span><span class="s1">ValueError:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">hour &lt; </span><span class="s5">0 </span><span class="s2">or </span><span class="s1">hour &gt; </span><span class="s5">23</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">minute &lt; </span><span class="s5">0 </span><span class="s2">or </span><span class="s1">minute &gt; </span><span class="s5">59</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">second &lt; </span><span class="s5">0 </span><span class="s2">or </span><span class="s1">second &gt; </span><span class="s5">59</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s3"># fallback</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoOpenTypeNameRecordsValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">list):</span>
		<span class="s2">return False</span>
	<span class="s1">dictPrototype = dict(nameID=(int</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">platformID=(int</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">encodingID=(int</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">languageID=(int</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">string=(str</span><span class="s2">, True</span><span class="s1">))</span>
	<span class="s2">for </span><span class="s1">nameRecord </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s2">if not </span><span class="s1">genericDictValidator(nameRecord</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoOpenTypeOS2WeightClassValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">int):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">value &lt; </span><span class="s5">0</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoOpenTypeOS2WidthClassValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">int):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">value &lt; </span><span class="s5">1</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">value &gt; </span><span class="s5">9</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoVersion2OpenTypeOS2PanoseValidator(values):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(values</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(values) != </span><span class="s5">10</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">value </span><span class="s2">in </span><span class="s1">values:</span>
		<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">int):</span>
			<span class="s2">return False</span>
	<span class="s3"># XXX further validation?</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoVersion3OpenTypeOS2PanoseValidator(values):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(values</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(values) != </span><span class="s5">10</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">value </span><span class="s2">in </span><span class="s1">values:</span>
		<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">int):</span>
			<span class="s2">return False</span>
		<span class="s2">if </span><span class="s1">value &lt; </span><span class="s5">0</span><span class="s1">:</span>
			<span class="s2">return False</span>
	<span class="s3"># XXX further validation?</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoOpenTypeOS2FamilyClassValidator(values):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(values</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(values) != </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">value </span><span class="s2">in </span><span class="s1">values:</span>
		<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">int):</span>
			<span class="s2">return False</span>
	<span class="s1">classID</span><span class="s2">, </span><span class="s1">subclassID = values</span>
	<span class="s2">if </span><span class="s1">classID &lt; </span><span class="s5">0 </span><span class="s2">or </span><span class="s1">classID &gt; </span><span class="s5">14</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">subclassID &lt; </span><span class="s5">0 </span><span class="s2">or </span><span class="s1">subclassID &gt; </span><span class="s5">15</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoPostscriptBluesValidator(values):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(values</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(values) &gt; </span><span class="s5">14</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(values) % </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">value </span><span class="s2">in </span><span class="s1">values:</span>
		<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">numberTypes):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoPostscriptOtherBluesValidator(values):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(values</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(values) &gt; </span><span class="s5">10</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(values) % </span><span class="s5">2</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">value </span><span class="s2">in </span><span class="s1">values:</span>
		<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">numberTypes):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoPostscriptStemsValidator(values):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(values</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(values) &gt; </span><span class="s5">12</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">value </span><span class="s2">in </span><span class="s1">values:</span>
		<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">numberTypes):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoPostscriptWindowsCharacterSetValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 2+. 
    &quot;&quot;&quot;</span>
	<span class="s1">validValues = list(range(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">21</span><span class="s1">))</span>
	<span class="s2">if </span><span class="s1">value </span><span class="s2">not in </span><span class="s1">validValues:</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataUniqueIDValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = dict(id=(str</span><span class="s2">, True</span><span class="s1">))</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataVendorValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = {</span><span class="s4">&quot;name&quot; </span><span class="s1">: (str</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;url&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;dir&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;class&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)}</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s4">&quot;dir&quot; </span><span class="s2">in </span><span class="s1">value </span><span class="s2">and </span><span class="s1">value.get(</span><span class="s4">&quot;dir&quot;</span><span class="s1">) </span><span class="s2">not in </span><span class="s1">(</span><span class="s4">&quot;ltr&quot;</span><span class="s2">, </span><span class="s4">&quot;rtl&quot;</span><span class="s1">):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataCreditsValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = dict(credits=(list</span><span class="s2">, True</span><span class="s1">))</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">if not </span><span class="s1">len(value[</span><span class="s4">&quot;credits&quot;</span><span class="s1">]):</span>
		<span class="s2">return False</span>
	<span class="s1">dictPrototype = {</span><span class="s4">&quot;name&quot; </span><span class="s1">: (str</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;url&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;role&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;dir&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;class&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)}</span>
	<span class="s2">for </span><span class="s1">credit </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;credits&quot;</span><span class="s1">]:</span>
		<span class="s2">if not </span><span class="s1">genericDictValidator(credit</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
			<span class="s2">return False</span>
		<span class="s2">if </span><span class="s4">&quot;dir&quot; </span><span class="s2">in </span><span class="s1">credit </span><span class="s2">and </span><span class="s1">credit.get(</span><span class="s4">&quot;dir&quot;</span><span class="s1">) </span><span class="s2">not in </span><span class="s1">(</span><span class="s4">&quot;ltr&quot;</span><span class="s2">, </span><span class="s4">&quot;rtl&quot;</span><span class="s1">):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataDescriptionValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = dict(url=(str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">text=(list</span><span class="s2">, True</span><span class="s1">))</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">text </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;text&quot;</span><span class="s1">]:</span>
		<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataTextValue(text):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataLicenseValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = dict(url=(str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">text=(list</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">id=(str</span><span class="s2">, False</span><span class="s1">))</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s4">&quot;text&quot; </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s2">for </span><span class="s1">text </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;text&quot;</span><span class="s1">]:</span>
			<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataTextValue(text):</span>
				<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataTrademarkValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = dict(text=(list</span><span class="s2">, True</span><span class="s1">))</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">text </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;text&quot;</span><span class="s1">]:</span>
		<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataTextValue(text):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataCopyrightValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = dict(text=(list</span><span class="s2">, True</span><span class="s1">))</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">text </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;text&quot;</span><span class="s1">]:</span>
		<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataTextValue(text):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataLicenseeValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = {</span><span class="s4">&quot;name&quot; </span><span class="s1">: (str</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;dir&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;class&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)}</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s4">&quot;dir&quot; </span><span class="s2">in </span><span class="s1">value </span><span class="s2">and </span><span class="s1">value.get(</span><span class="s4">&quot;dir&quot;</span><span class="s1">) </span><span class="s2">not in </span><span class="s1">(</span><span class="s4">&quot;ltr&quot;</span><span class="s2">, </span><span class="s4">&quot;rtl&quot;</span><span class="s1">):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataTextValue(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = {</span><span class="s4">&quot;text&quot; </span><span class="s1">: (str</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;language&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;dir&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;class&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)}</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s4">&quot;dir&quot; </span><span class="s2">in </span><span class="s1">value </span><span class="s2">and </span><span class="s1">value.get(</span><span class="s4">&quot;dir&quot;</span><span class="s1">) </span><span class="s2">not in </span><span class="s1">(</span><span class="s4">&quot;ltr&quot;</span><span class="s2">, </span><span class="s4">&quot;rtl&quot;</span><span class="s1">):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataExtensionsValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">list):</span>
		<span class="s2">return False</span>
	<span class="s2">if not </span><span class="s1">value:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">extension </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataExtensionValidator(extension):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataExtensionValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = dict(names=(list</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">items=(list</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">id=(str</span><span class="s2">, False</span><span class="s1">))</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s4">&quot;names&quot; </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;names&quot;</span><span class="s1">]:</span>
			<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataExtensionNameValidator(name):</span>
				<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">item </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;items&quot;</span><span class="s1">]:</span>
		<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataExtensionItemValidator(item):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataExtensionItemValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = dict(id=(str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">names=(list</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s1">values=(list</span><span class="s2">, True</span><span class="s1">))</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;names&quot;</span><span class="s1">]:</span>
		<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataExtensionNameValidator(name):</span>
			<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">val </span><span class="s2">in </span><span class="s1">value[</span><span class="s4">&quot;values&quot;</span><span class="s1">]:</span>
		<span class="s2">if not </span><span class="s1">fontInfoWOFFMetadataExtensionValueValidator(val):</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataExtensionNameValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = {</span><span class="s4">&quot;text&quot; </span><span class="s1">: (str</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;language&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;dir&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;class&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)}</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s4">&quot;dir&quot; </span><span class="s2">in </span><span class="s1">value </span><span class="s2">and </span><span class="s1">value.get(</span><span class="s4">&quot;dir&quot;</span><span class="s1">) </span><span class="s2">not in </span><span class="s1">(</span><span class="s4">&quot;ltr&quot;</span><span class="s2">, </span><span class="s4">&quot;rtl&quot;</span><span class="s1">):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">fontInfoWOFFMetadataExtensionValueValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s1">dictPrototype = {</span><span class="s4">&quot;text&quot; </span><span class="s1">: (str</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;language&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;dir&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s4">&quot;class&quot; </span><span class="s1">: (str</span><span class="s2">, False</span><span class="s1">)}</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">dictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s4">&quot;dir&quot; </span><span class="s2">in </span><span class="s1">value </span><span class="s2">and </span><span class="s1">value.get(</span><span class="s4">&quot;dir&quot;</span><span class="s1">) </span><span class="s2">not in </span><span class="s1">(</span><span class="s4">&quot;ltr&quot;</span><span class="s2">, </span><span class="s4">&quot;rtl&quot;</span><span class="s1">):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s3"># ----------</span>
<span class="s3"># Guidelines</span>
<span class="s3"># ----------</span>

<span class="s2">def </span><span class="s1">guidelinesValidator(value</span><span class="s2">, </span><span class="s1">identifiers=</span><span class="s2">None</span><span class="s1">):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">list):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">identifiers </span><span class="s2">is None</span><span class="s1">:</span>
		<span class="s1">identifiers = set()</span>
	<span class="s2">for </span><span class="s1">guide </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s2">if not </span><span class="s1">guidelineValidator(guide):</span>
			<span class="s2">return False</span>
		<span class="s1">identifier = guide.get(</span><span class="s4">&quot;identifier&quot;</span><span class="s1">)</span>
		<span class="s2">if </span><span class="s1">identifier </span><span class="s2">is not None</span><span class="s1">:</span>
			<span class="s2">if </span><span class="s1">identifier </span><span class="s2">in </span><span class="s1">identifiers:</span>
				<span class="s2">return False</span>
			<span class="s1">identifiers.add(identifier)</span>
	<span class="s2">return True</span>

<span class="s1">_guidelineDictPrototype = dict(</span>
	<span class="s1">x=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">y=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">angle=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
	<span class="s1">name=(str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=(str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">identifier=(str</span><span class="s2">, False</span><span class="s1">)</span>
<span class="s1">)</span>

<span class="s2">def </span><span class="s1">guidelineValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">_guidelineDictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s1">x = value.get(</span><span class="s4">&quot;x&quot;</span><span class="s1">)</span>
	<span class="s1">y = value.get(</span><span class="s4">&quot;y&quot;</span><span class="s1">)</span>
	<span class="s1">angle = value.get(</span><span class="s4">&quot;angle&quot;</span><span class="s1">)</span>
	<span class="s3"># x or y must be present</span>
	<span class="s2">if </span><span class="s1">x </span><span class="s2">is None and </span><span class="s1">y </span><span class="s2">is None</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s3"># if x or y are None, angle must not be present</span>
	<span class="s2">if </span><span class="s1">x </span><span class="s2">is None or </span><span class="s1">y </span><span class="s2">is None</span><span class="s1">:</span>
		<span class="s2">if </span><span class="s1">angle </span><span class="s2">is not None</span><span class="s1">:</span>
			<span class="s2">return False</span>
	<span class="s3"># if x and y are defined, angle must be defined</span>
	<span class="s2">if </span><span class="s1">x </span><span class="s2">is not None and </span><span class="s1">y </span><span class="s2">is not None and </span><span class="s1">angle </span><span class="s2">is None</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s3"># angle must be between 0 and 360</span>
	<span class="s2">if </span><span class="s1">angle </span><span class="s2">is not None</span><span class="s1">:</span>
		<span class="s2">if </span><span class="s1">angle &lt; </span><span class="s5">0</span><span class="s1">:</span>
			<span class="s2">return False</span>
		<span class="s2">if </span><span class="s1">angle &gt; </span><span class="s5">360</span><span class="s1">:</span>
			<span class="s2">return False</span>
	<span class="s3"># identifier must be 1 or more characters</span>
	<span class="s1">identifier = value.get(</span><span class="s4">&quot;identifier&quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">identifier </span><span class="s2">is not None and not </span><span class="s1">identifierValidator(identifier):</span>
		<span class="s2">return False</span>
	<span class="s3"># color must follow the proper format</span>
	<span class="s1">color = value.get(</span><span class="s4">&quot;color&quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">color </span><span class="s2">is not None and not </span><span class="s1">colorValidator(color):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s3"># -------</span>
<span class="s3"># Anchors</span>
<span class="s3"># -------</span>

<span class="s2">def </span><span class="s1">anchorsValidator(value</span><span class="s2">, </span><span class="s1">identifiers=</span><span class="s2">None</span><span class="s1">):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">list):</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">identifiers </span><span class="s2">is None</span><span class="s1">:</span>
		<span class="s1">identifiers = set()</span>
	<span class="s2">for </span><span class="s1">anchor </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s2">if not </span><span class="s1">anchorValidator(anchor):</span>
			<span class="s2">return False</span>
		<span class="s1">identifier = anchor.get(</span><span class="s4">&quot;identifier&quot;</span><span class="s1">)</span>
		<span class="s2">if </span><span class="s1">identifier </span><span class="s2">is not None</span><span class="s1">:</span>
			<span class="s2">if </span><span class="s1">identifier </span><span class="s2">in </span><span class="s1">identifiers:</span>
				<span class="s2">return False</span>
			<span class="s1">identifiers.add(identifier)</span>
	<span class="s2">return True</span>

<span class="s1">_anchorDictPrototype = dict(</span>
	<span class="s1">x=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">y=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
	<span class="s1">name=(str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=(str</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
	<span class="s1">identifier=(str</span><span class="s2">, False</span><span class="s1">)</span>
<span class="s1">)</span>

<span class="s2">def </span><span class="s1">anchorValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">_anchorDictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s1">x = value.get(</span><span class="s4">&quot;x&quot;</span><span class="s1">)</span>
	<span class="s1">y = value.get(</span><span class="s4">&quot;y&quot;</span><span class="s1">)</span>
	<span class="s3"># x and y must be present</span>
	<span class="s2">if </span><span class="s1">x </span><span class="s2">is None or </span><span class="s1">y </span><span class="s2">is None</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s3"># identifier must be 1 or more characters</span>
	<span class="s1">identifier = value.get(</span><span class="s4">&quot;identifier&quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">identifier </span><span class="s2">is not None and not </span><span class="s1">identifierValidator(identifier):</span>
		<span class="s2">return False</span>
	<span class="s3"># color must follow the proper format</span>
	<span class="s1">color = value.get(</span><span class="s4">&quot;color&quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">color </span><span class="s2">is not None and not </span><span class="s1">colorValidator(color):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s3"># ----------</span>
<span class="s3"># Identifier</span>
<span class="s3"># ----------</span>

<span class="s2">def </span><span class="s1">identifierValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
 
    &gt;&gt;&gt; identifierValidator(&quot;a&quot;) 
    True 
    &gt;&gt;&gt; identifierValidator(&quot;&quot;) 
    False 
    &gt;&gt;&gt; identifierValidator(&quot;a&quot; * 101) 
    False 
    &quot;&quot;&quot;</span>
	<span class="s1">validCharactersMin = </span><span class="s5">0x20</span>
	<span class="s1">validCharactersMax = </span><span class="s5">0x7E</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">str):</span>
		<span class="s2">return False</span>
	<span class="s2">if not </span><span class="s1">value:</span>
		<span class="s2">return False</span>
	<span class="s2">if </span><span class="s1">len(value) &gt; </span><span class="s5">100</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s1">c = ord(c)</span>
		<span class="s2">if </span><span class="s1">c &lt; validCharactersMin </span><span class="s2">or </span><span class="s1">c &gt; validCharactersMax:</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s3"># -----</span>
<span class="s3"># Color</span>
<span class="s3"># -----</span>

<span class="s2">def </span><span class="s1">colorValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
 
    &gt;&gt;&gt; colorValidator(&quot;0,0,0,0&quot;) 
    True 
    &gt;&gt;&gt; colorValidator(&quot;.5,.5,.5,.5&quot;) 
    True 
    &gt;&gt;&gt; colorValidator(&quot;0.5,0.5,0.5,0.5&quot;) 
    True 
    &gt;&gt;&gt; colorValidator(&quot;1,1,1,1&quot;) 
    True 
 
    &gt;&gt;&gt; colorValidator(&quot;2,0,0,0&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;0,2,0,0&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;0,0,2,0&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;0,0,0,2&quot;) 
    False 
 
    &gt;&gt;&gt; colorValidator(&quot;1r,1,1,1&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;1,1g,1,1&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;1,1,1b,1&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;1,1,1,1a&quot;) 
    False 
 
    &gt;&gt;&gt; colorValidator(&quot;1 1 1 1&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;1 1,1,1&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;1,1 1,1&quot;) 
    False 
    &gt;&gt;&gt; colorValidator(&quot;1,1,1 1&quot;) 
    False 
 
    &gt;&gt;&gt; colorValidator(&quot;1, 1, 1, 1&quot;) 
    True 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">str):</span>
		<span class="s2">return False</span>
	<span class="s1">parts = value.split(</span><span class="s4">&quot;,&quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">len(parts) != </span><span class="s5">4</span><span class="s1">:</span>
		<span class="s2">return False</span>
	<span class="s2">for </span><span class="s1">part </span><span class="s2">in </span><span class="s1">parts:</span>
		<span class="s1">part = part.strip()</span>
		<span class="s1">converted = </span><span class="s2">False</span>
		<span class="s2">try</span><span class="s1">:</span>
			<span class="s1">part = int(part)</span>
			<span class="s1">converted = </span><span class="s2">True</span>
		<span class="s2">except </span><span class="s1">ValueError:</span>
			<span class="s2">pass</span>
		<span class="s2">if not </span><span class="s1">converted:</span>
			<span class="s2">try</span><span class="s1">:</span>
				<span class="s1">part = float(part)</span>
				<span class="s1">converted = </span><span class="s2">True</span>
			<span class="s2">except </span><span class="s1">ValueError:</span>
				<span class="s2">pass</span>
		<span class="s2">if not </span><span class="s1">converted:</span>
			<span class="s2">return False</span>
		<span class="s2">if </span><span class="s1">part &lt; </span><span class="s5">0</span><span class="s1">:</span>
			<span class="s2">return False</span>
		<span class="s2">if </span><span class="s1">part &gt; </span><span class="s5">1</span><span class="s1">:</span>
			<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s3"># -----</span>
<span class="s3"># image</span>
<span class="s3"># -----</span>

<span class="s1">pngSignature = </span><span class="s6">b&quot;</span><span class="s2">\x89</span><span class="s6">PNG</span><span class="s2">\r\n\x1a\n</span><span class="s6">&quot;</span>

<span class="s1">_imageDictPrototype = dict(</span>
	<span class="s1">fileName=(str</span><span class="s2">, True</span><span class="s1">)</span><span class="s2">,</span>
	<span class="s1">xScale=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">xyScale=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
	<span class="s1">yxScale=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">yScale=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
	<span class="s1">xOffset=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">, </span><span class="s1">yOffset=((int</span><span class="s2">, </span><span class="s1">float)</span><span class="s2">, False</span><span class="s1">)</span><span class="s2">,</span>
	<span class="s1">color=(str</span><span class="s2">, False</span><span class="s1">)</span>
<span class="s1">)</span>

<span class="s2">def </span><span class="s1">imageValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">genericDictValidator(value</span><span class="s2">, </span><span class="s1">_imageDictPrototype):</span>
		<span class="s2">return False</span>
	<span class="s3"># fileName must be one or more characters</span>
	<span class="s2">if not </span><span class="s1">value[</span><span class="s4">&quot;fileName&quot;</span><span class="s1">]:</span>
		<span class="s2">return False</span>
	<span class="s3"># color must follow the proper format</span>
	<span class="s1">color = value.get(</span><span class="s4">&quot;color&quot;</span><span class="s1">)</span>
	<span class="s2">if </span><span class="s1">color </span><span class="s2">is not None and not </span><span class="s1">colorValidator(color):</span>
		<span class="s2">return False</span>
	<span class="s2">return True</span>

<span class="s2">def </span><span class="s1">pngValidator(path=</span><span class="s2">None, </span><span class="s1">data=</span><span class="s2">None, </span><span class="s1">fileObj=</span><span class="s2">None</span><span class="s1">):</span>
	<span class="s0">&quot;&quot;&quot; 
    Version 3+. 
 
    This checks the signature of the image data. 
    &quot;&quot;&quot;</span>
	<span class="s2">assert </span><span class="s1">path </span><span class="s2">is not None or </span><span class="s1">data </span><span class="s2">is not None or </span><span class="s1">fileObj </span><span class="s2">is not None</span>
	<span class="s2">if </span><span class="s1">path </span><span class="s2">is not None</span><span class="s1">:</span>
		<span class="s2">with </span><span class="s1">open(path</span><span class="s2">, </span><span class="s4">&quot;rb&quot;</span><span class="s1">) </span><span class="s2">as </span><span class="s1">f:</span>
			<span class="s1">signature = f.read(</span><span class="s5">8</span><span class="s1">)</span>
	<span class="s2">elif </span><span class="s1">data </span><span class="s2">is not None</span><span class="s1">:</span>
		<span class="s1">signature = data[:</span><span class="s5">8</span><span class="s1">]</span>
	<span class="s2">elif </span><span class="s1">fileObj </span><span class="s2">is not None</span><span class="s1">:</span>
		<span class="s1">pos = fileObj.tell()</span>
		<span class="s1">signature = fileObj.read(</span><span class="s5">8</span><span class="s1">)</span>
		<span class="s1">fileObj.seek(pos)</span>
	<span class="s2">if </span><span class="s1">signature != pngSignature:</span>
		<span class="s2">return False, </span><span class="s4">&quot;Image does not begin with the PNG signature.&quot;</span>
	<span class="s2">return True, None</span>

<span class="s3"># -------------------</span>
<span class="s3"># layercontents.plist</span>
<span class="s3"># -------------------</span>

<span class="s2">def </span><span class="s1">layerContentsValidator(value</span><span class="s2">, </span><span class="s1">ufoPathOrFileSystem):</span>
	<span class="s0">&quot;&quot;&quot; 
    Check the validity of layercontents.plist. 
    Version 3+. 
    &quot;&quot;&quot;</span>
	<span class="s2">if </span><span class="s1">isinstance(ufoPathOrFileSystem</span><span class="s2">, </span><span class="s1">fs.base.FS):</span>
		<span class="s1">fileSystem = ufoPathOrFileSystem</span>
	<span class="s2">else</span><span class="s1">:</span>
		<span class="s1">fileSystem = fs.osfs.OSFS(ufoPathOrFileSystem)</span>

	<span class="s1">bogusFileMessage = </span><span class="s4">&quot;layercontents.plist in not in the correct format.&quot;</span>
	<span class="s3"># file isn't in the right format</span>
	<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">list):</span>
		<span class="s2">return False, </span><span class="s1">bogusFileMessage</span>
	<span class="s3"># work through each entry</span>
	<span class="s1">usedLayerNames = set()</span>
	<span class="s1">usedDirectories = set()</span>
	<span class="s1">contents = {}</span>
	<span class="s2">for </span><span class="s1">entry </span><span class="s2">in </span><span class="s1">value:</span>
		<span class="s3"># layer entry in the incorrect format</span>
		<span class="s2">if not </span><span class="s1">isinstance(entry</span><span class="s2">, </span><span class="s1">list):</span>
			<span class="s2">return False, </span><span class="s1">bogusFileMessage</span>
		<span class="s2">if not </span><span class="s1">len(entry) == </span><span class="s5">2</span><span class="s1">:</span>
			<span class="s2">return False, </span><span class="s1">bogusFileMessage</span>
		<span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">entry:</span>
			<span class="s2">if not </span><span class="s1">isinstance(i</span><span class="s2">, </span><span class="s1">str):</span>
				<span class="s2">return False, </span><span class="s1">bogusFileMessage</span>
		<span class="s1">layerName</span><span class="s2">, </span><span class="s1">directoryName = entry</span>
		<span class="s3"># check directory naming</span>
		<span class="s2">if </span><span class="s1">directoryName != </span><span class="s4">&quot;glyphs&quot;</span><span class="s1">:</span>
			<span class="s2">if not </span><span class="s1">directoryName.startswith(</span><span class="s4">&quot;glyphs.&quot;</span><span class="s1">):</span>
				<span class="s2">return False, </span><span class="s4">&quot;Invalid directory name (%s) in layercontents.plist.&quot; </span><span class="s1">% directoryName</span>
		<span class="s2">if </span><span class="s1">len(layerName) == </span><span class="s5">0</span><span class="s1">:</span>
			<span class="s2">return False, </span><span class="s4">&quot;Empty layer name in layercontents.plist.&quot;</span>
		<span class="s3"># directory doesn't exist</span>
		<span class="s2">if not </span><span class="s1">fileSystem.exists(directoryName):</span>
			<span class="s2">return False, </span><span class="s4">&quot;A glyphset does not exist at %s.&quot; </span><span class="s1">% directoryName</span>
		<span class="s3"># default layer name</span>
		<span class="s2">if </span><span class="s1">layerName == </span><span class="s4">&quot;public.default&quot; </span><span class="s2">and </span><span class="s1">directoryName != </span><span class="s4">&quot;glyphs&quot;</span><span class="s1">:</span>
			<span class="s2">return False, </span><span class="s4">&quot;The name public.default is being used by a layer that is not the default.&quot;</span>
		<span class="s3"># check usage</span>
		<span class="s2">if </span><span class="s1">layerName </span><span class="s2">in </span><span class="s1">usedLayerNames:</span>
			<span class="s2">return False, </span><span class="s4">&quot;The layer name %s is used by more than one layer.&quot; </span><span class="s1">% layerName</span>
		<span class="s1">usedLayerNames.add(layerName)</span>
		<span class="s2">if </span><span class="s1">directoryName </span><span class="s2">in </span><span class="s1">usedDirectories:</span>
			<span class="s2">return False, </span><span class="s4">&quot;The directory %s is used by more than one layer.&quot; </span><span class="s1">% directoryName</span>
		<span class="s1">usedDirectories.add(directoryName)</span>
		<span class="s3"># store</span>
		<span class="s1">contents[layerName] = directoryName</span>
	<span class="s3"># missing default layer</span>
	<span class="s1">foundDefault = </span><span class="s4">&quot;glyphs&quot; </span><span class="s2">in </span><span class="s1">contents.values()</span>
	<span class="s2">if not </span><span class="s1">foundDefault:</span>
		<span class="s2">return False, </span><span class="s4">&quot;The required default glyph set is not in the UFO.&quot;</span>
	<span class="s2">return True, None</span>

<span class="s3"># ------------</span>
<span class="s3"># groups.plist</span>
<span class="s3"># ------------</span>

<span class="s2">def </span><span class="s1">groupsValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Check the validity of the groups. 
    Version 3+ (though it's backwards compatible with UFO 1 and UFO 2). 
 
    &gt;&gt;&gt; groups = {&quot;A&quot; : [&quot;A&quot;, &quot;A&quot;], &quot;A2&quot; : [&quot;A&quot;]} 
    &gt;&gt;&gt; groupsValidator(groups) 
    (True, None) 
 
    &gt;&gt;&gt; groups = {&quot;&quot; : [&quot;A&quot;]} 
    &gt;&gt;&gt; valid, msg = groupsValidator(groups) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg) 
    A group has an empty name. 
 
    &gt;&gt;&gt; groups = {&quot;public.awesome&quot; : [&quot;A&quot;]} 
    &gt;&gt;&gt; groupsValidator(groups) 
    (True, None) 
 
    &gt;&gt;&gt; groups = {&quot;public.kern1.&quot; : [&quot;A&quot;]} 
    &gt;&gt;&gt; valid, msg = groupsValidator(groups) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg) 
    The group data contains a kerning group with an incomplete name. 
    &gt;&gt;&gt; groups = {&quot;public.kern2.&quot; : [&quot;A&quot;]} 
    &gt;&gt;&gt; valid, msg = groupsValidator(groups) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg) 
    The group data contains a kerning group with an incomplete name. 
 
    &gt;&gt;&gt; groups = {&quot;public.kern1.A&quot; : [&quot;A&quot;], &quot;public.kern2.A&quot; : [&quot;A&quot;]} 
    &gt;&gt;&gt; groupsValidator(groups) 
    (True, None) 
 
    &gt;&gt;&gt; groups = {&quot;public.kern1.A1&quot; : [&quot;A&quot;], &quot;public.kern1.A2&quot; : [&quot;A&quot;]} 
    &gt;&gt;&gt; valid, msg = groupsValidator(groups) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg) 
    The glyph &quot;A&quot; occurs in too many kerning groups. 
    &quot;&quot;&quot;</span>
	<span class="s1">bogusFormatMessage = </span><span class="s4">&quot;The group data is not in the correct format.&quot;</span>
	<span class="s2">if not </span><span class="s1">isDictEnough(value):</span>
		<span class="s2">return False, </span><span class="s1">bogusFormatMessage</span>
	<span class="s1">firstSideMapping = {}</span>
	<span class="s1">secondSideMapping = {}</span>
	<span class="s2">for </span><span class="s1">groupName</span><span class="s2">, </span><span class="s1">glyphList </span><span class="s2">in </span><span class="s1">value.items():</span>
		<span class="s2">if not </span><span class="s1">isinstance(groupName</span><span class="s2">, </span><span class="s1">(str)):</span>
			<span class="s2">return False, </span><span class="s1">bogusFormatMessage</span>
		<span class="s2">if not </span><span class="s1">isinstance(glyphList</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
			<span class="s2">return False, </span><span class="s1">bogusFormatMessage</span>
		<span class="s2">if not </span><span class="s1">groupName:</span>
			<span class="s2">return False, </span><span class="s4">&quot;A group has an empty name.&quot;</span>
		<span class="s2">if </span><span class="s1">groupName.startswith(</span><span class="s4">&quot;public.&quot;</span><span class="s1">):</span>
			<span class="s2">if not </span><span class="s1">groupName.startswith(</span><span class="s4">&quot;public.kern1.&quot;</span><span class="s1">) </span><span class="s2">and not </span><span class="s1">groupName.startswith(</span><span class="s4">&quot;public.kern2.&quot;</span><span class="s1">):</span>
				<span class="s3"># unknown public.* name. silently skip.</span>
				<span class="s2">continue</span>
			<span class="s2">else</span><span class="s1">:</span>
				<span class="s2">if </span><span class="s1">len(</span><span class="s4">&quot;public.kernN.&quot;</span><span class="s1">) == len(groupName):</span>
					<span class="s2">return False, </span><span class="s4">&quot;The group data contains a kerning group with an incomplete name.&quot;</span>
			<span class="s2">if </span><span class="s1">groupName.startswith(</span><span class="s4">&quot;public.kern1.&quot;</span><span class="s1">):</span>
				<span class="s1">d = firstSideMapping</span>
			<span class="s2">else</span><span class="s1">:</span>
				<span class="s1">d = secondSideMapping</span>
			<span class="s2">for </span><span class="s1">glyphName </span><span class="s2">in </span><span class="s1">glyphList:</span>
				<span class="s2">if not </span><span class="s1">isinstance(glyphName</span><span class="s2">, </span><span class="s1">str):</span>
					<span class="s2">return False, </span><span class="s4">&quot;The group data %s contains an invalid member.&quot; </span><span class="s1">% groupName</span>
				<span class="s2">if </span><span class="s1">glyphName </span><span class="s2">in </span><span class="s1">d:</span>
					<span class="s2">return False, </span><span class="s4">&quot;The glyph </span><span class="s2">\&quot;</span><span class="s4">%s</span><span class="s2">\&quot; </span><span class="s4">occurs in too many kerning groups.&quot; </span><span class="s1">% glyphName</span>
				<span class="s1">d[glyphName] = groupName</span>
	<span class="s2">return True, None</span>

<span class="s3"># -------------</span>
<span class="s3"># kerning.plist</span>
<span class="s3"># -------------</span>

<span class="s2">def </span><span class="s1">kerningValidator(data):</span>
	<span class="s0">&quot;&quot;&quot; 
    Check the validity of the kerning data structure. 
    Version 3+ (though it's backwards compatible with UFO 1 and UFO 2). 
 
    &gt;&gt;&gt; kerning = {&quot;A&quot; : {&quot;B&quot; : 100}} 
    &gt;&gt;&gt; kerningValidator(kerning) 
    (True, None) 
 
    &gt;&gt;&gt; kerning = {&quot;A&quot; : [&quot;B&quot;]} 
    &gt;&gt;&gt; valid, msg = kerningValidator(kerning) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg) 
    The kerning data is not in the correct format. 
 
    &gt;&gt;&gt; kerning = {&quot;A&quot; : {&quot;B&quot; : &quot;100&quot;}} 
    &gt;&gt;&gt; valid, msg = kerningValidator(kerning) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg) 
    The kerning data is not in the correct format. 
    &quot;&quot;&quot;</span>
	<span class="s1">bogusFormatMessage = </span><span class="s4">&quot;The kerning data is not in the correct format.&quot;</span>
	<span class="s2">if not </span><span class="s1">isinstance(data</span><span class="s2">, </span><span class="s1">Mapping):</span>
		<span class="s2">return False, </span><span class="s1">bogusFormatMessage</span>
	<span class="s2">for </span><span class="s1">first</span><span class="s2">, </span><span class="s1">secondDict </span><span class="s2">in </span><span class="s1">data.items():</span>
		<span class="s2">if not </span><span class="s1">isinstance(first</span><span class="s2">, </span><span class="s1">str):</span>
			<span class="s2">return False, </span><span class="s1">bogusFormatMessage</span>
		<span class="s2">elif not </span><span class="s1">isinstance(secondDict</span><span class="s2">, </span><span class="s1">Mapping):</span>
			<span class="s2">return False, </span><span class="s1">bogusFormatMessage</span>
		<span class="s2">for </span><span class="s1">second</span><span class="s2">, </span><span class="s1">value </span><span class="s2">in </span><span class="s1">secondDict.items():</span>
			<span class="s2">if not </span><span class="s1">isinstance(second</span><span class="s2">, </span><span class="s1">str):</span>
				<span class="s2">return False, </span><span class="s1">bogusFormatMessage</span>
			<span class="s2">elif not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">numberTypes):</span>
				<span class="s2">return False, </span><span class="s1">bogusFormatMessage</span>
	<span class="s2">return True, None</span>

<span class="s3"># -------------</span>
<span class="s3"># lib.plist/lib</span>
<span class="s3"># -------------</span>

<span class="s1">_bogusLibFormatMessage = </span><span class="s4">&quot;The lib data is not in the correct format: %s&quot;</span>

<span class="s2">def </span><span class="s1">fontLibValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Check the validity of the lib. 
    Version 3+ (though it's backwards compatible with UFO 1 and UFO 2). 
 
    &gt;&gt;&gt; lib = {&quot;foo&quot; : &quot;bar&quot;} 
    &gt;&gt;&gt; fontLibValidator(lib) 
    (True, None) 
 
    &gt;&gt;&gt; lib = {&quot;public.awesome&quot; : &quot;hello&quot;} 
    &gt;&gt;&gt; fontLibValidator(lib) 
    (True, None) 
 
    &gt;&gt;&gt; lib = {&quot;public.glyphOrder&quot; : [&quot;A&quot;, &quot;C&quot;, &quot;B&quot;]} 
    &gt;&gt;&gt; fontLibValidator(lib) 
    (True, None) 
 
    &gt;&gt;&gt; lib = &quot;hello&quot; 
    &gt;&gt;&gt; valid, msg = fontLibValidator(lib) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg)  # doctest: +ELLIPSIS 
    The lib data is not in the correct format: expected a dictionary, ... 
 
    &gt;&gt;&gt; lib = {1: &quot;hello&quot;} 
    &gt;&gt;&gt; valid, msg = fontLibValidator(lib) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg) 
    The lib key is not properly formatted: expected str, found int: 1 
 
    &gt;&gt;&gt; lib = {&quot;public.glyphOrder&quot; : &quot;hello&quot;} 
    &gt;&gt;&gt; valid, msg = fontLibValidator(lib) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg)  # doctest: +ELLIPSIS 
    public.glyphOrder is not properly formatted: expected list or tuple,... 
 
    &gt;&gt;&gt; lib = {&quot;public.glyphOrder&quot; : [&quot;A&quot;, 1, &quot;B&quot;]} 
    &gt;&gt;&gt; valid, msg = fontLibValidator(lib) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg)  # doctest: +ELLIPSIS 
    public.glyphOrder is not properly formatted: expected str,... 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isDictEnough(value):</span>
		<span class="s1">reason = </span><span class="s4">&quot;expected a dictionary, found %s&quot; </span><span class="s1">% type(value).__name__</span>
		<span class="s2">return False, </span><span class="s1">_bogusLibFormatMessage % reason</span>
	<span class="s2">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s2">in </span><span class="s1">value.items():</span>
		<span class="s2">if not </span><span class="s1">isinstance(key</span><span class="s2">, </span><span class="s1">str):</span>
			<span class="s2">return False, </span><span class="s1">(</span>
				<span class="s4">&quot;The lib key is not properly formatted: expected str, found %s: %r&quot; </span><span class="s1">%</span>
				<span class="s1">(type(key).__name__</span><span class="s2">, </span><span class="s1">key))</span>
		<span class="s3"># public.glyphOrder</span>
		<span class="s2">if </span><span class="s1">key == </span><span class="s4">&quot;public.glyphOrder&quot;</span><span class="s1">:</span>
			<span class="s1">bogusGlyphOrderMessage = </span><span class="s4">&quot;public.glyphOrder is not properly formatted: %s&quot;</span>
			<span class="s2">if not </span><span class="s1">isinstance(value</span><span class="s2">, </span><span class="s1">(list</span><span class="s2">, </span><span class="s1">tuple)):</span>
				<span class="s1">reason = </span><span class="s4">&quot;expected list or tuple, found %s&quot; </span><span class="s1">% type(value).__name__</span>
				<span class="s2">return False, </span><span class="s1">bogusGlyphOrderMessage % reason</span>
			<span class="s2">for </span><span class="s1">glyphName </span><span class="s2">in </span><span class="s1">value:</span>
				<span class="s2">if not </span><span class="s1">isinstance(glyphName</span><span class="s2">, </span><span class="s1">str):</span>
					<span class="s1">reason = </span><span class="s4">&quot;expected str, found %s&quot; </span><span class="s1">% type(glyphName).__name__</span>
					<span class="s2">return False, </span><span class="s1">bogusGlyphOrderMessage % reason</span>
	<span class="s2">return True, None</span>

<span class="s3"># --------</span>
<span class="s3"># GLIF lib</span>
<span class="s3"># --------</span>

<span class="s2">def </span><span class="s1">glyphLibValidator(value):</span>
	<span class="s0">&quot;&quot;&quot; 
    Check the validity of the lib. 
    Version 3+ (though it's backwards compatible with UFO 1 and UFO 2). 
 
    &gt;&gt;&gt; lib = {&quot;foo&quot; : &quot;bar&quot;} 
    &gt;&gt;&gt; glyphLibValidator(lib) 
    (True, None) 
 
    &gt;&gt;&gt; lib = {&quot;public.awesome&quot; : &quot;hello&quot;} 
    &gt;&gt;&gt; glyphLibValidator(lib) 
    (True, None) 
 
    &gt;&gt;&gt; lib = {&quot;public.markColor&quot; : &quot;1,0,0,0.5&quot;} 
    &gt;&gt;&gt; glyphLibValidator(lib) 
    (True, None) 
 
    &gt;&gt;&gt; lib = {&quot;public.markColor&quot; : 1} 
    &gt;&gt;&gt; valid, msg = glyphLibValidator(lib) 
    &gt;&gt;&gt; valid 
    False 
    &gt;&gt;&gt; print(msg) 
    public.markColor is not properly formatted. 
    &quot;&quot;&quot;</span>
	<span class="s2">if not </span><span class="s1">isDictEnough(value):</span>
		<span class="s1">reason = </span><span class="s4">&quot;expected a dictionary, found %s&quot; </span><span class="s1">% type(value).__name__</span>
		<span class="s2">return False, </span><span class="s1">_bogusLibFormatMessage % reason</span>
	<span class="s2">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s2">in </span><span class="s1">value.items():</span>
		<span class="s2">if not </span><span class="s1">isinstance(key</span><span class="s2">, </span><span class="s1">str):</span>
			<span class="s1">reason = </span><span class="s4">&quot;key (%s) should be a string&quot; </span><span class="s1">% key</span>
			<span class="s2">return False, </span><span class="s1">_bogusLibFormatMessage % reason</span>
		<span class="s3"># public.markColor</span>
		<span class="s2">if </span><span class="s1">key == </span><span class="s4">&quot;public.markColor&quot;</span><span class="s1">:</span>
			<span class="s2">if not </span><span class="s1">colorValidator(value):</span>
				<span class="s2">return False, </span><span class="s4">&quot;public.markColor is not properly formatted.&quot;</span>
	<span class="s2">return True, None</span>


<span class="s2">if </span><span class="s1">__name__ == </span><span class="s4">&quot;__main__&quot;</span><span class="s1">:</span>
	<span class="s2">import </span><span class="s1">doctest</span>
	<span class="s1">doctest.testmod()</span>
</pre>
</body>
</html>