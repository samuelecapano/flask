<html>
<head>
<title>test_legend.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_legend.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">collections</span>
<span class="s0">import </span><span class="s1">platform</span>
<span class="s0">from </span><span class="s1">unittest </span><span class="s0">import </span><span class="s1">mock</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">assert_allclose</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s0">, </span><span class="s1">image_comparison</span>
<span class="s0">from </span><span class="s1">matplotlib.testing._markers </span><span class="s0">import </span><span class="s1">needs_usetex</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">import </span><span class="s1">matplotlib.patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">import </span><span class="s1">matplotlib.transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">import </span><span class="s1">matplotlib.collections </span><span class="s0">as </span><span class="s1">mcollections</span>
<span class="s0">import </span><span class="s1">matplotlib.lines </span><span class="s0">as </span><span class="s1">mlines</span>
<span class="s0">from </span><span class="s1">matplotlib.legend_handler </span><span class="s0">import </span><span class="s1">HandlerTuple</span>
<span class="s0">import </span><span class="s1">matplotlib.legend </span><span class="s0">as </span><span class="s1">mlegend</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">rc_context</span>
<span class="s0">from </span><span class="s1">matplotlib.font_manager </span><span class="s0">import </span><span class="s1">FontProperties</span>


<span class="s0">def </span><span class="s1">test_legend_ordereddict():</span>
    <span class="s2"># smoketest that ordereddict inputs work...</span>

    <span class="s1">X = np.random.randn(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">Y = np.random.randn(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">labels = [</span><span class="s4">'a'</span><span class="s1">] * </span><span class="s3">5 </span><span class="s1">+ [</span><span class="s4">'b'</span><span class="s1">] * </span><span class="s3">5</span>
    <span class="s1">colors = [</span><span class="s4">'r'</span><span class="s1">] * </span><span class="s3">5 </span><span class="s1">+ [</span><span class="s4">'g'</span><span class="s1">] * </span><span class="s3">5</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">label</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">labels</span><span class="s0">, </span><span class="s1">colors):</span>
        <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">label=label</span><span class="s0">, </span><span class="s1">c=color)</span>

    <span class="s1">handles</span><span class="s0">, </span><span class="s1">labels = ax.get_legend_handles_labels()</span>
    <span class="s1">legend = collections.OrderedDict(zip(labels</span><span class="s0">, </span><span class="s1">handles))</span>
    <span class="s1">ax.legend(legend.values()</span><span class="s0">, </span><span class="s1">legend.keys()</span><span class="s0">,</span>
              <span class="s1">loc=</span><span class="s4">'center left'</span><span class="s0">, </span><span class="s1">bbox_to_anchor=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s4">'legend_auto1'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_legend_auto1():</span>
    <span class="s5">&quot;&quot;&quot;Test automatic legend placement&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s3">50 </span><span class="s1">- x</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'y=1'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">x - </span><span class="s3">50</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'y=-1'</span><span class="s1">)</span>
    <span class="s1">ax.legend(loc=</span><span class="s4">'best'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'legend_auto2'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_legend_auto2():</span>
    <span class="s5">&quot;&quot;&quot;Test automatic legend placement&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">b1 = ax.bar(x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">align=</span><span class="s4">'edge'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'m'</span><span class="s1">)</span>
    <span class="s1">b2 = ax.bar(x</span><span class="s0">, </span><span class="s1">x[::-</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">align=</span><span class="s4">'edge'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.legend([b1[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">b2[</span><span class="s3">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'up'</span><span class="s0">, </span><span class="s4">'down'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'best'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'legend_auto3'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_legend_auto3():</span>
    <span class="s5">&quot;&quot;&quot;Test automatic legend placement&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = [</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s3">0.95</span><span class="s0">, </span><span class="s3">0.95</span><span class="s0">, </span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s4">'o-'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'line'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">)</span>
    <span class="s1">ax.legend(loc=</span><span class="s4">'best'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_legend_auto4():</span>
    <span class="s5">&quot;&quot;&quot; 
    Check that the legend location with automatic placement is the same, 
    whatever the histogram type is. Related to issue #9580. 
    &quot;&quot;&quot;</span>
    <span class="s2"># NB: barstacked is pointless with a single dataset.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(ncols=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">6.4</span><span class="s0">, </span><span class="s3">2.4</span><span class="s1">))</span>
    <span class="s1">leg_bboxes = []</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">ht </span><span class="s0">in </span><span class="s1">zip(axs.flat</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'bar'</span><span class="s0">, </span><span class="s4">'step'</span><span class="s0">, </span><span class="s4">'stepfilled'</span><span class="s1">)):</span>
        <span class="s1">ax.set_title(ht)</span>
        <span class="s2"># A high bar on the left but an even higher one on the right.</span>
        <span class="s1">ax.hist([</span><span class="s3">0</span><span class="s1">] + </span><span class="s3">5</span><span class="s1">*[</span><span class="s3">9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">bins=range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;Legend&quot;</span><span class="s0">, </span><span class="s1">histtype=ht)</span>
        <span class="s1">leg = ax.legend(loc=</span><span class="s4">&quot;best&quot;</span><span class="s1">)</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">leg_bboxes.append(</span>
            <span class="s1">leg.get_window_extent().transformed(ax.transAxes.inverted()))</span>

    <span class="s2"># The histogram type &quot;bar&quot; is assumed to be the correct reference.</span>
    <span class="s1">assert_allclose(leg_bboxes[</span><span class="s3">1</span><span class="s1">].bounds</span><span class="s0">, </span><span class="s1">leg_bboxes[</span><span class="s3">0</span><span class="s1">].bounds)</span>
    <span class="s1">assert_allclose(leg_bboxes[</span><span class="s3">2</span><span class="s1">].bounds</span><span class="s0">, </span><span class="s1">leg_bboxes[</span><span class="s3">0</span><span class="s1">].bounds)</span>


<span class="s0">def </span><span class="s1">test_legend_auto5():</span>
    <span class="s5">&quot;&quot;&quot; 
    Check that the automatic placement handle a rather complex 
    case with non rectangular patch. Related to issue #9580. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(ncols=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">9.6</span><span class="s0">, </span><span class="s3">4.8</span><span class="s1">))</span>

    <span class="s1">leg_bboxes = []</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">loc </span><span class="s0">in </span><span class="s1">zip(axs.flat</span><span class="s0">, </span><span class="s1">(</span><span class="s4">&quot;center&quot;</span><span class="s0">, </span><span class="s4">&quot;best&quot;</span><span class="s1">)):</span>
        <span class="s2"># An Ellipse patch at the top, a U-shaped Polygon patch at the</span>
        <span class="s2"># bottom and a ring-like Wedge patch: the correct placement of</span>
        <span class="s2"># the legend should be in the center.</span>
        <span class="s0">for </span><span class="s1">_patch </span><span class="s0">in </span><span class="s1">[</span>
                <span class="s1">mpatches.Ellipse(</span>
                    <span class="s1">xy=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">0.8</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">0.2</span><span class="s0">, </span><span class="s1">fc=</span><span class="s4">&quot;C1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">mpatches.Polygon(np.array([</span>
                    <span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">]])</span><span class="s0">, </span><span class="s1">fc=</span><span class="s4">&quot;C1&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">mpatches.Wedge((</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">360</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">0.05</span><span class="s0">, </span><span class="s1">fc=</span><span class="s4">&quot;C0&quot;</span><span class="s1">)</span>
                <span class="s1">]:</span>
            <span class="s1">ax.add_patch(_patch)</span>

        <span class="s1">ax.plot([</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;A segment&quot;</span><span class="s1">)  </span><span class="s2"># sthg to label</span>

        <span class="s1">leg = ax.legend(loc=loc)</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">leg_bboxes.append(</span>
            <span class="s1">leg.get_window_extent().transformed(ax.transAxes.inverted()))</span>

    <span class="s1">assert_allclose(leg_bboxes[</span><span class="s3">1</span><span class="s1">].bounds</span><span class="s0">, </span><span class="s1">leg_bboxes[</span><span class="s3">0</span><span class="s1">].bounds)</span>


<span class="s1">@image_comparison([</span><span class="s4">'legend_various_labels'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_various_labels():</span>
    <span class="s2"># tests all sorts of label types</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">121</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">4</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.linspace(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">4.1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'Développés'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'__nolegend__'</span><span class="s1">)</span>
    <span class="s1">ax.legend(numpoints=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'best'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_legend_label_with_leading_underscore():</span>
    <span class="s5">&quot;&quot;&quot; 
    Test that artists with labels starting with an underscore are not added to 
    the legend, and that a warning is issued if one tries to add them 
    explicitly. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line</span><span class="s0">, </span><span class="s1">= ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'_foo'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s4">r&quot;starts with '_'.*excluded from the legend.&quot;</span><span class="s1">):</span>
        <span class="s1">legend = ax.legend(handles=[line])</span>
    <span class="s0">assert </span><span class="s1">len(legend.legend_handles) == </span><span class="s3">0</span>


<span class="s1">@image_comparison([</span><span class="s4">'legend_labels_first.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_labels_first():</span>
    <span class="s2"># test labels to left of markers</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'-o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.ones(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">5</span><span class="s0">, </span><span class="s4">':x'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;x&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'d'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;diamond&quot;</span><span class="s1">)</span>
    <span class="s1">ax.legend(loc=</span><span class="s4">'best'</span><span class="s0">, </span><span class="s1">markerfirst=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'legend_multiple_keys.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_multiple_keys():</span>
    <span class="s2"># test legend entries with multiple keys</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">p1</span><span class="s0">, </span><span class="s1">= ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'-o'</span><span class="s1">)</span>
    <span class="s1">p2</span><span class="s0">, </span><span class="s1">= ax.plot([</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'-x'</span><span class="s1">)</span>
    <span class="s1">p3</span><span class="s0">, </span><span class="s1">= ax.plot([</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'-d'</span><span class="s1">)</span>
    <span class="s1">ax.legend([(p1</span><span class="s0">, </span><span class="s1">p2)</span><span class="s0">, </span><span class="s1">(p2</span><span class="s0">, </span><span class="s1">p1)</span><span class="s0">, </span><span class="s1">p3]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'two keys'</span><span class="s0">, </span><span class="s4">'pad=0'</span><span class="s0">, </span><span class="s4">'one key'</span><span class="s1">]</span><span class="s0">,</span>
              <span class="s1">numpoints=</span><span class="s3">1</span><span class="s0">,</span>
              <span class="s1">handler_map={(p1</span><span class="s0">, </span><span class="s1">p2): HandlerTuple(ndivide=</span><span class="s0">None</span><span class="s1">)</span><span class="s0">,</span>
                           <span class="s1">(p2</span><span class="s0">, </span><span class="s1">p1): HandlerTuple(ndivide=</span><span class="s0">None, </span><span class="s1">pad=</span><span class="s3">0</span><span class="s1">)})</span>


<span class="s1">@image_comparison([</span><span class="s4">'rgba_alpha.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">tol=</span><span class="s3">0 </span><span class="s0">if </span><span class="s1">platform.machine() == </span><span class="s4">'x86_64' </span><span class="s0">else </span><span class="s3">0.01</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_alpha_rgba():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">leg = plt.legend([</span><span class="s4">'Longlabel that will go away'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'center'</span><span class="s1">)</span>
    <span class="s1">leg.legendPatch.set_facecolor([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s4">'rcparam_alpha.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">tol=</span><span class="s3">0 </span><span class="s0">if </span><span class="s1">platform.machine() == </span><span class="s4">'x86_64' </span><span class="s0">else </span><span class="s3">0.01</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_alpha_rcparam():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context(rc={</span><span class="s4">'legend.framealpha'</span><span class="s1">: </span><span class="s3">.75</span><span class="s1">}):</span>
        <span class="s1">leg = plt.legend([</span><span class="s4">'Longlabel that will go away'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'center'</span><span class="s1">)</span>
        <span class="s2"># this alpha is going to be over-ridden by the rcparam with</span>
        <span class="s2"># sets the alpha of the patch to be non-None which causes the alpha</span>
        <span class="s2"># value of the face color to be discarded.  This behavior may not be</span>
        <span class="s2"># ideal, but it is what it is and we should keep track of it changing</span>
        <span class="s1">leg.legendPatch.set_facecolor([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s4">'fancy'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fancy():</span>
    <span class="s2"># using subplot triggers some offsetbox functionality untested elsewhere</span>
    <span class="s1">plt.subplot(</span><span class="s3">121</span><span class="s1">)</span>
    <span class="s1">plt.plot([</span><span class="s3">5</span><span class="s1">] * </span><span class="s3">10</span><span class="s0">, </span><span class="s4">'o--'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'XX'</span><span class="s1">)</span>
    <span class="s1">plt.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'XX</span><span class="s0">\n</span><span class="s4">XX'</span><span class="s1">)</span>
    <span class="s1">plt.errorbar(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s3">0.5</span><span class="s0">,</span>
                 <span class="s1">yerr=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'XX'</span><span class="s1">)</span>
    <span class="s1">plt.legend(loc=</span><span class="s4">&quot;center left&quot;</span><span class="s0">, </span><span class="s1">bbox_to_anchor=[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">ncols=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">title=</span><span class="s4">&quot;My legend&quot;</span><span class="s0">, </span><span class="s1">numpoints=</span><span class="s3">1</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'framealpha'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">tol=</span><span class="s3">0 </span><span class="s0">if </span><span class="s1">platform.machine() == </span><span class="s4">'x86_64' </span><span class="s0">else </span><span class="s3">0.02</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_framealpha():</span>
    <span class="s1">x = np.linspace(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">y = x</span>
    <span class="s1">plt.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'mylabel'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">plt.legend(framealpha=</span><span class="s3">0.5</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'scatter_rc3'</span><span class="s0">, </span><span class="s4">'scatter_rc1'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_rc():</span>
    <span class="s2"># using subplot triggers some offsetbox functionality untested elsewhere</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">ax = plt.subplot(</span><span class="s3">121</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'three'</span><span class="s1">)</span>
    <span class="s1">ax.legend(loc=</span><span class="s4">&quot;center left&quot;</span><span class="s0">, </span><span class="s1">bbox_to_anchor=[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span><span class="s0">,</span>
              <span class="s1">title=</span><span class="s4">&quot;My legend&quot;</span><span class="s1">)</span>

    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.scatterpoints'</span><span class="s1">] = </span><span class="s3">1</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">ax = plt.subplot(</span><span class="s3">121</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'one'</span><span class="s1">)</span>
    <span class="s1">ax.legend(loc=</span><span class="s4">&quot;center left&quot;</span><span class="s0">, </span><span class="s1">bbox_to_anchor=[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span><span class="s0">,</span>
              <span class="s1">title=</span><span class="s4">&quot;My legend&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'legend_expand'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_legend_expand():</span>
    <span class="s5">&quot;&quot;&quot;Test expand mode&quot;&quot;&quot;</span>
    <span class="s1">legend_modes = [</span><span class="s0">None, </span><span class="s4">&quot;expand&quot;</span><span class="s1">]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(len(legend_modes)</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">x = np.arange(</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">mode </span><span class="s0">in </span><span class="s1">zip(axs</span><span class="s0">, </span><span class="s1">legend_modes):</span>
        <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s3">50 </span><span class="s1">- x</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'y=1'</span><span class="s1">)</span>
        <span class="s1">l1 = ax.legend(loc=</span><span class="s4">'upper left'</span><span class="s0">, </span><span class="s1">mode=mode)</span>
        <span class="s1">ax.add_artist(l1)</span>
        <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">x - </span><span class="s3">50</span><span class="s0">, </span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'y=-1'</span><span class="s1">)</span>
        <span class="s1">l2 = ax.legend(loc=</span><span class="s4">'right'</span><span class="s0">, </span><span class="s1">mode=mode)</span>
        <span class="s1">ax.add_artist(l2)</span>
        <span class="s1">ax.legend(loc=</span><span class="s4">'lower left'</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s3">2</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'hatching'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s4">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hatching():</span>
    <span class="s2"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'text.kerning_factor'</span><span class="s1">] = </span><span class="s3">6</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s2"># Patches</span>
    <span class="s1">patch = plt.Rectangle((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s4">'xx'</span><span class="s0">,</span>
                          <span class="s1">label=</span><span class="s4">'Patch</span><span class="s0">\n</span><span class="s4">default color</span><span class="s0">\n</span><span class="s4">filled'</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(patch)</span>
    <span class="s1">patch = plt.Rectangle((</span><span class="s3">0.33</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s4">'||'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'C1'</span><span class="s0">,</span>
                          <span class="s1">label=</span><span class="s4">'Patch</span><span class="s0">\n</span><span class="s4">explicit color</span><span class="s0">\n</span><span class="s4">filled'</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(patch)</span>
    <span class="s1">patch = plt.Rectangle((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s4">'xx'</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">False,</span>
                          <span class="s1">label=</span><span class="s4">'Patch</span><span class="s0">\n</span><span class="s4">default color</span><span class="s0">\n</span><span class="s4">unfilled'</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(patch)</span>
    <span class="s1">patch = plt.Rectangle((</span><span class="s3">0.33</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s4">'||'</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">False,</span>
                          <span class="s1">edgecolor=</span><span class="s4">'C1'</span><span class="s0">,</span>
                          <span class="s1">label=</span><span class="s4">'Patch</span><span class="s0">\n</span><span class="s4">explicit color</span><span class="s0">\n</span><span class="s4">unfilled'</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(patch)</span>

    <span class="s2"># Paths</span>
    <span class="s1">ax.fill_between([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">.15</span><span class="s0">, </span><span class="s3">.3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.8</span><span class="s0">, </span><span class="s3">.8</span><span class="s0">, </span><span class="s3">.8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.9</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">.9</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">hatch=</span><span class="s4">'+'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'Path</span><span class="s0">\n</span><span class="s4">default color'</span><span class="s1">)</span>
    <span class="s1">ax.fill_between([</span><span class="s3">.33</span><span class="s0">, </span><span class="s3">.48</span><span class="s0">, </span><span class="s3">.63</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.8</span><span class="s0">, </span><span class="s3">.8</span><span class="s0">, </span><span class="s3">.8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.9</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">.9</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">hatch=</span><span class="s4">'+'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'C2'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'Path</span><span class="s0">\n</span><span class="s4">explicit color'</span><span class="s1">)</span>

    <span class="s1">ax.set_xlim(-</span><span class="s3">0.01</span><span class="s0">, </span><span class="s3">1.1</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">0.01</span><span class="s0">, </span><span class="s3">1.1</span><span class="s1">)</span>
    <span class="s1">ax.legend(handlelength=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">handleheight=</span><span class="s3">4</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_legend_remove():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">lines = ax.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">leg = fig.legend(lines</span><span class="s0">, </span><span class="s4">&quot;test&quot;</span><span class="s1">)</span>
    <span class="s1">leg.remove()</span>
    <span class="s0">assert </span><span class="s1">fig.legends == []</span>
    <span class="s1">leg = ax.legend(</span><span class="s4">&quot;test&quot;</span><span class="s1">)</span>
    <span class="s1">leg.remove()</span>
    <span class="s0">assert </span><span class="s1">ax.get_legend() </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_reverse_legend_handles_and_labels():</span>
    <span class="s5">&quot;&quot;&quot;Check that the legend handles and labels are reversed.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = </span><span class="s3">1</span>
    <span class="s1">y = </span><span class="s3">1</span>
    <span class="s1">labels = [</span><span class="s4">&quot;First label&quot;</span><span class="s0">, </span><span class="s4">&quot;Second label&quot;</span><span class="s0">, </span><span class="s4">&quot;Third label&quot;</span><span class="s1">]</span>
    <span class="s1">markers = [</span><span class="s4">'.'</span><span class="s0">, </span><span class="s4">','</span><span class="s0">, </span><span class="s4">'o'</span><span class="s1">]</span>

    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">markers[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=labels[</span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">markers[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=labels[</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">markers[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=labels[</span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">leg = ax.legend(reverse=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">actual_labels = [t.get_text() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">leg.get_texts()]</span>
    <span class="s1">actual_markers = [h.get_marker() </span><span class="s0">for </span><span class="s1">h </span><span class="s0">in </span><span class="s1">leg.legend_handles]</span>
    <span class="s0">assert </span><span class="s1">actual_labels == list(reversed(labels))</span>
    <span class="s0">assert </span><span class="s1">actual_markers == list(reversed(markers))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s4">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_reverse_legend_display(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s5">&quot;&quot;&quot;Check that the rendered legend entries are reversed&quot;&quot;&quot;</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'ro'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;first&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'bx'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;second&quot;</span><span class="s1">)</span>
    <span class="s1">ax.legend(reverse=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'bx'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;second&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'ro'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;first&quot;</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>


<span class="s0">class </span><span class="s1">TestLegendFunction:</span>
    <span class="s2"># Tests the legend function on the Axes and pyplot.</span>
    <span class="s0">def </span><span class="s1">test_legend_no_args(self):</span>
        <span class="s1">lines = plt.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'hello world'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">plt.legend()</span>
        <span class="s1">Legend.assert_called_with(plt.gca()</span><span class="s0">, </span><span class="s1">lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'hello world'</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_legend_positional_handles_labels(self):</span>
        <span class="s1">lines = plt.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">plt.legend(lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'hello world'</span><span class="s1">])</span>
        <span class="s1">Legend.assert_called_with(plt.gca()</span><span class="s0">, </span><span class="s1">lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'hello world'</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_legend_positional_handles_only(self):</span>
        <span class="s1">lines = plt.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">'but found an Artist'</span><span class="s1">):</span>
            <span class="s2"># a single arg is interpreted as labels</span>
            <span class="s2"># it's a common error to just pass handles</span>
            <span class="s1">plt.legend(lines)</span>

    <span class="s0">def </span><span class="s1">test_legend_positional_labels_only(self):</span>
        <span class="s1">lines = plt.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'hello world'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">plt.legend([</span><span class="s4">'foobar'</span><span class="s1">])</span>
        <span class="s1">Legend.assert_called_with(plt.gca()</span><span class="s0">, </span><span class="s1">lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'foobar'</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_legend_three_args(self):</span>
        <span class="s1">lines = plt.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'hello world'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">plt.legend(lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'foobar'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'right'</span><span class="s1">)</span>
        <span class="s1">Legend.assert_called_with(plt.gca()</span><span class="s0">, </span><span class="s1">lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'foobar'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'right'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_legend_handler_map(self):</span>
        <span class="s1">lines = plt.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'hello world'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.'</span>
                        <span class="s4">'_get_legend_handles_labels'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">handles_labels:</span>
            <span class="s1">handles_labels.return_value = lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'hello world'</span><span class="s1">]</span>
            <span class="s1">plt.legend(handler_map={</span><span class="s4">'1'</span><span class="s1">: </span><span class="s3">2</span><span class="s1">})</span>
        <span class="s1">handles_labels.assert_called_with([plt.gca()]</span><span class="s0">, </span><span class="s1">{</span><span class="s4">'1'</span><span class="s1">: </span><span class="s3">2</span><span class="s1">})</span>

    <span class="s0">def </span><span class="s1">test_legend_kwargs_handles_only(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">11</span><span class="s1">)</span>
        <span class="s1">ln1</span><span class="s0">, </span><span class="s1">= ax.plot(x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'x'</span><span class="s1">)</span>
        <span class="s1">ln2</span><span class="s0">, </span><span class="s1">= ax.plot(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*x</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'2x'</span><span class="s1">)</span>
        <span class="s1">ln3</span><span class="s0">, </span><span class="s1">= ax.plot(x</span><span class="s0">, </span><span class="s3">3</span><span class="s1">*x</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'3x'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">ax.legend(handles=[ln3</span><span class="s0">, </span><span class="s1">ln2])  </span><span class="s2"># reversed and not ln1</span>
        <span class="s1">Legend.assert_called_with(ax</span><span class="s0">, </span><span class="s1">[ln3</span><span class="s0">, </span><span class="s1">ln2]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'3x'</span><span class="s0">, </span><span class="s4">'2x'</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_legend_kwargs_labels_only(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">11</span><span class="s1">)</span>
        <span class="s1">ln1</span><span class="s0">, </span><span class="s1">= ax.plot(x</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s1">ln2</span><span class="s0">, </span><span class="s1">= ax.plot(x</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*x)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">ax.legend(labels=[</span><span class="s4">'x'</span><span class="s0">, </span><span class="s4">'2x'</span><span class="s1">])</span>
        <span class="s1">Legend.assert_called_with(ax</span><span class="s0">, </span><span class="s1">[ln1</span><span class="s0">, </span><span class="s1">ln2]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'x'</span><span class="s0">, </span><span class="s4">'2x'</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_legend_kwargs_handles_labels(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">th = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi</span><span class="s0">, </span><span class="s3">1024</span><span class="s1">)</span>
        <span class="s1">lns</span><span class="s0">, </span><span class="s1">= ax.plot(th</span><span class="s0">, </span><span class="s1">np.sin(th)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'sin'</span><span class="s1">)</span>
        <span class="s1">lnc</span><span class="s0">, </span><span class="s1">= ax.plot(th</span><span class="s0">, </span><span class="s1">np.cos(th)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'cos'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s2"># labels of lns, lnc are overwritten with explicit ('a', 'b')</span>
            <span class="s1">ax.legend(labels=(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">handles=(lnc</span><span class="s0">, </span><span class="s1">lns))</span>
        <span class="s1">Legend.assert_called_with(ax</span><span class="s0">, </span><span class="s1">(lnc</span><span class="s0">, </span><span class="s1">lns)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">test_warn_mixed_args_and_kwargs(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">th = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">*np.pi</span><span class="s0">, </span><span class="s3">1024</span><span class="s1">)</span>
        <span class="s1">lns</span><span class="s0">, </span><span class="s1">= ax.plot(th</span><span class="s0">, </span><span class="s1">np.sin(th)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'sin'</span><span class="s1">)</span>
        <span class="s1">lnc</span><span class="s0">, </span><span class="s1">= ax.plot(th</span><span class="s0">, </span><span class="s1">np.cos(th)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'cos'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.warns(UserWarning) </span><span class="s0">as </span><span class="s1">record:</span>
            <span class="s1">ax.legend((lnc</span><span class="s0">, </span><span class="s1">lns)</span><span class="s0">, </span><span class="s1">labels=(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">))</span>
        <span class="s0">assert </span><span class="s1">len(record) == </span><span class="s3">1</span>
        <span class="s0">assert </span><span class="s1">str(record[</span><span class="s3">0</span><span class="s1">].message) == (</span>
            <span class="s4">&quot;You have mixed positional and keyword arguments, some input may &quot;</span>
            <span class="s4">&quot;be discarded.&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_parasite(self):</span>
        <span class="s0">from </span><span class="s1">mpl_toolkits.axes_grid1 </span><span class="s0">import </span><span class="s1">host_subplot</span>

        <span class="s1">host = host_subplot(</span><span class="s3">111</span><span class="s1">)</span>
        <span class="s1">par = host.twinx()</span>

        <span class="s1">p1</span><span class="s0">, </span><span class="s1">= host.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;Density&quot;</span><span class="s1">)</span>
        <span class="s1">p2</span><span class="s0">, </span><span class="s1">= par.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;Temperature&quot;</span><span class="s1">)</span>

        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">plt.legend()</span>
        <span class="s1">Legend.assert_called_with(host</span><span class="s0">, </span><span class="s1">[p1</span><span class="s0">, </span><span class="s1">p2]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'Density'</span><span class="s0">, </span><span class="s4">'Temperature'</span><span class="s1">])</span>


<span class="s0">class </span><span class="s1">TestLegendFigureFunction:</span>
    <span class="s2"># Tests the legend function for figure</span>
    <span class="s0">def </span><span class="s1">test_legend_handle_label(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">lines = ax.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">fig.legend(lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'hello world'</span><span class="s1">])</span>
        <span class="s1">Legend.assert_called_with(fig</span><span class="s0">, </span><span class="s1">lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'hello world'</span><span class="s1">]</span><span class="s0">,</span>
                                  <span class="s1">bbox_transform=fig.transFigure)</span>

    <span class="s0">def </span><span class="s1">test_legend_no_args(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">lines = ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'hello world'</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">fig.legend()</span>
        <span class="s1">Legend.assert_called_with(fig</span><span class="s0">, </span><span class="s1">lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'hello world'</span><span class="s1">]</span><span class="s0">,</span>
                                  <span class="s1">bbox_transform=fig.transFigure)</span>

    <span class="s0">def </span><span class="s1">test_legend_label_arg(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">lines = ax.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">fig.legend([</span><span class="s4">'foobar'</span><span class="s1">])</span>
        <span class="s1">Legend.assert_called_with(fig</span><span class="s0">, </span><span class="s1">lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'foobar'</span><span class="s1">]</span><span class="s0">,</span>
                                  <span class="s1">bbox_transform=fig.transFigure)</span>

    <span class="s0">def </span><span class="s1">test_legend_label_three_args(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">lines = ax.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">fig.legend(lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'foobar'</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'right'</span><span class="s1">)</span>
        <span class="s1">Legend.assert_called_with(fig</span><span class="s0">, </span><span class="s1">lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'foobar'</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'right'</span><span class="s0">,</span>
                                  <span class="s1">bbox_transform=fig.transFigure)</span>

    <span class="s0">def </span><span class="s1">test_legend_label_three_args_pluskw(self):</span>
        <span class="s2"># test that third argument and loc=  called together give</span>
        <span class="s2"># Exception</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">lines = ax.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s0">with </span><span class="s1">pytest.raises(Exception):</span>
            <span class="s1">fig.legend(lines</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'foobar'</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'right'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'left'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_legend_kw_args(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">lines = axs[</span><span class="s3">0</span><span class="s1">].plot(range(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s1">lines2 = axs[</span><span class="s3">1</span><span class="s1">].plot(np.arange(</span><span class="s3">10</span><span class="s1">) * </span><span class="s3">2.</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">mock.patch(</span><span class="s4">'matplotlib.legend.Legend'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">Legend:</span>
            <span class="s1">fig.legend(loc=</span><span class="s4">'right'</span><span class="s0">, </span><span class="s1">labels=(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">handles=(lines</span><span class="s0">, </span><span class="s1">lines2))</span>
        <span class="s1">Legend.assert_called_with(</span>
            <span class="s1">fig</span><span class="s0">, </span><span class="s1">(lines</span><span class="s0">, </span><span class="s1">lines2)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'right'</span><span class="s0">,</span>
            <span class="s1">bbox_transform=fig.transFigure)</span>

    <span class="s0">def </span><span class="s1">test_warn_args_kwargs(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">lines = axs[</span><span class="s3">0</span><span class="s1">].plot(range(</span><span class="s3">10</span><span class="s1">))</span>
        <span class="s1">lines2 = axs[</span><span class="s3">1</span><span class="s1">].plot(np.arange(</span><span class="s3">10</span><span class="s1">) * </span><span class="s3">2.</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.warns(UserWarning) </span><span class="s0">as </span><span class="s1">record:</span>
            <span class="s1">fig.legend((lines</span><span class="s0">, </span><span class="s1">lines2)</span><span class="s0">, </span><span class="s1">labels=(</span><span class="s4">'a'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">))</span>
        <span class="s0">assert </span><span class="s1">len(record) == </span><span class="s3">1</span>
        <span class="s0">assert </span><span class="s1">str(record[</span><span class="s3">0</span><span class="s1">].message) == (</span>
            <span class="s4">&quot;You have mixed positional and keyword arguments, some input may &quot;</span>
            <span class="s4">&quot;be discarded.&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_figure_legend_outside():</span>
    <span class="s1">todos = [</span><span class="s4">'upper ' </span><span class="s1">+ pos </span><span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s1">[</span><span class="s4">'left'</span><span class="s0">, </span><span class="s4">'center'</span><span class="s0">, </span><span class="s4">'right'</span><span class="s1">]]</span>
    <span class="s1">todos += [</span><span class="s4">'lower ' </span><span class="s1">+ pos </span><span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s1">[</span><span class="s4">'left'</span><span class="s0">, </span><span class="s4">'center'</span><span class="s0">, </span><span class="s4">'right'</span><span class="s1">]]</span>
    <span class="s1">todos += [</span><span class="s4">'left ' </span><span class="s1">+ pos </span><span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s1">[</span><span class="s4">'lower'</span><span class="s0">, </span><span class="s4">'center'</span><span class="s0">, </span><span class="s4">'upper'</span><span class="s1">]]</span>
    <span class="s1">todos += [</span><span class="s4">'right ' </span><span class="s1">+ pos </span><span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s1">[</span><span class="s4">'lower'</span><span class="s0">, </span><span class="s4">'center'</span><span class="s0">, </span><span class="s4">'upper'</span><span class="s1">]]</span>

    <span class="s1">upperext = [</span><span class="s3">20.347556</span><span class="s0">,  </span><span class="s3">27.722556</span><span class="s0">, </span><span class="s3">790.583</span><span class="s0">, </span><span class="s3">545.499</span><span class="s1">]</span>
    <span class="s1">lowerext = [</span><span class="s3">20.347556</span><span class="s0">,  </span><span class="s3">71.056556</span><span class="s0">, </span><span class="s3">790.583</span><span class="s0">, </span><span class="s3">588.833</span><span class="s1">]</span>
    <span class="s1">leftext = [</span><span class="s3">151.681556</span><span class="s0">, </span><span class="s3">27.722556</span><span class="s0">, </span><span class="s3">790.583</span><span class="s0">, </span><span class="s3">588.833</span><span class="s1">]</span>
    <span class="s1">rightext = [</span><span class="s3">20.347556</span><span class="s0">,  </span><span class="s3">27.722556</span><span class="s0">, </span><span class="s3">659.249</span><span class="s0">, </span><span class="s3">588.833</span><span class="s1">]</span>
    <span class="s1">axbb = [upperext</span><span class="s0">, </span><span class="s1">upperext</span><span class="s0">, </span><span class="s1">upperext</span><span class="s0">,</span>
            <span class="s1">lowerext</span><span class="s0">, </span><span class="s1">lowerext</span><span class="s0">, </span><span class="s1">lowerext</span><span class="s0">,</span>
            <span class="s1">leftext</span><span class="s0">, </span><span class="s1">leftext</span><span class="s0">, </span><span class="s1">leftext</span><span class="s0">,</span>
            <span class="s1">rightext</span><span class="s0">, </span><span class="s1">rightext</span><span class="s0">, </span><span class="s1">rightext]</span>

    <span class="s1">legbb = [[</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">555.</span><span class="s0">, </span><span class="s3">133.</span><span class="s0">, </span><span class="s3">590.</span><span class="s1">]</span><span class="s0">,     </span><span class="s2"># upper left</span>
             <span class="s1">[</span><span class="s3">338.5</span><span class="s0">, </span><span class="s3">555.</span><span class="s0">, </span><span class="s3">461.5</span><span class="s0">, </span><span class="s3">590.</span><span class="s1">]</span><span class="s0">,  </span><span class="s2"># upper center</span>
             <span class="s1">[</span><span class="s3">667</span><span class="s0">, </span><span class="s3">555.</span><span class="s0">, </span><span class="s3">790.</span><span class="s0">,  </span><span class="s3">590.</span><span class="s1">]</span><span class="s0">,    </span><span class="s2"># upper right</span>
             <span class="s1">[</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">10.</span><span class="s0">, </span><span class="s3">133.</span><span class="s0">,  </span><span class="s3">45.</span><span class="s1">]</span><span class="s0">,      </span><span class="s2"># lower left</span>
             <span class="s1">[</span><span class="s3">338.5</span><span class="s0">, </span><span class="s3">10.</span><span class="s0">, </span><span class="s3">461.5</span><span class="s0">,  </span><span class="s3">45.</span><span class="s1">]</span><span class="s0">,   </span><span class="s2"># lower center</span>
             <span class="s1">[</span><span class="s3">667.</span><span class="s0">, </span><span class="s3">10.</span><span class="s0">, </span><span class="s3">790.</span><span class="s0">,  </span><span class="s3">45.</span><span class="s1">]</span><span class="s0">,     </span><span class="s2"># lower right</span>
             <span class="s1">[</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">10.</span><span class="s0">, </span><span class="s3">133.</span><span class="s0">, </span><span class="s3">45.</span><span class="s1">]</span><span class="s0">,       </span><span class="s2"># left lower</span>
             <span class="s1">[</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">282.5</span><span class="s0">, </span><span class="s3">133.</span><span class="s0">, </span><span class="s3">317.5</span><span class="s1">]</span><span class="s0">,   </span><span class="s2"># left center</span>
             <span class="s1">[</span><span class="s3">10.</span><span class="s0">, </span><span class="s3">555.</span><span class="s0">, </span><span class="s3">133.</span><span class="s0">, </span><span class="s3">590.</span><span class="s1">]</span><span class="s0">,     </span><span class="s2"># left upper</span>
             <span class="s1">[</span><span class="s3">667</span><span class="s0">, </span><span class="s3">10.</span><span class="s0">, </span><span class="s3">790.</span><span class="s0">, </span><span class="s3">45.</span><span class="s1">]</span><span class="s0">,       </span><span class="s2"># right lower</span>
             <span class="s1">[</span><span class="s3">667.</span><span class="s0">, </span><span class="s3">282.5</span><span class="s0">, </span><span class="s3">790.</span><span class="s0">, </span><span class="s3">317.5</span><span class="s1">]</span><span class="s0">,  </span><span class="s2"># right center</span>
             <span class="s1">[</span><span class="s3">667.</span><span class="s0">, </span><span class="s3">555.</span><span class="s0">, </span><span class="s3">790.</span><span class="s0">, </span><span class="s3">590.</span><span class="s1">]]    </span><span class="s2"># right upper</span>

    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">todo </span><span class="s0">in </span><span class="s1">enumerate(todos):</span>
        <span class="s1">print(todo)</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(constrained_layout=</span><span class="s0">True, </span><span class="s1">dpi=</span><span class="s3">100</span><span class="s1">)</span>
        <span class="s1">axs.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'Boo1'</span><span class="s1">)</span>
        <span class="s1">leg = fig.legend(loc=</span><span class="s4">'outside ' </span><span class="s1">+ todo)</span>
        <span class="s1">fig.draw_without_rendering()</span>

        <span class="s1">assert_allclose(axs.get_window_extent().extents</span><span class="s0">,</span>
                        <span class="s1">axbb[nn])</span>
        <span class="s1">assert_allclose(leg.get_window_extent().extents</span><span class="s0">,</span>
                        <span class="s1">legbb[nn])</span>


<span class="s1">@image_comparison([</span><span class="s4">'legend_stackplot.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_legend_stackplot():</span>
    <span class="s5">&quot;&quot;&quot;Test legend for PolyCollection using stackplot.&quot;&quot;&quot;</span>
    <span class="s2"># related to #1341, #1943, and PR #3303</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y1 = </span><span class="s3">1.0 </span><span class="s1">* x</span>
    <span class="s1">y2 = </span><span class="s3">2.0 </span><span class="s1">* x + </span><span class="s3">1</span>
    <span class="s1">y3 = </span><span class="s3">3.0 </span><span class="s1">* x + </span><span class="s3">2</span>
    <span class="s1">ax.stackplot(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">y3</span><span class="s0">, </span><span class="s1">labels=[</span><span class="s4">'y1'</span><span class="s0">, </span><span class="s4">'y2'</span><span class="s0">, </span><span class="s4">'y3'</span><span class="s1">])</span>
    <span class="s1">ax.set_xlim((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">ax.set_ylim((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">70</span><span class="s1">))</span>
    <span class="s1">ax.legend(loc=</span><span class="s4">'best'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_cross_figure_patch_legend():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots()</span>

    <span class="s1">brs = ax.bar(range(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">))</span>
    <span class="s1">fig2.legend(brs</span><span class="s0">, </span><span class="s4">'foo'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_nanscatter():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">h = ax.scatter([np.nan]</span><span class="s0">, </span><span class="s1">[np.nan]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">&quot;o&quot;</span><span class="s0">,</span>
                   <span class="s1">facecolor=</span><span class="s4">&quot;r&quot;</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">&quot;r&quot;</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">ax.legend([h]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;scatter&quot;</span><span class="s1">])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">for </span><span class="s1">color </span><span class="s0">in </span><span class="s1">[</span><span class="s4">'red'</span><span class="s0">, </span><span class="s4">'green'</span><span class="s0">, </span><span class="s4">'blue'</span><span class="s1">]:</span>
        <span class="s1">n = </span><span class="s3">750</span>
        <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.random.rand(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">n)</span>
        <span class="s1">scale = </span><span class="s3">200.0 </span><span class="s1">* np.random.rand(n)</span>
        <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c=color</span><span class="s0">, </span><span class="s1">s=scale</span><span class="s0">, </span><span class="s1">label=color</span><span class="s0">,</span>
                   <span class="s1">alpha=</span><span class="s3">0.3</span><span class="s0">, </span><span class="s1">edgecolors=</span><span class="s4">'none'</span><span class="s1">)</span>

    <span class="s1">ax.legend()</span>
    <span class="s1">ax.grid(</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_legend_repeatcheckok():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.scatter(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'k'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'test'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">'v'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'test'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>
    <span class="s1">hand</span><span class="s0">, </span><span class="s1">lab = mlegend._get_legend_handles_labels([ax])</span>
    <span class="s0">assert </span><span class="s1">len(lab) == </span><span class="s3">2</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.scatter(</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'k'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'test'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'k'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">'v'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'test'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>
    <span class="s1">hand</span><span class="s0">, </span><span class="s1">lab = mlegend._get_legend_handles_labels([ax])</span>
    <span class="s0">assert </span><span class="s1">len(lab) == </span><span class="s3">2</span>


<span class="s1">@image_comparison([</span><span class="s4">'not_covering_scatter.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_not_covering_scatter():</span>
    <span class="s1">colors = [</span><span class="s4">'b'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'r'</span><span class="s1">]</span>

    <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">):</span>
        <span class="s1">plt.scatter([n]</span><span class="s0">, </span><span class="s1">[n]</span><span class="s0">, </span><span class="s1">color=colors[n])</span>

    <span class="s1">plt.legend([</span><span class="s4">'foo'</span><span class="s0">, </span><span class="s4">'foo'</span><span class="s0">, </span><span class="s4">'foo'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'best'</span><span class="s1">)</span>
    <span class="s1">plt.gca().set_xlim(-</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">2.2</span><span class="s1">)</span>
    <span class="s1">plt.gca().set_ylim(-</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">2.2</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'not_covering_scatter_transform.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_not_covering_scatter_transform():</span>
    <span class="s2"># Offsets point to top left, the default auto position</span>
    <span class="s1">offset = mtransforms.Affine2D().translate(-</span><span class="s3">20</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">1000</span><span class="s1">)</span>
    <span class="s1">plt.plot(x</span><span class="s0">, </span><span class="s1">x)</span>

    <span class="s1">plt.scatter([</span><span class="s3">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">transform=offset + plt.gca().transData)</span>

    <span class="s1">plt.legend([</span><span class="s4">'foo'</span><span class="s0">, </span><span class="s4">'bar'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">loc=</span><span class="s4">'best'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_linecollection_scaled_dashes():</span>
    <span class="s1">lines1 = [[(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">.3</span><span class="s0">, </span><span class="s3">.6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">.2</span><span class="s0">, </span><span class="s3">.2</span><span class="s1">)]]</span>
    <span class="s1">lines2 = [[[</span><span class="s3">0.7</span><span class="s0">, </span><span class="s3">.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.8</span><span class="s0">, </span><span class="s3">.4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.6</span><span class="s0">, </span><span class="s3">.1</span><span class="s1">]]]</span>
    <span class="s1">lines3 = [[[</span><span class="s3">0.6</span><span class="s0">, </span><span class="s3">.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.8</span><span class="s0">, </span><span class="s3">.4</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">.1</span><span class="s1">]]]</span>
    <span class="s1">lc1 = mcollections.LineCollection(lines1</span><span class="s0">, </span><span class="s1">linestyles=</span><span class="s4">&quot;--&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">lc2 = mcollections.LineCollection(lines2</span><span class="s0">, </span><span class="s1">linestyles=</span><span class="s4">&quot;-.&quot;</span><span class="s1">)</span>
    <span class="s1">lc3 = mcollections.LineCollection(lines3</span><span class="s0">, </span><span class="s1">linestyles=</span><span class="s4">&quot;:&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">.5</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.add_collection(lc1)</span>
    <span class="s1">ax.add_collection(lc2)</span>
    <span class="s1">ax.add_collection(lc3)</span>

    <span class="s1">leg = ax.legend([lc1</span><span class="s0">, </span><span class="s1">lc2</span><span class="s0">, </span><span class="s1">lc3]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;line1&quot;</span><span class="s0">, </span><span class="s4">&quot;line2&quot;</span><span class="s0">, </span><span class="s4">'line 3'</span><span class="s1">])</span>
    <span class="s1">h1</span><span class="s0">, </span><span class="s1">h2</span><span class="s0">, </span><span class="s1">h3 = leg.legend_handles</span>

    <span class="s0">for </span><span class="s1">oh</span><span class="s0">, </span><span class="s1">lh </span><span class="s0">in </span><span class="s1">zip((lc1</span><span class="s0">, </span><span class="s1">lc2</span><span class="s0">, </span><span class="s1">lc3)</span><span class="s0">, </span><span class="s1">(h1</span><span class="s0">, </span><span class="s1">h2</span><span class="s0">, </span><span class="s1">h3)):</span>
        <span class="s0">assert </span><span class="s1">oh.get_linestyles()[</span><span class="s3">0</span><span class="s1">] == lh._dash_pattern</span>


<span class="s0">def </span><span class="s1">test_handler_numpoints():</span>
    <span class="s5">&quot;&quot;&quot;Test legend handler with numpoints &lt;= 1.&quot;&quot;&quot;</span>
    <span class="s2"># related to #6921 and PR #8478</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'test'</span><span class="s1">)</span>
    <span class="s1">ax.legend(numpoints=</span><span class="s3">0.5</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_text_nohandler_warning():</span>
    <span class="s5">&quot;&quot;&quot;Test that Text artists with labels raise a warning&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.text(x=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">y=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">s=</span><span class="s4">&quot;text&quot;</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;label&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning) </span><span class="s0">as </span><span class="s1">record:</span>
        <span class="s1">ax.legend()</span>
    <span class="s0">assert </span><span class="s1">len(record) == </span><span class="s3">1</span>

    <span class="s2"># this should _not_ warn:</span>
    <span class="s1">f</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.pcolormesh(np.random.uniform(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)))</span>
    <span class="s0">with </span><span class="s1">warnings.catch_warnings():</span>
        <span class="s1">warnings.simplefilter(</span><span class="s4">&quot;error&quot;</span><span class="s1">)</span>
        <span class="s1">ax.get_legend_handles_labels()</span>


<span class="s0">def </span><span class="s1">test_empty_bar_chart_with_legend():</span>
    <span class="s5">&quot;&quot;&quot;Test legend when bar chart is empty with a label.&quot;&quot;&quot;</span>
    <span class="s2"># related to issue #13003. Calling plt.legend() should not</span>
    <span class="s2"># raise an IndexError.</span>
    <span class="s1">plt.bar([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'test'</span><span class="s1">)</span>
    <span class="s1">plt.legend()</span>


<span class="s0">def </span><span class="s1">test_shadow_framealpha():</span>
    <span class="s2"># Test if framealpha is activated when shadow is True</span>
    <span class="s2"># and framealpha is not explicitly passed'''</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;test&quot;</span><span class="s1">)</span>
    <span class="s1">leg = ax.legend(shadow=</span><span class="s0">True, </span><span class="s1">facecolor=</span><span class="s4">'w'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">leg.get_frame().get_alpha() == </span><span class="s3">1</span>


<span class="s0">def </span><span class="s1">test_legend_title_empty():</span>
    <span class="s2"># test that if we don't set the legend title, that</span>
    <span class="s2"># it comes back as an empty string, and that it is not</span>
    <span class="s2"># visible:</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">assert </span><span class="s1">leg.get_title().get_text() == </span><span class="s4">&quot;&quot;</span>
    <span class="s0">assert not </span><span class="s1">leg.get_title().get_visible()</span>


<span class="s0">def </span><span class="s1">test_legend_proper_window_extent():</span>
    <span class="s2"># test that legend returns the expected extent under various dpi...</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'Aardvark'</span><span class="s1">)</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s1">x01 = leg.get_window_extent(fig.canvas.get_renderer()).x0</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s3">200</span><span class="s1">)</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'Aardvark'</span><span class="s1">)</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s1">x02 = leg.get_window_extent(fig.canvas.get_renderer()).x0</span>
    <span class="s0">assert </span><span class="s1">pytest.approx(x01*</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">) == x02</span>


<span class="s0">def </span><span class="s1">test_window_extent_cached_renderer():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'Aardvark'</span><span class="s1">)</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s1">leg2 = fig.legend()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s2"># check that get_window_extent will use the cached renderer</span>
    <span class="s1">leg.get_window_extent()</span>
    <span class="s1">leg2.get_window_extent()</span>


<span class="s0">def </span><span class="s1">test_legend_title_fontprop_fontsize():</span>
    <span class="s2"># test the title_fontsize kwarg</span>
    <span class="s1">plt.plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.legend(title=</span><span class="s4">'Aardvark'</span><span class="s0">, </span><span class="s1">title_fontsize=</span><span class="s3">22</span><span class="s0">,</span>
                   <span class="s1">title_fontproperties={</span><span class="s4">'family'</span><span class="s1">: </span><span class="s4">'serif'</span><span class="s0">, </span><span class="s4">'size'</span><span class="s1">: </span><span class="s3">22</span><span class="s1">})</span>

    <span class="s1">leg = plt.legend(title=</span><span class="s4">'Aardvark'</span><span class="s0">, </span><span class="s1">title_fontproperties=FontProperties(</span>
                                       <span class="s1">family=</span><span class="s4">'serif'</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">22</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">leg.get_title().get_size() == </span><span class="s3">22</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axes = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">6</span><span class="s1">))</span>
    <span class="s1">axes = axes.flat</span>
    <span class="s1">axes[</span><span class="s3">0</span><span class="s1">].plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">leg0 = axes[</span><span class="s3">0</span><span class="s1">].legend(title=</span><span class="s4">'Aardvark'</span><span class="s0">, </span><span class="s1">title_fontsize=</span><span class="s3">22</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">leg0.get_title().get_fontsize() == </span><span class="s3">22</span>
    <span class="s1">axes[</span><span class="s3">1</span><span class="s1">].plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">leg1 = axes[</span><span class="s3">1</span><span class="s1">].legend(title=</span><span class="s4">'Aardvark'</span><span class="s0">,</span>
                          <span class="s1">title_fontproperties={</span><span class="s4">'family'</span><span class="s1">: </span><span class="s4">'serif'</span><span class="s0">, </span><span class="s4">'size'</span><span class="s1">: </span><span class="s3">22</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">leg1.get_title().get_fontsize() == </span><span class="s3">22</span>
    <span class="s1">axes[</span><span class="s3">2</span><span class="s1">].plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.title_fontsize'</span><span class="s1">] = </span><span class="s0">None</span>
    <span class="s1">leg2 = axes[</span><span class="s3">2</span><span class="s1">].legend(title=</span><span class="s4">'Aardvark'</span><span class="s0">,</span>
                          <span class="s1">title_fontproperties={</span><span class="s4">'family'</span><span class="s1">: </span><span class="s4">'serif'</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">leg2.get_title().get_fontsize() == mpl.rcParams[</span><span class="s4">'font.size'</span><span class="s1">]</span>
    <span class="s1">axes[</span><span class="s3">3</span><span class="s1">].plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">leg3 = axes[</span><span class="s3">3</span><span class="s1">].legend(title=</span><span class="s4">'Aardvark'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">leg3.get_title().get_fontsize() == mpl.rcParams[</span><span class="s4">'font.size'</span><span class="s1">]</span>
    <span class="s1">axes[</span><span class="s3">4</span><span class="s1">].plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.title_fontsize'</span><span class="s1">] = </span><span class="s3">20</span>
    <span class="s1">leg4 = axes[</span><span class="s3">4</span><span class="s1">].legend(title=</span><span class="s4">'Aardvark'</span><span class="s0">,</span>
                          <span class="s1">title_fontproperties={</span><span class="s4">'family'</span><span class="s1">: </span><span class="s4">'serif'</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">leg4.get_title().get_fontsize() == </span><span class="s3">20</span>
    <span class="s1">axes[</span><span class="s3">5</span><span class="s1">].plot(range(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">leg5 = axes[</span><span class="s3">5</span><span class="s1">].legend(title=</span><span class="s4">'Aardvark'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">leg5.get_title().get_fontsize() == </span><span class="s3">20</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'alignment'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'center'</span><span class="s0">, </span><span class="s4">'left'</span><span class="s0">, </span><span class="s4">'right'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_legend_alignment(alignment):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'test'</span><span class="s1">)</span>
    <span class="s1">leg = ax.legend(title=</span><span class="s4">&quot;Aardvark&quot;</span><span class="s0">, </span><span class="s1">alignment=alignment)</span>
    <span class="s0">assert </span><span class="s1">leg.get_children()[</span><span class="s3">0</span><span class="s1">].align == alignment</span>
    <span class="s0">assert </span><span class="s1">leg.get_alignment() == alignment</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'alignment'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'center'</span><span class="s0">, </span><span class="s4">'left'</span><span class="s0">, </span><span class="s4">'right'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_legend_set_alignment(alignment):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'test'</span><span class="s1">)</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s1">leg.set_alignment(alignment)</span>
    <span class="s0">assert </span><span class="s1">leg.get_children()[</span><span class="s3">0</span><span class="s1">].align == alignment</span>
    <span class="s0">assert </span><span class="s1">leg.get_alignment() == alignment</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'color'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'red'</span><span class="s0">, </span><span class="s4">'none'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">)))</span>
<span class="s0">def </span><span class="s1">test_legend_labelcolor_single(color):</span>
    <span class="s2"># test labelcolor for a single color</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=color)</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">leg.get_texts():</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_list():</span>
    <span class="s2"># test labelcolor for a list of colors</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">])</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_linecolor():</span>
    <span class="s2"># test the labelcolor for labelcolor='linecolor'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'linecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_linecolor():</span>
    <span class="s2"># test the labelcolor for labelcolor='linecolor' on PathCollection</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">c=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">c=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">c=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'linecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_linecolor_iterable():</span>
    <span class="s2"># test the labelcolor for labelcolor='linecolor' on PathCollection</span>
    <span class="s2"># with iterable colors</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">colors = np.random.default_rng().choice([</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">c=colors)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'linecolor'</span><span class="s1">)</span>
    <span class="s1">text</span><span class="s0">, </span><span class="s1">= leg.get_texts()</span>
    <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s4">'black'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_linecolor_cmap():</span>
    <span class="s2"># test the labelcolor for labelcolor='linecolor' on PathCollection</span>
    <span class="s2"># with a colormap</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'linecolor'</span><span class="s1">)</span>
    <span class="s1">text</span><span class="s0">, </span><span class="s1">= leg.get_texts()</span>
    <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s4">'black'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_markeredgecolor():</span>
    <span class="s2"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'markeredgecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markeredgecolor():</span>
    <span class="s2"># test the labelcolor for labelcolor='markeredgecolor' on PathCollection</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'markeredgecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markeredgecolor_iterable():</span>
    <span class="s2"># test the labelcolor for labelcolor='markeredgecolor' on PathCollection</span>
    <span class="s2"># with iterable colors</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">colors = np.random.default_rng().choice([</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">edgecolor=colors)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'markeredgecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'k'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markeredgecolor_cmap():</span>
    <span class="s2"># test the labelcolor for labelcolor='markeredgecolor' on PathCollection</span>
    <span class="s2"># with a colormap</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">edgecolors = mpl.cm.viridis(np.random.rand(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">ax.scatter(</span>
        <span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">,</span>
        <span class="s1">c=np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">edgecolor=edgecolors</span><span class="s0">,</span>
        <span class="s1">cmap=</span><span class="s4">&quot;Reds&quot;</span>
    <span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'markeredgecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'k'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_markerfacecolor():</span>
    <span class="s2"># test the labelcolor for labelcolor='markerfacecolor'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'markerfacecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markerfacecolor():</span>
    <span class="s2"># test the labelcolor for labelcolor='markerfacecolor' on PathCollection</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'markerfacecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markerfacecolor_iterable():</span>
    <span class="s2"># test the labelcolor for labelcolor='markerfacecolor' on PathCollection</span>
    <span class="s2"># with iterable colors</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">colors = np.random.default_rng().choice([</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">ax.scatter(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">facecolor=colors)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'markerfacecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'k'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markfacecolor_cmap():</span>
    <span class="s2"># test the labelcolor for labelcolor='markerfacecolor' on PathCollection</span>
    <span class="s2"># with colormaps</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">facecolors = mpl.cm.viridis(np.random.rand(</span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">ax.scatter(</span>
        <span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">,</span>
        <span class="s1">c=np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">facecolor=facecolors</span>
    <span class="s1">)</span>

    <span class="s1">leg = ax.legend(labelcolor=</span><span class="s4">'markerfacecolor'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'k'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'color'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">'red'</span><span class="s0">, </span><span class="s4">'none'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">)))</span>
<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_single(color):</span>
    <span class="s2"># test the rcParams legend.labelcolor for a single color</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s1">)</span>

    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.labelcolor'</span><span class="s1">] = color</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">leg.get_texts():</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_linecolor():</span>
    <span class="s2"># test the rcParams legend.labelcolor for a linecolor</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.labelcolor'</span><span class="s1">] = </span><span class="s4">'linecolor'</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_markeredgecolor():</span>
    <span class="s2"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.labelcolor'</span><span class="s1">] = </span><span class="s4">'markeredgecolor'</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_markeredgecolor_short():</span>
    <span class="s2"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">markeredgecolor=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.labelcolor'</span><span class="s1">] = </span><span class="s4">'mec'</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_markerfacecolor():</span>
    <span class="s2"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.labelcolor'</span><span class="s1">] = </span><span class="s4">'markerfacecolor'</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_markerfacecolor_short():</span>
    <span class="s2"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#1'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#2'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'g'</span><span class="s1">)</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)*</span><span class="s3">3</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'#3'</span><span class="s0">, </span><span class="s1">markerfacecolor=</span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s1">mpl.rcParams[</span><span class="s4">'legend.labelcolor'</span><span class="s1">] = </span><span class="s4">'mfc'</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(leg.get_texts()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'r'</span><span class="s0">, </span><span class="s4">'g'</span><span class="s0">, </span><span class="s4">'b'</span><span class="s1">]):</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(text.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_get_set_draggable():</span>
    <span class="s1">legend = plt.legend()</span>
    <span class="s0">assert not </span><span class="s1">legend.get_draggable()</span>
    <span class="s1">legend.set_draggable(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">legend.get_draggable()</span>
    <span class="s1">legend.set_draggable(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">legend.get_draggable()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'draggable'</span><span class="s0">, </span><span class="s1">(</span><span class="s0">True, False</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_legend_draggable(draggable):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'shabnams'</span><span class="s1">)</span>
    <span class="s1">leg = ax.legend(draggable=draggable)</span>
    <span class="s0">assert </span><span class="s1">leg.get_draggable() </span><span class="s0">is </span><span class="s1">draggable</span>


<span class="s0">def </span><span class="s1">test_alpha_handles():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">n</span><span class="s0">, </span><span class="s1">hh = plt.hist([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.25</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'data'</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'red'</span><span class="s1">)</span>
    <span class="s1">legend = plt.legend()</span>
    <span class="s0">for </span><span class="s1">lh </span><span class="s0">in </span><span class="s1">legend.legend_handles:</span>
        <span class="s1">lh.set_alpha(</span><span class="s3">1.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">lh.get_facecolor()[:-</span><span class="s3">1</span><span class="s1">] == hh[</span><span class="s3">1</span><span class="s1">].get_facecolor()[:-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">lh.get_edgecolor()[:-</span><span class="s3">1</span><span class="s1">] == hh[</span><span class="s3">1</span><span class="s1">].get_edgecolor()[:-</span><span class="s3">1</span><span class="s1">]</span>


<span class="s1">@needs_usetex</span>
<span class="s0">def </span><span class="s1">test_usetex_no_warn(caplog):</span>
    <span class="s1">mpl.rcParams[</span><span class="s4">'font.family'</span><span class="s1">] = </span><span class="s4">'serif'</span>
    <span class="s1">mpl.rcParams[</span><span class="s4">'font.serif'</span><span class="s1">] = </span><span class="s4">'Computer Modern'</span>
    <span class="s1">mpl.rcParams[</span><span class="s4">'text.usetex'</span><span class="s1">] = </span><span class="s0">True</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'input'</span><span class="s1">)</span>
    <span class="s1">ax.legend(title=</span><span class="s4">&quot;My legend&quot;</span><span class="s1">)</span>

    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s4">&quot;Font family ['serif'] not found.&quot; </span><span class="s0">not in </span><span class="s1">caplog.text</span>


<span class="s0">def </span><span class="s1">test_warn_big_data_best_loc():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.canvas.draw()  </span><span class="s2"># So that we can call draw_artist later.</span>
    <span class="s0">for </span><span class="s1">idx </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1000</span><span class="s1">):</span>
        <span class="s1">ax.plot(np.arange(</span><span class="s3">5000</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=idx)</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s4">'legend.loc'</span><span class="s1">: </span><span class="s4">'best'</span><span class="s1">}):</span>
        <span class="s1">legend = ax.legend()</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning) </span><span class="s0">as </span><span class="s1">records:</span>
        <span class="s1">fig.draw_artist(legend)  </span><span class="s2"># Don't bother drawing the lines -- it's slow.</span>
    <span class="s2"># The _find_best_position method of Legend is called twice, duplicating</span>
    <span class="s2"># the warning message.</span>
    <span class="s0">assert </span><span class="s1">len(records) == </span><span class="s3">2</span>
    <span class="s0">for </span><span class="s1">record </span><span class="s0">in </span><span class="s1">records:</span>
        <span class="s0">assert </span><span class="s1">str(record.message) == (</span>
            <span class="s4">'Creating legend with loc=&quot;best&quot; can be slow with large '</span>
            <span class="s4">'amounts of data.'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_no_warn_big_data_when_loc_specified():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">for </span><span class="s1">idx </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1000</span><span class="s1">):</span>
        <span class="s1">ax.plot(np.arange(</span><span class="s3">5000</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=idx)</span>
    <span class="s1">legend = ax.legend(</span><span class="s4">'best'</span><span class="s1">)</span>
    <span class="s1">fig.draw_artist(legend)  </span><span class="s2"># Check that no warning is emitted.</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'label_array'</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">'low'</span><span class="s0">, </span><span class="s4">'high'</span><span class="s1">]</span><span class="s0">,</span>
                                         <span class="s1">(</span><span class="s4">'low'</span><span class="s0">, </span><span class="s4">'high'</span><span class="s1">)</span><span class="s0">,</span>
                                         <span class="s1">np.array([</span><span class="s4">'low'</span><span class="s0">, </span><span class="s4">'high'</span><span class="s1">])])</span>
<span class="s0">def </span><span class="s1">test_plot_multiple_input_multiple_label(label_array):</span>
    <span class="s2"># test ax.plot() with multidimensional input</span>
    <span class="s2"># and multiple labels</span>
    <span class="s1">x = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">y = [[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">label=label_array)</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s1">legend_texts = [entry.get_text() </span><span class="s0">for </span><span class="s1">entry </span><span class="s0">in </span><span class="s1">leg.get_texts()]</span>
    <span class="s0">assert </span><span class="s1">legend_texts == [</span><span class="s4">'low'</span><span class="s0">, </span><span class="s4">'high'</span><span class="s1">]</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'label'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'one'</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">int])</span>
<span class="s0">def </span><span class="s1">test_plot_multiple_input_single_label(label):</span>
    <span class="s2"># test ax.plot() with multidimensional input</span>
    <span class="s2"># and single label</span>
    <span class="s1">x = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">y = [[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">label=label)</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s1">legend_texts = [entry.get_text() </span><span class="s0">for </span><span class="s1">entry </span><span class="s0">in </span><span class="s1">leg.get_texts()]</span>
    <span class="s0">assert </span><span class="s1">legend_texts == [str(label)] * </span><span class="s3">2</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'label_array'</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">'low'</span><span class="s0">, </span><span class="s4">'high'</span><span class="s1">]</span><span class="s0">,</span>
                                         <span class="s1">(</span><span class="s4">'low'</span><span class="s0">, </span><span class="s4">'high'</span><span class="s1">)</span><span class="s0">,</span>
                                         <span class="s1">np.array([</span><span class="s4">'low'</span><span class="s0">, </span><span class="s4">'high'</span><span class="s1">])])</span>
<span class="s0">def </span><span class="s1">test_plot_single_input_multiple_label(label_array):</span>
    <span class="s2"># test ax.plot() with 1D array like input</span>
    <span class="s2"># and iterable label</span>
    <span class="s1">x = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">label=label_array)</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s0">assert </span><span class="s1">len(leg.get_texts()) == </span><span class="s3">1</span>
    <span class="s0">assert </span><span class="s1">leg.get_texts()[</span><span class="s3">0</span><span class="s1">].get_text() == str(label_array)</span>


<span class="s0">def </span><span class="s1">test_plot_multiple_label_incorrect_length_exception():</span>
    <span class="s2"># check that exception is raised if multiple labels</span>
    <span class="s2"># are given, but number of on labels != number of lines</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">x = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">y = [[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s3">4</span><span class="s0">, </span><span class="s3">9</span><span class="s1">]]</span>
        <span class="s1">label = [</span><span class="s4">'high'</span><span class="s0">, </span><span class="s4">'low'</span><span class="s0">, </span><span class="s4">'medium'</span><span class="s1">]</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">label=label)</span>


<span class="s0">def </span><span class="s1">test_legend_face_edgecolor():</span>
    <span class="s2"># Smoke test for PolyCollection legend handler with 'face' edgecolor.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.fill_between([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">facecolor=</span><span class="s4">'r'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'face'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'Fill'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>


<span class="s0">def </span><span class="s1">test_legend_text_axes():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'line'</span><span class="s1">)</span>
    <span class="s1">leg = ax.legend()</span>

    <span class="s0">assert </span><span class="s1">leg.axes </span><span class="s0">is </span><span class="s1">ax</span>
    <span class="s0">assert </span><span class="s1">leg.get_texts()[</span><span class="s3">0</span><span class="s1">].axes </span><span class="s0">is </span><span class="s1">ax</span>


<span class="s0">def </span><span class="s1">test_handlerline2d():</span>
    <span class="s2"># Test marker consistency for monolithic Line2D legend handler (#11357).</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.scatter([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">&quot;v&quot;</span><span class="s1">)</span>
    <span class="s1">handles = [mlines.Line2D([</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">&quot;v&quot;</span><span class="s1">)]</span>
    <span class="s1">leg = ax.legend(handles</span><span class="s0">, </span><span class="s1">[</span><span class="s4">&quot;Aardvark&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">numpoints=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">handles[</span><span class="s3">0</span><span class="s1">].get_marker() == leg.legend_handles[</span><span class="s3">0</span><span class="s1">].get_marker()</span>


<span class="s0">def </span><span class="s1">test_subfigure_legend():</span>
    <span class="s2"># Test that legend can be added to subfigure (#20723)</span>
    <span class="s1">subfig = plt.figure().subfigures()</span>
    <span class="s1">ax = subfig.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">&quot;line&quot;</span><span class="s1">)</span>
    <span class="s1">leg = subfig.legend()</span>
    <span class="s0">assert </span><span class="s1">leg.figure </span><span class="s0">is </span><span class="s1">subfig</span>


<span class="s0">def </span><span class="s1">test_setting_alpha_keeps_polycollection_color():</span>
    <span class="s1">pc = plt.fill_between([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'#123456'</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">'label'</span><span class="s1">)</span>
    <span class="s1">patch = plt.legend().get_patches()[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">patch.set_alpha(</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">patch.get_facecolor()[:</span><span class="s3">3</span><span class="s1">] == tuple(pc.get_facecolor()[</span><span class="s3">0</span><span class="s1">][:</span><span class="s3">3</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">patch.get_edgecolor()[:</span><span class="s3">3</span><span class="s1">] == tuple(pc.get_edgecolor()[</span><span class="s3">0</span><span class="s1">][:</span><span class="s3">3</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_legend_markers_from_line2d():</span>
    <span class="s2"># Test that markers can be copied for legend lines (#17960)</span>
    <span class="s1">_markers = [</span><span class="s4">'.'</span><span class="s0">, </span><span class="s4">'*'</span><span class="s0">, </span><span class="s4">'v'</span><span class="s1">]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">lines = [mlines.Line2D([</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ls=</span><span class="s4">'None'</span><span class="s0">, </span><span class="s1">marker=mark)</span>
             <span class="s0">for </span><span class="s1">mark </span><span class="s0">in </span><span class="s1">_markers]</span>
    <span class="s1">labels = [</span><span class="s4">&quot;foo&quot;</span><span class="s0">, </span><span class="s4">&quot;bar&quot;</span><span class="s0">, </span><span class="s4">&quot;xyzzy&quot;</span><span class="s1">]</span>
    <span class="s1">markers = [line.get_marker() </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">lines]</span>
    <span class="s1">legend = ax.legend(lines</span><span class="s0">, </span><span class="s1">labels)</span>

    <span class="s1">new_markers = [line.get_marker() </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">legend.get_lines()]</span>
    <span class="s1">new_labels = [text.get_text() </span><span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">legend.get_texts()]</span>

    <span class="s0">assert </span><span class="s1">markers == new_markers == _markers</span>
    <span class="s0">assert </span><span class="s1">labels == new_labels</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_ncol_ncols(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># Test that both ncol and ncols work</span>
    <span class="s1">strings = [</span><span class="s4">&quot;a&quot;</span><span class="s0">, </span><span class="s4">&quot;b&quot;</span><span class="s0">, </span><span class="s4">&quot;c&quot;</span><span class="s0">, </span><span class="s4">&quot;d&quot;</span><span class="s0">, </span><span class="s4">&quot;e&quot;</span><span class="s0">, </span><span class="s4">&quot;f&quot;</span><span class="s1">]</span>
    <span class="s1">ncols = </span><span class="s3">3</span>
    <span class="s1">fig_test.legend(strings</span><span class="s0">, </span><span class="s1">ncol=ncols)</span>
    <span class="s1">fig_ref.legend(strings</span><span class="s0">, </span><span class="s1">ncols=ncols)</span>
</pre>
</body>
</html>