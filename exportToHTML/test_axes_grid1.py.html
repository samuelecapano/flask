<html>
<head>
<title>test_axes_grid1.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_axes_grid1.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">product</span>
<span class="s0">import </span><span class="s1">platform</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib.ticker </span><span class="s0">as </span><span class="s1">mticker</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">_api</span><span class="s0">, </span><span class="s1">cbook</span>
<span class="s0">from </span><span class="s1">matplotlib.backend_bases </span><span class="s0">import </span><span class="s1">MouseEvent</span>
<span class="s0">from </span><span class="s1">matplotlib.colors </span><span class="s0">import </span><span class="s1">LogNorm</span>
<span class="s0">from </span><span class="s1">matplotlib.transforms </span><span class="s0">import </span><span class="s1">Bbox</span><span class="s0">, </span><span class="s1">TransformedBbox</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">check_figures_equal</span><span class="s0">, </span><span class="s1">image_comparison</span><span class="s0">, </span><span class="s1">remove_ticks_and_titles)</span>

<span class="s0">from </span><span class="s1">mpl_toolkits.axes_grid1 </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">axes_size </span><span class="s0">as </span><span class="s1">Size</span><span class="s0">,</span>
    <span class="s1">host_subplot</span><span class="s0">, </span><span class="s1">make_axes_locatable</span><span class="s0">,</span>
    <span class="s1">Grid</span><span class="s0">, </span><span class="s1">AxesGrid</span><span class="s0">, </span><span class="s1">ImageGrid)</span>
<span class="s0">from </span><span class="s1">mpl_toolkits.axes_grid1.anchored_artists </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">AnchoredSizeBar</span><span class="s0">, </span><span class="s1">AnchoredDirectionArrows)</span>
<span class="s0">from </span><span class="s1">mpl_toolkits.axes_grid1.axes_divider </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">Divider</span><span class="s0">, </span><span class="s1">HBoxDivider</span><span class="s0">, </span><span class="s1">make_axes_area_auto_adjustable</span><span class="s0">, </span><span class="s1">SubplotDivider</span><span class="s0">,</span>
    <span class="s1">VBoxDivider)</span>
<span class="s0">from </span><span class="s1">mpl_toolkits.axes_grid1.axes_rgb </span><span class="s0">import </span><span class="s1">RGBAxes</span>
<span class="s0">from </span><span class="s1">mpl_toolkits.axes_grid1.inset_locator </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">zoomed_inset_axes</span><span class="s0">, </span><span class="s1">mark_inset</span><span class="s0">, </span><span class="s1">inset_axes</span><span class="s0">, </span><span class="s1">BboxConnectorPatch</span><span class="s0">,</span>
    <span class="s1">InsetPosition)</span>
<span class="s0">import </span><span class="s1">mpl_toolkits.axes_grid1.mpl_axes</span>

<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">assert_array_equal</span><span class="s0">, </span><span class="s1">assert_array_almost_equal</span>


<span class="s0">def </span><span class="s1">test_divider_append_axes():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">divider = make_axes_locatable(ax)</span>
    <span class="s1">axs = {</span>
        <span class="s2">&quot;main&quot;</span><span class="s1">: ax</span><span class="s0">,</span>
        <span class="s2">&quot;top&quot;</span><span class="s1">: divider.append_axes(</span><span class="s2">&quot;top&quot;</span><span class="s0">, </span><span class="s3">1.2</span><span class="s0">, </span><span class="s1">pad=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">sharex=ax)</span><span class="s0">,</span>
        <span class="s2">&quot;bottom&quot;</span><span class="s1">: divider.append_axes(</span><span class="s2">&quot;bottom&quot;</span><span class="s0">, </span><span class="s3">1.2</span><span class="s0">, </span><span class="s1">pad=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">sharex=ax)</span><span class="s0">,</span>
        <span class="s2">&quot;left&quot;</span><span class="s1">: divider.append_axes(</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s3">1.2</span><span class="s0">, </span><span class="s1">pad=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">sharey=ax)</span><span class="s0">,</span>
        <span class="s2">&quot;right&quot;</span><span class="s1">: divider.append_axes(</span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s3">1.2</span><span class="s0">, </span><span class="s1">pad=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">sharey=ax)</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">bboxes = {k: axs[k].get_window_extent() </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">axs}</span>
    <span class="s1">dpi = fig.dpi</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;top&quot;</span><span class="s1">].height == pytest.approx(</span><span class="s3">1.2 </span><span class="s1">* dpi)</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;bottom&quot;</span><span class="s1">].height == pytest.approx(</span><span class="s3">1.2 </span><span class="s1">* dpi)</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;left&quot;</span><span class="s1">].width == pytest.approx(</span><span class="s3">1.2 </span><span class="s1">* dpi)</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;right&quot;</span><span class="s1">].width == pytest.approx(</span><span class="s3">1.2 </span><span class="s1">* dpi)</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;top&quot;</span><span class="s1">].y0 - bboxes[</span><span class="s2">&quot;main&quot;</span><span class="s1">].y1 == pytest.approx(</span><span class="s3">0.1 </span><span class="s1">* dpi)</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;main&quot;</span><span class="s1">].y0 - bboxes[</span><span class="s2">&quot;bottom&quot;</span><span class="s1">].y1 == pytest.approx(</span><span class="s3">0.1 </span><span class="s1">* dpi)</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;main&quot;</span><span class="s1">].x0 - bboxes[</span><span class="s2">&quot;left&quot;</span><span class="s1">].x1 == pytest.approx(</span><span class="s3">0.1 </span><span class="s1">* dpi)</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;right&quot;</span><span class="s1">].x0 - bboxes[</span><span class="s2">&quot;main&quot;</span><span class="s1">].x1 == pytest.approx(</span><span class="s3">0.1 </span><span class="s1">* dpi)</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;left&quot;</span><span class="s1">].y0 == bboxes[</span><span class="s2">&quot;main&quot;</span><span class="s1">].y0 == bboxes[</span><span class="s2">&quot;right&quot;</span><span class="s1">].y0</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;left&quot;</span><span class="s1">].y1 == bboxes[</span><span class="s2">&quot;main&quot;</span><span class="s1">].y1 == bboxes[</span><span class="s2">&quot;right&quot;</span><span class="s1">].y1</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;top&quot;</span><span class="s1">].x0 == bboxes[</span><span class="s2">&quot;main&quot;</span><span class="s1">].x0 == bboxes[</span><span class="s2">&quot;bottom&quot;</span><span class="s1">].x0</span>
    <span class="s0">assert </span><span class="s1">bboxes[</span><span class="s2">&quot;top&quot;</span><span class="s1">].x1 == bboxes[</span><span class="s2">&quot;main&quot;</span><span class="s1">].x1 == bboxes[</span><span class="s2">&quot;bottom&quot;</span><span class="s1">].x1</span>


<span class="s4"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s2">'twin_axes_empty_and_removed'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s3">1</span><span class="s0">,</span>
                  <span class="s1">style=(</span><span class="s2">'classic'</span><span class="s0">, </span><span class="s2">'_classic_test_patch'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_twin_axes_empty_and_removed():</span>
    <span class="s4"># Purely cosmetic font changes (avoid overlap)</span>
    <span class="s1">mpl.rcParams.update(</span>
        <span class="s1">{</span><span class="s2">&quot;font.size&quot;</span><span class="s1">: </span><span class="s3">8</span><span class="s0">, </span><span class="s2">&quot;xtick.labelsize&quot;</span><span class="s1">: </span><span class="s3">8</span><span class="s0">, </span><span class="s2">&quot;ytick.labelsize&quot;</span><span class="s1">: </span><span class="s3">8</span><span class="s1">})</span>
    <span class="s1">generators = [</span><span class="s2">&quot;twinx&quot;</span><span class="s0">, </span><span class="s2">&quot;twiny&quot;</span><span class="s0">, </span><span class="s2">&quot;twin&quot;</span><span class="s1">]</span>
    <span class="s1">modifiers = [</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;host invisible&quot;</span><span class="s0">, </span><span class="s2">&quot;twin removed&quot;</span><span class="s0">, </span><span class="s2">&quot;twin invisible&quot;</span><span class="s0">,</span>
                 <span class="s2">&quot;twin removed</span><span class="s0">\n</span><span class="s2">host invisible&quot;</span><span class="s1">]</span>
    <span class="s4"># Unmodified host subplot at the beginning for reference</span>
    <span class="s1">h = host_subplot(len(modifiers)+</span><span class="s3">1</span><span class="s0">, </span><span class="s1">len(generators)</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">h.text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;host_subplot&quot;</span><span class="s0">,</span>
           <span class="s1">horizontalalignment=</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s1">verticalalignment=</span><span class="s2">&quot;center&quot;</span><span class="s1">)</span>
    <span class="s4"># Host subplots with various modifications (twin*, visibility) applied</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">(mod</span><span class="s0">, </span><span class="s1">gen) </span><span class="s0">in </span><span class="s1">enumerate(product(modifiers</span><span class="s0">, </span><span class="s1">generators)</span><span class="s0">,</span>
                                   <span class="s1">len(generators) + </span><span class="s3">1</span><span class="s1">):</span>
        <span class="s1">h = host_subplot(len(modifiers)+</span><span class="s3">1</span><span class="s0">, </span><span class="s1">len(generators)</span><span class="s0">, </span><span class="s1">i)</span>
        <span class="s1">t = getattr(h</span><span class="s0">, </span><span class="s1">gen)()</span>
        <span class="s0">if </span><span class="s2">&quot;twin invisible&quot; </span><span class="s0">in </span><span class="s1">mod:</span>
            <span class="s1">t.axis[:].set_visible(</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s2">&quot;twin removed&quot; </span><span class="s0">in </span><span class="s1">mod:</span>
            <span class="s1">t.remove()</span>
        <span class="s0">if </span><span class="s2">&quot;host invisible&quot; </span><span class="s0">in </span><span class="s1">mod:</span>
            <span class="s1">h.axis[:].set_visible(</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">h.text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">gen + (</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot; </span><span class="s1">+ mod </span><span class="s0">if </span><span class="s1">mod </span><span class="s0">else </span><span class="s2">&quot;&quot;</span><span class="s1">)</span><span class="s0">,</span>
               <span class="s1">horizontalalignment=</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s1">verticalalignment=</span><span class="s2">&quot;center&quot;</span><span class="s1">)</span>
    <span class="s1">plt.subplots_adjust(wspace=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">hspace=</span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_axesgrid_colorbar_log_smoketest():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">grid = AxesGrid(fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">,  </span><span class="s4"># modified to be only subplot</span>
                    <span class="s1">nrows_ncols=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                    <span class="s1">ngrids=</span><span class="s3">1</span><span class="s0">,</span>
                    <span class="s1">label_mode=</span><span class="s2">&quot;L&quot;</span><span class="s0">,</span>
                    <span class="s1">cbar_location=</span><span class="s2">&quot;top&quot;</span><span class="s0">,</span>
                    <span class="s1">cbar_mode=</span><span class="s2">&quot;single&quot;</span><span class="s0">,</span>
                    <span class="s1">)</span>

    <span class="s1">Z = </span><span class="s3">10000 </span><span class="s1">* np.random.rand(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">im = grid[</span><span class="s3">0</span><span class="s1">].imshow(Z</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">&quot;nearest&quot;</span><span class="s0">, </span><span class="s1">norm=LogNorm())</span>

    <span class="s1">grid.cbar_axes[</span><span class="s3">0</span><span class="s1">].colorbar(im)</span>


<span class="s0">def </span><span class="s1">test_inset_colorbar_tight_layout_smoketest():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">pts = ax.scatter([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span>

    <span class="s1">cax = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s2">&quot;3%&quot;</span><span class="s0">, </span><span class="s1">height=</span><span class="s2">&quot;70%&quot;</span><span class="s1">)</span>
    <span class="s1">plt.colorbar(pts</span><span class="s0">, </span><span class="s1">cax=cax)</span>

    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;This figure includes Axes&quot;</span><span class="s1">):</span>
        <span class="s4"># Will warn, but not raise an error</span>
        <span class="s1">plt.tight_layout()</span>


<span class="s1">@image_comparison([</span><span class="s2">'inset_locator.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'default'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_inset_locator():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=[</span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>

    <span class="s4"># prepare the demo image</span>
    <span class="s4"># Z is a 15x15 array</span>
    <span class="s1">Z = cbook.get_sample_data(</span><span class="s2">&quot;axes_grid/bivariate_normal.npy&quot;</span><span class="s0">, </span><span class="s1">np_load=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">extent = (-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">Z2 = np.zeros((</span><span class="s3">150</span><span class="s0">, </span><span class="s3">150</span><span class="s1">))</span>
    <span class="s1">ny</span><span class="s0">, </span><span class="s1">nx = Z.shape</span>
    <span class="s1">Z2[</span><span class="s3">30</span><span class="s1">:</span><span class="s3">30</span><span class="s1">+ny</span><span class="s0">, </span><span class="s3">30</span><span class="s1">:</span><span class="s3">30</span><span class="s1">+nx] = Z</span>

    <span class="s1">ax.imshow(Z2</span><span class="s0">, </span><span class="s1">extent=extent</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">&quot;nearest&quot;</span><span class="s0">,</span>
              <span class="s1">origin=</span><span class="s2">&quot;lower&quot;</span><span class="s1">)</span>

    <span class="s1">axins = zoomed_inset_axes(ax</span><span class="s0">, </span><span class="s1">zoom=</span><span class="s3">6</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'upper right'</span><span class="s1">)</span>
    <span class="s1">axins.imshow(Z2</span><span class="s0">, </span><span class="s1">extent=extent</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">&quot;nearest&quot;</span><span class="s0">,</span>
                 <span class="s1">origin=</span><span class="s2">&quot;lower&quot;</span><span class="s1">)</span>
    <span class="s1">axins.yaxis.get_major_locator().set_params(nbins=</span><span class="s3">7</span><span class="s1">)</span>
    <span class="s1">axins.xaxis.get_major_locator().set_params(nbins=</span><span class="s3">7</span><span class="s1">)</span>
    <span class="s4"># sub region of the original image</span>
    <span class="s1">x1</span><span class="s0">, </span><span class="s1">x2</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2 = -</span><span class="s3">1.5</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2.5</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.9</span>
    <span class="s1">axins.set_xlim(x1</span><span class="s0">, </span><span class="s1">x2)</span>
    <span class="s1">axins.set_ylim(y1</span><span class="s0">, </span><span class="s1">y2)</span>

    <span class="s1">plt.xticks(visible=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">plt.yticks(visible=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s4"># draw a bbox of the region of the inset axes in the parent axes and</span>
    <span class="s4"># connecting lines between the bbox and the inset axes area</span>
    <span class="s1">mark_inset(ax</span><span class="s0">, </span><span class="s1">axins</span><span class="s0">, </span><span class="s1">loc1=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc2=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">fc=</span><span class="s2">&quot;none&quot;</span><span class="s0">, </span><span class="s1">ec=</span><span class="s2">&quot;0.5&quot;</span><span class="s1">)</span>

    <span class="s1">asb = AnchoredSizeBar(ax.transData</span><span class="s0">,</span>
                          <span class="s3">0.5</span><span class="s0">,</span>
                          <span class="s2">'0.5'</span><span class="s0">,</span>
                          <span class="s1">loc=</span><span class="s2">'lower center'</span><span class="s0">,</span>
                          <span class="s1">pad=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">borderpad=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">sep=</span><span class="s3">5</span><span class="s0">,</span>
                          <span class="s1">frameon=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.add_artist(asb)</span>


<span class="s1">@image_comparison([</span><span class="s2">'inset_axes.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'default'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_inset_axes():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=[</span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s1">])</span>

    <span class="s4"># prepare the demo image</span>
    <span class="s4"># Z is a 15x15 array</span>
    <span class="s1">Z = cbook.get_sample_data(</span><span class="s2">&quot;axes_grid/bivariate_normal.npy&quot;</span><span class="s0">, </span><span class="s1">np_load=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">extent = (-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">Z2 = np.zeros((</span><span class="s3">150</span><span class="s0">, </span><span class="s3">150</span><span class="s1">))</span>
    <span class="s1">ny</span><span class="s0">, </span><span class="s1">nx = Z.shape</span>
    <span class="s1">Z2[</span><span class="s3">30</span><span class="s1">:</span><span class="s3">30</span><span class="s1">+ny</span><span class="s0">, </span><span class="s3">30</span><span class="s1">:</span><span class="s3">30</span><span class="s1">+nx] = Z</span>

    <span class="s1">ax.imshow(Z2</span><span class="s0">, </span><span class="s1">extent=extent</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">&quot;nearest&quot;</span><span class="s0">,</span>
              <span class="s1">origin=</span><span class="s2">&quot;lower&quot;</span><span class="s1">)</span>

    <span class="s4"># creating our inset axes with a bbox_transform parameter</span>
    <span class="s1">axins = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">bbox_to_anchor=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                       <span class="s1">bbox_transform=ax.transAxes)</span>

    <span class="s1">axins.imshow(Z2</span><span class="s0">, </span><span class="s1">extent=extent</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">&quot;nearest&quot;</span><span class="s0">,</span>
                 <span class="s1">origin=</span><span class="s2">&quot;lower&quot;</span><span class="s1">)</span>
    <span class="s1">axins.yaxis.get_major_locator().set_params(nbins=</span><span class="s3">7</span><span class="s1">)</span>
    <span class="s1">axins.xaxis.get_major_locator().set_params(nbins=</span><span class="s3">7</span><span class="s1">)</span>
    <span class="s4"># sub region of the original image</span>
    <span class="s1">x1</span><span class="s0">, </span><span class="s1">x2</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2 = -</span><span class="s3">1.5</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9</span><span class="s0">, </span><span class="s1">-</span><span class="s3">2.5</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1.9</span>
    <span class="s1">axins.set_xlim(x1</span><span class="s0">, </span><span class="s1">x2)</span>
    <span class="s1">axins.set_ylim(y1</span><span class="s0">, </span><span class="s1">y2)</span>

    <span class="s1">plt.xticks(visible=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">plt.yticks(visible=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s4"># draw a bbox of the region of the inset axes in the parent axes and</span>
    <span class="s4"># connecting lines between the bbox and the inset axes area</span>
    <span class="s1">mark_inset(ax</span><span class="s0">, </span><span class="s1">axins</span><span class="s0">, </span><span class="s1">loc1=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc2=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">fc=</span><span class="s2">&quot;none&quot;</span><span class="s0">, </span><span class="s1">ec=</span><span class="s2">&quot;0.5&quot;</span><span class="s1">)</span>

    <span class="s1">asb = AnchoredSizeBar(ax.transData</span><span class="s0">,</span>
                          <span class="s3">0.5</span><span class="s0">,</span>
                          <span class="s2">'0.5'</span><span class="s0">,</span>
                          <span class="s1">loc=</span><span class="s2">'lower center'</span><span class="s0">,</span>
                          <span class="s1">pad=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">borderpad=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">sep=</span><span class="s3">5</span><span class="s0">,</span>
                          <span class="s1">frameon=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.add_artist(asb)</span>


<span class="s0">def </span><span class="s1">test_inset_axes_complete():</span>
    <span class="s1">dpi = </span><span class="s3">100</span>
    <span class="s1">figsize = (</span><span class="s3">6</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=figsize</span><span class="s0">, </span><span class="s1">dpi=dpi)</span>
    <span class="s1">fig.subplots_adjust(</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">.1</span><span class="s0">, </span><span class="s3">.9</span><span class="s0">, </span><span class="s3">.9</span><span class="s1">)</span>

    <span class="s1">ins = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">2.</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">2.</span><span class="s0">, </span><span class="s1">borderpad=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">assert_array_almost_equal(</span>
        <span class="s1">ins.get_position().extents</span><span class="s0">,</span>
        <span class="s1">[(</span><span class="s3">0.9</span><span class="s1">*figsize[</span><span class="s3">0</span><span class="s1">]-</span><span class="s3">2.</span><span class="s1">)/figsize[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.9</span><span class="s1">*figsize[</span><span class="s3">1</span><span class="s1">]-</span><span class="s3">2.</span><span class="s1">)/figsize[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">])</span>

    <span class="s1">ins = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s2">&quot;40%&quot;</span><span class="s0">, </span><span class="s1">height=</span><span class="s2">&quot;30%&quot;</span><span class="s0">, </span><span class="s1">borderpad=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">assert_array_almost_equal(</span>
        <span class="s1">ins.get_position().extents</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.9</span><span class="s1">-</span><span class="s3">.8</span><span class="s1">*</span><span class="s3">.4</span><span class="s0">, </span><span class="s3">.9</span><span class="s1">-</span><span class="s3">.8</span><span class="s1">*</span><span class="s3">.3</span><span class="s0">, </span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">])</span>

    <span class="s1">ins = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">1.</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">1.2</span><span class="s0">, </span><span class="s1">bbox_to_anchor=(</span><span class="s3">200</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">loc=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">borderpad=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">assert_array_almost_equal(</span>
        <span class="s1">ins.get_position().extents</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s3">200</span><span class="s1">/dpi/figsize[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">100</span><span class="s1">/dpi/figsize[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s3">200</span><span class="s1">/dpi+</span><span class="s3">1</span><span class="s1">)/figsize[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(</span><span class="s3">100</span><span class="s1">/dpi+</span><span class="s3">1.2</span><span class="s1">)/figsize[</span><span class="s3">1</span><span class="s1">]])</span>

    <span class="s1">ins1 = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s2">&quot;35%&quot;</span><span class="s0">, </span><span class="s1">height=</span><span class="s2">&quot;60%&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">borderpad=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ins2 = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s2">&quot;100%&quot;</span><span class="s0">, </span><span class="s1">height=</span><span class="s2">&quot;100%&quot;</span><span class="s0">,</span>
                      <span class="s1">bbox_to_anchor=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">.35</span><span class="s0">, </span><span class="s3">.60</span><span class="s1">)</span><span class="s0">,</span>
                      <span class="s1">bbox_transform=ax.transAxes</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">borderpad=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">assert_array_equal(ins1.get_position().extents</span><span class="s0">,</span>
                       <span class="s1">ins2.get_position().extents)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ins = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s2">&quot;40%&quot;</span><span class="s0">, </span><span class="s1">height=</span><span class="s2">&quot;30%&quot;</span><span class="s0">,</span>
                         <span class="s1">bbox_to_anchor=(</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">))</span>

    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning):</span>
        <span class="s1">ins = inset_axes(ax</span><span class="s0">, </span><span class="s1">width=</span><span class="s2">&quot;40%&quot;</span><span class="s0">, </span><span class="s1">height=</span><span class="s2">&quot;30%&quot;</span><span class="s0">,</span>
                         <span class="s1">bbox_transform=ax.transAxes)</span>


<span class="s1">@image_comparison([</span><span class="s2">'fill_facecolor.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fill_facecolor():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">fig.set_size_inches(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">):</span>
        <span class="s1">ax[i].yaxis.set_visible(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s3">4</span><span class="s1">].yaxis.tick_right()</span>
    <span class="s1">bbox = Bbox.from_extents(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.6</span><span class="s1">)</span>

    <span class="s4"># fill with blue by setting 'fc' field</span>
    <span class="s1">bbox1 = TransformedBbox(bbox</span><span class="s0">, </span><span class="s1">ax[</span><span class="s3">0</span><span class="s1">].transData)</span>
    <span class="s1">bbox2 = TransformedBbox(bbox</span><span class="s0">, </span><span class="s1">ax[</span><span class="s3">1</span><span class="s1">].transData)</span>
    <span class="s4"># set color to BboxConnectorPatch</span>
    <span class="s1">p = BboxConnectorPatch(</span>
        <span class="s1">bbox1</span><span class="s0">, </span><span class="s1">bbox2</span><span class="s0">, </span><span class="s1">loc1a=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc2a=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc1b=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">loc2b=</span><span class="s3">3</span><span class="s0">,</span>
        <span class="s1">ec=</span><span class="s2">&quot;r&quot;</span><span class="s0">, </span><span class="s1">fc=</span><span class="s2">&quot;b&quot;</span><span class="s1">)</span>
    <span class="s1">p.set_clip_on(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s3">0</span><span class="s1">].add_patch(p)</span>
    <span class="s4"># set color to marked area</span>
    <span class="s1">axins = zoomed_inset_axes(ax[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'upper right'</span><span class="s1">)</span>
    <span class="s1">axins.set_xlim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">axins.set_ylim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">plt.gca().axes.xaxis.set_ticks([])</span>
    <span class="s1">plt.gca().axes.yaxis.set_ticks([])</span>
    <span class="s1">mark_inset(ax[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axins</span><span class="s0">, </span><span class="s1">loc1=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc2=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">fc=</span><span class="s2">&quot;b&quot;</span><span class="s0">, </span><span class="s1">ec=</span><span class="s2">&quot;0.5&quot;</span><span class="s1">)</span>

    <span class="s4"># fill with yellow by setting 'facecolor' field</span>
    <span class="s1">bbox3 = TransformedBbox(bbox</span><span class="s0">, </span><span class="s1">ax[</span><span class="s3">1</span><span class="s1">].transData)</span>
    <span class="s1">bbox4 = TransformedBbox(bbox</span><span class="s0">, </span><span class="s1">ax[</span><span class="s3">2</span><span class="s1">].transData)</span>
    <span class="s4"># set color to BboxConnectorPatch</span>
    <span class="s1">p = BboxConnectorPatch(</span>
        <span class="s1">bbox3</span><span class="s0">, </span><span class="s1">bbox4</span><span class="s0">, </span><span class="s1">loc1a=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc2a=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc1b=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">loc2b=</span><span class="s3">3</span><span class="s0">,</span>
        <span class="s1">ec=</span><span class="s2">&quot;r&quot;</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s2">&quot;y&quot;</span><span class="s1">)</span>
    <span class="s1">p.set_clip_on(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s3">1</span><span class="s1">].add_patch(p)</span>
    <span class="s4"># set color to marked area</span>
    <span class="s1">axins = zoomed_inset_axes(ax[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'upper right'</span><span class="s1">)</span>
    <span class="s1">axins.set_xlim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">axins.set_ylim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">plt.gca().axes.xaxis.set_ticks([])</span>
    <span class="s1">plt.gca().axes.yaxis.set_ticks([])</span>
    <span class="s1">mark_inset(ax[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axins</span><span class="s0">, </span><span class="s1">loc1=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc2=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s2">&quot;y&quot;</span><span class="s0">, </span><span class="s1">ec=</span><span class="s2">&quot;0.5&quot;</span><span class="s1">)</span>

    <span class="s4"># fill with green by setting 'color' field</span>
    <span class="s1">bbox5 = TransformedBbox(bbox</span><span class="s0">, </span><span class="s1">ax[</span><span class="s3">2</span><span class="s1">].transData)</span>
    <span class="s1">bbox6 = TransformedBbox(bbox</span><span class="s0">, </span><span class="s1">ax[</span><span class="s3">3</span><span class="s1">].transData)</span>
    <span class="s4"># set color to BboxConnectorPatch</span>
    <span class="s1">p = BboxConnectorPatch(</span>
        <span class="s1">bbox5</span><span class="s0">, </span><span class="s1">bbox6</span><span class="s0">, </span><span class="s1">loc1a=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc2a=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc1b=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">loc2b=</span><span class="s3">3</span><span class="s0">,</span>
        <span class="s1">ec=</span><span class="s2">&quot;r&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">&quot;g&quot;</span><span class="s1">)</span>
    <span class="s1">p.set_clip_on(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s3">2</span><span class="s1">].add_patch(p)</span>
    <span class="s4"># set color to marked area</span>
    <span class="s1">axins = zoomed_inset_axes(ax[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'upper right'</span><span class="s1">)</span>
    <span class="s1">axins.set_xlim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">axins.set_ylim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">plt.gca().axes.xaxis.set_ticks([])</span>
    <span class="s1">plt.gca().axes.yaxis.set_ticks([])</span>
    <span class="s1">mark_inset(ax[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axins</span><span class="s0">, </span><span class="s1">loc1=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc2=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">&quot;g&quot;</span><span class="s0">, </span><span class="s1">ec=</span><span class="s2">&quot;0.5&quot;</span><span class="s1">)</span>

    <span class="s4"># fill with green but color won't show if set fill to False</span>
    <span class="s1">bbox7 = TransformedBbox(bbox</span><span class="s0">, </span><span class="s1">ax[</span><span class="s3">3</span><span class="s1">].transData)</span>
    <span class="s1">bbox8 = TransformedBbox(bbox</span><span class="s0">, </span><span class="s1">ax[</span><span class="s3">4</span><span class="s1">].transData)</span>
    <span class="s4"># BboxConnectorPatch won't show green</span>
    <span class="s1">p = BboxConnectorPatch(</span>
        <span class="s1">bbox7</span><span class="s0">, </span><span class="s1">bbox8</span><span class="s0">, </span><span class="s1">loc1a=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc2a=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc1b=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">loc2b=</span><span class="s3">3</span><span class="s0">,</span>
        <span class="s1">ec=</span><span class="s2">&quot;r&quot;</span><span class="s0">, </span><span class="s1">fc=</span><span class="s2">&quot;g&quot;</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">p.set_clip_on(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s3">3</span><span class="s1">].add_patch(p)</span>
    <span class="s4"># marked area won't show green</span>
    <span class="s1">axins = zoomed_inset_axes(ax[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'upper right'</span><span class="s1">)</span>
    <span class="s1">axins.set_xlim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">axins.set_ylim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">axins.xaxis.set_ticks([])</span>
    <span class="s1">axins.yaxis.set_ticks([])</span>
    <span class="s1">mark_inset(ax[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axins</span><span class="s0">, </span><span class="s1">loc1=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc2=</span><span class="s3">4</span><span class="s0">, </span><span class="s1">fc=</span><span class="s2">&quot;g&quot;</span><span class="s0">, </span><span class="s1">ec=</span><span class="s2">&quot;0.5&quot;</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s4"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s2">'zoomed_axes.png'</span><span class="s0">, </span><span class="s2">'inverted_zoomed_axes.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">style=(</span><span class="s2">'classic'</span><span class="s0">, </span><span class="s2">'_classic_test_patch'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_zooming_with_inverted_axes():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">ax.axis([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">inset_ax = zoomed_inset_axes(ax</span><span class="s0">, </span><span class="s1">zoom=</span><span class="s3">2.5</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'lower right'</span><span class="s1">)</span>
    <span class="s1">inset_ax.axis([</span><span class="s3">1.1</span><span class="s0">, </span><span class="s3">1.4</span><span class="s0">, </span><span class="s3">1.1</span><span class="s0">, </span><span class="s3">1.4</span><span class="s1">])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">ax.axis([</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">inset_ax = zoomed_inset_axes(ax</span><span class="s0">, </span><span class="s1">zoom=</span><span class="s3">2.5</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'lower right'</span><span class="s1">)</span>
    <span class="s1">inset_ax.axis([</span><span class="s3">1.4</span><span class="s0">, </span><span class="s3">1.1</span><span class="s0">, </span><span class="s3">1.4</span><span class="s0">, </span><span class="s3">1.1</span><span class="s1">])</span>


<span class="s4"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s2">'anchored_direction_arrows.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s3">0 </span><span class="s0">if </span><span class="s1">platform.machine() == </span><span class="s2">'x86_64' </span><span class="s0">else </span><span class="s3">0.01</span><span class="s0">,</span>
                  <span class="s1">style=(</span><span class="s2">'classic'</span><span class="s0">, </span><span class="s2">'_classic_test_patch'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_anchored_direction_arrows():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.imshow(np.zeros((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">'nearest'</span><span class="s1">)</span>

    <span class="s1">simple_arrow = AnchoredDirectionArrows(ax.transAxes</span><span class="s0">, </span><span class="s2">'X'</span><span class="s0">, </span><span class="s2">'Y'</span><span class="s1">)</span>
    <span class="s1">ax.add_artist(simple_arrow)</span>


<span class="s4"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s2">'anchored_direction_arrows_many_args.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">style=(</span><span class="s2">'classic'</span><span class="s0">, </span><span class="s2">'_classic_test_patch'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_anchored_direction_arrows_many_args():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.imshow(np.ones((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)))</span>

    <span class="s1">direction_arrows = AnchoredDirectionArrows(</span>
            <span class="s1">ax.transAxes</span><span class="s0">, </span><span class="s2">'A'</span><span class="s0">, </span><span class="s2">'B'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'upper right'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'red'</span><span class="s0">,</span>
            <span class="s1">aspect_ratio=-</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">pad=</span><span class="s3">0.6</span><span class="s0">, </span><span class="s1">borderpad=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">frameon=</span><span class="s0">True, </span><span class="s1">alpha=</span><span class="s3">0.7</span><span class="s0">,</span>
            <span class="s1">sep_x=-</span><span class="s3">0.06</span><span class="s0">, </span><span class="s1">sep_y=-</span><span class="s3">0.08</span><span class="s0">, </span><span class="s1">back_length=</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">head_width=</span><span class="s3">9</span><span class="s0">,</span>
            <span class="s1">head_length=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">tail_width=</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">ax.add_artist(direction_arrows)</span>


<span class="s0">def </span><span class="s1">test_axes_locatable_position():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">divider = make_axes_locatable(ax)</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context({</span><span class="s2">&quot;figure.subplot.wspace&quot;</span><span class="s1">: </span><span class="s3">0.02</span><span class="s1">}):</span>
        <span class="s1">cax = divider.append_axes(</span><span class="s2">'right'</span><span class="s0">, </span><span class="s1">size=</span><span class="s2">'5%'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">np.isclose(cax.get_position(original=</span><span class="s0">False</span><span class="s1">).width</span><span class="s0">,</span>
                      <span class="s3">0.03621495327102808</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'image_grid_each_left_label_mode_all.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s2">'bbox_inches'</span><span class="s1">: </span><span class="s2">'tight'</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_image_grid_each_left_label_mode_all():</span>
    <span class="s1">imdata = np.arange(</span><span class="s3">100</span><span class="s1">).reshape((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>

    <span class="s1">fig = plt.figure(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
    <span class="s1">grid = ImageGrid(fig</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">nrows_ncols=(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axes_pad=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">cbar_mode=</span><span class="s2">&quot;each&quot;</span><span class="s0">, </span><span class="s1">cbar_location=</span><span class="s2">&quot;left&quot;</span><span class="s0">, </span><span class="s1">cbar_size=</span><span class="s2">&quot;15%&quot;</span><span class="s0">,</span>
                     <span class="s1">label_mode=</span><span class="s2">&quot;all&quot;</span><span class="s1">)</span>
    <span class="s4"># 3-tuple rect =&gt; SubplotDivider</span>
    <span class="s0">assert </span><span class="s1">isinstance(grid.get_divider()</span><span class="s0">, </span><span class="s1">SubplotDivider)</span>
    <span class="s0">assert </span><span class="s1">grid.get_axes_pad() == (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">grid.get_aspect()  </span><span class="s4"># True by default for ImageGrid</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">cax </span><span class="s0">in </span><span class="s1">zip(grid</span><span class="s0">, </span><span class="s1">grid.cbar_axes):</span>
        <span class="s1">im = ax.imshow(imdata</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">'none'</span><span class="s1">)</span>
        <span class="s1">cax.colorbar(im)</span>


<span class="s1">@image_comparison([</span><span class="s2">'image_grid_single_bottom_label_mode_1.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s2">'bbox_inches'</span><span class="s1">: </span><span class="s2">'tight'</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_image_grid_single_bottom():</span>
    <span class="s1">imdata = np.arange(</span><span class="s3">100</span><span class="s1">).reshape((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>

    <span class="s1">fig = plt.figure(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2.5</span><span class="s0">, </span><span class="s3">1.5</span><span class="s1">))</span>
    <span class="s1">grid = ImageGrid(fig</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">nrows_ncols=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">axes_pad=(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">cbar_mode=</span><span class="s2">&quot;single&quot;</span><span class="s0">,</span>
                     <span class="s1">cbar_location=</span><span class="s2">&quot;bottom&quot;</span><span class="s0">, </span><span class="s1">cbar_size=</span><span class="s2">&quot;10%&quot;</span><span class="s0">, </span><span class="s1">label_mode=</span><span class="s2">&quot;1&quot;</span><span class="s1">)</span>
    <span class="s4"># 4-tuple rect =&gt; Divider, isinstance will give True for SubplotDivider</span>
    <span class="s0">assert </span><span class="s1">type(grid.get_divider()) </span><span class="s0">is </span><span class="s1">Divider</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">):</span>
        <span class="s1">im = grid[i].imshow(imdata</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">'none'</span><span class="s1">)</span>
    <span class="s1">grid.cbar_axes[</span><span class="s3">0</span><span class="s1">].colorbar(im)</span>


<span class="s0">def </span><span class="s1">test_image_grid_label_mode_deprecation_warning():</span>
    <span class="s1">imdata = np.arange(</span><span class="s3">9</span><span class="s1">).reshape((</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">&quot;Passing an undefined label_mode&quot;</span><span class="s1">):</span>
        <span class="s1">grid = ImageGrid(fig</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label_mode=</span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'image_grid.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s2">'bbox_inches'</span><span class="s1">: </span><span class="s2">'tight'</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_image_grid():</span>
    <span class="s4"># test that image grid works with bbox_inches=tight.</span>
    <span class="s1">im = np.arange(</span><span class="s3">100</span><span class="s1">).reshape((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>

    <span class="s1">fig = plt.figure(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>
    <span class="s1">grid = ImageGrid(fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">, </span><span class="s1">nrows_ncols=(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axes_pad=</span><span class="s3">0.1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">grid.get_axes_pad() == (</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">4</span><span class="s1">):</span>
        <span class="s1">grid[i].imshow(im</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">'nearest'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_gettightbbox():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s3">8</span><span class="s0">, </span><span class="s3">6</span><span class="s1">))</span>

    <span class="s1">l</span><span class="s0">, </span><span class="s1">= ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>

    <span class="s1">ax_zoom = zoomed_inset_axes(ax</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">ax_zoom.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>

    <span class="s1">mark_inset(ax</span><span class="s0">, </span><span class="s1">ax_zoom</span><span class="s0">, </span><span class="s1">loc1=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">loc2=</span><span class="s3">3</span><span class="s0">, </span><span class="s1">fc=</span><span class="s2">&quot;none&quot;</span><span class="s0">, </span><span class="s1">ec=</span><span class="s2">'0.3'</span><span class="s1">)</span>

    <span class="s1">remove_ticks_and_titles(fig)</span>
    <span class="s1">bbox = fig.get_tightbbox(fig.canvas.get_renderer())</span>
    <span class="s1">np.testing.assert_array_almost_equal(bbox.extents</span><span class="s0">,</span>
                                         <span class="s1">[-</span><span class="s3">17.7</span><span class="s0">, </span><span class="s1">-</span><span class="s3">13.9</span><span class="s0">, </span><span class="s3">7.2</span><span class="s0">, </span><span class="s3">5.4</span><span class="s1">])</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;click_on&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;big&quot;</span><span class="s0">, </span><span class="s2">&quot;small&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;big_on_axes,small_on_axes&quot;</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s2">&quot;gca&quot;</span><span class="s0">, </span><span class="s2">&quot;gca&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">&quot;host&quot;</span><span class="s0">, </span><span class="s2">&quot;host&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">&quot;host&quot;</span><span class="s0">, </span><span class="s2">&quot;parasite&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">&quot;parasite&quot;</span><span class="s0">, </span><span class="s2">&quot;host&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">&quot;parasite&quot;</span><span class="s0">, </span><span class="s2">&quot;parasite&quot;</span><span class="s1">)</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_picking_callbacks_overlap(big_on_axes</span><span class="s0">, </span><span class="s1">small_on_axes</span><span class="s0">, </span><span class="s1">click_on):</span>
    <span class="s5">&quot;&quot;&quot;Test pick events on normal, host or parasite axes.&quot;&quot;&quot;</span>
    <span class="s4"># Two rectangles are drawn and &quot;clicked on&quot;, a small one and a big one</span>
    <span class="s4"># enclosing the small one. The axis on which they are drawn as well as the</span>
    <span class="s4"># rectangle that is clicked on are varied.</span>
    <span class="s4"># In each case we expect that both rectangles are picked if we click on the</span>
    <span class="s4"># small one and only the big one is picked if we click on the big one.</span>
    <span class="s4"># Also tests picking on normal axes (&quot;gca&quot;) as a control.</span>
    <span class="s1">big = plt.Rectangle((</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">picker=</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">small = plt.Rectangle((</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s2">&quot;r&quot;</span><span class="s0">, </span><span class="s1">picker=</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s4"># Machinery for &quot;receiving&quot; events</span>
    <span class="s1">received_events = []</span>
    <span class="s0">def </span><span class="s1">on_pick(event):</span>
        <span class="s1">received_events.append(event)</span>
    <span class="s1">plt.gcf().canvas.mpl_connect(</span><span class="s2">'pick_event'</span><span class="s0">, </span><span class="s1">on_pick)</span>
    <span class="s4"># Shortcut</span>
    <span class="s1">rectangles_on_axes = (big_on_axes</span><span class="s0">, </span><span class="s1">small_on_axes)</span>
    <span class="s4"># Axes setup</span>
    <span class="s1">axes = {</span><span class="s2">&quot;gca&quot;</span><span class="s1">: </span><span class="s0">None, </span><span class="s2">&quot;host&quot;</span><span class="s1">: </span><span class="s0">None, </span><span class="s2">&quot;parasite&quot;</span><span class="s1">: </span><span class="s0">None</span><span class="s1">}</span>
    <span class="s0">if </span><span class="s2">&quot;gca&quot; </span><span class="s0">in </span><span class="s1">rectangles_on_axes:</span>
        <span class="s1">axes[</span><span class="s2">&quot;gca&quot;</span><span class="s1">] = plt.gca()</span>
    <span class="s0">if </span><span class="s2">&quot;host&quot; </span><span class="s0">in </span><span class="s1">rectangles_on_axes </span><span class="s0">or </span><span class="s2">&quot;parasite&quot; </span><span class="s0">in </span><span class="s1">rectangles_on_axes:</span>
        <span class="s1">axes[</span><span class="s2">&quot;host&quot;</span><span class="s1">] = host_subplot(</span><span class="s3">111</span><span class="s1">)</span>
        <span class="s1">axes[</span><span class="s2">&quot;parasite&quot;</span><span class="s1">] = axes[</span><span class="s2">&quot;host&quot;</span><span class="s1">].twin()</span>
    <span class="s4"># Add rectangles to axes</span>
    <span class="s1">axes[big_on_axes].add_patch(big)</span>
    <span class="s1">axes[small_on_axes].add_patch(small)</span>
    <span class="s4"># Simulate picking with click mouse event</span>
    <span class="s0">if </span><span class="s1">click_on == </span><span class="s2">&quot;big&quot;</span><span class="s1">:</span>
        <span class="s1">click_axes = axes[big_on_axes]</span>
        <span class="s1">axes_coords = (</span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">click_axes = axes[small_on_axes]</span>
        <span class="s1">axes_coords = (</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s4"># In reality mouse events never happen on parasite axes, only host axes</span>
    <span class="s0">if </span><span class="s1">click_axes </span><span class="s0">is </span><span class="s1">axes[</span><span class="s2">&quot;parasite&quot;</span><span class="s1">]:</span>
        <span class="s1">click_axes = axes[</span><span class="s2">&quot;host&quot;</span><span class="s1">]</span>
    <span class="s1">(x</span><span class="s0">, </span><span class="s1">y) = click_axes.transAxes.transform(axes_coords)</span>
    <span class="s1">m = MouseEvent(</span><span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">click_axes.figure.canvas</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">,</span>
                   <span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">click_axes.pick(m)</span>
    <span class="s4"># Checks</span>
    <span class="s1">expected_n_events = </span><span class="s3">2 </span><span class="s0">if </span><span class="s1">click_on == </span><span class="s2">&quot;small&quot; </span><span class="s0">else </span><span class="s3">1</span>
    <span class="s0">assert </span><span class="s1">len(received_events) == expected_n_events</span>
    <span class="s1">event_rects = [event.artist </span><span class="s0">for </span><span class="s1">event </span><span class="s0">in </span><span class="s1">received_events]</span>
    <span class="s0">assert </span><span class="s1">big </span><span class="s0">in </span><span class="s1">event_rects</span>
    <span class="s0">if </span><span class="s1">click_on == </span><span class="s2">&quot;small&quot;</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">small </span><span class="s0">in </span><span class="s1">event_rects</span>


<span class="s0">def </span><span class="s1">test_hbox_divider():</span>
    <span class="s1">arr1 = np.arange(</span><span class="s3">20</span><span class="s1">).reshape((</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">arr2 = np.arange(</span><span class="s3">20</span><span class="s1">).reshape((</span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax1.imshow(arr1)</span>
    <span class="s1">ax2.imshow(arr2)</span>

    <span class="s1">pad = </span><span class="s3">0.5  </span><span class="s4"># inches.</span>
    <span class="s1">divider = HBoxDivider(</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">,  </span><span class="s4"># Position of combined axes.</span>
        <span class="s1">horizontal=[Size.AxesX(ax1)</span><span class="s0">, </span><span class="s1">Size.Fixed(pad)</span><span class="s0">, </span><span class="s1">Size.AxesX(ax2)]</span><span class="s0">,</span>
        <span class="s1">vertical=[Size.AxesY(ax1)</span><span class="s0">, </span><span class="s1">Size.Scaled(</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Size.AxesY(ax2)])</span>
    <span class="s1">ax1.set_axes_locator(divider.new_locator(</span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">ax2.set_axes_locator(divider.new_locator(</span><span class="s3">2</span><span class="s1">))</span>

    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">p1 = ax1.get_position()</span>
    <span class="s1">p2 = ax2.get_position()</span>
    <span class="s0">assert </span><span class="s1">p1.height == p2.height</span>
    <span class="s0">assert </span><span class="s1">p2.width / p1.width == pytest.approx((</span><span class="s3">4 </span><span class="s1">/ </span><span class="s3">5</span><span class="s1">) ** </span><span class="s3">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_vbox_divider():</span>
    <span class="s1">arr1 = np.arange(</span><span class="s3">20</span><span class="s1">).reshape((</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">arr2 = np.arange(</span><span class="s3">20</span><span class="s1">).reshape((</span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax1.imshow(arr1)</span>
    <span class="s1">ax2.imshow(arr2)</span>

    <span class="s1">pad = </span><span class="s3">0.5  </span><span class="s4"># inches.</span>
    <span class="s1">divider = VBoxDivider(</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">,  </span><span class="s4"># Position of combined axes.</span>
        <span class="s1">horizontal=[Size.AxesX(ax1)</span><span class="s0">, </span><span class="s1">Size.Scaled(</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Size.AxesX(ax2)]</span><span class="s0">,</span>
        <span class="s1">vertical=[Size.AxesY(ax1)</span><span class="s0">, </span><span class="s1">Size.Fixed(pad)</span><span class="s0">, </span><span class="s1">Size.AxesY(ax2)])</span>
    <span class="s1">ax1.set_axes_locator(divider.new_locator(</span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">ax2.set_axes_locator(divider.new_locator(</span><span class="s3">2</span><span class="s1">))</span>

    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">p1 = ax1.get_position()</span>
    <span class="s1">p2 = ax2.get_position()</span>
    <span class="s0">assert </span><span class="s1">p1.width == p2.width</span>
    <span class="s0">assert </span><span class="s1">p1.height / p2.height == pytest.approx((</span><span class="s3">4 </span><span class="s1">/ </span><span class="s3">5</span><span class="s1">) ** </span><span class="s3">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_axes_class_tuple():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">axes_class = (mpl_toolkits.axes_grid1.mpl_axes.Axes</span><span class="s0">, </span><span class="s1">{})</span>
    <span class="s1">gr = AxesGrid(fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">, </span><span class="s1">nrows_ncols=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">axes_class=axes_class)</span>


<span class="s0">def </span><span class="s1">test_grid_axes_lists():</span>
    <span class="s5">&quot;&quot;&quot;Test Grid axes_all, axes_row and axes_column relationship.&quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">grid = Grid(fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">&quot;row&quot;</span><span class="s1">)</span>
    <span class="s1">assert_array_equal(grid</span><span class="s0">, </span><span class="s1">grid.axes_all)</span>
    <span class="s1">assert_array_equal(grid.axes_row</span><span class="s0">, </span><span class="s1">np.transpose(grid.axes_column))</span>
    <span class="s1">assert_array_equal(grid</span><span class="s0">, </span><span class="s1">np.ravel(grid.axes_row)</span><span class="s0">, </span><span class="s2">&quot;row&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">grid.get_geometry() == (</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">grid = Grid(fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">&quot;column&quot;</span><span class="s1">)</span>
    <span class="s1">assert_array_equal(grid</span><span class="s0">, </span><span class="s1">np.ravel(grid.axes_column)</span><span class="s0">, </span><span class="s2">&quot;column&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'direction'</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'row'</span><span class="s0">, </span><span class="s2">'column'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_grid_axes_position(direction):</span>
    <span class="s5">&quot;&quot;&quot;Test positioning of the axes in Grid.&quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">grid = Grid(fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">direction=direction)</span>
    <span class="s1">loc = [ax.get_axes_locator() </span><span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">np.ravel(grid.axes_row)]</span>
    <span class="s0">assert </span><span class="s1">loc[</span><span class="s3">1</span><span class="s1">]._nx &gt; loc[</span><span class="s3">0</span><span class="s1">]._nx </span><span class="s0">and </span><span class="s1">loc[</span><span class="s3">2</span><span class="s1">]._ny &lt; loc[</span><span class="s3">0</span><span class="s1">]._ny</span>
    <span class="s0">assert </span><span class="s1">loc[</span><span class="s3">0</span><span class="s1">]._nx == loc[</span><span class="s3">2</span><span class="s1">]._nx </span><span class="s0">and </span><span class="s1">loc[</span><span class="s3">0</span><span class="s1">]._ny == loc[</span><span class="s3">1</span><span class="s1">]._ny</span>
    <span class="s0">assert </span><span class="s1">loc[</span><span class="s3">3</span><span class="s1">]._nx == loc[</span><span class="s3">1</span><span class="s1">]._nx </span><span class="s0">and </span><span class="s1">loc[</span><span class="s3">3</span><span class="s1">]._ny == loc[</span><span class="s3">2</span><span class="s1">]._ny</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'rect, ngrids, error, message'</span><span class="s0">, </span><span class="s1">(</span>
    <span class="s1">((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, None, </span><span class="s1">TypeError</span><span class="s0">, </span><span class="s2">&quot;Incorrect rect format&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s3">111</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">ValueError</span><span class="s0">, </span><span class="s2">&quot;ngrids must be positive&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s3">111</span><span class="s0">, </span><span class="s3">7</span><span class="s0">, </span><span class="s1">ValueError</span><span class="s0">, </span><span class="s2">&quot;ngrids must be positive&quot;</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_grid_errors(rect</span><span class="s0">, </span><span class="s1">ngrids</span><span class="s0">, </span><span class="s1">error</span><span class="s0">, </span><span class="s1">message):</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(error</span><span class="s0">, </span><span class="s1">match=message):</span>
        <span class="s1">Grid(fig</span><span class="s0">, </span><span class="s1">rect</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ngrids=ngrids)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'anchor, error, message'</span><span class="s0">, </span><span class="s1">(</span>
    <span class="s1">(</span><span class="s0">None, </span><span class="s1">TypeError</span><span class="s0">, </span><span class="s2">&quot;anchor must be str&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">&quot;CC&quot;</span><span class="s0">, </span><span class="s1">ValueError</span><span class="s0">, </span><span class="s2">&quot;'CC' is not a valid value for anchor&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">TypeError</span><span class="s0">, </span><span class="s2">&quot;anchor must be str&quot;</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_divider_errors(anchor</span><span class="s0">, </span><span class="s1">error</span><span class="s0">, </span><span class="s1">message):</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(error</span><span class="s0">, </span><span class="s1">match=message):</span>
        <span class="s1">Divider(fig</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[Size.Fixed(</span><span class="s3">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[Size.Fixed(</span><span class="s3">1</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">anchor=anchor)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_mark_inset_unstales_viewlim(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">inset</span><span class="s0">, </span><span class="s1">full = fig_test.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">full.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span>
    <span class="s1">inset.set(xlim=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s4"># Check that mark_inset unstales full's viewLim before drawing the marks.</span>
    <span class="s1">mark_inset(full</span><span class="s0">, </span><span class="s1">inset</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>

    <span class="s1">inset</span><span class="s0">, </span><span class="s1">full = fig_ref.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">full.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span>
    <span class="s1">inset.set(xlim=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">mark_inset(full</span><span class="s0">, </span><span class="s1">inset</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s4"># Manually unstale the full's viewLim.</span>
    <span class="s1">fig_ref.canvas.draw()</span>


<span class="s0">def </span><span class="s1">test_auto_adjustable():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">pad = </span><span class="s3">0.1</span>
    <span class="s1">make_axes_area_auto_adjustable(ax</span><span class="s0">, </span><span class="s1">pad=pad)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">tbb = ax.get_tightbbox()</span>
    <span class="s0">assert </span><span class="s1">tbb.x0 == pytest.approx(pad * fig.dpi)</span>
    <span class="s0">assert </span><span class="s1">tbb.x1 == pytest.approx(fig.bbox.width - pad * fig.dpi)</span>
    <span class="s0">assert </span><span class="s1">tbb.y0 == pytest.approx(pad * fig.dpi)</span>
    <span class="s0">assert </span><span class="s1">tbb.y1 == pytest.approx(fig.bbox.height - pad * fig.dpi)</span>


<span class="s4"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s2">'rgb_axes.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=(</span><span class="s2">'classic'</span><span class="s0">, </span><span class="s2">'_classic_test_patch'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_rgb_axes():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = RGBAxes(fig</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">0.8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pad=</span><span class="s3">0.1</span><span class="s1">)</span>
    <span class="s1">rng = np.random.default_rng(</span><span class="s3">19680801</span><span class="s1">)</span>
    <span class="s1">r = rng.random((</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">g = rng.random((</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">b = rng.random((</span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">ax.imshow_rgb(r</span><span class="s0">, </span><span class="s1">g</span><span class="s0">, </span><span class="s1">b</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s2">'none'</span><span class="s1">)</span>


<span class="s4"># Update style when regenerating the test image</span>
<span class="s1">@image_comparison([</span><span class="s2">'insetposition.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">style=(</span><span class="s2">'classic'</span><span class="s0">, </span><span class="s2">'_classic_test_patch'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_insetposition():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">ax_ins = plt.axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ip = InsetPosition(ax</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">])</span>
    <span class="s1">ax_ins.set_axes_locator(ip)</span>


<span class="s4"># The original version of this test relied on mpl_toolkits's slightly different</span>
<span class="s4"># colorbar implementation; moving to matplotlib's own colorbar implementation</span>
<span class="s4"># caused the small image comparison error.</span>
<span class="s1">@image_comparison([</span><span class="s2">'imagegrid_cbar_mode.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">, </span><span class="s1">tol=</span><span class="s3">0.3</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_imagegrid_cbar_mode_edge():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">30</span><span class="s1">))</span>
    <span class="s1">arr = np.sin(X) * np.cos(Y) + </span><span class="s3">1j</span><span class="s1">*(np.sin(</span><span class="s3">3</span><span class="s1">*Y) * np.cos(Y/</span><span class="s3">2.</span><span class="s1">))</span>

    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">18</span><span class="s0">, </span><span class="s3">9</span><span class="s1">))</span>

    <span class="s1">positions = (</span><span class="s3">241</span><span class="s0">, </span><span class="s3">242</span><span class="s0">, </span><span class="s3">243</span><span class="s0">, </span><span class="s3">244</span><span class="s0">, </span><span class="s3">245</span><span class="s0">, </span><span class="s3">246</span><span class="s0">, </span><span class="s3">247</span><span class="s0">, </span><span class="s3">248</span><span class="s1">)</span>
    <span class="s1">directions = [</span><span class="s2">'row'</span><span class="s1">]*</span><span class="s3">4 </span><span class="s1">+ [</span><span class="s2">'column'</span><span class="s1">]*</span><span class="s3">4</span>
    <span class="s1">cbar_locations = [</span><span class="s2">'left'</span><span class="s0">, </span><span class="s2">'right'</span><span class="s0">, </span><span class="s2">'top'</span><span class="s0">, </span><span class="s2">'bottom'</span><span class="s1">]*</span><span class="s3">2</span>

    <span class="s0">for </span><span class="s1">position</span><span class="s0">, </span><span class="s1">direction</span><span class="s0">, </span><span class="s1">location </span><span class="s0">in </span><span class="s1">zip(</span>
            <span class="s1">positions</span><span class="s0">, </span><span class="s1">directions</span><span class="s0">, </span><span class="s1">cbar_locations):</span>
        <span class="s1">grid = ImageGrid(fig</span><span class="s0">, </span><span class="s1">position</span><span class="s0">,</span>
                         <span class="s1">nrows_ncols=(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
                         <span class="s1">direction=direction</span><span class="s0">,</span>
                         <span class="s1">cbar_location=location</span><span class="s0">,</span>
                         <span class="s1">cbar_size=</span><span class="s2">'20%'</span><span class="s0">,</span>
                         <span class="s1">cbar_mode=</span><span class="s2">'edge'</span><span class="s1">)</span>
        <span class="s1">ax1</span><span class="s0">, </span><span class="s1">ax2</span><span class="s0">, </span><span class="s1">ax3</span><span class="s0">, </span><span class="s1">ax4</span><span class="s0">, </span><span class="s1">= grid</span>

        <span class="s1">ax1.imshow(arr.real</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'nipy_spectral'</span><span class="s1">)</span>
        <span class="s1">ax2.imshow(arr.imag</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'hot'</span><span class="s1">)</span>
        <span class="s1">ax3.imshow(np.abs(arr)</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'jet'</span><span class="s1">)</span>
        <span class="s1">ax4.imshow(np.arctan2(arr.imag</span><span class="s0">, </span><span class="s1">arr.real)</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s2">'hsv'</span><span class="s1">)</span>

        <span class="s4"># In each row/column, the &quot;first&quot; colorbars must be overwritten by the</span>
        <span class="s4"># &quot;second&quot; ones.  To achieve this, clear out the axes first.</span>
        <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">grid:</span>
            <span class="s1">ax.cax.cla()</span>
            <span class="s1">cb = ax.cax.colorbar(ax.images[</span><span class="s3">0</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_imagegrid():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">grid = ImageGrid(fig</span><span class="s0">, </span><span class="s3">111</span><span class="s0">, </span><span class="s1">nrows_ncols=(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">ax = grid[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">im = ax.imshow([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">norm=mpl.colors.LogNorm())</span>
    <span class="s1">cb = ax.cax.colorbar(im)</span>
    <span class="s0">assert </span><span class="s1">isinstance(cb.locator</span><span class="s0">, </span><span class="s1">mticker.LogLocator)</span>


<span class="s0">def </span><span class="s1">test_removal():</span>
    <span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
    <span class="s0">import </span><span class="s1">mpl_toolkits.axisartist </span><span class="s0">as </span><span class="s1">AA</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = host_subplot(</span><span class="s3">111</span><span class="s0">, </span><span class="s1">axes_class=AA.Axes</span><span class="s0">, </span><span class="s1">figure=fig)</span>
    <span class="s1">col = ax.fill_between(range(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">range(</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">col.remove()</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s1">@image_comparison([</span><span class="s2">'anchored_locator_base_call.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">&quot;mpl20&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_anchored_locator_base_call():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">fig2 = fig.subfigures(nrows=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">ax = fig1.subplots()</span>
    <span class="s1">ax.set(aspect=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">xlim=(-</span><span class="s3">15</span><span class="s0">, </span><span class="s3">15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(-</span><span class="s3">20</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">ax.set(xticks=[]</span><span class="s0">, </span><span class="s1">yticks=[])</span>

    <span class="s1">Z = cbook.get_sample_data(</span>
        <span class="s2">&quot;axes_grid/bivariate_normal.npy&quot;</span><span class="s0">, </span><span class="s1">np_load=</span><span class="s0">True</span>
    <span class="s1">)</span>
    <span class="s1">extent = (-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">-</span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">axins = zoomed_inset_axes(ax</span><span class="s0">, </span><span class="s1">zoom=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">&quot;upper left&quot;</span><span class="s1">)</span>
    <span class="s1">axins.set(xticks=[]</span><span class="s0">, </span><span class="s1">yticks=[])</span>

    <span class="s1">axins.imshow(Z</span><span class="s0">, </span><span class="s1">extent=extent</span><span class="s0">, </span><span class="s1">origin=</span><span class="s2">&quot;lower&quot;</span><span class="s1">)</span>
</pre>
</body>
</html>