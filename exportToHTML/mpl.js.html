<html>
<head>
<title>mpl.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
mpl.js</font>
</center></td></tr></table>
<pre><span class="s0">/* Put everything inside the global mpl namespace */</span>
<span class="s0">/* global mpl */</span>
<span class="s1">window.mpl = {};</span>

<span class="s1">mpl.get_websocket_type = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">WebSocket !== </span><span class="s3">'undefined'</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s1">WebSocket;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">MozWebSocket !== </span><span class="s3">'undefined'</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s1">MozWebSocket;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">alert(</span>
            <span class="s3">'Your browser does not have WebSocket support. ' </span><span class="s1">+</span>
                <span class="s3">'Please try Chrome, Safari or Firefox â‰¥ 6. ' </span><span class="s1">+</span>
                <span class="s3">'Firefox 4 and 5 are also supported but you ' </span><span class="s1">+</span>
                <span class="s3">'have to enable WebSockets in about:config.'</span>
        <span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">};</span>

<span class="s1">mpl.figure = </span><span class="s2">function </span><span class="s1">(figure_id, websocket, ondownload, parent_element) {</span>
    <span class="s2">this</span><span class="s1">.id = figure_id;</span>

    <span class="s2">this</span><span class="s1">.ws = websocket;</span>

    <span class="s2">this</span><span class="s1">.supports_binary = </span><span class="s2">this</span><span class="s1">.ws.binaryType !== undefined;</span>

    <span class="s2">if </span><span class="s1">(!</span><span class="s2">this</span><span class="s1">.supports_binary) {</span>
        <span class="s2">var </span><span class="s1">warnings = document.getElementById(</span><span class="s3">'mpl-warnings'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(warnings) {</span>
            <span class="s1">warnings.style.display = </span><span class="s3">'block'</span><span class="s1">;</span>
            <span class="s1">warnings.textContent =</span>
                <span class="s3">'This browser does not support binary websocket messages. ' </span><span class="s1">+</span>
                <span class="s3">'Performance may be slow.'</span><span class="s1">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s2">this</span><span class="s1">.imageObj = </span><span class="s2">new </span><span class="s1">Image();</span>

    <span class="s2">this</span><span class="s1">.context = undefined;</span>
    <span class="s2">this</span><span class="s1">.message = undefined;</span>
    <span class="s2">this</span><span class="s1">.canvas = undefined;</span>
    <span class="s2">this</span><span class="s1">.rubberband_canvas = undefined;</span>
    <span class="s2">this</span><span class="s1">.rubberband_context = undefined;</span>
    <span class="s2">this</span><span class="s1">.format_dropdown = undefined;</span>

    <span class="s2">this</span><span class="s1">.image_mode = </span><span class="s3">'full'</span><span class="s1">;</span>

    <span class="s2">this</span><span class="s1">.root = document.createElement(</span><span class="s3">'div'</span><span class="s1">);</span>
    <span class="s2">this</span><span class="s1">.root.setAttribute(</span><span class="s3">'style'</span><span class="s1">, </span><span class="s3">'display: inline-block'</span><span class="s1">);</span>
    <span class="s2">this</span><span class="s1">._root_extra_style(</span><span class="s2">this</span><span class="s1">.root);</span>

    <span class="s1">parent_element.appendChild(</span><span class="s2">this</span><span class="s1">.root);</span>

    <span class="s2">this</span><span class="s1">._init_header(</span><span class="s2">this</span><span class="s1">);</span>
    <span class="s2">this</span><span class="s1">._init_canvas(</span><span class="s2">this</span><span class="s1">);</span>
    <span class="s2">this</span><span class="s1">._init_toolbar(</span><span class="s2">this</span><span class="s1">);</span>

    <span class="s2">var </span><span class="s1">fig = </span><span class="s2">this</span><span class="s1">;</span>

    <span class="s2">this</span><span class="s1">.waiting = </span><span class="s2">false</span><span class="s1">;</span>

    <span class="s2">this</span><span class="s1">.ws.onopen = </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s1">fig.send_message(</span><span class="s3">'supports_binary'</span><span class="s1">, { value: fig.supports_binary });</span>
        <span class="s1">fig.send_message(</span><span class="s3">'send_image_mode'</span><span class="s1">, {});</span>
        <span class="s2">if </span><span class="s1">(fig.ratio !== </span><span class="s4">1</span><span class="s1">) {</span>
            <span class="s1">fig.send_message(</span><span class="s3">'set_device_pixel_ratio'</span><span class="s1">, {</span>
                <span class="s1">device_pixel_ratio: fig.ratio,</span>
            <span class="s1">});</span>
        <span class="s1">}</span>
        <span class="s1">fig.send_message(</span><span class="s3">'refresh'</span><span class="s1">, {});</span>
    <span class="s1">};</span>

    <span class="s2">this</span><span class="s1">.imageObj.onload = </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">if </span><span class="s1">(fig.image_mode === </span><span class="s3">'full'</span><span class="s1">) {</span>
            <span class="s0">// Full images could contain transparency (where diff images</span>
            <span class="s0">// almost always do), so we need to clear the canvas so that</span>
            <span class="s0">// there is no ghosting.</span>
            <span class="s1">fig.context.clearRect(</span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, fig.canvas.width, fig.canvas.height);</span>
        <span class="s1">}</span>
        <span class="s1">fig.context.drawImage(fig.imageObj, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">);</span>
    <span class="s1">};</span>

    <span class="s2">this</span><span class="s1">.imageObj.onunload = </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s1">fig.ws.close();</span>
    <span class="s1">};</span>

    <span class="s2">this</span><span class="s1">.ws.onmessage = </span><span class="s2">this</span><span class="s1">._make_on_message_function(</span><span class="s2">this</span><span class="s1">);</span>

    <span class="s2">this</span><span class="s1">.ondownload = ondownload;</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype._init_header = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">var </span><span class="s1">titlebar = document.createElement(</span><span class="s3">'div'</span><span class="s1">);</span>
    <span class="s1">titlebar.classList =</span>
        <span class="s3">'ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix'</span><span class="s1">;</span>
    <span class="s2">var </span><span class="s1">titletext = document.createElement(</span><span class="s3">'div'</span><span class="s1">);</span>
    <span class="s1">titletext.classList = </span><span class="s3">'ui-dialog-title'</span><span class="s1">;</span>
    <span class="s1">titletext.setAttribute(</span>
        <span class="s3">'style'</span><span class="s1">,</span>
        <span class="s3">'width: 100%; text-align: center; padding: 3px;'</span>
    <span class="s1">);</span>
    <span class="s1">titlebar.appendChild(titletext);</span>
    <span class="s2">this</span><span class="s1">.root.appendChild(titlebar);</span>
    <span class="s2">this</span><span class="s1">.header = titletext;</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype._canvas_extra_style = </span><span class="s2">function </span><span class="s1">(_canvas_div) {};</span>

<span class="s1">mpl.figure.prototype._root_extra_style = </span><span class="s2">function </span><span class="s1">(_canvas_div) {};</span>

<span class="s1">mpl.figure.prototype._init_canvas = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">var </span><span class="s1">fig = </span><span class="s2">this</span><span class="s1">;</span>

    <span class="s2">var </span><span class="s1">canvas_div = (</span><span class="s2">this</span><span class="s1">.canvas_div = document.createElement(</span><span class="s3">'div'</span><span class="s1">));</span>
    <span class="s1">canvas_div.setAttribute(</span><span class="s3">'tabindex'</span><span class="s1">, </span><span class="s3">'0'</span><span class="s1">);</span>
    <span class="s1">canvas_div.setAttribute(</span>
        <span class="s3">'style'</span><span class="s1">,</span>
        <span class="s3">'border: 1px solid #ddd;' </span><span class="s1">+</span>
            <span class="s3">'box-sizing: content-box;' </span><span class="s1">+</span>
            <span class="s3">'clear: both;' </span><span class="s1">+</span>
            <span class="s3">'min-height: 1px;' </span><span class="s1">+</span>
            <span class="s3">'min-width: 1px;' </span><span class="s1">+</span>
            <span class="s3">'outline: 0;' </span><span class="s1">+</span>
            <span class="s3">'overflow: hidden;' </span><span class="s1">+</span>
            <span class="s3">'position: relative;' </span><span class="s1">+</span>
            <span class="s3">'resize: both;' </span><span class="s1">+</span>
            <span class="s3">'z-index: 2;'</span>
    <span class="s1">);</span>

    <span class="s2">function </span><span class="s1">on_keyboard_event_closure(name) {</span>
        <span class="s2">return function </span><span class="s1">(event) {</span>
            <span class="s2">return </span><span class="s1">fig.key_event(event, name);</span>
        <span class="s1">};</span>
    <span class="s1">}</span>

    <span class="s1">canvas_div.addEventListener(</span>
        <span class="s3">'keydown'</span><span class="s1">,</span>
        <span class="s1">on_keyboard_event_closure(</span><span class="s3">'key_press'</span><span class="s1">)</span>
    <span class="s1">);</span>
    <span class="s1">canvas_div.addEventListener(</span>
        <span class="s3">'keyup'</span><span class="s1">,</span>
        <span class="s1">on_keyboard_event_closure(</span><span class="s3">'key_release'</span><span class="s1">)</span>
    <span class="s1">);</span>

    <span class="s2">this</span><span class="s1">._canvas_extra_style(canvas_div);</span>
    <span class="s2">this</span><span class="s1">.root.appendChild(canvas_div);</span>

    <span class="s2">var </span><span class="s1">canvas = (</span><span class="s2">this</span><span class="s1">.canvas = document.createElement(</span><span class="s3">'canvas'</span><span class="s1">));</span>
    <span class="s1">canvas.classList.add(</span><span class="s3">'mpl-canvas'</span><span class="s1">);</span>
    <span class="s1">canvas.setAttribute(</span>
        <span class="s3">'style'</span><span class="s1">,</span>
        <span class="s3">'box-sizing: content-box;' </span><span class="s1">+</span>
            <span class="s3">'pointer-events: none;' </span><span class="s1">+</span>
            <span class="s3">'position: relative;' </span><span class="s1">+</span>
            <span class="s3">'z-index: 0;'</span>
    <span class="s1">);</span>

    <span class="s2">this</span><span class="s1">.context = canvas.getContext(</span><span class="s3">'2d'</span><span class="s1">);</span>

    <span class="s2">var </span><span class="s1">backingStore =</span>
        <span class="s2">this</span><span class="s1">.context.backingStorePixelRatio ||</span>
        <span class="s2">this</span><span class="s1">.context.webkitBackingStorePixelRatio ||</span>
        <span class="s2">this</span><span class="s1">.context.mozBackingStorePixelRatio ||</span>
        <span class="s2">this</span><span class="s1">.context.msBackingStorePixelRatio ||</span>
        <span class="s2">this</span><span class="s1">.context.oBackingStorePixelRatio ||</span>
        <span class="s2">this</span><span class="s1">.context.backingStorePixelRatio ||</span>
        <span class="s4">1</span><span class="s1">;</span>

    <span class="s2">this</span><span class="s1">.ratio = (window.devicePixelRatio || </span><span class="s4">1</span><span class="s1">) / backingStore;</span>

    <span class="s2">var </span><span class="s1">rubberband_canvas = (</span><span class="s2">this</span><span class="s1">.rubberband_canvas = document.createElement(</span>
        <span class="s3">'canvas'</span>
    <span class="s1">));</span>
    <span class="s1">rubberband_canvas.setAttribute(</span>
        <span class="s3">'style'</span><span class="s1">,</span>
        <span class="s3">'box-sizing: content-box;' </span><span class="s1">+</span>
            <span class="s3">'left: 0;' </span><span class="s1">+</span>
            <span class="s3">'pointer-events: none;' </span><span class="s1">+</span>
            <span class="s3">'position: absolute;' </span><span class="s1">+</span>
            <span class="s3">'top: 0;' </span><span class="s1">+</span>
            <span class="s3">'z-index: 1;'</span>
    <span class="s1">);</span>

    <span class="s0">// Apply a ponyfill if ResizeObserver is not implemented by browser.</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.ResizeObserver === undefined) {</span>
        <span class="s2">if </span><span class="s1">(window.ResizeObserver !== undefined) {</span>
            <span class="s2">this</span><span class="s1">.ResizeObserver = window.ResizeObserver;</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s2">var </span><span class="s1">obs = _JSXTOOLS_RESIZE_OBSERVER({});</span>
            <span class="s2">this</span><span class="s1">.ResizeObserver = obs.ResizeObserver;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s2">this</span><span class="s1">.resizeObserverInstance = </span><span class="s2">new this</span><span class="s1">.ResizeObserver(</span><span class="s2">function </span><span class="s1">(entries) {</span>
        <span class="s2">var </span><span class="s1">nentries = entries.length;</span>
        <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">i = </span><span class="s4">0</span><span class="s1">; i &lt; nentries; i++) {</span>
            <span class="s2">var </span><span class="s1">entry = entries[i];</span>
            <span class="s2">var </span><span class="s1">width, height;</span>
            <span class="s2">if </span><span class="s1">(entry.contentBoxSize) {</span>
                <span class="s2">if </span><span class="s1">(entry.contentBoxSize </span><span class="s2">instanceof </span><span class="s1">Array) {</span>
                    <span class="s0">// Chrome 84 implements new version of spec.</span>
                    <span class="s1">width = entry.contentBoxSize[</span><span class="s4">0</span><span class="s1">].inlineSize;</span>
                    <span class="s1">height = entry.contentBoxSize[</span><span class="s4">0</span><span class="s1">].blockSize;</span>
                <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                    <span class="s0">// Firefox implements old version of spec.</span>
                    <span class="s1">width = entry.contentBoxSize.inlineSize;</span>
                    <span class="s1">height = entry.contentBoxSize.blockSize;</span>
                <span class="s1">}</span>
            <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                <span class="s0">// Chrome &lt;84 implements even older version of spec.</span>
                <span class="s1">width = entry.contentRect.width;</span>
                <span class="s1">height = entry.contentRect.height;</span>
            <span class="s1">}</span>

            <span class="s0">// Keep the size of the canvas and rubber band canvas in sync with</span>
            <span class="s0">// the canvas container.</span>
            <span class="s2">if </span><span class="s1">(entry.devicePixelContentBoxSize) {</span>
                <span class="s0">// Chrome 84 implements new version of spec.</span>
                <span class="s1">canvas.setAttribute(</span>
                    <span class="s3">'width'</span><span class="s1">,</span>
                    <span class="s1">entry.devicePixelContentBoxSize[</span><span class="s4">0</span><span class="s1">].inlineSize</span>
                <span class="s1">);</span>
                <span class="s1">canvas.setAttribute(</span>
                    <span class="s3">'height'</span><span class="s1">,</span>
                    <span class="s1">entry.devicePixelContentBoxSize[</span><span class="s4">0</span><span class="s1">].blockSize</span>
                <span class="s1">);</span>
            <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                <span class="s1">canvas.setAttribute(</span><span class="s3">'width'</span><span class="s1">, width * fig.ratio);</span>
                <span class="s1">canvas.setAttribute(</span><span class="s3">'height'</span><span class="s1">, height * fig.ratio);</span>
            <span class="s1">}</span>
            <span class="s0">/* This rescales the canvas back to display pixels, so that it 
             * appears correct on HiDPI screens. */</span>
            <span class="s1">canvas.style.width = width + </span><span class="s3">'px'</span><span class="s1">;</span>
            <span class="s1">canvas.style.height = height + </span><span class="s3">'px'</span><span class="s1">;</span>

            <span class="s1">rubberband_canvas.setAttribute(</span><span class="s3">'width'</span><span class="s1">, width);</span>
            <span class="s1">rubberband_canvas.setAttribute(</span><span class="s3">'height'</span><span class="s1">, height);</span>

            <span class="s0">// And update the size in Python. We ignore the initial 0/0 size</span>
            <span class="s0">// that occurs as the element is placed into the DOM, which should</span>
            <span class="s0">// otherwise not happen due to the minimum size styling.</span>
            <span class="s2">if </span><span class="s1">(fig.ws.readyState == </span><span class="s4">1 </span><span class="s1">&amp;&amp; width != </span><span class="s4">0 </span><span class="s1">&amp;&amp; height != </span><span class="s4">0</span><span class="s1">) {</span>
                <span class="s1">fig.request_resize(width, height);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">});</span>
    <span class="s2">this</span><span class="s1">.resizeObserverInstance.observe(canvas_div);</span>

    <span class="s2">function </span><span class="s1">on_mouse_event_closure(name) {</span>
        <span class="s0">/* User Agent sniffing is bad, but WebKit is busted: 
         * https://bugs.webkit.org/show_bug.cgi?id=144526 
         * https://bugs.webkit.org/show_bug.cgi?id=181818 
         * The worst that happens here is that they get an extra browser 
         * selection when dragging, if this check fails to catch them. 
         */</span>
        <span class="s2">var </span><span class="s1">UA = navigator.userAgent;</span>
        <span class="s2">var </span><span class="s1">isWebKit = /AppleWebKit/.test(UA) &amp;&amp; !/Chrome/.test(UA);</span>
        <span class="s2">if</span><span class="s1">(isWebKit) {</span>
            <span class="s2">return function </span><span class="s1">(event) {</span>
                <span class="s0">/* This prevents the web browser from automatically changing to 
                 * the text insertion cursor when the button is pressed. We 
                 * want to control all of the cursor setting manually through 
                 * the 'cursor' event from matplotlib */</span>
                <span class="s1">event.preventDefault()</span>
                <span class="s2">return </span><span class="s1">fig.mouse_event(event, name);</span>
            <span class="s1">};</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s2">return function </span><span class="s1">(event) {</span>
                <span class="s2">return </span><span class="s1">fig.mouse_event(event, name);</span>
            <span class="s1">};</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s1">canvas_div.addEventListener(</span>
        <span class="s3">'mousedown'</span><span class="s1">,</span>
        <span class="s1">on_mouse_event_closure(</span><span class="s3">'button_press'</span><span class="s1">)</span>
    <span class="s1">);</span>
    <span class="s1">canvas_div.addEventListener(</span>
        <span class="s3">'mouseup'</span><span class="s1">,</span>
        <span class="s1">on_mouse_event_closure(</span><span class="s3">'button_release'</span><span class="s1">)</span>
    <span class="s1">);</span>
    <span class="s1">canvas_div.addEventListener(</span>
        <span class="s3">'dblclick'</span><span class="s1">,</span>
        <span class="s1">on_mouse_event_closure(</span><span class="s3">'dblclick'</span><span class="s1">)</span>
    <span class="s1">);</span>
    <span class="s0">// Throttle sequential mouse events to 1 every 20ms.</span>
    <span class="s1">canvas_div.addEventListener(</span>
        <span class="s3">'mousemove'</span><span class="s1">,</span>
        <span class="s1">on_mouse_event_closure(</span><span class="s3">'motion_notify'</span><span class="s1">)</span>
    <span class="s1">);</span>

    <span class="s1">canvas_div.addEventListener(</span>
        <span class="s3">'mouseenter'</span><span class="s1">,</span>
        <span class="s1">on_mouse_event_closure(</span><span class="s3">'figure_enter'</span><span class="s1">)</span>
    <span class="s1">);</span>
    <span class="s1">canvas_div.addEventListener(</span>
        <span class="s3">'mouseleave'</span><span class="s1">,</span>
        <span class="s1">on_mouse_event_closure(</span><span class="s3">'figure_leave'</span><span class="s1">)</span>
    <span class="s1">);</span>

    <span class="s1">canvas_div.addEventListener(</span><span class="s3">'wheel'</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(event) {</span>
        <span class="s2">if </span><span class="s1">(event.deltaY &lt; </span><span class="s4">0</span><span class="s1">) {</span>
            <span class="s1">event.step = </span><span class="s4">1</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s1">event.step = -</span><span class="s4">1</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s1">on_mouse_event_closure(</span><span class="s3">'scroll'</span><span class="s1">)(event);</span>
    <span class="s1">});</span>

    <span class="s1">canvas_div.appendChild(canvas);</span>
    <span class="s1">canvas_div.appendChild(rubberband_canvas);</span>

    <span class="s2">this</span><span class="s1">.rubberband_context = rubberband_canvas.getContext(</span><span class="s3">'2d'</span><span class="s1">);</span>
    <span class="s2">this</span><span class="s1">.rubberband_context.strokeStyle = </span><span class="s3">'#000000'</span><span class="s1">;</span>

    <span class="s2">this</span><span class="s1">._resize_canvas = </span><span class="s2">function </span><span class="s1">(width, height, forward) {</span>
        <span class="s2">if </span><span class="s1">(forward) {</span>
            <span class="s1">canvas_div.style.width = width + </span><span class="s3">'px'</span><span class="s1">;</span>
            <span class="s1">canvas_div.style.height = height + </span><span class="s3">'px'</span><span class="s1">;</span>
        <span class="s1">}</span>
    <span class="s1">};</span>

    <span class="s0">// Disable right mouse context menu.</span>
    <span class="s1">canvas_div.addEventListener(</span><span class="s3">'contextmenu'</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(_e) {</span>
        <span class="s1">event.preventDefault();</span>
        <span class="s2">return false</span><span class="s1">;</span>
    <span class="s1">});</span>

    <span class="s2">function </span><span class="s1">set_focus() {</span>
        <span class="s1">canvas.focus();</span>
        <span class="s1">canvas_div.focus();</span>
    <span class="s1">}</span>

    <span class="s1">window.setTimeout(set_focus, </span><span class="s4">100</span><span class="s1">);</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype._init_toolbar = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">var </span><span class="s1">fig = </span><span class="s2">this</span><span class="s1">;</span>

    <span class="s2">var </span><span class="s1">toolbar = document.createElement(</span><span class="s3">'div'</span><span class="s1">);</span>
    <span class="s1">toolbar.classList = </span><span class="s3">'mpl-toolbar'</span><span class="s1">;</span>
    <span class="s2">this</span><span class="s1">.root.appendChild(toolbar);</span>

    <span class="s2">function </span><span class="s1">on_click_closure(name) {</span>
        <span class="s2">return function </span><span class="s1">(_event) {</span>
            <span class="s2">return </span><span class="s1">fig.toolbar_button_onclick(name);</span>
        <span class="s1">};</span>
    <span class="s1">}</span>

    <span class="s2">function </span><span class="s1">on_mouseover_closure(tooltip) {</span>
        <span class="s2">return function </span><span class="s1">(event) {</span>
            <span class="s2">if </span><span class="s1">(!event.currentTarget.disabled) {</span>
                <span class="s2">return </span><span class="s1">fig.toolbar_button_onmouseover(tooltip);</span>
            <span class="s1">}</span>
        <span class="s1">};</span>
    <span class="s1">}</span>

    <span class="s1">fig.buttons = {};</span>
    <span class="s2">var </span><span class="s1">buttonGroup = document.createElement(</span><span class="s3">'div'</span><span class="s1">);</span>
    <span class="s1">buttonGroup.classList = </span><span class="s3">'mpl-button-group'</span><span class="s1">;</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">toolbar_ind </span><span class="s2">in </span><span class="s1">mpl.toolbar_items) {</span>
        <span class="s2">var </span><span class="s1">name = mpl.toolbar_items[toolbar_ind][</span><span class="s4">0</span><span class="s1">];</span>
        <span class="s2">var </span><span class="s1">tooltip = mpl.toolbar_items[toolbar_ind][</span><span class="s4">1</span><span class="s1">];</span>
        <span class="s2">var </span><span class="s1">image = mpl.toolbar_items[toolbar_ind][</span><span class="s4">2</span><span class="s1">];</span>
        <span class="s2">var </span><span class="s1">method_name = mpl.toolbar_items[toolbar_ind][</span><span class="s4">3</span><span class="s1">];</span>

        <span class="s2">if </span><span class="s1">(!name) {</span>
            <span class="s0">/* Instead of a spacer, we start a new button group. */</span>
            <span class="s2">if </span><span class="s1">(buttonGroup.hasChildNodes()) {</span>
                <span class="s1">toolbar.appendChild(buttonGroup);</span>
            <span class="s1">}</span>
            <span class="s1">buttonGroup = document.createElement(</span><span class="s3">'div'</span><span class="s1">);</span>
            <span class="s1">buttonGroup.classList = </span><span class="s3">'mpl-button-group'</span><span class="s1">;</span>
            <span class="s2">continue</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s2">var </span><span class="s1">button = (fig.buttons[name] = document.createElement(</span><span class="s3">'button'</span><span class="s1">));</span>
        <span class="s1">button.classList = </span><span class="s3">'mpl-widget'</span><span class="s1">;</span>
        <span class="s1">button.setAttribute(</span><span class="s3">'role'</span><span class="s1">, </span><span class="s3">'button'</span><span class="s1">);</span>
        <span class="s1">button.setAttribute(</span><span class="s3">'aria-disabled'</span><span class="s1">, </span><span class="s3">'false'</span><span class="s1">);</span>
        <span class="s1">button.addEventListener(</span><span class="s3">'click'</span><span class="s1">, on_click_closure(method_name));</span>
        <span class="s1">button.addEventListener(</span><span class="s3">'mouseover'</span><span class="s1">, on_mouseover_closure(tooltip));</span>

        <span class="s2">var </span><span class="s1">icon_img = document.createElement(</span><span class="s3">'img'</span><span class="s1">);</span>
        <span class="s1">icon_img.src = </span><span class="s3">'_images/' </span><span class="s1">+ image + </span><span class="s3">'.png'</span><span class="s1">;</span>
        <span class="s1">icon_img.srcset = </span><span class="s3">'_images/' </span><span class="s1">+ image + </span><span class="s3">'_large.png 2x'</span><span class="s1">;</span>
        <span class="s1">icon_img.alt = tooltip;</span>
        <span class="s1">button.appendChild(icon_img);</span>

        <span class="s1">buttonGroup.appendChild(button);</span>
    <span class="s1">}</span>

    <span class="s2">if </span><span class="s1">(buttonGroup.hasChildNodes()) {</span>
        <span class="s1">toolbar.appendChild(buttonGroup);</span>
    <span class="s1">}</span>

    <span class="s2">var </span><span class="s1">fmt_picker = document.createElement(</span><span class="s3">'select'</span><span class="s1">);</span>
    <span class="s1">fmt_picker.classList = </span><span class="s3">'mpl-widget'</span><span class="s1">;</span>
    <span class="s1">toolbar.appendChild(fmt_picker);</span>
    <span class="s2">this</span><span class="s1">.format_dropdown = fmt_picker;</span>

    <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">ind </span><span class="s2">in </span><span class="s1">mpl.extensions) {</span>
        <span class="s2">var </span><span class="s1">fmt = mpl.extensions[ind];</span>
        <span class="s2">var </span><span class="s1">option = document.createElement(</span><span class="s3">'option'</span><span class="s1">);</span>
        <span class="s1">option.selected = fmt === mpl.default_extension;</span>
        <span class="s1">option.innerHTML = fmt;</span>
        <span class="s1">fmt_picker.appendChild(option);</span>
    <span class="s1">}</span>

    <span class="s2">var </span><span class="s1">status_bar = document.createElement(</span><span class="s3">'span'</span><span class="s1">);</span>
    <span class="s1">status_bar.classList = </span><span class="s3">'mpl-message'</span><span class="s1">;</span>
    <span class="s1">toolbar.appendChild(status_bar);</span>
    <span class="s2">this</span><span class="s1">.message = status_bar;</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.request_resize = </span><span class="s2">function </span><span class="s1">(x_pixels, y_pixels) {</span>
    <span class="s0">// Request matplotlib to resize the figure. Matplotlib will then trigger a resize in the client,</span>
    <span class="s0">// which will in turn request a refresh of the image.</span>
    <span class="s2">this</span><span class="s1">.send_message(</span><span class="s3">'resize'</span><span class="s1">, { width: x_pixels, height: y_pixels });</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.send_message = </span><span class="s2">function </span><span class="s1">(type, properties) {</span>
    <span class="s1">properties[</span><span class="s3">'type'</span><span class="s1">] = type;</span>
    <span class="s1">properties[</span><span class="s3">'figure_id'</span><span class="s1">] = </span><span class="s2">this</span><span class="s1">.id;</span>
    <span class="s2">this</span><span class="s1">.ws.send(JSON.stringify(properties));</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.send_draw_message = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">if </span><span class="s1">(!</span><span class="s2">this</span><span class="s1">.waiting) {</span>
        <span class="s2">this</span><span class="s1">.waiting = </span><span class="s2">true</span><span class="s1">;</span>
        <span class="s2">this</span><span class="s1">.ws.send(JSON.stringify({ type: </span><span class="s3">'draw'</span><span class="s1">, figure_id: </span><span class="s2">this</span><span class="s1">.id }));</span>
    <span class="s1">}</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_save = </span><span class="s2">function </span><span class="s1">(fig, _msg) {</span>
    <span class="s2">var </span><span class="s1">format_dropdown = fig.format_dropdown;</span>
    <span class="s2">var </span><span class="s1">format = format_dropdown.options[format_dropdown.selectedIndex].value;</span>
    <span class="s1">fig.ondownload(fig, format);</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_resize = </span><span class="s2">function </span><span class="s1">(fig, msg) {</span>
    <span class="s2">var </span><span class="s1">size = msg[</span><span class="s3">'size'</span><span class="s1">];</span>
    <span class="s2">if </span><span class="s1">(size[</span><span class="s4">0</span><span class="s1">] !== fig.canvas.width || size[</span><span class="s4">1</span><span class="s1">] !== fig.canvas.height) {</span>
        <span class="s1">fig._resize_canvas(size[</span><span class="s4">0</span><span class="s1">], size[</span><span class="s4">1</span><span class="s1">], msg[</span><span class="s3">'forward'</span><span class="s1">]);</span>
        <span class="s1">fig.send_message(</span><span class="s3">'refresh'</span><span class="s1">, {});</span>
    <span class="s1">}</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_rubberband = </span><span class="s2">function </span><span class="s1">(fig, msg) {</span>
    <span class="s2">var </span><span class="s1">x0 = msg[</span><span class="s3">'x0'</span><span class="s1">] / fig.ratio;</span>
    <span class="s2">var </span><span class="s1">y0 = (fig.canvas.height - msg[</span><span class="s3">'y0'</span><span class="s1">]) / fig.ratio;</span>
    <span class="s2">var </span><span class="s1">x1 = msg[</span><span class="s3">'x1'</span><span class="s1">] / fig.ratio;</span>
    <span class="s2">var </span><span class="s1">y1 = (fig.canvas.height - msg[</span><span class="s3">'y1'</span><span class="s1">]) / fig.ratio;</span>
    <span class="s1">x0 = Math.floor(x0) + </span><span class="s4">0.5</span><span class="s1">;</span>
    <span class="s1">y0 = Math.floor(y0) + </span><span class="s4">0.5</span><span class="s1">;</span>
    <span class="s1">x1 = Math.floor(x1) + </span><span class="s4">0.5</span><span class="s1">;</span>
    <span class="s1">y1 = Math.floor(y1) + </span><span class="s4">0.5</span><span class="s1">;</span>
    <span class="s2">var </span><span class="s1">min_x = Math.min(x0, x1);</span>
    <span class="s2">var </span><span class="s1">min_y = Math.min(y0, y1);</span>
    <span class="s2">var </span><span class="s1">width = Math.abs(x1 - x0);</span>
    <span class="s2">var </span><span class="s1">height = Math.abs(y1 - y0);</span>

    <span class="s1">fig.rubberband_context.clearRect(</span>
        <span class="s4">0</span><span class="s1">,</span>
        <span class="s4">0</span><span class="s1">,</span>
        <span class="s1">fig.canvas.width / fig.ratio,</span>
        <span class="s1">fig.canvas.height / fig.ratio</span>
    <span class="s1">);</span>

    <span class="s1">fig.rubberband_context.strokeRect(min_x, min_y, width, height);</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_figure_label = </span><span class="s2">function </span><span class="s1">(fig, msg) {</span>
    <span class="s0">// Updates the figure title.</span>
    <span class="s1">fig.header.textContent = msg[</span><span class="s3">'label'</span><span class="s1">];</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_cursor = </span><span class="s2">function </span><span class="s1">(fig, msg) {</span>
    <span class="s1">fig.canvas_div.style.cursor = msg[</span><span class="s3">'cursor'</span><span class="s1">];</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_message = </span><span class="s2">function </span><span class="s1">(fig, msg) {</span>
    <span class="s1">fig.message.textContent = msg[</span><span class="s3">'message'</span><span class="s1">];</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_draw = </span><span class="s2">function </span><span class="s1">(fig, _msg) {</span>
    <span class="s0">// Request the server to send over a new figure.</span>
    <span class="s1">fig.send_draw_message();</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_image_mode = </span><span class="s2">function </span><span class="s1">(fig, msg) {</span>
    <span class="s1">fig.image_mode = msg[</span><span class="s3">'mode'</span><span class="s1">];</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_history_buttons = </span><span class="s2">function </span><span class="s1">(fig, msg) {</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">key </span><span class="s2">in </span><span class="s1">msg) {</span>
        <span class="s2">if </span><span class="s1">(!(key </span><span class="s2">in </span><span class="s1">fig.buttons)) {</span>
            <span class="s2">continue</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s1">fig.buttons[key].disabled = !msg[key];</span>
        <span class="s1">fig.buttons[key].setAttribute(</span><span class="s3">'aria-disabled'</span><span class="s1">, !msg[key]);</span>
    <span class="s1">}</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.handle_navigate_mode = </span><span class="s2">function </span><span class="s1">(fig, msg) {</span>
    <span class="s2">if </span><span class="s1">(msg[</span><span class="s3">'mode'</span><span class="s1">] === </span><span class="s3">'PAN'</span><span class="s1">) {</span>
        <span class="s1">fig.buttons[</span><span class="s3">'Pan'</span><span class="s1">].classList.add(</span><span class="s3">'active'</span><span class="s1">);</span>
        <span class="s1">fig.buttons[</span><span class="s3">'Zoom'</span><span class="s1">].classList.remove(</span><span class="s3">'active'</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(msg[</span><span class="s3">'mode'</span><span class="s1">] === </span><span class="s3">'ZOOM'</span><span class="s1">) {</span>
        <span class="s1">fig.buttons[</span><span class="s3">'Pan'</span><span class="s1">].classList.remove(</span><span class="s3">'active'</span><span class="s1">);</span>
        <span class="s1">fig.buttons[</span><span class="s3">'Zoom'</span><span class="s1">].classList.add(</span><span class="s3">'active'</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">fig.buttons[</span><span class="s3">'Pan'</span><span class="s1">].classList.remove(</span><span class="s3">'active'</span><span class="s1">);</span>
        <span class="s1">fig.buttons[</span><span class="s3">'Zoom'</span><span class="s1">].classList.remove(</span><span class="s3">'active'</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.updated_canvas_event = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s0">// Called whenever the canvas gets updated.</span>
    <span class="s2">this</span><span class="s1">.send_message(</span><span class="s3">'ack'</span><span class="s1">, {});</span>
<span class="s1">};</span>

<span class="s0">// A function to construct a web socket function for onmessage handling.</span>
<span class="s0">// Called in the figure constructor.</span>
<span class="s1">mpl.figure.prototype._make_on_message_function = </span><span class="s2">function </span><span class="s1">(fig) {</span>
    <span class="s2">return function </span><span class="s1">socket_on_message(evt) {</span>
        <span class="s2">if </span><span class="s1">(evt.data </span><span class="s2">instanceof </span><span class="s1">Blob) {</span>
            <span class="s2">var </span><span class="s1">img = evt.data;</span>
            <span class="s2">if </span><span class="s1">(img.type !== </span><span class="s3">'image/png'</span><span class="s1">) {</span>
                <span class="s0">/* FIXME: We get &quot;Resource interpreted as Image but 
                 * transferred with MIME type text/plain:&quot; errors on 
                 * Chrome.  But how to set the MIME type?  It doesn't seem 
                 * to be part of the websocket stream */</span>
                <span class="s1">img.type = </span><span class="s3">'image/png'</span><span class="s1">;</span>
            <span class="s1">}</span>

            <span class="s0">/* Free the memory for the previous frames */</span>
            <span class="s2">if </span><span class="s1">(fig.imageObj.src) {</span>
                <span class="s1">(window.URL || window.webkitURL).revokeObjectURL(</span>
                    <span class="s1">fig.imageObj.src</span>
                <span class="s1">);</span>
            <span class="s1">}</span>

            <span class="s1">fig.imageObj.src = (window.URL || window.webkitURL).createObjectURL(</span>
                <span class="s1">img</span>
            <span class="s1">);</span>
            <span class="s1">fig.updated_canvas_event();</span>
            <span class="s1">fig.waiting = </span><span class="s2">false</span><span class="s1">;</span>
            <span class="s2">return</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span>
            <span class="s2">typeof </span><span class="s1">evt.data === </span><span class="s3">'string' </span><span class="s1">&amp;&amp;</span>
            <span class="s1">evt.data.slice(</span><span class="s4">0</span><span class="s1">, </span><span class="s4">21</span><span class="s1">) === </span><span class="s3">'data:image/png;base64'</span>
        <span class="s1">) {</span>
            <span class="s1">fig.imageObj.src = evt.data;</span>
            <span class="s1">fig.updated_canvas_event();</span>
            <span class="s1">fig.waiting = </span><span class="s2">false</span><span class="s1">;</span>
            <span class="s2">return</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s2">var </span><span class="s1">msg = JSON.parse(evt.data);</span>
        <span class="s2">var </span><span class="s1">msg_type = msg[</span><span class="s3">'type'</span><span class="s1">];</span>

        <span class="s0">// Call the  &quot;handle_{type}&quot; callback, which takes</span>
        <span class="s0">// the figure and JSON message as its only arguments.</span>
        <span class="s2">try </span><span class="s1">{</span>
            <span class="s2">var </span><span class="s1">callback = fig[</span><span class="s3">'handle_' </span><span class="s1">+ msg_type];</span>
        <span class="s1">} </span><span class="s2">catch </span><span class="s1">(e) {</span>
            <span class="s1">console.log(</span>
                <span class="s3">&quot;No handler for the '&quot; </span><span class="s1">+ msg_type + </span><span class="s3">&quot;' message type: &quot;</span><span class="s1">,</span>
                <span class="s1">msg</span>
            <span class="s1">);</span>
            <span class="s2">return</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s2">if </span><span class="s1">(callback) {</span>
            <span class="s2">try </span><span class="s1">{</span>
                <span class="s0">// console.log(&quot;Handling '&quot; + msg_type + &quot;' message: &quot;, msg);</span>
                <span class="s1">callback(fig, msg);</span>
            <span class="s1">} </span><span class="s2">catch </span><span class="s1">(e) {</span>
                <span class="s1">console.log(</span>
                    <span class="s3">&quot;Exception inside the 'handler_&quot; </span><span class="s1">+ msg_type + </span><span class="s3">&quot;' callback:&quot;</span><span class="s1">,</span>
                    <span class="s1">e,</span>
                    <span class="s1">e.stack,</span>
                    <span class="s1">msg</span>
                <span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">};</span>
<span class="s1">};</span>

<span class="s2">function </span><span class="s1">getModifiers(event) {</span>
    <span class="s2">var </span><span class="s1">mods = [];</span>
    <span class="s2">if </span><span class="s1">(event.ctrlKey) {</span>
        <span class="s1">mods.push(</span><span class="s3">'ctrl'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(event.altKey) {</span>
        <span class="s1">mods.push(</span><span class="s3">'alt'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(event.shiftKey) {</span>
        <span class="s1">mods.push(</span><span class="s3">'shift'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(event.metaKey) {</span>
        <span class="s1">mods.push(</span><span class="s3">'meta'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">mods;</span>
<span class="s1">}</span>

<span class="s0">/* 
 * return a copy of an object with only non-object keys 
 * we need this to avoid circular references 
 * https://stackoverflow.com/a/24161582/3208463 
 */</span>
<span class="s2">function </span><span class="s1">simpleKeys(original) {</span>
    <span class="s2">return </span><span class="s1">Object.keys(original).reduce(</span><span class="s2">function </span><span class="s1">(obj, key) {</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">original[key] !== </span><span class="s3">'object'</span><span class="s1">) {</span>
            <span class="s1">obj[key] = original[key];</span>
        <span class="s1">}</span>
        <span class="s2">return </span><span class="s1">obj;</span>
    <span class="s1">}, {});</span>
<span class="s1">}</span>

<span class="s1">mpl.figure.prototype.mouse_event = </span><span class="s2">function </span><span class="s1">(event, name) {</span>
    <span class="s2">if </span><span class="s1">(name === </span><span class="s3">'button_press'</span><span class="s1">) {</span>
        <span class="s2">this</span><span class="s1">.canvas.focus();</span>
        <span class="s2">this</span><span class="s1">.canvas_div.focus();</span>
    <span class="s1">}</span>

    <span class="s0">// from https://stackoverflow.com/q/1114465</span>
    <span class="s2">var </span><span class="s1">boundingRect = </span><span class="s2">this</span><span class="s1">.canvas.getBoundingClientRect();</span>
    <span class="s2">var </span><span class="s1">x = (event.clientX - boundingRect.left) * </span><span class="s2">this</span><span class="s1">.ratio;</span>
    <span class="s2">var </span><span class="s1">y = (event.clientY - boundingRect.top) * </span><span class="s2">this</span><span class="s1">.ratio;</span>

    <span class="s2">this</span><span class="s1">.send_message(name, {</span>
        <span class="s1">x: x,</span>
        <span class="s1">y: y,</span>
        <span class="s1">button: event.button,</span>
        <span class="s1">step: event.step,</span>
        <span class="s1">modifiers: getModifiers(event),</span>
        <span class="s1">guiEvent: simpleKeys(event),</span>
    <span class="s1">});</span>

    <span class="s2">return false</span><span class="s1">;</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype._key_event_extra = </span><span class="s2">function </span><span class="s1">(_event, _name) {</span>
    <span class="s0">// Handle any extra behaviour associated with a key event</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.key_event = </span><span class="s2">function </span><span class="s1">(event, name) {</span>
    <span class="s0">// Prevent repeat events</span>
    <span class="s2">if </span><span class="s1">(name === </span><span class="s3">'key_press'</span><span class="s1">) {</span>
        <span class="s2">if </span><span class="s1">(event.key === </span><span class="s2">this</span><span class="s1">._key) {</span>
            <span class="s2">return</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s2">this</span><span class="s1">._key = event.key;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(name === </span><span class="s3">'key_release'</span><span class="s1">) {</span>
        <span class="s2">this</span><span class="s1">._key = </span><span class="s2">null</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s2">var </span><span class="s1">value = </span><span class="s3">''</span><span class="s1">;</span>
    <span class="s2">if </span><span class="s1">(event.ctrlKey &amp;&amp; event.key !== </span><span class="s3">'Control'</span><span class="s1">) {</span>
        <span class="s1">value += </span><span class="s3">'ctrl+'</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">else if </span><span class="s1">(event.altKey &amp;&amp; event.key !== </span><span class="s3">'Alt'</span><span class="s1">) {</span>
        <span class="s1">value += </span><span class="s3">'alt+'</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">else if </span><span class="s1">(event.shiftKey &amp;&amp; event.key !== </span><span class="s3">'Shift'</span><span class="s1">) {</span>
        <span class="s1">value += </span><span class="s3">'shift+'</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s1">value += </span><span class="s3">'k' </span><span class="s1">+ event.key;</span>

    <span class="s2">this</span><span class="s1">._key_event_extra(event, name);</span>

    <span class="s2">this</span><span class="s1">.send_message(name, { key: value, guiEvent: simpleKeys(event) });</span>
    <span class="s2">return false</span><span class="s1">;</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.toolbar_button_onclick = </span><span class="s2">function </span><span class="s1">(name) {</span>
    <span class="s2">if </span><span class="s1">(name === </span><span class="s3">'download'</span><span class="s1">) {</span>
        <span class="s2">this</span><span class="s1">.handle_save(</span><span class="s2">this</span><span class="s1">, </span><span class="s2">null</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s2">this</span><span class="s1">.send_message(</span><span class="s3">'toolbar_button'</span><span class="s1">, { name: name });</span>
    <span class="s1">}</span>
<span class="s1">};</span>

<span class="s1">mpl.figure.prototype.toolbar_button_onmouseover = </span><span class="s2">function </span><span class="s1">(tooltip) {</span>
    <span class="s2">this</span><span class="s1">.message.textContent = tooltip;</span>
<span class="s1">};</span>

<span class="s0">///////////////// REMAINING CONTENT GENERATED BY embed_js.py /////////////////</span>
<span class="s0">// prettier-ignore</span>
<span class="s2">var </span><span class="s1">_JSXTOOLS_RESIZE_OBSERVER=</span><span class="s2">function</span><span class="s1">(A){</span><span class="s2">var </span><span class="s1">t,i=</span><span class="s2">new </span><span class="s1">WeakMap,n=</span><span class="s2">new </span><span class="s1">WeakMap,a=</span><span class="s2">new </span><span class="s1">WeakMap,r=</span><span class="s2">new </span><span class="s1">WeakMap,o=</span><span class="s2">new </span><span class="s1">Set;</span><span class="s2">function </span><span class="s1">s(e){</span><span class="s2">if</span><span class="s1">(!(</span><span class="s2">this instanceof </span><span class="s1">s))</span><span class="s2">throw new </span><span class="s1">TypeError(</span><span class="s3">&quot;Constructor requires 'new' operator&quot;</span><span class="s1">);i.set(</span><span class="s2">this</span><span class="s1">,e)}</span><span class="s2">function </span><span class="s1">h(){</span><span class="s2">throw new </span><span class="s1">TypeError(</span><span class="s3">&quot;Function is not a constructor&quot;</span><span class="s1">)}</span><span class="s2">function </span><span class="s1">c(e,t,i,n){e=</span><span class="s4">0 </span><span class="s2">in </span><span class="s1">arguments?Number(arguments[</span><span class="s4">0</span><span class="s1">]):</span><span class="s4">0</span><span class="s1">,t=</span><span class="s4">1 </span><span class="s2">in </span><span class="s1">arguments?Number(arguments[</span><span class="s4">1</span><span class="s1">]):</span><span class="s4">0</span><span class="s1">,i=</span><span class="s4">2 </span><span class="s2">in </span><span class="s1">arguments?Number(arguments[</span><span class="s4">2</span><span class="s1">]):</span><span class="s4">0</span><span class="s1">,n=</span><span class="s4">3 </span><span class="s2">in </span><span class="s1">arguments?Number(arguments[</span><span class="s4">3</span><span class="s1">]):</span><span class="s4">0</span><span class="s1">,</span><span class="s2">this</span><span class="s1">.right=(</span><span class="s2">this</span><span class="s1">.x=</span><span class="s2">this</span><span class="s1">.left=e)+(</span><span class="s2">this</span><span class="s1">.width=i),</span><span class="s2">this</span><span class="s1">.bottom=(</span><span class="s2">this</span><span class="s1">.y=</span><span class="s2">this</span><span class="s1">.top=t)+(</span><span class="s2">this</span><span class="s1">.height=n),Object.freeze(</span><span class="s2">this</span><span class="s1">)}</span><span class="s2">function </span><span class="s1">d(){t=requestAnimationFrame(d);</span><span class="s2">var </span><span class="s1">s=</span><span class="s2">new </span><span class="s1">WeakMap,p=</span><span class="s2">new </span><span class="s1">Set;o.forEach((</span><span class="s2">function</span><span class="s1">(t){r.get(t).forEach((</span><span class="s2">function</span><span class="s1">(i){</span><span class="s2">var </span><span class="s1">r=t </span><span class="s2">instanceof </span><span class="s1">window.SVGElement,o=a.get(t),d=r?</span><span class="s4">0</span><span class="s1">:parseFloat(o.paddingTop),f=r?</span><span class="s4">0</span><span class="s1">:parseFloat(o.paddingRight),l=r?</span><span class="s4">0</span><span class="s1">:parseFloat(o.paddingBottom),u=r?</span><span class="s4">0</span><span class="s1">:parseFloat(o.paddingLeft),g=r?</span><span class="s4">0</span><span class="s1">:parseFloat(o.borderTopWidth),m=r?</span><span class="s4">0</span><span class="s1">:parseFloat(o.borderRightWidth),w=r?</span><span class="s4">0</span><span class="s1">:parseFloat(o.borderBottomWidth),b=u+f,F=d+l,v=(r?</span><span class="s4">0</span><span class="s1">:parseFloat(o.borderLeftWidth))+m,W=g+w,y=r?</span><span class="s4">0</span><span class="s1">:t.offsetHeight-W-t.clientHeight,E=r?</span><span class="s4">0</span><span class="s1">:t.offsetWidth-v-t.clientWidth,R=b+v,z=F+W,M=r?t.width:parseFloat(o.width)-R-E,O=r?t.height:parseFloat(o.height)-z-y;</span><span class="s2">if</span><span class="s1">(n.has(t)){</span><span class="s2">var </span><span class="s1">k=n.get(t);</span><span class="s2">if</span><span class="s1">(k[</span><span class="s4">0</span><span class="s1">]===M&amp;&amp;k[</span><span class="s4">1</span><span class="s1">]===O)</span><span class="s2">return</span><span class="s1">}n.set(t,[M,O]);</span><span class="s2">var </span><span class="s1">S=Object.create(h.prototype);S.target=t,S.contentRect=</span><span class="s2">new </span><span class="s1">c(u,d,M,O),s.has(i)||(s.set(i,[]),p.add(i)),s.get(i).push(S)}))})),p.forEach((</span><span class="s2">function</span><span class="s1">(e){i.get(e).call(e,s.get(e),e)}))}</span><span class="s2">return </span><span class="s1">s.prototype.observe=</span><span class="s2">function</span><span class="s1">(i){</span><span class="s2">if</span><span class="s1">(i </span><span class="s2">instanceof </span><span class="s1">window.Element){r.has(i)||(r.set(i,</span><span class="s2">new </span><span class="s1">Set),o.add(i),a.set(i,window.getComputedStyle(i)));</span><span class="s2">var </span><span class="s1">n=r.get(i);n.has(</span><span class="s2">this</span><span class="s1">)||n.add(</span><span class="s2">this</span><span class="s1">),cancelAnimationFrame(t),t=requestAnimationFrame(d)}},s.prototype.unobserve=</span><span class="s2">function</span><span class="s1">(i){</span><span class="s2">if</span><span class="s1">(i </span><span class="s2">instanceof </span><span class="s1">window.Element&amp;&amp;r.has(i)){</span><span class="s2">var </span><span class="s1">n=r.get(i);n.has(</span><span class="s2">this</span><span class="s1">)&amp;&amp;(n.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">this</span><span class="s1">),n.size||(r.</span><span class="s2">delete</span><span class="s1">(i),o.</span><span class="s2">delete</span><span class="s1">(i))),n.size||r.</span><span class="s2">delete</span><span class="s1">(i),o.size||cancelAnimationFrame(t)}},A.DOMRectReadOnly=c,A.ResizeObserver=s,A.ResizeObserverEntry=h,A}; </span><span class="s0">// eslint-disable-line</span>
</pre>
</body>
</html>