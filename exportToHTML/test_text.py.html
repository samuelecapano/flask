<html>
<head>
<title>test_text.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_text.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">assert_almost_equal</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib.backend_bases </span><span class="s0">import </span><span class="s1">MouseEvent</span>
<span class="s0">from </span><span class="s1">matplotlib.font_manager </span><span class="s0">import </span><span class="s1">FontProperties</span>
<span class="s0">import </span><span class="s1">matplotlib.patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib.transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s0">, </span><span class="s1">image_comparison</span>
<span class="s0">from </span><span class="s1">matplotlib.testing._markers </span><span class="s0">import </span><span class="s1">needs_usetex</span>
<span class="s0">from </span><span class="s1">matplotlib.text </span><span class="s0">import </span><span class="s1">Text</span>


<span class="s1">@image_comparison([</span><span class="s2">'font_styles'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_font_styles():</span>

    <span class="s0">def </span><span class="s1">find_matplotlib_font(**kw):</span>
        <span class="s1">prop = FontProperties(**kw)</span>
        <span class="s1">path = findfont(prop</span><span class="s0">, </span><span class="s1">directory=mpl.get_data_path())</span>
        <span class="s0">return </span><span class="s1">FontProperties(fname=path)</span>

    <span class="s0">from </span><span class="s1">matplotlib.font_manager </span><span class="s0">import </span><span class="s1">FontProperties</span><span class="s0">, </span><span class="s1">findfont</span>
    <span class="s1">warnings.filterwarnings(</span>
        <span class="s2">'ignore'</span><span class="s0">,</span>
        <span class="s2">r&quot;findfont: Font family \[u?'Foo'\] not found. Falling back to .&quot;</span><span class="s0">,</span>
        <span class="s1">UserWarning</span><span class="s0">,</span>
        <span class="s1">module=</span><span class="s2">'matplotlib.font_manager'</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">normal_font = find_matplotlib_font(</span>
        <span class="s1">family=</span><span class="s2">&quot;sans-serif&quot;</span><span class="s0">,</span>
        <span class="s1">style=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">variant=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">size=</span><span class="s3">14</span><span class="s1">)</span>
    <span class="s1">a = ax.annotate(</span>
        <span class="s2">&quot;Normal Font&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">xycoords=</span><span class="s2">'axes fraction'</span><span class="s0">,</span>
        <span class="s1">fontproperties=normal_font)</span>
    <span class="s0">assert </span><span class="s1">a.get_fontname() == </span><span class="s2">'DejaVu Sans'</span>
    <span class="s0">assert </span><span class="s1">a.get_fontstyle() == </span><span class="s2">'normal'</span>
    <span class="s0">assert </span><span class="s1">a.get_fontvariant() == </span><span class="s2">'normal'</span>
    <span class="s0">assert </span><span class="s1">a.get_weight() == </span><span class="s2">'normal'</span>
    <span class="s0">assert </span><span class="s1">a.get_stretch() == </span><span class="s2">'normal'</span>

    <span class="s1">bold_font = find_matplotlib_font(</span>
        <span class="s1">family=</span><span class="s2">&quot;Foo&quot;</span><span class="s0">,</span>
        <span class="s1">style=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">variant=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">weight=</span><span class="s2">&quot;bold&quot;</span><span class="s0">,</span>
        <span class="s1">stretch=</span><span class="s3">500</span><span class="s0">,</span>
        <span class="s1">size=</span><span class="s3">14</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span>
        <span class="s2">&quot;Bold Font&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">xycoords=</span><span class="s2">'axes fraction'</span><span class="s0">,</span>
        <span class="s1">fontproperties=bold_font)</span>

    <span class="s1">bold_italic_font = find_matplotlib_font(</span>
        <span class="s1">family=</span><span class="s2">&quot;sans serif&quot;</span><span class="s0">,</span>
        <span class="s1">style=</span><span class="s2">&quot;italic&quot;</span><span class="s0">,</span>
        <span class="s1">variant=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">weight=</span><span class="s3">750</span><span class="s0">,</span>
        <span class="s1">stretch=</span><span class="s3">500</span><span class="s0">,</span>
        <span class="s1">size=</span><span class="s3">14</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span>
        <span class="s2">&quot;Bold Italic Font&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.3</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">xycoords=</span><span class="s2">'axes fraction'</span><span class="s0">,</span>
        <span class="s1">fontproperties=bold_italic_font)</span>

    <span class="s1">light_font = find_matplotlib_font(</span>
        <span class="s1">family=</span><span class="s2">&quot;sans-serif&quot;</span><span class="s0">,</span>
        <span class="s1">style=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">variant=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">weight=</span><span class="s3">200</span><span class="s0">,</span>
        <span class="s1">stretch=</span><span class="s3">500</span><span class="s0">,</span>
        <span class="s1">size=</span><span class="s3">14</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span>
        <span class="s2">&quot;Light Font&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">xycoords=</span><span class="s2">'axes fraction'</span><span class="s0">,</span>
        <span class="s1">fontproperties=light_font)</span>

    <span class="s1">condensed_font = find_matplotlib_font(</span>
        <span class="s1">family=</span><span class="s2">&quot;sans-serif&quot;</span><span class="s0">,</span>
        <span class="s1">style=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">variant=</span><span class="s2">&quot;normal&quot;</span><span class="s0">,</span>
        <span class="s1">weight=</span><span class="s3">500</span><span class="s0">,</span>
        <span class="s1">stretch=</span><span class="s3">100</span><span class="s0">,</span>
        <span class="s1">size=</span><span class="s3">14</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span>
        <span class="s2">&quot;Condensed Font&quot;</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">xycoords=</span><span class="s2">'axes fraction'</span><span class="s0">,</span>
        <span class="s1">fontproperties=condensed_font)</span>

    <span class="s1">ax.set_xticks([])</span>
    <span class="s1">ax.set_yticks([])</span>


<span class="s1">@image_comparison([</span><span class="s2">'multiline'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_multiline():</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">ax = plt.subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">&quot;multiline</span><span class="s0">\n</span><span class="s2">text alignment&quot;</span><span class="s1">)</span>

    <span class="s1">plt.text(</span>
        <span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;TpTpTp</span><span class="s0">\n</span><span class="s2">$M$</span><span class="s0">\n</span><span class="s2">TpTpTp&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">20</span><span class="s0">, </span><span class="s1">ha=</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">&quot;top&quot;</span><span class="s1">)</span>

    <span class="s1">plt.text(</span>
        <span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;TpTpTp</span><span class="s0">\n</span><span class="s2">$M^{M^{M^{M}}}$</span><span class="s0">\n</span><span class="s2">TpTpTp&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">20</span><span class="s0">,</span>
        <span class="s1">ha=</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">&quot;top&quot;</span><span class="s1">)</span>

    <span class="s1">plt.text(</span>
        <span class="s3">0.8</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;TpTpTp</span><span class="s0">\n</span><span class="s2">$M_{q_{q_{q}}}$</span><span class="s0">\n</span><span class="s2">TpTpTp&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">20</span><span class="s0">,</span>
        <span class="s1">ha=</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">&quot;top&quot;</span><span class="s1">)</span>

    <span class="s1">plt.xlim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">plt.ylim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.8</span><span class="s1">)</span>

    <span class="s1">ax.set_xticks([])</span>
    <span class="s1">ax.set_yticks([])</span>


<span class="s1">@image_comparison([</span><span class="s2">'multiline2'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_multiline2():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'text.kerning_factor'</span><span class="s1">] = </span><span class="s3">6</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.set_xlim([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1.4</span><span class="s1">])</span>
    <span class="s1">ax.set_ylim([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">ax.axhline(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'C2'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s1">sts = [</span><span class="s2">'Line'</span><span class="s0">, </span><span class="s2">'2 Lineg</span><span class="s0">\n </span><span class="s2">2 Lg'</span><span class="s0">, </span><span class="s2">'$</span><span class="s0">\\</span><span class="s2">sum_i x $'</span><span class="s0">, </span><span class="s2">'hi $</span><span class="s0">\\</span><span class="s2">sum_i x $</span><span class="s0">\n</span><span class="s2">test'</span><span class="s0">,</span>
           <span class="s2">'test</span><span class="s0">\n </span><span class="s2">$</span><span class="s0">\\</span><span class="s2">sum_i x $'</span><span class="s0">, </span><span class="s2">'$</span><span class="s0">\\</span><span class="s2">sum_i x $</span><span class="s0">\n </span><span class="s2">$</span><span class="s0">\\</span><span class="s2">sum_i x $'</span><span class="s1">]</span>
    <span class="s1">renderer = fig.canvas.get_renderer()</span>

    <span class="s0">def </span><span class="s1">draw_box(ax</span><span class="s0">, </span><span class="s1">tt):</span>
        <span class="s1">r = mpatches.Rectangle((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">clip_on=</span><span class="s0">False,</span>
                               <span class="s1">transform=ax.transAxes)</span>
        <span class="s1">r.set_bounds(</span>
            <span class="s1">tt.get_window_extent(renderer)</span>
            <span class="s1">.transformed(ax.transAxes.inverted())</span>
            <span class="s1">.bounds)</span>
        <span class="s1">ax.add_patch(r)</span>

    <span class="s1">horal = </span><span class="s2">'left'</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">st </span><span class="s0">in </span><span class="s1">enumerate(sts):</span>
        <span class="s1">tt = ax.text(</span><span class="s3">0.2 </span><span class="s1">* nn + </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">st</span><span class="s0">, </span><span class="s1">horizontalalignment=horal</span><span class="s0">,</span>
                     <span class="s1">verticalalignment=</span><span class="s2">'bottom'</span><span class="s1">)</span>
        <span class="s1">draw_box(ax</span><span class="s0">, </span><span class="s1">tt)</span>
    <span class="s1">ax.text(</span><span class="s3">1.2</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">'Bottom align'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'C2'</span><span class="s1">)</span>

    <span class="s1">ax.axhline(</span><span class="s3">1.3</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'C2'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">st </span><span class="s0">in </span><span class="s1">enumerate(sts):</span>
        <span class="s1">tt = ax.text(</span><span class="s3">0.2 </span><span class="s1">* nn + </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">1.3</span><span class="s0">, </span><span class="s1">st</span><span class="s0">, </span><span class="s1">horizontalalignment=horal</span><span class="s0">,</span>
                     <span class="s1">verticalalignment=</span><span class="s2">'top'</span><span class="s1">)</span>
        <span class="s1">draw_box(ax</span><span class="s0">, </span><span class="s1">tt)</span>
    <span class="s1">ax.text(</span><span class="s3">1.2</span><span class="s0">, </span><span class="s3">1.3</span><span class="s0">, </span><span class="s2">'Top align'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'C2'</span><span class="s1">)</span>

    <span class="s1">ax.axhline(</span><span class="s3">1.8</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'C2'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">st </span><span class="s0">in </span><span class="s1">enumerate(sts):</span>
        <span class="s1">tt = ax.text(</span><span class="s3">0.2 </span><span class="s1">* nn + </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">1.8</span><span class="s0">, </span><span class="s1">st</span><span class="s0">, </span><span class="s1">horizontalalignment=horal</span><span class="s0">,</span>
                     <span class="s1">verticalalignment=</span><span class="s2">'baseline'</span><span class="s1">)</span>
        <span class="s1">draw_box(ax</span><span class="s0">, </span><span class="s1">tt)</span>
    <span class="s1">ax.text(</span><span class="s3">1.2</span><span class="s0">, </span><span class="s3">1.8</span><span class="s0">, </span><span class="s2">'Baseline align'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'C2'</span><span class="s1">)</span>

    <span class="s1">ax.axhline(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'C2'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">st </span><span class="s0">in </span><span class="s1">enumerate(sts):</span>
        <span class="s1">tt = ax.text(</span><span class="s3">0.2 </span><span class="s1">* nn + </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">st</span><span class="s0">, </span><span class="s1">horizontalalignment=horal</span><span class="s0">,</span>
                     <span class="s1">verticalalignment=</span><span class="s2">'bottom'</span><span class="s0">, </span><span class="s1">rotation=</span><span class="s3">20</span><span class="s1">)</span>
        <span class="s1">draw_box(ax</span><span class="s0">, </span><span class="s1">tt)</span>
    <span class="s1">ax.text(</span><span class="s3">1.2</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s2">'Bot align, rot20'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'C2'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'antialiased.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_antialiasing():</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">'text.antialiased'</span><span class="s1">] = </span><span class="s0">True</span>

    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">5.25</span><span class="s0">, </span><span class="s3">0.75</span><span class="s1">))</span>
    <span class="s1">fig.text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.75</span><span class="s0">, </span><span class="s2">&quot;antialiased&quot;</span><span class="s0">, </span><span class="s1">horizontalalignment=</span><span class="s2">'center'</span><span class="s0">,</span>
             <span class="s1">verticalalignment=</span><span class="s2">'center'</span><span class="s1">)</span>
    <span class="s1">fig.text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s2">r&quot;$\sqrt{x}$&quot;</span><span class="s0">, </span><span class="s1">horizontalalignment=</span><span class="s2">'center'</span><span class="s0">,</span>
             <span class="s1">verticalalignment=</span><span class="s2">'center'</span><span class="s1">)</span>
    <span class="s4"># NOTE: We don't need to restore the rcParams here, because the</span>
    <span class="s4"># test cleanup will do it for us.  In fact, if we do it here, it</span>
    <span class="s4"># will turn antialiasing back off before the images are actually</span>
    <span class="s4"># rendered.</span>


<span class="s0">def </span><span class="s1">test_afm_kerning():</span>
    <span class="s1">fn = mpl.font_manager.findfont(</span><span class="s2">&quot;Helvetica&quot;</span><span class="s0">, </span><span class="s1">fontext=</span><span class="s2">&quot;afm&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">open(fn</span><span class="s0">, </span><span class="s2">'rb'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">fh:</span>
        <span class="s1">afm = mpl._afm.AFM(fh)</span>
    <span class="s0">assert </span><span class="s1">afm.string_width_height(</span><span class="s2">'VAVAVAVAVAVA'</span><span class="s1">) == (</span><span class="s3">7174.0</span><span class="s0">, </span><span class="s3">718</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'text_contains.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contains():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = plt.axes()</span>

    <span class="s1">mevent = MouseEvent(</span><span class="s2">'button_press_event'</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, None</span><span class="s1">)</span>

    <span class="s1">xs = np.linspace(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.75</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span>
    <span class="s1">ys = np.linspace(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.75</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span>
    <span class="s1">xs</span><span class="s0">, </span><span class="s1">ys = np.meshgrid(xs</span><span class="s0">, </span><span class="s1">ys)</span>

    <span class="s1">txt = plt.text(</span>
        <span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.4</span><span class="s0">, </span><span class="s2">'hello world'</span><span class="s0">, </span><span class="s1">ha=</span><span class="s2">'center'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">30</span><span class="s0">, </span><span class="s1">rotation=</span><span class="s3">30</span><span class="s1">)</span>
    <span class="s4"># uncomment to draw the text's bounding box</span>
    <span class="s4"># txt.set_bbox(dict(edgecolor='black', facecolor='none'))</span>

    <span class="s4"># draw the text. This is important, as the contains method can only work</span>
    <span class="s4"># when a renderer exists.</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">zip(xs.flat</span><span class="s0">, </span><span class="s1">ys.flat):</span>
        <span class="s1">mevent.x</span><span class="s0">, </span><span class="s1">mevent.y = plt.gca().transAxes.transform([x</span><span class="s0">, </span><span class="s1">y])</span>
        <span class="s1">contains</span><span class="s0">, </span><span class="s1">_ = txt.contains(mevent)</span>
        <span class="s1">color = </span><span class="s2">'yellow' </span><span class="s0">if </span><span class="s1">contains </span><span class="s0">else </span><span class="s2">'red'</span>

        <span class="s4"># capture the viewLim, plot a point, and reset the viewLim</span>
        <span class="s1">vl = ax.viewLim.frozen()</span>
        <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s2">'o'</span><span class="s0">, </span><span class="s1">color=color)</span>
        <span class="s1">ax.viewLim.set(vl)</span>


<span class="s0">def </span><span class="s1">test_annotation_contains():</span>
    <span class="s4"># Check that Annotation.contains looks at the bboxes of the text and the</span>
    <span class="s4"># arrow separately, not at the joint bbox.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ann = ax.annotate(</span>
        <span class="s2">&quot;hello&quot;</span><span class="s0">, </span><span class="s1">xy=(</span><span class="s3">.4</span><span class="s0">, </span><span class="s3">.4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xytext=(</span><span class="s3">.6</span><span class="s0">, </span><span class="s3">.6</span><span class="s1">)</span><span class="s0">, </span><span class="s1">arrowprops={</span><span class="s2">&quot;arrowstyle&quot;</span><span class="s1">: </span><span class="s2">&quot;-&gt;&quot;</span><span class="s1">})</span>
    <span class="s1">fig.canvas.draw()  </span><span class="s4"># Needed for the same reason as in test_contains.</span>
    <span class="s1">event = MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">fig.canvas</span><span class="s0">, </span><span class="s1">*ax.transData.transform((</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.6</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">ann.contains(event) == (</span><span class="s0">False, </span><span class="s1">{})</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'err, xycoords, match'</span><span class="s0">, </span><span class="s1">(</span>
    <span class="s1">(RuntimeError</span><span class="s0">, </span><span class="s1">print</span><span class="s0">, </span><span class="s2">&quot;Unknown return type&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(RuntimeError</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">r&quot;Unknown coordinate type: \[0, 0\]&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(ValueError</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;'foo' is not a recognized coordinate&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(ValueError</span><span class="s0">, </span><span class="s2">&quot;foo bar&quot;</span><span class="s0">, </span><span class="s2">&quot;'foo bar' is not a recognized coordinate&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(ValueError</span><span class="s0">, </span><span class="s2">&quot;offset foo&quot;</span><span class="s0">, </span><span class="s2">&quot;xycoords cannot be an offset coordinate&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(ValueError</span><span class="s0">, </span><span class="s2">&quot;axes foo&quot;</span><span class="s0">, </span><span class="s2">&quot;'foo' is not a recognized unit&quot;</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_annotate_errors(err</span><span class="s0">, </span><span class="s1">xycoords</span><span class="s0">, </span><span class="s1">match):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(err</span><span class="s0">, </span><span class="s1">match=match):</span>
        <span class="s1">ax.annotate(</span><span class="s2">'xy'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xytext=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xycoords=xycoords)</span>
        <span class="s1">fig.canvas.draw()</span>


<span class="s1">@image_comparison([</span><span class="s2">'titles'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_titles():</span>
    <span class="s4"># left and right side titles</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">ax = plt.subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">&quot;left title&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">&quot;left&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">&quot;right title&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">&quot;right&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_xticks([])</span>
    <span class="s1">ax.set_yticks([])</span>


<span class="s1">@image_comparison([</span><span class="s2">'text_alignment'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_alignment():</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">ax = plt.subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">x = </span><span class="s3">0.1</span>
    <span class="s0">for </span><span class="s1">rotation </span><span class="s0">in </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">30</span><span class="s1">):</span>
        <span class="s0">for </span><span class="s1">alignment </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'top'</span><span class="s0">, </span><span class="s2">'bottom'</span><span class="s0">, </span><span class="s2">'baseline'</span><span class="s0">, </span><span class="s2">'center'</span><span class="s1">):</span>
            <span class="s1">ax.text(</span>
                <span class="s1">x</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">alignment + </span><span class="s2">&quot; Tj&quot;</span><span class="s0">, </span><span class="s1">va=alignment</span><span class="s0">, </span><span class="s1">rotation=rotation</span><span class="s0">,</span>
                <span class="s1">bbox=dict(boxstyle=</span><span class="s2">'round'</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s2">'wheat'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">))</span>
            <span class="s1">ax.text(</span>
                <span class="s1">x</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s2">r'$\sum_{i=0}^{j}$'</span><span class="s0">, </span><span class="s1">va=alignment</span><span class="s0">, </span><span class="s1">rotation=rotation)</span>
            <span class="s1">x += </span><span class="s3">0.1</span>

    <span class="s1">ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">])</span>
    <span class="s1">ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">])</span>

    <span class="s1">ax.set_xlim([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax.set_ylim([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1.5</span><span class="s1">])</span>
    <span class="s1">ax.set_xticks([])</span>
    <span class="s1">ax.set_yticks([])</span>


<span class="s1">@image_comparison([</span><span class="s2">'axes_titles.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_axes_titles():</span>
    <span class="s4"># Related to issue #3327</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">ax = plt.subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">'center'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'center'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">20</span><span class="s0">, </span><span class="s1">fontweight=</span><span class="s3">700</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">'left'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'left'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">12</span><span class="s0">, </span><span class="s1">fontweight=</span><span class="s3">400</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">'right'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'right'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">12</span><span class="s0">, </span><span class="s1">fontweight=</span><span class="s3">400</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_set_position():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s4"># test set_position</span>
    <span class="s1">ann = ax.annotate(</span>
        <span class="s2">'test'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xytext=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'figure pixels'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s1">init_pos = ann.get_window_extent(fig.canvas.renderer)</span>
    <span class="s1">shift_val = </span><span class="s3">15</span>
    <span class="s1">ann.set_position((shift_val</span><span class="s0">, </span><span class="s1">shift_val))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">post_pos = ann.get_window_extent(fig.canvas.renderer)</span>

    <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">zip(init_pos.min</span><span class="s0">, </span><span class="s1">post_pos.min):</span>
        <span class="s0">assert </span><span class="s1">a + shift_val == b</span>

    <span class="s4"># test xyann</span>
    <span class="s1">ann = ax.annotate(</span>
        <span class="s2">'test'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xytext=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'figure pixels'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s1">init_pos = ann.get_window_extent(fig.canvas.renderer)</span>
    <span class="s1">shift_val = </span><span class="s3">15</span>
    <span class="s1">ann.xyann = (shift_val</span><span class="s0">, </span><span class="s1">shift_val)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">post_pos = ann.get_window_extent(fig.canvas.renderer)</span>

    <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">zip(init_pos.min</span><span class="s0">, </span><span class="s1">post_pos.min):</span>
        <span class="s0">assert </span><span class="s1">a + shift_val == b</span>


<span class="s0">def </span><span class="s1">test_char_index_at():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">text = fig.text(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.9</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">)</span>

    <span class="s1">text.set_text(</span><span class="s2">&quot;i&quot;</span><span class="s1">)</span>
    <span class="s1">bbox = text.get_window_extent()</span>
    <span class="s1">size_i = bbox.x1 - bbox.x0</span>

    <span class="s1">text.set_text(</span><span class="s2">&quot;m&quot;</span><span class="s1">)</span>
    <span class="s1">bbox = text.get_window_extent()</span>
    <span class="s1">size_m = bbox.x1 - bbox.x0</span>

    <span class="s1">text.set_text(</span><span class="s2">&quot;iiiimmmm&quot;</span><span class="s1">)</span>
    <span class="s1">bbox = text.get_window_extent()</span>
    <span class="s1">origin = bbox.x0</span>

    <span class="s0">assert </span><span class="s1">text._char_index_at(origin - size_i) == </span><span class="s3">0  </span><span class="s4"># left of first char</span>
    <span class="s0">assert </span><span class="s1">text._char_index_at(origin) == </span><span class="s3">0</span>
    <span class="s0">assert </span><span class="s1">text._char_index_at(origin + </span><span class="s3">0.499</span><span class="s1">*size_i) == </span><span class="s3">0</span>
    <span class="s0">assert </span><span class="s1">text._char_index_at(origin + </span><span class="s3">0.501</span><span class="s1">*size_i) == </span><span class="s3">1</span>
    <span class="s0">assert </span><span class="s1">text._char_index_at(origin + size_i*</span><span class="s3">3</span><span class="s1">) == </span><span class="s3">3</span>
    <span class="s0">assert </span><span class="s1">text._char_index_at(origin + size_i*</span><span class="s3">4 </span><span class="s1">+ size_m*</span><span class="s3">3</span><span class="s1">) == </span><span class="s3">7</span>
    <span class="s0">assert </span><span class="s1">text._char_index_at(origin + size_i*</span><span class="s3">4 </span><span class="s1">+ size_m*</span><span class="s3">4</span><span class="s1">) == </span><span class="s3">8</span>
    <span class="s0">assert </span><span class="s1">text._char_index_at(origin + size_i*</span><span class="s3">4 </span><span class="s1">+ size_m*</span><span class="s3">10</span><span class="s1">) == </span><span class="s3">8</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'text'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">''</span><span class="s0">, </span><span class="s2">'O'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ids=[</span><span class="s2">'empty'</span><span class="s0">, </span><span class="s2">'non-empty'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_non_default_dpi(text):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">t1 = ax.text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">text</span><span class="s0">, </span><span class="s1">ha=</span><span class="s2">'left'</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">'bottom'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">dpi = fig.dpi</span>

    <span class="s1">bbox1 = t1.get_window_extent()</span>
    <span class="s1">bbox2 = t1.get_window_extent(dpi=dpi * </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(bbox2.get_points()</span><span class="s0">, </span><span class="s1">bbox1.get_points() * </span><span class="s3">10</span><span class="s0">,</span>
                               <span class="s1">rtol=</span><span class="s3">5e-2</span><span class="s1">)</span>
    <span class="s4"># Text.get_window_extent should not permanently change dpi.</span>
    <span class="s0">assert </span><span class="s1">fig.dpi == dpi</span>


<span class="s0">def </span><span class="s1">test_get_rotation_string():</span>
    <span class="s0">assert </span><span class="s1">Text(rotation=</span><span class="s2">'horizontal'</span><span class="s1">).get_rotation() == </span><span class="s3">0.</span>
    <span class="s0">assert </span><span class="s1">Text(rotation=</span><span class="s2">'vertical'</span><span class="s1">).get_rotation() == </span><span class="s3">90.</span>


<span class="s0">def </span><span class="s1">test_get_rotation_float():</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">[</span><span class="s3">15.</span><span class="s0">, </span><span class="s3">16.70</span><span class="s0">, </span><span class="s3">77.4</span><span class="s1">]:</span>
        <span class="s0">assert </span><span class="s1">Text(rotation=i).get_rotation() == i</span>


<span class="s0">def </span><span class="s1">test_get_rotation_int():</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">[</span><span class="s3">67</span><span class="s0">, </span><span class="s3">16</span><span class="s0">, </span><span class="s3">41</span><span class="s1">]:</span>
        <span class="s0">assert </span><span class="s1">Text(rotation=i).get_rotation() == float(i)</span>


<span class="s0">def </span><span class="s1">test_get_rotation_raises():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">Text(rotation=</span><span class="s2">'hozirontal'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_get_rotation_none():</span>
    <span class="s0">assert </span><span class="s1">Text(rotation=</span><span class="s0">None</span><span class="s1">).get_rotation() == </span><span class="s3">0.0</span>


<span class="s0">def </span><span class="s1">test_get_rotation_mod360():</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">j </span><span class="s0">in </span><span class="s1">zip([</span><span class="s3">360.</span><span class="s0">, </span><span class="s3">377.</span><span class="s0">, </span><span class="s3">720</span><span class="s1">+</span><span class="s3">177.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">17.</span><span class="s0">, </span><span class="s3">177.2</span><span class="s1">]):</span>
        <span class="s1">assert_almost_equal(Text(rotation=i).get_rotation()</span><span class="s0">, </span><span class="s1">j)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;ha&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s2">&quot;right&quot;</span><span class="s0">, </span><span class="s2">&quot;left&quot;</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;va&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;center&quot;</span><span class="s0">, </span><span class="s2">&quot;top&quot;</span><span class="s0">, </span><span class="s2">&quot;bottom&quot;</span><span class="s0">,</span>
                                <span class="s2">&quot;baseline&quot;</span><span class="s0">, </span><span class="s2">&quot;center_baseline&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_null_rotation_with_rotation_mode(ha</span><span class="s0">, </span><span class="s1">va):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">kw = dict(rotation=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">va=va</span><span class="s0">, </span><span class="s1">ha=ha)</span>
    <span class="s1">t0 = ax.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">'test'</span><span class="s0">, </span><span class="s1">rotation_mode=</span><span class="s2">'anchor'</span><span class="s0">, </span><span class="s1">**kw)</span>
    <span class="s1">t1 = ax.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">'test'</span><span class="s0">, </span><span class="s1">rotation_mode=</span><span class="s2">'default'</span><span class="s0">, </span><span class="s1">**kw)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">assert_almost_equal(t0.get_window_extent(fig.canvas.renderer).get_points()</span><span class="s0">,</span>
                        <span class="s1">t1.get_window_extent(fig.canvas.renderer).get_points())</span>


<span class="s1">@image_comparison([</span><span class="s2">'text_bboxclip'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bbox_clipping():</span>
    <span class="s1">plt.text(</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s2">'Is bbox clipped?'</span><span class="s0">, </span><span class="s1">backgroundcolor=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">clip_on=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">t = plt.text(</span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">'Is fancy bbox clipped?'</span><span class="s0">, </span><span class="s1">clip_on=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">t.set_bbox({</span><span class="s2">&quot;boxstyle&quot;</span><span class="s1">: </span><span class="s2">&quot;round, pad=0.1&quot;</span><span class="s1">})</span>


<span class="s1">@image_comparison([</span><span class="s2">'annotation_negative_ax_coords.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_annotation_negative_ax_coords():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.annotate(</span><span class="s2">'+ pts'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">30</span><span class="s0">, </span><span class="s3">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'axes points'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">30</span><span class="s0">, </span><span class="s3">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'axes points'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">'- pts'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">30</span><span class="s0">, </span><span class="s1">-</span><span class="s3">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'axes points'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">30</span><span class="s0">, </span><span class="s1">-</span><span class="s3">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'axes points'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s0">,</span>
                <span class="s1">va=</span><span class="s2">'top'</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">'+ frac'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">0.75</span><span class="s0">, </span><span class="s3">0.05</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'axes fraction'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">0.75</span><span class="s0">, </span><span class="s3">0.05</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'axes fraction'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">'- frac'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">0.75</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.05</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'axes fraction'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">0.75</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.05</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'axes fraction'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s0">,</span>
                <span class="s1">va=</span><span class="s2">'top'</span><span class="s1">)</span>

    <span class="s1">ax.annotate(</span><span class="s2">'+ pixels'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">160</span><span class="s0">, </span><span class="s3">25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'axes pixels'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">160</span><span class="s0">, </span><span class="s3">25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'axes pixels'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">'- pixels'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">160</span><span class="s0">, </span><span class="s1">-</span><span class="s3">25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'axes pixels'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">160</span><span class="s0">, </span><span class="s1">-</span><span class="s3">25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'axes pixels'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s0">,</span>
                <span class="s1">va=</span><span class="s2">'top'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'annotation_negative_fig_coords.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_annotation_negative_fig_coords():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.annotate(</span><span class="s2">'+ pts'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">120</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'figure points'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">120</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'figure points'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">'- pts'</span><span class="s0">,</span>
                <span class="s1">xytext=[-</span><span class="s3">10</span><span class="s0">, </span><span class="s3">180</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'figure points'</span><span class="s0">,</span>
                <span class="s1">xy=[-</span><span class="s3">10</span><span class="s0">, </span><span class="s3">180</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'figure points'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s0">,</span>
                <span class="s1">va=</span><span class="s2">'top'</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">'+ frac'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.55</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'figure fraction'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.55</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'figure fraction'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">'- frac'</span><span class="s0">,</span>
                <span class="s1">xytext=[-</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'figure fraction'</span><span class="s0">,</span>
                <span class="s1">xy=[-</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'figure fraction'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s0">,</span>
                <span class="s1">va=</span><span class="s2">'top'</span><span class="s1">)</span>

    <span class="s1">ax.annotate(</span><span class="s2">'+ pixels'</span><span class="s0">,</span>
                <span class="s1">xytext=[</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'figure pixels'</span><span class="s0">,</span>
                <span class="s1">xy=[</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'figure pixels'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">'- pixels'</span><span class="s0">,</span>
                <span class="s1">xytext=[-</span><span class="s3">50</span><span class="s0">, </span><span class="s3">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">'figure pixels'</span><span class="s0">,</span>
                <span class="s1">xy=[-</span><span class="s3">50</span><span class="s0">, </span><span class="s3">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s2">'figure pixels'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">32</span><span class="s0">,</span>
                <span class="s1">va=</span><span class="s2">'top'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_text_stale():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">plt.draw_all()</span>
    <span class="s0">assert not </span><span class="s1">ax1.stale</span>
    <span class="s0">assert not </span><span class="s1">ax2.stale</span>
    <span class="s0">assert not </span><span class="s1">fig.stale</span>

    <span class="s1">txt1 = ax1.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">'aardvark'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax1.stale</span>
    <span class="s0">assert </span><span class="s1">txt1.stale</span>
    <span class="s0">assert </span><span class="s1">fig.stale</span>

    <span class="s1">ann1 = ax2.annotate(</span><span class="s2">'aardvark'</span><span class="s0">, </span><span class="s1">xy=[</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax2.stale</span>
    <span class="s0">assert </span><span class="s1">ann1.stale</span>
    <span class="s0">assert </span><span class="s1">fig.stale</span>

    <span class="s1">plt.draw_all()</span>
    <span class="s0">assert not </span><span class="s1">ax1.stale</span>
    <span class="s0">assert not </span><span class="s1">ax2.stale</span>
    <span class="s0">assert not </span><span class="s1">fig.stale</span>


<span class="s1">@image_comparison([</span><span class="s2">'agg_text_clip.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_agg_text_clip():</span>
    <span class="s1">np.random.seed(</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">np.random.rand(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">2</span><span class="s1">):</span>
        <span class="s1">ax1.text(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">clip_on=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">ax2.text(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_text_size_binding():</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">'font.size'</span><span class="s1">] = </span><span class="s3">10</span>
    <span class="s1">fp = mpl.font_manager.FontProperties(size=</span><span class="s2">'large'</span><span class="s1">)</span>
    <span class="s1">sz1 = fp.get_size_in_points()</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">'font.size'</span><span class="s1">] = </span><span class="s3">100</span>

    <span class="s0">assert </span><span class="s1">sz1 == fp.get_size_in_points()</span>


<span class="s1">@image_comparison([</span><span class="s2">'font_scaling.pdf'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_font_scaling():</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">'pdf.fonttype'</span><span class="s1">] = </span><span class="s3">42</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s3">6.4</span><span class="s0">, </span><span class="s3">12.4</span><span class="s1">))</span>
    <span class="s1">ax.xaxis.set_major_locator(plt.NullLocator())</span>
    <span class="s1">ax.yaxis.set_major_locator(plt.NullLocator())</span>
    <span class="s1">ax.set_ylim(-</span><span class="s3">10</span><span class="s0">, </span><span class="s3">600</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">fs </span><span class="s0">in </span><span class="s1">enumerate(range(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">43</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)):</span>
        <span class="s1">ax.text(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s1">i*</span><span class="s3">30</span><span class="s0">, </span><span class="s2">&quot;{fs} pt font size&quot;</span><span class="s1">.format(fs=fs)</span><span class="s0">, </span><span class="s1">fontsize=fs)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'spacing1, spacing2'</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">0.4</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_two_2line_texts(spacing1</span><span class="s0">, </span><span class="s1">spacing2):</span>
    <span class="s1">text_string = </span><span class="s2">'line1</span><span class="s0">\n</span><span class="s2">line2'</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">renderer = fig.canvas.get_renderer()</span>

    <span class="s1">text1 = fig.text(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">text_string</span><span class="s0">, </span><span class="s1">linespacing=spacing1)</span>
    <span class="s1">text2 = fig.text(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">text_string</span><span class="s0">, </span><span class="s1">linespacing=spacing2)</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s1">box1 = text1.get_window_extent(renderer=renderer)</span>
    <span class="s1">box2 = text2.get_window_extent(renderer=renderer)</span>

    <span class="s4"># line spacing only affects height</span>
    <span class="s0">assert </span><span class="s1">box1.width == box2.width</span>
    <span class="s0">if </span><span class="s1">spacing1 == spacing2:</span>
        <span class="s0">assert </span><span class="s1">box1.height == box2.height</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">box1.height != box2.height</span>


<span class="s0">def </span><span class="s1">test_validate_linespacing():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">plt.text(</span><span class="s3">.25</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">linespacing=</span><span class="s2">&quot;abc&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_nonfinite_pos():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s2">'nan'</span><span class="s1">)</span>
    <span class="s1">ax.text(np.inf</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">'inf'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s0">def </span><span class="s1">test_hinting_factor_backends():</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'text.hinting_factor'</span><span class="s1">] = </span><span class="s3">1</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">t = fig.text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">'some text'</span><span class="s1">)</span>

    <span class="s1">fig.savefig(io.BytesIO()</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">'svg'</span><span class="s1">)</span>
    <span class="s1">expected = t.get_window_extent().intervalx</span>

    <span class="s1">fig.savefig(io.BytesIO()</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">'png'</span><span class="s1">)</span>
    <span class="s4"># Backends should apply hinting_factor consistently (within 10%).</span>
    <span class="s1">np.testing.assert_allclose(t.get_window_extent().intervalx</span><span class="s0">, </span><span class="s1">expected</span><span class="s0">,</span>
                               <span class="s1">rtol=</span><span class="s3">0.1</span><span class="s1">)</span>


<span class="s1">@needs_usetex</span>
<span class="s0">def </span><span class="s1">test_usetex_is_copied():</span>
    <span class="s4"># Indirectly tests that update_from (which is used to copy tick label</span>
    <span class="s4"># properties) copies usetex state.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">plt.rcParams[</span><span class="s2">&quot;text.usetex&quot;</span><span class="s1">] = </span><span class="s0">False</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">121</span><span class="s1">)</span>
    <span class="s1">plt.rcParams[</span><span class="s2">&quot;text.usetex&quot;</span><span class="s1">] = </span><span class="s0">True</span>
    <span class="s1">ax2 = fig.add_subplot(</span><span class="s3">122</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">usetex </span><span class="s0">in </span><span class="s1">[(ax1</span><span class="s0">, False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(ax2</span><span class="s0">, True</span><span class="s1">)]:</span>
        <span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">ax.xaxis.majorTicks:</span>
            <span class="s0">assert </span><span class="s1">t.label1.get_usetex() == usetex</span>


<span class="s1">@needs_usetex</span>
<span class="s0">def </span><span class="s1">test_single_artist_usetex():</span>
    <span class="s4"># Check that a single artist marked with usetex does not get passed through</span>
    <span class="s4"># the mathtext parser at all (for the Agg backend) (the mathtext parser</span>
    <span class="s4"># currently fails to parse \frac12, requiring \frac{1}{2} instead).</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">r&quot;$\frac12$&quot;</span><span class="s0">, </span><span class="s1">usetex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;fmt&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;png&quot;</span><span class="s0">, </span><span class="s2">&quot;pdf&quot;</span><span class="s0">, </span><span class="s2">&quot;svg&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_single_artist_usenotex(fmt):</span>
    <span class="s4"># Check that a single artist can be marked as not-usetex even though the</span>
    <span class="s4"># rcParam is on (&quot;2_2_2&quot; fails if passed to TeX).  This currently skips</span>
    <span class="s4"># postscript output as the ps renderer doesn't support mixing usetex and</span>
    <span class="s4"># non-usetex.</span>
    <span class="s1">plt.rcParams[</span><span class="s2">&quot;text.usetex&quot;</span><span class="s1">] = </span><span class="s0">True</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">&quot;2_2_2&quot;</span><span class="s0">, </span><span class="s1">usetex=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig.savefig(io.BytesIO()</span><span class="s0">, </span><span class="s1">format=fmt)</span>


<span class="s1">@image_comparison([</span><span class="s2">'text_as_path_opacity.svg'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_text_as_path_opacity():</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.gca().set_axis_off()</span>
    <span class="s1">plt.text(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s2">'c'</span><span class="s0">, </span><span class="s1">color=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">))</span>
    <span class="s1">plt.text(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">'a'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">plt.text(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.75</span><span class="s0">, </span><span class="s2">'x'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">color=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s2">'text_as_text_opacity.svg'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_text_as_text_opacity():</span>
    <span class="s1">mpl.rcParams[</span><span class="s2">'svg.fonttype'</span><span class="s1">] = </span><span class="s2">'none'</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.gca().set_axis_off()</span>
    <span class="s1">plt.text(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s2">'50% using `color`'</span><span class="s0">, </span><span class="s1">color=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">))</span>
    <span class="s1">plt.text(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">'50% using `alpha`'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">plt.text(</span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.75</span><span class="s0">, </span><span class="s2">'50% using `alpha` and 100% `color`'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s0">,</span>
             <span class="s1">color=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_text_repr():</span>
    <span class="s4"># smoketest to make sure text repr doesn't error for category</span>
    <span class="s1">plt.plot([</span><span class="s2">'A'</span><span class="s0">, </span><span class="s2">'B'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">repr(plt.text([</span><span class="s2">'A'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">'Boo'</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_annotation_update():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">an = ax.annotate(</span><span class="s2">'annotation'</span><span class="s0">, </span><span class="s1">xy=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">))</span>
    <span class="s1">extent1 = an.get_window_extent(fig.canvas.get_renderer())</span>
    <span class="s1">fig.tight_layout()</span>
    <span class="s1">extent2 = an.get_window_extent(fig.canvas.get_renderer())</span>

    <span class="s0">assert not </span><span class="s1">np.allclose(extent1.get_points()</span><span class="s0">, </span><span class="s1">extent2.get_points()</span><span class="s0">,</span>
                           <span class="s1">rtol=</span><span class="s3">1e-6</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_annotation_units(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.add_subplot()</span>
    <span class="s1">ax.plot(datetime.now()</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;o&quot;</span><span class="s1">)  </span><span class="s4"># Implicitly set axes extents.</span>
    <span class="s1">ax.annotate(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s1">(datetime.now()</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xycoords=(</span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;axes fraction&quot;</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s4"># This used to crash before.</span>
                <span class="s1">xytext=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s2">&quot;offset points&quot;</span><span class="s1">)</span>
    <span class="s1">ax = fig_ref.add_subplot()</span>
    <span class="s1">ax.plot(datetime.now()</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;o&quot;</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s1">(datetime.now()</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xycoords=(</span><span class="s2">&quot;data&quot;</span><span class="s0">, </span><span class="s2">&quot;axes fraction&quot;</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s2">'large_subscript_title.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_large_subscript_title():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'text.kerning_factor'</span><span class="s1">] = </span><span class="s3">6</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'axes.titley'</span><span class="s1">] = </span><span class="s0">None</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">9</span><span class="s0">, </span><span class="s3">2.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax = axs[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">ax.set_title(</span><span class="s2">r'$\sum_{i} x_i$'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">'New way'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'left'</span><span class="s1">)</span>
    <span class="s1">ax.set_xticklabels([])</span>

    <span class="s1">ax = axs[</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">ax.set_title(</span><span class="s2">r'$\sum_{i} x_i$'</span><span class="s0">, </span><span class="s1">y=</span><span class="s3">1.01</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s2">'Old Way'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s2">'left'</span><span class="s1">)</span>
    <span class="s1">ax.set_xticklabels([])</span>


<span class="s0">def </span><span class="s1">test_wrap():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>
    <span class="s1">s = </span><span class="s2">'This is a very long text that should be wrapped multiple times.'</span>
    <span class="s1">text = fig.text(</span><span class="s3">0.7</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">wrap=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">text._get_wrapped_text() == (</span><span class="s2">'This is a very long</span><span class="s0">\n</span><span class="s2">'</span>
                                        <span class="s2">'text that should be</span><span class="s0">\n</span><span class="s2">'</span>
                                        <span class="s2">'wrapped multiple</span><span class="s0">\n</span><span class="s2">'</span>
                                        <span class="s2">'times.'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_long_word_wrap():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>
    <span class="s1">text = fig.text(</span><span class="s3">9.5</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s2">'Alonglineoftexttowrap'</span><span class="s0">, </span><span class="s1">wrap=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">text._get_wrapped_text() == </span><span class="s2">'Alonglineoftexttowrap'</span>


<span class="s0">def </span><span class="s1">test_wrap_no_wrap():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>
    <span class="s1">text = fig.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">'non wrapped text'</span><span class="s0">, </span><span class="s1">wrap=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">text._get_wrapped_text() == </span><span class="s2">'non wrapped text'</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_buffer_size(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s4"># On old versions of the Agg renderer, large non-ascii single-character</span>
    <span class="s4"># strings (here, &quot;&quot;) would be rendered clipped because the rendering</span>
    <span class="s4"># buffer would be set by the physical size of the smaller &quot;a&quot; character.</span>
    <span class="s1">ax = fig_test.add_subplot()</span>
    <span class="s1">ax.set_yticks([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax.set_yticklabels([</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;a&quot;</span><span class="s1">])</span>
    <span class="s1">ax.yaxis.majorTicks[</span><span class="s3">1</span><span class="s1">].label1.set_color(</span><span class="s2">&quot;w&quot;</span><span class="s1">)</span>
    <span class="s1">ax = fig_ref.add_subplot()</span>
    <span class="s1">ax.set_yticks([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax.set_yticklabels([</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_fontproperties_kwarg_precedence():</span>
    <span class="s5">&quot;&quot;&quot;Test that kwargs take precedence over fontproperties defaults.&quot;&quot;&quot;</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">text1 = plt.xlabel(</span><span class="s2">&quot;value&quot;</span><span class="s0">, </span><span class="s1">fontproperties=</span><span class="s2">'Times New Roman'</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">40.0</span><span class="s1">)</span>
    <span class="s1">text2 = plt.ylabel(</span><span class="s2">&quot;counts&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">40.0</span><span class="s0">, </span><span class="s1">fontproperties=</span><span class="s2">'Times New Roman'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">text1.get_size() == </span><span class="s3">40.0</span>
    <span class="s0">assert </span><span class="s1">text2.get_size() == </span><span class="s3">40.0</span>


<span class="s0">def </span><span class="s1">test_transform_rotates_text():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">transform = mtransforms.Affine2D().rotate_deg(</span><span class="s3">30</span><span class="s1">)</span>
    <span class="s1">text = ax.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">'test'</span><span class="s0">, </span><span class="s1">transform=transform</span><span class="s0">,</span>
                   <span class="s1">transform_rotates_text=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">result = text.get_rotation()</span>
    <span class="s1">assert_almost_equal(result</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_update_mutate_input():</span>
    <span class="s1">inp = dict(fontproperties=FontProperties(weight=</span><span class="s2">&quot;bold&quot;</span><span class="s1">)</span><span class="s0">,</span>
               <span class="s1">bbox=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">cache = dict(inp)</span>
    <span class="s1">t = Text()</span>
    <span class="s1">t.update(inp)</span>
    <span class="s0">assert </span><span class="s1">inp[</span><span class="s2">'fontproperties'</span><span class="s1">] == cache[</span><span class="s2">'fontproperties'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">inp[</span><span class="s2">'bbox'</span><span class="s1">] == cache[</span><span class="s2">'bbox'</span><span class="s1">]</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'rotation'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'invalid string'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">90</span><span class="s1">]])</span>
<span class="s0">def </span><span class="s1">test_invalid_rotation_values(rotation):</span>
    <span class="s0">with </span><span class="s1">pytest.raises(</span>
            <span class="s1">ValueError</span><span class="s0">,</span>
            <span class="s1">match=(</span><span class="s2">&quot;rotation must be 'vertical', 'horizontal' or a number&quot;</span><span class="s1">)):</span>
        <span class="s1">Text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">'foo'</span><span class="s0">, </span><span class="s1">rotation=rotation)</span>


<span class="s0">def </span><span class="s1">test_invalid_color():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.figtext(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">c=</span><span class="s2">&quot;foobar&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'text_pdf_kerning.pdf'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pdf_kerning():</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.figtext(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;ATATATATATATATATATA&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">30</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_unsupported_script(recwarn):</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\N{BENGALI DIGIT ZERO}</span><span class="s2">&quot;</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">all(isinstance(warn.message</span><span class="s0">, </span><span class="s1">UserWarning) </span><span class="s0">for </span><span class="s1">warn </span><span class="s0">in </span><span class="s1">recwarn)</span>
    <span class="s0">assert </span><span class="s1">(</span>
        <span class="s1">[warn.message.args </span><span class="s0">for </span><span class="s1">warn </span><span class="s0">in </span><span class="s1">recwarn] ==</span>
        <span class="s1">[(</span><span class="s2">r&quot;Glyph 2534 (\N{BENGALI DIGIT ZERO}) missing from current font.&quot;</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,</span>
         <span class="s1">(</span><span class="s2">r&quot;Matplotlib currently does not support Bengali natively.&quot;</span><span class="s0">,</span><span class="s1">)])</span>


<span class="s0">def </span><span class="s1">test_parse_math():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">r&quot;$ \wrong{math} $&quot;</span><span class="s0">, </span><span class="s1">parse_math=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s1">ax.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">r&quot;$ \wrong{math} $&quot;</span><span class="s0">, </span><span class="s1">parse_math=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'Unknown symbol'</span><span class="s1">):</span>
        <span class="s1">fig.canvas.draw()</span>


<span class="s0">def </span><span class="s1">test_parse_math_rcparams():</span>
    <span class="s4"># Default is True</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">r&quot;$ \wrong{math} $&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'Unknown symbol'</span><span class="s1">):</span>
        <span class="s1">fig.canvas.draw()</span>

    <span class="s4"># Setting rcParams to False</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context({</span><span class="s2">'text.parse_math'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">ax.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s2">r&quot;$ \wrong{math} $&quot;</span><span class="s1">)</span>
        <span class="s1">fig.canvas.draw()</span>


<span class="s1">@image_comparison([</span><span class="s2">'text_pdf_font42_kerning.pdf'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pdf_font42_kerning():</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'pdf.fonttype'</span><span class="s1">] = </span><span class="s3">42</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.figtext(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;ATAVATAVATAVATAVATA&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">30</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'text_pdf_chars_beyond_bmp.pdf'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pdf_chars_beyond_bmp():</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'pdf.fonttype'</span><span class="s1">] = </span><span class="s3">42</span>
    <span class="s1">plt.rcParams[</span><span class="s2">'mathtext.fontset'</span><span class="s1">] = </span><span class="s2">'stixsans'</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.figtext(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">&quot;Mass $m$ </span><span class="s0">\U00010308</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">30</span><span class="s1">)</span>


<span class="s1">@needs_usetex</span>
<span class="s0">def </span><span class="s1">test_metrics_cache():</span>
    <span class="s1">mpl.text._get_text_metrics_with_cache_impl.cache_clear()</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.text(</span><span class="s3">.3</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">&quot;foo</span><span class="s0">\n</span><span class="s2">bar&quot;</span><span class="s1">)</span>
    <span class="s1">fig.text(</span><span class="s3">.3</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">&quot;foo</span><span class="s0">\n</span><span class="s2">bar&quot;</span><span class="s0">, </span><span class="s1">usetex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.text(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s2">&quot;foo</span><span class="s0">\n</span><span class="s2">bar&quot;</span><span class="s0">, </span><span class="s1">usetex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">renderer = fig._get_renderer()</span>
    <span class="s1">ys = {}  </span><span class="s4"># mapping of strings to where they were drawn in y with draw_tex.</span>

    <span class="s0">def </span><span class="s1">call(*args</span><span class="s0">, </span><span class="s1">**kwargs):</span>
        <span class="s1">renderer</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">*_ = args</span>
        <span class="s1">ys.setdefault(s</span><span class="s0">, </span><span class="s1">set()).add(y)</span>

    <span class="s1">renderer.draw_tex = call</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">[*ys] == [</span><span class="s2">&quot;foo&quot;</span><span class="s0">, </span><span class="s2">&quot;bar&quot;</span><span class="s1">]</span>
    <span class="s4"># Check that both TeX strings were drawn with the same y-position for both</span>
    <span class="s4"># single-line substrings.  Previously, there used to be an incorrect cache</span>
    <span class="s4"># collision with the non-TeX string (drawn first here) whose metrics would</span>
    <span class="s4"># get incorrectly reused by the first TeX string.</span>
    <span class="s0">assert </span><span class="s1">len(ys[</span><span class="s2">&quot;foo&quot;</span><span class="s1">]) == len(ys[</span><span class="s2">&quot;bar&quot;</span><span class="s1">]) == </span><span class="s3">1</span>

    <span class="s1">info = mpl.text._get_text_metrics_with_cache_impl.cache_info()</span>
    <span class="s4"># Every string gets a miss for the first layouting (extents), then a hit</span>
    <span class="s4"># when drawing, but &quot;foo\nbar&quot; gets two hits as it's drawn twice.</span>
    <span class="s0">assert </span><span class="s1">info.hits &gt; info.misses</span>
</pre>
</body>
</html>