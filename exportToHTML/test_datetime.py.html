<html>
<head>
<title>test_datetime.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #cc7832;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #a5c261;}
.s6 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_datetime.py</font>
</center></td></tr></table>
<pre>
<span class="s1">import </span><span class="s0">numpy</span>
<span class="s1">import </span><span class="s0">numpy </span><span class="s1">as </span><span class="s0">np</span>
<span class="s1">import </span><span class="s0">datetime</span>
<span class="s1">import </span><span class="s0">pytest</span>
<span class="s1">from </span><span class="s0">numpy.testing </span><span class="s1">import </span><span class="s0">(</span>
    <span class="s0">IS_WASM</span><span class="s1">,</span>
    <span class="s0">assert_</span><span class="s1">, </span><span class="s0">assert_equal</span><span class="s1">, </span><span class="s0">assert_raises</span><span class="s1">, </span><span class="s0">assert_warns</span><span class="s1">, </span><span class="s0">suppress_warnings</span><span class="s1">,</span>
    <span class="s0">assert_raises_regex</span><span class="s1">, </span><span class="s0">assert_array_equal</span><span class="s1">,</span>
    <span class="s0">)</span>
<span class="s1">from </span><span class="s0">numpy.compat </span><span class="s1">import </span><span class="s0">pickle</span>

<span class="s2"># Use pytz to test out various time zones if available</span>
<span class="s1">try</span><span class="s0">:</span>
    <span class="s1">from </span><span class="s0">pytz </span><span class="s1">import </span><span class="s0">timezone </span><span class="s1">as </span><span class="s0">tz</span>
    <span class="s0">_has_pytz = </span><span class="s1">True</span>
<span class="s1">except </span><span class="s0">ImportError:</span>
    <span class="s0">_has_pytz = </span><span class="s1">False</span>

<span class="s1">try</span><span class="s0">:</span>
    <span class="s0">RecursionError</span>
<span class="s1">except </span><span class="s0">NameError:</span>
    <span class="s0">RecursionError = RuntimeError  </span><span class="s2"># python &lt; 3.5</span>


<span class="s1">class </span><span class="s0">TestDateTime:</span>
    <span class="s1">def </span><span class="s0">test_datetime_dtype_creation(self):</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'Y'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s1">, </span><span class="s3">'W'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s1">,</span>
                     <span class="s3">'h'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s1">,</span>
                     <span class="s3">'Î¼s'</span><span class="s1">,  </span><span class="s2"># alias for us</span>
                     <span class="s3">'ns'</span><span class="s1">, </span><span class="s3">'ps'</span><span class="s1">, </span><span class="s3">'fs'</span><span class="s1">, </span><span class="s3">'as'</span><span class="s0">]:</span>
            <span class="s0">dt1 = np.dtype(</span><span class="s3">'M8[750%s]' </span><span class="s0">% unit)</span>
            <span class="s0">assert_(dt1 == np.dtype(</span><span class="s3">'datetime64[750%s]' </span><span class="s0">% unit))</span>
            <span class="s0">dt2 = np.dtype(</span><span class="s3">'m8[%s]' </span><span class="s0">% unit)</span>
            <span class="s0">assert_(dt2 == np.dtype(</span><span class="s3">'timedelta64[%s]' </span><span class="s0">% unit))</span>

        <span class="s2"># Generic units shouldn't add [] to the end</span>
        <span class="s0">assert_equal(str(np.dtype(</span><span class="s3">&quot;M8&quot;</span><span class="s0">))</span><span class="s1">, </span><span class="s3">&quot;datetime64&quot;</span><span class="s0">)</span>

        <span class="s2"># Should be possible to specify the endianness</span>
        <span class="s0">assert_equal(np.dtype(</span><span class="s3">&quot;=M8&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">&quot;M8&quot;</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.dtype(</span><span class="s3">&quot;=M8[s]&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">&quot;M8[s]&quot;</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">&quot;&gt;M8&quot;</span><span class="s0">) == np.dtype(</span><span class="s3">&quot;M8&quot;</span><span class="s0">) </span><span class="s1">or</span>
                <span class="s0">np.dtype(</span><span class="s3">&quot;&lt;M8&quot;</span><span class="s0">) == np.dtype(</span><span class="s3">&quot;M8&quot;</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">&quot;&gt;M8[D]&quot;</span><span class="s0">) == np.dtype(</span><span class="s3">&quot;M8[D]&quot;</span><span class="s0">) </span><span class="s1">or</span>
                <span class="s0">np.dtype(</span><span class="s3">&quot;&lt;M8[D]&quot;</span><span class="s0">) == np.dtype(</span><span class="s3">&quot;M8[D]&quot;</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">&quot;&gt;M8&quot;</span><span class="s0">) != np.dtype(</span><span class="s3">&quot;&lt;M8&quot;</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.dtype(</span><span class="s3">&quot;=m8&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">&quot;m8&quot;</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.dtype(</span><span class="s3">&quot;=m8[s]&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">&quot;m8[s]&quot;</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">&quot;&gt;m8&quot;</span><span class="s0">) == np.dtype(</span><span class="s3">&quot;m8&quot;</span><span class="s0">) </span><span class="s1">or</span>
                <span class="s0">np.dtype(</span><span class="s3">&quot;&lt;m8&quot;</span><span class="s0">) == np.dtype(</span><span class="s3">&quot;m8&quot;</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">&quot;&gt;m8[D]&quot;</span><span class="s0">) == np.dtype(</span><span class="s3">&quot;m8[D]&quot;</span><span class="s0">) </span><span class="s1">or</span>
                <span class="s0">np.dtype(</span><span class="s3">&quot;&lt;m8[D]&quot;</span><span class="s0">) == np.dtype(</span><span class="s3">&quot;m8[D]&quot;</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">&quot;&gt;m8&quot;</span><span class="s0">) != np.dtype(</span><span class="s3">&quot;&lt;m8&quot;</span><span class="s0">))</span>

        <span class="s2"># Check that the parser rejects bad datetime types</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'M8[badunit]'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'m8[badunit]'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'M8[YY]'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'m8[YY]'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'m4'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'M7'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'m7'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'M16'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'m16'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.dtype</span><span class="s1">, </span><span class="s3">'M8[3000000000ps]'</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_casting_rules(self):</span>
        <span class="s2"># Cannot cast safely/same_kind between timedelta and datetime</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'m8'</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'M8'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'m8'</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'M8'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>

        <span class="s2"># Can cast safely/same_kind from integer to timedelta</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'i8'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'i8'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'i4'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'i4'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'u4'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'u4'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>

        <span class="s2"># Cannot cast safely from unsigned integer of the same size, which</span>
        <span class="s2"># could overflow</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'u8'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'u8'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>

        <span class="s2"># Cannot cast safely/same_kind from float to timedelta</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'f4'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'f4'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>

        <span class="s2"># Cannot cast safely/same_kind from integer to datetime</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'i8'</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'i8'</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>

        <span class="s2"># Cannot cast safely/same_kind from bool to datetime</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'b1'</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'b1'</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s2"># Can cast safely/same_kind from bool to timedelta</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'b1'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'b1'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>

        <span class="s2"># Can cast datetime safely from months/years to days</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8[M]'</span><span class="s1">, </span><span class="s3">'M8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8[Y]'</span><span class="s1">, </span><span class="s3">'M8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s2"># Cannot cast timedelta safely from months/years to days</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'m8[M]'</span><span class="s1">, </span><span class="s3">'m8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'m8[Y]'</span><span class="s1">, </span><span class="s3">'m8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s2"># Can cast datetime same_kind from months/years to days</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8[M]'</span><span class="s1">, </span><span class="s3">'M8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8[Y]'</span><span class="s1">, </span><span class="s3">'M8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s2"># Can't cast timedelta same_kind from months/years to days</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'m8[M]'</span><span class="s1">, </span><span class="s3">'m8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'m8[Y]'</span><span class="s1">, </span><span class="s3">'m8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s2"># Can cast datetime same_kind across the date/time boundary</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8[D]'</span><span class="s1">, </span><span class="s3">'M8[h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s2"># Can cast timedelta same_kind across the date/time boundary</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'m8[D]'</span><span class="s1">, </span><span class="s3">'m8[h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'m8[h]'</span><span class="s1">, </span><span class="s3">'m8[D]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>

        <span class="s2"># Cannot cast safely if the integer multiplier doesn't divide</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'M8[7h]'</span><span class="s1">, </span><span class="s3">'M8[3h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'M8[3h]'</span><span class="s1">, </span><span class="s3">'M8[6h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s2"># But can cast same_kind</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8[7h]'</span><span class="s1">, </span><span class="s3">'M8[3h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s2"># Can cast safely if the integer multiplier does divide</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8[6h]'</span><span class="s1">, </span><span class="s3">'M8[3h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>

        <span class="s2"># We can always cast types with generic units (corresponding to NaT) to</span>
        <span class="s2"># more specific types</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'m8'</span><span class="s1">, </span><span class="s3">'m8[h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'m8'</span><span class="s1">, </span><span class="s3">'m8[h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8'</span><span class="s1">, </span><span class="s3">'M8[h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(np.can_cast(</span><span class="s3">'M8'</span><span class="s1">, </span><span class="s3">'M8[h]'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s2"># but not the other way around</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'m8[h]'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'m8[h]'</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'M8[h]'</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.can_cast(</span><span class="s3">'M8[h]'</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_prefix_conversions(self):</span>
        <span class="s2"># regression tests related to gh-19631;</span>
        <span class="s2"># test metric prefixes from seconds down to</span>
        <span class="s2"># attoseconds for bidirectional conversions</span>
        <span class="s0">smaller_units = [</span><span class="s3">'M8[7000ms]'</span><span class="s1">,</span>
                         <span class="s3">'M8[2000us]'</span><span class="s1">,</span>
                         <span class="s3">'M8[1000ns]'</span><span class="s1">,</span>
                         <span class="s3">'M8[5000ns]'</span><span class="s1">,</span>
                         <span class="s3">'M8[2000ps]'</span><span class="s1">,</span>
                         <span class="s3">'M8[9000fs]'</span><span class="s1">,</span>
                         <span class="s3">'M8[1000as]'</span><span class="s1">,</span>
                         <span class="s3">'M8[2000000ps]'</span><span class="s1">,</span>
                         <span class="s3">'M8[1000000as]'</span><span class="s1">,</span>
                         <span class="s3">'M8[2000000000ps]'</span><span class="s1">,</span>
                         <span class="s3">'M8[1000000000as]'</span><span class="s0">]</span>
        <span class="s0">larger_units = [</span><span class="s3">'M8[7s]'</span><span class="s1">,</span>
                        <span class="s3">'M8[2ms]'</span><span class="s1">,</span>
                        <span class="s3">'M8[us]'</span><span class="s1">,</span>
                        <span class="s3">'M8[5us]'</span><span class="s1">,</span>
                        <span class="s3">'M8[2ns]'</span><span class="s1">,</span>
                        <span class="s3">'M8[9ps]'</span><span class="s1">,</span>
                        <span class="s3">'M8[1fs]'</span><span class="s1">,</span>
                        <span class="s3">'M8[2us]'</span><span class="s1">,</span>
                        <span class="s3">'M8[1ps]'</span><span class="s1">,</span>
                        <span class="s3">'M8[2ms]'</span><span class="s1">,</span>
                        <span class="s3">'M8[1ns]'</span><span class="s0">]</span>
        <span class="s1">for </span><span class="s0">larger_unit</span><span class="s1">, </span><span class="s0">smaller_unit </span><span class="s1">in </span><span class="s0">zip(larger_units</span><span class="s1">, </span><span class="s0">smaller_units):</span>
            <span class="s1">assert </span><span class="s0">np.can_cast(larger_unit</span><span class="s1">, </span><span class="s0">smaller_unit</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">)</span>
            <span class="s1">assert </span><span class="s0">np.can_cast(smaller_unit</span><span class="s1">, </span><span class="s0">larger_unit</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'safe'</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;unit&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s3">&quot;s&quot;</span><span class="s1">, </span><span class="s3">&quot;ms&quot;</span><span class="s1">, </span><span class="s3">&quot;us&quot;</span><span class="s1">, </span><span class="s3">&quot;ns&quot;</span><span class="s1">, </span><span class="s3">&quot;ps&quot;</span><span class="s1">, </span><span class="s3">&quot;fs&quot;</span><span class="s1">, </span><span class="s3">&quot;as&quot;</span><span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_prohibit_negative_datetime(self</span><span class="s1">, </span><span class="s0">unit):</span>
        <span class="s1">with </span><span class="s0">assert_raises(TypeError):</span>
            <span class="s0">np.array([</span><span class="s4">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">f&quot;M8[-1</span><span class="s1">{</span><span class="s0">unit</span><span class="s1">}</span><span class="s3">]&quot;</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_compare_generic_nat(self):</span>
        <span class="s2"># regression tests for gh-6452</span>
        <span class="s0">assert_(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">) !=</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2000'</span><span class="s0">) + np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">))</span>
        <span class="s0">assert_(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">) != np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">))</span>
        <span class="s0">assert_(np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">) != np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">))</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;size&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s4">3</span><span class="s1">, </span><span class="s4">21</span><span class="s1">, </span><span class="s4">217</span><span class="s1">, </span><span class="s4">1000</span><span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_datetime_nat_argsort_stability(self</span><span class="s1">, </span><span class="s0">size):</span>
        <span class="s2"># NaT &lt; NaT should be False internally for</span>
        <span class="s2"># sort stability</span>
        <span class="s0">expected = np.arange(size)</span>
        <span class="s0">arr = np.tile(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">size)</span>
        <span class="s0">assert_equal(np.argsort(arr</span><span class="s1">, </span><span class="s0">kind=</span><span class="s3">'mergesort'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;size&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s4">3</span><span class="s1">, </span><span class="s4">21</span><span class="s1">, </span><span class="s4">217</span><span class="s1">, </span><span class="s4">1000</span><span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_nat_argsort_stability(self</span><span class="s1">, </span><span class="s0">size):</span>
        <span class="s2"># NaT &lt; NaT should be False internally for</span>
        <span class="s2"># sort stability</span>
        <span class="s0">expected = np.arange(size)</span>
        <span class="s0">arr = np.tile(np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">size)</span>
        <span class="s0">assert_equal(np.argsort(arr</span><span class="s1">, </span><span class="s0">kind=</span><span class="s3">'mergesort'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;arr, expected&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># the example provided in gh-12629</span>
        <span class="s0">([</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s4">3</span><span class="s0">]</span><span class="s1">,</span>
         <span class="s0">[</span><span class="s4">1</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">])</span><span class="s1">,</span>
        <span class="s2"># multiple NaTs</span>
        <span class="s0">([</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s4">9</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">707</span><span class="s0">]</span><span class="s1">,</span>
         <span class="s0">[-</span><span class="s4">707</span><span class="s1">, </span><span class="s4">9</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">])</span><span class="s1">,</span>
        <span class="s2"># this sort explores another code path for NaT</span>
        <span class="s0">([</span><span class="s4">1</span><span class="s1">, </span><span class="s0">-</span><span class="s4">2</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">]</span><span class="s1">,</span>
         <span class="s0">[-</span><span class="s4">2</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">])</span><span class="s1">,</span>
        <span class="s2"># 2-D array</span>
        <span class="s0">([[</span><span class="s4">51</span><span class="s1">, </span><span class="s0">-</span><span class="s4">220</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">]</span><span class="s1">,</span>
          <span class="s0">[-</span><span class="s4">17</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">90</span><span class="s0">]]</span><span class="s1">,</span>
         <span class="s0">[[-</span><span class="s4">220</span><span class="s1">, </span><span class="s4">51</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">]</span><span class="s1">,</span>
          <span class="s0">[-</span><span class="s4">90</span><span class="s1">, </span><span class="s0">-</span><span class="s4">17</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">]])</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;dtype&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s3">'M8[ns]'</span><span class="s1">, </span><span class="s3">'M8[us]'</span><span class="s1">,</span>
        <span class="s3">'m8[ns]'</span><span class="s1">, </span><span class="s3">'m8[us]'</span><span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_datetime_timedelta_sort_nat(self</span><span class="s1">, </span><span class="s0">arr</span><span class="s1">, </span><span class="s0">expected</span><span class="s1">, </span><span class="s0">dtype):</span>
        <span class="s2"># fix for gh-12629 and gh-15063; NaT sorting to end of array</span>
        <span class="s0">arr = np.array(arr</span><span class="s1">, </span><span class="s0">dtype=dtype)</span>
        <span class="s0">expected = np.array(expected</span><span class="s1">, </span><span class="s0">dtype=dtype)</span>
        <span class="s0">arr.sort()</span>
        <span class="s0">assert_equal(arr</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s1">def </span><span class="s0">test_datetime_scalar_construction(self):</span>
        <span class="s2"># Construct with different units</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1950-03-12'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'1950-03-12'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1950-03-12T13'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'1950-03-12T13'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">))</span>

        <span class="s2"># Default construction means NaT</span>
        <span class="s0">assert_equal(np.datetime64()</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">))</span>

        <span class="s2"># Some basic strings and repr</span>
        <span class="s0">assert_equal(str(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">))</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">)</span>
        <span class="s0">assert_equal(repr(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">&quot;numpy.datetime64('NaT')&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(np.datetime64(</span><span class="s3">'2011-02'</span><span class="s0">))</span><span class="s1">, </span><span class="s3">'2011-02'</span><span class="s0">)</span>
        <span class="s0">assert_equal(repr(np.datetime64(</span><span class="s3">'2011-02'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">&quot;numpy.datetime64('2011-02')&quot;</span><span class="s0">)</span>

        <span class="s2"># None gets constructed as NaT</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s1">None</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">))</span>

        <span class="s2"># Default construction of NaT is in generic units</span>
        <span class="s0">assert_equal(np.datetime64().dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8'</span><span class="s0">))</span>

        <span class="s2"># Construction from integers requires a specified unit</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.datetime64</span><span class="s1">, </span><span class="s4">17</span><span class="s0">)</span>

        <span class="s2"># When constructing from a scalar or zero-dimensional array,</span>
        <span class="s2"># it either keeps the units or you can override them.</span>
        <span class="s0">a = np.datetime64(</span><span class="s3">'2000-03-18T16'</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">)</span>
        <span class="s0">b = np.array(</span><span class="s3">'2000-03-18T16'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[h]'</span><span class="s0">)</span>

        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[h]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(b.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[h]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(a)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.datetime64(a).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[h]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(b)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.datetime64(b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[h]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(a</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.datetime64(a</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(b</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.datetime64(b</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span>

        <span class="s2"># Construction from datetime.date</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1945-03-25'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(datetime.date(</span><span class="s4">1945</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s4">25</span><span class="s0">)))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2045-03-25'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(datetime.date(</span><span class="s4">2045</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s4">25</span><span class="s0">)</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">))</span>
        <span class="s2"># Construction from datetime.datetime</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1980-01-25T14:36:22.5'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(datetime.datetime(</span><span class="s4">1980</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">25</span><span class="s1">,</span>
                                                <span class="s4">14</span><span class="s1">, </span><span class="s4">36</span><span class="s1">, </span><span class="s4">22</span><span class="s1">, </span><span class="s4">500000</span><span class="s0">)))</span>

        <span class="s2"># Construction with time units from a date is okay</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1920-03-13'</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'1920-03-13T00'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1920-03'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'1920-03-01T00:00'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1920'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'1920-01-01T00:00:00'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(datetime.date(</span><span class="s4">2045</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s4">25</span><span class="s0">)</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2045-03-25T00:00:00.000'</span><span class="s0">))</span>

        <span class="s2"># Construction with date units from a datetime is also okay</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1920-03-13T18'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'1920-03-13'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1920-03-13T18:33:12'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'1920-03'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1920-03-13T18:33:12.5'</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'1920'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_scalar_construction_timezone(self):</span>
        <span class="s2"># verify that supplying an explicit timezone works, but is deprecated</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2000-01-01T00Z'</span><span class="s0">)</span><span class="s1">,</span>
                         <span class="s0">np.datetime64(</span><span class="s3">'2000-01-01T00'</span><span class="s0">))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2000-01-01T00-08'</span><span class="s0">)</span><span class="s1">,</span>
                         <span class="s0">np.datetime64(</span><span class="s3">'2000-01-01T08'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_array_find_type(self):</span>
        <span class="s0">dt = np.datetime64(</span><span class="s3">'1970-01-01'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">arr = np.array([dt])</span>
        <span class="s0">assert_equal(arr.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[M]'</span><span class="s0">))</span>

        <span class="s2"># at the moment, we don't automatically convert these to datetime64</span>

        <span class="s0">dt = datetime.date(</span><span class="s4">1970</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">)</span>
        <span class="s0">arr = np.array([dt])</span>
        <span class="s0">assert_equal(arr.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'O'</span><span class="s0">))</span>

        <span class="s0">dt = datetime.datetime(</span><span class="s4">1970</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">12</span><span class="s1">, </span><span class="s4">30</span><span class="s1">, </span><span class="s4">40</span><span class="s0">)</span>
        <span class="s0">arr = np.array([dt])</span>
        <span class="s0">assert_equal(arr.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'O'</span><span class="s0">))</span>

        <span class="s2"># find &quot;supertype&quot; for non-dates and dates</span>

        <span class="s0">b = np.bool_(</span><span class="s1">True</span><span class="s0">)</span>
        <span class="s0">dm = np.datetime64(</span><span class="s3">'1970-01-01'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">d = datetime.date(</span><span class="s4">1970</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">)</span>
        <span class="s0">dt = datetime.datetime(</span><span class="s4">1970</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">12</span><span class="s1">, </span><span class="s4">30</span><span class="s1">, </span><span class="s4">40</span><span class="s0">)</span>

        <span class="s0">arr = np.array([b</span><span class="s1">, </span><span class="s0">dm])</span>
        <span class="s0">assert_equal(arr.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'O'</span><span class="s0">))</span>

        <span class="s0">arr = np.array([b</span><span class="s1">, </span><span class="s0">d])</span>
        <span class="s0">assert_equal(arr.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'O'</span><span class="s0">))</span>

        <span class="s0">arr = np.array([b</span><span class="s1">, </span><span class="s0">dt])</span>
        <span class="s0">assert_equal(arr.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'O'</span><span class="s0">))</span>

        <span class="s0">arr = np.array([d</span><span class="s1">, </span><span class="s0">d]).astype(</span><span class="s3">'datetime64'</span><span class="s0">)</span>
        <span class="s0">assert_equal(arr.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>

        <span class="s0">arr = np.array([dt</span><span class="s1">, </span><span class="s0">dt]).astype(</span><span class="s3">'datetime64'</span><span class="s0">)</span>
        <span class="s0">assert_equal(arr.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;unit&quot;</span><span class="s1">, </span><span class="s0">[</span>
    <span class="s2"># test all date / time units and use</span>
    <span class="s2"># &quot;generic&quot; to select generic unit</span>
    <span class="s0">(</span><span class="s3">&quot;Y&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;M&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;W&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;D&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;h&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;m&quot;</span><span class="s0">)</span><span class="s1">,</span>
    <span class="s0">(</span><span class="s3">&quot;s&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;ms&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;us&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;ns&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;ps&quot;</span><span class="s0">)</span><span class="s1">,</span>
    <span class="s0">(</span><span class="s3">&quot;fs&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;as&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;generic&quot;</span><span class="s0">) ])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_np_int_construction(self</span><span class="s1">, </span><span class="s0">unit):</span>
        <span class="s2"># regression test for gh-7617</span>
        <span class="s1">if </span><span class="s0">unit != </span><span class="s3">&quot;generic&quot;</span><span class="s0">:</span>
            <span class="s0">assert_equal(np.timedelta64(np.int64(</span><span class="s4">123</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit)</span><span class="s1">,</span>
                         <span class="s0">np.timedelta64(</span><span class="s4">123</span><span class="s1">, </span><span class="s0">unit))</span>
        <span class="s1">else</span><span class="s0">:</span>
            <span class="s0">assert_equal(np.timedelta64(np.int64(</span><span class="s4">123</span><span class="s0">))</span><span class="s1">,</span>
                         <span class="s0">np.timedelta64(</span><span class="s4">123</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_timedelta_scalar_construction(self):</span>
        <span class="s2"># Construct with different units</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'W'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">120</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(</span><span class="s4">2</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">))</span>

        <span class="s2"># Default construction means 0</span>
        <span class="s0">assert_equal(np.timedelta64()</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s0">))</span>

        <span class="s2"># None gets constructed as NaT</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s1">None</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">))</span>

        <span class="s2"># Some basic strings and repr</span>
        <span class="s0">assert_equal(str(np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">))</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">)</span>
        <span class="s0">assert_equal(repr(np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">&quot;numpy.timedelta64('NaT')&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">, </span><span class="s3">'3 seconds'</span><span class="s0">)</span>
        <span class="s0">assert_equal(repr(np.timedelta64(-</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">&quot;numpy.timedelta64(-3,'s')&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(repr(np.timedelta64(</span><span class="s4">12</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">&quot;numpy.timedelta64(12)&quot;</span><span class="s0">)</span>

        <span class="s2"># Construction from an integer produces generic units</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">12</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8'</span><span class="s0">))</span>

        <span class="s2"># When constructing from a scalar or zero-dimensional array,</span>
        <span class="s2"># it either keeps the units or you can override them.</span>
        <span class="s0">a = np.timedelta64(</span><span class="s4">2</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">)</span>
        <span class="s0">b = np.array(</span><span class="s4">2</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span>

        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(b.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.timedelta64(a)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.timedelta64(a).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.timedelta64(b)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.timedelta64(b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.timedelta64(a</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.timedelta64(a</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.timedelta64(b</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.timedelta64(b</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">))</span>

        <span class="s2"># Construction from datetime.timedelta</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">5</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(datetime.timedelta(days=</span><span class="s4">5</span><span class="s0">)))</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">102347621</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(datetime.timedelta(seconds=</span><span class="s4">102347621</span><span class="s0">)))</span>
        <span class="s0">assert_equal(np.timedelta64(-</span><span class="s4">10234760000</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(datetime.timedelta(</span>
                                            <span class="s0">microseconds=-</span><span class="s4">10234760000</span><span class="s0">)))</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">10234760000</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(datetime.timedelta(</span>
                                            <span class="s0">microseconds=</span><span class="s4">10234760000</span><span class="s0">)))</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">1023476</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(datetime.timedelta(milliseconds=</span><span class="s4">1023476</span><span class="s0">)))</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">10</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(datetime.timedelta(minutes=</span><span class="s4">10</span><span class="s0">)))</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">281</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(datetime.timedelta(hours=</span><span class="s4">281</span><span class="s0">)))</span>
        <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">28</span><span class="s1">, </span><span class="s3">'W'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(datetime.timedelta(weeks=</span><span class="s4">28</span><span class="s0">)))</span>

        <span class="s2"># Cannot construct across nonlinear time unit boundaries</span>
        <span class="s0">a = np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span>
        <span class="s0">a = np.timedelta64(</span><span class="s4">6</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">)</span>
        <span class="s0">a = np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">)</span>
        <span class="s0">a = datetime.timedelta(seconds=</span><span class="s4">3</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span>
        <span class="s0">a = datetime.timedelta(weeks=</span><span class="s4">3</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span>
        <span class="s0">a = datetime.timedelta()</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.timedelta64</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_object_array_conversion(self):</span>
        <span class="s2"># Regression test for gh-11096</span>
        <span class="s0">inputs = [datetime.timedelta(</span><span class="s4">28</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">datetime.timedelta(</span><span class="s4">30</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">datetime.timedelta(</span><span class="s4">31</span><span class="s0">)]</span>
        <span class="s0">expected = np.array([</span><span class="s4">28</span><span class="s1">, </span><span class="s4">30</span><span class="s1">, </span><span class="s4">31</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'timedelta64[D]'</span><span class="s0">)</span>
        <span class="s0">actual = np.array(inputs</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'timedelta64[D]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(expected</span><span class="s1">, </span><span class="s0">actual)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_0_dim_object_array_conversion(self):</span>
        <span class="s2"># Regression test for gh-11151</span>
        <span class="s0">test = np.array(datetime.timedelta(seconds=</span><span class="s4">20</span><span class="s0">))</span>
        <span class="s0">actual = test.astype(np.timedelta64)</span>
        <span class="s2"># expected value from the array constructor workaround</span>
        <span class="s2"># described in above issue</span>
        <span class="s0">expected = np.array(datetime.timedelta(seconds=</span><span class="s4">20</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s0">np.timedelta64)</span>
        <span class="s0">assert_equal(actual</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_nat_format(self):</span>
        <span class="s2"># gh-17552</span>
        <span class="s0">assert_equal(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'{0}'</span><span class="s0">.format(np.timedelta64(</span><span class="s3">'nat'</span><span class="s0">)))</span>

    <span class="s1">def </span><span class="s0">test_timedelta_scalar_construction_units(self):</span>
        <span class="s2"># String construction detecting units</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[Y]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[h]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17:15'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[m]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17:15:08'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17:15:08.1'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ms]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17:15:08.12'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ms]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17:15:08.123'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ms]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17:15:08.1234'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17:15:08.12345'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'2010-03-12T17:15:08.123456'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1970-01-01T00:00:02.1234567'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ns]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1970-01-01T00:00:02.12345678'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ns]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1970-01-01T00:00:02.123456789'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ns]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1970-01-01T00:00:02.1234567890'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ps]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1970-01-01T00:00:02.12345678901'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ps]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1970-01-01T00:00:02.123456789012'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[ps]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(</span>
                     <span class="s3">'1970-01-01T00:00:02.1234567890123'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[fs]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span>
                     <span class="s3">'1970-01-01T00:00:02.12345678901234'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[fs]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span>
                     <span class="s3">'1970-01-01T00:00:02.123456789012345'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[fs]'</span><span class="s0">))</span>

        <span class="s0">assert_equal(np.datetime64(</span>
                    <span class="s3">'1970-01-01T00:00:02.1234567890123456'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[as]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span>
                    <span class="s3">'1970-01-01T00:00:02.12345678901234567'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[as]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(</span>
                    <span class="s3">'1970-01-01T00:00:02.123456789012345678'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[as]'</span><span class="s0">))</span>

        <span class="s2"># Python date object</span>
        <span class="s0">assert_equal(np.datetime64(datetime.date(</span><span class="s4">2010</span><span class="s1">, </span><span class="s4">4</span><span class="s1">, </span><span class="s4">16</span><span class="s0">)).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>

        <span class="s2"># Python datetime object</span>
        <span class="s0">assert_equal(np.datetime64(</span>
                        <span class="s0">datetime.datetime(</span><span class="s4">2010</span><span class="s1">, </span><span class="s4">4</span><span class="s1">, </span><span class="s4">16</span><span class="s1">, </span><span class="s4">13</span><span class="s1">, </span><span class="s4">45</span><span class="s1">, </span><span class="s4">18</span><span class="s0">)).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>

        <span class="s2"># 'today' special value</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'today'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>

        <span class="s2"># 'now' special value</span>
        <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'now'</span><span class="s0">).dtype</span><span class="s1">,</span>
                     <span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_nat_casting(self):</span>
        <span class="s0">a = np.array(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">b = np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span>

        <span class="s2"># Arrays</span>
        <span class="s0">assert_equal(a.astype(</span><span class="s3">'M8[s]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.array(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a.astype(</span><span class="s3">'M8[ms]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.array(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[ms]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a.astype(</span><span class="s3">'M8[M]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.array(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a.astype(</span><span class="s3">'M8[Y]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.array(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[Y]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a.astype(</span><span class="s3">'M8[W]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.array(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[W]'</span><span class="s0">))</span>

        <span class="s2"># Scalars -&gt; Scalars</span>
        <span class="s0">assert_equal(np.datetime64(b</span><span class="s1">, </span><span class="s3">'[s]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(b</span><span class="s1">, </span><span class="s3">'[ms]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[ms]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(b</span><span class="s1">, </span><span class="s3">'[M]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(b</span><span class="s1">, </span><span class="s3">'[Y]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[Y]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(b</span><span class="s1">, </span><span class="s3">'[W]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[W]'</span><span class="s0">))</span>

        <span class="s2"># Arrays -&gt; Scalars</span>
        <span class="s0">assert_equal(np.datetime64(a</span><span class="s1">, </span><span class="s3">'[s]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(a</span><span class="s1">, </span><span class="s3">'[ms]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[ms]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(a</span><span class="s1">, </span><span class="s3">'[M]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(a</span><span class="s1">, </span><span class="s3">'[Y]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[Y]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.datetime64(a</span><span class="s1">, </span><span class="s3">'[W]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[W]'</span><span class="s0">))</span>

        <span class="s2"># NaN -&gt; NaT</span>
        <span class="s0">nan = np.array([np.nan] * </span><span class="s4">8</span><span class="s0">)</span>
        <span class="s0">fnan = nan.astype(</span><span class="s3">'f'</span><span class="s0">)</span>
        <span class="s0">lnan = nan.astype(</span><span class="s3">'g'</span><span class="s0">)</span>
        <span class="s0">cnan = nan.astype(</span><span class="s3">'D'</span><span class="s0">)</span>
        <span class="s0">cfnan = nan.astype(</span><span class="s3">'F'</span><span class="s0">)</span>
        <span class="s0">clnan = nan.astype(</span><span class="s3">'G'</span><span class="s0">)</span>

        <span class="s0">nat = np.array([np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">)] * </span><span class="s4">8</span><span class="s0">)</span>
        <span class="s0">assert_equal(nan.astype(</span><span class="s3">'M8[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(fnan.astype(</span><span class="s3">'M8[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(lnan.astype(</span><span class="s3">'M8[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(cnan.astype(</span><span class="s3">'M8[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(cfnan.astype(</span><span class="s3">'M8[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(clnan.astype(</span><span class="s3">'M8[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>

        <span class="s0">nat = np.array([np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">)] * </span><span class="s4">8</span><span class="s0">)</span>
        <span class="s0">assert_equal(nan.astype(</span><span class="s3">'timedelta64[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(fnan.astype(</span><span class="s3">'timedelta64[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(lnan.astype(</span><span class="s3">'timedelta64[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(cnan.astype(</span><span class="s3">'timedelta64[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(cfnan.astype(</span><span class="s3">'timedelta64[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
        <span class="s0">assert_equal(clnan.astype(</span><span class="s3">'timedelta64[ns]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>

    <span class="s1">def </span><span class="s0">test_days_creation(self):</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1599'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">(</span><span class="s4">1600</span><span class="s0">-</span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">- (</span><span class="s4">1972</span><span class="s0">-</span><span class="s4">1600</span><span class="s0">)/</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">3 </span><span class="s0">- </span><span class="s4">365</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1600'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">(</span><span class="s4">1600</span><span class="s0">-</span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">- (</span><span class="s4">1972</span><span class="s0">-</span><span class="s4">1600</span><span class="s0">)/</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">3</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1601'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">(</span><span class="s4">1600</span><span class="s0">-</span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">- (</span><span class="s4">1972</span><span class="s0">-</span><span class="s4">1600</span><span class="s0">)/</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">3 </span><span class="s0">+ </span><span class="s4">366</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1900'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">(</span><span class="s4">1900</span><span class="s0">-</span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">- (</span><span class="s4">1970</span><span class="s0">-</span><span class="s4">1900</span><span class="s0">)//</span><span class="s4">4</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1901'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">(</span><span class="s4">1900</span><span class="s0">-</span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">- (</span><span class="s4">1970</span><span class="s0">-</span><span class="s4">1900</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">365</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1967'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">-</span><span class="s4">3</span><span class="s0">*</span><span class="s4">365 </span><span class="s0">- </span><span class="s4">1</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1968'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">-</span><span class="s4">2</span><span class="s0">*</span><span class="s4">365 </span><span class="s0">- </span><span class="s4">1</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1969'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s0">*</span><span class="s4">365</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1970'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">0</span><span class="s0">*</span><span class="s4">365</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1971'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">1</span><span class="s0">*</span><span class="s4">365</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1972'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">2</span><span class="s0">*</span><span class="s4">365</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1973'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">3</span><span class="s0">*</span><span class="s4">365 </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1974'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">4</span><span class="s0">*</span><span class="s4">365 </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2000'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                 <span class="s0">(</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">+ (</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1972</span><span class="s0">)//</span><span class="s4">4</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2001'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                 <span class="s0">(</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">+ (</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1972</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">366</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2400'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                 <span class="s0">(</span><span class="s4">2400 </span><span class="s0">- </span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">+ (</span><span class="s4">2400 </span><span class="s0">- </span><span class="s4">1972</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">- </span><span class="s4">3</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2401'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                 <span class="s0">(</span><span class="s4">2400 </span><span class="s0">- </span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">+ (</span><span class="s4">2400 </span><span class="s0">- </span><span class="s4">1972</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">- </span><span class="s4">3 </span><span class="s0">+ </span><span class="s4">366</span><span class="s0">)</span>

        <span class="s0">assert_equal(np.array(</span><span class="s3">'1600-02-29'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">(</span><span class="s4">1600</span><span class="s0">-</span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">- (</span><span class="s4">1972</span><span class="s0">-</span><span class="s4">1600</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">3 </span><span class="s0">+ </span><span class="s4">31 </span><span class="s0">+ </span><span class="s4">28</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1600-03-01'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">(</span><span class="s4">1600</span><span class="s0">-</span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">- (</span><span class="s4">1972</span><span class="s0">-</span><span class="s4">1600</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">3 </span><span class="s0">+ </span><span class="s4">31 </span><span class="s0">+ </span><span class="s4">29</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2000-02-29'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                 <span class="s0">(</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">+ (</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1972</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">31 </span><span class="s0">+ </span><span class="s4">28</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2000-03-01'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                 <span class="s0">(</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">+ (</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1972</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">31 </span><span class="s0">+ </span><span class="s4">29</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2001-03-22'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">,</span>
                 <span class="s0">(</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1970</span><span class="s0">)*</span><span class="s4">365 </span><span class="s0">+ (</span><span class="s4">2000 </span><span class="s0">- </span><span class="s4">1972</span><span class="s0">)//</span><span class="s4">4 </span><span class="s0">+ </span><span class="s4">366 </span><span class="s0">+ </span><span class="s4">31 </span><span class="s0">+ </span><span class="s4">28 </span><span class="s0">+ </span><span class="s4">21</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_days_to_pydate(self):</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1599'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">1599</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1600'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">1600</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1601'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">1601</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1900'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">1900</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1901'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">1901</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2000'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">2000</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2001'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">2001</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1600-02-29'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">1600</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s4">29</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1600-03-01'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">1600</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'2001-03-22'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">).astype(</span><span class="s3">'O'</span><span class="s0">)</span><span class="s1">,</span>
                    <span class="s0">datetime.date(</span><span class="s4">2001</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s4">22</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_dtype_comparison(self):</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">(np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[ms]'</span><span class="s0">)))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">) != np.dtype(</span><span class="s3">'M8[ms]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[2D]'</span><span class="s0">) != np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">) != np.dtype(</span><span class="s3">'M8[2D]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_pydatetime_creation(self):</span>
        <span class="s0">a = np.array([</span><span class="s3">'1960-03-12'</span><span class="s1">, </span><span class="s0">datetime.date(</span><span class="s4">1960</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s4">12</span><span class="s0">)]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a[</span><span class="s4">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">a[</span><span class="s4">1</span><span class="s0">])</span>
        <span class="s0">a = np.array([</span><span class="s3">'1999-12-31'</span><span class="s1">, </span><span class="s0">datetime.date(</span><span class="s4">1999</span><span class="s1">, </span><span class="s4">12</span><span class="s1">, </span><span class="s4">31</span><span class="s0">)]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a[</span><span class="s4">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">a[</span><span class="s4">1</span><span class="s0">])</span>
        <span class="s0">a = np.array([</span><span class="s3">'2000-01-01'</span><span class="s1">, </span><span class="s0">datetime.date(</span><span class="s4">2000</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">)]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a[</span><span class="s4">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">a[</span><span class="s4">1</span><span class="s0">])</span>
        <span class="s2"># Will fail if the date changes during the exact right moment</span>
        <span class="s0">a = np.array([</span><span class="s3">'today'</span><span class="s1">, </span><span class="s0">datetime.date.today()]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a[</span><span class="s4">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">a[</span><span class="s4">1</span><span class="s0">])</span>
        <span class="s2"># datetime.datetime.now() returns local time, not UTC</span>
        <span class="s2">#a = np.array(['now', datetime.datetime.now()], dtype='M8[s]')</span>
        <span class="s2">#assert_equal(a[0], a[1])</span>

        <span class="s2"># we can give a datetime.date time units</span>
        <span class="s0">assert_equal(np.array(datetime.date(</span><span class="s4">1960</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s4">12</span><span class="s0">)</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[s]'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.array(np.datetime64(</span><span class="s3">'1960-03-12T00:00:00'</span><span class="s0">)))</span>

    <span class="s1">def </span><span class="s0">test_datetime_string_conversion(self):</span>
        <span class="s0">a = [</span><span class="s3">'2011-03-16'</span><span class="s1">, </span><span class="s3">'1920-01-01'</span><span class="s1">, </span><span class="s3">'2013-05-19'</span><span class="s0">]</span>
        <span class="s0">str_a = np.array(a</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'S'</span><span class="s0">)</span>
        <span class="s0">uni_a = np.array(a</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'U'</span><span class="s0">)</span>
        <span class="s0">dt_a = np.array(a</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">)</span>

        <span class="s2"># String to datetime</span>
        <span class="s0">assert_equal(dt_a</span><span class="s1">, </span><span class="s0">str_a.astype(</span><span class="s3">'M'</span><span class="s0">))</span>
        <span class="s0">assert_equal(dt_a.dtype</span><span class="s1">, </span><span class="s0">str_a.astype(</span><span class="s3">'M'</span><span class="s0">).dtype)</span>
        <span class="s0">dt_b = np.empty_like(dt_a)</span>
        <span class="s0">dt_b[...] = str_a</span>
        <span class="s0">assert_equal(dt_a</span><span class="s1">, </span><span class="s0">dt_b)</span>

        <span class="s2"># Datetime to string</span>
        <span class="s0">assert_equal(str_a</span><span class="s1">, </span><span class="s0">dt_a.astype(</span><span class="s3">'S0'</span><span class="s0">))</span>
        <span class="s0">str_b = np.empty_like(str_a)</span>
        <span class="s0">str_b[...] = dt_a</span>
        <span class="s0">assert_equal(str_a</span><span class="s1">, </span><span class="s0">str_b)</span>

        <span class="s2"># Unicode to datetime</span>
        <span class="s0">assert_equal(dt_a</span><span class="s1">, </span><span class="s0">uni_a.astype(</span><span class="s3">'M'</span><span class="s0">))</span>
        <span class="s0">assert_equal(dt_a.dtype</span><span class="s1">, </span><span class="s0">uni_a.astype(</span><span class="s3">'M'</span><span class="s0">).dtype)</span>
        <span class="s0">dt_b = np.empty_like(dt_a)</span>
        <span class="s0">dt_b[...] = uni_a</span>
        <span class="s0">assert_equal(dt_a</span><span class="s1">, </span><span class="s0">dt_b)</span>

        <span class="s2"># Datetime to unicode</span>
        <span class="s0">assert_equal(uni_a</span><span class="s1">, </span><span class="s0">dt_a.astype(</span><span class="s3">'U'</span><span class="s0">))</span>
        <span class="s0">uni_b = np.empty_like(uni_a)</span>
        <span class="s0">uni_b[...] = dt_a</span>
        <span class="s0">assert_equal(uni_a</span><span class="s1">, </span><span class="s0">uni_b)</span>

        <span class="s2"># Datetime to long string - gh-9712</span>
        <span class="s0">assert_equal(str_a</span><span class="s1">, </span><span class="s0">dt_a.astype((np.string_</span><span class="s1">, </span><span class="s4">128</span><span class="s0">)))</span>
        <span class="s0">str_b = np.empty(str_a.shape</span><span class="s1">, </span><span class="s0">dtype=(np.string_</span><span class="s1">, </span><span class="s4">128</span><span class="s0">))</span>
        <span class="s0">str_b[...] = dt_a</span>
        <span class="s0">assert_equal(str_a</span><span class="s1">, </span><span class="s0">str_b)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;time_dtype&quot;</span><span class="s1">, </span><span class="s0">[</span><span class="s3">&quot;m8[D]&quot;</span><span class="s1">, </span><span class="s3">&quot;M8[Y]&quot;</span><span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_time_byteswapping(self</span><span class="s1">, </span><span class="s0">time_dtype):</span>
        <span class="s0">times = np.array([</span><span class="s3">&quot;2017&quot;</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=time_dtype)</span>
        <span class="s0">times_swapped = times.astype(times.dtype.newbyteorder())</span>
        <span class="s0">assert_array_equal(times</span><span class="s1">, </span><span class="s0">times_swapped)</span>

        <span class="s0">unswapped = times_swapped.view(np.int64).newbyteorder()</span>
        <span class="s0">assert_array_equal(unswapped</span><span class="s1">, </span><span class="s0">times.view(np.int64))</span>

    <span class="s0">@pytest.mark.parametrize([</span><span class="s3">&quot;time1&quot;</span><span class="s1">, </span><span class="s3">&quot;time2&quot;</span><span class="s0">]</span><span class="s1">,</span>
            <span class="s0">[(</span><span class="s3">&quot;M8[s]&quot;</span><span class="s1">, </span><span class="s3">&quot;M8[D]&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">&quot;m8[s]&quot;</span><span class="s1">, </span><span class="s3">&quot;m8[ns]&quot;</span><span class="s0">)])</span>
    <span class="s1">def </span><span class="s0">test_time_byteswapped_cast(self</span><span class="s1">, </span><span class="s0">time1</span><span class="s1">, </span><span class="s0">time2):</span>
        <span class="s0">dtype1 = np.dtype(time1)</span>
        <span class="s0">dtype2 = np.dtype(time2)</span>
        <span class="s0">times = np.array([</span><span class="s3">&quot;2017&quot;</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=dtype1)</span>
        <span class="s0">expected = times.astype(dtype2)</span>

        <span class="s2"># Test that every byte-swapping combination also returns the same</span>
        <span class="s2"># results (previous tests check that this comparison works fine).</span>
        <span class="s0">res = times.astype(dtype1.newbyteorder()).astype(dtype2)</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">expected)</span>
        <span class="s0">res = times.astype(dtype2.newbyteorder())</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">expected)</span>
        <span class="s0">res = times.astype(dtype1.newbyteorder()).astype(dtype2.newbyteorder())</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;time_dtype&quot;</span><span class="s1">, </span><span class="s0">[</span><span class="s3">&quot;m8[D]&quot;</span><span class="s1">, </span><span class="s3">&quot;M8[Y]&quot;</span><span class="s0">])</span>
    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;str_dtype&quot;</span><span class="s1">, </span><span class="s0">[</span><span class="s3">&quot;U&quot;</span><span class="s1">, </span><span class="s3">&quot;S&quot;</span><span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_datetime_conversions_byteorders(self</span><span class="s1">, </span><span class="s0">str_dtype</span><span class="s1">, </span><span class="s0">time_dtype):</span>
        <span class="s0">times = np.array([</span><span class="s3">&quot;2017&quot;</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=time_dtype)</span>
        <span class="s2"># Unfortunately, timedelta does not roundtrip:</span>
        <span class="s0">from_strings = np.array([</span><span class="s3">&quot;2017&quot;</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=str_dtype)</span>
        <span class="s0">to_strings = times.astype(str_dtype)  </span><span class="s2"># assume this is correct</span>

        <span class="s2"># Check that conversion from times to string works if src is swapped:</span>
        <span class="s0">times_swapped = times.astype(times.dtype.newbyteorder())</span>
        <span class="s0">res = times_swapped.astype(str_dtype)</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">to_strings)</span>
        <span class="s2"># And also if both are swapped:</span>
        <span class="s0">res = times_swapped.astype(to_strings.dtype.newbyteorder())</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">to_strings)</span>
        <span class="s2"># only destination is swapped:</span>
        <span class="s0">res = times.astype(to_strings.dtype.newbyteorder())</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">to_strings)</span>

        <span class="s2"># Check that conversion from string to times works if src is swapped:</span>
        <span class="s0">from_strings_swapped = from_strings.astype(</span>
                <span class="s0">from_strings.dtype.newbyteorder())</span>
        <span class="s0">res = from_strings_swapped.astype(time_dtype)</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">times)</span>
        <span class="s2"># And if both are swapped:</span>
        <span class="s0">res = from_strings_swapped.astype(times.dtype.newbyteorder())</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">times)</span>
        <span class="s2"># Only destination is swapped:</span>
        <span class="s0">res = from_strings.astype(times.dtype.newbyteorder())</span>
        <span class="s0">assert_array_equal(res</span><span class="s1">, </span><span class="s0">times)</span>

    <span class="s1">def </span><span class="s0">test_datetime_array_str(self):</span>
        <span class="s0">a = np.array([</span><span class="s3">'2011-03-16'</span><span class="s1">, </span><span class="s3">'1920-01-01'</span><span class="s1">, </span><span class="s3">'2013-05-19'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">&quot;['2011-03-16' '1920-01-01' '2013-05-19']&quot;</span><span class="s0">)</span>

        <span class="s0">a = np.array([</span><span class="s3">'2011-03-16T13:55'</span><span class="s1">, </span><span class="s3">'1920-01-01T03:12'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.array2string(a</span><span class="s1">, </span><span class="s0">separator=</span><span class="s3">', '</span><span class="s1">,</span>
                    <span class="s0">formatter={</span><span class="s3">'datetime'</span><span class="s0">: </span><span class="s1">lambda </span><span class="s0">x:</span>
                            <span class="s3">&quot;'%s'&quot; </span><span class="s0">% np.datetime_as_string(x</span><span class="s1">, </span><span class="s0">timezone=</span><span class="s3">'UTC'</span><span class="s0">)})</span><span class="s1">,</span>
                     <span class="s3">&quot;['2011-03-16T13:55Z', '1920-01-01T03:12Z']&quot;</span><span class="s0">)</span>

        <span class="s2"># Check that one NaT doesn't corrupt subsequent entries</span>
        <span class="s0">a = np.array([</span><span class="s3">'2010'</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'2030'</span><span class="s0">]).astype(</span><span class="s3">'M'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">&quot;['2010'  'NaT' '2030']&quot;</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_array_str(self):</span>
        <span class="s0">a = np.array([-</span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">100</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">&quot;[ -1   0 100]&quot;</span><span class="s0">)</span>
        <span class="s0">a = np.array([</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">&quot;['NaT' 'NaT']&quot;</span><span class="s0">)</span>
        <span class="s2"># Check right-alignment with NaTs</span>
        <span class="s0">a = np.array([-</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s4">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">&quot;[   -1 'NaT'     0]&quot;</span><span class="s0">)</span>
        <span class="s0">a = np.array([-</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s4">1234567</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">&quot;[     -1   'NaT' 1234567]&quot;</span><span class="s0">)</span>

        <span class="s2"># Test with other byteorder:</span>
        <span class="s0">a = np.array([-</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s4">1234567</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'&gt;m'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">&quot;[     -1   'NaT' 1234567]&quot;</span><span class="s0">)</span>
        <span class="s0">a = np.array([-</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s4">1234567</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'&lt;m'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">&quot;[     -1   'NaT' 1234567]&quot;</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_pickle(self):</span>
        <span class="s2"># Check that pickle roundtripping works</span>
        <span class="s1">for </span><span class="s0">proto </span><span class="s1">in </span><span class="s0">range(</span><span class="s4">2</span><span class="s1">, </span><span class="s0">pickle.HIGHEST_PROTOCOL + </span><span class="s4">1</span><span class="s0">):</span>
            <span class="s0">dt = np.dtype(</span><span class="s3">'M8[7D]'</span><span class="s0">)</span>
            <span class="s0">assert_equal(pickle.loads(pickle.dumps(dt</span><span class="s1">, </span><span class="s0">protocol=proto))</span><span class="s1">, </span><span class="s0">dt)</span>
            <span class="s0">dt = np.dtype(</span><span class="s3">'M8[W]'</span><span class="s0">)</span>
            <span class="s0">assert_equal(pickle.loads(pickle.dumps(dt</span><span class="s1">, </span><span class="s0">protocol=proto))</span><span class="s1">, </span><span class="s0">dt)</span>
            <span class="s0">scalar = np.datetime64(</span><span class="s3">'2016-01-01T00:00:00.000000000'</span><span class="s0">)</span>
            <span class="s0">assert_equal(pickle.loads(pickle.dumps(scalar</span><span class="s1">, </span><span class="s0">protocol=proto))</span><span class="s1">,</span>
                         <span class="s0">scalar)</span>
            <span class="s0">delta = scalar - np.datetime64(</span><span class="s3">'2015-01-01T00:00:00.000000000'</span><span class="s0">)</span>
            <span class="s0">assert_equal(pickle.loads(pickle.dumps(delta</span><span class="s1">, </span><span class="s0">protocol=proto))</span><span class="s1">,</span>
                         <span class="s0">delta)</span>

        <span class="s2"># Check that loading pickles from 1.6 works</span>
        <span class="s0">pkl = </span><span class="s5">b&quot;cnumpy</span><span class="s1">\n</span><span class="s5">dtype</span><span class="s1">\n</span><span class="s5">p0</span><span class="s1">\n</span><span class="s5">(S'M8'</span><span class="s1">\n</span><span class="s5">p1</span><span class="s1">\n</span><span class="s5">I0</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">tp2</span><span class="s1">\n</span><span class="s5">Rp3</span><span class="s1">\n</span><span class="s5">&quot; </span><span class="s0">+ \</span>
              <span class="s5">b&quot;(I4</span><span class="s1">\n</span><span class="s5">S'&lt;'</span><span class="s1">\n</span><span class="s5">p4</span><span class="s1">\n</span><span class="s5">NNNI-1</span><span class="s1">\n</span><span class="s5">I-1</span><span class="s1">\n</span><span class="s5">I0</span><span class="s1">\n</span><span class="s5">((dp5</span><span class="s1">\n</span><span class="s5">(S'D'</span><span class="s1">\n</span><span class="s5">p6</span><span class="s1">\n</span><span class="s5">&quot; </span><span class="s0">+ \</span>
              <span class="s5">b&quot;I7</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">tp7</span><span class="s1">\n</span><span class="s5">tp8</span><span class="s1">\n</span><span class="s5">tp9</span><span class="s1">\n</span><span class="s5">b.&quot;</span>
        <span class="s0">assert_equal(pickle.loads(pkl)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'&lt;M8[7D]'</span><span class="s0">))</span>
        <span class="s0">pkl = </span><span class="s5">b&quot;cnumpy</span><span class="s1">\n</span><span class="s5">dtype</span><span class="s1">\n</span><span class="s5">p0</span><span class="s1">\n</span><span class="s5">(S'M8'</span><span class="s1">\n</span><span class="s5">p1</span><span class="s1">\n</span><span class="s5">I0</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">tp2</span><span class="s1">\n</span><span class="s5">Rp3</span><span class="s1">\n</span><span class="s5">&quot; </span><span class="s0">+ \</span>
              <span class="s5">b&quot;(I4</span><span class="s1">\n</span><span class="s5">S'&lt;'</span><span class="s1">\n</span><span class="s5">p4</span><span class="s1">\n</span><span class="s5">NNNI-1</span><span class="s1">\n</span><span class="s5">I-1</span><span class="s1">\n</span><span class="s5">I0</span><span class="s1">\n</span><span class="s5">((dp5</span><span class="s1">\n</span><span class="s5">(S'W'</span><span class="s1">\n</span><span class="s5">p6</span><span class="s1">\n</span><span class="s5">&quot; </span><span class="s0">+ \</span>
              <span class="s5">b&quot;I1</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">tp7</span><span class="s1">\n</span><span class="s5">tp8</span><span class="s1">\n</span><span class="s5">tp9</span><span class="s1">\n</span><span class="s5">b.&quot;</span>
        <span class="s0">assert_equal(pickle.loads(pkl)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'&lt;M8[W]'</span><span class="s0">))</span>
        <span class="s0">pkl = </span><span class="s5">b&quot;cnumpy</span><span class="s1">\n</span><span class="s5">dtype</span><span class="s1">\n</span><span class="s5">p0</span><span class="s1">\n</span><span class="s5">(S'M8'</span><span class="s1">\n</span><span class="s5">p1</span><span class="s1">\n</span><span class="s5">I0</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">tp2</span><span class="s1">\n</span><span class="s5">Rp3</span><span class="s1">\n</span><span class="s5">&quot; </span><span class="s0">+ \</span>
              <span class="s5">b&quot;(I4</span><span class="s1">\n</span><span class="s5">S'&gt;'</span><span class="s1">\n</span><span class="s5">p4</span><span class="s1">\n</span><span class="s5">NNNI-1</span><span class="s1">\n</span><span class="s5">I-1</span><span class="s1">\n</span><span class="s5">I0</span><span class="s1">\n</span><span class="s5">((dp5</span><span class="s1">\n</span><span class="s5">(S'us'</span><span class="s1">\n</span><span class="s5">p6</span><span class="s1">\n</span><span class="s5">&quot; </span><span class="s0">+ \</span>
              <span class="s5">b&quot;I1</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">I1</span><span class="s1">\n</span><span class="s5">tp7</span><span class="s1">\n</span><span class="s5">tp8</span><span class="s1">\n</span><span class="s5">tp9</span><span class="s1">\n</span><span class="s5">b.&quot;</span>
        <span class="s0">assert_equal(pickle.loads(pkl)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'&gt;M8[us]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_setstate(self):</span>
        <span class="s6">&quot;Verify that datetime dtype __setstate__ can handle bad arguments&quot;</span>
        <span class="s0">dt = np.dtype(</span><span class="s3">'&gt;M8[us]'</span><span class="s0">)</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">dt.__setstate__</span><span class="s1">, </span><span class="s0">(</span><span class="s4">4</span><span class="s1">, </span><span class="s3">'&gt;'</span><span class="s1">, None, None, None, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_(dt.__reduce__()[</span><span class="s4">2</span><span class="s0">] == np.dtype(</span><span class="s3">'&gt;M8[us]'</span><span class="s0">).__reduce__()[</span><span class="s4">2</span><span class="s0">])</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">dt.__setstate__</span><span class="s1">, </span><span class="s0">(</span><span class="s4">4</span><span class="s1">, </span><span class="s3">'&gt;'</span><span class="s1">, None, None, None, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">({}</span><span class="s1">, </span><span class="s3">'xxx'</span><span class="s0">)))</span>
        <span class="s0">assert_(dt.__reduce__()[</span><span class="s4">2</span><span class="s0">] == np.dtype(</span><span class="s3">'&gt;M8[us]'</span><span class="s0">).__reduce__()[</span><span class="s4">2</span><span class="s0">])</span>

    <span class="s1">def </span><span class="s0">test_dtype_promotion(self):</span>
        <span class="s2"># datetime &lt;op&gt; datetime computes the metadata gcd</span>
        <span class="s2"># timedelta &lt;op&gt; timedelta computes the metadata gcd</span>
        <span class="s1">for </span><span class="s0">mM </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'m'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">]:</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.promote_types(np.dtype(mM+</span><span class="s3">'8[2Y]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(mM+</span><span class="s3">'8[2Y]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.dtype(mM+</span><span class="s3">'8[2Y]'</span><span class="s0">))</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.promote_types(np.dtype(mM+</span><span class="s3">'8[12Y]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(mM+</span><span class="s3">'8[15Y]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.dtype(mM+</span><span class="s3">'8[3Y]'</span><span class="s0">))</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.promote_types(np.dtype(mM+</span><span class="s3">'8[62M]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(mM+</span><span class="s3">'8[24M]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.dtype(mM+</span><span class="s3">'8[2M]'</span><span class="s0">))</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.promote_types(np.dtype(mM+</span><span class="s3">'8[1W]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(mM+</span><span class="s3">'8[2D]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.dtype(mM+</span><span class="s3">'8[1D]'</span><span class="s0">))</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.promote_types(np.dtype(mM+</span><span class="s3">'8[W]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(mM+</span><span class="s3">'8[13s]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.dtype(mM+</span><span class="s3">'8[s]'</span><span class="s0">))</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.promote_types(np.dtype(mM+</span><span class="s3">'8[13W]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(mM+</span><span class="s3">'8[49s]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.dtype(mM+</span><span class="s3">'8[7s]'</span><span class="s0">))</span>
        <span class="s2"># timedelta &lt;op&gt; timedelta raises when there is no reasonable gcd</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.promote_types</span><span class="s1">,</span>
                            <span class="s0">np.dtype(</span><span class="s3">'m8[Y]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[D]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.promote_types</span><span class="s1">,</span>
                            <span class="s0">np.dtype(</span><span class="s3">'m8[M]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[W]'</span><span class="s0">))</span>
        <span class="s2"># timedelta and float cannot be safely cast with each other</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.promote_types</span><span class="s1">, </span><span class="s3">&quot;float32&quot;</span><span class="s1">, </span><span class="s3">&quot;m8&quot;</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.promote_types</span><span class="s1">, </span><span class="s3">&quot;m8&quot;</span><span class="s1">, </span><span class="s3">&quot;float32&quot;</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.promote_types</span><span class="s1">, </span><span class="s3">&quot;uint64&quot;</span><span class="s1">, </span><span class="s3">&quot;m8&quot;</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.promote_types</span><span class="s1">, </span><span class="s3">&quot;m8&quot;</span><span class="s1">, </span><span class="s3">&quot;uint64&quot;</span><span class="s0">)</span>

        <span class="s2"># timedelta &lt;op&gt; timedelta may overflow with big unit ranges</span>
        <span class="s0">assert_raises(OverflowError</span><span class="s1">, </span><span class="s0">np.promote_types</span><span class="s1">,</span>
                            <span class="s0">np.dtype(</span><span class="s3">'m8[W]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[fs]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(OverflowError</span><span class="s1">, </span><span class="s0">np.promote_types</span><span class="s1">,</span>
                            <span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[as]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_cast_overflow(self):</span>
        <span class="s2"># gh-4486</span>
        <span class="s1">def </span><span class="s0">cast():</span>
            <span class="s0">numpy.datetime64(</span><span class="s3">&quot;1971-01-01 00:00:00.000000000000000&quot;</span><span class="s0">).astype(</span><span class="s3">&quot;&lt;M8[D]&quot;</span><span class="s0">)</span>
        <span class="s0">assert_raises(OverflowError</span><span class="s1">, </span><span class="s0">cast)</span>

        <span class="s1">def </span><span class="s0">cast2():</span>
            <span class="s0">numpy.datetime64(</span><span class="s3">&quot;2014&quot;</span><span class="s0">).astype(</span><span class="s3">&quot;&lt;M8[fs]&quot;</span><span class="s0">)</span>
        <span class="s0">assert_raises(OverflowError</span><span class="s1">, </span><span class="s0">cast2)</span>

    <span class="s1">def </span><span class="s0">test_pyobject_roundtrip(self):</span>
        <span class="s2"># All datetime types should be able to roundtrip through object</span>
        <span class="s0">a = np.array([</span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">,</span>
                      <span class="s0">-</span><span class="s4">1020040340</span><span class="s1">, </span><span class="s0">-</span><span class="s4">2942398</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">234523453</span><span class="s1">, </span><span class="s4">1199164176</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">dtype=np.int64)</span>
        <span class="s2"># With date units</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'M8[D]'</span><span class="s1">, </span><span class="s3">'M8[W]'</span><span class="s1">, </span><span class="s3">'M8[M]'</span><span class="s1">, </span><span class="s3">'M8[Y]'</span><span class="s0">]:</span>
            <span class="s0">b = a.copy().view(dtype=unit)</span>
            <span class="s0">b[</span><span class="s4">0</span><span class="s0">] = </span><span class="s3">'-0001-01-01'</span>
            <span class="s0">b[</span><span class="s4">1</span><span class="s0">] = </span><span class="s3">'-0001-12-31'</span>
            <span class="s0">b[</span><span class="s4">2</span><span class="s0">] = </span><span class="s3">'0000-01-01'</span>
            <span class="s0">b[</span><span class="s4">3</span><span class="s0">] = </span><span class="s3">'0001-01-01'</span>
            <span class="s0">b[</span><span class="s4">4</span><span class="s0">] = </span><span class="s3">'1969-12-31'</span>
            <span class="s0">b[</span><span class="s4">5</span><span class="s0">] = </span><span class="s3">'1970-01-01'</span>
            <span class="s0">b[</span><span class="s4">6</span><span class="s0">] = </span><span class="s3">'9999-12-31'</span>
            <span class="s0">b[</span><span class="s4">7</span><span class="s0">] = </span><span class="s3">'10000-01-01'</span>
            <span class="s0">b[</span><span class="s4">8</span><span class="s0">] = </span><span class="s3">'NaT'</span>

            <span class="s0">assert_equal(b.astype(object).astype(unit)</span><span class="s1">, </span><span class="s0">b</span><span class="s1">,</span>
                            <span class="s3">&quot;Error roundtripping unit %s&quot; </span><span class="s0">% unit)</span>
        <span class="s2"># With time units</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'M8[as]'</span><span class="s1">, </span><span class="s3">'M8[16fs]'</span><span class="s1">, </span><span class="s3">'M8[ps]'</span><span class="s1">, </span><span class="s3">'M8[us]'</span><span class="s1">,</span>
                     <span class="s3">'M8[300as]'</span><span class="s1">, </span><span class="s3">'M8[20us]'</span><span class="s0">]:</span>
            <span class="s0">b = a.copy().view(dtype=unit)</span>
            <span class="s0">b[</span><span class="s4">0</span><span class="s0">] = </span><span class="s3">'-0001-01-01T00'</span>
            <span class="s0">b[</span><span class="s4">1</span><span class="s0">] = </span><span class="s3">'-0001-12-31T00'</span>
            <span class="s0">b[</span><span class="s4">2</span><span class="s0">] = </span><span class="s3">'0000-01-01T00'</span>
            <span class="s0">b[</span><span class="s4">3</span><span class="s0">] = </span><span class="s3">'0001-01-01T00'</span>
            <span class="s0">b[</span><span class="s4">4</span><span class="s0">] = </span><span class="s3">'1969-12-31T23:59:59.999999'</span>
            <span class="s0">b[</span><span class="s4">5</span><span class="s0">] = </span><span class="s3">'1970-01-01T00'</span>
            <span class="s0">b[</span><span class="s4">6</span><span class="s0">] = </span><span class="s3">'9999-12-31T23:59:59.999999'</span>
            <span class="s0">b[</span><span class="s4">7</span><span class="s0">] = </span><span class="s3">'10000-01-01T00'</span>
            <span class="s0">b[</span><span class="s4">8</span><span class="s0">] = </span><span class="s3">'NaT'</span>

            <span class="s0">assert_equal(b.astype(object).astype(unit)</span><span class="s1">, </span><span class="s0">b</span><span class="s1">,</span>
                            <span class="s3">&quot;Error roundtripping unit %s&quot; </span><span class="s0">% unit)</span>

    <span class="s1">def </span><span class="s0">test_month_truncation(self):</span>
        <span class="s2"># Make sure that months are truncating correctly</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1945-03-01'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[M]'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.array(</span><span class="s3">'1945-03-31'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1969-11-01'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[M]'</span><span class="s0">)</span><span class="s1">,</span>
             <span class="s0">np.array(</span><span class="s3">'1969-11-30T23:59:59.99999'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">).astype(</span><span class="s3">'M8[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1969-12-01'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[M]'</span><span class="s0">)</span><span class="s1">,</span>
             <span class="s0">np.array(</span><span class="s3">'1969-12-31T23:59:59.99999'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">).astype(</span><span class="s3">'M8[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1970-01-01'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[M]'</span><span class="s0">)</span><span class="s1">,</span>
             <span class="s0">np.array(</span><span class="s3">'1970-01-31T23:59:59.99999'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">).astype(</span><span class="s3">'M8[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.array(</span><span class="s3">'1980-02-01'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[M]'</span><span class="s0">)</span><span class="s1">,</span>
             <span class="s0">np.array(</span><span class="s3">'1980-02-29T23:59:59.99999'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">).astype(</span><span class="s3">'M8[M]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_different_unit_comparison(self):</span>
        <span class="s2"># Check some years with date units</span>
        <span class="s1">for </span><span class="s0">unit1 </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'Y'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">]:</span>
            <span class="s0">dt1 = np.dtype(</span><span class="s3">'M8[%s]' </span><span class="s0">% unit1)</span>
            <span class="s1">for </span><span class="s0">unit2 </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'Y'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">]:</span>
                <span class="s0">dt2 = np.dtype(</span><span class="s3">'M8[%s]' </span><span class="s0">% unit2)</span>
                <span class="s0">assert_equal(np.array(</span><span class="s3">'1945'</span><span class="s1">, </span><span class="s0">dtype=dt1)</span><span class="s1">,</span>
                             <span class="s0">np.array(</span><span class="s3">'1945'</span><span class="s1">, </span><span class="s0">dtype=dt2))</span>
                <span class="s0">assert_equal(np.array(</span><span class="s3">'1970'</span><span class="s1">, </span><span class="s0">dtype=dt1)</span><span class="s1">,</span>
                             <span class="s0">np.array(</span><span class="s3">'1970'</span><span class="s1">, </span><span class="s0">dtype=dt2))</span>
                <span class="s0">assert_equal(np.array(</span><span class="s3">'9999'</span><span class="s1">, </span><span class="s0">dtype=dt1)</span><span class="s1">,</span>
                             <span class="s0">np.array(</span><span class="s3">'9999'</span><span class="s1">, </span><span class="s0">dtype=dt2))</span>
                <span class="s0">assert_equal(np.array(</span><span class="s3">'10000'</span><span class="s1">, </span><span class="s0">dtype=dt1)</span><span class="s1">,</span>
                             <span class="s0">np.array(</span><span class="s3">'10000-01-01'</span><span class="s1">, </span><span class="s0">dtype=dt2))</span>
                <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1945'</span><span class="s1">, </span><span class="s0">unit1)</span><span class="s1">,</span>
                             <span class="s0">np.datetime64(</span><span class="s3">'1945'</span><span class="s1">, </span><span class="s0">unit2))</span>
                <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1970'</span><span class="s1">, </span><span class="s0">unit1)</span><span class="s1">,</span>
                             <span class="s0">np.datetime64(</span><span class="s3">'1970'</span><span class="s1">, </span><span class="s0">unit2))</span>
                <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'9999'</span><span class="s1">, </span><span class="s0">unit1)</span><span class="s1">,</span>
                             <span class="s0">np.datetime64(</span><span class="s3">'9999'</span><span class="s1">, </span><span class="s0">unit2))</span>
                <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'10000'</span><span class="s1">, </span><span class="s0">unit1)</span><span class="s1">,</span>
                             <span class="s0">np.datetime64(</span><span class="s3">'10000-01-01'</span><span class="s1">, </span><span class="s0">unit2))</span>
        <span class="s2"># Check some datetimes with time units</span>
        <span class="s1">for </span><span class="s0">unit1 </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'6h'</span><span class="s1">, </span><span class="s3">'h'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s1">, </span><span class="s3">'10ms'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">]:</span>
            <span class="s0">dt1 = np.dtype(</span><span class="s3">'M8[%s]' </span><span class="s0">% unit1)</span>
            <span class="s1">for </span><span class="s0">unit2 </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'h'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">]:</span>
                <span class="s0">dt2 = np.dtype(</span><span class="s3">'M8[%s]' </span><span class="s0">% unit2)</span>
                <span class="s0">assert_equal(np.array(</span><span class="s3">'1945-03-12T18'</span><span class="s1">, </span><span class="s0">dtype=dt1)</span><span class="s1">,</span>
                             <span class="s0">np.array(</span><span class="s3">'1945-03-12T18'</span><span class="s1">, </span><span class="s0">dtype=dt2))</span>
                <span class="s0">assert_equal(np.array(</span><span class="s3">'1970-03-12T18'</span><span class="s1">, </span><span class="s0">dtype=dt1)</span><span class="s1">,</span>
                             <span class="s0">np.array(</span><span class="s3">'1970-03-12T18'</span><span class="s1">, </span><span class="s0">dtype=dt2))</span>
                <span class="s0">assert_equal(np.array(</span><span class="s3">'9999-03-12T18'</span><span class="s1">, </span><span class="s0">dtype=dt1)</span><span class="s1">,</span>
                             <span class="s0">np.array(</span><span class="s3">'9999-03-12T18'</span><span class="s1">, </span><span class="s0">dtype=dt2))</span>
                <span class="s0">assert_equal(np.array(</span><span class="s3">'10000-01-01T00'</span><span class="s1">, </span><span class="s0">dtype=dt1)</span><span class="s1">,</span>
                             <span class="s0">np.array(</span><span class="s3">'10000-01-01T00'</span><span class="s1">, </span><span class="s0">dtype=dt2))</span>
                <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1945-03-12T18'</span><span class="s1">, </span><span class="s0">unit1)</span><span class="s1">,</span>
                             <span class="s0">np.datetime64(</span><span class="s3">'1945-03-12T18'</span><span class="s1">, </span><span class="s0">unit2))</span>
                <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1970-03-12T18'</span><span class="s1">, </span><span class="s0">unit1)</span><span class="s1">,</span>
                             <span class="s0">np.datetime64(</span><span class="s3">'1970-03-12T18'</span><span class="s1">, </span><span class="s0">unit2))</span>
                <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'9999-03-12T18'</span><span class="s1">, </span><span class="s0">unit1)</span><span class="s1">,</span>
                             <span class="s0">np.datetime64(</span><span class="s3">'9999-03-12T18'</span><span class="s1">, </span><span class="s0">unit2))</span>
                <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'10000-01-01T00'</span><span class="s1">, </span><span class="s0">unit1)</span><span class="s1">,</span>
                             <span class="s0">np.datetime64(</span><span class="s3">'10000-01-01T00'</span><span class="s1">, </span><span class="s0">unit2))</span>
        <span class="s2"># Check some days with units that won't overflow</span>
        <span class="s1">for </span><span class="s0">unit1 </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'D'</span><span class="s1">, </span><span class="s3">'12h'</span><span class="s1">, </span><span class="s3">'h'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s1">, </span><span class="s3">'4s'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">]:</span>
            <span class="s0">dt1 = np.dtype(</span><span class="s3">'M8[%s]' </span><span class="s0">% unit1)</span>
            <span class="s1">for </span><span class="s0">unit2 </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'D'</span><span class="s1">, </span><span class="s3">'h'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">]:</span>
                <span class="s0">dt2 = np.dtype(</span><span class="s3">'M8[%s]' </span><span class="s0">% unit2)</span>
                <span class="s0">assert_(np.equal(np.array(</span><span class="s3">'1932-02-17'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">).astype(dt1)</span><span class="s1">,</span>
                     <span class="s0">np.array(</span><span class="s3">'1932-02-17T00:00:00'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">).astype(dt2)</span><span class="s1">,</span>
                     <span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">))</span>
                <span class="s0">assert_(np.equal(np.array(</span><span class="s3">'10000-04-27'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">).astype(dt1)</span><span class="s1">,</span>
                     <span class="s0">np.array(</span><span class="s3">'10000-04-27T00:00:00'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M'</span><span class="s0">).astype(dt2)</span><span class="s1">,</span>
                     <span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">))</span>

        <span class="s2"># Shouldn't be able to compare datetime and timedelta</span>
        <span class="s2"># TODO: Changing to 'same_kind' or 'safe' casting in the ufuncs by</span>
        <span class="s2">#       default is needed to properly catch this kind of thing...</span>
        <span class="s0">a = np.array(</span><span class="s3">'2012-12-21'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">b = np.array(</span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[D]'</span><span class="s0">)</span>
        <span class="s2">#assert_raises(TypeError, np.less, a, b)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.less</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_like(self):</span>
        <span class="s0">a = np.array([</span><span class="s4">3</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[4D]'</span><span class="s0">)</span>
        <span class="s0">b = np.array([</span><span class="s3">'2012-12-21'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>

        <span class="s0">assert_equal(np.ones_like(a).dtype</span><span class="s1">, </span><span class="s0">a.dtype)</span>
        <span class="s0">assert_equal(np.zeros_like(a).dtype</span><span class="s1">, </span><span class="s0">a.dtype)</span>
        <span class="s0">assert_equal(np.empty_like(a).dtype</span><span class="s1">, </span><span class="s0">a.dtype)</span>
        <span class="s0">assert_equal(np.ones_like(b).dtype</span><span class="s1">, </span><span class="s0">b.dtype)</span>
        <span class="s0">assert_equal(np.zeros_like(b).dtype</span><span class="s1">, </span><span class="s0">b.dtype)</span>
        <span class="s0">assert_equal(np.empty_like(b).dtype</span><span class="s1">, </span><span class="s0">b.dtype)</span>

    <span class="s1">def </span><span class="s0">test_datetime_unary(self):</span>
        <span class="s1">for </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">tdzero</span><span class="s1">, </span><span class="s0">tdone</span><span class="s1">, </span><span class="s0">tdmone </span><span class="s1">in </span><span class="s0">\</span>
                <span class="s0">[</span>
                 <span class="s2"># One-dimensional arrays</span>
                 <span class="s0">(np.array([</span><span class="s4">3</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">np.array([-</span><span class="s4">3</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">np.array([</span><span class="s4">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">np.array([</span><span class="s4">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">np.array([-</span><span class="s4">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[D]'</span><span class="s0">))</span><span class="s1">,</span>
                 <span class="s2"># NumPy scalars</span>
                 <span class="s0">(np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">np.timedelta64(-</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                  <span class="s0">np.timedelta64(-</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">))]:</span>
            <span class="s2"># negative ufunc</span>
            <span class="s0">assert_equal(-tdb</span><span class="s1">, </span><span class="s0">tda)</span>
            <span class="s0">assert_equal((-tdb).dtype</span><span class="s1">, </span><span class="s0">tda.dtype)</span>
            <span class="s0">assert_equal(np.negative(tdb)</span><span class="s1">, </span><span class="s0">tda)</span>
            <span class="s0">assert_equal(np.negative(tdb).dtype</span><span class="s1">, </span><span class="s0">tda.dtype)</span>

            <span class="s2"># positive ufunc</span>
            <span class="s0">assert_equal(np.positive(tda)</span><span class="s1">, </span><span class="s0">tda)</span>
            <span class="s0">assert_equal(np.positive(tda).dtype</span><span class="s1">, </span><span class="s0">tda.dtype)</span>
            <span class="s0">assert_equal(np.positive(tdb)</span><span class="s1">, </span><span class="s0">tdb)</span>
            <span class="s0">assert_equal(np.positive(tdb).dtype</span><span class="s1">, </span><span class="s0">tdb.dtype)</span>

            <span class="s2"># absolute ufunc</span>
            <span class="s0">assert_equal(np.absolute(tdb)</span><span class="s1">, </span><span class="s0">tda)</span>
            <span class="s0">assert_equal(np.absolute(tdb).dtype</span><span class="s1">, </span><span class="s0">tda.dtype)</span>

            <span class="s2"># sign ufunc</span>
            <span class="s0">assert_equal(np.sign(tda)</span><span class="s1">, </span><span class="s0">tdone)</span>
            <span class="s0">assert_equal(np.sign(tdb)</span><span class="s1">, </span><span class="s0">tdmone)</span>
            <span class="s0">assert_equal(np.sign(tdzero)</span><span class="s1">, </span><span class="s0">tdzero)</span>
            <span class="s0">assert_equal(np.sign(tda).dtype</span><span class="s1">, </span><span class="s0">tda.dtype)</span>

            <span class="s2"># The ufuncs always produce native-endian results</span>
            <span class="s0">assert_</span>

    <span class="s1">def </span><span class="s0">test_datetime_add(self):</span>
        <span class="s1">for </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">dtb</span><span class="s1">, </span><span class="s0">dtc</span><span class="s1">, </span><span class="s0">dtnat</span><span class="s1">, </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">tdc </span><span class="s1">in </span><span class="s0">\</span>
                    <span class="s0">[</span>
                     <span class="s2"># One-dimensional arrays</span>
                     <span class="s0">(np.array([</span><span class="s3">'2012-12-21'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s3">'2012-12-24'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s3">'2012-12-21T11'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s3">'NaT'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">3</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">11</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">3</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">+ </span><span class="s4">11</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s2"># NumPy scalars</span>
                     <span class="s0">(np.datetime64(</span><span class="s3">'2012-12-21'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.datetime64(</span><span class="s3">'2012-12-24'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.datetime64(</span><span class="s3">'2012-12-21T11'</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">11</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">3</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">+ </span><span class="s4">11</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">))]:</span>
            <span class="s2"># m8 + m8</span>
            <span class="s0">assert_equal(tda + tdb</span><span class="s1">, </span><span class="s0">tdc)</span>
            <span class="s0">assert_equal((tda + tdb).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># m8 + bool</span>
            <span class="s0">assert_equal(tdb + </span><span class="s1">True, </span><span class="s0">tdb + </span><span class="s4">1</span><span class="s0">)</span>
            <span class="s0">assert_equal((tdb + </span><span class="s1">True</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># m8 + int</span>
            <span class="s0">assert_equal(tdb + </span><span class="s4">3</span><span class="s0">*</span><span class="s4">24</span><span class="s1">, </span><span class="s0">tdc)</span>
            <span class="s0">assert_equal((tdb + </span><span class="s4">3</span><span class="s0">*</span><span class="s4">24</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># bool + m8</span>
            <span class="s0">assert_equal(</span><span class="s1">False </span><span class="s0">+ tdb</span><span class="s1">, </span><span class="s0">tdb)</span>
            <span class="s0">assert_equal((</span><span class="s1">False </span><span class="s0">+ tdb).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># int + m8</span>
            <span class="s0">assert_equal(</span><span class="s4">3</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">+ tdb</span><span class="s1">, </span><span class="s0">tdc)</span>
            <span class="s0">assert_equal((</span><span class="s4">3</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">+ tdb).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># M8 + bool</span>
            <span class="s0">assert_equal(dta + </span><span class="s1">True, </span><span class="s0">dta + </span><span class="s4">1</span><span class="s0">)</span>
            <span class="s0">assert_equal(dtnat + </span><span class="s1">True, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((dta + </span><span class="s1">True</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
            <span class="s2"># M8 + int</span>
            <span class="s0">assert_equal(dta + </span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtb)</span>
            <span class="s0">assert_equal(dtnat + </span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((dta + </span><span class="s4">3</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
            <span class="s2"># bool + M8</span>
            <span class="s0">assert_equal(</span><span class="s1">False </span><span class="s0">+ dta</span><span class="s1">, </span><span class="s0">dta)</span>
            <span class="s0">assert_equal(</span><span class="s1">False </span><span class="s0">+ dtnat</span><span class="s1">, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((</span><span class="s1">False </span><span class="s0">+ dta).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
            <span class="s2"># int + M8</span>
            <span class="s0">assert_equal(</span><span class="s4">3 </span><span class="s0">+ dta</span><span class="s1">, </span><span class="s0">dtb)</span>
            <span class="s0">assert_equal(</span><span class="s4">3 </span><span class="s0">+ dtnat</span><span class="s1">, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((</span><span class="s4">3 </span><span class="s0">+ dta).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
            <span class="s2"># M8 + m8</span>
            <span class="s0">assert_equal(dta + tda</span><span class="s1">, </span><span class="s0">dtb)</span>
            <span class="s0">assert_equal(dtnat + tda</span><span class="s1">, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((dta + tda).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
            <span class="s2"># m8 + M8</span>
            <span class="s0">assert_equal(tda + dta</span><span class="s1">, </span><span class="s0">dtb)</span>
            <span class="s0">assert_equal(tda + dtnat</span><span class="s1">, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((tda + dta).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>

            <span class="s2"># In M8 + m8, the result goes to higher precision</span>
            <span class="s0">assert_equal(np.add(dta</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">dtc)</span>
            <span class="s0">assert_equal(np.add(dta</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">).dtype</span><span class="s1">,</span>
                         <span class="s0">np.dtype(</span><span class="s3">'M8[h]'</span><span class="s0">))</span>
            <span class="s0">assert_equal(np.add(tdb</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">dtc)</span>
            <span class="s0">assert_equal(np.add(tdb</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">).dtype</span><span class="s1">,</span>
                         <span class="s0">np.dtype(</span><span class="s3">'M8[h]'</span><span class="s0">))</span>

            <span class="s2"># M8 + M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.add</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">dtb)</span>

    <span class="s1">def </span><span class="s0">test_datetime_subtract(self):</span>
        <span class="s1">for </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">dtb</span><span class="s1">, </span><span class="s0">dtc</span><span class="s1">, </span><span class="s0">dtd</span><span class="s1">, </span><span class="s0">dte</span><span class="s1">, </span><span class="s0">dtnat</span><span class="s1">, </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">tdc </span><span class="s1">in </span><span class="s0">\</span>
                    <span class="s0">[</span>
                     <span class="s2"># One-dimensional arrays</span>
                     <span class="s0">(np.array([</span><span class="s3">'2012-12-21'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s3">'2012-12-24'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s3">'1940-12-24'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s3">'1940-12-24T00'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s3">'1940-12-23T13'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s3">'NaT'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">3</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">11</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">3</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">- </span><span class="s4">11</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s2"># NumPy scalars</span>
                     <span class="s0">(np.datetime64(</span><span class="s3">'2012-12-21'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.datetime64(</span><span class="s3">'2012-12-24'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.datetime64(</span><span class="s3">'1940-12-24'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.datetime64(</span><span class="s3">'1940-12-24T00'</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.datetime64(</span><span class="s3">'1940-12-23T13'</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">11</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">3</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">- </span><span class="s4">11</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">))]:</span>
            <span class="s2"># m8 - m8</span>
            <span class="s0">assert_equal(tda - tdb</span><span class="s1">, </span><span class="s0">tdc)</span>
            <span class="s0">assert_equal((tda - tdb).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s0">assert_equal(tdb - tda</span><span class="s1">, </span><span class="s0">-tdc)</span>
            <span class="s0">assert_equal((tdb - tda).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># m8 - bool</span>
            <span class="s0">assert_equal(tdc - </span><span class="s1">True, </span><span class="s0">tdc - </span><span class="s4">1</span><span class="s0">)</span>
            <span class="s0">assert_equal((tdc - </span><span class="s1">True</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># m8 - int</span>
            <span class="s0">assert_equal(tdc - </span><span class="s4">3</span><span class="s0">*</span><span class="s4">24</span><span class="s1">, </span><span class="s0">-tdb)</span>
            <span class="s0">assert_equal((tdc - </span><span class="s4">3</span><span class="s0">*</span><span class="s4">24</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># int - m8</span>
            <span class="s0">assert_equal(</span><span class="s1">False </span><span class="s0">- tdb</span><span class="s1">, </span><span class="s0">-tdb)</span>
            <span class="s0">assert_equal((</span><span class="s1">False </span><span class="s0">- tdb).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># int - m8</span>
            <span class="s0">assert_equal(</span><span class="s4">3</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">- tdb</span><span class="s1">, </span><span class="s0">tdc)</span>
            <span class="s0">assert_equal((</span><span class="s4">3</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">- tdb).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># M8 - bool</span>
            <span class="s0">assert_equal(dtb - </span><span class="s1">True, </span><span class="s0">dtb - </span><span class="s4">1</span><span class="s0">)</span>
            <span class="s0">assert_equal(dtnat - </span><span class="s1">True, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((dtb - </span><span class="s1">True</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
            <span class="s2"># M8 - int</span>
            <span class="s0">assert_equal(dtb - </span><span class="s4">3</span><span class="s1">, </span><span class="s0">dta)</span>
            <span class="s0">assert_equal(dtnat - </span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((dtb - </span><span class="s4">3</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
            <span class="s2"># M8 - m8</span>
            <span class="s0">assert_equal(dtb - tda</span><span class="s1">, </span><span class="s0">dta)</span>
            <span class="s0">assert_equal(dtnat - tda</span><span class="s1">, </span><span class="s0">dtnat)</span>
            <span class="s0">assert_equal((dtb - tda).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>

            <span class="s2"># In M8 - m8, the result goes to higher precision</span>
            <span class="s0">assert_equal(np.subtract(dtc</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">dte)</span>
            <span class="s0">assert_equal(np.subtract(dtc</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">).dtype</span><span class="s1">,</span>
                         <span class="s0">np.dtype(</span><span class="s3">'M8[h]'</span><span class="s0">))</span>

            <span class="s2"># M8 - M8 with different goes to higher precision</span>
            <span class="s0">assert_equal(np.subtract(dtc</span><span class="s1">, </span><span class="s0">dtd</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">,</span>
                         <span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">))</span>
            <span class="s0">assert_equal(np.subtract(dtc</span><span class="s1">, </span><span class="s0">dtd</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">).dtype</span><span class="s1">,</span>
                         <span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s0">assert_equal(np.subtract(dtd</span><span class="s1">, </span><span class="s0">dtc</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">,</span>
                         <span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">))</span>
            <span class="s0">assert_equal(np.subtract(dtd</span><span class="s1">, </span><span class="s0">dtc</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">).dtype</span><span class="s1">,</span>
                         <span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>

            <span class="s2"># m8 - M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.subtract</span><span class="s1">, </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">dta)</span>
            <span class="s2"># bool - M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.subtract</span><span class="s1">, False, </span><span class="s0">dta)</span>
            <span class="s2"># int - M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.subtract</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s0">dta)</span>

    <span class="s1">def </span><span class="s0">test_datetime_multiply(self):</span>
        <span class="s1">for </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">tdc </span><span class="s1">in </span><span class="s0">\</span>
                    <span class="s0">[</span>
                     <span class="s2"># One-dimensional arrays</span>
                     <span class="s0">(np.array([</span><span class="s3">'2012-12-21'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">6</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">9</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">12</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s2"># NumPy scalars</span>
                     <span class="s0">(np.datetime64(</span><span class="s3">'2012-12-21'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">6</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">9</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">12</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">))]:</span>
            <span class="s2"># m8 * int</span>
            <span class="s0">assert_equal(tda * </span><span class="s4">2</span><span class="s1">, </span><span class="s0">tdc)</span>
            <span class="s0">assert_equal((tda * </span><span class="s4">2</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># int * m8</span>
            <span class="s0">assert_equal(</span><span class="s4">2 </span><span class="s0">* tda</span><span class="s1">, </span><span class="s0">tdc)</span>
            <span class="s0">assert_equal((</span><span class="s4">2 </span><span class="s0">* tda).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># m8 * float</span>
            <span class="s0">assert_equal(tda * </span><span class="s4">1.5</span><span class="s1">, </span><span class="s0">tdb)</span>
            <span class="s0">assert_equal((tda * </span><span class="s4">1.5</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># float * m8</span>
            <span class="s0">assert_equal(</span><span class="s4">1.5 </span><span class="s0">* tda</span><span class="s1">, </span><span class="s0">tdb)</span>
            <span class="s0">assert_equal((</span><span class="s4">1.5 </span><span class="s0">* tda).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>

            <span class="s2"># m8 * m8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.multiply</span><span class="s1">, </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">tdb)</span>
            <span class="s2"># m8 * M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.multiply</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">tda)</span>
            <span class="s2"># M8 * m8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.multiply</span><span class="s1">, </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">dta)</span>
            <span class="s2"># M8 * int</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.multiply</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s4">2</span><span class="s0">)</span>
            <span class="s2"># int * M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.multiply</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s0">dta)</span>
            <span class="s2"># M8 * float</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.multiply</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s4">1.5</span><span class="s0">)</span>
            <span class="s2"># float * M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.multiply</span><span class="s1">, </span><span class="s4">1.5</span><span class="s1">, </span><span class="s0">dta)</span>

        <span class="s2"># NaTs</span>
        <span class="s1">with </span><span class="s0">suppress_warnings() </span><span class="s1">as </span><span class="s0">sup:</span>
            <span class="s0">sup.filter(RuntimeWarning</span><span class="s1">, </span><span class="s3">&quot;invalid value encountered in multiply&quot;</span><span class="s0">)</span>
            <span class="s0">nat = np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">)</span>
            <span class="s1">def </span><span class="s0">check(a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">res):</span>
                <span class="s0">assert_equal(a * b</span><span class="s1">, </span><span class="s0">res)</span>
                <span class="s0">assert_equal(b * a</span><span class="s1">, </span><span class="s0">res)</span>
            <span class="s1">for </span><span class="s0">tp </span><span class="s1">in </span><span class="s0">(int</span><span class="s1">, </span><span class="s0">float):</span>
                <span class="s0">check(nat</span><span class="s1">, </span><span class="s0">tp(</span><span class="s4">2</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
                <span class="s0">check(nat</span><span class="s1">, </span><span class="s0">tp(</span><span class="s4">0</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
            <span class="s1">for </span><span class="s0">f </span><span class="s1">in </span><span class="s0">(float(</span><span class="s3">'inf'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">float(</span><span class="s3">'nan'</span><span class="s0">)):</span>
                <span class="s0">check(np.timedelta64(</span><span class="s4">1</span><span class="s0">)</span><span class="s1">, </span><span class="s0">f</span><span class="s1">, </span><span class="s0">nat)</span>
                <span class="s0">check(np.timedelta64(</span><span class="s4">0</span><span class="s0">)</span><span class="s1">, </span><span class="s0">f</span><span class="s1">, </span><span class="s0">nat)</span>
                <span class="s0">check(nat</span><span class="s1">, </span><span class="s0">f</span><span class="s1">, </span><span class="s0">nat)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;op1, op2, exp&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># m8 same units round down</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">4</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s4">1</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s2"># m8 same units round down with negative</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(-</span><span class="s4">4</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">-</span><span class="s4">2</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s2"># m8 same units negative no round down</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">8</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(-</span><span class="s4">4</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">-</span><span class="s4">2</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s2"># m8 different units</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">31</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s4">1</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s2"># m8 generic units</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">1890</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">31</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s4">60</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s2"># Y // M works</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">2</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s3">'13'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s4">1</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s2"># handle 1D arrays</span>
        <span class="s0">(np.array([</span><span class="s4">1</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s4">3</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.array([</span><span class="s4">2</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.array([</span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=np.int64))</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_floor_divide(self</span><span class="s1">, </span><span class="s0">op1</span><span class="s1">, </span><span class="s0">op2</span><span class="s1">, </span><span class="s0">exp):</span>
        <span class="s0">assert_equal(op1 // op2</span><span class="s1">, </span><span class="s0">exp)</span>

    <span class="s0">@pytest.mark.skipif(IS_WASM</span><span class="s1">, </span><span class="s0">reason=</span><span class="s3">&quot;fp errors don't work in wasm&quot;</span><span class="s0">)</span>
    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;op1, op2&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># div by 0</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">10</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># div with NaT</span>
        <span class="s0">(np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">50</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># special case for int64 min</span>
        <span class="s2"># in integer floor division</span>
        <span class="s0">(np.timedelta64(np.iinfo(np.int64).min)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(-</span><span class="s4">1</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_floor_div_warnings(self</span><span class="s1">, </span><span class="s0">op1</span><span class="s1">, </span><span class="s0">op2):</span>
        <span class="s1">with </span><span class="s0">assert_warns(RuntimeWarning):</span>
            <span class="s0">actual = op1 // op2</span>
            <span class="s0">assert_equal(actual</span><span class="s1">, </span><span class="s4">0</span><span class="s0">)</span>
            <span class="s0">assert_equal(actual.dtype</span><span class="s1">, </span><span class="s0">np.int64)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;val1, val2&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># the smallest integer that can't be represented</span>
        <span class="s2"># exactly in a double should be preserved if we avoid</span>
        <span class="s2"># casting to double in floordiv operation</span>
        <span class="s0">(</span><span class="s4">9007199254740993</span><span class="s1">, </span><span class="s4">1</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s2"># stress the alternate floordiv code path where</span>
        <span class="s2"># operand signs don't match and remainder isn't 0</span>
        <span class="s0">(</span><span class="s4">9007199254740999</span><span class="s1">, </span><span class="s0">-</span><span class="s4">2</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_floor_div_precision(self</span><span class="s1">, </span><span class="s0">val1</span><span class="s1">, </span><span class="s0">val2):</span>
        <span class="s0">op1 = np.timedelta64(val1)</span>
        <span class="s0">op2 = np.timedelta64(val2)</span>
        <span class="s0">actual = op1 // op2</span>
        <span class="s2"># Python reference integer floor</span>
        <span class="s0">expected = val1 // val2</span>
        <span class="s0">assert_equal(actual</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;val1, val2&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># years and months sometimes can't be unambiguously</span>
        <span class="s2"># divided for floor division operation</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_floor_div_error(self</span><span class="s1">, </span><span class="s0">val1</span><span class="s1">, </span><span class="s0">val2):</span>
        <span class="s1">with </span><span class="s0">assert_raises_regex(TypeError</span><span class="s1">, </span><span class="s3">&quot;common metadata divisor&quot;</span><span class="s0">):</span>
            <span class="s0">val1 // val2</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;op1, op2&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># reuse the test cases from floordiv</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">4</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># m8 same units round down with negative</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(-</span><span class="s4">4</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># m8 same units negative no round down</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">8</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(-</span><span class="s4">4</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># m8 different units</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">31</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># m8 generic units</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">1890</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">31</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># Y // M works</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">2</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s3">'13'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># handle 1D arrays</span>
        <span class="s0">(np.array([</span><span class="s4">1</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s4">3</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.array([</span><span class="s4">2</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_divmod(self</span><span class="s1">, </span><span class="s0">op1</span><span class="s1">, </span><span class="s0">op2):</span>
        <span class="s0">expected = (op1 // op2</span><span class="s1">, </span><span class="s0">op1 % op2)</span>
        <span class="s0">assert_equal(divmod(op1</span><span class="s1">, </span><span class="s0">op2)</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s0">@pytest.mark.skipif(IS_WASM</span><span class="s1">, </span><span class="s0">reason=</span><span class="s3">&quot;does not work in wasm&quot;</span><span class="s0">)</span>
    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;op1, op2&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># reuse cases from floordiv</span>
        <span class="s2"># div by 0</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">10</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># div with NaT</span>
        <span class="s0">(np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">50</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># special case for int64 min</span>
        <span class="s2"># in integer floor division</span>
        <span class="s0">(np.timedelta64(np.iinfo(np.int64).min)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(-</span><span class="s4">1</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_divmod_warnings(self</span><span class="s1">, </span><span class="s0">op1</span><span class="s1">, </span><span class="s0">op2):</span>
        <span class="s1">with </span><span class="s0">assert_warns(RuntimeWarning):</span>
            <span class="s0">expected = (op1 // op2</span><span class="s1">, </span><span class="s0">op1 % op2)</span>
        <span class="s1">with </span><span class="s0">assert_warns(RuntimeWarning):</span>
            <span class="s0">actual = divmod(op1</span><span class="s1">, </span><span class="s0">op2)</span>
        <span class="s0">assert_equal(actual</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s1">def </span><span class="s0">test_datetime_divide(self):</span>
        <span class="s1">for </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">tdb</span><span class="s1">, </span><span class="s0">tdc</span><span class="s1">, </span><span class="s0">tdd </span><span class="s1">in </span><span class="s0">\</span>
                    <span class="s0">[</span>
                     <span class="s2"># One-dimensional arrays</span>
                     <span class="s0">(np.array([</span><span class="s3">'2012-12-21'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">6</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">9</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">12</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.array([</span><span class="s4">6</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[m]'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s2"># NumPy scalars</span>
                     <span class="s0">(np.datetime64(</span><span class="s3">'2012-12-21'</span><span class="s1">, </span><span class="s3">'[D]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">6</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">9</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">12</span><span class="s1">, </span><span class="s3">'[h]'</span><span class="s0">)</span><span class="s1">,</span>
                      <span class="s0">np.timedelta64(</span><span class="s4">6</span><span class="s1">, </span><span class="s3">'[m]'</span><span class="s0">))]:</span>
            <span class="s2"># m8 / int</span>
            <span class="s0">assert_equal(tdc / </span><span class="s4">2</span><span class="s1">, </span><span class="s0">tda)</span>
            <span class="s0">assert_equal((tdc / </span><span class="s4">2</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># m8 / float</span>
            <span class="s0">assert_equal(tda / </span><span class="s4">0.5</span><span class="s1">, </span><span class="s0">tdc)</span>
            <span class="s0">assert_equal((tda / </span><span class="s4">0.5</span><span class="s0">).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[h]'</span><span class="s0">))</span>
            <span class="s2"># m8 / m8</span>
            <span class="s0">assert_equal(tda / tdb</span><span class="s1">, </span><span class="s4">6 </span><span class="s0">/ </span><span class="s4">9</span><span class="s0">)</span>
            <span class="s0">assert_equal(np.divide(tda</span><span class="s1">, </span><span class="s0">tdb)</span><span class="s1">, </span><span class="s4">6 </span><span class="s0">/ </span><span class="s4">9</span><span class="s0">)</span>
            <span class="s0">assert_equal(np.true_divide(tda</span><span class="s1">, </span><span class="s0">tdb)</span><span class="s1">, </span><span class="s4">6 </span><span class="s0">/ </span><span class="s4">9</span><span class="s0">)</span>
            <span class="s0">assert_equal(tdb / tda</span><span class="s1">, </span><span class="s4">9 </span><span class="s0">/ </span><span class="s4">6</span><span class="s0">)</span>
            <span class="s0">assert_equal((tda / tdb).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'f8'</span><span class="s0">))</span>
            <span class="s0">assert_equal(tda / tdd</span><span class="s1">, </span><span class="s4">60</span><span class="s0">)</span>
            <span class="s0">assert_equal(tdd / tda</span><span class="s1">, </span><span class="s4">1 </span><span class="s0">/ </span><span class="s4">60</span><span class="s0">)</span>

            <span class="s2"># int / m8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.divide</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s0">tdb)</span>
            <span class="s2"># float / m8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.divide</span><span class="s1">, </span><span class="s4">0.5</span><span class="s1">, </span><span class="s0">tdb)</span>
            <span class="s2"># m8 / M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.divide</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s0">tda)</span>
            <span class="s2"># M8 / m8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.divide</span><span class="s1">, </span><span class="s0">tda</span><span class="s1">, </span><span class="s0">dta)</span>
            <span class="s2"># M8 / int</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.divide</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s4">2</span><span class="s0">)</span>
            <span class="s2"># int / M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.divide</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s0">dta)</span>
            <span class="s2"># M8 / float</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.divide</span><span class="s1">, </span><span class="s0">dta</span><span class="s1">, </span><span class="s4">1.5</span><span class="s0">)</span>
            <span class="s2"># float / M8</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.divide</span><span class="s1">, </span><span class="s4">1.5</span><span class="s1">, </span><span class="s0">dta)</span>

        <span class="s2"># NaTs</span>
        <span class="s1">with </span><span class="s0">suppress_warnings() </span><span class="s1">as </span><span class="s0">sup:</span>
            <span class="s0">sup.filter(RuntimeWarning</span><span class="s1">,  </span><span class="s3">r&quot;.*encountered in divide&quot;</span><span class="s0">)</span>
            <span class="s0">nat = np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">)</span>
            <span class="s1">for </span><span class="s0">tp </span><span class="s1">in </span><span class="s0">(int</span><span class="s1">, </span><span class="s0">float):</span>
                <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">1</span><span class="s0">) / tp(</span><span class="s4">0</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
                <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">0</span><span class="s0">) / tp(</span><span class="s4">0</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
                <span class="s0">assert_equal(nat / tp(</span><span class="s4">0</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
                <span class="s0">assert_equal(nat / tp(</span><span class="s4">2</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
            <span class="s2"># Division by inf</span>
            <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">1</span><span class="s0">) / float(</span><span class="s3">'inf'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s0">))</span>
            <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">0</span><span class="s0">) / float(</span><span class="s3">'inf'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s0">))</span>
            <span class="s0">assert_equal(nat / float(</span><span class="s3">'inf'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
            <span class="s2"># Division by nan</span>
            <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">1</span><span class="s0">) / float(</span><span class="s3">'nan'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
            <span class="s0">assert_equal(np.timedelta64(</span><span class="s4">0</span><span class="s0">) / float(</span><span class="s3">'nan'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>
            <span class="s0">assert_equal(nat / float(</span><span class="s3">'nan'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">nat)</span>

    <span class="s1">def </span><span class="s0">test_datetime_compare(self):</span>
        <span class="s2"># Test all the comparison operators</span>
        <span class="s0">a = np.datetime64(</span><span class="s3">'2000-03-12T18:00:00.000000'</span><span class="s0">)</span>
        <span class="s0">b = np.array([</span><span class="s3">'2000-03-12T18:00:00.000000'</span><span class="s1">,</span>
                      <span class="s3">'2000-03-12T17:59:59.999999'</span><span class="s1">,</span>
                      <span class="s3">'2000-03-12T18:00:00.000001'</span><span class="s1">,</span>
                      <span class="s3">'1970-01-11T12:00:00.909090'</span><span class="s1">,</span>
                      <span class="s3">'2016-01-11T12:00:00.909090'</span><span class="s0">]</span><span class="s1">,</span>
                      <span class="s0">dtype=</span><span class="s3">'datetime64[us]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.equal(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">[</span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s0">])</span>
        <span class="s0">assert_equal(np.not_equal(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">[</span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">])</span>
        <span class="s0">assert_equal(np.less(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">[</span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s0">])</span>
        <span class="s0">assert_equal(np.less_equal(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">[</span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s0">])</span>
        <span class="s0">assert_equal(np.greater(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">[</span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s0">])</span>
        <span class="s0">assert_equal(np.greater_equal(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">[</span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s0">])</span>

    <span class="s1">def </span><span class="s0">test_datetime_compare_nat(self):</span>
        <span class="s0">dt_nat = np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span>
        <span class="s0">dt_other = np.datetime64(</span><span class="s3">'2000-01-01'</span><span class="s0">)</span>
        <span class="s0">td_nat = np.timedelta64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">)</span>
        <span class="s0">td_other = np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">)</span>

        <span class="s1">for </span><span class="s0">op </span><span class="s1">in </span><span class="s0">[np.equal</span><span class="s1">, </span><span class="s0">np.less</span><span class="s1">, </span><span class="s0">np.less_equal</span><span class="s1">,</span>
                   <span class="s0">np.greater</span><span class="s1">, </span><span class="s0">np.greater_equal]:</span>
            <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">op(dt_nat</span><span class="s1">, </span><span class="s0">dt_nat))</span>
            <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">op(dt_nat</span><span class="s1">, </span><span class="s0">dt_other))</span>
            <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">op(dt_other</span><span class="s1">, </span><span class="s0">dt_nat))</span>

            <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">op(td_nat</span><span class="s1">, </span><span class="s0">td_nat))</span>
            <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">op(td_nat</span><span class="s1">, </span><span class="s0">td_other))</span>
            <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">op(td_other</span><span class="s1">, </span><span class="s0">td_nat))</span>

        <span class="s0">assert_(np.not_equal(dt_nat</span><span class="s1">, </span><span class="s0">dt_nat))</span>
        <span class="s0">assert_(np.not_equal(dt_nat</span><span class="s1">, </span><span class="s0">dt_other))</span>
        <span class="s0">assert_(np.not_equal(dt_other</span><span class="s1">, </span><span class="s0">dt_nat))</span>

        <span class="s0">assert_(np.not_equal(td_nat</span><span class="s1">, </span><span class="s0">td_nat))</span>
        <span class="s0">assert_(np.not_equal(td_nat</span><span class="s1">, </span><span class="s0">td_other))</span>
        <span class="s0">assert_(np.not_equal(td_other</span><span class="s1">, </span><span class="s0">td_nat))</span>

    <span class="s1">def </span><span class="s0">test_datetime_minmax(self):</span>
        <span class="s2"># The metadata of the result should become the GCD</span>
        <span class="s2"># of the operand metadata</span>
        <span class="s0">a = np.array(</span><span class="s3">'1999-03-12T13'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[2m]'</span><span class="s0">)</span>
        <span class="s0">b = np.array(</span><span class="s3">'1999-03-12T12'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[s]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.minimum(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">b)</span>
        <span class="s0">assert_equal(np.minimum(a</span><span class="s1">, </span><span class="s0">b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.fmin(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">b)</span>
        <span class="s0">assert_equal(np.fmin(a</span><span class="s1">, </span><span class="s0">b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.maximum(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.maximum(a</span><span class="s1">, </span><span class="s0">b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.fmax(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.fmax(a</span><span class="s1">, </span><span class="s0">b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span>
        <span class="s2"># Viewed as integers, the comparison is opposite because</span>
        <span class="s2"># of the units chosen</span>
        <span class="s0">assert_equal(np.minimum(a.view(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">b.view(</span><span class="s3">'i8'</span><span class="s0">))</span><span class="s1">, </span><span class="s0">a.view(</span><span class="s3">'i8'</span><span class="s0">))</span>

        <span class="s2"># Interaction with NaT</span>
        <span class="s0">a = np.array(</span><span class="s3">'1999-03-12T13'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[2m]'</span><span class="s0">)</span>
        <span class="s0">dtnat = np.array(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[h]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.minimum(a</span><span class="s1">, </span><span class="s0">dtnat)</span><span class="s1">, </span><span class="s0">dtnat)</span>
        <span class="s0">assert_equal(np.minimum(dtnat</span><span class="s1">, </span><span class="s0">a)</span><span class="s1">, </span><span class="s0">dtnat)</span>
        <span class="s0">assert_equal(np.maximum(a</span><span class="s1">, </span><span class="s0">dtnat)</span><span class="s1">, </span><span class="s0">dtnat)</span>
        <span class="s0">assert_equal(np.maximum(dtnat</span><span class="s1">, </span><span class="s0">a)</span><span class="s1">, </span><span class="s0">dtnat)</span>
        <span class="s0">assert_equal(np.fmin(dtnat</span><span class="s1">, </span><span class="s0">a)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.fmin(a</span><span class="s1">, </span><span class="s0">dtnat)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.fmax(dtnat</span><span class="s1">, </span><span class="s0">a)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.fmax(a</span><span class="s1">, </span><span class="s0">dtnat)</span><span class="s1">, </span><span class="s0">a)</span>

        <span class="s2"># Also do timedelta</span>
        <span class="s0">a = np.array(</span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span>
        <span class="s0">b = np.array(</span><span class="s4">3</span><span class="s0">*</span><span class="s4">3600 </span><span class="s0">- </span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[s]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.minimum(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">b)</span>
        <span class="s0">assert_equal(np.minimum(a</span><span class="s1">, </span><span class="s0">b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.fmin(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">b)</span>
        <span class="s0">assert_equal(np.fmin(a</span><span class="s1">, </span><span class="s0">b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.maximum(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.maximum(a</span><span class="s1">, </span><span class="s0">b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.fmax(a</span><span class="s1">, </span><span class="s0">b)</span><span class="s1">, </span><span class="s0">a)</span>
        <span class="s0">assert_equal(np.fmax(a</span><span class="s1">, </span><span class="s0">b).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">))</span>
        <span class="s2"># Viewed as integers, the comparison is opposite because</span>
        <span class="s2"># of the units chosen</span>
        <span class="s0">assert_equal(np.minimum(a.view(</span><span class="s3">'i8'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">b.view(</span><span class="s3">'i8'</span><span class="s0">))</span><span class="s1">, </span><span class="s0">a.view(</span><span class="s3">'i8'</span><span class="s0">))</span>

        <span class="s2"># should raise between datetime and timedelta</span>
        <span class="s2">#</span>
        <span class="s2"># TODO: Allowing unsafe casting by</span>
        <span class="s2">#       default in ufuncs strikes again... :(</span>
        <span class="s0">a = np.array(</span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[h]'</span><span class="s0">)</span>
        <span class="s0">b = np.array(</span><span class="s3">'1999-03-12T12'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[s]'</span><span class="s0">)</span>
        <span class="s2">#assert_raises(TypeError, np.minimum, a, b)</span>
        <span class="s2">#assert_raises(TypeError, np.maximum, a, b)</span>
        <span class="s2">#assert_raises(TypeError, np.fmin, a, b)</span>
        <span class="s2">#assert_raises(TypeError, np.fmax, a, b)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.minimum</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.maximum</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.fmin</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">)</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.fmax</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s0">b</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'same_kind'</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_hours(self):</span>
        <span class="s0">t = np.ones(</span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[s]'</span><span class="s0">)</span>
        <span class="s0">t[</span><span class="s4">0</span><span class="s0">] = </span><span class="s4">60</span><span class="s0">*</span><span class="s4">60</span><span class="s0">*</span><span class="s4">24 </span><span class="s0">+ </span><span class="s4">60</span><span class="s0">*</span><span class="s4">60</span><span class="s0">*</span><span class="s4">10</span>
        <span class="s0">assert_(t[</span><span class="s4">0</span><span class="s0">].item().hour == </span><span class="s4">10</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_year(self):</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[Y/4]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[3M]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[Y/13]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[4W]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[3Y/73]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[15D]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_month(self):</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[M/2]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[2W]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[M/15]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[2D]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[3M/40]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[54h]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_week(self):</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[W/7]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[D]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[3W/14]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[36h]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[5W/140]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[360m]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_day(self):</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[D/12]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[2h]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[D/120]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[12m]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[3D/960]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[270s]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_hour(self):</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[h/30]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[2m]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[3h/300]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[36s]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_minute(self):</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[m/30]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[2s]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[3m/300]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[600ms]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_second(self):</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[s/100]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[10ms]'</span><span class="s0">))</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'m8[3s/10000]'</span><span class="s0">) == np.dtype(</span><span class="s3">'m8[300us]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_fs(self):</span>
        <span class="s0">assert_(np.dtype(</span><span class="s3">'M8[fs/100]'</span><span class="s0">) == np.dtype(</span><span class="s3">'M8[10as]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, lambda</span><span class="s0">: np.dtype(</span><span class="s3">'M8[3fs/10000]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_divisor_conversion_as(self):</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, lambda</span><span class="s0">: np.dtype(</span><span class="s3">'M8[as/10]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_string_parser_variants(self):</span>
        <span class="s2"># Allow space instead of 'T' between date and time</span>
        <span class="s0">assert_equal(np.array([</span><span class="s3">'1980-02-29T01:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s0">np.array([</span><span class="s3">'1980-02-29 01:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">)))</span>
        <span class="s2"># Allow positive years</span>
        <span class="s0">assert_equal(np.array([</span><span class="s3">'+1980-02-29T01:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s0">np.array([</span><span class="s3">'+1980-02-29 01:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">)))</span>
        <span class="s2"># Allow negative years</span>
        <span class="s0">assert_equal(np.array([</span><span class="s3">'-1980-02-29T01:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s0">np.array([</span><span class="s3">'-1980-02-29 01:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">)))</span>
        <span class="s2"># UTC specifier</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.array([</span><span class="s3">'+1980-02-29T01:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.array([</span><span class="s3">'+1980-02-29 01:02:03Z'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">)))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.array([</span><span class="s3">'-1980-02-29T01:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.array([</span><span class="s3">'-1980-02-29 01:02:03Z'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">)))</span>
        <span class="s2"># Time zone offset</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.array([</span><span class="s3">'1980-02-29T02:02:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.array([</span><span class="s3">'1980-02-29 00:32:03-0130'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">)))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.array([</span><span class="s3">'1980-02-28T22:32:03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.array([</span><span class="s3">'1980-02-29 00:02:03+01:30'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">)))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_equal(</span>
                <span class="s0">np.array([</span><span class="s3">'1980-02-29T02:32:03.506'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">))</span><span class="s1">,</span>
                <span class="s0">np.array([</span><span class="s3">'1980-02-29 00:32:03.506-02'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[s]'</span><span class="s0">)))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_equal(np.datetime64(</span><span class="s3">'1977-03-02T12:30-0230'</span><span class="s0">)</span><span class="s1">,</span>
                         <span class="s0">np.datetime64(</span><span class="s3">'1977-03-02T15:00'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_string_parser_error_check(self):</span>
        <span class="s2"># Arbitrary bad string</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'badvalue'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Character after year must be '-'</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980X'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Cannot have trailing '-'</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Month must be in range [1,12]</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-00'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-13'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Month must have two digits</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-1'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-1-02'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># 'Mor' is not a valid month</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-Mor'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Cannot have trailing '-'</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-01-'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Day must be in range [1,len(month)]</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-01-0'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-01-00'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-01-32'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1979-02-29'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-30'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-03-32'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-04-31'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-05-32'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-06-31'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-07-32'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-08-32'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-09-31'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-10-32'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-11-31'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-12-32'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Cannot have trailing characters</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03%'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 q'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>

        <span class="s2"># Hours must be in range [0, 23]</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 25'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03T25'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 24:01'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03T24:01'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 -1'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># No trailing ':'</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Minutes must be in range [0, 59]</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:-1'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:60'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># No trailing ':'</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:60:'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Seconds must be in range [0, 59]</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:10:-1'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:01:60'</span><span class="s0">]</span><span class="s1">,</span>
                                                        <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s2"># Timezone offset must within a reasonable range</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:01:00+0661'</span><span class="s0">]</span><span class="s1">,</span>
                                                            <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:01:00+2500'</span><span class="s0">]</span><span class="s1">,</span>
                                                            <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:01:00-0070'</span><span class="s0">]</span><span class="s1">,</span>
                                                            <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:01:00-3000'</span><span class="s0">]</span><span class="s1">,</span>
                                                            <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.array</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'1980-02-03 01:01:00-25:00'</span><span class="s0">]</span><span class="s1">,</span>
                                                            <span class="s0">np.dtype(</span><span class="s3">'M8[us]'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_creation_overflow(self):</span>
        <span class="s0">date = </span><span class="s3">'1980-03-23 20:00:00'</span>
        <span class="s0">timesteps = np.array([date]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'datetime64[s]'</span><span class="s0">)[</span><span class="s4">0</span><span class="s0">].astype(np.int64)</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'ms'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s0">]:</span>
            <span class="s0">timesteps *= </span><span class="s4">1000</span>
            <span class="s0">x = np.array([date]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'datetime64[%s]' </span><span class="s0">% unit)</span>

            <span class="s0">assert_equal(timesteps</span><span class="s1">, </span><span class="s0">x[</span><span class="s4">0</span><span class="s0">].astype(np.int64)</span><span class="s1">,</span>
                         <span class="s0">err_msg=</span><span class="s3">'Datetime conversion error for unit %s' </span><span class="s0">% unit)</span>

        <span class="s0">assert_equal(x[</span><span class="s4">0</span><span class="s0">].astype(np.int64)</span><span class="s1">, </span><span class="s4">322689600000000000</span><span class="s0">)</span>

        <span class="s2"># gh-13062</span>
        <span class="s1">with </span><span class="s0">pytest.raises(OverflowError):</span>
            <span class="s0">np.datetime64(</span><span class="s4">2</span><span class="s0">**</span><span class="s4">64</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span>
        <span class="s1">with </span><span class="s0">pytest.raises(OverflowError):</span>
            <span class="s0">np.timedelta64(</span><span class="s4">2</span><span class="s0">**</span><span class="s4">64</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_as_string(self):</span>
        <span class="s2"># Check all the units with default string conversion</span>
        <span class="s0">date = </span><span class="s3">'1959-10-13'</span>
        <span class="s0">datetime = </span><span class="s3">'1959-10-13T12:34:56.789012345678901234'</span>

        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(date</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1959'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(date</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1959-10'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(date</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1959-10-13'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'h'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1959-10-13T12'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1959-10-13T12:34'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1959-10-13T12:34:56'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1959-10-13T12:34:56.789'</span><span class="s0">)</span>
        <span class="s1">for </span><span class="s0">us </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'us'</span><span class="s1">, </span><span class="s3">'Î¼s'</span><span class="s1">, </span><span class="s5">b'us'</span><span class="s0">]:  </span><span class="s2"># check non-ascii and bytes too</span>
            <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s0">us))</span><span class="s1">,</span>
                         <span class="s3">'1959-10-13T12:34:56.789012'</span><span class="s0">)</span>

        <span class="s0">datetime = </span><span class="s3">'1969-12-31T23:34:56.789012345678901234'</span>

        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1969-12-31T23:34:56.789012345'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'ps'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1969-12-31T23:34:56.789012345678'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'fs'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1969-12-31T23:34:56.789012345678901'</span><span class="s0">)</span>

        <span class="s0">datetime = </span><span class="s3">'1969-12-31T23:59:57.789012345678901234'</span>

        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'as'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s0">datetime)</span>
        <span class="s0">datetime = </span><span class="s3">'1970-01-01T00:34:56.789012345678901234'</span>

        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1970-01-01T00:34:56.789012345'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'ps'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1970-01-01T00:34:56.789012345678'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'fs'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'1970-01-01T00:34:56.789012345678901'</span><span class="s0">)</span>

        <span class="s0">datetime = </span><span class="s3">'1970-01-01T00:00:05.789012345678901234'</span>

        <span class="s0">assert_equal(np.datetime_as_string(np.datetime64(datetime</span><span class="s1">, </span><span class="s3">'as'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s0">datetime)</span>

        <span class="s2"># String conversion with the unit= parameter</span>
        <span class="s0">a = np.datetime64(</span><span class="s3">'2032-07-18T12:23:34.123456'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'Y'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'M'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'W'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'D'</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'h'</span><span class="s0">)</span><span class="s1">, </span><span class="s3">'2032-07-18T12'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'m'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18T12:23'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18T12:23:34'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'ms'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18T12:23:34.123'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18T12:23:34.123456'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'ns'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18T12:23:34.123456000'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'ps'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18T12:23:34.123456000000'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'fs'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18T12:23:34.123456000000000'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'as'</span><span class="s0">)</span><span class="s1">,</span>
                            <span class="s3">'2032-07-18T12:23:34.123456000000000000'</span><span class="s0">)</span>

        <span class="s2"># unit='auto' parameter</span>
        <span class="s0">assert_equal(np.datetime_as_string(</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2032-07-18T12:23:34.123456'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'auto'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2032-07-18T12:23:34.123456'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2032-07-18T12:23:34.12'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'auto'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2032-07-18T12:23:34.120'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2032-07-18T12:23:34'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'auto'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2032-07-18T12:23:34'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2032-07-18T12:23:00'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'auto'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2032-07-18T12:23'</span><span class="s0">)</span>
        <span class="s2"># 'auto' doesn't split up hour and minute</span>
        <span class="s0">assert_equal(np.datetime_as_string(</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2032-07-18T12:00:00'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'auto'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2032-07-18T12:00'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2032-07-18T00:00:00'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'auto'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2032-07-18'</span><span class="s0">)</span>
        <span class="s2"># 'auto' doesn't split up the date</span>
        <span class="s0">assert_equal(np.datetime_as_string(</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2032-07-01T00:00:00'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'auto'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2032-07-01'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2032-01-01T00:00:00'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'auto'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2032-01-01'</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.skipif(</span><span class="s1">not </span><span class="s0">_has_pytz</span><span class="s1">, </span><span class="s0">reason=</span><span class="s3">&quot;The pytz module is not available.&quot;</span><span class="s0">)</span>
    <span class="s1">def </span><span class="s0">test_datetime_as_string_timezone(self):</span>
        <span class="s2"># timezone='local' vs 'UTC'</span>
        <span class="s0">a = np.datetime64(</span><span class="s3">'2010-03-15T06:30'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a)</span><span class="s1">,</span>
                <span class="s3">'2010-03-15T06:30'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">timezone=</span><span class="s3">'naive'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2010-03-15T06:30'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">timezone=</span><span class="s3">'UTC'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s3">'2010-03-15T06:30Z'</span><span class="s0">)</span>
        <span class="s0">assert_(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">timezone=</span><span class="s3">'local'</span><span class="s0">) !=</span>
                <span class="s3">'2010-03-15T06:30'</span><span class="s0">)</span>

        <span class="s0">b = np.datetime64(</span><span class="s3">'2010-02-15T06:30'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">)</span>

        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">timezone=tz(</span><span class="s3">'US/Central'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'2010-03-15T01:30-0500'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">timezone=tz(</span><span class="s3">'US/Eastern'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'2010-03-15T02:30-0400'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">timezone=tz(</span><span class="s3">'US/Pacific'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'2010-03-14T23:30-0700'</span><span class="s0">)</span>

        <span class="s0">assert_equal(np.datetime_as_string(b</span><span class="s1">, </span><span class="s0">timezone=tz(</span><span class="s3">'US/Central'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'2010-02-15T00:30-0600'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(b</span><span class="s1">, </span><span class="s0">timezone=tz(</span><span class="s3">'US/Eastern'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'2010-02-15T01:30-0500'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(b</span><span class="s1">, </span><span class="s0">timezone=tz(</span><span class="s3">'US/Pacific'</span><span class="s0">))</span><span class="s1">,</span>
                     <span class="s3">'2010-02-14T22:30-0800'</span><span class="s0">)</span>

        <span class="s2"># Dates to strings with a timezone attached is disabled by default</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.datetime_as_string</span><span class="s1">, </span><span class="s0">a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'D'</span><span class="s1">,</span>
                           <span class="s0">timezone=tz(</span><span class="s3">'US/Pacific'</span><span class="s0">))</span>
        <span class="s2"># Check that we can print out the date in the specified time zone</span>
        <span class="s0">assert_equal(np.datetime_as_string(a</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'D'</span><span class="s1">,</span>
                           <span class="s0">timezone=tz(</span><span class="s3">'US/Pacific'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s3">'2010-03-14'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.datetime_as_string(b</span><span class="s1">, </span><span class="s0">unit=</span><span class="s3">'D'</span><span class="s1">,</span>
                           <span class="s0">timezone=tz(</span><span class="s3">'US/Central'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">casting=</span><span class="s3">'unsafe'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s3">'2010-02-15'</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_arange(self):</span>
        <span class="s2"># With two datetimes provided as strings</span>
        <span class="s0">a = np.arange(</span><span class="s3">'2010-01-05'</span><span class="s1">, </span><span class="s3">'2010-01-10'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a</span><span class="s1">,</span>
            <span class="s0">np.array([</span><span class="s3">'2010-01-05'</span><span class="s1">, </span><span class="s3">'2010-01-06'</span><span class="s1">, </span><span class="s3">'2010-01-07'</span><span class="s1">,</span>
                      <span class="s3">'2010-01-08'</span><span class="s1">, </span><span class="s3">'2010-01-09'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">))</span>

        <span class="s0">a = np.arange(</span><span class="s3">'1950-02-10'</span><span class="s1">, </span><span class="s3">'1950-02-06'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a</span><span class="s1">,</span>
            <span class="s0">np.array([</span><span class="s3">'1950-02-10'</span><span class="s1">, </span><span class="s3">'1950-02-09'</span><span class="s1">, </span><span class="s3">'1950-02-08'</span><span class="s1">,</span>
                      <span class="s3">'1950-02-07'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">))</span>

        <span class="s2"># Unit should be detected as months here</span>
        <span class="s0">a = np.arange(</span><span class="s3">'1969-05'</span><span class="s1">, </span><span class="s3">'1970-05'</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[M]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'1969-05'</span><span class="s0">) + np.arange(</span><span class="s4">12</span><span class="s1">, </span><span class="s0">step=</span><span class="s4">2</span><span class="s0">))</span>

        <span class="s2"># datetime, integer|timedelta works as well</span>
        <span class="s2"># produces arange (start, start + stop) in this case</span>
        <span class="s0">a = np.arange(</span><span class="s3">'1969'</span><span class="s1">, </span><span class="s4">18</span><span class="s1">, </span><span class="s4">3</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[Y]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'1969'</span><span class="s0">) + np.arange(</span><span class="s4">18</span><span class="s1">, </span><span class="s0">step=</span><span class="s4">3</span><span class="s0">))</span>
        <span class="s0">a = np.arange(</span><span class="s3">'1969-12-19'</span><span class="s1">, </span><span class="s4">22</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">2</span><span class="s0">)</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'1969-12-19'</span><span class="s0">) + np.arange(</span><span class="s4">22</span><span class="s1">, </span><span class="s0">step=</span><span class="s4">2</span><span class="s0">))</span>

        <span class="s2"># Step of 0 is disallowed</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.arange</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'today'</span><span class="s0">)</span><span class="s1">,</span>
                                <span class="s0">np.datetime64(</span><span class="s3">'today'</span><span class="s0">) + </span><span class="s4">3</span><span class="s1">, </span><span class="s4">0</span><span class="s0">)</span>
        <span class="s2"># Promotion across nonlinear unit boundaries is disallowed</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.arange</span><span class="s1">, </span><span class="s0">np.datetime64(</span><span class="s3">'2011-03-01'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span><span class="s1">,</span>
                                <span class="s0">np.timedelta64(</span><span class="s4">5</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">))</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.arange</span><span class="s1">,</span>
                                <span class="s0">np.datetime64(</span><span class="s3">'2012-02-03T14'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
                                <span class="s0">np.timedelta64(</span><span class="s4">5</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_arange_no_dtype(self):</span>
        <span class="s0">d = np.array(</span><span class="s3">'2010-01-04'</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">&quot;M8[D]&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.arange(d</span><span class="s1">, </span><span class="s0">d + </span><span class="s4">1</span><span class="s0">)</span><span class="s1">, </span><span class="s0">d)</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.arange</span><span class="s1">, </span><span class="s0">d)</span>

    <span class="s1">def </span><span class="s0">test_timedelta_arange(self):</span>
        <span class="s0">a = np.arange(</span><span class="s4">3</span><span class="s1">, </span><span class="s4">10</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s0">) + np.arange(</span><span class="s4">3</span><span class="s1">, </span><span class="s4">10</span><span class="s0">))</span>

        <span class="s0">a = np.arange(np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">10</span><span class="s1">, </span><span class="s4">2</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(a</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">) + np.arange(</span><span class="s4">3</span><span class="s1">, </span><span class="s4">10</span><span class="s1">, </span><span class="s4">2</span><span class="s0">))</span>

        <span class="s2"># Step of 0 is disallowed</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.arange</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s0">)</span><span class="s1">,</span>
                                <span class="s0">np.timedelta64(</span><span class="s4">5</span><span class="s0">)</span><span class="s1">, </span><span class="s4">0</span><span class="s0">)</span>
        <span class="s2"># Promotion across nonlinear unit boundaries is disallowed</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.arange</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">)</span><span class="s1">,</span>
                                <span class="s0">np.timedelta64(</span><span class="s4">5</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">))</span>
        <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.arange</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span><span class="s1">,</span>
                                <span class="s0">np.timedelta64(</span><span class="s4">5</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">))</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;val1, val2, expected&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># case from gh-12092</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># negative value cases</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(-</span><span class="s4">2</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(-</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">(np.timedelta64(-</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">2</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># larger value cases</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">17</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">22</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">17</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">22</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">17</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">5</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># different units</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'m'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">57</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'us'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">727</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">273</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># NaT is propagated</span>
        <span class="s0">(np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">50</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s2"># Y % M works</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">2</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">22</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">2</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_modulus(self</span><span class="s1">, </span><span class="s0">val1</span><span class="s1">, </span><span class="s0">val2</span><span class="s1">, </span><span class="s0">expected):</span>
        <span class="s0">assert_equal(val1 % val2</span><span class="s1">, </span><span class="s0">expected)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;val1, val2&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># years and months sometimes can't be unambiguously</span>
        <span class="s2"># divided for modulus operation</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">3</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'M'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_modulus_error(self</span><span class="s1">, </span><span class="s0">val1</span><span class="s1">, </span><span class="s0">val2):</span>
        <span class="s1">with </span><span class="s0">assert_raises_regex(TypeError</span><span class="s1">, </span><span class="s3">&quot;common metadata divisor&quot;</span><span class="s0">):</span>
            <span class="s0">val1 % val2</span>

    <span class="s0">@pytest.mark.skipif(IS_WASM</span><span class="s1">, </span><span class="s0">reason=</span><span class="s3">&quot;fp errors don't work in wasm&quot;</span><span class="s0">)</span>
    <span class="s1">def </span><span class="s0">test_timedelta_modulus_div_by_zero(self):</span>
        <span class="s1">with </span><span class="s0">assert_warns(RuntimeWarning):</span>
            <span class="s0">actual = np.timedelta64(</span><span class="s4">10</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">) % np.timedelta64(</span><span class="s4">0</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">)</span>
            <span class="s0">assert_equal(actual</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s3">'NaT'</span><span class="s0">))</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;val1, val2&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s2"># cases where one operand is not</span>
        <span class="s2"># timedelta64</span>
        <span class="s0">(np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'Y'</span><span class="s0">)</span><span class="s1">,</span>
         <span class="s4">15</span><span class="s1">,</span><span class="s0">)</span><span class="s1">,</span>
        <span class="s0">(</span><span class="s4">7.5</span><span class="s1">,</span>
         <span class="s0">np.timedelta64(</span><span class="s4">1</span><span class="s1">, </span><span class="s3">'D'</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_timedelta_modulus_type_resolution(self</span><span class="s1">, </span><span class="s0">val1</span><span class="s1">, </span><span class="s0">val2):</span>
        <span class="s2"># NOTE: some of the operations may be supported</span>
        <span class="s2"># in the future</span>
        <span class="s1">with </span><span class="s0">assert_raises_regex(TypeError</span><span class="s1">,</span>
                                 <span class="s3">&quot;'remainder' cannot use operands with types&quot;</span><span class="s0">):</span>
            <span class="s0">val1 % val2</span>

    <span class="s1">def </span><span class="s0">test_timedelta_arange_no_dtype(self):</span>
        <span class="s0">d = np.array(</span><span class="s4">5</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">&quot;m8[D]&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.arange(d</span><span class="s1">, </span><span class="s0">d + </span><span class="s4">1</span><span class="s0">)</span><span class="s1">, </span><span class="s0">d)</span>
        <span class="s0">assert_equal(np.arange(d)</span><span class="s1">, </span><span class="s0">np.arange(</span><span class="s4">0</span><span class="s1">, </span><span class="s0">d))</span>

    <span class="s1">def </span><span class="s0">test_datetime_maximum_reduce(self):</span>
        <span class="s0">a = np.array([</span><span class="s3">'2010-01-02'</span><span class="s1">, </span><span class="s3">'1999-03-14'</span><span class="s1">, </span><span class="s3">'1833-03'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8[D]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.maximum.reduce(a).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'M8[D]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.maximum.reduce(a)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2010-01-02'</span><span class="s0">))</span>

        <span class="s0">a = np.array([</span><span class="s4">1</span><span class="s1">, </span><span class="s4">4</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">7</span><span class="s1">, </span><span class="s4">2</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'m8[s]'</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.maximum.reduce(a).dtype</span><span class="s1">, </span><span class="s0">np.dtype(</span><span class="s3">'m8[s]'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.maximum.reduce(a)</span><span class="s1">,</span>
                     <span class="s0">np.timedelta64(</span><span class="s4">7</span><span class="s1">, </span><span class="s3">'s'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_timedelta_correct_mean(self):</span>
        <span class="s2"># test mainly because it worked only via a bug in that allowed:</span>
        <span class="s2"># `timedelta.sum(dtype=&quot;f8&quot;)` to ignore the dtype request.</span>
        <span class="s0">a = np.arange(</span><span class="s4">1000</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">&quot;m8[s]&quot;</span><span class="s0">)</span>
        <span class="s0">assert_array_equal(a.mean()</span><span class="s1">, </span><span class="s0">a.sum() / len(a))</span>

    <span class="s1">def </span><span class="s0">test_datetime_no_subtract_reducelike(self):</span>
        <span class="s2"># subtracting two datetime64 works, but we cannot reduce it, since</span>
        <span class="s2"># the result of that subtraction will have a different dtype.</span>
        <span class="s0">arr = np.array([</span><span class="s3">&quot;2021-12-02&quot;</span><span class="s1">, </span><span class="s3">&quot;2019-05-12&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">&quot;M8[ms]&quot;</span><span class="s0">)</span>
        <span class="s0">msg = </span><span class="s3">r&quot;the resolved dtypes are not compatible&quot;</span>

        <span class="s1">with </span><span class="s0">pytest.raises(TypeError</span><span class="s1">, </span><span class="s0">match=msg):</span>
            <span class="s0">np.subtract.reduce(arr)</span>

        <span class="s1">with </span><span class="s0">pytest.raises(TypeError</span><span class="s1">, </span><span class="s0">match=msg):</span>
            <span class="s0">np.subtract.accumulate(arr)</span>

        <span class="s1">with </span><span class="s0">pytest.raises(TypeError</span><span class="s1">, </span><span class="s0">match=msg):</span>
            <span class="s0">np.subtract.reduceat(arr</span><span class="s1">, </span><span class="s0">[</span><span class="s4">0</span><span class="s0">])</span>

    <span class="s1">def </span><span class="s0">test_datetime_busday_offset(self):</span>
        <span class="s2"># First Monday in June</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-06'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'forward'</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">'Mon'</span><span class="s0">)</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-06-06'</span><span class="s0">))</span>
        <span class="s2"># Last Monday in June</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-07'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'forward'</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">'Mon'</span><span class="s0">)</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-06-27'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-07'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'forward'</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">'Mon'</span><span class="s0">)</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-06-27'</span><span class="s0">))</span>

        <span class="s2"># Default M-F business days, different roll modes</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2010-08'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'backward'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2010-07-30'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2010-08'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'preceding'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2010-07-30'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2010-08'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'modifiedpreceding'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2010-08-02'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2010-08'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'modifiedfollowing'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2010-08-02'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2010-08'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'forward'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2010-08-02'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2010-08'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'following'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2010-08-02'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2010-10-30'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'following'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2010-11-01'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
                <span class="s0">np.busday_offset(</span><span class="s3">'2010-10-30'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'modifiedfollowing'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2010-10-29'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
                <span class="s0">np.busday_offset(</span><span class="s3">'2010-10-30'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'modifiedpreceding'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2010-10-29'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
                <span class="s0">np.busday_offset(</span><span class="s3">'2010-10-16'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'modifiedfollowing'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2010-10-18'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
                <span class="s0">np.busday_offset(</span><span class="s3">'2010-10-16'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'modifiedpreceding'</span><span class="s0">)</span><span class="s1">,</span>
                <span class="s0">np.datetime64(</span><span class="s3">'2010-10-15'</span><span class="s0">))</span>
        <span class="s2"># roll='raise' by default</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busday_offset</span><span class="s1">, </span><span class="s3">'2011-06-04'</span><span class="s1">, </span><span class="s4">0</span><span class="s0">)</span>

        <span class="s2"># Bigger offset values</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2006-02-01'</span><span class="s1">, </span><span class="s4">25</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2006-03-08'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2006-03-08'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">25</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2006-02-01'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2007-02-25'</span><span class="s1">, </span><span class="s4">11</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">'SatSun'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2007-04-07'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(</span><span class="s3">'2007-04-07'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">11</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">'SatSun'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'2007-02-25'</span><span class="s0">))</span>

        <span class="s2"># NaT values when roll is not raise</span>
        <span class="s0">assert_equal(np.busday_offset(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'nat'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'following'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">))</span>
        <span class="s0">assert_equal(np.busday_offset(np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s0">roll=</span><span class="s3">'preceding'</span><span class="s0">)</span><span class="s1">,</span>
                     <span class="s0">np.datetime64(</span><span class="s3">'NaT'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_busdaycalendar(self):</span>
        <span class="s2"># Check that it removes NaT, duplicates, and weekends</span>
        <span class="s2"># and sorts the result.</span>
        <span class="s0">bdd = np.busdaycalendar(</span>
            <span class="s0">holidays=[</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'2011-01-17'</span><span class="s1">, </span><span class="s3">'2011-03-06'</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s1">,</span>
                       <span class="s3">'2011-12-26'</span><span class="s1">, </span><span class="s3">'2011-05-30'</span><span class="s1">, </span><span class="s3">'2011-01-17'</span><span class="s0">])</span>
        <span class="s0">assert_equal(bdd.holidays</span><span class="s1">,</span>
            <span class="s0">np.array([</span><span class="s3">'2011-01-17'</span><span class="s1">, </span><span class="s3">'2011-05-30'</span><span class="s1">, </span><span class="s3">'2011-12-26'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'M8'</span><span class="s0">))</span>
        <span class="s2"># Default M-F weekmask</span>
        <span class="s0">assert_equal(bdd.weekmask</span><span class="s1">, </span><span class="s0">np.array([</span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'?'</span><span class="s0">))</span>

        <span class="s2"># Check string weekmask with varying whitespace.</span>
        <span class="s0">bdd = np.busdaycalendar(weekmask=</span><span class="s3">&quot;Sun TueWed  Thu</span><span class="s1">\t</span><span class="s3">Fri&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(bdd.weekmask</span><span class="s1">, </span><span class="s0">np.array([</span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'?'</span><span class="s0">))</span>

        <span class="s2"># Check length 7 0/1 string</span>
        <span class="s0">bdd = np.busdaycalendar(weekmask=</span><span class="s3">&quot;0011001&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(bdd.weekmask</span><span class="s1">, </span><span class="s0">np.array([</span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'?'</span><span class="s0">))</span>

        <span class="s2"># Check length 7 string weekmask.</span>
        <span class="s0">bdd = np.busdaycalendar(weekmask=</span><span class="s3">&quot;Mon Tue&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(bdd.weekmask</span><span class="s1">, </span><span class="s0">np.array([</span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'?'</span><span class="s0">))</span>

        <span class="s2"># All-zeros weekmask should raise</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busdaycalendar</span><span class="s1">, </span><span class="s0">weekmask=[</span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s1">, </span><span class="s4">0</span><span class="s0">])</span>
        <span class="s2"># weekday names must be correct case</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busdaycalendar</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">&quot;satsun&quot;</span><span class="s0">)</span>
        <span class="s2"># All-zeros weekmask should raise</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busdaycalendar</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">&quot;&quot;</span><span class="s0">)</span>
        <span class="s2"># Invalid weekday name codes should raise</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busdaycalendar</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">&quot;Mon Tue We&quot;</span><span class="s0">)</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busdaycalendar</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">&quot;Max&quot;</span><span class="s0">)</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busdaycalendar</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">&quot;Monday Tue&quot;</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_busday_holidays_offset(self):</span>
        <span class="s2"># With exactly one holiday</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-10'</span><span class="s1">, </span><span class="s4">1</span><span class="s1">, </span><span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-14'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-04'</span><span class="s1">, </span><span class="s4">5</span><span class="s1">, </span><span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-14'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-10'</span><span class="s1">, </span><span class="s4">5</span><span class="s1">, </span><span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-18'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-14'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-10'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-18'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">5</span><span class="s1">, </span><span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-10'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-14'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">5</span><span class="s1">, </span><span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-04'</span><span class="s0">))</span>
        <span class="s2"># With the holiday appearing twice</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-10'</span><span class="s1">, </span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-14'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-14'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-10'</span><span class="s0">))</span>
        <span class="s2"># With a NaT holiday</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-10'</span><span class="s1">, </span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'NaT'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-14'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-14'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-10'</span><span class="s0">))</span>
        <span class="s2"># With another holiday after</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-10'</span><span class="s1">, </span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-24'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-14'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-14'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-24'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-10'</span><span class="s0">))</span>
        <span class="s2"># With another holiday before</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-10'</span><span class="s1">, </span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-10-10'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-14'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-14'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-10-10'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-10'</span><span class="s0">))</span>
        <span class="s2"># With another holiday before and after</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-10'</span><span class="s1">, </span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-10-10'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-24'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-14'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-11-14'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2011-10-10'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-24'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-11-10'</span><span class="s0">))</span>

        <span class="s2"># A bigger forward jump across more than one week/holiday</span>
        <span class="s0">holidays = [</span><span class="s3">'2011-10-10'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-24'</span><span class="s1">,</span>
                  <span class="s3">'2011-12-25'</span><span class="s1">, </span><span class="s3">'2011-05-30'</span><span class="s1">, </span><span class="s3">'2011-02-21'</span><span class="s1">,</span>
                  <span class="s3">'2011-12-26'</span><span class="s1">, </span><span class="s3">'2012-01-02'</span><span class="s0">]</span>
        <span class="s0">bdd = np.busdaycalendar(weekmask=</span><span class="s3">'1111100'</span><span class="s1">, </span><span class="s0">holidays=holidays)</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">4</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">4</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">5</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">5 </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">27</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">27 </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">28</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">28 </span><span class="s0">+ </span><span class="s4">2</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">35</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">35 </span><span class="s0">+ </span><span class="s4">2</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">36</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">36 </span><span class="s0">+ </span><span class="s4">3</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">56</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">56 </span><span class="s0">+ </span><span class="s4">3</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">57</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">57 </span><span class="s0">+ </span><span class="s4">4</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">60</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">60 </span><span class="s0">+ </span><span class="s4">4</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">61</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">61 </span><span class="s0">+ </span><span class="s4">5</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">61</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-10-03'</span><span class="s1">, </span><span class="s4">61 </span><span class="s0">+ </span><span class="s4">5</span><span class="s0">))</span>
        <span class="s2"># A bigger backward jump across more than one week/holiday</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">1 </span><span class="s0">- </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">4</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">4 </span><span class="s0">- </span><span class="s4">1</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">5</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">5 </span><span class="s0">- </span><span class="s4">2</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">25</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">25 </span><span class="s0">- </span><span class="s4">2</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">26</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">26 </span><span class="s0">- </span><span class="s4">3</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">33</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">33 </span><span class="s0">- </span><span class="s4">3</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">34</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">34 </span><span class="s0">- </span><span class="s4">4</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">56</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">56 </span><span class="s0">- </span><span class="s4">4</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">57</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">57 </span><span class="s0">- </span><span class="s4">5</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">57</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span><span class="s1">,</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">57 </span><span class="s0">- </span><span class="s4">5</span><span class="s0">))</span>

        <span class="s2"># Can't supply both a weekmask/holidays and busdaycal</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busday_offset</span><span class="s1">, </span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">15</span><span class="s1">,</span>
                        <span class="s0">weekmask=</span><span class="s3">'1111100'</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busday_offset</span><span class="s1">, </span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s0">-</span><span class="s4">15</span><span class="s1">,</span>
                        <span class="s0">holidays=holidays</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span>

        <span class="s2"># Roll with the holidays</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-12-25'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">,</span>
                <span class="s0">roll=</span><span class="s3">'forward'</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-12-27'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-12-26'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">,</span>
                <span class="s0">roll=</span><span class="s3">'forward'</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-12-27'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2011-12-26'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">,</span>
                <span class="s0">roll=</span><span class="s3">'backward'</span><span class="s1">, </span><span class="s0">holidays=holidays)</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2011-12-23'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-02-27'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">,</span>
                <span class="s0">roll=</span><span class="s3">'modifiedfollowing'</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2012-02-27'</span><span class="s1">, </span><span class="s3">'2012-02-26'</span><span class="s1">, </span><span class="s3">'2012-02-28'</span><span class="s1">,</span>
                          <span class="s3">'2012-03-01'</span><span class="s1">, </span><span class="s3">'2012-02-29'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2012-02-24'</span><span class="s0">))</span>
        <span class="s0">assert_equal(</span>
            <span class="s0">np.busday_offset(</span><span class="s3">'2012-03-06'</span><span class="s1">, </span><span class="s4">0</span><span class="s1">,</span>
                <span class="s0">roll=</span><span class="s3">'modifiedpreceding'</span><span class="s1">,</span>
                <span class="s0">holidays=[</span><span class="s3">'2012-03-02'</span><span class="s1">, </span><span class="s3">'2012-03-03'</span><span class="s1">, </span><span class="s3">'2012-03-01'</span><span class="s1">,</span>
                          <span class="s3">'2012-03-05'</span><span class="s1">, </span><span class="s3">'2012-03-07'</span><span class="s1">, </span><span class="s3">'2012-03-06'</span><span class="s0">])</span><span class="s1">,</span>
            <span class="s0">np.datetime64(</span><span class="s3">'2012-03-08'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_busday_holidays_count(self):</span>
        <span class="s0">holidays = [</span><span class="s3">'2011-01-01'</span><span class="s1">, </span><span class="s3">'2011-10-10'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-24'</span><span class="s1">,</span>
                    <span class="s3">'2011-12-25'</span><span class="s1">, </span><span class="s3">'2011-05-30'</span><span class="s1">, </span><span class="s3">'2011-02-21'</span><span class="s1">, </span><span class="s3">'2011-01-17'</span><span class="s1">,</span>
                    <span class="s3">'2011-12-26'</span><span class="s1">, </span><span class="s3">'2012-01-02'</span><span class="s1">, </span><span class="s3">'2011-02-21'</span><span class="s1">, </span><span class="s3">'2011-05-30'</span><span class="s1">,</span>
                    <span class="s3">'2011-07-01'</span><span class="s1">, </span><span class="s3">'2011-07-04'</span><span class="s1">, </span><span class="s3">'2011-09-05'</span><span class="s1">, </span><span class="s3">'2011-10-10'</span><span class="s0">]</span>
        <span class="s0">bdd = np.busdaycalendar(weekmask=</span><span class="s3">'1111100'</span><span class="s1">, </span><span class="s0">holidays=holidays)</span>

        <span class="s2"># Validate against busday_offset broadcast against</span>
        <span class="s2"># a range of offsets</span>
        <span class="s0">dates = np.busday_offset(</span><span class="s3">'2011-01-01'</span><span class="s1">, </span><span class="s0">np.arange(</span><span class="s4">366</span><span class="s0">)</span><span class="s1">,</span>
                        <span class="s0">roll=</span><span class="s3">'forward'</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span>
        <span class="s0">assert_equal(np.busday_count(</span><span class="s3">'2011-01-01'</span><span class="s1">, </span><span class="s0">dates</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span><span class="s1">,</span>
                     <span class="s0">np.arange(</span><span class="s4">366</span><span class="s0">))</span>
        <span class="s2"># Returns negative value when reversed</span>
        <span class="s0">assert_equal(np.busday_count(dates</span><span class="s1">, </span><span class="s3">'2011-01-01'</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span><span class="s1">,</span>
                     <span class="s0">-np.arange(</span><span class="s4">366</span><span class="s0">))</span>

        <span class="s0">dates = np.busday_offset(</span><span class="s3">'2011-12-31'</span><span class="s1">, </span><span class="s0">-np.arange(</span><span class="s4">366</span><span class="s0">)</span><span class="s1">,</span>
                        <span class="s0">roll=</span><span class="s3">'forward'</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span>
        <span class="s0">assert_equal(np.busday_count(dates</span><span class="s1">, </span><span class="s3">'2011-12-31'</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span><span class="s1">,</span>
                     <span class="s0">np.arange(</span><span class="s4">366</span><span class="s0">))</span>
        <span class="s2"># Returns negative value when reversed</span>
        <span class="s0">assert_equal(np.busday_count(</span><span class="s3">'2011-12-31'</span><span class="s1">, </span><span class="s0">dates</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span><span class="s1">,</span>
                     <span class="s0">-np.arange(</span><span class="s4">366</span><span class="s0">))</span>

        <span class="s2"># Can't supply both a weekmask/holidays and busdaycal</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busday_offset</span><span class="s1">, </span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s3">'2012-02-03'</span><span class="s1">,</span>
                        <span class="s0">weekmask=</span><span class="s3">'1111100'</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">np.busday_offset</span><span class="s1">, </span><span class="s3">'2012-01-03'</span><span class="s1">, </span><span class="s3">'2012-02-03'</span><span class="s1">,</span>
                        <span class="s0">holidays=holidays</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span>

        <span class="s2"># Number of Mondays in March 2011</span>
        <span class="s0">assert_equal(np.busday_count(</span><span class="s3">'2011-03'</span><span class="s1">, </span><span class="s3">'2011-04'</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">'Mon'</span><span class="s0">)</span><span class="s1">, </span><span class="s4">4</span><span class="s0">)</span>
        <span class="s2"># Returns negative value when reversed</span>
        <span class="s0">assert_equal(np.busday_count(</span><span class="s3">'2011-04'</span><span class="s1">, </span><span class="s3">'2011-03'</span><span class="s1">, </span><span class="s0">weekmask=</span><span class="s3">'Mon'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">-</span><span class="s4">4</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_datetime_is_busday(self):</span>
        <span class="s0">holidays = [</span><span class="s3">'2011-01-01'</span><span class="s1">, </span><span class="s3">'2011-10-10'</span><span class="s1">, </span><span class="s3">'2011-11-11'</span><span class="s1">, </span><span class="s3">'2011-11-24'</span><span class="s1">,</span>
                    <span class="s3">'2011-12-25'</span><span class="s1">, </span><span class="s3">'2011-05-30'</span><span class="s1">, </span><span class="s3">'2011-02-21'</span><span class="s1">, </span><span class="s3">'2011-01-17'</span><span class="s1">,</span>
                    <span class="s3">'2011-12-26'</span><span class="s1">, </span><span class="s3">'2012-01-02'</span><span class="s1">, </span><span class="s3">'2011-02-21'</span><span class="s1">, </span><span class="s3">'2011-05-30'</span><span class="s1">,</span>
                    <span class="s3">'2011-07-01'</span><span class="s1">, </span><span class="s3">'2011-07-04'</span><span class="s1">, </span><span class="s3">'2011-09-05'</span><span class="s1">, </span><span class="s3">'2011-10-10'</span><span class="s1">,</span>
                    <span class="s3">'NaT'</span><span class="s0">]</span>
        <span class="s0">bdd = np.busdaycalendar(weekmask=</span><span class="s3">'1111100'</span><span class="s1">, </span><span class="s0">holidays=holidays)</span>

        <span class="s2"># Weekend/weekday tests</span>
        <span class="s0">assert_equal(np.is_busday(</span><span class="s3">'2011-01-01'</span><span class="s0">)</span><span class="s1">, False</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.is_busday(</span><span class="s3">'2011-01-02'</span><span class="s0">)</span><span class="s1">, False</span><span class="s0">)</span>
        <span class="s0">assert_equal(np.is_busday(</span><span class="s3">'2011-01-03'</span><span class="s0">)</span><span class="s1">, True</span><span class="s0">)</span>

        <span class="s2"># All the holidays are not business days</span>
        <span class="s0">assert_equal(np.is_busday(holidays</span><span class="s1">, </span><span class="s0">busdaycal=bdd)</span><span class="s1">,</span>
                     <span class="s0">np.zeros(len(holidays)</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'?'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_datetime_y2038(self):</span>
        <span class="s2"># Test parsing on either side of the Y2038 boundary</span>
        <span class="s0">a = np.datetime64(</span><span class="s3">'2038-01-19T03:14:07'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.view(np.int64)</span><span class="s1">, </span><span class="s4">2</span><span class="s0">**</span><span class="s4">31 </span><span class="s0">- </span><span class="s4">1</span><span class="s0">)</span>
        <span class="s0">a = np.datetime64(</span><span class="s3">'2038-01-19T03:14:08'</span><span class="s0">)</span>
        <span class="s0">assert_equal(a.view(np.int64)</span><span class="s1">, </span><span class="s4">2</span><span class="s0">**</span><span class="s4">31</span><span class="s0">)</span>

        <span class="s2"># Test parsing on either side of the Y2038 boundary with</span>
        <span class="s2"># a manually specified timezone offset</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">a = np.datetime64(</span><span class="s3">'2038-01-19T04:14:07+0100'</span><span class="s0">)</span>
            <span class="s0">assert_equal(a.view(np.int64)</span><span class="s1">, </span><span class="s4">2</span><span class="s0">**</span><span class="s4">31 </span><span class="s0">- </span><span class="s4">1</span><span class="s0">)</span>
        <span class="s1">with </span><span class="s0">assert_warns(DeprecationWarning):</span>
            <span class="s0">a = np.datetime64(</span><span class="s3">'2038-01-19T04:14:08+0100'</span><span class="s0">)</span>
            <span class="s0">assert_equal(a.view(np.int64)</span><span class="s1">, </span><span class="s4">2</span><span class="s0">**</span><span class="s4">31</span><span class="s0">)</span>

        <span class="s2"># Test parsing a date after Y2038</span>
        <span class="s0">a = np.datetime64(</span><span class="s3">'2038-01-20T13:21:14'</span><span class="s0">)</span>
        <span class="s0">assert_equal(str(a)</span><span class="s1">, </span><span class="s3">'2038-01-20T13:21:14'</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_isnat(self):</span>
        <span class="s0">assert_(np.isnat(np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s0">)))</span>
        <span class="s0">assert_(np.isnat(np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s0">)))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.isnat(np.datetime64(</span><span class="s3">'2038-01-19T03:14:07'</span><span class="s0">)))</span>

        <span class="s0">assert_(np.isnat(np.timedelta64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">&quot;ms&quot;</span><span class="s0">)))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.isnat(np.timedelta64(</span><span class="s4">34</span><span class="s1">, </span><span class="s3">&quot;ms&quot;</span><span class="s0">)))</span>

        <span class="s0">res = np.array([</span><span class="s1">False, False, True</span><span class="s0">])</span>
        <span class="s1">for </span><span class="s0">unit </span><span class="s1">in </span><span class="s0">[</span><span class="s3">'Y'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s1">, </span><span class="s3">'W'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s1">,</span>
                     <span class="s3">'h'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s1">, </span><span class="s3">'us'</span><span class="s1">,</span>
                     <span class="s3">'ns'</span><span class="s1">, </span><span class="s3">'ps'</span><span class="s1">, </span><span class="s3">'fs'</span><span class="s1">, </span><span class="s3">'as'</span><span class="s0">]:</span>
            <span class="s0">arr = np.array([</span><span class="s4">123</span><span class="s1">, </span><span class="s0">-</span><span class="s4">321</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'&lt;datetime64[%s]' </span><span class="s0">% unit)</span>
            <span class="s0">assert_equal(np.isnat(arr)</span><span class="s1">, </span><span class="s0">res)</span>
            <span class="s0">arr = np.array([</span><span class="s4">123</span><span class="s1">, </span><span class="s0">-</span><span class="s4">321</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'&gt;datetime64[%s]' </span><span class="s0">% unit)</span>
            <span class="s0">assert_equal(np.isnat(arr)</span><span class="s1">, </span><span class="s0">res)</span>
            <span class="s0">arr = np.array([</span><span class="s4">123</span><span class="s1">, </span><span class="s0">-</span><span class="s4">321</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'&lt;timedelta64[%s]' </span><span class="s0">% unit)</span>
            <span class="s0">assert_equal(np.isnat(arr)</span><span class="s1">, </span><span class="s0">res)</span>
            <span class="s0">arr = np.array([</span><span class="s4">123</span><span class="s1">, </span><span class="s0">-</span><span class="s4">321</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">'&gt;timedelta64[%s]' </span><span class="s0">% unit)</span>
            <span class="s0">assert_equal(np.isnat(arr)</span><span class="s1">, </span><span class="s0">res)</span>

    <span class="s1">def </span><span class="s0">test_isnat_error(self):</span>
        <span class="s2"># Test that only datetime dtype arrays are accepted</span>
        <span class="s1">for </span><span class="s0">t </span><span class="s1">in </span><span class="s0">np.typecodes[</span><span class="s3">&quot;All&quot;</span><span class="s0">]:</span>
            <span class="s1">if </span><span class="s0">t </span><span class="s1">in </span><span class="s0">np.typecodes[</span><span class="s3">&quot;Datetime&quot;</span><span class="s0">]:</span>
                <span class="s1">continue</span>
            <span class="s0">assert_raises(TypeError</span><span class="s1">, </span><span class="s0">np.isnat</span><span class="s1">, </span><span class="s0">np.zeros(</span><span class="s4">10</span><span class="s1">, </span><span class="s0">t))</span>

    <span class="s1">def </span><span class="s0">test_isfinite_scalar(self):</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.isfinite(np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s0">)))</span>
        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.isfinite(np.datetime64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s0">)))</span>
        <span class="s0">assert_(np.isfinite(np.datetime64(</span><span class="s3">'2038-01-19T03:14:07'</span><span class="s0">)))</span>

        <span class="s0">assert_(</span><span class="s1">not </span><span class="s0">np.isfinite(np.timedelta64(</span><span class="s3">'NaT'</span><span class="s1">, </span><span class="s3">&quot;ms&quot;</span><span class="s0">)))</span>
        <span class="s0">assert_(np.isfinite(np.timedelta64(</span><span class="s4">34</span><span class="s1">, </span><span class="s3">&quot;ms&quot;</span><span class="s0">)))</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">'unit'</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'Y'</span><span class="s1">, </span><span class="s3">'M'</span><span class="s1">, </span><span class="s3">'W'</span><span class="s1">, </span><span class="s3">'D'</span><span class="s1">, </span><span class="s3">'h'</span><span class="s1">, </span><span class="s3">'m'</span><span class="s1">, </span><span class="s3">'s'</span><span class="s1">, </span><span class="s3">'ms'</span><span class="s1">,</span>
                                      <span class="s3">'us'</span><span class="s1">, </span><span class="s3">'ns'</span><span class="s1">, </span><span class="s3">'ps'</span><span class="s1">, </span><span class="s3">'fs'</span><span class="s1">, </span><span class="s3">'as'</span><span class="s0">])</span>
    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">'dstr'</span><span class="s1">, </span><span class="s0">[</span><span class="s3">'&lt;datetime64[%s]'</span><span class="s1">, </span><span class="s3">'&gt;datetime64[%s]'</span><span class="s1">,</span>
                                      <span class="s3">'&lt;timedelta64[%s]'</span><span class="s1">, </span><span class="s3">'&gt;timedelta64[%s]'</span><span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_isfinite_isinf_isnan_units(self</span><span class="s1">, </span><span class="s0">unit</span><span class="s1">, </span><span class="s0">dstr):</span>
        <span class="s6">'''check isfinite, isinf, isnan for all units of &lt;M, &gt;M, &lt;m, &gt;m dtypes 
        '''</span>
        <span class="s0">arr_val = [</span><span class="s4">123</span><span class="s1">, </span><span class="s0">-</span><span class="s4">321</span><span class="s1">, </span><span class="s3">&quot;NaT&quot;</span><span class="s0">]</span>
        <span class="s0">arr = np.array(arr_val</span><span class="s1">,  </span><span class="s0">dtype= dstr % unit)</span>
        <span class="s0">pos = np.array([</span><span class="s1">True, True,  False</span><span class="s0">])</span>
        <span class="s0">neg = np.array([</span><span class="s1">False, False,  True</span><span class="s0">])</span>
        <span class="s0">false = np.array([</span><span class="s1">False, False,  False</span><span class="s0">])</span>
        <span class="s0">assert_equal(np.isfinite(arr)</span><span class="s1">, </span><span class="s0">pos)</span>
        <span class="s0">assert_equal(np.isinf(arr)</span><span class="s1">, </span><span class="s0">false)</span>
        <span class="s0">assert_equal(np.isnan(arr)</span><span class="s1">, </span><span class="s0">neg)</span>

    <span class="s1">def </span><span class="s0">test_assert_equal(self):</span>
        <span class="s0">assert_raises(AssertionError</span><span class="s1">, </span><span class="s0">assert_equal</span><span class="s1">,</span>
                <span class="s0">np.datetime64(</span><span class="s3">'nat'</span><span class="s0">)</span><span class="s1">, </span><span class="s0">np.timedelta64(</span><span class="s3">'nat'</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_corecursive_input(self):</span>
        <span class="s2"># construct a co-recursive list</span>
        <span class="s0">a</span><span class="s1">, </span><span class="s0">b = []</span><span class="s1">, </span><span class="s0">[]</span>
        <span class="s0">a.append(b)</span>
        <span class="s0">b.append(a)</span>
        <span class="s0">obj_arr = np.array([</span><span class="s1">None</span><span class="s0">])</span>
        <span class="s0">obj_arr[</span><span class="s4">0</span><span class="s0">] = a</span>

        <span class="s2"># At some point this caused a stack overflow (gh-11154). Now raises</span>
        <span class="s2"># ValueError since the nested list cannot be converted to a datetime.</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">obj_arr.astype</span><span class="s1">, </span><span class="s3">'M8'</span><span class="s0">)</span>
        <span class="s0">assert_raises(ValueError</span><span class="s1">, </span><span class="s0">obj_arr.astype</span><span class="s1">, </span><span class="s3">'m8'</span><span class="s0">)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;shape&quot;</span><span class="s1">, </span><span class="s0">[()</span><span class="s1">, </span><span class="s0">(</span><span class="s4">1</span><span class="s1">,</span><span class="s0">)])</span>
    <span class="s1">def </span><span class="s0">test_discovery_from_object_array(self</span><span class="s1">, </span><span class="s0">shape):</span>
        <span class="s0">arr = np.array(</span><span class="s3">&quot;2020-10-10&quot;</span><span class="s1">, </span><span class="s0">dtype=object).reshape(shape)</span>
        <span class="s0">res = np.array(</span><span class="s3">&quot;2020-10-10&quot;</span><span class="s1">, </span><span class="s0">dtype=</span><span class="s3">&quot;M8&quot;</span><span class="s0">).reshape(shape)</span>
        <span class="s1">assert </span><span class="s0">res.dtype == np.dtype(</span><span class="s3">&quot;M8[D]&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(arr.astype(</span><span class="s3">&quot;M8&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">res)</span>
        <span class="s0">arr[...] = np.bytes_(</span><span class="s3">&quot;2020-10-10&quot;</span><span class="s0">)  </span><span class="s2"># try a numpy string type</span>
        <span class="s0">assert_equal(arr.astype(</span><span class="s3">&quot;M8&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">res)</span>
        <span class="s0">arr = arr.astype(</span><span class="s3">&quot;S&quot;</span><span class="s0">)</span>
        <span class="s0">assert_equal(arr.astype(</span><span class="s3">&quot;S&quot;</span><span class="s0">).astype(</span><span class="s3">&quot;M8&quot;</span><span class="s0">)</span><span class="s1">, </span><span class="s0">res)</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;time_unit&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s3">&quot;Y&quot;</span><span class="s1">, </span><span class="s3">&quot;M&quot;</span><span class="s1">, </span><span class="s3">&quot;W&quot;</span><span class="s1">, </span><span class="s3">&quot;D&quot;</span><span class="s1">, </span><span class="s3">&quot;h&quot;</span><span class="s1">, </span><span class="s3">&quot;m&quot;</span><span class="s1">, </span><span class="s3">&quot;s&quot;</span><span class="s1">, </span><span class="s3">&quot;ms&quot;</span><span class="s1">, </span><span class="s3">&quot;us&quot;</span><span class="s1">, </span><span class="s3">&quot;ns&quot;</span><span class="s1">, </span><span class="s3">&quot;ps&quot;</span><span class="s1">, </span><span class="s3">&quot;fs&quot;</span><span class="s1">, </span><span class="s3">&quot;as&quot;</span><span class="s1">,</span>
        <span class="s2"># compound units</span>
        <span class="s3">&quot;10D&quot;</span><span class="s1">, </span><span class="s3">&quot;2M&quot;</span><span class="s1">,</span>
    <span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_limit_symmetry(self</span><span class="s1">, </span><span class="s0">time_unit):</span>
        <span class="s6">&quot;&quot;&quot; 
        Dates should have symmetric limits around the unix epoch at +/-np.int64 
        &quot;&quot;&quot;</span>
        <span class="s0">epoch = np.datetime64(</span><span class="s4">0</span><span class="s1">, </span><span class="s0">time_unit)</span>
        <span class="s0">latest = np.datetime64(np.iinfo(np.int64).max</span><span class="s1">, </span><span class="s0">time_unit)</span>
        <span class="s0">earliest = np.datetime64(-np.iinfo(np.int64).max</span><span class="s1">, </span><span class="s0">time_unit)</span>

        <span class="s2"># above should not have overflowed</span>
        <span class="s1">assert </span><span class="s0">earliest &lt; epoch &lt; latest</span>

    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;time_unit&quot;</span><span class="s1">, </span><span class="s0">[</span>
        <span class="s3">&quot;Y&quot;</span><span class="s1">, </span><span class="s3">&quot;M&quot;</span><span class="s1">,</span>
        <span class="s0">pytest.param(</span><span class="s3">&quot;W&quot;</span><span class="s1">, </span><span class="s0">marks=pytest.mark.xfail(reason=</span><span class="s3">&quot;gh-13197&quot;</span><span class="s0">))</span><span class="s1">,</span>
        <span class="s3">&quot;D&quot;</span><span class="s1">, </span><span class="s3">&quot;h&quot;</span><span class="s1">, </span><span class="s3">&quot;m&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;s&quot;</span><span class="s1">, </span><span class="s3">&quot;ms&quot;</span><span class="s1">, </span><span class="s3">&quot;us&quot;</span><span class="s1">, </span><span class="s3">&quot;ns&quot;</span><span class="s1">, </span><span class="s3">&quot;ps&quot;</span><span class="s1">, </span><span class="s3">&quot;fs&quot;</span><span class="s1">, </span><span class="s3">&quot;as&quot;</span><span class="s1">,</span>
        <span class="s0">pytest.param(</span><span class="s3">&quot;10D&quot;</span><span class="s1">, </span><span class="s0">marks=pytest.mark.xfail(reason=</span><span class="s3">&quot;similar to gh-13197&quot;</span><span class="s0">))</span><span class="s1">,</span>
    <span class="s0">])</span>
    <span class="s0">@pytest.mark.parametrize(</span><span class="s3">&quot;sign&quot;</span><span class="s1">, </span><span class="s0">[-</span><span class="s4">1</span><span class="s1">, </span><span class="s4">1</span><span class="s0">])</span>
    <span class="s1">def </span><span class="s0">test_limit_str_roundtrip(self</span><span class="s1">, </span><span class="s0">time_unit</span><span class="s1">, </span><span class="s0">sign):</span>
        <span class="s6">&quot;&quot;&quot; 
        Limits should roundtrip when converted to strings. 
 
        This tests the conversion to and from npy_datetimestruct. 
        &quot;&quot;&quot;</span>
        <span class="s2"># TODO: add absolute (gold standard) time span limit strings</span>
        <span class="s0">limit = np.datetime64(np.iinfo(np.int64).max * sign</span><span class="s1">, </span><span class="s0">time_unit)</span>

        <span class="s2"># Convert to string and back. Explicit unit needed since the day and</span>
        <span class="s2"># week reprs are not distinguishable.</span>
        <span class="s0">limit_via_str = np.datetime64(str(limit)</span><span class="s1">, </span><span class="s0">time_unit)</span>
        <span class="s1">assert </span><span class="s0">limit_via_str == limit</span>


<span class="s1">class </span><span class="s0">TestDateTimeData:</span>

    <span class="s1">def </span><span class="s0">test_basic(self):</span>
        <span class="s0">a = np.array([</span><span class="s3">'1980-03-23'</span><span class="s0">]</span><span class="s1">, </span><span class="s0">dtype=np.datetime64)</span>
        <span class="s0">assert_equal(np.datetime_data(a.dtype)</span><span class="s1">, </span><span class="s0">(</span><span class="s3">'D'</span><span class="s1">, </span><span class="s4">1</span><span class="s0">))</span>

    <span class="s1">def </span><span class="s0">test_bytes(self):</span>
        <span class="s2"># byte units are converted to unicode</span>
        <span class="s0">dt = np.datetime64(</span><span class="s3">'2000'</span><span class="s1">, </span><span class="s0">(</span><span class="s5">b'ms'</span><span class="s1">, </span><span class="s4">5</span><span class="s0">))</span>
        <span class="s1">assert </span><span class="s0">np.datetime_data(dt.dtype) == (</span><span class="s3">'ms'</span><span class="s1">, </span><span class="s4">5</span><span class="s0">)</span>

        <span class="s0">dt = np.datetime64(</span><span class="s3">'2000'</span><span class="s1">, </span><span class="s5">b'5ms'</span><span class="s0">)</span>
        <span class="s1">assert </span><span class="s0">np.datetime_data(dt.dtype) == (</span><span class="s3">'ms'</span><span class="s1">, </span><span class="s4">5</span><span class="s0">)</span>

    <span class="s1">def </span><span class="s0">test_non_ascii(self):</span>
        <span class="s2"># Î¼s is normalized to Î¼</span>
        <span class="s0">dt = np.datetime64(</span><span class="s3">'2000'</span><span class="s1">, </span><span class="s0">(</span><span class="s3">'Î¼s'</span><span class="s1">, </span><span class="s4">5</span><span class="s0">))</span>
        <span class="s1">assert </span><span class="s0">np.datetime_data(dt.dtype) == (</span><span class="s3">'us'</span><span class="s1">, </span><span class="s4">5</span><span class="s0">)</span>

        <span class="s0">dt = np.datetime64(</span><span class="s3">'2000'</span><span class="s1">, </span><span class="s3">'5Î¼s'</span><span class="s0">)</span>
        <span class="s1">assert </span><span class="s0">np.datetime_data(dt.dtype) == (</span><span class="s3">'us'</span><span class="s1">, </span><span class="s4">5</span><span class="s0">)</span>
</pre>
</body>
</html>