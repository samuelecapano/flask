<html>
<head>
<title>test_simplification.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_simplification.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">base64</span>
<span class="s0">import </span><span class="s1">io</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">assert_array_almost_equal</span><span class="s0">, </span><span class="s1">assert_array_equal</span>

<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">check_figures_equal</span><span class="s0">, </span><span class="s1">image_comparison</span><span class="s0">, </span><span class="s1">remove_ticks_and_titles)</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>

<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">patches</span><span class="s0">, </span><span class="s1">transforms</span>
<span class="s0">from </span><span class="s1">matplotlib.path </span><span class="s0">import </span><span class="s1">Path</span>


<span class="s2"># NOTE: All of these tests assume that path.simplify is set to True</span>
<span class="s2"># (the default)</span>

<span class="s1">@image_comparison([</span><span class="s3">'clipping'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_clipping():</span>
    <span class="s1">t = np.arange(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">)</span>
    <span class="s1">s = np.sin(</span><span class="s4">2</span><span class="s1">*np.pi*t)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(t</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">1.0</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim((-</span><span class="s4">0.20</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.28</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'overflow'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_overflow():</span>
    <span class="s1">x = np.array([</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">2.0e5</span><span class="s1">])</span>
    <span class="s1">y = np.arange(len(x))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">ax.set_xlim(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'clipping_diamond'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_diamond():</span>
    <span class="s1">x = np.array([</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s1">])</span>
    <span class="s1">y = np.array([</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">ax.set_xlim(-</span><span class="s4">0.6</span><span class="s0">, </span><span class="s4">0.6</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s4">0.6</span><span class="s0">, </span><span class="s4">0.6</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_clipping_out_of_bounds():</span>
    <span class="s2"># Should work on a Path *without* codes.</span>
    <span class="s1">path = Path([(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)])</span>
    <span class="s1">simplified = path.cleaned(clip=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">20</span><span class="s1">))</span>
    <span class="s1">assert_array_equal(simplified.vertices</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)])</span>
    <span class="s0">assert </span><span class="s1">simplified.codes == [Path.STOP]</span>

    <span class="s2"># Should work on a Path *with* codes, and no curves.</span>
    <span class="s1">path = Path([(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO])</span>
    <span class="s1">simplified = path.cleaned(clip=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">20</span><span class="s1">))</span>
    <span class="s1">assert_array_equal(simplified.vertices</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)])</span>
    <span class="s0">assert </span><span class="s1">simplified.codes == [Path.STOP]</span>

    <span class="s2"># A Path with curves does not do any clipping yet.</span>
    <span class="s1">path = Path([(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span><span class="s0">,</span>
                <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3])</span>
    <span class="s1">simplified = path.cleaned()</span>
    <span class="s1">simplified_clipped = path.cleaned(clip=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">20</span><span class="s1">))</span>
    <span class="s1">assert_array_equal(simplified.vertices</span><span class="s0">, </span><span class="s1">simplified_clipped.vertices)</span>
    <span class="s1">assert_array_equal(simplified.codes</span><span class="s0">, </span><span class="s1">simplified_clipped.codes)</span>


<span class="s0">def </span><span class="s1">test_noise():</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">x = np.random.uniform(size=</span><span class="s4">50000</span><span class="s1">) * </span><span class="s4">50</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">p1 = ax.plot(x</span><span class="s0">, </span><span class="s1">solid_joinstyle=</span><span class="s3">'round'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">2.0</span><span class="s1">)</span>

    <span class="s2"># Ensure that the path's transform takes the new axes limits into account.</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">path = p1[</span><span class="s4">0</span><span class="s1">].get_path()</span>
    <span class="s1">transform = p1[</span><span class="s4">0</span><span class="s1">].get_transform()</span>
    <span class="s1">path = transform.transform_path(path)</span>
    <span class="s1">simplified = path.cleaned(simplify=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">simplified.vertices.size == </span><span class="s4">25512</span>


<span class="s0">def </span><span class="s1">test_antiparallel_simplification():</span>
    <span class="s0">def </span><span class="s1">_get_simplified(x</span><span class="s0">, </span><span class="s1">y):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">p1 = ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>

        <span class="s1">path = p1[</span><span class="s4">0</span><span class="s1">].get_path()</span>
        <span class="s1">transform = p1[</span><span class="s4">0</span><span class="s1">].get_transform()</span>
        <span class="s1">path = transform.transform_path(path)</span>
        <span class="s1">simplified = path.cleaned(simplify=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">simplified = transform.inverted().transform_path(simplified)</span>

        <span class="s0">return </span><span class="s1">simplified</span>

    <span class="s2"># test ending on a maximum</span>
    <span class="s1">x = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span>

    <span class="s1">simplified = _get_simplified(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">assert_array_almost_equal([[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">2.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]</span><span class="s0">,</span>
                              <span class="s1">simplified.vertices[:-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">:])</span>

    <span class="s2"># test ending on a minimum</span>
    <span class="s1">x = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">,  </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span>

    <span class="s1">simplified = _get_simplified(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">assert_array_almost_equal([[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">1.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]</span><span class="s0">,</span>
                              <span class="s1">simplified.vertices[:-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">:])</span>

    <span class="s2"># test ending in between</span>
    <span class="s1">x = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span>

    <span class="s1">simplified = _get_simplified(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">assert_array_almost_equal([[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">1.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">0.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]</span><span class="s0">,</span>
                              <span class="s1">simplified.vertices[:-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">:])</span>

    <span class="s2"># test no anti-parallel ending at max</span>
    <span class="s1">x = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span>

    <span class="s1">simplified = _get_simplified(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">assert_array_almost_equal([[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">3.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]</span><span class="s0">,</span>
                              <span class="s1">simplified.vertices[:-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">:])</span>

    <span class="s2"># test no anti-parallel ending in middle</span>
    <span class="s1">x = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span>

    <span class="s1">simplified = _get_simplified(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">assert_array_almost_equal([[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">2.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">1.</span><span class="s1">]</span><span class="s0">,</span>
                               <span class="s1">[</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]</span><span class="s0">,</span>
                              <span class="s1">simplified.vertices[:-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">:])</span>


<span class="s2"># Only consider angles in 0 &lt;= angle &lt;= pi/2, otherwise</span>
<span class="s2"># using min/max will get the expected results out of order:</span>
<span class="s2"># min/max for simplification code depends on original vector,</span>
<span class="s2"># and if angle is outside above range then simplification</span>
<span class="s2"># min/max will be opposite from actual min/max.</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'angle'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.pi/</span><span class="s4">4</span><span class="s0">, </span><span class="s1">np.pi/</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.pi/</span><span class="s4">2</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'offset'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_angled_antiparallel(angle</span><span class="s0">, </span><span class="s1">offset):</span>
    <span class="s1">scale = </span><span class="s4">5</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s2"># get 15 random offsets</span>
    <span class="s2"># TODO: guarantee offset &gt; 0 results in some offsets &lt; 0</span>
    <span class="s1">vert_offsets = (np.random.rand(</span><span class="s4">15</span><span class="s1">) - offset) * scale</span>
    <span class="s2"># always start at 0 so rotation makes sense</span>
    <span class="s1">vert_offsets[</span><span class="s4">0</span><span class="s1">] = </span><span class="s4">0</span>
    <span class="s2"># always take the first step the same direction</span>
    <span class="s1">vert_offsets[</span><span class="s4">1</span><span class="s1">] = </span><span class="s4">1</span>
    <span class="s2"># compute points along a diagonal line</span>
    <span class="s1">x = np.sin(angle) * vert_offsets</span>
    <span class="s1">y = np.cos(angle) * vert_offsets</span>

    <span class="s2"># will check these later</span>
    <span class="s1">x_max = x[</span><span class="s4">1</span><span class="s1">:].max()</span>
    <span class="s1">x_min = x[</span><span class="s4">1</span><span class="s1">:].min()</span>

    <span class="s1">y_max = y[</span><span class="s4">1</span><span class="s1">:].max()</span>
    <span class="s1">y_min = y[</span><span class="s4">1</span><span class="s1">:].min()</span>

    <span class="s0">if </span><span class="s1">offset &gt; </span><span class="s4">0</span><span class="s1">:</span>
        <span class="s1">p_expected = Path([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[x_max</span><span class="s0">, </span><span class="s1">y_max]</span><span class="s0">,</span>
                           <span class="s1">[x_min</span><span class="s0">, </span><span class="s1">y_min]</span><span class="s0">,</span>
                           <span class="s1">[x[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">,</span>
                          <span class="s1">codes=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>

    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">p_expected = Path([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">[x_max</span><span class="s0">, </span><span class="s1">y_max]</span><span class="s0">,</span>
                           <span class="s1">[x[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">,</span>
                           <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">,</span>
                          <span class="s1">codes=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>

    <span class="s1">p = Path(np.vstack([x</span><span class="s0">, </span><span class="s1">y]).T)</span>
    <span class="s1">p2 = p.cleaned(simplify=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">assert_array_almost_equal(p_expected.vertices</span><span class="s0">,</span>
                              <span class="s1">p2.vertices)</span>
    <span class="s1">assert_array_equal(p_expected.codes</span><span class="s0">, </span><span class="s1">p2.codes)</span>


<span class="s0">def </span><span class="s1">test_sine_plus_noise():</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">x = (np.sin(np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.pi * </span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">50000</span><span class="s1">)) +</span>
         <span class="s1">np.random.uniform(size=</span><span class="s4">50000</span><span class="s1">) * </span><span class="s4">0.01</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">p1 = ax.plot(x</span><span class="s0">, </span><span class="s1">solid_joinstyle=</span><span class="s3">'round'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">2.0</span><span class="s1">)</span>

    <span class="s2"># Ensure that the path's transform takes the new axes limits into account.</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">path = p1[</span><span class="s4">0</span><span class="s1">].get_path()</span>
    <span class="s1">transform = p1[</span><span class="s4">0</span><span class="s1">].get_transform()</span>
    <span class="s1">path = transform.transform_path(path)</span>
    <span class="s1">simplified = path.cleaned(simplify=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">simplified.vertices.size == </span><span class="s4">25240</span>


<span class="s1">@image_comparison([</span><span class="s3">'simplify_curve'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">tol=</span><span class="s4">0.017</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_simplify_curve():</span>
    <span class="s1">pp1 = patches.PathPatch(</span>
        <span class="s1">Path([(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(np.nan</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
              <span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)]</span><span class="s0">,</span>
             <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">,</span>
              <span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CLOSEPOLY])</span><span class="s0">,</span>
        <span class="s1">fc=</span><span class="s3">&quot;none&quot;</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.add_patch(pp1)</span>
    <span class="s1">ax.set_xlim((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span>
    <span class="s1">ax.set_ylim((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_closed_path_nan_removal(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax_test = fig_test.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).flatten()</span>
    <span class="s1">ax_ref = fig_ref.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).flatten()</span>

    <span class="s2"># NaN on the first point also removes the last point, because it's closed.</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CLOSEPOLY])</span>
    <span class="s1">ax_test[</span><span class="s4">0</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO])</span>
    <span class="s1">ax_ref[</span><span class="s4">0</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># NaN on second-last point should not re-close.</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CLOSEPOLY])</span>
    <span class="s1">ax_test[</span><span class="s4">0</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO])</span>
    <span class="s1">ax_ref[</span><span class="s4">0</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># Test multiple loops in a single path (with same paths as above).</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CLOSEPOLY</span><span class="s0">,</span>
         <span class="s1">Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CLOSEPOLY])</span>
    <span class="s1">ax_test[</span><span class="s4">1</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">,</span>
         <span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">,</span>
         <span class="s1">Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO])</span>
    <span class="s1">ax_ref[</span><span class="s4">1</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># NaN in first point of CURVE3 should not re-close, and hide entire curve.</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">,</span>
         <span class="s1">Path.CLOSEPOLY])</span>
    <span class="s1">ax_test[</span><span class="s4">2</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">,</span>
         <span class="s1">Path.CLOSEPOLY])</span>
    <span class="s1">ax_ref[</span><span class="s4">2</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># NaN in second point of CURVE3 should not re-close, and hide entire curve</span>
    <span class="s2"># plus next line segment.</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">,</span>
         <span class="s1">Path.LINETO])</span>
    <span class="s1">ax_test[</span><span class="s4">2</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.CURVE3</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">,</span>
         <span class="s1">Path.LINETO])</span>
    <span class="s1">ax_ref[</span><span class="s4">2</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># NaN in first point of CURVE4 should not re-close, and hide entire curve.</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">,</span>
         <span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CLOSEPOLY])</span>
    <span class="s1">ax_test[</span><span class="s4">3</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">,</span>
         <span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CLOSEPOLY])</span>
    <span class="s1">ax_ref[</span><span class="s4">3</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># NaN in second point of CURVE4 should not re-close, and hide entire curve.</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">,</span>
         <span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO])</span>
    <span class="s1">ax_test[</span><span class="s4">3</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">2</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">,</span>
         <span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO])</span>
    <span class="s1">ax_ref[</span><span class="s4">3</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># NaN in third point of CURVE4 should not re-close, and hide entire curve</span>
    <span class="s2"># plus next line segment.</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">,</span>
         <span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO])</span>
    <span class="s1">ax_test[</span><span class="s4">3</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>
    <span class="s1">path = Path(</span>
        <span class="s1">[[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">, </span><span class="s1">Path.CURVE4</span><span class="s0">,</span>
         <span class="s1">Path.LINETO</span><span class="s0">, </span><span class="s1">Path.LINETO])</span>
    <span class="s1">ax_ref[</span><span class="s4">3</span><span class="s1">].add_patch(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># Keep everything clean.</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">[*ax_test.flat</span><span class="s0">, </span><span class="s1">*ax_ref.flat]:</span>
        <span class="s1">ax.set(xlim=(-</span><span class="s4">3.5</span><span class="s0">, </span><span class="s4">3.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(-</span><span class="s4">3.5</span><span class="s0">, </span><span class="s4">3.5</span><span class="s1">))</span>
    <span class="s1">remove_ticks_and_titles(fig_test)</span>
    <span class="s1">remove_ticks_and_titles(fig_ref)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_closed_path_clipping(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">vertices = []</span>
    <span class="s0">for </span><span class="s1">roll </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">8</span><span class="s1">):</span>
        <span class="s1">offset = </span><span class="s4">0.1 </span><span class="s1">* roll + </span><span class="s4">0.1</span>

        <span class="s2"># A U-like pattern.</span>
        <span class="s1">pattern = [</span>
            <span class="s1">[-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">,  </span><span class="s2"># Outer square</span>
            <span class="s2"># With a notch in the top.</span>
            <span class="s1">[</span><span class="s4">1 </span><span class="s1">- offset / </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1 </span><span class="s1">- offset / </span><span class="s4">2</span><span class="s0">, </span><span class="s1">offset]</span><span class="s0">,</span>
            <span class="s1">[offset / </span><span class="s4">2</span><span class="s0">, </span><span class="s1">offset]</span><span class="s0">, </span><span class="s1">[offset / </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]</span>

        <span class="s2"># Place the initial/final point anywhere in/out of the clipping area.</span>
        <span class="s1">pattern = np.roll(pattern</span><span class="s0">, </span><span class="s1">roll</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">pattern = np.concatenate((pattern</span><span class="s0">, </span><span class="s1">pattern[:</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:]))</span>

        <span class="s1">vertices.append(pattern)</span>

    <span class="s2"># Multiple subpaths are used here to ensure they aren't broken by closed</span>
    <span class="s2"># loop clipping.</span>
    <span class="s1">codes = np.full(len(vertices[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">Path.LINETO)</span>
    <span class="s1">codes[</span><span class="s4">0</span><span class="s1">] = Path.MOVETO</span>
    <span class="s1">codes[-</span><span class="s4">1</span><span class="s1">] = Path.CLOSEPOLY</span>
    <span class="s1">codes = np.tile(codes</span><span class="s0">, </span><span class="s1">len(vertices))</span>
    <span class="s1">vertices = np.concatenate(vertices)</span>

    <span class="s1">fig_test.set_size_inches((</span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>
    <span class="s1">path = Path(vertices</span><span class="s0">, </span><span class="s1">codes)</span>
    <span class="s1">fig_test.add_artist(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>

    <span class="s2"># For reference, we draw the same thing, but unclosed by using a line to</span>
    <span class="s2"># the last point only.</span>
    <span class="s1">fig_ref.set_size_inches((</span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>
    <span class="s1">codes = codes.copy()</span>
    <span class="s1">codes[codes == Path.CLOSEPOLY] = Path.LINETO</span>
    <span class="s1">path = Path(vertices</span><span class="s0">, </span><span class="s1">codes)</span>
    <span class="s1">fig_ref.add_artist(patches.PathPatch(path</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'hatch_simplify'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hatch():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.add_patch(plt.Rectangle((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">False, </span><span class="s1">hatch=</span><span class="s3">&quot;/&quot;</span><span class="s1">))</span>
    <span class="s1">ax.set_xlim((</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.55</span><span class="s1">))</span>
    <span class="s1">ax.set_ylim((</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.55</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'fft_peaks'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fft_peaks():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">t = np.arange(</span><span class="s4">65536</span><span class="s1">)</span>
    <span class="s1">p1 = ax.plot(abs(np.fft.fft(np.sin(</span><span class="s4">2</span><span class="s1">*np.pi*</span><span class="s4">.01</span><span class="s1">*t)*np.blackman(len(t)))))</span>

    <span class="s2"># Ensure that the path's transform takes the new axes limits into account.</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">path = p1[</span><span class="s4">0</span><span class="s1">].get_path()</span>
    <span class="s1">transform = p1[</span><span class="s4">0</span><span class="s1">].get_transform()</span>
    <span class="s1">path = transform.transform_path(path)</span>
    <span class="s1">simplified = path.cleaned(simplify=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">simplified.vertices.size == </span><span class="s4">36</span>


<span class="s0">def </span><span class="s1">test_start_with_moveto():</span>
    <span class="s2"># Should be entirely clipped away to a single MOVETO</span>
    <span class="s1">data = </span><span class="s5">b&quot;&quot;&quot; 
ZwAAAAku+v9UAQAA+Tj6/z8CAADpQ/r/KAMAANlO+v8QBAAAyVn6//UEAAC6ZPr/2gUAAKpv+v+8 
BgAAm3r6/50HAACLhfr/ewgAAHyQ+v9ZCQAAbZv6/zQKAABepvr/DgsAAE+x+v/lCwAAQLz6/7wM 
AAAxx/r/kA0AACPS+v9jDgAAFN36/zQPAAAF6Pr/AxAAAPfy+v/QEAAA6f36/5wRAADbCPv/ZhIA 
AMwT+/8uEwAAvh77//UTAACwKfv/uRQAAKM0+/98FQAAlT/7/z0WAACHSvv//RYAAHlV+/+7FwAA 
bGD7/3cYAABea/v/MRkAAFF2+//pGQAARIH7/6AaAAA3jPv/VRsAACmX+/8JHAAAHKL7/7ocAAAP 
rfv/ah0AAAO4+/8YHgAA9sL7/8QeAADpzfv/bx8AANzY+/8YIAAA0OP7/78gAADD7vv/ZCEAALf5 
+/8IIgAAqwT8/6kiAACeD/z/SiMAAJIa/P/oIwAAhiX8/4QkAAB6MPz/HyUAAG47/P+4JQAAYkb8 
/1AmAABWUfz/5SYAAEpc/P95JwAAPmf8/wsoAAAzcvz/nCgAACd9/P8qKQAAHIj8/7cpAAAQk/z/ 
QyoAAAWe/P/MKgAA+aj8/1QrAADus/z/2isAAOO+/P9eLAAA2Mn8/+AsAADM1Pz/YS0AAMHf/P/g 
LQAAtur8/10uAACr9fz/2C4AAKEA/f9SLwAAlgv9/8ovAACLFv3/QDAAAIAh/f+1MAAAdSz9/ycx 
AABrN/3/mDEAAGBC/f8IMgAAVk39/3UyAABLWP3/4TIAAEFj/f9LMwAANm79/7MzAAAsef3/GjQA 
ACKE/f9+NAAAF4/9/+E0AAANmv3/QzUAAAOl/f+iNQAA+a/9/wA2AADvuv3/XDYAAOXF/f+2NgAA 
29D9/w83AADR2/3/ZjcAAMfm/f+7NwAAvfH9/w44AACz/P3/XzgAAKkH/v+vOAAAnxL+//04AACW 
Hf7/SjkAAIwo/v+UOQAAgjP+/905AAB5Pv7/JDoAAG9J/v9pOgAAZVT+/606AABcX/7/7zoAAFJq 
/v8vOwAASXX+/207AAA/gP7/qjsAADaL/v/lOwAALZb+/x48AAAjof7/VTwAABqs/v+LPAAAELf+ 
/788AAAHwv7/8TwAAP7M/v8hPQAA9df+/1A9AADr4v7/fT0AAOLt/v+oPQAA2fj+/9E9AADQA/// 
+T0AAMYO//8fPgAAvRn//0M+AAC0JP//ZT4AAKsv//+GPgAAojr//6U+AACZRf//wj4AAJBQ///d 
PgAAh1v///c+AAB+Zv//Dz8AAHRx//8lPwAAa3z//zk/AABih///TD8AAFmS//9dPwAAUJ3//2w/ 
AABHqP//ej8AAD6z//+FPwAANb7//48/AAAsyf//lz8AACPU//+ePwAAGt///6M/AAAR6v//pj8A 
AAj1//+nPwAA/////w==&quot;&quot;&quot;</span>

    <span class="s1">verts = np.frombuffer(base64.decodebytes(data)</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'&lt;i4'</span><span class="s1">)</span>
    <span class="s1">verts = verts.reshape((len(verts) // </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span>
    <span class="s1">path = Path(verts)</span>
    <span class="s1">segs = path.iter_segments(transforms.IdentityTransform()</span><span class="s0">,</span>
                              <span class="s1">clip=(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">100.0</span><span class="s0">, </span><span class="s4">100.0</span><span class="s1">))</span>
    <span class="s1">segs = list(segs)</span>
    <span class="s0">assert </span><span class="s1">len(segs) == </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">segs[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">] == Path.MOVETO</span>


<span class="s0">def </span><span class="s1">test_throw_rendering_complexity_exceeded():</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'path.simplify'</span><span class="s1">] = </span><span class="s0">False</span>
    <span class="s1">xx = np.arange(</span><span class="s4">2_000_000</span><span class="s1">)</span>
    <span class="s1">yy = np.random.rand(</span><span class="s4">2_000_000</span><span class="s1">)</span>
    <span class="s1">yy[</span><span class="s4">1000</span><span class="s1">] = np.nan</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(xx</span><span class="s0">, </span><span class="s1">yy)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(OverflowError):</span>
        <span class="s1">fig.savefig(io.BytesIO())</span>


<span class="s1">@image_comparison([</span><span class="s3">'clipper_edge'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_clipper():</span>
    <span class="s1">dat = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">fig.subplots_adjust(left=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">wspace=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">hspace=</span><span class="s4">0</span><span class="s1">)</span>

    <span class="s1">ax = fig.add_axes((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">autoscale_on=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.plot(dat)</span>
    <span class="s1">ax.xaxis.set_major_locator(plt.MultipleLocator(</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.yaxis.set_major_locator(plt.MultipleLocator(</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.xaxis.set_ticks_position(</span><span class="s3">'bottom'</span><span class="s1">)</span>
    <span class="s1">ax.yaxis.set_ticks_position(</span><span class="s3">'left'</span><span class="s1">)</span>

    <span class="s1">ax.set_xlim(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'para_equal_perp'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_para_equal_perp():</span>
    <span class="s1">x = np.array([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">] + [</span><span class="s4">1</span><span class="s1">] * </span><span class="s4">128</span><span class="s1">)</span>
    <span class="s1">y = np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">] + [</span><span class="s4">0</span><span class="s1">] * </span><span class="s4">128</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">y + </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.plot(x + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">y + </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'ro'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'clipping_with_nans'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_clipping_with_nans():</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3.14 </span><span class="s1">* </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3000</span><span class="s1">)</span>
    <span class="s1">y = np.sin(x)</span>
    <span class="s1">x[::</span><span class="s4">100</span><span class="s1">] = np.nan</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s4">0.25</span><span class="s0">, </span><span class="s4">0.25</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_clipping_full():</span>
    <span class="s1">p = Path([[</span><span class="s4">1e30</span><span class="s0">, </span><span class="s4">1e30</span><span class="s1">]] * </span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">simplified = list(p.iter_segments(clip=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]))</span>
    <span class="s0">assert </span><span class="s1">simplified == []</span>

    <span class="s1">p = Path([[</span><span class="s4">50</span><span class="s0">, </span><span class="s4">40</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">75</span><span class="s0">, </span><span class="s4">65</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s1">simplified = list(p.iter_segments(clip=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]))</span>
    <span class="s0">assert </span><span class="s1">([(list(x)</span><span class="s0">, </span><span class="s1">y) </span><span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">simplified] ==</span>
            <span class="s1">[([</span><span class="s4">50</span><span class="s0">, </span><span class="s4">40</span><span class="s1">]</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">([</span><span class="s4">75</span><span class="s0">, </span><span class="s4">65</span><span class="s1">]</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)])</span>

    <span class="s1">p = Path([[</span><span class="s4">50</span><span class="s0">, </span><span class="s4">40</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">simplified = list(p.iter_segments(clip=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]))</span>
    <span class="s0">assert </span><span class="s1">([(list(x)</span><span class="s0">, </span><span class="s1">y) </span><span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">simplified] ==</span>
            <span class="s1">[([</span><span class="s4">50</span><span class="s0">, </span><span class="s4">40</span><span class="s1">]</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)])</span>
</pre>
</body>
</html>