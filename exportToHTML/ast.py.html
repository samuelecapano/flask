<html>
<head>
<title>ast.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ast.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">fontTools.voltLib.error </span><span class="s0">import </span><span class="s1">VoltLibError</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">NamedTuple</span>


<span class="s0">class </span><span class="s1">Pos(NamedTuple):</span>
    <span class="s1">adv: int</span>
    <span class="s1">dx: int</span>
    <span class="s1">dy: int</span>
    <span class="s1">adv_adjust_by: dict</span>
    <span class="s1">dx_adjust_by: dict</span>
    <span class="s1">dy_adjust_by: dict</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">' POS'</span>
        <span class="s0">for </span><span class="s1">attr </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'adv'</span><span class="s0">, </span><span class="s2">'dx'</span><span class="s0">, </span><span class="s2">'dy'</span><span class="s1">):</span>
            <span class="s1">value = getattr(self</span><span class="s0">, </span><span class="s1">attr)</span>
            <span class="s0">if </span><span class="s1">value </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">res += </span><span class="s2">f' </span><span class="s0">{</span><span class="s1">attr.upper()</span><span class="s0">} {</span><span class="s1">value</span><span class="s0">}</span><span class="s2">'</span>
                <span class="s1">adjust_by = getattr(self</span><span class="s0">, </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">attr</span><span class="s0">}</span><span class="s2">_adjust_by'</span><span class="s0">, </span><span class="s1">{})</span>
                <span class="s0">for </span><span class="s1">size</span><span class="s0">, </span><span class="s1">adjustment </span><span class="s0">in </span><span class="s1">adjust_by.items():</span>
                    <span class="s1">res += </span><span class="s2">f' ADJUST_BY </span><span class="s0">{</span><span class="s1">adjustment</span><span class="s0">} </span><span class="s2">AT </span><span class="s0">{</span><span class="s1">size</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">' END_POS'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">Element(object):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">self.location = location</span>

    <span class="s0">def </span><span class="s1">build(self</span><span class="s0">, </span><span class="s1">builder):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">raise </span><span class="s1">NotImplementedError</span>


<span class="s0">class </span><span class="s1">Statement(Element):</span>
    <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">Expression(Element):</span>
    <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">VoltFile(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">)</span>
        <span class="s1">self.statements = []</span>

    <span class="s0">def </span><span class="s1">build(self</span><span class="s0">, </span><span class="s1">builder):</span>
        <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">self.statements:</span>
            <span class="s1">s.build(builder)</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">return </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">' </span><span class="s1">+ </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">'</span><span class="s1">.join(str(s) </span><span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">self.statements) + </span><span class="s2">' END</span><span class="s0">\n</span><span class="s2">'</span>


<span class="s0">class </span><span class="s1">GlyphDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">gid</span><span class="s0">, </span><span class="s1">gunicode</span><span class="s0">, </span><span class="s1">gtype</span><span class="s0">, </span><span class="s1">components</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.name = name</span>
        <span class="s1">self.id = gid</span>
        <span class="s1">self.unicode = gunicode</span>
        <span class="s1">self.type = gtype</span>
        <span class="s1">self.components = components</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">f'DEF_GLYPH &quot;</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s2">&quot; ID </span><span class="s0">{</span><span class="s1">self.id</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">if </span><span class="s1">self.unicode </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">len(self.unicode) &gt; </span><span class="s3">1</span><span class="s1">:</span>
                <span class="s1">unicodes = </span><span class="s2">','</span><span class="s1">.join(</span><span class="s2">f'U+</span><span class="s0">{</span><span class="s1">u</span><span class="s0">:</span><span class="s2">04X</span><span class="s0">}</span><span class="s2">' </span><span class="s0">for </span><span class="s1">u </span><span class="s0">in </span><span class="s1">self.unicode)</span>
                <span class="s1">res += </span><span class="s2">f' UNICODEVALUES &quot;</span><span class="s0">{</span><span class="s1">unicodes</span><span class="s0">}</span><span class="s2">&quot;'</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">res += </span><span class="s2">f' UNICODE </span><span class="s0">{</span><span class="s1">self.unicode[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">if </span><span class="s1">self.type </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">res += </span><span class="s2">f' TYPE </span><span class="s0">{</span><span class="s1">self.type</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">if </span><span class="s1">self.components </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">res += </span><span class="s2">f' COMPONENTS </span><span class="s0">{</span><span class="s1">self.components</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">' END_GLYPH'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">GroupDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">enum</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.name = name</span>
        <span class="s1">self.enum = enum</span>
        <span class="s1">self.glyphs_ = </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">glyphSet(self</span><span class="s0">, </span><span class="s1">groups=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s0">if </span><span class="s1">groups </span><span class="s0">is not None and </span><span class="s1">self.name </span><span class="s0">in </span><span class="s1">groups:</span>
            <span class="s0">raise </span><span class="s1">VoltLibError(</span>
                <span class="s2">'Group &quot;%s&quot; contains itself.' </span><span class="s1">% (self.name)</span><span class="s0">,</span>
                <span class="s1">self.location)</span>
        <span class="s0">if </span><span class="s1">self.glyphs_ </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s0">if </span><span class="s1">groups </span><span class="s0">is None</span><span class="s1">:</span>
                <span class="s1">groups = set({self.name})</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">groups.add(self.name)</span>
            <span class="s1">self.glyphs_ = self.enum.glyphSet(groups)</span>
        <span class="s0">return </span><span class="s1">self.glyphs_</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">enum = self.enum </span><span class="s0">and </span><span class="s1">str(self.enum) </span><span class="s0">or </span><span class="s2">''</span>
        <span class="s0">return </span><span class="s2">f'DEF_GROUP &quot;</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s0">\n{</span><span class="s1">enum</span><span class="s0">}\n</span><span class="s2">END_GROUP'</span>


<span class="s0">class </span><span class="s1">GlyphName(Expression):</span>
    <span class="s4">&quot;&quot;&quot;A single glyph name, such as cedilla.&quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">glyph</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Expression.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.glyph = glyph</span>

    <span class="s0">def </span><span class="s1">glyphSet(self):</span>
        <span class="s0">return </span><span class="s1">(self.glyph</span><span class="s0">,</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">return </span><span class="s2">f' GLYPH &quot;</span><span class="s0">{</span><span class="s1">self.glyph</span><span class="s0">}</span><span class="s2">&quot;'</span>


<span class="s0">class </span><span class="s1">Enum(Expression):</span>
    <span class="s4">&quot;&quot;&quot;An enum&quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">enum</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Expression.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.enum = enum</span>

    <span class="s0">def </span><span class="s1">__iter__(self):</span>
        <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">self.glyphSet():</span>
            <span class="s0">yield </span><span class="s1">e</span>

    <span class="s0">def </span><span class="s1">glyphSet(self</span><span class="s0">, </span><span class="s1">groups=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">glyphs = []</span>
        <span class="s0">for </span><span class="s1">element </span><span class="s0">in </span><span class="s1">self.enum:</span>
            <span class="s0">if </span><span class="s1">isinstance(element</span><span class="s0">, </span><span class="s1">(GroupName</span><span class="s0">, </span><span class="s1">Enum)):</span>
                <span class="s1">glyphs.extend(element.glyphSet(groups))</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">glyphs.extend(element.glyphSet())</span>
        <span class="s0">return </span><span class="s1">tuple(glyphs)</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">enum = </span><span class="s2">''</span><span class="s1">.join(str(e) </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">self.enum)</span>
        <span class="s0">return </span><span class="s2">f' ENUM</span><span class="s0">{</span><span class="s1">enum</span><span class="s0">} </span><span class="s2">END_ENUM'</span>


<span class="s0">class </span><span class="s1">GroupName(Expression):</span>
    <span class="s4">&quot;&quot;&quot;A glyph group&quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">group</span><span class="s0">, </span><span class="s1">parser</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Expression.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.group = group</span>
        <span class="s1">self.parser_ = parser</span>

    <span class="s0">def </span><span class="s1">glyphSet(self</span><span class="s0">, </span><span class="s1">groups=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">group = self.parser_.resolve_group(self.group)</span>
        <span class="s0">if </span><span class="s1">group </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">self.glyphs_ = group.glyphSet(groups)</span>
            <span class="s0">return </span><span class="s1">self.glyphs_</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">raise </span><span class="s1">VoltLibError(</span>
                <span class="s2">'Group &quot;%s&quot; is used but undefined.' </span><span class="s1">% (self.group)</span><span class="s0">,</span>
                <span class="s1">self.location)</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">return </span><span class="s2">f' GROUP &quot;</span><span class="s0">{</span><span class="s1">self.group</span><span class="s0">}</span><span class="s2">&quot;'</span>


<span class="s0">class </span><span class="s1">Range(Expression):</span>
    <span class="s4">&quot;&quot;&quot;A glyph range&quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">parser</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Expression.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.start = start</span>
        <span class="s1">self.end = end</span>
        <span class="s1">self.parser = parser</span>

    <span class="s0">def </span><span class="s1">glyphSet(self):</span>
        <span class="s0">return </span><span class="s1">tuple(self.parser.glyph_range(self.start</span><span class="s0">, </span><span class="s1">self.end))</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">return </span><span class="s2">f' RANGE &quot;</span><span class="s0">{</span><span class="s1">self.start</span><span class="s0">}</span><span class="s2">&quot; TO &quot;</span><span class="s0">{</span><span class="s1">self.end</span><span class="s0">}</span><span class="s2">&quot;'</span>


<span class="s0">class </span><span class="s1">ScriptDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">tag</span><span class="s0">, </span><span class="s1">langs</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.name = name</span>
        <span class="s1">self.tag = tag</span>
        <span class="s1">self.langs = langs</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">'DEF_SCRIPT'</span>
        <span class="s0">if </span><span class="s1">self.name </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">res += </span><span class="s2">f' NAME &quot;</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s2">&quot;'</span>
        <span class="s1">res += </span><span class="s2">f' TAG &quot;</span><span class="s0">{</span><span class="s1">self.tag</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">lang </span><span class="s0">in </span><span class="s1">self.langs:</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">lang</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'END_SCRIPT'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">LangSysDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">tag</span><span class="s0">, </span><span class="s1">features</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.name = name</span>
        <span class="s1">self.tag = tag</span>
        <span class="s1">self.features = features</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">'DEF_LANGSYS'</span>
        <span class="s0">if </span><span class="s1">self.name </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">res += </span><span class="s2">f' NAME &quot;</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s2">&quot;'</span>
        <span class="s1">res += </span><span class="s2">f' TAG &quot;</span><span class="s0">{</span><span class="s1">self.tag</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s0">\n\n</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">feature </span><span class="s0">in </span><span class="s1">self.features:</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">feature</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'END_LANGSYS</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">FeatureDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">tag</span><span class="s0">, </span><span class="s1">lookups</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.name = name</span>
        <span class="s1">self.tag = tag</span>
        <span class="s1">self.lookups = lookups</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">f'DEF_FEATURE NAME &quot;</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s2">&quot; TAG &quot;</span><span class="s0">{</span><span class="s1">self.tag</span><span class="s0">}</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">' ' </span><span class="s1">+ </span><span class="s2">' '</span><span class="s1">.join(</span><span class="s2">f'LOOKUP &quot;</span><span class="s0">{</span><span class="s1">l</span><span class="s0">}</span><span class="s2">&quot;' </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">self.lookups) + </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'END_FEATURE</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">LookupDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">process_base</span><span class="s0">, </span><span class="s1">process_marks</span><span class="s0">, </span><span class="s1">mark_glyph_set</span><span class="s0">,</span>
                 <span class="s1">direction</span><span class="s0">, </span><span class="s1">reversal</span><span class="s0">, </span><span class="s1">comments</span><span class="s0">, </span><span class="s1">context</span><span class="s0">, </span><span class="s1">sub</span><span class="s0">, </span><span class="s1">pos</span><span class="s0">,</span>
                 <span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.name = name</span>
        <span class="s1">self.process_base = process_base</span>
        <span class="s1">self.process_marks = process_marks</span>
        <span class="s1">self.mark_glyph_set = mark_glyph_set</span>
        <span class="s1">self.direction = direction</span>
        <span class="s1">self.reversal = reversal</span>
        <span class="s1">self.comments = comments</span>
        <span class="s1">self.context = context</span>
        <span class="s1">self.sub = sub</span>
        <span class="s1">self.pos = pos</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">f'DEF_LOOKUP &quot;</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s2">&quot;'</span>
        <span class="s1">res += </span><span class="s2">f' </span><span class="s0">{</span><span class="s1">self.process_base </span><span class="s0">and </span><span class="s2">&quot;PROCESS_BASE&quot; </span><span class="s0">or </span><span class="s2">&quot;SKIP_BASE&quot;</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">if </span><span class="s1">self.process_marks:</span>
            <span class="s1">res += </span><span class="s2">' PROCESS_MARKS '</span>
            <span class="s0">if </span><span class="s1">self.mark_glyph_set:</span>
                <span class="s1">res += </span><span class="s2">f'MARK_GLYPH_SET &quot;</span><span class="s0">{</span><span class="s1">self.mark_glyph_set</span><span class="s0">}</span><span class="s2">&quot;'</span>
            <span class="s0">elif </span><span class="s1">isinstance(self.process_marks</span><span class="s0">, </span><span class="s1">str):</span>
                <span class="s1">res += </span><span class="s2">f'&quot;</span><span class="s0">{</span><span class="s1">self.process_marks</span><span class="s0">}</span><span class="s2">&quot;'</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">res += </span><span class="s2">'ALL'</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">res += </span><span class="s2">' SKIP_MARKS'</span>
        <span class="s0">if </span><span class="s1">self.direction </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">res += </span><span class="s2">f' DIRECTION </span><span class="s0">{</span><span class="s1">self.direction</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">if </span><span class="s1">self.reversal:</span>
            <span class="s1">res += </span><span class="s2">' REVERSAL'</span>
        <span class="s0">if </span><span class="s1">self.comments </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">comments = self.comments.replace(</span><span class="s2">'</span><span class="s0">\n</span><span class="s2">'</span><span class="s0">, </span><span class="s2">r'\n'</span><span class="s1">)</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">\n</span><span class="s2">COMMENTS &quot;</span><span class="s0">{</span><span class="s1">comments</span><span class="s0">}</span><span class="s2">&quot;'</span>
        <span class="s0">if </span><span class="s1">self.context:</span>
            <span class="s1">res += </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">' </span><span class="s1">+ </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">'</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">self.context)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">res += </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">IN_CONTEXT</span><span class="s0">\n</span><span class="s2">END_CONTEXT'</span>
        <span class="s0">if </span><span class="s1">self.sub:</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">\n{</span><span class="s1">self.sub</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">if </span><span class="s1">self.pos:</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">\n{</span><span class="s1">self.pos</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">SubstitutionDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">mapping</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.mapping = mapping</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">'AS_SUBSTITUTION</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">src</span><span class="s0">, </span><span class="s1">dst </span><span class="s0">in </span><span class="s1">self.mapping.items():</span>
            <span class="s1">src = </span><span class="s2">''</span><span class="s1">.join(str(s) </span><span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">src)</span>
            <span class="s1">dst = </span><span class="s2">''</span><span class="s1">.join(str(d) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">dst)</span>
            <span class="s1">res += </span><span class="s2">f'SUB</span><span class="s0">{</span><span class="s1">src</span><span class="s0">}\n</span><span class="s2">WITH</span><span class="s0">{</span><span class="s1">dst</span><span class="s0">}\n</span><span class="s2">END_SUB</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'END_SUBSTITUTION'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">SubstitutionSingleDefinition(SubstitutionDefinition):</span>
    <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">SubstitutionMultipleDefinition(SubstitutionDefinition):</span>
    <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">SubstitutionLigatureDefinition(SubstitutionDefinition):</span>
    <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">SubstitutionReverseChainingSingleDefinition(SubstitutionDefinition):</span>
    <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">PositionAttachDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">coverage</span><span class="s0">, </span><span class="s1">coverage_to</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.coverage = coverage</span>
        <span class="s1">self.coverage_to = coverage_to</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">coverage = </span><span class="s2">''</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">self.coverage)</span>
        <span class="s1">res = </span><span class="s2">f'AS_POSITION</span><span class="s0">\n</span><span class="s2">ATTACH</span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">}\n</span><span class="s2">TO'</span>
        <span class="s0">for </span><span class="s1">coverage</span><span class="s0">, </span><span class="s1">anchor </span><span class="s0">in </span><span class="s1">self.coverage_to:</span>
            <span class="s1">coverage = </span><span class="s2">''</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">coverage)</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">} </span><span class="s2">AT ANCHOR &quot;</span><span class="s0">{</span><span class="s1">anchor</span><span class="s0">}</span><span class="s2">&quot;'</span>
        <span class="s1">res += </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">END_ATTACH</span><span class="s0">\n</span><span class="s2">END_POSITION'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">PositionAttachCursiveDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">coverages_exit</span><span class="s0">, </span><span class="s1">coverages_enter</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.coverages_exit = coverages_exit</span>
        <span class="s1">self.coverages_enter = coverages_enter</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">'AS_POSITION</span><span class="s0">\n</span><span class="s2">ATTACH_CURSIVE'</span>
        <span class="s0">for </span><span class="s1">coverage </span><span class="s0">in </span><span class="s1">self.coverages_exit:</span>
            <span class="s1">coverage = </span><span class="s2">''</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">coverage)</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">\n</span><span class="s2">EXIT </span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">coverage </span><span class="s0">in </span><span class="s1">self.coverages_enter:</span>
            <span class="s1">coverage = </span><span class="s2">''</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">coverage)</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">\n</span><span class="s2">ENTER </span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">END_ATTACH</span><span class="s0">\n</span><span class="s2">END_POSITION'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">PositionAdjustPairDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">coverages_1</span><span class="s0">, </span><span class="s1">coverages_2</span><span class="s0">, </span><span class="s1">adjust_pair</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.coverages_1 = coverages_1</span>
        <span class="s1">self.coverages_2 = coverages_2</span>
        <span class="s1">self.adjust_pair = adjust_pair</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">'AS_POSITION</span><span class="s0">\n</span><span class="s2">ADJUST_PAIR</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">coverage </span><span class="s0">in </span><span class="s1">self.coverages_1:</span>
            <span class="s1">coverage = </span><span class="s2">' '</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">coverage)</span>
            <span class="s1">res += </span><span class="s2">f' FIRST </span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">coverage </span><span class="s0">in </span><span class="s1">self.coverages_2:</span>
            <span class="s1">coverage = </span><span class="s2">' '</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">coverage)</span>
            <span class="s1">res += </span><span class="s2">f' SECOND </span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">(id_1</span><span class="s0">, </span><span class="s1">id_2)</span><span class="s0">, </span><span class="s1">(pos_1</span><span class="s0">, </span><span class="s1">pos_2) </span><span class="s0">in </span><span class="s1">self.adjust_pair.items():</span>
            <span class="s1">res += </span><span class="s2">f' </span><span class="s0">{</span><span class="s1">id_1</span><span class="s0">} {</span><span class="s1">id_2</span><span class="s0">} </span><span class="s2">BY</span><span class="s0">{</span><span class="s1">pos_1</span><span class="s0">}{</span><span class="s1">pos_2</span><span class="s0">}\n</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">END_ADJUST</span><span class="s0">\n</span><span class="s2">END_POSITION'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">PositionAdjustSingleDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">adjust_single</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.adjust_single = adjust_single</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = </span><span class="s2">'AS_POSITION</span><span class="s0">\n</span><span class="s2">ADJUST_SINGLE'</span>
        <span class="s0">for </span><span class="s1">coverage</span><span class="s0">, </span><span class="s1">pos </span><span class="s0">in </span><span class="s1">self.adjust_single:</span>
            <span class="s1">coverage = </span><span class="s2">''</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">coverage)</span>
            <span class="s1">res += </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">} </span><span class="s2">BY</span><span class="s0">{</span><span class="s1">pos</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">END_ADJUST</span><span class="s0">\n</span><span class="s2">END_POSITION'</span>
        <span class="s0">return </span><span class="s1">res</span>



<span class="s0">class </span><span class="s1">ContextDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">ex_or_in</span><span class="s0">, </span><span class="s1">left=</span><span class="s0">None, </span><span class="s1">right=</span><span class="s0">None, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.ex_or_in = ex_or_in</span>
        <span class="s1">self.left = left </span><span class="s0">if </span><span class="s1">left </span><span class="s0">is not None else </span><span class="s1">[]</span>
        <span class="s1">self.right = right </span><span class="s0">if </span><span class="s1">right </span><span class="s0">is not None else </span><span class="s1">[]</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">res = self.ex_or_in + </span><span class="s2">'</span><span class="s0">\n</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">coverage </span><span class="s0">in </span><span class="s1">self.left:</span>
            <span class="s1">coverage = </span><span class="s2">''</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">coverage)</span>
            <span class="s1">res += </span><span class="s2">f' LEFT</span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">}\n</span><span class="s2">'</span>
        <span class="s0">for </span><span class="s1">coverage </span><span class="s0">in </span><span class="s1">self.right:</span>
            <span class="s1">coverage = </span><span class="s2">''</span><span class="s1">.join(str(c) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">coverage)</span>
            <span class="s1">res += </span><span class="s2">f' RIGHT</span><span class="s0">{</span><span class="s1">coverage</span><span class="s0">}\n</span><span class="s2">'</span>
        <span class="s1">res += </span><span class="s2">'END_CONTEXT'</span>
        <span class="s0">return </span><span class="s1">res</span>


<span class="s0">class </span><span class="s1">AnchorDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">gid</span><span class="s0">, </span><span class="s1">glyph_name</span><span class="s0">, </span><span class="s1">component</span><span class="s0">, </span><span class="s1">locked</span><span class="s0">,</span>
                 <span class="s1">pos</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.name = name</span>
        <span class="s1">self.gid = gid</span>
        <span class="s1">self.glyph_name = glyph_name</span>
        <span class="s1">self.component = component</span>
        <span class="s1">self.locked = locked</span>
        <span class="s1">self.pos = pos</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s1">locked = self.locked </span><span class="s0">and </span><span class="s2">' LOCKED' </span><span class="s0">or </span><span class="s2">''</span>
        <span class="s0">return </span><span class="s1">(</span><span class="s2">f'DEF_ANCHOR &quot;</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s2">&quot;'</span>
                <span class="s2">f' ON </span><span class="s0">{</span><span class="s1">self.gid</span><span class="s0">}</span><span class="s2">'</span>
                <span class="s2">f' GLYPH </span><span class="s0">{</span><span class="s1">self.glyph_name</span><span class="s0">}</span><span class="s2">'</span>
                <span class="s2">f' COMPONENT </span><span class="s0">{</span><span class="s1">self.component</span><span class="s0">}</span><span class="s2">'</span>
                <span class="s2">f'</span><span class="s0">{</span><span class="s1">locked</span><span class="s0">}</span><span class="s2">'</span>
                <span class="s2">f' AT </span><span class="s0">{</span><span class="s1">self.pos</span><span class="s0">} </span><span class="s2">END_ANCHOR'</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">SettingDefinition(Statement):</span>
    <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">name</span><span class="s0">, </span><span class="s1">value</span><span class="s0">, </span><span class="s1">location=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s1">Statement.__init__(self</span><span class="s0">, </span><span class="s1">location)</span>
        <span class="s1">self.name = name</span>
        <span class="s1">self.value = value</span>

    <span class="s0">def </span><span class="s1">__str__(self):</span>
        <span class="s0">if </span><span class="s1">self.value </span><span class="s0">is True</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">if </span><span class="s1">isinstance(self.value</span><span class="s0">, </span><span class="s1">(tuple</span><span class="s0">, </span><span class="s1">list)):</span>
            <span class="s1">value = </span><span class="s2">&quot; &quot;</span><span class="s1">.join(str(v) </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">self.value)</span>
            <span class="s0">return </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">} {</span><span class="s1">value</span><span class="s0">}</span><span class="s2">'</span>
        <span class="s0">return </span><span class="s2">f'</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">} {</span><span class="s1">self.value</span><span class="s0">}</span><span class="s2">'</span>
</pre>
</body>
</html>