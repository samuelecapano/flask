<html>
<head>
<title>test_axes.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #629755; font-style: italic;}
.s6 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_axes.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">contextlib</span>
<span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">namedtuple</span>
<span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">from </span><span class="s1">decimal </span><span class="s0">import </span><span class="s1">Decimal</span>
<span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">partial</span>
<span class="s0">import </span><span class="s1">inspect</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">product</span>
<span class="s0">import </span><span class="s1">platform</span>
<span class="s0">from </span><span class="s1">types </span><span class="s0">import </span><span class="s1">SimpleNamespace</span>

<span class="s0">import </span><span class="s1">dateutil.tz</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy </span><span class="s0">import </span><span class="s1">ma</span>
<span class="s0">from </span><span class="s1">cycler </span><span class="s0">import </span><span class="s1">cycler</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">rc_context</span>
<span class="s0">from </span><span class="s1">matplotlib._api </span><span class="s0">import </span><span class="s1">MatplotlibDeprecationWarning</span>
<span class="s0">import </span><span class="s1">matplotlib.colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">matplotlib.dates </span><span class="s0">as </span><span class="s1">mdates</span>
<span class="s0">from </span><span class="s1">matplotlib.figure </span><span class="s0">import </span><span class="s1">Figure</span>
<span class="s0">from </span><span class="s1">matplotlib.axes </span><span class="s0">import </span><span class="s1">Axes</span>
<span class="s0">import </span><span class="s1">matplotlib.font_manager </span><span class="s0">as </span><span class="s1">mfont_manager</span>
<span class="s0">import </span><span class="s1">matplotlib.markers </span><span class="s0">as </span><span class="s1">mmarkers</span>
<span class="s0">import </span><span class="s1">matplotlib.patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">import </span><span class="s1">matplotlib.path </span><span class="s0">as </span><span class="s1">mpath</span>
<span class="s0">from </span><span class="s1">matplotlib.projections.geo </span><span class="s0">import </span><span class="s1">HammerAxes</span>
<span class="s0">from </span><span class="s1">matplotlib.projections.polar </span><span class="s0">import </span><span class="s1">PolarAxes</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib.text </span><span class="s0">as </span><span class="s1">mtext</span>
<span class="s0">import </span><span class="s1">matplotlib.ticker </span><span class="s0">as </span><span class="s1">mticker</span>
<span class="s0">import </span><span class="s1">matplotlib.transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">import </span><span class="s1">mpl_toolkits.axisartist </span><span class="s0">as </span><span class="s1">AA</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_allclose</span><span class="s0">, </span><span class="s1">assert_array_equal</span><span class="s0">, </span><span class="s1">assert_array_almost_equal)</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">image_comparison</span><span class="s0">, </span><span class="s1">check_figures_equal</span><span class="s0">, </span><span class="s1">remove_ticks_and_titles)</span>

<span class="s2"># Note: Some test cases are run twice: once normally and once with labeled data</span>
<span class="s2">#       These two must be defined in the same test function or need to have</span>
<span class="s2">#       different baseline images to prevent race conditions when pytest runs</span>
<span class="s2">#       the tests with multiple threads.</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_invisible_axes(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.set_visible(</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_get_labels():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'x label'</span><span class="s1">)</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">'y label'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlabel() == </span><span class="s3">'x label'</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylabel() == </span><span class="s3">'y label'</span>


<span class="s0">def </span><span class="s1">test_repr():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_label(</span><span class="s3">'label'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'title'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'x'</span><span class="s1">)</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">'y'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">repr(ax) == (</span>
        <span class="s3">&quot;&lt;Axes: &quot;</span>
        <span class="s3">&quot;label='label', title={'center': 'title'}, xlabel='x', ylabel='y'&gt;&quot;</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_label_loc_vertical(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">sc = ax.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'scatter'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">'Y Label'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'top'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'X Label'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'right'</span><span class="s1">)</span>
    <span class="s1">cbar = fig_test.colorbar(sc)</span>
    <span class="s1">cbar.set_label(</span><span class="s3">&quot;Z Label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'top'</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">sc = ax.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'scatter'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">'Y Label'</span><span class="s0">, </span><span class="s1">y=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'right'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'X Label'</span><span class="s0">, </span><span class="s1">x=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'right'</span><span class="s1">)</span>
    <span class="s1">cbar = fig_ref.colorbar(sc)</span>
    <span class="s1">cbar.set_label(</span><span class="s3">&quot;Z Label&quot;</span><span class="s0">, </span><span class="s1">y=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'right'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_label_loc_horizontal(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">sc = ax.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'scatter'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">'Y Label'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'bottom'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'X Label'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'left'</span><span class="s1">)</span>
    <span class="s1">cbar = fig_test.colorbar(sc</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>
    <span class="s1">cbar.set_label(</span><span class="s3">&quot;Z Label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'left'</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">sc = ax.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'scatter'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">'Y Label'</span><span class="s0">, </span><span class="s1">y=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'left'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'X Label'</span><span class="s0">, </span><span class="s1">x=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'left'</span><span class="s1">)</span>
    <span class="s1">cbar = fig_ref.colorbar(sc</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>
    <span class="s1">cbar.set_label(</span><span class="s3">&quot;Z Label&quot;</span><span class="s0">, </span><span class="s1">x=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'left'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_label_loc_rc(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s0">with </span><span class="s1">matplotlib.rc_context({</span><span class="s3">&quot;xaxis.labellocation&quot;</span><span class="s1">: </span><span class="s3">&quot;right&quot;</span><span class="s0">,</span>
                                <span class="s3">&quot;yaxis.labellocation&quot;</span><span class="s1">: </span><span class="s3">&quot;top&quot;</span><span class="s1">}):</span>
        <span class="s1">ax = fig_test.subplots()</span>
        <span class="s1">sc = ax.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'scatter'</span><span class="s1">)</span>
        <span class="s1">ax.legend()</span>
        <span class="s1">ax.set_ylabel(</span><span class="s3">'Y Label'</span><span class="s1">)</span>
        <span class="s1">ax.set_xlabel(</span><span class="s3">'X Label'</span><span class="s1">)</span>
        <span class="s1">cbar = fig_test.colorbar(sc</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>
        <span class="s1">cbar.set_label(</span><span class="s3">&quot;Z Label&quot;</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">sc = ax.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'scatter'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">'Y Label'</span><span class="s0">, </span><span class="s1">y=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'right'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'X Label'</span><span class="s0">, </span><span class="s1">x=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'right'</span><span class="s1">)</span>
    <span class="s1">cbar = fig_ref.colorbar(sc</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>
    <span class="s1">cbar.set_label(</span><span class="s3">&quot;Z Label&quot;</span><span class="s0">, </span><span class="s1">x=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ha=</span><span class="s3">'right'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_label_shift():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s2"># Test label re-centering on x-axis</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;Test label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">&quot;left&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;Test label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">&quot;center&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.get_label().get_horizontalalignment() == </span><span class="s3">&quot;center&quot;</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;Test label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">&quot;right&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.get_label().get_horizontalalignment() == </span><span class="s3">&quot;right&quot;</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;Test label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">&quot;center&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.get_label().get_horizontalalignment() == </span><span class="s3">&quot;center&quot;</span>

    <span class="s2"># Test label re-centering on y-axis</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">&quot;Test label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">&quot;top&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">&quot;Test label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">&quot;center&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.get_label().get_horizontalalignment() == </span><span class="s3">&quot;center&quot;</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">&quot;Test label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">&quot;bottom&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.get_label().get_horizontalalignment() == </span><span class="s3">&quot;left&quot;</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">&quot;Test label&quot;</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">&quot;center&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.get_label().get_horizontalalignment() == </span><span class="s3">&quot;center&quot;</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_acorr(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">Nx = </span><span class="s4">512</span>
    <span class="s1">x = np.random.normal(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">Nx).cumsum()</span>
    <span class="s1">maxlags = Nx-</span><span class="s4">1</span>

    <span class="s1">ax_test = fig_test.subplots()</span>
    <span class="s1">ax_test.acorr(x</span><span class="s0">, </span><span class="s1">maxlags=maxlags)</span>

    <span class="s1">ax_ref = fig_ref.subplots()</span>
    <span class="s2"># Normalized autocorrelation</span>
    <span class="s1">norm_auto_corr = np.correlate(x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">&quot;full&quot;</span><span class="s1">)/np.dot(x</span><span class="s0">, </span><span class="s1">x)</span>
    <span class="s1">lags = np.arange(-maxlags</span><span class="s0">, </span><span class="s1">maxlags+</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">norm_auto_corr = norm_auto_corr[Nx-</span><span class="s4">1</span><span class="s1">-maxlags:Nx+maxlags]</span>
    <span class="s1">ax_ref.vlines(lags</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">norm_auto_corr)</span>
    <span class="s1">ax_ref.axhline(y=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">xmin=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">xmax=</span><span class="s4">1</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_spy(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">a = np.ones(</span><span class="s4">32 </span><span class="s1">* </span><span class="s4">32</span><span class="s1">)</span>
    <span class="s1">a[:</span><span class="s4">16 </span><span class="s1">* </span><span class="s4">32</span><span class="s1">] = </span><span class="s4">0</span>
    <span class="s1">np.random.shuffle(a)</span>
    <span class="s1">a = a.reshape((</span><span class="s4">32</span><span class="s0">, </span><span class="s4">32</span><span class="s1">))</span>

    <span class="s1">axs_test = fig_test.subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">axs_test[</span><span class="s4">0</span><span class="s1">].spy(a)</span>
    <span class="s1">axs_test[</span><span class="s4">1</span><span class="s1">].spy(a</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">&quot;.&quot;</span><span class="s0">, </span><span class="s1">origin=</span><span class="s3">&quot;lower&quot;</span><span class="s1">)</span>

    <span class="s1">axs_ref = fig_ref.subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">axs_ref[</span><span class="s4">0</span><span class="s1">].imshow(a</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s3">&quot;gray_r&quot;</span><span class="s0">, </span><span class="s1">interpolation=</span><span class="s3">&quot;nearest&quot;</span><span class="s1">)</span>
    <span class="s1">axs_ref[</span><span class="s4">0</span><span class="s1">].xaxis.tick_top()</span>
    <span class="s1">axs_ref[</span><span class="s4">1</span><span class="s1">].plot(*np.nonzero(a)[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;.&quot;</span><span class="s0">, </span><span class="s1">markersize=</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">axs_ref[</span><span class="s4">1</span><span class="s1">].set(</span>
        <span class="s1">aspect=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">xlim=axs_ref[</span><span class="s4">0</span><span class="s1">].get_xlim()</span><span class="s0">, </span><span class="s1">ylim=axs_ref[</span><span class="s4">0</span><span class="s1">].get_ylim()[::-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs_ref:</span>
        <span class="s1">ax.xaxis.set_ticks_position(</span><span class="s3">&quot;both&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_spy_invalid_kwargs():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">for </span><span class="s1">unsupported_kw </span><span class="s0">in </span><span class="s1">[{</span><span class="s3">'interpolation'</span><span class="s1">: </span><span class="s3">'nearest'</span><span class="s1">}</span><span class="s0">,</span>
                           <span class="s1">{</span><span class="s3">'marker'</span><span class="s1">: </span><span class="s3">'o'</span><span class="s0">, </span><span class="s3">'linestyle'</span><span class="s1">: </span><span class="s3">'solid'</span><span class="s1">}]:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">ax.spy(np.eye(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">**unsupported_kw)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_matshow(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">mpl.style.use(</span><span class="s3">&quot;mpl20&quot;</span><span class="s1">)</span>
    <span class="s1">a = np.random.rand(</span><span class="s4">32</span><span class="s0">, </span><span class="s4">32</span><span class="s1">)</span>
    <span class="s1">fig_test.add_subplot().matshow(a)</span>
    <span class="s1">ax_ref = fig_ref.add_subplot()</span>
    <span class="s1">ax_ref.imshow(a)</span>
    <span class="s1">ax_ref.xaxis.tick_top()</span>
    <span class="s1">ax_ref.xaxis.set_ticks_position(</span><span class="s3">'both'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'formatter_ticker_001'</span><span class="s0">,</span>
                   <span class="s3">'formatter_ticker_002'</span><span class="s0">,</span>
                   <span class="s3">'formatter_ticker_003'</span><span class="s0">,</span>
                   <span class="s3">'formatter_ticker_004'</span><span class="s0">,</span>
                   <span class="s3">'formatter_ticker_005'</span><span class="s0">,</span>
                   <span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_formatter_ticker():</span>
    <span class="s0">import </span><span class="s1">matplotlib.testing.jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units.register()</span>

    <span class="s2"># This should affect the tick size.  (Tests issue #543)</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'lines.markeredgewidth'</span><span class="s1">] = </span><span class="s4">30</span>

    <span class="s2"># This essentially test to see if user specified labels get overwritten</span>
    <span class="s2"># by the auto labeler functionality of the axes.</span>
    <span class="s1">xdata = [x*units.sec </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)]</span>
    <span class="s1">ydata1 = [(</span><span class="s4">1.5</span><span class="s1">*y - </span><span class="s4">0.5</span><span class="s1">)*units.km </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)]</span>
    <span class="s1">ydata2 = [(</span><span class="s4">1.75</span><span class="s1">*y - </span><span class="s4">1.0</span><span class="s1">)*units.km </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)]</span>

    <span class="s1">ax = plt.figure().subplots()</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;x-label 001&quot;</span><span class="s1">)</span>

    <span class="s1">ax = plt.figure().subplots()</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;x-label 001&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot(xdata</span><span class="s0">, </span><span class="s1">ydata1</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s1">xunits=</span><span class="s3">&quot;sec&quot;</span><span class="s1">)</span>

    <span class="s1">ax = plt.figure().subplots()</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;x-label 001&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot(xdata</span><span class="s0">, </span><span class="s1">ydata1</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s1">xunits=</span><span class="s3">&quot;sec&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;x-label 003&quot;</span><span class="s1">)</span>

    <span class="s1">ax = plt.figure().subplots()</span>
    <span class="s1">ax.plot(xdata</span><span class="s0">, </span><span class="s1">ydata1</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s1">xunits=</span><span class="s3">&quot;sec&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot(xdata</span><span class="s0">, </span><span class="s1">ydata2</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'green'</span><span class="s0">, </span><span class="s1">xunits=</span><span class="s3">&quot;hour&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;x-label 004&quot;</span><span class="s1">)</span>

    <span class="s2"># See SF bug 2846058</span>
    <span class="s2"># https://sourceforge.net/tracker/?func=detail&amp;aid=2846058&amp;group_id=80706&amp;atid=560720</span>
    <span class="s1">ax = plt.figure().subplots()</span>
    <span class="s1">ax.plot(xdata</span><span class="s0">, </span><span class="s1">ydata1</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s1">xunits=</span><span class="s3">&quot;sec&quot;</span><span class="s1">)</span>
    <span class="s1">ax.plot(xdata</span><span class="s0">, </span><span class="s1">ydata2</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'green'</span><span class="s0">, </span><span class="s1">xunits=</span><span class="s3">&quot;hour&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">&quot;x-label 005&quot;</span><span class="s1">)</span>
    <span class="s1">ax.autoscale_view()</span>


<span class="s0">def </span><span class="s1">test_funcformatter_auto_formatter():</span>
    <span class="s0">def </span><span class="s1">_formfunc(x</span><span class="s0">, </span><span class="s1">pos):</span>
        <span class="s0">return </span><span class="s3">''</span>

    <span class="s1">ax = plt.figure().subplots()</span>

    <span class="s0">assert </span><span class="s1">ax.xaxis.isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.isDefault_minfmt</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.isDefault_minfmt</span>

    <span class="s1">ax.xaxis.set_major_formatter(_formfunc)</span>

    <span class="s0">assert not </span><span class="s1">ax.xaxis.isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.isDefault_minfmt</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.isDefault_minfmt</span>

    <span class="s1">targ_funcformatter = mticker.FuncFormatter(_formfunc)</span>

    <span class="s0">assert </span><span class="s1">isinstance(ax.xaxis.get_major_formatter()</span><span class="s0">,</span>
                      <span class="s1">mticker.FuncFormatter)</span>

    <span class="s0">assert </span><span class="s1">ax.xaxis.get_major_formatter().func == targ_funcformatter.func</span>


<span class="s0">def </span><span class="s1">test_strmethodformatter_auto_formatter():</span>
    <span class="s1">formstr = </span><span class="s3">'{x}_{pos}'</span>

    <span class="s1">ax = plt.figure().subplots()</span>

    <span class="s0">assert </span><span class="s1">ax.xaxis.isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.isDefault_minfmt</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.isDefault_minfmt</span>

    <span class="s1">ax.yaxis.set_minor_formatter(formstr)</span>

    <span class="s0">assert </span><span class="s1">ax.xaxis.isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.isDefault_minfmt</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.isDefault_majfmt</span>
    <span class="s0">assert not </span><span class="s1">ax.yaxis.isDefault_minfmt</span>

    <span class="s1">targ_strformatter = mticker.StrMethodFormatter(formstr)</span>

    <span class="s0">assert </span><span class="s1">isinstance(ax.yaxis.get_minor_formatter()</span><span class="s0">,</span>
                      <span class="s1">mticker.StrMethodFormatter)</span>

    <span class="s0">assert </span><span class="s1">ax.yaxis.get_minor_formatter().fmt == targ_strformatter.fmt</span>


<span class="s1">@image_comparison([</span><span class="s3">&quot;twin_axis_locators_formatters&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_twin_axis_locators_formatters():</span>
    <span class="s1">vals = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">num=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">locs = np.sin(np.pi * vals / </span><span class="s4">2.0</span><span class="s1">)</span>

    <span class="s1">majl = plt.FixedLocator(locs)</span>
    <span class="s1">minl = plt.FixedLocator([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">])</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax1.plot([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax1.yaxis.set_major_locator(majl)</span>
    <span class="s1">ax1.yaxis.set_minor_locator(minl)</span>
    <span class="s1">ax1.yaxis.set_major_formatter(plt.FormatStrFormatter(</span><span class="s3">'%08.2lf'</span><span class="s1">))</span>
    <span class="s1">ax1.yaxis.set_minor_formatter(plt.FixedFormatter([</span><span class="s3">'tricks'</span><span class="s0">, </span><span class="s3">'mind'</span><span class="s0">,</span>
                                                      <span class="s3">'jedi'</span><span class="s1">]))</span>

    <span class="s1">ax1.xaxis.set_major_locator(plt.LinearLocator())</span>
    <span class="s1">ax1.xaxis.set_minor_locator(plt.FixedLocator([</span><span class="s4">15</span><span class="s0">, </span><span class="s4">35</span><span class="s0">, </span><span class="s4">55</span><span class="s0">, </span><span class="s4">75</span><span class="s1">]))</span>
    <span class="s1">ax1.xaxis.set_major_formatter(plt.FormatStrFormatter(</span><span class="s3">'%05.2lf'</span><span class="s1">))</span>
    <span class="s1">ax1.xaxis.set_minor_formatter(plt.FixedFormatter([</span><span class="s3">'c'</span><span class="s0">, </span><span class="s3">'3'</span><span class="s0">, </span><span class="s3">'p'</span><span class="s0">, </span><span class="s3">'o'</span><span class="s1">]))</span>
    <span class="s1">ax1.twiny()</span>
    <span class="s1">ax1.twinx()</span>


<span class="s0">def </span><span class="s1">test_twinx_cla():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax2 = ax.twinx()</span>
    <span class="s1">ax3 = ax2.twiny()</span>
    <span class="s1">plt.draw()</span>
    <span class="s0">assert not </span><span class="s1">ax2.xaxis.get_visible()</span>
    <span class="s0">assert not </span><span class="s1">ax2.patch.get_visible()</span>
    <span class="s1">ax2.cla()</span>
    <span class="s1">ax3.cla()</span>

    <span class="s0">assert not </span><span class="s1">ax2.xaxis.get_visible()</span>
    <span class="s0">assert not </span><span class="s1">ax2.patch.get_visible()</span>
    <span class="s0">assert </span><span class="s1">ax2.yaxis.get_visible()</span>

    <span class="s0">assert </span><span class="s1">ax3.xaxis.get_visible()</span>
    <span class="s0">assert not </span><span class="s1">ax3.patch.get_visible()</span>
    <span class="s0">assert not </span><span class="s1">ax3.yaxis.get_visible()</span>

    <span class="s0">assert </span><span class="s1">ax.xaxis.get_visible()</span>
    <span class="s0">assert </span><span class="s1">ax.patch.get_visible()</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.get_visible()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'twin'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s1">))</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s4">0.19</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_twin_logscale(fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">twin):</span>
    <span class="s1">twin_func = </span><span class="s3">f'twin</span><span class="s0">{</span><span class="s1">twin</span><span class="s0">}</span><span class="s3">'  </span><span class="s2"># test twinx or twiny</span>
    <span class="s1">set_scale = </span><span class="s3">f'set_</span><span class="s0">{</span><span class="s1">twin</span><span class="s0">}</span><span class="s3">scale'</span>
    <span class="s1">x = np.arange(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span>

    <span class="s2"># Change scale after twinning.</span>
    <span class="s1">ax_test = fig_test.add_subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax_twin = getattr(ax_test</span><span class="s0">, </span><span class="s1">twin_func)()</span>
    <span class="s1">getattr(ax_test</span><span class="s0">, </span><span class="s1">set_scale)(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s1">ax_twin.plot(x</span><span class="s0">, </span><span class="s1">x)</span>

    <span class="s2"># Twin after changing scale.</span>
    <span class="s1">ax_test = fig_test.add_subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">getattr(ax_test</span><span class="s0">, </span><span class="s1">set_scale)(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s1">ax_twin = getattr(ax_test</span><span class="s0">, </span><span class="s1">twin_func)()</span>
    <span class="s1">ax_twin.plot(x</span><span class="s0">, </span><span class="s1">x)</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]:</span>
        <span class="s1">ax_ref = fig_ref.add_subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">i)</span>
        <span class="s1">getattr(ax_ref</span><span class="s0">, </span><span class="s1">set_scale)(</span><span class="s3">'log'</span><span class="s1">)</span>
        <span class="s1">ax_ref.plot(x</span><span class="s0">, </span><span class="s1">x)</span>

        <span class="s2"># This is a hack because twinned Axes double-draw the frame.</span>
        <span class="s2"># Remove this when that is fixed.</span>
        <span class="s1">Path = matplotlib.path.Path</span>
        <span class="s1">fig_ref.add_artist(</span>
            <span class="s1">matplotlib.patches.PathPatch(</span>
                <span class="s1">Path([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">,</span>
                     <span class="s1">[Path.MOVETO</span><span class="s0">, </span><span class="s1">Path.LINETO] * </span><span class="s4">4</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">transform=ax_ref.transAxes</span><span class="s0">,</span>
                <span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s0">,</span>
                <span class="s1">edgecolor=mpl.rcParams[</span><span class="s3">'axes.edgecolor'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">linewidth=mpl.rcParams[</span><span class="s3">'axes.linewidth'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">capstyle=</span><span class="s3">'projecting'</span><span class="s1">))</span>

    <span class="s1">remove_ticks_and_titles(fig_test)</span>
    <span class="s1">remove_ticks_and_titles(fig_ref)</span>


<span class="s1">@image_comparison([</span><span class="s3">'twin_autoscale.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_twinx_axis_scales():</span>
    <span class="s1">x = np.array([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">y = </span><span class="s4">0.5 </span><span class="s1">* x</span>
    <span class="s1">x2 = np.array([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s1">y2 = </span><span class="s4">2 </span><span class="s1">* x2</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_axes((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">autoscalex_on=</span><span class="s0">False, </span><span class="s1">autoscaley_on=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s1">)</span>

    <span class="s1">ax2 = plt.twinx(ax)</span>
    <span class="s1">ax2.plot(x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s3">'r--'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">ax.margins(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ax2.margins(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_twin_inherit_autoscale_setting():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax_x_on = ax.twinx()</span>
    <span class="s1">ax.set_autoscalex_on(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax_x_off = ax.twinx()</span>

    <span class="s0">assert </span><span class="s1">ax_x_on.get_autoscalex_on()</span>
    <span class="s0">assert not </span><span class="s1">ax_x_off.get_autoscalex_on()</span>

    <span class="s1">ax_y_on = ax.twiny()</span>
    <span class="s1">ax.set_autoscaley_on(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax_y_off = ax.twiny()</span>

    <span class="s0">assert </span><span class="s1">ax_y_on.get_autoscaley_on()</span>
    <span class="s0">assert not </span><span class="s1">ax_y_off.get_autoscaley_on()</span>


<span class="s0">def </span><span class="s1">test_inverted_cla():</span>
    <span class="s2"># GitHub PR #5450. Setting autoscale should reset</span>
    <span class="s2"># axes to be non-inverted.</span>
    <span class="s2"># plotting an image, then 1d graph, axis is now down</span>
    <span class="s1">fig = plt.figure(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ax = fig.gca()</span>
    <span class="s2"># 1. test that a new axis is not inverted per default</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis_inverted()</span>
    <span class="s0">assert not </span><span class="s1">ax.yaxis_inverted()</span>
    <span class="s1">img = np.random.random((</span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s1">))</span>
    <span class="s1">ax.imshow(img)</span>
    <span class="s2"># 2. test that a image axis is inverted</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis_inverted()</span>
    <span class="s2"># 3. test that clearing and plotting a line, axes are</span>
    <span class="s2"># not inverted</span>
    <span class="s1">ax.cla()</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*np.pi</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">np.cos(x))</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis_inverted()</span>
    <span class="s0">assert not </span><span class="s1">ax.yaxis_inverted()</span>

    <span class="s2"># 4. autoscaling should not bring back axes to normal</span>
    <span class="s1">ax.cla()</span>
    <span class="s1">ax.imshow(img)</span>
    <span class="s1">plt.autoscale()</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis_inverted()</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis_inverted()</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig.axes:</span>
        <span class="s1">ax.remove()</span>
    <span class="s2"># 5. two shared axes. Inverting the leader axis should invert the shared</span>
    <span class="s2"># axes; clearing the leader axis should bring axes in shared</span>
    <span class="s2"># axes back to normal.</span>
    <span class="s1">ax0 = plt.subplot(</span><span class="s4">211</span><span class="s1">)</span>
    <span class="s1">ax1 = plt.subplot(</span><span class="s4">212</span><span class="s0">, </span><span class="s1">sharey=ax0)</span>
    <span class="s1">ax0.yaxis.set_inverted(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax1.yaxis_inverted()</span>
    <span class="s1">ax1.plot(x</span><span class="s0">, </span><span class="s1">np.cos(x))</span>
    <span class="s1">ax0.cla()</span>
    <span class="s0">assert not </span><span class="s1">ax1.yaxis_inverted()</span>
    <span class="s1">ax1.cla()</span>
    <span class="s2"># 6. clearing the follower should not touch limits</span>
    <span class="s1">ax0.imshow(img)</span>
    <span class="s1">ax1.plot(x</span><span class="s0">, </span><span class="s1">np.cos(x))</span>
    <span class="s1">ax1.cla()</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis_inverted()</span>

    <span class="s2"># clean up</span>
    <span class="s1">plt.close(fig)</span>


<span class="s0">def </span><span class="s1">test_subclass_clear_cla():</span>
    <span class="s2"># Ensure that subclasses of Axes call cla/clear correctly.</span>
    <span class="s2"># Note, we cannot use mocking here as we want to be sure that the</span>
    <span class="s2"># superclass fallback does not recurse.</span>

    <span class="s0">with </span><span class="s1">pytest.warns(PendingDeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s3">'Overriding `Axes.cla`'</span><span class="s1">):</span>
        <span class="s0">class </span><span class="s1">ClaAxes(Axes):</span>
            <span class="s0">def </span><span class="s1">cla(self):</span>
                <span class="s0">nonlocal </span><span class="s1">called</span>
                <span class="s1">called = </span><span class="s0">True</span>

    <span class="s0">with </span><span class="s1">pytest.warns(PendingDeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s3">'Overriding `Axes.cla`'</span><span class="s1">):</span>
        <span class="s0">class </span><span class="s1">ClaSuperAxes(Axes):</span>
            <span class="s0">def </span><span class="s1">cla(self):</span>
                <span class="s0">nonlocal </span><span class="s1">called</span>
                <span class="s1">called = </span><span class="s0">True</span>
                <span class="s1">super().cla()</span>

    <span class="s0">class </span><span class="s1">SubClaAxes(ClaAxes):</span>
        <span class="s0">pass</span>

    <span class="s0">class </span><span class="s1">ClearAxes(Axes):</span>
        <span class="s0">def </span><span class="s1">clear(self):</span>
            <span class="s0">nonlocal </span><span class="s1">called</span>
            <span class="s1">called = </span><span class="s0">True</span>

    <span class="s0">class </span><span class="s1">ClearSuperAxes(Axes):</span>
        <span class="s0">def </span><span class="s1">clear(self):</span>
            <span class="s0">nonlocal </span><span class="s1">called</span>
            <span class="s1">called = </span><span class="s0">True</span>
            <span class="s1">super().clear()</span>

    <span class="s0">class </span><span class="s1">SubClearAxes(ClearAxes):</span>
        <span class="s0">pass</span>

    <span class="s1">fig = Figure()</span>
    <span class="s0">for </span><span class="s1">axes_class </span><span class="s0">in </span><span class="s1">[ClaAxes</span><span class="s0">, </span><span class="s1">ClaSuperAxes</span><span class="s0">, </span><span class="s1">SubClaAxes</span><span class="s0">,</span>
                       <span class="s1">ClearAxes</span><span class="s0">, </span><span class="s1">ClearSuperAxes</span><span class="s0">, </span><span class="s1">SubClearAxes]:</span>
        <span class="s1">called = </span><span class="s0">False</span>
        <span class="s1">ax = axes_class(fig</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s2"># Axes.__init__ has already called clear (which aliases to cla or is in</span>
        <span class="s2"># the subclass).</span>
        <span class="s0">assert </span><span class="s1">called</span>

        <span class="s1">called = </span><span class="s0">False</span>
        <span class="s1">ax.cla()</span>
        <span class="s0">assert </span><span class="s1">called</span>


<span class="s0">def </span><span class="s1">test_cla_not_redefined_internally():</span>
    <span class="s0">for </span><span class="s1">klass </span><span class="s0">in </span><span class="s1">Axes.__subclasses__():</span>
        <span class="s2"># Check that cla does not get redefined in our Axes subclasses, except</span>
        <span class="s2"># for in the above test function.</span>
        <span class="s0">if </span><span class="s3">'test_subclass_clear_cla' </span><span class="s0">not in </span><span class="s1">klass.__qualname__:</span>
            <span class="s0">assert </span><span class="s3">'cla' </span><span class="s0">not in </span><span class="s1">klass.__dict__</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_minorticks_on_rcParams_both(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s0">with </span><span class="s1">matplotlib.rc_context({</span><span class="s3">&quot;xtick.minor.visible&quot;</span><span class="s1">: </span><span class="s0">True,</span>
                                <span class="s3">&quot;ytick.minor.visible&quot;</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}):</span>
        <span class="s1">ax_test = fig_test.subplots()</span>
        <span class="s1">ax_test.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax_ref = fig_ref.subplots()</span>
    <span class="s1">ax_ref.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax_ref.minorticks_on()</span>


<span class="s1">@image_comparison([</span><span class="s3">&quot;autoscale_tiny_range&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_autoscale_tiny_range():</span>
    <span class="s2"># github pull #904</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">y1 = </span><span class="s4">10</span><span class="s1">**(-</span><span class="s4">11 </span><span class="s1">- i)</span>
        <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1 </span><span class="s1">+ y1])</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_autoscale_tight():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">ax.autoscale(enable=</span><span class="s0">True, </span><span class="s1">axis=</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">tight=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.autoscale(enable=</span><span class="s0">True, </span><span class="s1">axis=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">tight=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_allclose(ax.get_xlim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">0.15</span><span class="s0">, </span><span class="s4">3.15</span><span class="s1">))</span>
    <span class="s1">assert_allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">))</span>

    <span class="s2"># Check that autoscale is on</span>
    <span class="s0">assert </span><span class="s1">ax.get_autoscalex_on()</span>
    <span class="s0">assert </span><span class="s1">ax.get_autoscaley_on()</span>
    <span class="s0">assert </span><span class="s1">ax.get_autoscale_on()</span>
    <span class="s2"># Set enable to None</span>
    <span class="s1">ax.autoscale(enable=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s2"># Same limits</span>
    <span class="s1">assert_allclose(ax.get_xlim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">0.15</span><span class="s0">, </span><span class="s4">3.15</span><span class="s1">))</span>
    <span class="s1">assert_allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">))</span>
    <span class="s2"># autoscale still on</span>
    <span class="s0">assert </span><span class="s1">ax.get_autoscalex_on()</span>
    <span class="s0">assert </span><span class="s1">ax.get_autoscaley_on()</span>
    <span class="s0">assert </span><span class="s1">ax.get_autoscale_on()</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_autoscale_log_shared():</span>
    <span class="s2"># related to github #7587</span>
    <span class="s2"># array starts at zero to trigger _minpos handling</span>
    <span class="s1">x = np.arange(</span><span class="s4">100</span><span class="s0">, </span><span class="s1">dtype=float)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax1.loglog(x</span><span class="s0">, </span><span class="s1">x)</span>
    <span class="s1">ax2.semilogx(x</span><span class="s0">, </span><span class="s1">x)</span>
    <span class="s1">ax1.autoscale(tight=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax2.autoscale(tight=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">plt.draw()</span>
    <span class="s1">lims = (x[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">assert_allclose(ax1.get_xlim()</span><span class="s0">, </span><span class="s1">lims)</span>
    <span class="s1">assert_allclose(ax1.get_ylim()</span><span class="s0">, </span><span class="s1">lims)</span>
    <span class="s1">assert_allclose(ax2.get_xlim()</span><span class="s0">, </span><span class="s1">lims)</span>
    <span class="s1">assert_allclose(ax2.get_ylim()</span><span class="s0">, </span><span class="s1">(x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[-</span><span class="s4">1</span><span class="s1">]))</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_use_sticky_edges():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.imshow([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">origin=</span><span class="s3">'lower'</span><span class="s1">)</span>
    <span class="s1">assert_allclose(ax.get_xlim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">))</span>
    <span class="s1">assert_allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">))</span>
    <span class="s1">ax.use_sticky_edges = </span><span class="s0">False</span>
    <span class="s1">ax.autoscale()</span>
    <span class="s1">xlim = (-</span><span class="s4">0.5 </span><span class="s1">- </span><span class="s4">2 </span><span class="s1">* ax._xmargin</span><span class="s0">, </span><span class="s4">1.5 </span><span class="s1">+ </span><span class="s4">2 </span><span class="s1">* ax._xmargin)</span>
    <span class="s1">ylim = (-</span><span class="s4">0.5 </span><span class="s1">- </span><span class="s4">2 </span><span class="s1">* ax._ymargin</span><span class="s0">, </span><span class="s4">1.5 </span><span class="s1">+ </span><span class="s4">2 </span><span class="s1">* ax._ymargin)</span>
    <span class="s1">assert_allclose(ax.get_xlim()</span><span class="s0">, </span><span class="s1">xlim)</span>
    <span class="s1">assert_allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">ylim)</span>
    <span class="s2"># Make sure it is reversible:</span>
    <span class="s1">ax.use_sticky_edges = </span><span class="s0">True</span>
    <span class="s1">ax.autoscale()</span>
    <span class="s1">assert_allclose(ax.get_xlim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">))</span>
    <span class="s1">assert_allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_sticky_shared_axes(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># Check that sticky edges work whether they are set in an Axes that is a</span>
    <span class="s2"># &quot;leader&quot; in a share, or an Axes that is a &quot;follower&quot;.</span>
    <span class="s1">Z = np.arange(</span><span class="s4">15</span><span class="s1">).reshape(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">ax0 = fig_test.add_subplot(</span><span class="s4">211</span><span class="s1">)</span>
    <span class="s1">ax1 = fig_test.add_subplot(</span><span class="s4">212</span><span class="s0">, </span><span class="s1">sharex=ax0)</span>
    <span class="s1">ax1.pcolormesh(Z)</span>

    <span class="s1">ax0 = fig_ref.add_subplot(</span><span class="s4">212</span><span class="s1">)</span>
    <span class="s1">ax1 = fig_ref.add_subplot(</span><span class="s4">211</span><span class="s0">, </span><span class="s1">sharex=ax0)</span>
    <span class="s1">ax0.pcolormesh(Z)</span>


<span class="s1">@image_comparison([</span><span class="s3">'offset_points'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_basic_annotate():</span>
    <span class="s2"># Setup some data</span>
    <span class="s1">t = np.arange(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">5.0</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">)</span>
    <span class="s1">s = np.cos(</span><span class="s4">2.0</span><span class="s1">*np.pi * t)</span>

    <span class="s2"># Offset Points</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(autoscale_on=</span><span class="s0">False, </span><span class="s1">xlim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>
    <span class="s1">line</span><span class="s0">, </span><span class="s1">= ax.plot(t</span><span class="s0">, </span><span class="s1">s</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'purple'</span><span class="s1">)</span>

    <span class="s1">ax.annotate(</span><span class="s3">'local max'</span><span class="s0">, </span><span class="s1">xy=(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xycoords=</span><span class="s3">'data'</span><span class="s0">,</span>
                <span class="s1">xytext=(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">textcoords=</span><span class="s3">'offset points'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'arrow_simple.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_arrow_simple():</span>
    <span class="s2"># Simple image test for ax.arrow</span>
    <span class="s2"># kwargs that take discrete values</span>
    <span class="s1">length_includes_head = (</span><span class="s0">True, False</span><span class="s1">)</span>
    <span class="s1">shape = (</span><span class="s3">'full'</span><span class="s0">, </span><span class="s3">'left'</span><span class="s0">, </span><span class="s3">'right'</span><span class="s1">)</span>
    <span class="s1">head_starts_at_zero = (</span><span class="s0">True, False</span><span class="s1">)</span>
    <span class="s2"># Create outer product of values</span>
    <span class="s1">kwargs = product(length_includes_head</span><span class="s0">, </span><span class="s1">shape</span><span class="s0">, </span><span class="s1">head_starts_at_zero)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">(ax</span><span class="s0">, </span><span class="s1">kwarg) </span><span class="s0">in </span><span class="s1">enumerate(zip(axs.flat</span><span class="s0">, </span><span class="s1">kwargs)):</span>
        <span class="s1">ax.set_xlim(-</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">ax.set_ylim(-</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s2"># Unpack kwargs</span>
        <span class="s1">(length_includes_head</span><span class="s0">, </span><span class="s1">shape</span><span class="s0">, </span><span class="s1">head_starts_at_zero) = kwarg</span>
        <span class="s1">theta = </span><span class="s4">2 </span><span class="s1">* np.pi * i / </span><span class="s4">12</span>
        <span class="s2"># Draw arrow</span>
        <span class="s1">ax.arrow(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.sin(theta)</span><span class="s0">, </span><span class="s1">np.cos(theta)</span><span class="s0">,</span>
                 <span class="s1">width=theta/</span><span class="s4">100</span><span class="s0">,</span>
                 <span class="s1">length_includes_head=length_includes_head</span><span class="s0">,</span>
                 <span class="s1">shape=shape</span><span class="s0">,</span>
                 <span class="s1">head_starts_at_zero=head_starts_at_zero</span><span class="s0">,</span>
                 <span class="s1">head_width=theta / </span><span class="s4">10</span><span class="s0">,</span>
                 <span class="s1">head_length=theta / </span><span class="s4">10</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_arrow_empty():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2"># Create an empty FancyArrow</span>
    <span class="s1">ax.arrow(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">head_length=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_arrow_in_view():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.arrow(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">0.8</span><span class="s0">, </span><span class="s4">2.2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (</span><span class="s4">0.8</span><span class="s0">, </span><span class="s4">2.2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_annotate_default_arrow():</span>
    <span class="s2"># Check that we can make an annotation arrow with only default properties.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ann = ax.annotate(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xytext=(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">ann.arrow_patch </span><span class="s0">is None</span>
    <span class="s1">ann = ax.annotate(</span><span class="s3">&quot;foo&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xytext=(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">arrowprops={})</span>
    <span class="s0">assert </span><span class="s1">ann.arrow_patch </span><span class="s0">is not None</span>


<span class="s0">def </span><span class="s1">test_annotate_signature():</span>
    <span class="s5">&quot;&quot;&quot;Check that the signature of Axes.annotate() matches Annotation.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">annotate_params = inspect.signature(ax.annotate).parameters</span>
    <span class="s1">annotation_params = inspect.signature(mtext.Annotation).parameters</span>
    <span class="s0">assert </span><span class="s1">list(annotate_params.keys()) == list(annotation_params.keys())</span>
    <span class="s0">for </span><span class="s1">p1</span><span class="s0">, </span><span class="s1">p2 </span><span class="s0">in </span><span class="s1">zip(annotate_params.values()</span><span class="s0">, </span><span class="s1">annotation_params.values()):</span>
        <span class="s0">assert </span><span class="s1">p1 == p2</span>


<span class="s1">@image_comparison([</span><span class="s3">'fill_units.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">60</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_fill_units():</span>
    <span class="s0">import </span><span class="s1">matplotlib.testing.jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units.register()</span>

    <span class="s2"># generate some data</span>
    <span class="s1">t = units.Epoch(</span><span class="s3">&quot;ET&quot;</span><span class="s0">, </span><span class="s1">dt=datetime.datetime(</span><span class="s4">2009</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">27</span><span class="s1">))</span>
    <span class="s1">value = </span><span class="s4">10.0 </span><span class="s1">* units.deg</span>
    <span class="s1">day = units.Duration(</span><span class="s3">&quot;ET&quot;</span><span class="s0">, </span><span class="s4">24.0 </span><span class="s1">* </span><span class="s4">60.0 </span><span class="s1">* </span><span class="s4">60.0</span><span class="s1">)</span>
    <span class="s1">dt = np.arange(</span><span class="s3">'2009-04-27'</span><span class="s0">, </span><span class="s3">'2009-04-29'</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'datetime64[D]'</span><span class="s1">)</span>
    <span class="s1">dtn = mdates.date2num(dt)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">((ax1</span><span class="s0">, </span><span class="s1">ax2)</span><span class="s0">, </span><span class="s1">(ax3</span><span class="s0">, </span><span class="s1">ax4)) = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">ax1.plot([t]</span><span class="s0">, </span><span class="s1">[value]</span><span class="s0">, </span><span class="s1">yunits=</span><span class="s3">'deg'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s1">ind = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">ax1.fill(dtn[ind]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">90.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">)</span>

    <span class="s1">ax2.plot([t]</span><span class="s0">, </span><span class="s1">[value]</span><span class="s0">, </span><span class="s1">yunits=</span><span class="s3">'deg'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s1">ax2.fill([t</span><span class="s0">, </span><span class="s1">t</span><span class="s0">, </span><span class="s1">t + day</span><span class="s0">, </span><span class="s1">t + day]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">90.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">)</span>

    <span class="s1">ax3.plot([t]</span><span class="s0">, </span><span class="s1">[value]</span><span class="s0">, </span><span class="s1">yunits=</span><span class="s3">'deg'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s1">ax3.fill(dtn[ind]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">0 </span><span class="s1">* units.deg</span><span class="s0">, </span><span class="s4">0 </span><span class="s1">* units.deg</span><span class="s0">, </span><span class="s4">90 </span><span class="s1">* units.deg</span><span class="s0">, </span><span class="s4">0 </span><span class="s1">* units.deg]</span><span class="s0">,</span>
             <span class="s3">'b'</span><span class="s1">)</span>

    <span class="s1">ax4.plot([t]</span><span class="s0">, </span><span class="s1">[value]</span><span class="s0">, </span><span class="s1">yunits=</span><span class="s3">'deg'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s1">ax4.fill([t</span><span class="s0">, </span><span class="s1">t</span><span class="s0">, </span><span class="s1">t + day</span><span class="s0">, </span><span class="s1">t + day]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">0 </span><span class="s1">* units.deg</span><span class="s0">, </span><span class="s4">0 </span><span class="s1">* units.deg</span><span class="s0">, </span><span class="s4">90 </span><span class="s1">* units.deg</span><span class="s0">, </span><span class="s4">0 </span><span class="s1">* units.deg]</span><span class="s0">,</span>
             <span class="s1">facecolor=</span><span class="s3">&quot;blue&quot;</span><span class="s1">)</span>
    <span class="s1">fig.autofmt_xdate()</span>


<span class="s0">def </span><span class="s1">test_plot_format_kwarg_redundant():</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;marker .* redundantly defined&quot;</span><span class="s1">):</span>
        <span class="s1">plt.plot([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;linestyle .* redundantly defined&quot;</span><span class="s1">):</span>
        <span class="s1">plt.plot([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'-'</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">'--'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;color .* redundantly defined&quot;</span><span class="s1">):</span>
        <span class="s1">plt.plot([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'blue'</span><span class="s1">)</span>
    <span class="s2"># smoke-test: should not warn</span>
    <span class="s1">plt.errorbar([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'blue'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_dashes(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">y = np.sin(x)</span>

    <span class="s1">ax_ref = fig_ref.gca()</span>
    <span class="s1">ax_test = fig_test.gca()</span>

    <span class="s1">line</span><span class="s0">, </span><span class="s1">*_ = ax_ref.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xerr=np.abs(y)</span><span class="s0">, </span><span class="s1">yerr=np.abs(y))</span>
    <span class="s1">line.set_dashes([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>

    <span class="s1">ax_test.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xerr=np.abs(y)</span><span class="s0">, </span><span class="s1">yerr=np.abs(y)</span><span class="s0">, </span><span class="s1">dashes=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">'single_point'</span><span class="s0">, </span><span class="s3">'single_point'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_single_point():</span>
    <span class="s2"># Issue #1796: don't let lines.marker affect the grid</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'lines.marker'</span><span class="s1">] = </span><span class="s3">'o'</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'axes.grid'</span><span class="s1">] = </span><span class="s0">True</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax1.plot([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">ax2.plot([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'o'</span><span class="s1">)</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">'a'</span><span class="s1">: [</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: [</span><span class="s4">1</span><span class="s1">]}</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax1.plot(</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">ax2.plot(</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">data=data)</span>


<span class="s1">@image_comparison([</span><span class="s3">'single_date.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_single_date():</span>

    <span class="s2"># use former defaults to match existing baseline image</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'axes.formatter.limits'</span><span class="s1">] = -</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span>
    <span class="s1">dt = mdates.date2num(np.datetime64(</span><span class="s3">'0000-12-31'</span><span class="s1">))</span>

    <span class="s1">time1 = [</span><span class="s4">721964.0</span><span class="s1">]</span>
    <span class="s1">data1 = [-</span><span class="s4">65.54</span><span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s4">0</span><span class="s1">].plot_date(time1 + dt</span><span class="s0">, </span><span class="s1">data1</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'r'</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s4">1</span><span class="s1">].plot(time1</span><span class="s0">, </span><span class="s1">data1</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'r'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_shaped_data(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">row = np.arange(</span><span class="s4">10</span><span class="s1">).reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">col = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">10</span><span class="s1">).reshape((-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>

    <span class="s1">axs = fig_test.subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].plot(row)  </span><span class="s2"># Actually plots nothing (columns are single points).</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].plot(col)  </span><span class="s2"># Same as plotting 1d.</span>

    <span class="s1">axs = fig_ref.subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s2"># xlim from the implicit &quot;x=0&quot;, ylim from the row datalim.</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].set(xlim=(-</span><span class="s4">.06</span><span class="s0">, </span><span class="s4">.06</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">9</span><span class="s1">))</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].plot(col.ravel())</span>


<span class="s0">def </span><span class="s1">test_structured_data():</span>
    <span class="s2"># support for structured data</span>
    <span class="s1">pts = np.array([(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">dtype=[(</span><span class="s3">&quot;ones&quot;</span><span class="s0">, </span><span class="s1">float)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">&quot;twos&quot;</span><span class="s0">, </span><span class="s1">float)])</span>

    <span class="s2"># this should not read second name as a format and raise ValueError</span>
    <span class="s1">axs = plt.figure().subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].plot(</span><span class="s3">&quot;ones&quot;</span><span class="s0">, </span><span class="s3">&quot;twos&quot;</span><span class="s0">, </span><span class="s1">data=pts)</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].plot(</span><span class="s3">&quot;ones&quot;</span><span class="s0">, </span><span class="s3">&quot;twos&quot;</span><span class="s0">, </span><span class="s3">&quot;r&quot;</span><span class="s0">, </span><span class="s1">data=pts)</span>


<span class="s1">@image_comparison([</span><span class="s3">'aitoff_proj'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_aitoff_proj():</span>
    <span class="s5">&quot;&quot;&quot; 
    Test aitoff projection ref.: 
    https://github.com/matplotlib/matplotlib/pull/14451 
    &quot;&quot;&quot;</span>
    <span class="s1">x = np.linspace(-np.pi</span><span class="s0">, </span><span class="s1">np.pi</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">y = np.linspace(-np.pi / </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.pi / </span><span class="s4">2</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s4">8</span><span class="s0">, </span><span class="s4">4.2</span><span class="s1">)</span><span class="s0">,</span>
                           <span class="s1">subplot_kw=dict(projection=</span><span class="s3">&quot;aitoff&quot;</span><span class="s1">))</span>
    <span class="s1">ax.grid()</span>
    <span class="s1">ax.plot(X.flat</span><span class="s0">, </span><span class="s1">Y.flat</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">markersize=</span><span class="s4">4</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'axvspan_epoch'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_axvspan_epoch():</span>
    <span class="s0">import </span><span class="s1">matplotlib.testing.jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units.register()</span>

    <span class="s2"># generate some data</span>
    <span class="s1">t0 = units.Epoch(</span><span class="s3">&quot;ET&quot;</span><span class="s0">, </span><span class="s1">dt=datetime.datetime(</span><span class="s4">2009</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">20</span><span class="s1">))</span>
    <span class="s1">tf = units.Epoch(</span><span class="s3">&quot;ET&quot;</span><span class="s0">, </span><span class="s1">dt=datetime.datetime(</span><span class="s4">2009</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">21</span><span class="s1">))</span>
    <span class="s1">dt = units.Duration(</span><span class="s3">&quot;ET&quot;</span><span class="s0">, </span><span class="s1">units.day.convert(</span><span class="s3">&quot;sec&quot;</span><span class="s1">))</span>

    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.axvspan(t0</span><span class="s0">, </span><span class="s1">tf</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;blue&quot;</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.25</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(t0 - </span><span class="s4">5.0</span><span class="s1">*dt</span><span class="s0">, </span><span class="s1">tf + </span><span class="s4">5.0</span><span class="s1">*dt)</span>


<span class="s1">@image_comparison([</span><span class="s3">'axhspan_epoch'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s4">0.02</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axhspan_epoch():</span>
    <span class="s0">import </span><span class="s1">matplotlib.testing.jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units.register()</span>

    <span class="s2"># generate some data</span>
    <span class="s1">t0 = units.Epoch(</span><span class="s3">&quot;ET&quot;</span><span class="s0">, </span><span class="s1">dt=datetime.datetime(</span><span class="s4">2009</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">20</span><span class="s1">))</span>
    <span class="s1">tf = units.Epoch(</span><span class="s3">&quot;ET&quot;</span><span class="s0">, </span><span class="s1">dt=datetime.datetime(</span><span class="s4">2009</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">21</span><span class="s1">))</span>
    <span class="s1">dt = units.Duration(</span><span class="s3">&quot;ET&quot;</span><span class="s0">, </span><span class="s1">units.day.convert(</span><span class="s3">&quot;sec&quot;</span><span class="s1">))</span>

    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.axhspan(t0</span><span class="s0">, </span><span class="s1">tf</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;blue&quot;</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.25</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(t0 - </span><span class="s4">5.0</span><span class="s1">*dt</span><span class="s0">, </span><span class="s1">tf + </span><span class="s4">5.0</span><span class="s1">*dt)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hexbin_extent.png'</span><span class="s0">, </span><span class="s3">'hexbin_extent.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hexbin_extent():</span>
    <span class="s2"># this test exposes sf bug 2856228</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">data = (np.arange(</span><span class="s4">2000</span><span class="s1">) / </span><span class="s4">2000</span><span class="s1">).reshape((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1000</span><span class="s1">))</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = data</span>

    <span class="s1">ax.hexbin(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">extent=[</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.6</span><span class="s0">, </span><span class="s4">.7</span><span class="s1">])</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;x&quot;</span><span class="s1">: x</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">: y}</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hexbin(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s1">extent=[</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.6</span><span class="s0">, </span><span class="s4">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data=data)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hexbin_empty.png'</span><span class="s0">, </span><span class="s3">'hexbin_empty.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hexbin_empty():</span>
    <span class="s2"># From #3886: creating hexbin from empty dataset raises ValueError</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hexbin([]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2"># From #23922: creating hexbin with log scaling from empty</span>
    <span class="s2"># dataset raises ValueError</span>
    <span class="s1">ax.hexbin([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">bins=</span><span class="s3">'log'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hexbin_pickable():</span>
    <span class="s2"># From #1973: Test that picking a hexbin collection works</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">data = (np.arange(</span><span class="s4">200</span><span class="s1">) / </span><span class="s4">200</span><span class="s1">).reshape((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">100</span><span class="s1">))</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = data</span>
    <span class="s1">hb = ax.hexbin(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">extent=[</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.6</span><span class="s0">, </span><span class="s4">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">picker=-</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">mouse_event = SimpleNamespace(x=</span><span class="s4">400</span><span class="s0">, </span><span class="s1">y=</span><span class="s4">300</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">hb.contains(mouse_event)[</span><span class="s4">0</span><span class="s1">]</span>


<span class="s1">@image_comparison([</span><span class="s3">'hexbin_log.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hexbin_log():</span>
    <span class="s2"># Issue #1636 (and also test log scaled colorbar)</span>

    <span class="s2"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">n = </span><span class="s4">100000</span>
    <span class="s1">x = np.random.standard_normal(n)</span>
    <span class="s1">y = </span><span class="s4">2.0 </span><span class="s1">+ </span><span class="s4">3.0 </span><span class="s1">* x + </span><span class="s4">4.0 </span><span class="s1">* np.random.standard_normal(n)</span>
    <span class="s1">y = np.power(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">y * </span><span class="s4">0.5</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">h = ax.hexbin(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yscale=</span><span class="s3">'log'</span><span class="s0">, </span><span class="s1">bins=</span><span class="s3">'log'</span><span class="s0">,</span>
                  <span class="s1">marginals=</span><span class="s0">True, </span><span class="s1">reduce_C_function=np.sum)</span>
    <span class="s1">plt.colorbar(h)</span>


<span class="s1">@image_comparison([</span><span class="s3">&quot;hexbin_linear.png&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">&quot;mpl20&quot;</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hexbin_linear():</span>
    <span class="s2"># Issue #21165</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">n = </span><span class="s4">100000</span>
    <span class="s1">x = np.random.standard_normal(n)</span>
    <span class="s1">y = </span><span class="s4">2.0 </span><span class="s1">+ </span><span class="s4">3.0 </span><span class="s1">* x + </span><span class="s4">4.0 </span><span class="s1">* np.random.standard_normal(n)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hexbin(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">gridsize=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">marginals=</span><span class="s0">True,</span>
              <span class="s1">reduce_C_function=np.sum)</span>


<span class="s0">def </span><span class="s1">test_hexbin_log_clim():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.arange(</span><span class="s4">200</span><span class="s1">).reshape((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">100</span><span class="s1">))</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">h = ax.hexbin(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">bins=</span><span class="s3">'log'</span><span class="s0">, </span><span class="s1">vmin=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s4">100</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">h.get_clim() == (</span><span class="s4">2</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_inverted_limits():</span>
    <span class="s2"># Test gh:1553</span>
    <span class="s2"># Calling invert_xaxis prior to plotting should not disable autoscaling</span>
    <span class="s2"># while still maintaining the inverted direction</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.invert_xaxis()</span>
    <span class="s1">ax.plot([-</span><span class="s4">5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>

    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">4</span><span class="s0">, </span><span class="s1">-</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">plt.close()</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.invert_yaxis()</span>
    <span class="s1">ax.plot([-</span><span class="s4">5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>

    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (-</span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (</span><span class="s4">5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">)</span>

    <span class="s2"># Test inverting nonlinear axes.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_yscale(</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (</span><span class="s4">10</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'nonfinite_limits'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_nonfinite_limits():</span>
    <span class="s1">x = np.arange(</span><span class="s4">0.</span><span class="s0">, </span><span class="s1">np.e</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">)</span>
    <span class="s2"># silence divide by zero warning from log(0)</span>
    <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s3">'ignore'</span><span class="s1">):</span>
        <span class="s1">y = np.log(x)</span>
    <span class="s1">x[len(x)//</span><span class="s4">2</span><span class="s1">] = np.nan</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'plot_fun'</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s3">'scatter'</span><span class="s0">, </span><span class="s3">'plot'</span><span class="s0">, </span><span class="s3">'fill_between'</span><span class="s1">])</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_limits_empty_data(plot_fun</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># Check that plotting empty data doesn't change autoscaling of dates</span>
    <span class="s1">x = np.arange(</span><span class="s3">&quot;2010-01-01&quot;</span><span class="s0">, </span><span class="s3">&quot;2011-01-01&quot;</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;datetime64[D]&quot;</span><span class="s1">)</span>

    <span class="s1">ax_test = fig_test.subplots()</span>
    <span class="s1">ax_ref = fig_ref.subplots()</span>

    <span class="s1">getattr(ax_test</span><span class="s0">, </span><span class="s1">plot_fun)([]</span><span class="s0">, </span><span class="s1">[])</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">[ax_test</span><span class="s0">, </span><span class="s1">ax_ref]:</span>
        <span class="s1">getattr(ax</span><span class="s0">, </span><span class="s1">plot_fun)(x</span><span class="s0">, </span><span class="s1">range(len(x))</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C0'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'imshow'</span><span class="s0">, </span><span class="s3">'imshow'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_imshow():</span>
    <span class="s2"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'image.interpolation'</span><span class="s1">] = </span><span class="s3">'nearest'</span>
    <span class="s2"># Create a NxN image</span>
    <span class="s1">N = </span><span class="s4">100</span>
    <span class="s1">(x</span><span class="s0">, </span><span class="s1">y) = np.indices((N</span><span class="s0">, </span><span class="s1">N))</span>
    <span class="s1">x -= N//</span><span class="s4">2</span>
    <span class="s1">y -= N//</span><span class="s4">2</span>
    <span class="s1">r = np.sqrt(x**</span><span class="s4">2</span><span class="s1">+y**</span><span class="s4">2</span><span class="s1">-x*y)</span>

    <span class="s2"># Create a contour plot at N/4 and extract both the clip path and transform</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.imshow(r)</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;r&quot;</span><span class="s1">: r}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.imshow(</span><span class="s3">&quot;r&quot;</span><span class="s0">, </span><span class="s1">data=data)</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s3">'imshow_clip'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">,</span>
    <span class="s1">tol=</span><span class="s4">1.24 </span><span class="s0">if </span><span class="s1">platform.machine() </span><span class="s0">in </span><span class="s1">(</span><span class="s3">'aarch64'</span><span class="s0">, </span><span class="s3">'ppc64le'</span><span class="s0">, </span><span class="s3">'s390x'</span><span class="s1">) </span><span class="s0">else </span><span class="s4">0</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_imshow_clip():</span>
    <span class="s2"># As originally reported by Gellule Xg &lt;gellule.xg@free.fr&gt;</span>
    <span class="s2"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'image.interpolation'</span><span class="s1">] = </span><span class="s3">'nearest'</span>

    <span class="s2"># Create a NxN image</span>
    <span class="s1">N = </span><span class="s4">100</span>
    <span class="s1">(x</span><span class="s0">, </span><span class="s1">y) = np.indices((N</span><span class="s0">, </span><span class="s1">N))</span>
    <span class="s1">x -= N//</span><span class="s4">2</span>
    <span class="s1">y -= N//</span><span class="s4">2</span>
    <span class="s1">r = np.sqrt(x**</span><span class="s4">2</span><span class="s1">+y**</span><span class="s4">2</span><span class="s1">-x*y)</span>

    <span class="s2"># Create a contour plot at N/4 and extract both the clip path and transform</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">c = ax.contour(r</span><span class="s0">, </span><span class="s1">[N/</span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">x = c.collections[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">clip_path = x.get_paths()[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">clip_transform = x.get_transform()</span>

    <span class="s1">clip_path = mtransforms.TransformedPath(clip_path</span><span class="s0">, </span><span class="s1">clip_transform)</span>

    <span class="s2"># Plot the image clipped by the contour</span>
    <span class="s1">ax.imshow(r</span><span class="s0">, </span><span class="s1">clip_path=clip_path)</span>


<span class="s0">def </span><span class="s1">test_imshow_norm_vminvmax():</span>
    <span class="s5">&quot;&quot;&quot;Parameters vmin, vmax should error if norm is given.&quot;&quot;&quot;</span>
    <span class="s1">a = [[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]]</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;Passing a Normalize instance simultaneously &quot;</span>
                             <span class="s3">&quot;with vmin/vmax is not supported.&quot;</span><span class="s1">):</span>
        <span class="s1">ax.imshow(a</span><span class="s0">, </span><span class="s1">norm=mcolors.Normalize(-</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vmin=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s4">5</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'polycollection_joinstyle'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_polycollection_joinstyle():</span>
    <span class="s2"># Bug #2890979 reported by Matthew West</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">verts = np.array([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])</span>
    <span class="s1">c = mpl.collections.PolyCollection([verts]</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s4">40</span><span class="s1">)</span>
    <span class="s1">ax.add_collection(c)</span>
    <span class="s1">ax.set_xbound(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">ax.set_ybound(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">'x, y1, y2'</span><span class="s0">, </span><span class="s1">[</span>
        <span class="s1">(np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(np.arange(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(np.arange(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">)</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)))</span>
    <span class="s1">]</span><span class="s0">, </span><span class="s1">ids=[</span>
        <span class="s3">'2d_x_input'</span><span class="s0">,</span>
        <span class="s3">'2d_y1_input'</span><span class="s0">,</span>
        <span class="s3">'2d_y2_input'</span>
    <span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fill_between_input(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.fill_between(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">'y, x1, x2'</span><span class="s0">, </span><span class="s1">[</span>
        <span class="s1">(np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(np.arange(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(np.arange(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">)</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)))</span>
    <span class="s1">]</span><span class="s0">, </span><span class="s1">ids=[</span>
        <span class="s3">'2d_y_input'</span><span class="s0">,</span>
        <span class="s3">'2d_x1_input'</span><span class="s0">,</span>
        <span class="s3">'2d_x2_input'</span>
    <span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fill_betweenx_input(y</span><span class="s0">, </span><span class="s1">x1</span><span class="s0">, </span><span class="s1">x2):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.fill_betweenx(y</span><span class="s0">, </span><span class="s1">x1</span><span class="s0">, </span><span class="s1">x2)</span>


<span class="s1">@image_comparison([</span><span class="s3">'fill_between_interpolate'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fill_between_interpolate():</span>
    <span class="s1">x = np.arange(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">)</span>
    <span class="s1">y1 = np.sin(</span><span class="s4">2</span><span class="s1">*np.pi*x)</span>
    <span class="s1">y2 = </span><span class="s4">1.2</span><span class="s1">*np.sin(</span><span class="s4">4</span><span class="s1">*np.pi*x)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax1.plot(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'black'</span><span class="s1">)</span>
    <span class="s1">ax1.fill_between(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">where=y2 &gt;= y1</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'white'</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s3">'/'</span><span class="s0">,</span>
                     <span class="s1">interpolate=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax1.fill_between(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">where=y2 &lt;= y1</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'red'</span><span class="s0">,</span>
                     <span class="s1">interpolate=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s2"># Test support for masked arrays.</span>
    <span class="s1">y2 = np.ma.masked_greater(y2</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)</span>
    <span class="s2"># Test that plotting works for masked arrays with the first element masked</span>
    <span class="s1">y2[</span><span class="s4">0</span><span class="s1">] = np.ma.masked</span>
    <span class="s1">ax2.plot(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'black'</span><span class="s1">)</span>
    <span class="s1">ax2.fill_between(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">where=y2 &gt;= y1</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'green'</span><span class="s0">,</span>
                     <span class="s1">interpolate=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax2.fill_between(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">where=y2 &lt;= y1</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'red'</span><span class="s0">,</span>
                     <span class="s1">interpolate=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'fill_between_interpolate_decreasing'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fill_between_interpolate_decreasing():</span>
    <span class="s1">p = np.array([</span><span class="s4">724.3</span><span class="s0">, </span><span class="s4">700</span><span class="s0">, </span><span class="s4">655</span><span class="s1">])</span>
    <span class="s1">t = np.array([</span><span class="s4">9.4</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">2.2</span><span class="s1">])</span>
    <span class="s1">prof = np.array([</span><span class="s4">7.9</span><span class="s0">, </span><span class="s4">6.6</span><span class="s0">, </span><span class="s4">3.8</span><span class="s1">])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s4">9</span><span class="s0">, </span><span class="s4">9</span><span class="s1">))</span>

    <span class="s1">ax.plot(t</span><span class="s0">, </span><span class="s1">p</span><span class="s0">, </span><span class="s3">'tab:red'</span><span class="s1">)</span>
    <span class="s1">ax.plot(prof</span><span class="s0">, </span><span class="s1">p</span><span class="s0">, </span><span class="s3">'k'</span><span class="s1">)</span>

    <span class="s1">ax.fill_betweenx(p</span><span class="s0">, </span><span class="s1">t</span><span class="s0">, </span><span class="s1">prof</span><span class="s0">, </span><span class="s1">where=prof &lt; t</span><span class="s0">,</span>
                     <span class="s1">facecolor=</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s1">interpolate=</span><span class="s0">True, </span><span class="s1">alpha=</span><span class="s4">0.4</span><span class="s1">)</span>
    <span class="s1">ax.fill_betweenx(p</span><span class="s0">, </span><span class="s1">t</span><span class="s0">, </span><span class="s1">prof</span><span class="s0">, </span><span class="s1">where=prof &gt; t</span><span class="s0">,</span>
                     <span class="s1">facecolor=</span><span class="s3">'red'</span><span class="s0">, </span><span class="s1">interpolate=</span><span class="s0">True, </span><span class="s1">alpha=</span><span class="s4">0.4</span><span class="s1">)</span>

    <span class="s1">ax.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">30</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(</span><span class="s4">800</span><span class="s0">, </span><span class="s4">600</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'fill_between_interpolate_nan'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fill_between_interpolate_nan():</span>
    <span class="s2"># Tests fix for issue #18986.</span>
    <span class="s1">x = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y1 = np.asarray([</span><span class="s4">8</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s4">24</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">18</span><span class="s1">])</span>
    <span class="s1">y2 = np.asarray([</span><span class="s4">18</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s4">26</span><span class="s0">, </span><span class="s4">32</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'b'</span><span class="s1">)</span>
    <span class="s1">ax.fill_between(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">where=y2 &gt;= y1</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;green&quot;</span><span class="s0">,</span>
                    <span class="s1">interpolate=</span><span class="s0">True, </span><span class="s1">alpha=</span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">ax.fill_between(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">where=y1 &gt;= y2</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;red&quot;</span><span class="s0">,</span>
                    <span class="s1">interpolate=</span><span class="s0">True, </span><span class="s1">alpha=</span><span class="s4">0.5</span><span class="s1">)</span>


<span class="s2"># test_symlog and test_symlog2 used to have baseline images in all three</span>
<span class="s2"># formats, but the png and svg baselines got invalidated by the removal of</span>
<span class="s2"># minor tick overstriking.</span>
<span class="s1">@image_comparison([</span><span class="s3">'symlog.pdf'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_symlog():</span>
    <span class="s1">x = np.array([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s4">24</span><span class="s1">])</span>
    <span class="s1">y = np.array([</span><span class="s4">1000000</span><span class="s0">, </span><span class="s4">500000</span><span class="s0">, </span><span class="s4">100000</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">ax.set_yscale(</span><span class="s3">'symlog'</span><span class="s1">)</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">'linear'</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10000000</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'symlog2.pdf'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_symlog2():</span>
    <span class="s2"># Numbers from -50 to 50, with 0.1 as step</span>
    <span class="s1">x = np.arange(-</span><span class="s4">50</span><span class="s0">, </span><span class="s4">50</span><span class="s0">, </span><span class="s4">0.001</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">linthresh </span><span class="s0">in </span><span class="s1">zip(axs</span><span class="s0">, </span><span class="s1">[</span><span class="s4">20.</span><span class="s0">, </span><span class="s4">2.</span><span class="s0">, </span><span class="s4">1.</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]):</span>
        <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s1">ax.set_xscale(</span><span class="s3">'symlog'</span><span class="s0">, </span><span class="s1">linthresh=linthresh)</span>
        <span class="s1">ax.grid(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">axs[-</span><span class="s4">1</span><span class="s1">].set_ylim(-</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_pcolorargs_5205():</span>
    <span class="s2"># Smoketest to catch issue found in gh:5205</span>
    <span class="s1">x = [-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span>
    <span class="s1">y = [-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.25</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.75</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.25</span><span class="s0">, </span><span class="s4">0</span><span class="s0">,</span>
         <span class="s4">0.25</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.75</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.25</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z = np.hypot(X</span><span class="s0">, </span><span class="s1">Y)</span>

    <span class="s1">plt.pcolor(Z)</span>
    <span class="s1">plt.pcolor(list(Z))</span>
    <span class="s1">plt.pcolor(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">plt.pcolor(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">list(Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]))</span>


<span class="s1">@image_comparison([</span><span class="s3">'pcolormesh'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pcolormesh():</span>
    <span class="s2"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">n = </span><span class="s4">12</span>
    <span class="s1">x = np.linspace(-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">n)</span>
    <span class="s1">y = np.linspace(-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">n*</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Qx = np.cos(Y) - np.cos(X)</span>
    <span class="s1">Qz = np.sin(Y) + np.sin(X)</span>
    <span class="s1">Qx = (Qx + </span><span class="s4">1.1</span><span class="s1">)</span>
    <span class="s1">Z = np.hypot(X</span><span class="s0">, </span><span class="s1">Y) / </span><span class="s4">5</span>
    <span class="s1">Z = (Z - Z.min()) / Z.ptp()</span>

    <span class="s2"># The color array can include masked values:</span>
    <span class="s1">Zm = ma.masked_where(np.abs(Qz) &lt; </span><span class="s4">0.5 </span><span class="s1">* np.max(Qz)</span><span class="s0">, </span><span class="s1">Z)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2</span><span class="s0">, </span><span class="s1">ax3) = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">ax1.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qz</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">edgecolors=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">ax2.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qz</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">edgecolors=[</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'w'</span><span class="s1">])</span>
    <span class="s1">ax3.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qz</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">&quot;gouraud&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pcolormesh_small'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extensions=[</span><span class="s3">&quot;eps&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_pcolormesh_small():</span>
    <span class="s1">n = </span><span class="s4">3</span>
    <span class="s1">x = np.linspace(-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">n)</span>
    <span class="s1">y = np.linspace(-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">n*</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Qx = np.cos(Y) - np.cos(X)</span>
    <span class="s1">Qz = np.sin(Y) + np.sin(X)</span>
    <span class="s1">Qx = (Qx + </span><span class="s4">1.1</span><span class="s1">)</span>
    <span class="s1">Z = np.hypot(X</span><span class="s0">, </span><span class="s1">Y) / </span><span class="s4">5</span>
    <span class="s1">Z = (Z - Z.min()) / Z.ptp()</span>
    <span class="s1">Zm = ma.masked_where(np.abs(Qz) &lt; </span><span class="s4">0.5 </span><span class="s1">* np.max(Qz)</span><span class="s0">, </span><span class="s1">Z)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2</span><span class="s0">, </span><span class="s1">ax3) = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">ax1.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qz</span><span class="s0">, </span><span class="s1">Zm[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">edgecolors=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">ax2.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qz</span><span class="s0">, </span><span class="s1">Zm[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">edgecolors=[</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'w'</span><span class="s1">])</span>
    <span class="s1">ax3.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qz</span><span class="s0">, </span><span class="s1">Zm</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">&quot;gouraud&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig.axes:</span>
        <span class="s1">ax.set_axis_off()</span>


<span class="s1">@image_comparison([</span><span class="s3">'pcolormesh_alpha'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s0">, </span><span class="s3">&quot;pdf&quot;</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pcolormesh_alpha():</span>
    <span class="s2"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">n = </span><span class="s4">12</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(</span>
        <span class="s1">np.linspace(-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">n)</span><span class="s0">,</span>
        <span class="s1">np.linspace(-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">n*</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">)</span>
    <span class="s1">Qx = X</span>
    <span class="s1">Qy = Y + np.sin(X)</span>
    <span class="s1">Z = np.hypot(X</span><span class="s0">, </span><span class="s1">Y) / </span><span class="s4">5</span>
    <span class="s1">Z = (Z - Z.min()) / Z.ptp()</span>
    <span class="s1">vir = mpl.colormaps[</span><span class="s3">&quot;viridis&quot;</span><span class="s1">].resampled(</span><span class="s4">16</span><span class="s1">)</span>
    <span class="s2"># make another colormap with varying alpha</span>
    <span class="s1">colors = vir(np.arange(</span><span class="s4">16</span><span class="s1">))</span>
    <span class="s1">colors[:</span><span class="s0">, </span><span class="s4">3</span><span class="s1">] = </span><span class="s4">0.5 </span><span class="s1">+ </span><span class="s4">0.5</span><span class="s1">*np.sin(np.arange(</span><span class="s4">16</span><span class="s1">))</span>
    <span class="s1">cmap = mcolors.ListedColormap(colors)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">((ax1</span><span class="s0">, </span><span class="s1">ax2)</span><span class="s0">, </span><span class="s1">(ax3</span><span class="s0">, </span><span class="s1">ax4)) = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">ax1</span><span class="s0">, </span><span class="s1">ax2</span><span class="s0">, </span><span class="s1">ax3</span><span class="s0">, </span><span class="s1">ax4:</span>
        <span class="s1">ax.add_patch(mpatches.Rectangle(</span>
            <span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1.5</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">facecolor=[</span><span class="s4">.7</span><span class="s0">, </span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">0</span>
        <span class="s1">))</span>
    <span class="s2"># ax1, ax2: constant alpha</span>
    <span class="s1">ax1.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qy</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">cmap=vir</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.4</span><span class="s0">,</span>
                   <span class="s1">shading=</span><span class="s3">'flat'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax2.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qy</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">cmap=vir</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.4</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'gouraud'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s2"># ax3, ax4: alpha from colormap</span>
    <span class="s1">ax3.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qy</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'flat'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax4.pcolormesh(Qx</span><span class="s0">, </span><span class="s1">Qy</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'gouraud'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;dims,alpha&quot;</span><span class="s0">, </span><span class="s1">[(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)])</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_pcolormesh_rgba(fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">dims</span><span class="s0">, </span><span class="s1">alpha):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">c = np.ones((</span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s1">dims)</span><span class="s0">, </span><span class="s1">dtype=float) / </span><span class="s4">2</span>
    <span class="s1">ax.pcolormesh(c)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.pcolormesh(c[...</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s3">&quot;gray&quot;</span><span class="s0">, </span><span class="s1">vmin=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">alpha=alpha)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pcolormesh_datetime_axis.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pcolormesh_datetime_axis():</span>
    <span class="s2"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.subplots_adjust(hspace=</span><span class="s4">0.4</span><span class="s0">, </span><span class="s1">top=</span><span class="s4">0.98</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s4">.15</span><span class="s1">)</span>
    <span class="s1">base = datetime.datetime(</span><span class="s4">2013</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">x = np.array([base + datetime.timedelta(days=d) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">21</span><span class="s1">)])</span>
    <span class="s1">y = np.arange(</span><span class="s4">21</span><span class="s1">)</span>
    <span class="s1">z1</span><span class="s0">, </span><span class="s1">z2 = np.meshgrid(np.arange(</span><span class="s4">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">20</span><span class="s1">))</span>
    <span class="s1">z = z1 * z2</span>
    <span class="s1">plt.subplot(</span><span class="s4">221</span><span class="s1">)</span>
    <span class="s1">plt.pcolormesh(x[:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">plt.subplot(</span><span class="s4">222</span><span class="s1">)</span>
    <span class="s1">plt.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">x = np.repeat(x[np.newaxis]</span><span class="s0">, </span><span class="s4">21</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">y = np.repeat(y[:</span><span class="s0">, </span><span class="s1">np.newaxis]</span><span class="s0">, </span><span class="s4">21</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">plt.subplot(</span><span class="s4">223</span><span class="s1">)</span>
    <span class="s1">plt.pcolormesh(x[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">plt.subplot(</span><span class="s4">224</span><span class="s1">)</span>
    <span class="s1">plt.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig.get_axes():</span>
        <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">ax.get_xticklabels():</span>
            <span class="s1">label.set_ha(</span><span class="s3">'right'</span><span class="s1">)</span>
            <span class="s1">label.set_rotation(</span><span class="s4">30</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pcolor_datetime_axis.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pcolor_datetime_axis():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.subplots_adjust(hspace=</span><span class="s4">0.4</span><span class="s0">, </span><span class="s1">top=</span><span class="s4">0.98</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s4">.15</span><span class="s1">)</span>
    <span class="s1">base = datetime.datetime(</span><span class="s4">2013</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">x = np.array([base + datetime.timedelta(days=d) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">21</span><span class="s1">)])</span>
    <span class="s1">y = np.arange(</span><span class="s4">21</span><span class="s1">)</span>
    <span class="s1">z1</span><span class="s0">, </span><span class="s1">z2 = np.meshgrid(np.arange(</span><span class="s4">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">20</span><span class="s1">))</span>
    <span class="s1">z = z1 * z2</span>
    <span class="s1">plt.subplot(</span><span class="s4">221</span><span class="s1">)</span>
    <span class="s1">plt.pcolor(x[:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">plt.subplot(</span><span class="s4">222</span><span class="s1">)</span>
    <span class="s1">plt.pcolor(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">x = np.repeat(x[np.newaxis]</span><span class="s0">, </span><span class="s4">21</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">y = np.repeat(y[:</span><span class="s0">, </span><span class="s1">np.newaxis]</span><span class="s0">, </span><span class="s4">21</span><span class="s0">, </span><span class="s1">axis=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">plt.subplot(</span><span class="s4">223</span><span class="s1">)</span>
    <span class="s1">plt.pcolor(x[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">plt.subplot(</span><span class="s4">224</span><span class="s1">)</span>
    <span class="s1">plt.pcolor(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig.get_axes():</span>
        <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">ax.get_xticklabels():</span>
            <span class="s1">label.set_ha(</span><span class="s3">'right'</span><span class="s1">)</span>
            <span class="s1">label.set_rotation(</span><span class="s4">30</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_pcolorargs():</span>
    <span class="s1">n = </span><span class="s4">12</span>
    <span class="s1">x = np.linspace(-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">n)</span>
    <span class="s1">y = np.linspace(-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">n*</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z = np.hypot(X</span><span class="s0">, </span><span class="s1">Y) / </span><span class="s4">5</span>

    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ax.pcolormesh(y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">Z)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ax.pcolormesh(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z.T)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">&quot;gouraud&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ax.pcolormesh(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">&quot;gouraud&quot;</span><span class="s1">)</span>
    <span class="s1">x[</span><span class="s4">0</span><span class="s1">] = np.NaN</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">np.errstate(invalid=</span><span class="s3">'ignore'</span><span class="s1">):</span>
        <span class="s1">x = np.ma.array(x</span><span class="s0">, </span><span class="s1">mask=(x &lt; </span><span class="s4">0</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s2"># Expect a warning with non-increasing coordinates</span>
    <span class="s1">x = [</span><span class="s4">359</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">y = [-</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z = np.zeros(X.shape)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s3">'are not monotonically increasing or decreasing'</span><span class="s1">):</span>
        <span class="s1">ax.pcolormesh(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'auto'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_pcolornearest(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">Z = np.random.randn(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span>
    <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'flat'</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s2"># specify the centers</span>
    <span class="s1">x2 = x[:-</span><span class="s4">1</span><span class="s1">] + np.diff(x) / </span><span class="s4">2</span>
    <span class="s1">y2 = y[:-</span><span class="s4">1</span><span class="s1">] + np.diff(y) / </span><span class="s4">2</span>
    <span class="s1">ax.pcolormesh(x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'nearest'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_pcolornearestunits(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">x = [datetime.datetime.fromtimestamp(x * </span><span class="s4">3600</span><span class="s1">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)]</span>
    <span class="s1">y = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">Z = np.random.randn(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span>
    <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'flat'</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s2"># specify the centers</span>
    <span class="s1">x2 = [datetime.datetime.fromtimestamp((x + </span><span class="s4">0.5</span><span class="s1">) * </span><span class="s4">3600</span><span class="s1">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">9</span><span class="s1">)]</span>
    <span class="s1">y2 = y[:-</span><span class="s4">1</span><span class="s1">] + np.diff(y) / </span><span class="s4">2</span>
    <span class="s1">ax.pcolormesh(x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'nearest'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_pcolorflaterror():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">Z = np.random.randn(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'Dimensions of C'</span><span class="s1">):</span>
        <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'flat'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_samesizepcolorflaterror():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">3</span><span class="s1">))</span>
    <span class="s1">Z = x + y</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">r&quot;.*one smaller than X&quot;</span><span class="s1">):</span>
        <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">shading=</span><span class="s3">'flat'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'snap'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_pcolorauto(fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">snap):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">Z = np.random.randn(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span>
    <span class="s2"># this is the same as flat; note that auto is default</span>
    <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">snap=snap)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s2"># specify the centers</span>
    <span class="s1">x2 = x[:-</span><span class="s4">1</span><span class="s1">] + np.diff(x) / </span><span class="s4">2</span>
    <span class="s1">y2 = y[:-</span><span class="s4">1</span><span class="s1">] + np.diff(y) / </span><span class="s4">2</span>
    <span class="s2"># this is same as nearest:</span>
    <span class="s1">ax.pcolormesh(x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s1">snap=snap)</span>


<span class="s1">@image_comparison([</span><span class="s3">'canonical'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_canonical():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">'arc_angles.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_arc_angles():</span>
    <span class="s2"># Ellipse parameters</span>
    <span class="s1">w = </span><span class="s4">2</span>
    <span class="s1">h = </span><span class="s4">1</span>
    <span class="s1">centre = (</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">scale = </span><span class="s4">2</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">theta2 = i * </span><span class="s4">360 </span><span class="s1">/ </span><span class="s4">9</span>
        <span class="s1">theta1 = theta2 - </span><span class="s4">45</span>

        <span class="s1">ax.add_patch(mpatches.Ellipse(centre</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">h</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.3</span><span class="s1">))</span>
        <span class="s1">ax.add_patch(mpatches.Arc(centre</span><span class="s0">, </span><span class="s1">w</span><span class="s0">, </span><span class="s1">h</span><span class="s0">, </span><span class="s1">theta1=theta1</span><span class="s0">, </span><span class="s1">theta2=theta2))</span>
        <span class="s2"># Straight lines intersecting start and end of arc</span>
        <span class="s1">ax.plot([scale * np.cos(np.deg2rad(theta1)) + centre[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
                 <span class="s1">centre[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
                 <span class="s1">scale * np.cos(np.deg2rad(theta2)) + centre[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">,</span>
                <span class="s1">[scale * np.sin(np.deg2rad(theta1)) + centre[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                 <span class="s1">centre[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                 <span class="s1">scale * np.sin(np.deg2rad(theta2)) + centre[</span><span class="s4">1</span><span class="s1">]])</span>

        <span class="s1">ax.set_xlim(-scale</span><span class="s0">, </span><span class="s1">scale)</span>
        <span class="s1">ax.set_ylim(-scale</span><span class="s0">, </span><span class="s1">scale)</span>

        <span class="s2"># This looks the same, but it triggers a different code path when it</span>
        <span class="s2"># gets large enough.</span>
        <span class="s1">w *= </span><span class="s4">10</span>
        <span class="s1">h *= </span><span class="s4">10</span>
        <span class="s1">centre = (centre[</span><span class="s4">0</span><span class="s1">] * </span><span class="s4">10</span><span class="s0">, </span><span class="s1">centre[</span><span class="s4">1</span><span class="s1">] * </span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">scale *= </span><span class="s4">10</span>


<span class="s1">@image_comparison([</span><span class="s3">'arc_ellipse'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_arc_ellipse():</span>
    <span class="s1">xcenter</span><span class="s0">, </span><span class="s1">ycenter = </span><span class="s4">0.38</span><span class="s0">, </span><span class="s4">0.52</span>
    <span class="s1">width</span><span class="s0">, </span><span class="s1">height = </span><span class="s4">1e-1</span><span class="s0">, </span><span class="s4">3e-1</span>
    <span class="s1">angle = -</span><span class="s4">30</span>

    <span class="s1">theta = np.deg2rad(np.arange(</span><span class="s4">360</span><span class="s1">))</span>
    <span class="s1">x = width / </span><span class="s4">2. </span><span class="s1">* np.cos(theta)</span>
    <span class="s1">y = height / </span><span class="s4">2. </span><span class="s1">* np.sin(theta)</span>

    <span class="s1">rtheta = np.deg2rad(angle)</span>
    <span class="s1">R = np.array([</span>
        <span class="s1">[np.cos(rtheta)</span><span class="s0">, </span><span class="s1">-np.sin(rtheta)]</span><span class="s0">,</span>
        <span class="s1">[np.sin(rtheta)</span><span class="s0">, </span><span class="s1">np.cos(rtheta)]])</span>

    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.dot(R</span><span class="s0">, </span><span class="s1">[x</span><span class="s0">, </span><span class="s1">y])</span>
    <span class="s1">x += xcenter</span>
    <span class="s1">y += ycenter</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s4">211</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s3">'auto'</span><span class="s1">)</span>
    <span class="s1">ax.fill(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'yellow'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'yellow'</span><span class="s0">,</span>
            <span class="s1">linewidth=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s1">e1 = mpatches.Arc((xcenter</span><span class="s0">, </span><span class="s1">ycenter)</span><span class="s0">, </span><span class="s1">width</span><span class="s0">, </span><span class="s1">height</span><span class="s0">,</span>
                      <span class="s1">angle=angle</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">False, </span><span class="s1">zorder=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">ax.add_patch(e1)</span>

    <span class="s1">ax = fig.add_subplot(</span><span class="s4">212</span><span class="s0">, </span><span class="s1">aspect=</span><span class="s3">'equal'</span><span class="s1">)</span>
    <span class="s1">ax.fill(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'green'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'green'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">e2 = mpatches.Arc((xcenter</span><span class="s0">, </span><span class="s1">ycenter)</span><span class="s0">, </span><span class="s1">width</span><span class="s0">, </span><span class="s1">height</span><span class="s0">,</span>
                      <span class="s1">angle=angle</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">False, </span><span class="s1">zorder=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">ax.add_patch(e2)</span>


<span class="s0">def </span><span class="s1">test_marker_as_markerstyle():</span>
    <span class="s1">fix</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">m = mmarkers.MarkerStyle(</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=m)</span>
    <span class="s1">ax.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=m)</span>
    <span class="s1">ax.errorbar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=m)</span>


<span class="s1">@image_comparison([</span><span class="s3">'markevery'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_markevery():</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">y = np.sin(x) * np.sqrt(x/</span><span class="s4">10 </span><span class="s1">+ </span><span class="s4">0.5</span><span class="s1">)</span>

    <span class="s2"># check marker only plot</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'default'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'d'</span><span class="s0">, </span><span class="s1">markevery=</span><span class="s0">None, </span><span class="s1">label=</span><span class="s3">'mark all'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'s'</span><span class="s0">, </span><span class="s1">markevery=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'mark every 10'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'+'</span><span class="s0">, </span><span class="s1">markevery=(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'mark every 5 starting at 10'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>


<span class="s1">@image_comparison([</span><span class="s3">'markevery_line'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">tol=</span><span class="s4">0.005</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_markevery_line():</span>
    <span class="s2"># TODO: a slight change in rendering between Inkscape versions may explain</span>
    <span class="s2"># why one had to introduce a small non-zero tolerance for the SVG test</span>
    <span class="s2"># to pass. One may try to remove this hack once Travis' Inkscape version</span>
    <span class="s2"># is modern enough. FWIW, no failure with 0.92.3 on my computer (#11358).</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">y = np.sin(x) * np.sqrt(x/</span><span class="s4">10 </span><span class="s1">+ </span><span class="s4">0.5</span><span class="s1">)</span>

    <span class="s2"># check line/marker combos</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'-o'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'default'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'-d'</span><span class="s0">, </span><span class="s1">markevery=</span><span class="s0">None, </span><span class="s1">label=</span><span class="s3">'mark all'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'-s'</span><span class="s0">, </span><span class="s1">markevery=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'mark every 10'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'-+'</span><span class="s0">, </span><span class="s1">markevery=(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'mark every 5 starting at 10'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>


<span class="s1">@image_comparison([</span><span class="s3">'markevery_linear_scales'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">tol=</span><span class="s4">0.001</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_markevery_linear_scales():</span>
    <span class="s1">cases = [</span><span class="s0">None,</span>
             <span class="s4">8</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">30</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">16</span><span class="s0">, </span><span class="s4">24</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">slice(</span><span class="s4">100</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)]</span>

    <span class="s1">cols = </span><span class="s4">3</span>
    <span class="s1">gs = matplotlib.gridspec.GridSpec(len(cases) // cols + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">cols)</span>

    <span class="s1">delta = </span><span class="s4">0.11</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10 </span><span class="s1">- </span><span class="s4">2 </span><span class="s1">* delta</span><span class="s0">, </span><span class="s4">200</span><span class="s1">) + delta</span>
    <span class="s1">y = np.sin(x) + </span><span class="s4">1.0 </span><span class="s1">+ delta</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate(cases):</span>
        <span class="s1">row = (i // cols)</span>
        <span class="s1">col = i % cols</span>
        <span class="s1">plt.subplot(gs[row</span><span class="s0">, </span><span class="s1">col])</span>
        <span class="s1">plt.title(</span><span class="s3">'markevery=%s' </span><span class="s1">% str(case))</span>
        <span class="s1">plt.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'-'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">4</span><span class="s0">,  </span><span class="s1">markevery=case)</span>


<span class="s1">@image_comparison([</span><span class="s3">'markevery_linear_scales_zoomed'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_markevery_linear_scales_zoomed():</span>
    <span class="s1">cases = [</span><span class="s0">None,</span>
             <span class="s4">8</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">30</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">16</span><span class="s0">, </span><span class="s4">24</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">slice(</span><span class="s4">100</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)]</span>

    <span class="s1">cols = </span><span class="s4">3</span>
    <span class="s1">gs = matplotlib.gridspec.GridSpec(len(cases) // cols + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">cols)</span>

    <span class="s1">delta = </span><span class="s4">0.11</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10 </span><span class="s1">- </span><span class="s4">2 </span><span class="s1">* delta</span><span class="s0">, </span><span class="s4">200</span><span class="s1">) + delta</span>
    <span class="s1">y = np.sin(x) + </span><span class="s4">1.0 </span><span class="s1">+ delta</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate(cases):</span>
        <span class="s1">row = (i // cols)</span>
        <span class="s1">col = i % cols</span>
        <span class="s1">plt.subplot(gs[row</span><span class="s0">, </span><span class="s1">col])</span>
        <span class="s1">plt.title(</span><span class="s3">'markevery=%s' </span><span class="s1">% str(case))</span>
        <span class="s1">plt.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'-'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">4</span><span class="s0">,  </span><span class="s1">markevery=case)</span>
        <span class="s1">plt.xlim((</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6.7</span><span class="s1">))</span>
        <span class="s1">plt.ylim((</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">1.7</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'markevery_log_scales'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_markevery_log_scales():</span>
    <span class="s1">cases = [</span><span class="s0">None,</span>
             <span class="s4">8</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">30</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">16</span><span class="s0">, </span><span class="s4">24</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">slice(</span><span class="s4">100</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)]</span>

    <span class="s1">cols = </span><span class="s4">3</span>
    <span class="s1">gs = matplotlib.gridspec.GridSpec(len(cases) // cols + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">cols)</span>

    <span class="s1">delta = </span><span class="s4">0.11</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10 </span><span class="s1">- </span><span class="s4">2 </span><span class="s1">* delta</span><span class="s0">, </span><span class="s4">200</span><span class="s1">) + delta</span>
    <span class="s1">y = np.sin(x) + </span><span class="s4">1.0 </span><span class="s1">+ delta</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate(cases):</span>
        <span class="s1">row = (i // cols)</span>
        <span class="s1">col = i % cols</span>
        <span class="s1">plt.subplot(gs[row</span><span class="s0">, </span><span class="s1">col])</span>
        <span class="s1">plt.title(</span><span class="s3">'markevery=%s' </span><span class="s1">% str(case))</span>
        <span class="s1">plt.xscale(</span><span class="s3">'log'</span><span class="s1">)</span>
        <span class="s1">plt.yscale(</span><span class="s3">'log'</span><span class="s1">)</span>
        <span class="s1">plt.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'-'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">4</span><span class="s0">,  </span><span class="s1">markevery=case)</span>


<span class="s1">@image_comparison([</span><span class="s3">'markevery_polar'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_markevery_polar():</span>
    <span class="s1">cases = [</span><span class="s0">None,</span>
             <span class="s4">8</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">30</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">16</span><span class="s0">, </span><span class="s4">24</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">slice(</span><span class="s4">100</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)]</span>

    <span class="s1">cols = </span><span class="s4">3</span>
    <span class="s1">gs = matplotlib.gridspec.GridSpec(len(cases) // cols + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">cols)</span>

    <span class="s1">r = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">200</span><span class="s1">)</span>
    <span class="s1">theta = </span><span class="s4">2 </span><span class="s1">* np.pi * r</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate(cases):</span>
        <span class="s1">row = (i // cols)</span>
        <span class="s1">col = i % cols</span>
        <span class="s1">plt.subplot(gs[row</span><span class="s0">, </span><span class="s1">col]</span><span class="s0">, </span><span class="s1">polar=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">plt.title(</span><span class="s3">'markevery=%s' </span><span class="s1">% str(case))</span>
        <span class="s1">plt.plot(theta</span><span class="s0">, </span><span class="s1">r</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'-'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">4</span><span class="s0">,  </span><span class="s1">markevery=case)</span>


<span class="s1">@image_comparison([</span><span class="s3">'markevery_linear_scales_nans'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_markevery_linear_scales_nans():</span>
    <span class="s1">cases = [</span><span class="s0">None,</span>
             <span class="s4">8</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">30</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">16</span><span class="s0">, </span><span class="s4">24</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">slice(</span><span class="s4">100</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">,</span>
             <span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)]</span>

    <span class="s1">cols = </span><span class="s4">3</span>
    <span class="s1">gs = matplotlib.gridspec.GridSpec(len(cases) // cols + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">cols)</span>

    <span class="s1">delta = </span><span class="s4">0.11</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10 </span><span class="s1">- </span><span class="s4">2 </span><span class="s1">* delta</span><span class="s0">, </span><span class="s4">200</span><span class="s1">) + delta</span>
    <span class="s1">y = np.sin(x) + </span><span class="s4">1.0 </span><span class="s1">+ delta</span>
    <span class="s1">y[:</span><span class="s4">10</span><span class="s1">] = y[-</span><span class="s4">20</span><span class="s1">:] = y[</span><span class="s4">50</span><span class="s1">:</span><span class="s4">70</span><span class="s1">] = np.nan</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate(cases):</span>
        <span class="s1">row = (i // cols)</span>
        <span class="s1">col = i % cols</span>
        <span class="s1">plt.subplot(gs[row</span><span class="s0">, </span><span class="s1">col])</span>
        <span class="s1">plt.title(</span><span class="s3">'markevery=%s' </span><span class="s1">% str(case))</span>
        <span class="s1">plt.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'-'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">4</span><span class="s0">,  </span><span class="s1">markevery=case)</span>


<span class="s1">@image_comparison([</span><span class="s3">'marker_edges'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_marker_edges():</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">np.sin(x)</span><span class="s0">, </span><span class="s3">'y.'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">30.0</span><span class="s0">, </span><span class="s1">mew=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">mec=</span><span class="s3">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x+</span><span class="s4">0.1</span><span class="s0">, </span><span class="s1">np.sin(x)</span><span class="s0">, </span><span class="s3">'y.'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">30.0</span><span class="s0">, </span><span class="s1">mew=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">mec=</span><span class="s3">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(x+</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">np.sin(x)</span><span class="s0">, </span><span class="s3">'y.'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">30.0</span><span class="s0">, </span><span class="s1">mew=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">mec=</span><span class="s3">'b'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'bar_tick_label_single.png'</span><span class="s0">, </span><span class="s3">'bar_tick_label_single.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar_tick_label_single():</span>
    <span class="s2"># From 2516: plot bar with array of string labels for x axis</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.bar(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'edge'</span><span class="s0">, </span><span class="s1">tick_label=</span><span class="s3">'0'</span><span class="s1">)</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">0</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.bar(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'edge'</span><span class="s0">, </span><span class="s1">tick_label=</span><span class="s3">'0'</span><span class="s0">, </span><span class="s1">data=data)</span>


<span class="s0">def </span><span class="s1">test_nan_bar_values():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.bar([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_bar_ticklabel_fail():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.bar([]</span><span class="s0">, </span><span class="s1">[])</span>


<span class="s1">@image_comparison([</span><span class="s3">'bar_tick_label_multiple.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar_tick_label_multiple():</span>
    <span class="s2"># From 2516: plot bar with array of string labels for x axis</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">width=[</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tick_label=[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
           <span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'bar_tick_label_multiple_old_label_alignment.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar_tick_label_multiple_old_alignment():</span>
    <span class="s2"># Test that the alignment for class is backward compatible</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">&quot;ytick.alignment&quot;</span><span class="s1">] = </span><span class="s3">&quot;center&quot;</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">width=[</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tick_label=[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
           <span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar_decimal_center(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">x0 = [</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">8.4</span><span class="s0">, </span><span class="s4">5.3</span><span class="s0">, </span><span class="s4">4.2</span><span class="s1">]</span>
    <span class="s1">y0 = [</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">2.2</span><span class="s0">, </span><span class="s4">3.3</span><span class="s0">, </span><span class="s4">4.4</span><span class="s1">]</span>
    <span class="s1">x = [Decimal(x) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">x0]</span>
    <span class="s1">y = [Decimal(y) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">y0]</span>
    <span class="s2"># Test image - vertical, align-center bar chart with Decimal() input</span>
    <span class="s1">ax.bar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>
    <span class="s2"># Reference image</span>
    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.bar(x0</span><span class="s0">, </span><span class="s1">y0</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_barh_decimal_center(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">x0 = [</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">8.4</span><span class="s0">, </span><span class="s4">5.3</span><span class="s0">, </span><span class="s4">4.2</span><span class="s1">]</span>
    <span class="s1">y0 = [</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">2.2</span><span class="s0">, </span><span class="s4">3.3</span><span class="s0">, </span><span class="s4">4.4</span><span class="s1">]</span>
    <span class="s1">x = [Decimal(x) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">x0]</span>
    <span class="s1">y = [Decimal(y) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">y0]</span>
    <span class="s2"># Test image - horizontal, align-center bar chart with Decimal() input</span>
    <span class="s1">ax.barh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">height=[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>
    <span class="s2"># Reference image</span>
    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.barh(x0</span><span class="s0">, </span><span class="s1">y0</span><span class="s0">, </span><span class="s1">height=[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar_decimal_width(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x = [</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">8.4</span><span class="s0">, </span><span class="s4">5.3</span><span class="s0">, </span><span class="s4">4.2</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">2.2</span><span class="s0">, </span><span class="s4">3.3</span><span class="s0">, </span><span class="s4">4.4</span><span class="s1">]</span>
    <span class="s1">w0 = [</span><span class="s4">0.7</span><span class="s0">, </span><span class="s4">1.45</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">w = [Decimal(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">w0]</span>
    <span class="s2"># Test image - vertical bar chart with Decimal() width</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.bar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">width=w</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>
    <span class="s2"># Reference image</span>
    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.bar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">width=w0</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_barh_decimal_height(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x = [</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">8.4</span><span class="s0">, </span><span class="s4">5.3</span><span class="s0">, </span><span class="s4">4.2</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">2.2</span><span class="s0">, </span><span class="s4">3.3</span><span class="s0">, </span><span class="s4">4.4</span><span class="s1">]</span>
    <span class="s1">h0 = [</span><span class="s4">0.7</span><span class="s0">, </span><span class="s4">1.45</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">h = [Decimal(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">h0]</span>
    <span class="s2"># Test image - horizontal bar chart with Decimal() height</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.barh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">height=h</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>
    <span class="s2"># Reference image</span>
    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.barh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">height=h0</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_bar_color_none_alpha():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">rects = ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.3</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'r'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">rect </span><span class="s0">in </span><span class="s1">rects:</span>
        <span class="s0">assert </span><span class="s1">rect.get_facecolor() == (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rect.get_edgecolor() == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_bar_edgecolor_none_alpha():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">rects = ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.3</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'none'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">rect </span><span class="s0">in </span><span class="s1">rects:</span>
        <span class="s0">assert </span><span class="s1">rect.get_facecolor() == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">rect.get_edgecolor() == (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'barh_tick_label.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_barh_tick_label():</span>
    <span class="s2"># From 2516: plot barh with array of string labels for y axis</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.barh([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">height=[</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tick_label=[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_bar_timedelta():</span>
    <span class="s5">&quot;&quot;&quot;Smoketest that bar can handle width and height in delta units.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.bar(datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1.</span><span class="s0">,</span>
           <span class="s1">width=datetime.timedelta(hours=</span><span class="s4">3</span><span class="s1">))</span>
    <span class="s1">ax.bar(datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1.</span><span class="s0">,</span>
           <span class="s1">xerr=datetime.timedelta(hours=</span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
           <span class="s1">width=datetime.timedelta(hours=</span><span class="s4">3</span><span class="s1">))</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.barh(datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s0">,</span>
            <span class="s1">height=datetime.timedelta(hours=</span><span class="s4">3</span><span class="s1">))</span>
    <span class="s1">ax.barh(datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s0">,</span>
            <span class="s1">height=datetime.timedelta(hours=</span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">yerr=datetime.timedelta(hours=</span><span class="s4">2</span><span class="s1">))</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.barh([datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">height=datetime.timedelta(hours=</span><span class="s4">3</span><span class="s1">))</span>
    <span class="s1">ax.barh([datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">])</span><span class="s0">,</span>
            <span class="s1">height=[datetime.timedelta(hours=t) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]])</span>
    <span class="s1">ax.broken_barh([(datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">datetime.timedelta(hours=</span><span class="s4">1</span><span class="s1">))]</span><span class="s0">,</span>
                   <span class="s1">(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_boxplot_dates_pandas(pd):</span>
    <span class="s2"># smoke test for boxplot and dates in pandas</span>
    <span class="s1">data = np.random.rand(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">years = pd.date_range(</span><span class="s3">'1/1/2000'</span><span class="s0">,</span>
                          <span class="s1">periods=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">freq=pd.DateOffset(years=</span><span class="s4">1</span><span class="s1">)).year</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.boxplot(data</span><span class="s0">, </span><span class="s1">positions=years)</span>


<span class="s0">def </span><span class="s1">test_boxplot_capwidths():</span>
    <span class="s1">data = np.random.rand(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">9</span><span class="s1">)</span>

    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].boxplot(data</span><span class="s0">, </span><span class="s1">capwidths=[</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">widths=[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">])</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].boxplot(data</span><span class="s0">, </span><span class="s1">capwidths=[</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">widths=</span><span class="s4">0.2</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">2</span><span class="s1">].boxplot(data</span><span class="s0">, </span><span class="s1">capwidths=[</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">])</span>

    <span class="s1">axs[</span><span class="s4">3</span><span class="s1">].boxplot(data</span><span class="s0">, </span><span class="s1">capwidths=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">widths=[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">])</span>
    <span class="s1">axs[</span><span class="s4">4</span><span class="s1">].boxplot(data</span><span class="s0">, </span><span class="s1">capwidths=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">widths=</span><span class="s4">0.2</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">5</span><span class="s1">].boxplot(data</span><span class="s0">, </span><span class="s1">capwidths=</span><span class="s4">0.5</span><span class="s1">)</span>

    <span class="s1">axs[</span><span class="s4">6</span><span class="s1">].boxplot(data</span><span class="s0">, </span><span class="s1">widths=[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">])</span>
    <span class="s1">axs[</span><span class="s4">7</span><span class="s1">].boxplot(data</span><span class="s0">, </span><span class="s1">widths=</span><span class="s4">0.2</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">8</span><span class="s1">].boxplot(data)</span>


<span class="s0">def </span><span class="s1">test_pcolor_regression(pd):</span>
    <span class="s0">from </span><span class="s1">pandas.plotting </span><span class="s0">import </span><span class="s1">(</span>
        <span class="s1">register_matplotlib_converters</span><span class="s0">,</span>
        <span class="s1">deregister_matplotlib_converters</span><span class="s0">,</span>
    <span class="s1">)</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s4">111</span><span class="s1">)</span>

    <span class="s1">times = [datetime.datetime(</span><span class="s4">2021</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span>
    <span class="s0">while </span><span class="s1">len(times) &lt; </span><span class="s4">7</span><span class="s1">:</span>
        <span class="s1">times.append(times[-</span><span class="s4">1</span><span class="s1">] + datetime.timedelta(seconds=</span><span class="s4">120</span><span class="s1">))</span>

    <span class="s1">y_vals = np.arange(</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">time_axis</span><span class="s0">, </span><span class="s1">y_axis = np.meshgrid(times</span><span class="s0">, </span><span class="s1">y_vals)</span>
    <span class="s1">shape = (len(y_vals) - </span><span class="s4">1</span><span class="s0">, </span><span class="s1">len(times) - </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">z_data = np.arange(shape[</span><span class="s4">0</span><span class="s1">] * shape[</span><span class="s4">1</span><span class="s1">])</span>

    <span class="s1">z_data.shape = shape</span>
    <span class="s0">try</span><span class="s1">:</span>
        <span class="s1">register_matplotlib_converters()</span>

        <span class="s1">im = ax.pcolormesh(time_axis</span><span class="s0">, </span><span class="s1">y_axis</span><span class="s0">, </span><span class="s1">z_data)</span>
        <span class="s2"># make sure this does not raise!</span>
        <span class="s1">fig.canvas.draw()</span>
    <span class="s0">finally</span><span class="s1">:</span>
        <span class="s1">deregister_matplotlib_converters()</span>


<span class="s0">def </span><span class="s1">test_bar_pandas(pd):</span>
    <span class="s2"># Smoke test for pandas</span>
    <span class="s1">df = pd.DataFrame(</span>
        <span class="s1">{</span><span class="s3">'year'</span><span class="s1">: [</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">2018</span><span class="s0">, </span><span class="s4">2018</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s3">'month'</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s3">'day'</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s3">'value'</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]})</span>
    <span class="s1">df[</span><span class="s3">'date'</span><span class="s1">] = pd.to_datetime(df[[</span><span class="s3">'year'</span><span class="s0">, </span><span class="s3">'month'</span><span class="s0">, </span><span class="s3">'day'</span><span class="s1">]])</span>

    <span class="s1">monthly = df[[</span><span class="s3">'date'</span><span class="s0">, </span><span class="s3">'value'</span><span class="s1">]].groupby([</span><span class="s3">'date'</span><span class="s1">]).sum()</span>
    <span class="s1">dates = monthly.index</span>
    <span class="s1">forecast = monthly[</span><span class="s3">'value'</span><span class="s1">]</span>
    <span class="s1">baseline = monthly[</span><span class="s3">'value'</span><span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.bar(dates</span><span class="s0">, </span><span class="s1">forecast</span><span class="s0">, </span><span class="s1">width=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>
    <span class="s1">ax.plot(dates</span><span class="s0">, </span><span class="s1">baseline</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'orange'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">4</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_bar_pandas_indexed(pd):</span>
    <span class="s2"># Smoke test for indexed pandas</span>
    <span class="s1">df = pd.DataFrame({</span><span class="s3">&quot;x&quot;</span><span class="s1">: [</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">2.</span><span class="s0">, </span><span class="s4">3.</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;width&quot;</span><span class="s1">: [</span><span class="s4">.2</span><span class="s0">, </span><span class="s4">.4</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">]}</span><span class="s0">,</span>
                      <span class="s1">index=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.bar(df.x</span><span class="s0">, </span><span class="s4">1.</span><span class="s0">, </span><span class="s1">width=df.width)</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_bar_hatches(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax_test = fig_test.subplots()</span>
    <span class="s1">ax_ref = fig_ref.subplots()</span>

    <span class="s1">x = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">hatches = [</span><span class="s3">'x'</span><span class="s0">, </span><span class="s3">'o'</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">2</span><span class="s1">):</span>
        <span class="s1">ax_ref.bar(x[i]</span><span class="s0">, </span><span class="s1">y[i]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C0'</span><span class="s0">, </span><span class="s1">hatch=hatches[i])</span>

    <span class="s1">ax_test.bar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">hatch=hatches)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s1">(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;width&quot;</span><span class="s0">, </span><span class="s3">&quot;label&quot;</span><span class="s0">, </span><span class="s3">&quot;expected_labels&quot;</span><span class="s0">, </span><span class="s3">&quot;container_label&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">[</span>
        <span class="s1">(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;_nolegend_&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;x&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s3">&quot;A&quot;</span><span class="s0">, </span><span class="s3">&quot;B&quot;</span><span class="s0">, </span><span class="s3">&quot;C&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;_nolegend_&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">&quot;R&quot;</span><span class="s0">, </span><span class="s3">&quot;Y&quot;</span><span class="s0">, </span><span class="s3">&quot;_nolegend_&quot;</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s3">&quot;R&quot;</span><span class="s0">, </span><span class="s3">&quot;Y&quot;</span><span class="s0">, </span><span class="s3">&quot;_nolegend_&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;_nolegend_&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">15</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;bars&quot;</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s3">&quot;_nolegend_&quot;</span><span class="s0">, </span><span class="s3">&quot;_nolegend_&quot;</span><span class="s0">, </span><span class="s3">&quot;_nolegend_&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;bars&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bar_labels(x</span><span class="s0">, </span><span class="s1">width</span><span class="s0">, </span><span class="s1">label</span><span class="s0">, </span><span class="s1">expected_labels</span><span class="s0">, </span><span class="s1">container_label):</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">bar_container = ax.bar(x</span><span class="s0">, </span><span class="s1">width</span><span class="s0">, </span><span class="s1">label=label)</span>
    <span class="s1">bar_labels = [bar.get_label() </span><span class="s0">for </span><span class="s1">bar </span><span class="s0">in </span><span class="s1">bar_container]</span>
    <span class="s0">assert </span><span class="s1">expected_labels == bar_labels</span>
    <span class="s0">assert </span><span class="s1">bar_container.get_label() == container_label</span>


<span class="s0">def </span><span class="s1">test_bar_labels_length():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.bar([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=[</span><span class="s3">&quot;X&quot;</span><span class="s0">, </span><span class="s3">&quot;Y&quot;</span><span class="s0">, </span><span class="s3">&quot;Z&quot;</span><span class="s1">])</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.bar([</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=[</span><span class="s3">&quot;X&quot;</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_pandas_minimal_plot(pd):</span>
    <span class="s2"># smoke test that series and index objects do not warn</span>
    <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">[pd.Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;float64&quot;</span><span class="s1">)</span><span class="s0">,</span>
              <span class="s1">pd.Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">&quot;Float64&quot;</span><span class="s1">)]:</span>
        <span class="s1">plt.plot(x</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s1">plt.plot(x.index</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s1">plt.plot(x)</span>
        <span class="s1">plt.plot(x.index)</span>
    <span class="s1">df = pd.DataFrame({</span><span class="s3">'col'</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]})</span>
    <span class="s1">plt.plot(df)</span>
    <span class="s1">plt.plot(df</span><span class="s0">, </span><span class="s1">df)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_log'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hist_log():</span>
    <span class="s1">data0 = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">200</span><span class="s1">)**</span><span class="s4">3</span>
    <span class="s1">data = np.concatenate([</span><span class="s4">1 </span><span class="s1">- data0</span><span class="s0">, </span><span class="s4">1 </span><span class="s1">+ data0])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(data</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">False, </span><span class="s1">log=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_log_2(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">axs_test = fig_test.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">axs_ref = fig_ref.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">histtype </span><span class="s0">in </span><span class="s1">enumerate([</span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s3">&quot;step&quot;</span><span class="s0">, </span><span class="s3">&quot;stepfilled&quot;</span><span class="s1">]):</span>
        <span class="s2"># Set log scale, then call hist().</span>
        <span class="s1">axs_test[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">i].set_yscale(</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>
        <span class="s1">axs_test[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">i].hist(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">histtype=histtype)</span>
        <span class="s2"># Call hist(), then set log scale.</span>
        <span class="s1">axs_test[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">i].hist(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">histtype=histtype)</span>
        <span class="s1">axs_test[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">i].set_yscale(</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>
        <span class="s2"># Use hist(..., log=True).</span>
        <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs_ref[:</span><span class="s0">, </span><span class="s1">i]:</span>
            <span class="s1">ax.hist(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">log=</span><span class="s0">True, </span><span class="s1">histtype=histtype)</span>


<span class="s0">def </span><span class="s1">test_hist_log_barstacked():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].hist([[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;barstacked&quot;</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].set_yscale(</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].hist([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;barstacked&quot;</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].set_yscale(</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">axs[</span><span class="s4">0</span><span class="s1">].get_ylim() == axs[</span><span class="s4">1</span><span class="s1">].get_ylim()</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_bar_empty.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hist_bar_empty():</span>
    <span class="s2"># From #3886: creating hist from empty dataset raises ValueError</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.hist([]</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">'bar'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hist_float16():</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">values = np.clip(</span>
        <span class="s1">np.random.normal(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s1">size=</span><span class="s4">1000</span><span class="s1">)</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">).astype(np.float16)</span>
    <span class="s1">h = plt.hist(values</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">bc = h[</span><span class="s4">2</span><span class="s1">]</span>
    <span class="s2"># Check that there are no overlapping rectangles</span>
    <span class="s0">for </span><span class="s1">r </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">len(bc)):</span>
        <span class="s1">rleft = bc[r-</span><span class="s4">1</span><span class="s1">].get_corners()</span>
        <span class="s1">rright = bc[r].get_corners()</span>
        <span class="s2"># right hand position of left rectangle &lt;=</span>
        <span class="s2"># left hand position of right rectangle</span>
        <span class="s0">assert </span><span class="s1">rleft[</span><span class="s4">1</span><span class="s1">][</span><span class="s4">0</span><span class="s1">] &lt;= rright[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_step_empty.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hist_step_empty():</span>
    <span class="s2"># From #3886: creating hist from empty dataset raises ValueError</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.hist([]</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">'step'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_step_filled.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hist_step_filled():</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">x = np.random.randn(</span><span class="s4">1000</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">n_bins = </span><span class="s4">10</span>

    <span class="s1">kwargs = [{</span><span class="s3">'fill'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'fill'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'fill'</span><span class="s1">: </span><span class="s0">None</span><span class="s1">}</span><span class="s0">, </span><span class="s1">{}]*</span><span class="s4">2</span>
    <span class="s1">types = [</span><span class="s3">'step'</span><span class="s1">]*</span><span class="s4">4</span><span class="s1">+[</span><span class="s3">'stepfilled'</span><span class="s1">]*</span><span class="s4">4</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(nrows=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s4">4</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">kg</span><span class="s0">, </span><span class="s1">_type</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">zip(kwargs</span><span class="s0">, </span><span class="s1">types</span><span class="s0">, </span><span class="s1">axs.flat):</span>
        <span class="s1">ax.hist(x</span><span class="s0">, </span><span class="s1">n_bins</span><span class="s0">, </span><span class="s1">histtype=_type</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True, </span><span class="s1">**kg)</span>
        <span class="s1">ax.set_title(</span><span class="s3">'%s/%s' </span><span class="s1">% (kg</span><span class="s0">, </span><span class="s1">_type))</span>
        <span class="s1">ax.set_ylim(bottom=-</span><span class="s4">50</span><span class="s1">)</span>

    <span class="s1">patches = axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].patches</span>
    <span class="s0">assert </span><span class="s1">all(p.get_facecolor() == p.get_edgecolor() </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">patches)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_density.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_density():</span>
    <span class="s1">np.random.seed(</span><span class="s4">19680801</span><span class="s1">)</span>
    <span class="s1">data = np.random.standard_normal(</span><span class="s4">2000</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(data</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hist_unequal_bins_density():</span>
    <span class="s2"># Test correct behavior of normalized histogram with unequal bins</span>
    <span class="s2"># https://github.com/matplotlib/matplotlib/issues/9557</span>
    <span class="s1">rng = np.random.RandomState(</span><span class="s4">57483</span><span class="s1">)</span>
    <span class="s1">t = rng.randn(</span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">bins = [-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s1">mpl_heights</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_ = plt.hist(t</span><span class="s0">, </span><span class="s1">bins=bins</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">np_heights</span><span class="s0">, </span><span class="s1">_ = np.histogram(t</span><span class="s0">, </span><span class="s1">bins=bins</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">assert_allclose(mpl_heights</span><span class="s0">, </span><span class="s1">np_heights)</span>


<span class="s0">def </span><span class="s1">test_hist_datetime_datasets():</span>
    <span class="s1">data = [[datetime.datetime(</span><span class="s4">2017</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2017</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[datetime.datetime(</span><span class="s4">2017</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2017</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)]]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(data</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.hist(data</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;bins_preprocess&quot;</span><span class="s0">,</span>
                         <span class="s1">[mpl.dates.date2num</span><span class="s0">,</span>
                          <span class="s0">lambda </span><span class="s1">bins: bins</span><span class="s0">,</span>
                          <span class="s0">lambda </span><span class="s1">bins: np.asarray(bins</span><span class="s0">, </span><span class="s3">'datetime64'</span><span class="s1">)]</span><span class="s0">,</span>
                         <span class="s1">ids=[</span><span class="s3">'date2num'</span><span class="s0">, </span><span class="s3">'datetime.datetime'</span><span class="s0">,</span>
                              <span class="s3">'np.datetime64'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_datetime_datasets_bins(bins_preprocess):</span>
    <span class="s1">data = [[datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s1">datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span><span class="s0">,</span>
            <span class="s1">[datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">,</span>
             <span class="s1">datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">18</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]]</span>

    <span class="s1">date_edges = [datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                  <span class="s1">datetime.datetime(</span><span class="s4">2019</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">_ = ax.hist(data</span><span class="s0">, </span><span class="s1">bins=bins_preprocess(date_edges)</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(bins</span><span class="s0">, </span><span class="s1">mpl.dates.date2num(date_edges))</span>

    <span class="s1">_</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">_ = ax.hist(data</span><span class="s0">, </span><span class="s1">bins=bins_preprocess(date_edges)</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(bins</span><span class="s0">, </span><span class="s1">mpl.dates.date2num(date_edges))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'data, expected_number_of_hists'</span><span class="s0">,</span>
                         <span class="s1">[([]</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">([[]]</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">([[]</span><span class="s0">, </span><span class="s1">[]]</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_hist_with_empty_input(data</span><span class="s0">, </span><span class="s1">expected_number_of_hists):</span>
    <span class="s1">hists</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_ = plt.hist(data)</span>
    <span class="s1">hists = np.asarray(hists)</span>

    <span class="s0">if </span><span class="s1">hists.ndim == </span><span class="s4">1</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s4">1 </span><span class="s1">== expected_number_of_hists</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">hists.shape[</span><span class="s4">0</span><span class="s1">] == expected_number_of_hists</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;histtype, zorder&quot;</span><span class="s0">,</span>
                         <span class="s1">[(</span><span class="s3">&quot;bar&quot;</span><span class="s0">, </span><span class="s1">mpl.patches.Patch.zorder)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s3">&quot;step&quot;</span><span class="s0">, </span><span class="s1">mpl.lines.Line2D.zorder)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s3">&quot;stepfilled&quot;</span><span class="s0">, </span><span class="s1">mpl.patches.Patch.zorder)])</span>
<span class="s0">def </span><span class="s1">test_hist_zorder(histtype</span><span class="s0">, </span><span class="s1">zorder):</span>
    <span class="s1">ax = plt.figure().add_subplot()</span>
    <span class="s1">ax.hist([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">histtype=histtype)</span>
    <span class="s0">assert </span><span class="s1">ax.patches</span>
    <span class="s0">for </span><span class="s1">patch </span><span class="s0">in </span><span class="s1">ax.patches:</span>
        <span class="s0">assert </span><span class="s1">patch.get_zorder() == zorder</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_stairs(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s0">import </span><span class="s1">matplotlib.lines </span><span class="s0">as </span><span class="s1">mlines</span>
    <span class="s1">y = np.array([</span><span class="s4">6</span><span class="s0">, </span><span class="s4">14</span><span class="s0">, </span><span class="s4">32</span><span class="s0">, </span><span class="s4">37</span><span class="s0">, </span><span class="s4">48</span><span class="s0">, </span><span class="s4">32</span><span class="s0">, </span><span class="s4">21</span><span class="s0">,  </span><span class="s4">4</span><span class="s1">])  </span><span class="s2"># hist</span>
    <span class="s1">x = np.array([</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">2.</span><span class="s0">, </span><span class="s4">3.</span><span class="s0">, </span><span class="s4">4.</span><span class="s0">, </span><span class="s4">5.</span><span class="s0">, </span><span class="s4">6.</span><span class="s0">, </span><span class="s4">7.</span><span class="s0">, </span><span class="s4">8.</span><span class="s0">, </span><span class="s4">9.</span><span class="s1">])  </span><span class="s2"># bins</span>

    <span class="s1">test_axes = fig_test.subplots(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).flatten()</span>
    <span class="s1">test_axes[</span><span class="s4">0</span><span class="s1">].stairs(y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">test_axes[</span><span class="s4">1</span><span class="s1">].stairs(y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s0">None, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>
    <span class="s1">test_axes[</span><span class="s4">2</span><span class="s1">].stairs(y</span><span class="s0">, </span><span class="s1">x)</span>
    <span class="s1">test_axes[</span><span class="s4">3</span><span class="s1">].stairs(y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>
    <span class="s1">test_axes[</span><span class="s4">4</span><span class="s1">].stairs(y</span><span class="s0">, </span><span class="s1">x)</span>
    <span class="s1">test_axes[</span><span class="s4">4</span><span class="s1">].semilogy()</span>
    <span class="s1">test_axes[</span><span class="s4">5</span><span class="s1">].stairs(y</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>
    <span class="s1">test_axes[</span><span class="s4">5</span><span class="s1">].semilogx()</span>

    <span class="s2"># defaults of `PathPatch` to be used for all following Line2D</span>
    <span class="s1">style = {</span><span class="s3">'solid_joinstyle'</span><span class="s1">: </span><span class="s3">'miter'</span><span class="s0">, </span><span class="s3">'solid_capstyle'</span><span class="s1">: </span><span class="s3">'butt'</span><span class="s1">}</span>

    <span class="s1">ref_axes = fig_ref.subplots(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).flatten()</span>
    <span class="s1">ref_axes[</span><span class="s4">0</span><span class="s1">].plot(x</span><span class="s0">, </span><span class="s1">np.append(y</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">drawstyle=</span><span class="s3">'steps-post'</span><span class="s0">, </span><span class="s1">**style)</span>
    <span class="s1">ref_axes[</span><span class="s4">1</span><span class="s1">].plot(np.append(y[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">drawstyle=</span><span class="s3">'steps-post'</span><span class="s0">, </span><span class="s1">**style)</span>

    <span class="s1">ref_axes[</span><span class="s4">2</span><span class="s1">].plot(x</span><span class="s0">, </span><span class="s1">np.append(y</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">drawstyle=</span><span class="s3">'steps-post'</span><span class="s0">, </span><span class="s1">**style)</span>
    <span class="s1">ref_axes[</span><span class="s4">2</span><span class="s1">].add_line(mlines.Line2D([x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">**style))</span>
    <span class="s1">ref_axes[</span><span class="s4">2</span><span class="s1">].add_line(mlines.Line2D([x[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">**style))</span>
    <span class="s1">ref_axes[</span><span class="s4">2</span><span class="s1">].set_ylim(</span><span class="s4">0</span><span class="s0">, None</span><span class="s1">)</span>

    <span class="s1">ref_axes[</span><span class="s4">3</span><span class="s1">].plot(np.append(y[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">drawstyle=</span><span class="s3">'steps-post'</span><span class="s0">, </span><span class="s1">**style)</span>
    <span class="s1">ref_axes[</span><span class="s4">3</span><span class="s1">].add_line(mlines.Line2D([</span><span class="s4">0</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">**style))</span>
    <span class="s1">ref_axes[</span><span class="s4">3</span><span class="s1">].add_line(mlines.Line2D([</span><span class="s4">0</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[x[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">**style))</span>
    <span class="s1">ref_axes[</span><span class="s4">3</span><span class="s1">].set_xlim(</span><span class="s4">0</span><span class="s0">, None</span><span class="s1">)</span>

    <span class="s1">ref_axes[</span><span class="s4">4</span><span class="s1">].plot(x</span><span class="s0">, </span><span class="s1">np.append(y</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">drawstyle=</span><span class="s3">'steps-post'</span><span class="s0">, </span><span class="s1">**style)</span>
    <span class="s1">ref_axes[</span><span class="s4">4</span><span class="s1">].add_line(mlines.Line2D([x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">**style))</span>
    <span class="s1">ref_axes[</span><span class="s4">4</span><span class="s1">].add_line(mlines.Line2D([x[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">**style))</span>
    <span class="s1">ref_axes[</span><span class="s4">4</span><span class="s1">].semilogy()</span>

    <span class="s1">ref_axes[</span><span class="s4">5</span><span class="s1">].plot(np.append(y[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">drawstyle=</span><span class="s3">'steps-post'</span><span class="s0">, </span><span class="s1">**style)</span>
    <span class="s1">ref_axes[</span><span class="s4">5</span><span class="s1">].add_line(mlines.Line2D([</span><span class="s4">0</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[x[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">**style))</span>
    <span class="s1">ref_axes[</span><span class="s4">5</span><span class="s1">].add_line(mlines.Line2D([</span><span class="s4">0</span><span class="s0">, </span><span class="s1">y[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[x[-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[-</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">**style))</span>
    <span class="s1">ref_axes[</span><span class="s4">5</span><span class="s1">].semilogx()</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_stairs_fill(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">h</span><span class="s0">, </span><span class="s1">bins = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s1">bs = -</span><span class="s4">2</span>
    <span class="s2"># Test</span>
    <span class="s1">test_axes = fig_test.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).flatten()</span>
    <span class="s1">test_axes[</span><span class="s4">0</span><span class="s1">].stairs(h</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">test_axes[</span><span class="s4">1</span><span class="s1">].stairs(h</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">test_axes[</span><span class="s4">2</span><span class="s1">].stairs(h</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">baseline=bs</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">test_axes[</span><span class="s4">3</span><span class="s1">].stairs(h</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">baseline=bs</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s0">,</span>
                        <span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s2"># # Ref</span>
    <span class="s1">ref_axes = fig_ref.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).flatten()</span>
    <span class="s1">ref_axes[</span><span class="s4">0</span><span class="s1">].fill_between(bins</span><span class="s0">, </span><span class="s1">np.append(h</span><span class="s0">, </span><span class="s1">h[-</span><span class="s4">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">step=</span><span class="s3">'post'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ref_axes[</span><span class="s4">0</span><span class="s1">].set_ylim(</span><span class="s4">0</span><span class="s0">, None</span><span class="s1">)</span>
    <span class="s1">ref_axes[</span><span class="s4">1</span><span class="s1">].fill_betweenx(bins</span><span class="s0">, </span><span class="s1">np.append(h</span><span class="s0">, </span><span class="s1">h[-</span><span class="s4">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">step=</span><span class="s3">'post'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ref_axes[</span><span class="s4">1</span><span class="s1">].set_xlim(</span><span class="s4">0</span><span class="s0">, None</span><span class="s1">)</span>
    <span class="s1">ref_axes[</span><span class="s4">2</span><span class="s1">].fill_between(bins</span><span class="s0">, </span><span class="s1">np.append(h</span><span class="s0">, </span><span class="s1">h[-</span><span class="s4">1</span><span class="s1">])</span><span class="s0">,</span>
                             <span class="s1">np.ones(len(h)+</span><span class="s4">1</span><span class="s1">)*bs</span><span class="s0">, </span><span class="s1">step=</span><span class="s3">'post'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ref_axes[</span><span class="s4">2</span><span class="s1">].set_ylim(bs</span><span class="s0">, None</span><span class="s1">)</span>
    <span class="s1">ref_axes[</span><span class="s4">3</span><span class="s1">].fill_betweenx(bins</span><span class="s0">, </span><span class="s1">np.append(h</span><span class="s0">, </span><span class="s1">h[-</span><span class="s4">1</span><span class="s1">])</span><span class="s0">,</span>
                              <span class="s1">np.ones(len(h)+</span><span class="s4">1</span><span class="s1">)*bs</span><span class="s0">, </span><span class="s1">step=</span><span class="s3">'post'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ref_axes[</span><span class="s4">3</span><span class="s1">].set_xlim(bs</span><span class="s0">, None</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_stairs_update(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># fixed ylim because stairs() does autoscale, but updating data does not</span>
    <span class="s1">ylim = -</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span>
    <span class="s2"># Test</span>
    <span class="s1">test_ax = fig_test.add_subplot()</span>
    <span class="s1">h = test_ax.stairs([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">test_ax.set_ylim(ylim)</span>
    <span class="s1">h.set_data([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">h.set_data(edges=np.arange(</span><span class="s4">4</span><span class="s1">)+</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">h.set_data([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">4</span><span class="s1">)/</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">h.set_data([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">h.set_data(</span><span class="s0">None, </span><span class="s1">np.arange(</span><span class="s4">4</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">np.allclose(h.get_data()[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">np.allclose(h.get_data()[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">4</span><span class="s1">))</span>
    <span class="s1">h.set_data(baseline=-</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">h.get_data().baseline == -</span><span class="s4">2</span>

    <span class="s2"># Ref</span>
    <span class="s1">ref_ax = fig_ref.add_subplot()</span>
    <span class="s1">h = ref_ax.stairs([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">baseline=-</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ref_ax.set_ylim(ylim)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_stairs_baseline_0(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># Test</span>
    <span class="s1">test_ax = fig_test.add_subplot()</span>
    <span class="s1">test_ax.stairs([</span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s2"># Ref</span>
    <span class="s1">ref_ax = fig_ref.add_subplot()</span>
    <span class="s1">style = {</span><span class="s3">'solid_joinstyle'</span><span class="s1">: </span><span class="s3">'miter'</span><span class="s0">, </span><span class="s3">'solid_capstyle'</span><span class="s1">: </span><span class="s3">'butt'</span><span class="s1">}</span>
    <span class="s1">ref_ax.plot(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">drawstyle=</span><span class="s3">'steps-post'</span><span class="s0">, </span><span class="s1">**style)</span>
    <span class="s1">ref_ax.set_ylim(</span><span class="s4">0</span><span class="s0">, None</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_stairs_empty():</span>
    <span class="s1">ax = plt.figure().add_subplot()</span>
    <span class="s1">ax.stairs([]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">42</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">39</span><span class="s0">, </span><span class="s4">45</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (-</span><span class="s4">0.06</span><span class="s0">, </span><span class="s4">0.06</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_stairs_invalid_nan():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'Nan values in &quot;edges&quot;'</span><span class="s1">):</span>
        <span class="s1">plt.stairs([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_stairs_invalid_mismatch():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'Size mismatch'</span><span class="s1">):</span>
        <span class="s1">plt.stairs([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_stairs_invalid_update():</span>
    <span class="s1">h = plt.stairs([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'Nan values in &quot;edges&quot;'</span><span class="s1">):</span>
        <span class="s1">h.set_data(edges=[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_stairs_invalid_update2():</span>
    <span class="s1">h = plt.stairs([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'Size mismatch'</span><span class="s1">):</span>
        <span class="s1">h.set_data(edges=np.arange(</span><span class="s4">5</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_stairs_options.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_stairs_options():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]).astype(float)</span>
    <span class="s1">yn = y.copy()</span>
    <span class="s1">yn[</span><span class="s4">1</span><span class="s1">] = np.nan</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.stairs(y*</span><span class="s4">3</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'green'</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True, </span><span class="s1">label=</span><span class="s3">&quot;A&quot;</span><span class="s1">)</span>
    <span class="s1">ax.stairs(y</span><span class="s0">, </span><span class="s1">x*</span><span class="s4">3</span><span class="s1">-</span><span class="s4">3</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'red'</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True,</span>
              <span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">&quot;B&quot;</span><span class="s1">)</span>
    <span class="s1">ax.stairs(yn</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'orange'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">&quot;C&quot;</span><span class="s1">)</span>
    <span class="s1">ax.stairs(yn/</span><span class="s4">3</span><span class="s0">, </span><span class="s1">x*</span><span class="s4">3</span><span class="s1">-</span><span class="s4">2</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s4">0.5</span><span class="s0">,</span>
              <span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">&quot;D&quot;</span><span class="s1">)</span>
    <span class="s1">ax.stairs(y[::-</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">3</span><span class="s1">+</span><span class="s4">13</span><span class="s0">, </span><span class="s1">x-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'red'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s0">None,</span>
              <span class="s1">label=</span><span class="s3">&quot;E&quot;</span><span class="s1">)</span>
    <span class="s1">ax.stairs(y[::-</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">3</span><span class="s1">+</span><span class="s4">14</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s4">26</span><span class="s0">,</span>
              <span class="s1">color=</span><span class="s3">'purple'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">&quot;F&quot;</span><span class="s1">)</span>
    <span class="s1">ax.stairs(yn[::-</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">3</span><span class="s1">+</span><span class="s4">15</span><span class="s0">, </span><span class="s1">x+</span><span class="s4">1</span><span class="s0">, </span><span class="s1">baseline=np.linspace(</span><span class="s4">27</span><span class="s0">, </span><span class="s4">25</span><span class="s0">, </span><span class="s1">len(y))</span><span class="s0">,</span>
              <span class="s1">color=</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">&quot;G&quot;</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.stairs(y[:-</span><span class="s4">1</span><span class="s1">][::-</span><span class="s4">1</span><span class="s1">]*</span><span class="s4">2</span><span class="s1">+</span><span class="s4">11</span><span class="s0">, </span><span class="s1">x[:-</span><span class="s4">1</span><span class="s1">]+</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'black'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s0">,</span>
              <span class="s1">baseline=</span><span class="s4">12</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s3">'//'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">&quot;H&quot;</span><span class="s1">)</span>
    <span class="s1">ax.legend(loc=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_stairs_datetime.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_stairs_datetime():</span>
    <span class="s1">f</span><span class="s0">, </span><span class="s1">ax = plt.subplots(constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.stairs(np.arange(</span><span class="s4">36</span><span class="s1">)</span><span class="s0">,</span>
              <span class="s1">np.arange(np.datetime64(</span><span class="s3">'2001-12-27'</span><span class="s1">)</span><span class="s0">,</span>
                        <span class="s1">np.datetime64(</span><span class="s3">'2002-02-02'</span><span class="s1">)))</span>
    <span class="s1">plt.xticks(rotation=</span><span class="s4">30</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_stairs_edge_handling(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># Test</span>
    <span class="s1">test_ax = fig_test.add_subplot()</span>
    <span class="s1">test_ax.stairs([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'red'</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s2"># Ref</span>
    <span class="s1">ref_ax = fig_ref.add_subplot()</span>
    <span class="s1">st = ref_ax.stairs([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fill=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">st.set_color(</span><span class="s3">'red'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">contour_dat():</span>
    <span class="s1">x = np.linspace(-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">150</span><span class="s1">)</span>
    <span class="s1">y = np.linspace(-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">120</span><span class="s1">)</span>
    <span class="s1">z = np.cos(x) + np.sin(y[:</span><span class="s0">, </span><span class="s1">np.newaxis])</span>
    <span class="s0">return </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span>


<span class="s1">@image_comparison([</span><span class="s3">'contour_hatching'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_hatching():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = contour_dat()</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s1">hatches=[</span><span class="s3">'/'</span><span class="s0">, </span><span class="s3">'</span><span class="s0">\\</span><span class="s3">'</span><span class="s0">, </span><span class="s3">'//'</span><span class="s0">, </span><span class="s3">'-'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">cmap=mpl.colormaps[</span><span class="s3">'gray'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">extend=</span><span class="s3">'both'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.5</span><span class="s1">)</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s3">'contour_colorbar'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">,</span>
    <span class="s1">tol=</span><span class="s4">0.02 </span><span class="s0">if </span><span class="s1">platform.machine() </span><span class="s0">in </span><span class="s1">(</span><span class="s3">'aarch64'</span><span class="s0">, </span><span class="s3">'ppc64le'</span><span class="s0">, </span><span class="s3">'s390x'</span><span class="s1">) </span><span class="s0">else </span><span class="s4">0</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_colorbar():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z = contour_dat()</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cs = ax.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">levels=np.arange(-</span><span class="s4">1.8</span><span class="s0">, </span><span class="s4">1.801</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">cmap=mpl.colormaps[</span><span class="s3">'RdBu'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">vmin=-</span><span class="s4">0.6</span><span class="s0">,</span>
                     <span class="s1">vmax=</span><span class="s4">0.6</span><span class="s0">,</span>
                     <span class="s1">extend=</span><span class="s3">'both'</span><span class="s1">)</span>
    <span class="s1">cs1 = ax.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">levels=np.arange(-</span><span class="s4">2.2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.599</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">colors=[</span><span class="s3">'y'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">linestyles=</span><span class="s3">'solid'</span><span class="s0">,</span>
                     <span class="s1">linewidths=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">cs2 = ax.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">levels=np.arange(</span><span class="s4">0.6</span><span class="s0">, </span><span class="s4">2.2</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">colors=[</span><span class="s3">'c'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">linewidths=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">cbar = fig.colorbar(cs</span><span class="s0">, </span><span class="s1">ax=ax)</span>
    <span class="s1">cbar.add_lines(cs1)</span>
    <span class="s1">cbar.add_lines(cs2</span><span class="s0">, </span><span class="s1">erase=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist2d'</span><span class="s0">, </span><span class="s3">'hist2d'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hist2d():</span>
    <span class="s2"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s2"># make it not symmetric in case we switch x and y axis</span>
    <span class="s1">x = np.random.randn(</span><span class="s4">100</span><span class="s1">)*</span><span class="s4">2</span><span class="s1">+</span><span class="s4">5</span>
    <span class="s1">y = np.random.randn(</span><span class="s4">100</span><span class="s1">)-</span><span class="s4">2</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist2d(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">rasterized=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;x&quot;</span><span class="s1">: x</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">: y}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist2d(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">data=data</span><span class="s0">, </span><span class="s1">rasterized=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist2d_transpose'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hist2d_transpose():</span>
    <span class="s2"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s2"># make sure the output from np.histogram is transposed before</span>
    <span class="s2"># passing to pcolorfast</span>
    <span class="s1">x = np.array([</span><span class="s4">5</span><span class="s1">]*</span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">y = np.random.randn(</span><span class="s4">100</span><span class="s1">)-</span><span class="s4">2</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist2d(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">rasterized=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hist2d_density():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.random.random((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">100</span><span class="s1">))</span>
    <span class="s1">ax = plt.figure().subplots()</span>
    <span class="s0">for </span><span class="s1">obj </span><span class="s0">in </span><span class="s1">[ax</span><span class="s0">, </span><span class="s1">plt]:</span>
        <span class="s1">obj.hist2d(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">TestScatter:</span>
    <span class="s1">@image_comparison([</span><span class="s3">'scatter'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_scatter_plot(self):</span>
        <span class="s1">data = {</span><span class="s3">&quot;x&quot;</span><span class="s1">: np.array([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">: np.array([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span><span class="s0">,</span>
                <span class="s3">&quot;c&quot;</span><span class="s1">: [</span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'lime'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;s&quot;</span><span class="s1">: [</span><span class="s4">24</span><span class="s0">, </span><span class="s4">15</span><span class="s0">, </span><span class="s4">19</span><span class="s0">, </span><span class="s4">29</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s3">&quot;c2&quot;</span><span class="s1">: [</span><span class="s3">'0.5'</span><span class="s0">, </span><span class="s3">'0.6'</span><span class="s0">, </span><span class="s3">'0.7'</span><span class="s0">, </span><span class="s3">'0.8'</span><span class="s1">]}</span>

        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">ax.scatter(data[</span><span class="s3">&quot;x&quot;</span><span class="s1">] - </span><span class="s4">1.</span><span class="s0">, </span><span class="s1">data[</span><span class="s3">&quot;y&quot;</span><span class="s1">] - </span><span class="s4">1.</span><span class="s0">, </span><span class="s1">c=data[</span><span class="s3">&quot;c&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=data[</span><span class="s3">&quot;s&quot;</span><span class="s1">])</span>
        <span class="s1">ax.scatter(data[</span><span class="s3">&quot;x&quot;</span><span class="s1">] + </span><span class="s4">1.</span><span class="s0">, </span><span class="s1">data[</span><span class="s3">&quot;y&quot;</span><span class="s1">] + </span><span class="s4">1.</span><span class="s0">, </span><span class="s1">c=data[</span><span class="s3">&quot;c2&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=data[</span><span class="s3">&quot;s&quot;</span><span class="s1">])</span>
        <span class="s1">ax.scatter(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">&quot;s&quot;</span><span class="s0">, </span><span class="s1">data=data)</span>

    <span class="s1">@image_comparison([</span><span class="s3">'scatter_marker.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_scatter_marker(self):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax0</span><span class="s0">, </span><span class="s1">ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(ncols=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">ax0.scatter([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">c=[(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'y'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'lime'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">s=[</span><span class="s4">60</span><span class="s0">, </span><span class="s4">50</span><span class="s0">, </span><span class="s4">40</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">edgecolors=[</span><span class="s3">'k'</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">marker=</span><span class="s3">'s'</span><span class="s1">)</span>
        <span class="s1">ax1.scatter([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">c=[(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'y'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'lime'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">s=[</span><span class="s4">60</span><span class="s0">, </span><span class="s4">50</span><span class="s0">, </span><span class="s4">40</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">edgecolors=[</span><span class="s3">'k'</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">marker=mmarkers.MarkerStyle(</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">fillstyle=</span><span class="s3">'top'</span><span class="s1">))</span>
        <span class="s2"># unit area ellipse</span>
        <span class="s1">rx</span><span class="s0">, </span><span class="s1">ry = </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span>
        <span class="s1">area = rx * ry * np.pi</span>
        <span class="s1">theta = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s4">21</span><span class="s1">)</span>
        <span class="s1">verts = np.column_stack([np.cos(theta) * rx / area</span><span class="s0">,</span>
                                 <span class="s1">np.sin(theta) * ry / area])</span>
        <span class="s1">ax2.scatter([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">c=[(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'y'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'lime'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">s=[</span><span class="s4">60</span><span class="s0">, </span><span class="s4">50</span><span class="s0">, </span><span class="s4">40</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">edgecolors=[</span><span class="s3">'k'</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">marker=verts)</span>

    <span class="s1">@image_comparison([</span><span class="s3">'scatter_2D'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_2D(self):</span>
        <span class="s1">x = np.arange(</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">y = np.arange(</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
        <span class="s1">z = x + y</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c=z</span><span class="s0">, </span><span class="s1">s=</span><span class="s4">200</span><span class="s0">, </span><span class="s1">edgecolors=</span><span class="s3">'face'</span><span class="s1">)</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_decimal(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s1">x0 = np.array([</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">8.4</span><span class="s0">, </span><span class="s4">5.3</span><span class="s0">, </span><span class="s4">4.2</span><span class="s1">])</span>
        <span class="s1">y0 = np.array([</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">2.2</span><span class="s0">, </span><span class="s4">3.3</span><span class="s0">, </span><span class="s4">4.4</span><span class="s1">])</span>
        <span class="s1">x = np.array([Decimal(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">x0])</span>
        <span class="s1">y = np.array([Decimal(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">y0])</span>
        <span class="s1">c = [</span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'lime'</span><span class="s1">]</span>
        <span class="s1">s = [</span><span class="s4">24</span><span class="s0">, </span><span class="s4">15</span><span class="s0">, </span><span class="s4">19</span><span class="s0">, </span><span class="s4">29</span><span class="s1">]</span>
        <span class="s2"># Test image - scatter plot with Decimal() input</span>
        <span class="s1">ax = fig_test.subplots()</span>
        <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c=c</span><span class="s0">, </span><span class="s1">s=s)</span>
        <span class="s2"># Reference image</span>
        <span class="s1">ax = fig_ref.subplots()</span>
        <span class="s1">ax.scatter(x0</span><span class="s0">, </span><span class="s1">y0</span><span class="s0">, </span><span class="s1">c=c</span><span class="s0">, </span><span class="s1">s=s)</span>

    <span class="s0">def </span><span class="s1">test_scatter_color(self):</span>
        <span class="s2"># Try to catch cases where 'c' kwarg should have been used.</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">plt.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">])</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">plt.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'kwargs'</span><span class="s0">,</span>
                                <span class="s1">[</span>
                                    <span class="s1">{</span><span class="s3">'cmap'</span><span class="s1">: </span><span class="s3">'gray'</span><span class="s1">}</span><span class="s0">,</span>
                                    <span class="s1">{</span><span class="s3">'norm'</span><span class="s1">: mcolors.Normalize()}</span><span class="s0">,</span>
                                    <span class="s1">{</span><span class="s3">'vmin'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s0">,</span>
                                    <span class="s1">{</span><span class="s3">'vmax'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span>
                                <span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_color_warning(self</span><span class="s0">, </span><span class="s1">kwargs):</span>
        <span class="s1">warn_match = </span><span class="s3">&quot;No data for colormapping provided &quot;</span>
        <span class="s2"># Warn for cases where 'cmap', 'norm', 'vmin', 'vmax'</span>
        <span class="s2"># kwargs are being overridden</span>
        <span class="s0">with </span><span class="s1">pytest.warns(Warning</span><span class="s0">, </span><span class="s1">match=warn_match):</span>
            <span class="s1">plt.scatter([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">**kwargs)</span>
        <span class="s0">with </span><span class="s1">pytest.warns(Warning</span><span class="s0">, </span><span class="s1">match=warn_match):</span>
            <span class="s1">plt.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[]</span><span class="s0">, </span><span class="s1">**kwargs)</span>
        <span class="s2"># Do not warn for cases where 'c' matches 'x' and 'y'</span>
        <span class="s1">plt.scatter([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">c=[]</span><span class="s0">, </span><span class="s1">**kwargs)</span>
        <span class="s1">plt.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">**kwargs)</span>

    <span class="s0">def </span><span class="s1">test_scatter_unfilled(self):</span>
        <span class="s1">coll = plt.scatter([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s3">'0.1'</span><span class="s0">, </span><span class="s3">'0.3'</span><span class="s0">, </span><span class="s3">'0.5'</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">marker=mmarkers.MarkerStyle(</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">fillstyle=</span><span class="s3">'none'</span><span class="s1">)</span><span class="s0">,</span>
                           <span class="s1">linewidths=[</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">1.3</span><span class="s1">])</span>
        <span class="s0">assert </span><span class="s1">coll.get_facecolors().shape == (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)  </span><span class="s2"># no facecolors</span>
        <span class="s1">assert_array_equal(coll.get_edgecolors()</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                                                   <span class="s1">[</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                                                   <span class="s1">[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(coll.get_linewidths()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">1.3</span><span class="s1">])</span>

    <span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_scatter_unfillable(self):</span>
        <span class="s1">coll = plt.scatter([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s3">'0.1'</span><span class="s0">, </span><span class="s3">'0.3'</span><span class="s0">, </span><span class="s3">'0.5'</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">marker=</span><span class="s3">'x'</span><span class="s0">,</span>
                           <span class="s1">linewidths=[</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">1.3</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(coll.get_facecolors()</span><span class="s0">, </span><span class="s1">coll.get_edgecolors())</span>
        <span class="s1">assert_array_equal(coll.get_edgecolors()</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                                                   <span class="s1">[</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                                                   <span class="s1">[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])</span>
        <span class="s1">assert_array_equal(coll.get_linewidths()</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.1</span><span class="s0">, </span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">1.3</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_scatter_size_arg_size(self):</span>
        <span class="s1">x = np.arange(</span><span class="s4">4</span><span class="s1">)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'same size as x and y'</span><span class="s1">):</span>
            <span class="s1">plt.scatter(x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">x[</span><span class="s4">1</span><span class="s1">:])</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'same size as x and y'</span><span class="s1">):</span>
            <span class="s1">plt.scatter(x[</span><span class="s4">1</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">x[</span><span class="s4">1</span><span class="s1">:]</span><span class="s0">, </span><span class="s1">x)</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'float array-like'</span><span class="s1">):</span>
            <span class="s1">plt.scatter(x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s3">'foo'</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">test_scatter_edgecolor_RGB(self):</span>
        <span class="s2"># GitHub issue 19066</span>
        <span class="s1">coll = plt.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">,</span>
                            <span class="s1">edgecolor=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">))</span>
        <span class="s0">assert </span><span class="s1">mcolors.same_color(coll.get_edgecolor()</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">))</span>
        <span class="s1">coll = plt.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">edgecolor=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
        <span class="s0">assert </span><span class="s1">mcolors.same_color(coll.get_edgecolor()</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_invalid_color(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s1">ax = fig_test.subplots()</span>
        <span class="s1">cmap = mpl.colormaps[</span><span class="s3">&quot;viridis&quot;</span><span class="s1">].resampled(</span><span class="s4">16</span><span class="s1">)</span>
        <span class="s1">cmap.set_bad(</span><span class="s3">&quot;k&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s2"># Set a nonuniform size to prevent the last call to `scatter` (plotting</span>
        <span class="s2"># the invalid points separately in fig_ref) from using the marker</span>
        <span class="s2"># stamping fast path, which would result in slightly offset markers.</span>
        <span class="s1">ax.scatter(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">,</span>
                   <span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">s=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">plotnonfinite=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">ax = fig_ref.subplots()</span>
        <span class="s1">cmap = mpl.colormaps[</span><span class="s3">&quot;viridis&quot;</span><span class="s1">].resampled(</span><span class="s4">16</span><span class="s1">)</span>
        <span class="s1">ax.scatter([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">cmap=cmap)</span>
        <span class="s1">ax.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;k&quot;</span><span class="s1">)</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_no_invalid_color(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s2"># With plotnonfinite=False we plot only 2 points.</span>
        <span class="s1">ax = fig_test.subplots()</span>
        <span class="s1">cmap = mpl.colormaps[</span><span class="s3">&quot;viridis&quot;</span><span class="s1">].resampled(</span><span class="s4">16</span><span class="s1">)</span>
        <span class="s1">cmap.set_bad(</span><span class="s3">&quot;k&quot;</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">ax.scatter(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">,</span>
                   <span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan]</span><span class="s0">, </span><span class="s1">s=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">plotnonfinite=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">ax = fig_ref.subplots()</span>
        <span class="s1">ax.scatter([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">cmap=cmap)</span>

    <span class="s0">def </span><span class="s1">test_scatter_norm_vminvmax(self):</span>
        <span class="s5">&quot;&quot;&quot;Parameters vmin, vmax should error if norm is given.&quot;&quot;&quot;</span>
        <span class="s1">x = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">ax = plt.axes()</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                           <span class="s1">match=</span><span class="s3">&quot;Passing a Normalize instance simultaneously &quot;</span>
                                 <span class="s3">&quot;with vmin/vmax is not supported.&quot;</span><span class="s1">):</span>
            <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">c=x</span><span class="s0">, </span><span class="s1">norm=mcolors.Normalize(-</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">,</span>
                       <span class="s1">vmin=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_single_point(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s1">ax = fig_test.subplots()</span>
        <span class="s1">ax.scatter(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">c=</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">ax = fig_ref.subplots()</span>
        <span class="s1">ax.scatter([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=[</span><span class="s4">1</span><span class="s1">])</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_different_shapes(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s1">x = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s1">ax = fig_test.subplots()</span>
        <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">x.reshape(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=x.reshape(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">ax = fig_ref.subplots()</span>
        <span class="s1">ax.scatter(x.reshape(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">c=x.reshape(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>

    <span class="s2"># Parameters for *test_scatter_c*. NB: assuming that the</span>
    <span class="s2"># scatter plot will have 4 elements. The tuple scheme is:</span>
    <span class="s2"># (*c* parameter case, exception regexp key or None if no exception)</span>
    <span class="s1">params_test_scatter_c = [</span>
        <span class="s2"># single string:</span>
        <span class="s1">(</span><span class="s3">'0.5'</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># Single letter-sequences</span>
        <span class="s1">([</span><span class="s3">&quot;rgby&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;conversion&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># Special cases</span>
        <span class="s1">(</span><span class="s3">&quot;red&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">&quot;none&quot;</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s0">None, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;r&quot;</span><span class="s0">, </span><span class="s3">&quot;g&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;none&quot;</span><span class="s1">]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># Non-valid color spec (FWIW, 'jaune' means yellow in French)</span>
        <span class="s1">(</span><span class="s3">&quot;jaune&quot;</span><span class="s0">, </span><span class="s3">&quot;conversion&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">&quot;jaune&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;conversion&quot;</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># wrong type before wrong size</span>
        <span class="s1">([</span><span class="s3">&quot;jaune&quot;</span><span class="s1">]*</span><span class="s4">4</span><span class="s0">, </span><span class="s3">&quot;conversion&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># Value-mapping like</span>
        <span class="s1">([</span><span class="s4">0.5</span><span class="s1">]*</span><span class="s4">3</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># should emit a warning for user's eyes though</span>
        <span class="s1">([</span><span class="s4">0.5</span><span class="s1">]*</span><span class="s4">4</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># NB: no warning as matching size allows mapping</span>
        <span class="s1">([</span><span class="s4">0.5</span><span class="s1">]*</span><span class="s4">5</span><span class="s0">, </span><span class="s3">&quot;shape&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># list of strings:</span>
        <span class="s1">([</span><span class="s3">'0.5'</span><span class="s0">, </span><span class="s3">'0.4'</span><span class="s0">, </span><span class="s3">'0.6'</span><span class="s0">, </span><span class="s3">'0.7'</span><span class="s1">]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">'0.5'</span><span class="s0">, </span><span class="s3">'red'</span><span class="s0">, </span><span class="s3">'0.6'</span><span class="s0">, </span><span class="s3">'C5'</span><span class="s1">]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([</span><span class="s3">'0.5'</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s3">'0.6'</span><span class="s0">, </span><span class="s3">'C5'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;conversion&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># RGB values</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]*</span><span class="s4">3</span><span class="s0">, </span><span class="s3">&quot;shape&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]*</span><span class="s4">4</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]*</span><span class="s4">5</span><span class="s0">, </span><span class="s3">&quot;shape&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># RGBA values</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]*</span><span class="s4">3</span><span class="s0">, </span><span class="s3">&quot;shape&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]*</span><span class="s4">4</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]*</span><span class="s4">5</span><span class="s0">, </span><span class="s3">&quot;shape&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># Mix of valid color specs</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]]*</span><span class="s4">3 </span><span class="s1">+ [[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s3">&quot;0.0&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;shape&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s3">&quot;0.0&quot;</span><span class="s0">, </span><span class="s3">&quot;C5&quot;</span><span class="s1">]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s3">&quot;0.0&quot;</span><span class="s0">, </span><span class="s3">&quot;C5&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span><span class="s0">, </span><span class="s3">&quot;shape&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s2"># Mix of valid and non valid color specs</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s3">&quot;jaune&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;conversion&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s3">&quot;0.0&quot;</span><span class="s0">, </span><span class="s3">&quot;jaune&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;conversion&quot;</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s3">&quot;0.0&quot;</span><span class="s0">, </span><span class="s3">&quot;C5&quot;</span><span class="s0">, </span><span class="s3">&quot;jaune&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;conversion&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">'c_case, re_key'</span><span class="s0">, </span><span class="s1">params_test_scatter_c)</span>
    <span class="s0">def </span><span class="s1">test_scatter_c(self</span><span class="s0">, </span><span class="s1">c_case</span><span class="s0">, </span><span class="s1">re_key):</span>
        <span class="s0">def </span><span class="s1">get_next_color():</span>
            <span class="s0">return </span><span class="s3">'blue'  </span><span class="s2"># currently unused</span>

        <span class="s1">xsize = </span><span class="s4">4</span>
        <span class="s2"># Additional checking of *c* (introduced in #11383).</span>
        <span class="s1">REGEXP = {</span>
            <span class="s3">&quot;shape&quot;</span><span class="s1">: </span><span class="s3">&quot;^'c' argument has [0-9]+ elements&quot;</span><span class="s0">,  </span><span class="s2"># shape mismatch</span>
            <span class="s3">&quot;conversion&quot;</span><span class="s1">: </span><span class="s3">&quot;^'c' argument must be a color&quot;</span><span class="s0">,  </span><span class="s2"># bad vals</span>
            <span class="s1">}</span>

        <span class="s1">assert_context = (</span>
            <span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=REGEXP[re_key])</span>
            <span class="s0">if </span><span class="s1">re_key </span><span class="s0">is not None</span>
            <span class="s0">else </span><span class="s1">pytest.warns(match=</span><span class="s3">&quot;argument looks like a single numeric RGB&quot;</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">isinstance(c_case</span><span class="s0">, </span><span class="s1">list) </span><span class="s0">and </span><span class="s1">len(c_case) == </span><span class="s4">3</span>
            <span class="s0">else </span><span class="s1">contextlib.nullcontext()</span>
        <span class="s1">)</span>
        <span class="s0">with </span><span class="s1">assert_context:</span>
            <span class="s1">mpl.axes.Axes._parse_scatter_color_args(</span>
                <span class="s1">c=c_case</span><span class="s0">, </span><span class="s1">edgecolors=</span><span class="s3">&quot;black&quot;</span><span class="s0">, </span><span class="s1">kwargs={}</span><span class="s0">, </span><span class="s1">xsize=xsize</span><span class="s0">,</span>
                <span class="s1">get_next_color_func=get_next_color)</span>

    <span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
    <span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_single_color_c(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s1">rgb = [[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.05</span><span class="s1">]]</span>
        <span class="s1">rgba = [[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.05</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]]</span>

        <span class="s2"># set via color kwarg</span>
        <span class="s1">ax_ref = fig_ref.subplots()</span>
        <span class="s1">ax_ref.scatter(np.ones(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=rgb)</span>
        <span class="s1">ax_ref.scatter(np.ones(</span><span class="s4">4</span><span class="s1">)*</span><span class="s4">2</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=rgba)</span>

        <span class="s2"># set via broadcasting via c</span>
        <span class="s1">ax_test = fig_test.subplots()</span>
        <span class="s1">ax_test.scatter(np.ones(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=rgb)</span>
        <span class="s1">ax_test.scatter(np.ones(</span><span class="s4">4</span><span class="s1">)*</span><span class="s4">2</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=rgba)</span>

    <span class="s0">def </span><span class="s1">test_scatter_linewidths(self):</span>
        <span class="s1">x = np.arange(</span><span class="s4">5</span><span class="s1">)</span>

        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">):</span>
            <span class="s1">pc = ax.scatter(x</span><span class="s0">, </span><span class="s1">np.full(</span><span class="s4">5</span><span class="s0">, </span><span class="s1">i)</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">f'C</span><span class="s0">{</span><span class="s1">i</span><span class="s0">}</span><span class="s3">'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">s=</span><span class="s4">100</span><span class="s0">,</span>
                            <span class="s1">linewidths=i + </span><span class="s4">1</span><span class="s1">)</span>
            <span class="s0">assert </span><span class="s1">pc.get_linewidths() == i + </span><span class="s4">1</span>

        <span class="s1">pc = ax.scatter(x</span><span class="s0">, </span><span class="s1">np.full(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'C3'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">s=</span><span class="s4">100</span><span class="s0">,</span>
                        <span class="s1">linewidths=[*range(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, None</span><span class="s1">])</span>
        <span class="s1">assert_array_equal(pc.get_linewidths()</span><span class="s0">,</span>
                           <span class="s1">[*range(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">mpl.rcParams[</span><span class="s3">'lines.linewidth'</span><span class="s1">]])</span>


<span class="s0">def </span><span class="s1">_params(c=</span><span class="s0">None, </span><span class="s1">xsize=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">*</span><span class="s0">, </span><span class="s1">edgecolors=</span><span class="s0">None, </span><span class="s1">**kwargs):</span>
    <span class="s0">return </span><span class="s1">(c</span><span class="s0">, </span><span class="s1">edgecolors</span><span class="s0">, </span><span class="s1">kwargs </span><span class="s0">if </span><span class="s1">kwargs </span><span class="s0">is not None else </span><span class="s1">{}</span><span class="s0">, </span><span class="s1">xsize)</span>
<span class="s1">_result = namedtuple(</span><span class="s3">'_result'</span><span class="s0">, </span><span class="s3">'c, colors'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">'params, expected_result'</span><span class="s0">,</span>
    <span class="s1">[(_params()</span><span class="s0">,</span>
      <span class="s1">_result(c=</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">colors=np.array([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])))</span><span class="s0">,</span>
     <span class="s1">(_params(c=</span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">,</span>
      <span class="s1">_result(c=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">colors=np.array([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])))</span><span class="s0">,</span>
     <span class="s1">(_params(c=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'b'</span><span class="s1">)</span><span class="s0">,</span>
      <span class="s1">_result(c=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">colors=np.array([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])))</span><span class="s0">,</span>
     <span class="s2"># color</span>
     <span class="s1">(_params(color=</span><span class="s3">'b'</span><span class="s1">)</span><span class="s0">,</span>
      <span class="s1">_result(c=</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">colors=np.array([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])))</span><span class="s0">,</span>
     <span class="s1">(_params(color=[</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s1">])</span><span class="s0">,</span>
      <span class="s1">_result(c=[</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">colors=np.array([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]])))</span><span class="s0">,</span>
     <span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_parse_scatter_color_args(params</span><span class="s0">, </span><span class="s1">expected_result):</span>
    <span class="s0">def </span><span class="s1">get_next_color():</span>
        <span class="s0">return </span><span class="s3">'blue'  </span><span class="s2"># currently unused</span>

    <span class="s1">c</span><span class="s0">, </span><span class="s1">colors</span><span class="s0">, </span><span class="s1">_edgecolors = mpl.axes.Axes._parse_scatter_color_args(</span>
        <span class="s1">*params</span><span class="s0">, </span><span class="s1">get_next_color_func=get_next_color)</span>
    <span class="s0">assert </span><span class="s1">c == expected_result.c</span>
    <span class="s1">assert_allclose(colors</span><span class="s0">, </span><span class="s1">expected_result.colors)</span>

<span class="s0">del </span><span class="s1">_params</span>
<span class="s0">del </span><span class="s1">_result</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">'kwargs, expected_edgecolors'</span><span class="s0">,</span>
    <span class="s1">[(dict()</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(c=</span><span class="s3">'b'</span><span class="s1">)</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(edgecolors=</span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(edgecolors=[</span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s1">])</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s1">])</span><span class="s0">,</span>
     <span class="s1">(dict(edgecolor=</span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(edgecolors=</span><span class="s3">'face'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'face'</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(edgecolors=</span><span class="s3">'none'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'none'</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(edgecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">edgecolors=</span><span class="s3">'g'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(c=</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">edgecolors=</span><span class="s3">'g'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(color=</span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">(dict(color=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'g'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'g'</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_parse_scatter_color_args_edgecolors(kwargs</span><span class="s0">, </span><span class="s1">expected_edgecolors):</span>
    <span class="s0">def </span><span class="s1">get_next_color():</span>
        <span class="s0">return </span><span class="s3">'blue'  </span><span class="s2"># currently unused</span>

    <span class="s1">c = kwargs.pop(</span><span class="s3">'c'</span><span class="s0">, None</span><span class="s1">)</span>
    <span class="s1">edgecolors = kwargs.pop(</span><span class="s3">'edgecolors'</span><span class="s0">, None</span><span class="s1">)</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">result_edgecolors = \</span>
        <span class="s1">mpl.axes.Axes._parse_scatter_color_args(</span>
            <span class="s1">c</span><span class="s0">, </span><span class="s1">edgecolors</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">xsize=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">get_next_color_func=get_next_color)</span>
    <span class="s0">assert </span><span class="s1">result_edgecolors == expected_edgecolors</span>


<span class="s0">def </span><span class="s1">test_parse_scatter_color_args_error():</span>
    <span class="s0">def </span><span class="s1">get_next_color():</span>
        <span class="s0">return </span><span class="s3">'blue'  </span><span class="s2"># currently unused</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;RGBA values should be within 0-1 range&quot;</span><span class="s1">):</span>
        <span class="s1">c = np.array([[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.4</span><span class="s0">, </span><span class="s4">1.4</span><span class="s1">]])  </span><span class="s2"># value &gt; 1</span>
        <span class="s1">mpl.axes.Axes._parse_scatter_color_args(</span>
            <span class="s1">c</span><span class="s0">, None, </span><span class="s1">kwargs={}</span><span class="s0">, </span><span class="s1">xsize=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">get_next_color_func=get_next_color)</span>


<span class="s0">def </span><span class="s1">test_as_mpl_axes_api():</span>
    <span class="s2"># tests the _as_mpl_axes api</span>
    <span class="s0">class </span><span class="s1">Polar:</span>
        <span class="s0">def </span><span class="s1">__init__(self):</span>
            <span class="s1">self.theta_offset = </span><span class="s4">0</span>

        <span class="s0">def </span><span class="s1">_as_mpl_axes(self):</span>
            <span class="s2"># implement the matplotlib axes interface</span>
            <span class="s0">return </span><span class="s1">PolarAxes</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'theta_offset'</span><span class="s1">: self.theta_offset}</span>

    <span class="s1">prj = Polar()</span>
    <span class="s1">prj2 = Polar()</span>
    <span class="s1">prj2.theta_offset = np.pi</span>

    <span class="s2"># testing axes creation with plt.axes</span>
    <span class="s1">ax = plt.axes([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">projection=prj)</span>
    <span class="s0">assert </span><span class="s1">type(ax) == PolarAxes</span>
    <span class="s1">plt.close()</span>

    <span class="s2"># testing axes creation with subplot</span>
    <span class="s1">ax = plt.subplot(</span><span class="s4">121</span><span class="s0">, </span><span class="s1">projection=prj)</span>
    <span class="s0">assert </span><span class="s1">type(ax) == PolarAxes</span>
    <span class="s1">plt.close()</span>


<span class="s0">def </span><span class="s1">test_pyplot_axes():</span>
    <span class="s2"># test focusing of Axes in other Figure</span>
    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots()</span>
    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots()</span>
    <span class="s1">plt.sca(ax1)</span>
    <span class="s0">assert </span><span class="s1">ax1 </span><span class="s0">is </span><span class="s1">plt.gca()</span>
    <span class="s0">assert </span><span class="s1">fig1 </span><span class="s0">is </span><span class="s1">plt.gcf()</span>
    <span class="s1">plt.close(fig1)</span>
    <span class="s1">plt.close(fig2)</span>


<span class="s0">def </span><span class="s1">test_log_scales():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.log(np.linspace(</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)))</span>
    <span class="s1">ax.set_yscale(</span><span class="s3">'log'</span><span class="s0">, </span><span class="s1">base=</span><span class="s4">5.5</span><span class="s1">)</span>
    <span class="s1">ax.invert_yaxis()</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">'log'</span><span class="s0">, </span><span class="s1">base=</span><span class="s4">9.0</span><span class="s1">)</span>
    <span class="s1">xticks</span><span class="s0">, </span><span class="s1">yticks = [</span>
        <span class="s1">[(t.get_loc()</span><span class="s0">, </span><span class="s1">t.label1.get_text()) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">axis._update_ticks()]</span>
        <span class="s0">for </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">[ax.xaxis</span><span class="s0">, </span><span class="s1">ax.yaxis]</span>
    <span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">xticks == [</span>
        <span class="s1">(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s3">'$</span><span class="s0">\\</span><span class="s3">mathdefault{9^{0}}$'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">9.0</span><span class="s0">, </span><span class="s3">'$</span><span class="s0">\\</span><span class="s3">mathdefault{9^{1}}$'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">81.0</span><span class="s0">, </span><span class="s3">'$</span><span class="s0">\\</span><span class="s3">mathdefault{9^{2}}$'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">2.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">3.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">4.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">5.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">6.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">7.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">8.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">18.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">27.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">36.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">45.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">54.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">63.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">72.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">yticks == [</span>
        <span class="s1">(</span><span class="s4">0.18181818181818182</span><span class="s0">, </span><span class="s3">'$</span><span class="s0">\\</span><span class="s3">mathdefault{5.5^{-1}}$'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s3">'$</span><span class="s0">\\</span><span class="s3">mathdefault{5.5^{0}}$'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">5.5</span><span class="s0">, </span><span class="s3">'$</span><span class="s0">\\</span><span class="s3">mathdefault{5.5^{1}}$'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">0.36363636363636365</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">0.5454545454545454</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">0.7272727272727273</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">0.9090909090909092</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">2.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">3.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">4.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s4">5.0</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_log_scales_no_data():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set(xscale=</span><span class="s3">&quot;log&quot;</span><span class="s0">, </span><span class="s1">yscale=</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>
    <span class="s1">ax.xaxis.set_major_locator(mticker.MultipleLocator(</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == ax.get_ylim() == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_log_scales_invalid():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'Attempt to set non-positive'</span><span class="s1">):</span>
        <span class="s1">ax.set_xlim(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">ax.set_yscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'Attempt to set non-positive'</span><span class="s1">):</span>
        <span class="s1">ax.set_ylim(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'stackplot_test_image'</span><span class="s0">, </span><span class="s3">'stackplot_test_image'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_stackplot():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y1 = </span><span class="s4">1.0 </span><span class="s1">* x</span>
    <span class="s1">y2 = </span><span class="s4">2.0 </span><span class="s1">* x + </span><span class="s4">1</span>
    <span class="s1">y3 = </span><span class="s4">3.0 </span><span class="s1">* x + </span><span class="s4">2</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.stackplot(x</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">y3)</span>
    <span class="s1">ax.set_xlim((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax.set_ylim((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">70</span><span class="s1">))</span>

    <span class="s2"># Reuse testcase from above for a test with labeled data and with colours</span>
    <span class="s2"># from the Axes property cycle.</span>
    <span class="s1">data = {</span><span class="s3">&quot;x&quot;</span><span class="s1">: x</span><span class="s0">, </span><span class="s3">&quot;y1&quot;</span><span class="s1">: y1</span><span class="s0">, </span><span class="s3">&quot;y2&quot;</span><span class="s1">: y2</span><span class="s0">, </span><span class="s3">&quot;y3&quot;</span><span class="s1">: y3}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.stackplot(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y1&quot;</span><span class="s0">, </span><span class="s3">&quot;y2&quot;</span><span class="s0">, </span><span class="s3">&quot;y3&quot;</span><span class="s0">, </span><span class="s1">data=data</span><span class="s0">, </span><span class="s1">colors=[</span><span class="s3">&quot;C0&quot;</span><span class="s0">, </span><span class="s3">&quot;C1&quot;</span><span class="s0">, </span><span class="s3">&quot;C2&quot;</span><span class="s1">])</span>
    <span class="s1">ax.set_xlim((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax.set_ylim((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">70</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'stackplot_test_baseline'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_stackplot_baseline():</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">layers(n</span><span class="s0">, </span><span class="s1">m):</span>
        <span class="s1">a = np.zeros((m</span><span class="s0">, </span><span class="s1">n))</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(n):</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">5</span><span class="s1">):</span>
                <span class="s1">x = </span><span class="s4">1 </span><span class="s1">/ (</span><span class="s4">.1 </span><span class="s1">+ np.random.random())</span>
                <span class="s1">y = </span><span class="s4">2 </span><span class="s1">* np.random.random() - </span><span class="s4">.5</span>
                <span class="s1">z = </span><span class="s4">10 </span><span class="s1">/ (</span><span class="s4">.1 </span><span class="s1">+ np.random.random())</span>
                <span class="s1">a[:</span><span class="s0">, </span><span class="s1">i] += x * np.exp(-((np.arange(m) / m - y) * z) ** </span><span class="s4">2</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">a</span>

    <span class="s1">d = layers(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">d[</span><span class="s4">50</span><span class="s0">, </span><span class="s1">:] = </span><span class="s4">0  </span><span class="s2"># test for fixed weighted wiggle (issue #6313)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].stackplot(range(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">d.T</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s3">'zero'</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].stackplot(range(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">d.T</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s3">'sym'</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].stackplot(range(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">d.T</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s3">'wiggle'</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].stackplot(range(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">d.T</span><span class="s0">, </span><span class="s1">baseline=</span><span class="s3">'weighted_wiggle'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">_bxp_test_helper(</span>
        <span class="s1">stats_kwargs={}</span><span class="s0">, </span><span class="s1">transform_stats=</span><span class="s0">lambda </span><span class="s1">s: s</span><span class="s0">, </span><span class="s1">bxp_kwargs={}):</span>
    <span class="s1">np.random.seed(</span><span class="s4">937</span><span class="s1">)</span>
    <span class="s1">logstats = mpl.cbook.boxplot_stats(</span>
        <span class="s1">np.random.lognormal(mean=</span><span class="s4">1.25</span><span class="s0">, </span><span class="s1">sigma=</span><span class="s4">1.</span><span class="s0">, </span><span class="s1">size=(</span><span class="s4">37</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span><span class="s0">, </span><span class="s1">**stats_kwargs)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">if </span><span class="s1">bxp_kwargs.get(</span><span class="s3">'vert'</span><span class="s0">, True</span><span class="s1">):</span>
        <span class="s1">ax.set_yscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">ax.set_xscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s2"># Work around baseline images generate back when bxp did not respect the</span>
    <span class="s2"># boxplot.boxprops.linewidth rcParam when patch_artist is False.</span>
    <span class="s0">if not </span><span class="s1">bxp_kwargs.get(</span><span class="s3">'patch_artist'</span><span class="s0">, False</span><span class="s1">):</span>
        <span class="s1">mpl.rcParams[</span><span class="s3">'boxplot.boxprops.linewidth'</span><span class="s1">] = \</span>
            <span class="s1">mpl.rcParams[</span><span class="s3">'lines.linewidth'</span><span class="s1">]</span>
    <span class="s1">ax.bxp(transform_stats(logstats)</span><span class="s0">, </span><span class="s1">**bxp_kwargs)</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_baseline.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_baseline():</span>
    <span class="s1">_bxp_test_helper()</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_rangewhis.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_rangewhis():</span>
    <span class="s1">_bxp_test_helper(stats_kwargs=dict(whis=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_percentilewhis.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_percentilewhis():</span>
    <span class="s1">_bxp_test_helper(stats_kwargs=dict(whis=[</span><span class="s4">5</span><span class="s0">, </span><span class="s4">95</span><span class="s1">]))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_with_xlabels.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_with_xlabels():</span>
    <span class="s0">def </span><span class="s1">transform(stats):</span>
        <span class="s0">for </span><span class="s1">s</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(stats</span><span class="s0">, </span><span class="s1">list(</span><span class="s3">'ABCD'</span><span class="s1">)):</span>
            <span class="s1">s[</span><span class="s3">'label'</span><span class="s1">] = label</span>
        <span class="s0">return </span><span class="s1">stats</span>

    <span class="s1">_bxp_test_helper(transform_stats=transform)</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_horizontal.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s4">0.1</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_horizontal():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(vert=</span><span class="s0">False</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_with_ylabels.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s4">0.1</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_with_ylabels():</span>
    <span class="s0">def </span><span class="s1">transform(stats):</span>
        <span class="s0">for </span><span class="s1">s</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(stats</span><span class="s0">, </span><span class="s1">list(</span><span class="s3">'ABCD'</span><span class="s1">)):</span>
            <span class="s1">s[</span><span class="s3">'label'</span><span class="s1">] = label</span>
        <span class="s0">return </span><span class="s1">stats</span>

    <span class="s1">_bxp_test_helper(transform_stats=transform</span><span class="s0">, </span><span class="s1">bxp_kwargs=dict(vert=</span><span class="s0">False</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_patchartist.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_patchartist():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(patch_artist=</span><span class="s0">True</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_custompatchartist.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">100</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custompatchartist():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(</span>
        <span class="s1">patch_artist=</span><span class="s0">True,</span>
        <span class="s1">boxprops=dict(facecolor=</span><span class="s3">'yellow'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'green'</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">':'</span><span class="s1">)))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_customoutlier.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_customoutlier():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(</span>
        <span class="s1">flierprops=dict(linestyle=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'d'</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">'g'</span><span class="s1">)))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_withmean_custompoint.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_showcustommean():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(</span>
        <span class="s1">showmeans=</span><span class="s0">True,</span>
        <span class="s1">meanprops=dict(linestyle=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'d'</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">'green'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_custombox.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custombox():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(</span>
        <span class="s1">boxprops=dict(linestyle=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">3</span><span class="s1">)))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_custommedian.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custommedian():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(</span>
        <span class="s1">medianprops=dict(linestyle=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">3</span><span class="s1">)))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_customcap.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_customcap():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(</span>
        <span class="s1">capprops=dict(linestyle=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">3</span><span class="s1">)))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_customwhisker.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_customwhisker():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(</span>
        <span class="s1">whiskerprops=dict(linestyle=</span><span class="s3">'-'</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'m'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">3</span><span class="s1">)))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_withnotch.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_shownotches():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(shownotches=</span><span class="s0">True</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_nocaps.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_nocaps():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(showcaps=</span><span class="s0">False</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_nobox.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_nobox():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(showbox=</span><span class="s0">False</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_no_flier_stats.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_no_flier_stats():</span>
    <span class="s0">def </span><span class="s1">transform(stats):</span>
        <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">stats:</span>
            <span class="s1">s.pop(</span><span class="s3">'fliers'</span><span class="s0">, None</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">stats</span>

    <span class="s1">_bxp_test_helper(transform_stats=transform</span><span class="s0">,</span>
                     <span class="s1">bxp_kwargs=dict(showfliers=</span><span class="s0">False</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_withmean_point.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_showmean():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(showmeans=</span><span class="s0">True, </span><span class="s1">meanline=</span><span class="s0">False</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_withmean_line.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_showmeanasline():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(showmeans=</span><span class="s0">True, </span><span class="s1">meanline=</span><span class="s0">True</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_scalarwidth.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_scalarwidth():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(widths=</span><span class="s4">.25</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_customwidths.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_customwidths():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(widths=[</span><span class="s4">0.10</span><span class="s0">, </span><span class="s4">0.25</span><span class="s0">, </span><span class="s4">0.65</span><span class="s0">, </span><span class="s4">0.85</span><span class="s1">]))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_custompositions.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custompositions():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(positions=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]))</span>


<span class="s0">def </span><span class="s1">test_bxp_bad_widths():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">_bxp_test_helper(bxp_kwargs=dict(widths=[</span><span class="s4">1</span><span class="s1">]))</span>


<span class="s0">def </span><span class="s1">test_bxp_bad_positions():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">_bxp_test_helper(bxp_kwargs=dict(positions=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_custom_capwidths.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custom_capwidths():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(capwidths=[</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">]))</span>


<span class="s1">@image_comparison([</span><span class="s3">'bxp_custom_capwidth.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custom_capwidth():</span>
    <span class="s1">_bxp_test_helper(bxp_kwargs=dict(capwidths=</span><span class="s4">0.6</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_bxp_bad_capwidths():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">_bxp_test_helper(bxp_kwargs=dict(capwidths=[</span><span class="s4">1</span><span class="s1">]))</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot'</span><span class="s0">, </span><span class="s3">'boxplot'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s4">1.28</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot():</span>
    <span class="s2"># Randomness used for bootstrapping.</span>
    <span class="s1">np.random.seed(</span><span class="s4">937</span><span class="s1">)</span>

    <span class="s1">x = np.linspace(-</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([-</span><span class="s4">25</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">25</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">bootstrap=</span><span class="s4">10000</span><span class="s0">, </span><span class="s1">notch=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim((-</span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s1">))</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;x&quot;</span><span class="s1">: [x</span><span class="s0">, </span><span class="s1">x]}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.boxplot(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s1">bootstrap=</span><span class="s4">10000</span><span class="s0">, </span><span class="s1">notch=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">ax.set_ylim((-</span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot_custom_capwidths.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_custom_capwidths():</span>

    <span class="s1">x = np.linspace(-</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([-</span><span class="s4">25</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">25</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">notch=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">capwidths=[</span><span class="s4">0.01</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot_sym2.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_sym2():</span>
    <span class="s2"># Randomness used for bootstrapping.</span>
    <span class="s1">np.random.seed(</span><span class="s4">937</span><span class="s1">)</span>

    <span class="s1">x = np.linspace(-</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([-</span><span class="s4">25</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">25</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">[ax1</span><span class="s0">, </span><span class="s1">ax2] = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">ax1.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">bootstrap=</span><span class="s4">10000</span><span class="s0">, </span><span class="s1">sym=</span><span class="s3">'^'</span><span class="s1">)</span>
    <span class="s1">ax1.set_ylim((-</span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s1">))</span>

    <span class="s1">ax2.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">bootstrap=</span><span class="s4">10000</span><span class="s0">, </span><span class="s1">sym=</span><span class="s3">'g'</span><span class="s1">)</span>
    <span class="s1">ax2.set_ylim((-</span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot_sym.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_sym():</span>
    <span class="s1">x = np.linspace(-</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([-</span><span class="s4">25</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">25</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">sym=</span><span class="s3">'gs'</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim((-</span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot_autorange_false_whiskers.png'</span><span class="s0">,</span>
                   <span class="s3">'boxplot_autorange_true_whiskers.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_autorange_whiskers():</span>
    <span class="s2"># Randomness used for bootstrapping.</span>
    <span class="s1">np.random.seed(</span><span class="s4">937</span><span class="s1">)</span>

    <span class="s1">x = np.ones(</span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([</span><span class="s4">0</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>

    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots()</span>
    <span class="s1">ax1.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">bootstrap=</span><span class="s4">10000</span><span class="s0">, </span><span class="s1">notch=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax1.set_ylim((-</span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>

    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots()</span>
    <span class="s1">ax2.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">bootstrap=</span><span class="s4">10000</span><span class="s0">, </span><span class="s1">notch=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">autorange=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax2.set_ylim((-</span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">_rc_test_bxp_helper(ax</span><span class="s0">, </span><span class="s1">rc_dict):</span>
    <span class="s1">x = np.linspace(-</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([-</span><span class="s4">25</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">25</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">matplotlib.rc_context(rc_dict):</span>
        <span class="s1">ax.boxplot([x</span><span class="s0">, </span><span class="s1">x])</span>
    <span class="s0">return </span><span class="s1">ax</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot_rc_parameters'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">100</span><span class="s1">}</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True,</span>
                  <span class="s1">tol=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_rc_parameters():</span>
    <span class="s2"># Randomness used for bootstrapping.</span>
    <span class="s1">np.random.seed(</span><span class="s4">937</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">3</span><span class="s1">)</span>

    <span class="s1">rc_axis0 = {</span>
        <span class="s3">'boxplot.notch'</span><span class="s1">: </span><span class="s0">True,</span>
        <span class="s3">'boxplot.whiskers'</span><span class="s1">: [</span><span class="s4">5</span><span class="s0">, </span><span class="s4">95</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s3">'boxplot.bootstrap'</span><span class="s1">: </span><span class="s4">10000</span><span class="s0">,</span>

        <span class="s3">'boxplot.flierprops.color'</span><span class="s1">: </span><span class="s3">'b'</span><span class="s0">,</span>
        <span class="s3">'boxplot.flierprops.marker'</span><span class="s1">: </span><span class="s3">'o'</span><span class="s0">,</span>
        <span class="s3">'boxplot.flierprops.markerfacecolor'</span><span class="s1">: </span><span class="s3">'g'</span><span class="s0">,</span>
        <span class="s3">'boxplot.flierprops.markeredgecolor'</span><span class="s1">: </span><span class="s3">'b'</span><span class="s0">,</span>
        <span class="s3">'boxplot.flierprops.markersize'</span><span class="s1">: </span><span class="s4">5</span><span class="s0">,</span>
        <span class="s3">'boxplot.flierprops.linestyle'</span><span class="s1">: </span><span class="s3">'--'</span><span class="s0">,</span>
        <span class="s3">'boxplot.flierprops.linewidth'</span><span class="s1">: </span><span class="s4">2.0</span><span class="s0">,</span>

        <span class="s3">'boxplot.boxprops.color'</span><span class="s1">: </span><span class="s3">'r'</span><span class="s0">,</span>
        <span class="s3">'boxplot.boxprops.linewidth'</span><span class="s1">: </span><span class="s4">2.0</span><span class="s0">,</span>
        <span class="s3">'boxplot.boxprops.linestyle'</span><span class="s1">: </span><span class="s3">'--'</span><span class="s0">,</span>

        <span class="s3">'boxplot.capprops.color'</span><span class="s1">: </span><span class="s3">'c'</span><span class="s0">,</span>
        <span class="s3">'boxplot.capprops.linewidth'</span><span class="s1">: </span><span class="s4">2.0</span><span class="s0">,</span>
        <span class="s3">'boxplot.capprops.linestyle'</span><span class="s1">: </span><span class="s3">'--'</span><span class="s0">,</span>

        <span class="s3">'boxplot.medianprops.color'</span><span class="s1">: </span><span class="s3">'k'</span><span class="s0">,</span>
        <span class="s3">'boxplot.medianprops.linewidth'</span><span class="s1">: </span><span class="s4">2.0</span><span class="s0">,</span>
        <span class="s3">'boxplot.medianprops.linestyle'</span><span class="s1">: </span><span class="s3">'--'</span><span class="s0">,</span>
    <span class="s1">}</span>

    <span class="s1">rc_axis1 = {</span>
        <span class="s3">'boxplot.vertical'</span><span class="s1">: </span><span class="s0">False,</span>
        <span class="s3">'boxplot.whiskers'</span><span class="s1">: [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s3">'boxplot.patchartist'</span><span class="s1">: </span><span class="s0">True,</span>
    <span class="s1">}</span>

    <span class="s1">rc_axis2 = {</span>
        <span class="s3">'boxplot.whiskers'</span><span class="s1">: </span><span class="s4">2.0</span><span class="s0">,</span>
        <span class="s3">'boxplot.showcaps'</span><span class="s1">: </span><span class="s0">False,</span>
        <span class="s3">'boxplot.showbox'</span><span class="s1">: </span><span class="s0">False,</span>
        <span class="s3">'boxplot.showfliers'</span><span class="s1">: </span><span class="s0">False,</span>
        <span class="s3">'boxplot.showmeans'</span><span class="s1">: </span><span class="s0">True,</span>
        <span class="s3">'boxplot.meanline'</span><span class="s1">: </span><span class="s0">True,</span>

        <span class="s3">'boxplot.meanprops.color'</span><span class="s1">: </span><span class="s3">'c'</span><span class="s0">,</span>
        <span class="s3">'boxplot.meanprops.linewidth'</span><span class="s1">: </span><span class="s4">2.0</span><span class="s0">,</span>
        <span class="s3">'boxplot.meanprops.linestyle'</span><span class="s1">: </span><span class="s3">'--'</span><span class="s0">,</span>

        <span class="s3">'boxplot.whiskerprops.color'</span><span class="s1">: </span><span class="s3">'r'</span><span class="s0">,</span>
        <span class="s3">'boxplot.whiskerprops.linewidth'</span><span class="s1">: </span><span class="s4">2.0</span><span class="s0">,</span>
        <span class="s3">'boxplot.whiskerprops.linestyle'</span><span class="s1">: </span><span class="s3">'-.'</span><span class="s0">,</span>
    <span class="s1">}</span>
    <span class="s1">dict_list = [rc_axis0</span><span class="s0">, </span><span class="s1">rc_axis1</span><span class="s0">, </span><span class="s1">rc_axis2]</span>
    <span class="s0">for </span><span class="s1">axis</span><span class="s0">, </span><span class="s1">rc_axis </span><span class="s0">in </span><span class="s1">zip(ax</span><span class="s0">, </span><span class="s1">dict_list):</span>
        <span class="s1">_rc_test_bxp_helper(axis</span><span class="s0">, </span><span class="s1">rc_axis)</span>

    <span class="s0">assert </span><span class="s1">(matplotlib.patches.PathPatch </span><span class="s0">in</span>
            <span class="s1">[type(t) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">ax[</span><span class="s4">1</span><span class="s1">].get_children()])</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot_with_CIarray.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_with_CIarray():</span>
    <span class="s2"># Randomness used for bootstrapping.</span>
    <span class="s1">np.random.seed(</span><span class="s4">937</span><span class="s1">)</span>

    <span class="s1">x = np.linspace(-</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([-</span><span class="s4">25</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">25</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">CIs = np.array([[-</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">3.</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">3.5</span><span class="s1">]])</span>

    <span class="s2"># show a boxplot with Matplotlib medians and confidence intervals, and</span>
    <span class="s2"># another with manual values</span>
    <span class="s1">ax.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">bootstrap=</span><span class="s4">10000</span><span class="s0">, </span><span class="s1">usermedians=[</span><span class="s0">None, </span><span class="s4">1.0</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">conf_intervals=CIs</span><span class="s0">, </span><span class="s1">notch=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim((-</span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot_no_inverted_whisker.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_no_weird_whisker():</span>
    <span class="s1">x = np.array([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">9000</span><span class="s0">, </span><span class="s4">150</span><span class="s0">, </span><span class="s4">88</span><span class="s0">, </span><span class="s4">350</span><span class="s0">, </span><span class="s4">200000</span><span class="s0">, </span><span class="s4">1400</span><span class="s0">, </span><span class="s4">960</span><span class="s1">]</span><span class="s0">,</span>
                 <span class="s1">dtype=np.float64)</span>
    <span class="s1">ax1 = plt.axes()</span>
    <span class="s1">ax1.boxplot(x)</span>
    <span class="s1">ax1.set_yscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s1">ax1.yaxis.grid(</span><span class="s0">False, </span><span class="s1">which=</span><span class="s3">'minor'</span><span class="s1">)</span>
    <span class="s1">ax1.xaxis.grid(</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_boxplot_bad_medians():</span>
    <span class="s1">x = np.linspace(-</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([-</span><span class="s4">25</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">25</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.boxplot(x</span><span class="s0">, </span><span class="s1">usermedians=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">usermedians=[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]])</span>


<span class="s0">def </span><span class="s1">test_boxplot_bad_ci():</span>
    <span class="s1">x = np.linspace(-</span><span class="s4">7</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">140</span><span class="s1">)</span>
    <span class="s1">x = np.hstack([-</span><span class="s4">25</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s4">25</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">conf_intervals=[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.boxplot([x</span><span class="s0">, </span><span class="s1">x]</span><span class="s0">, </span><span class="s1">conf_intervals=[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]])</span>


<span class="s0">def </span><span class="s1">test_boxplot_zorder():</span>
    <span class="s1">x = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">fix</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">assert </span><span class="s1">ax.boxplot(x)[</span><span class="s3">'boxes'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">].get_zorder() == </span><span class="s4">2</span>
    <span class="s0">assert </span><span class="s1">ax.boxplot(x</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">10</span><span class="s1">)[</span><span class="s3">'boxes'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">].get_zorder() == </span><span class="s4">10</span>


<span class="s0">def </span><span class="s1">test_boxplot_marker_behavior():</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'lines.marker'</span><span class="s1">] = </span><span class="s3">'s'</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'boxplot.flierprops.marker'</span><span class="s1">] = </span><span class="s3">'o'</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'boxplot.meanprops.marker'</span><span class="s1">] = </span><span class="s3">'^'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">test_data = np.arange(</span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">test_data[-</span><span class="s4">1</span><span class="s1">] = </span><span class="s4">150  </span><span class="s2"># a flier point</span>
    <span class="s1">bxp_handle = ax.boxplot(test_data</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">bxp_lines </span><span class="s0">in </span><span class="s1">[</span><span class="s3">'whiskers'</span><span class="s0">, </span><span class="s3">'caps'</span><span class="s0">, </span><span class="s3">'boxes'</span><span class="s0">, </span><span class="s3">'medians'</span><span class="s1">]:</span>
        <span class="s0">for </span><span class="s1">each_line </span><span class="s0">in </span><span class="s1">bxp_handle[bxp_lines]:</span>
            <span class="s2"># Ensure that the rcParams['lines.marker'] is overridden by ''</span>
            <span class="s0">assert </span><span class="s1">each_line.get_marker() == </span><span class="s3">''</span>

    <span class="s2"># Ensure that markers for fliers and means aren't overridden with ''</span>
    <span class="s0">assert </span><span class="s1">bxp_handle[</span><span class="s3">'fliers'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">].get_marker() == </span><span class="s3">'o'</span>
    <span class="s0">assert </span><span class="s1">bxp_handle[</span><span class="s3">'means'</span><span class="s1">][</span><span class="s4">0</span><span class="s1">].get_marker() == </span><span class="s3">'^'</span>


<span class="s1">@image_comparison([</span><span class="s3">'boxplot_mod_artists_after_plotting.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">}</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_mod_artist_after_plotting():</span>
    <span class="s1">x = [</span><span class="s4">0.15</span><span class="s0">, </span><span class="s4">0.11</span><span class="s0">, </span><span class="s4">0.06</span><span class="s0">, </span><span class="s4">0.06</span><span class="s0">, </span><span class="s4">0.12</span><span class="s0">, </span><span class="s4">0.56</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.56</span><span class="s1">]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">bp = ax.boxplot(x</span><span class="s0">, </span><span class="s1">sym=</span><span class="s3">&quot;o&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">bp:</span>
        <span class="s0">for </span><span class="s1">obj </span><span class="s0">in </span><span class="s1">bp[key]:</span>
            <span class="s1">obj.set_color(</span><span class="s3">'green'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_vert_baseline.png'</span><span class="s0">,</span>
                   <span class="s3">'violinplot_vert_baseline.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_baseline():</span>
    <span class="s2"># First 9 digits of frac(sqrt(2))</span>
    <span class="s1">np.random.seed(</span><span class="s4">414213562</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showmedians=</span><span class="s4">0</span><span class="s1">)</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;d&quot;</span><span class="s1">: data}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.violinplot(</span><span class="s3">&quot;d&quot;</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showmedians=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">data=data)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_vert_showmeans.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_showmeans():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(3))</span>
    <span class="s1">np.random.seed(</span><span class="s4">732050807</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showmedians=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_vert_showextrema.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_showextrema():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(5))</span>
    <span class="s1">np.random.seed(</span><span class="s4">236067977</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showextrema=</span><span class="s4">1</span><span class="s0">,</span>
                  <span class="s1">showmedians=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_vert_showmedians.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_showmedians():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(7))</span>
    <span class="s1">np.random.seed(</span><span class="s4">645751311</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showmedians=</span><span class="s4">1</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_vert_showall.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_showall():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(11))</span>
    <span class="s1">np.random.seed(</span><span class="s4">316624790</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">showextrema=</span><span class="s4">1</span><span class="s0">,</span>
                  <span class="s1">showmedians=</span><span class="s4">1</span><span class="s0">,</span>
                  <span class="s1">quantiles=[[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.4</span><span class="s0">, </span><span class="s4">0.6</span><span class="s1">]])</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_vert_custompoints_10.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_custompoints_10():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(13))</span>
    <span class="s1">np.random.seed(</span><span class="s4">605551275</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showmedians=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">points=</span><span class="s4">10</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_vert_custompoints_200.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_custompoints_200():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(17))</span>
    <span class="s1">np.random.seed(</span><span class="s4">123105625</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showmedians=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">points=</span><span class="s4">200</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_horiz_baseline.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_baseline():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(19))</span>
    <span class="s1">np.random.seed(</span><span class="s4">358898943</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vert=</span><span class="s0">False, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showmedians=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_horiz_showmedians.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_showmedians():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(23))</span>
    <span class="s1">np.random.seed(</span><span class="s4">795831523</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vert=</span><span class="s0">False, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showmedians=</span><span class="s4">1</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_horiz_showmeans.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_showmeans():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(29))</span>
    <span class="s1">np.random.seed(</span><span class="s4">385164807</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vert=</span><span class="s0">False, </span><span class="s1">showmeans=</span><span class="s4">1</span><span class="s0">,</span>
                  <span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showmedians=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_horiz_showextrema.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_showextrema():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(31))</span>
    <span class="s1">np.random.seed(</span><span class="s4">567764362</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vert=</span><span class="s0">False, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showextrema=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">showmedians=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_horiz_showall.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_showall():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(37))</span>
    <span class="s1">np.random.seed(</span><span class="s4">82762530</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vert=</span><span class="s0">False, </span><span class="s1">showmeans=</span><span class="s4">1</span><span class="s0">,</span>
                  <span class="s1">showextrema=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">showmedians=</span><span class="s4">1</span><span class="s0">,</span>
                  <span class="s1">quantiles=[[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.9</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.4</span><span class="s0">, </span><span class="s4">0.6</span><span class="s1">]])</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_horiz_custompoints_10.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_custompoints_10():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(41))</span>
    <span class="s1">np.random.seed(</span><span class="s4">403124237</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vert=</span><span class="s0">False, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showmedians=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">points=</span><span class="s4">10</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'violinplot_horiz_custompoints_200.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_custompoints_200():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(43))</span>
    <span class="s1">np.random.seed(</span><span class="s4">557438524</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vert=</span><span class="s0">False, </span><span class="s1">showmeans=</span><span class="s4">0</span><span class="s0">,</span>
                  <span class="s1">showextrema=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">showmedians=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">points=</span><span class="s4">200</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_violinplot_bad_positions():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(47))</span>
    <span class="s1">np.random.seed(</span><span class="s4">855654600</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">5</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_violinplot_bad_widths():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(53))</span>
    <span class="s1">np.random.seed(</span><span class="s4">280109889</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">positions=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">widths=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_violinplot_bad_quantiles():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(73))</span>
    <span class="s1">np.random.seed(</span><span class="s4">544003745</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">)]</span>

    <span class="s2"># Different size quantile list and plots</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">quantiles=[[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.7</span><span class="s1">]])</span>


<span class="s0">def </span><span class="s1">test_violinplot_outofrange_quantiles():</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s2"># First 9 digits of frac(sqrt(79))</span>
    <span class="s1">np.random.seed(</span><span class="s4">888194417</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">)]</span>

    <span class="s2"># Quantile value above 100</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">quantiles=[[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">1.05</span><span class="s1">]])</span>

    <span class="s2"># Quantile value below 0</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">quantiles=[[-</span><span class="s4">0.05</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.75</span><span class="s1">]])</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_violinplot_single_list_quantiles(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># Ensures quantile list for 1D can be passed in as single list</span>
    <span class="s2"># First 9 digits of frac(sqrt(83))</span>
    <span class="s1">np.random.seed(</span><span class="s4">110433579</span><span class="s1">)</span>
    <span class="s1">data = [np.random.normal(size=</span><span class="s4">100</span><span class="s1">)]</span>

    <span class="s2"># Test image</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">quantiles=[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.9</span><span class="s1">])</span>

    <span class="s2"># Reference image</span>
    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.violinplot(data</span><span class="s0">, </span><span class="s1">quantiles=[[</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.9</span><span class="s1">]])</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_violinplot_pandas_series(fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">pd):</span>
    <span class="s1">np.random.seed(</span><span class="s4">110433579</span><span class="s1">)</span>
    <span class="s1">s1 = pd.Series(np.random.normal(size=</span><span class="s4">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=[</span><span class="s4">9</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">s2 = pd.Series(np.random.normal(size=</span><span class="s4">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=list(</span><span class="s3">'ABCDEFGHI'</span><span class="s1">))</span>
    <span class="s1">s3 = pd.Series(np.random.normal(size=</span><span class="s4">11</span><span class="s1">))</span>
    <span class="s1">fig_test.subplots().violinplot([s1</span><span class="s0">, </span><span class="s1">s2</span><span class="s0">, </span><span class="s1">s3])</span>
    <span class="s1">fig_ref.subplots().violinplot([s1.values</span><span class="s0">, </span><span class="s1">s2.values</span><span class="s0">, </span><span class="s1">s3.values])</span>


<span class="s0">def </span><span class="s1">test_manage_xticks():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s1">old_xlim = ax.get_xlim()</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">y1 = np.random.normal(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">y2 = np.random.normal(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">ax.boxplot([y1</span><span class="s0">, </span><span class="s1">y2]</span><span class="s0">, </span><span class="s1">positions=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">manage_ticks=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">new_xlim = ax.get_xlim()</span>
    <span class="s1">assert_array_equal(old_xlim</span><span class="s0">, </span><span class="s1">new_xlim)</span>


<span class="s0">def </span><span class="s1">test_boxplot_not_single():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.boxplot(np.random.rand(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">positions=[</span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">ax.boxplot(np.random.rand(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">positions=[</span><span class="s4">5</span><span class="s1">])</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">2.5</span><span class="s0">, </span><span class="s4">5.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">list(ax.get_xticks()) == [</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">[t.get_text() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">ax.get_xticklabels()] == [</span><span class="s3">&quot;3&quot;</span><span class="s0">, </span><span class="s3">&quot;5&quot;</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_tick_space_size_0():</span>
    <span class="s2"># allow font size to be zero, which affects ticks when there is</span>
    <span class="s2"># no other text in the figure.</span>
    <span class="s1">plt.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">matplotlib.rcParams.update({</span><span class="s3">'font.size'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">})</span>
    <span class="s1">b = io.BytesIO()</span>
    <span class="s1">plt.savefig(b</span><span class="s0">, </span><span class="s1">dpi=</span><span class="s4">80</span><span class="s0">, </span><span class="s1">format=</span><span class="s3">'raw'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'errorbar_basic'</span><span class="s0">, </span><span class="s3">'errorbar_mixed'</span><span class="s0">, </span><span class="s3">'errorbar_basic'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_errorbar():</span>
    <span class="s2"># longdouble due to floating point rounding issues with certain</span>
    <span class="s2"># computer chipsets</span>
    <span class="s1">x = np.arange(</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">dtype=np.longdouble)</span>
    <span class="s1">y = np.exp(-x)</span>

    <span class="s1">yerr = </span><span class="s4">0.1 </span><span class="s1">+ </span><span class="s4">0.2</span><span class="s1">*np.sqrt(x)</span>
    <span class="s1">xerr = </span><span class="s4">0.1 </span><span class="s1">+ yerr</span>

    <span class="s2"># First illustrate basic pyplot interface, using defaults where possible.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.gca()</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.4</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">&quot;Simplest errorbars, 0.2 in x, 0.4 in y&quot;</span><span class="s1">)</span>

    <span class="s2"># Now switch to a more OO interface to exercise more features.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(nrows=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax = axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'Vert. symmetric'</span><span class="s1">)</span>

    <span class="s2"># With 4 subplots, reduce the number of axis ticks to avoid crowding.</span>
    <span class="s1">ax.locator_params(nbins=</span><span class="s4">4</span><span class="s1">)</span>

    <span class="s1">ax = axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.4</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'Hor. symmetric w/ alpha'</span><span class="s1">)</span>

    <span class="s1">ax = axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr=[yerr</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*yerr]</span><span class="s0">, </span><span class="s1">xerr=[xerr</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*xerr]</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'--o'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'H, V asymmetric'</span><span class="s1">)</span>

    <span class="s1">ax = axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">ax.set_yscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s2"># Here we have to be careful to keep all y values positive:</span>
    <span class="s1">ylower = np.maximum(</span><span class="s4">1e-2</span><span class="s0">, </span><span class="s1">y - yerr)</span>
    <span class="s1">yerr_lower = y - ylower</span>

    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr=[yerr_lower</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*yerr]</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">,</span>
                <span class="s1">fmt=</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ecolor=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">capthick=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'Mixed sym., log y'</span><span class="s1">)</span>
    <span class="s2"># Force limits due to floating point slop potentially expanding the range</span>
    <span class="s1">ax.set_ylim(</span><span class="s4">1e-2</span><span class="s0">, </span><span class="s4">1e1</span><span class="s1">)</span>

    <span class="s1">fig.suptitle(</span><span class="s3">'Variable errorbars'</span><span class="s1">)</span>

    <span class="s2"># Reuse the first testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;x&quot;</span><span class="s1">: x</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">: y}</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.gca()</span>
    <span class="s1">ax.errorbar(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.4</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">ax.set_title(</span><span class="s3">&quot;Simplest errorbars, 0.2 in x, 0.4 in y&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'mixed_errorbar_polar_caps'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_mixed_errorbar_polar_caps():</span>
    <span class="s5">&quot;&quot;&quot; 
    Mix several polar errorbar use cases in a single test figure. 
 
    It is advisable to position individual points off the grid. If there are 
    problems with reproducibility of this test, consider removing grid. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = plt.subplot(</span><span class="s4">111</span><span class="s0">, </span><span class="s1">projection=</span><span class="s3">'polar'</span><span class="s1">)</span>

    <span class="s2"># symmetric errorbars</span>
    <span class="s1">th_sym = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">r_sym = [</span><span class="s4">0.9</span><span class="s1">]*</span><span class="s4">3</span>
    <span class="s1">ax.errorbar(th_sym</span><span class="s0">, </span><span class="s1">r_sym</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s4">0.35</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">&quot;o&quot;</span><span class="s1">)</span>

    <span class="s2"># long errorbars</span>
    <span class="s1">th_long = [np.pi/</span><span class="s4">2 </span><span class="s1">+ </span><span class="s4">.1</span><span class="s0">, </span><span class="s1">np.pi + </span><span class="s4">.1</span><span class="s1">]</span>
    <span class="s1">r_long = [</span><span class="s4">1.8</span><span class="s0">, </span><span class="s4">2.2</span><span class="s1">]</span>
    <span class="s1">ax.errorbar(th_long</span><span class="s0">, </span><span class="s1">r_long</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s4">0.8 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.15</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">&quot;o&quot;</span><span class="s1">)</span>

    <span class="s2"># asymmetric errorbars</span>
    <span class="s1">th_asym = [</span><span class="s4">4</span><span class="s1">*np.pi/</span><span class="s4">3 </span><span class="s1">+ </span><span class="s4">.1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">*np.pi/</span><span class="s4">3 </span><span class="s1">+ </span><span class="s4">.1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*np.pi-</span><span class="s4">0.1</span><span class="s1">]</span>
    <span class="s1">r_asym = [</span><span class="s4">1.1</span><span class="s1">]*</span><span class="s4">3</span>
    <span class="s1">xerr = [[</span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.2</span><span class="s0">, </span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.3</span><span class="s1">]]</span>
    <span class="s1">yerr = [[</span><span class="s4">.35</span><span class="s0">, </span><span class="s4">.5</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.5</span><span class="s0">, </span><span class="s4">.35</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]]</span>
    <span class="s1">ax.errorbar(th_asym</span><span class="s0">, </span><span class="s1">r_asym</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">&quot;o&quot;</span><span class="s1">)</span>

    <span class="s2"># overlapping errorbar</span>
    <span class="s1">th_over = [</span><span class="s4">2.1</span><span class="s1">]</span>
    <span class="s1">r_over = [</span><span class="s4">3.1</span><span class="s1">]</span>
    <span class="s1">ax.errorbar(th_over</span><span class="s0">, </span><span class="s1">r_over</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">.2</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">&quot;o&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_errorbar_colorcycle():</span>

    <span class="s1">f</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y = </span><span class="s4">2</span><span class="s1">*x</span>

    <span class="s1">e1</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_ = ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">e2</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_ = ax.errorbar(x</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*y</span><span class="s0">, </span><span class="s1">c=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">ln1</span><span class="s0">, </span><span class="s1">= ax.plot(x</span><span class="s0">, </span><span class="s4">4</span><span class="s1">*y)</span>

    <span class="s0">assert </span><span class="s1">mcolors.to_rgba(e1.get_color()) == mcolors.to_rgba(</span><span class="s3">'C0'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">mcolors.to_rgba(e2.get_color()) == mcolors.to_rgba(</span><span class="s3">'C1'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">mcolors.to_rgba(ln1.get_color()) == mcolors.to_rgba(</span><span class="s3">'C2'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_errorbar_cycle_ecolor(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x = np.arange(</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">y = [np.exp(-x+n) </span><span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">)]</span>

    <span class="s1">axt = fig_test.subplots()</span>
    <span class="s1">axr = fig_ref.subplots()</span>

    <span class="s0">for </span><span class="s1">yi</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(y</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'C0'</span><span class="s0">, </span><span class="s3">'C1'</span><span class="s0">, </span><span class="s3">'C2'</span><span class="s0">, </span><span class="s3">'C3'</span><span class="s1">]):</span>
        <span class="s1">axt.errorbar(x</span><span class="s0">, </span><span class="s1">yi</span><span class="s0">, </span><span class="s1">yerr=(yi * </span><span class="s4">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">'-'</span><span class="s0">,</span>
                     <span class="s1">marker=</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ecolor=</span><span class="s3">'black'</span><span class="s1">)</span>
        <span class="s1">axr.errorbar(x</span><span class="s0">, </span><span class="s1">yi</span><span class="s0">, </span><span class="s1">yerr=(yi * </span><span class="s4">0.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">'-'</span><span class="s0">,</span>
                     <span class="s1">marker=</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">color=color</span><span class="s0">, </span><span class="s1">ecolor=</span><span class="s3">'black'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_errorbar_shape():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.gca()</span>

    <span class="s1">x = np.arange(</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">y = np.exp(-x)</span>
    <span class="s1">yerr1 = </span><span class="s4">0.1 </span><span class="s1">+ </span><span class="s4">0.2</span><span class="s1">*np.sqrt(x)</span>
    <span class="s1">yerr = np.vstack((yerr1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*yerr1)).T</span>
    <span class="s1">xerr = </span><span class="s4">0.1 </span><span class="s1">+ yerr</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'o'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'errorbar_limits'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_limits():</span>
    <span class="s1">x = np.arange(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">5.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">y = np.exp(-x)</span>
    <span class="s1">xerr = </span><span class="s4">0.1</span>
    <span class="s1">yerr = </span><span class="s4">0.2</span>
    <span class="s1">ls = </span><span class="s3">'dotted'</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s2"># standard error bars</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">, </span><span class="s1">ls=ls</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'blue'</span><span class="s1">)</span>

    <span class="s2"># including upper limits</span>
    <span class="s1">uplims = np.zeros_like(x)</span>
    <span class="s1">uplims[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">9</span><span class="s1">]] = </span><span class="s0">True</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y+</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">, </span><span class="s1">uplims=uplims</span><span class="s0">, </span><span class="s1">ls=ls</span><span class="s0">,</span>
                <span class="s1">color=</span><span class="s3">'green'</span><span class="s1">)</span>

    <span class="s2"># including lower limits</span>
    <span class="s1">lolims = np.zeros_like(x)</span>
    <span class="s1">lolims[[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">8</span><span class="s1">]] = </span><span class="s0">True</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y+</span><span class="s4">1.0</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">, </span><span class="s1">lolims=lolims</span><span class="s0">, </span><span class="s1">ls=ls</span><span class="s0">,</span>
                <span class="s1">color=</span><span class="s3">'red'</span><span class="s1">)</span>

    <span class="s2"># including upper and lower limits</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y+</span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">8</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">,</span>
                <span class="s1">lolims=lolims</span><span class="s0">, </span><span class="s1">uplims=uplims</span><span class="s0">, </span><span class="s1">ls=ls</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'magenta'</span><span class="s1">)</span>

    <span class="s2"># including xlower and xupper limits</span>
    <span class="s1">xerr = </span><span class="s4">0.2</span>
    <span class="s1">yerr = np.full_like(x</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">)</span>
    <span class="s1">yerr[[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]] = </span><span class="s4">0.3</span>
    <span class="s1">xlolims = lolims</span>
    <span class="s1">xuplims = uplims</span>
    <span class="s1">lolims = np.zeros_like(x)</span>
    <span class="s1">uplims = np.zeros_like(x)</span>
    <span class="s1">lolims[[</span><span class="s4">6</span><span class="s1">]] = </span><span class="s0">True</span>
    <span class="s1">uplims[[</span><span class="s4">3</span><span class="s1">]] = </span><span class="s0">True</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y+</span><span class="s4">2.1</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ms=</span><span class="s4">8</span><span class="s0">, </span><span class="s1">xerr=xerr</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">,</span>
                <span class="s1">xlolims=xlolims</span><span class="s0">, </span><span class="s1">xuplims=xuplims</span><span class="s0">, </span><span class="s1">uplims=uplims</span><span class="s0">,</span>
                <span class="s1">lolims=lolims</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">mec=</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s1">capsize=</span><span class="s4">0</span><span class="s0">,</span>
                <span class="s1">color=</span><span class="s3">'cyan'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5.5</span><span class="s1">))</span>
    <span class="s1">ax.set_title(</span><span class="s3">'Errorbar upper and lower limits'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_errorbar_nonefmt():</span>
    <span class="s2"># Check that passing 'none' as a format still plots errorbars</span>
    <span class="s1">x = np.arange(</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">plotline</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">barlines = plt.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'none'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">plotline </span><span class="s0">is None</span>
    <span class="s0">for </span><span class="s1">errbar </span><span class="s0">in </span><span class="s1">barlines:</span>
        <span class="s0">assert </span><span class="s1">np.all(errbar.get_color() == mcolors.to_rgba(</span><span class="s3">'C0'</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_errorbar_line_specific_kwargs():</span>
    <span class="s2"># Check that passing line-specific keyword arguments will not result in</span>
    <span class="s2"># errors.</span>
    <span class="s1">x = np.arange(</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">plotline</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">_ = plt.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'None'</span><span class="s0">,</span>
                                  <span class="s1">marker=</span><span class="s3">'s'</span><span class="s0">, </span><span class="s1">fillstyle=</span><span class="s3">'full'</span><span class="s0">,</span>
                                  <span class="s1">drawstyle=</span><span class="s3">'steps-mid'</span><span class="s0">,</span>
                                  <span class="s1">dash_capstyle=</span><span class="s3">'round'</span><span class="s0">,</span>
                                  <span class="s1">dash_joinstyle=</span><span class="s3">'miter'</span><span class="s0">,</span>
                                  <span class="s1">solid_capstyle=</span><span class="s3">'butt'</span><span class="s0">,</span>
                                  <span class="s1">solid_joinstyle=</span><span class="s3">'bevel'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">plotline.get_fillstyle() == </span><span class="s3">'full'</span>
    <span class="s0">assert </span><span class="s1">plotline.get_drawstyle() == </span><span class="s3">'steps-mid'</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_with_prop_cycle(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.errorbar(x=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.5</span><span class="s0">,</span>
                <span class="s1">ls=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'s'</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">ax.errorbar(x=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'tab:green'</span><span class="s0">,</span>
                <span class="s1">ls=</span><span class="s3">':'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'s'</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">'y'</span><span class="s1">)</span>
    <span class="s1">ax.errorbar(x=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'tab:blue'</span><span class="s0">,</span>
                <span class="s1">ls=</span><span class="s3">'-.'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">'c'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span>

    <span class="s1">_cycle = cycler(ls=[</span><span class="s3">'--'</span><span class="s0">, </span><span class="s3">':'</span><span class="s0">, </span><span class="s3">'-.'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=[</span><span class="s3">'s'</span><span class="s0">, </span><span class="s3">'s'</span><span class="s0">, </span><span class="s3">'o'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">mfc=[</span><span class="s3">'k'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s0">, </span><span class="s3">'c'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=[</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s0">, </span><span class="s3">'r'</span><span class="s1">])</span>
    <span class="s1">plt.rc(</span><span class="s3">&quot;axes&quot;</span><span class="s0">, </span><span class="s1">prop_cycle=_cycle)</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.errorbar(x=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">ax.errorbar(x=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'tab:green'</span><span class="s1">)</span>
    <span class="s1">ax.errorbar(x=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'tab:blue'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_errorbar_every_invalid():</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">15</span><span class="s1">)</span>
    <span class="s1">y = x * (</span><span class="s4">1</span><span class="s1">-x)</span>
    <span class="s1">yerr = y/</span><span class="s4">6</span>

    <span class="s1">ax = plt.figure().subplots()</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'not a tuple of two integers'</span><span class="s1">):</span>
        <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">errorevery=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'not a tuple of two integers'</span><span class="s1">):</span>
        <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">errorevery=(</span><span class="s4">1.3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'not a valid NumPy fancy index'</span><span class="s1">):</span>
        <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">errorevery=[</span><span class="s0">False, True</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'not a recognized value'</span><span class="s1">):</span>
        <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">errorevery=</span><span class="s3">'foobar'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_xerr_yerr_not_negative():</span>
    <span class="s1">ax = plt.figure().subplots()</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;'xerr' must not contain negative values&quot;</span><span class="s1">):</span>
        <span class="s1">ax.errorbar(x=[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xerr=[[-</span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">yerr=[[-</span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;'xerr' must not contain negative values&quot;</span><span class="s1">):</span>
        <span class="s1">ax.errorbar(x=[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xerr=[[-</span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;'yerr' must not contain negative values&quot;</span><span class="s1">):</span>
        <span class="s1">ax.errorbar(x=[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=[[-</span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;'yerr' must not contain negative values&quot;</span><span class="s1">):</span>
        <span class="s1">x = np.arange(</span><span class="s4">5</span><span class="s1">)</span>
        <span class="s1">y = [datetime.datetime(</span><span class="s4">2021</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s1">i * </span><span class="s4">2 </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">x]</span>
        <span class="s1">ax.errorbar(x=x</span><span class="s0">,</span>
                    <span class="s1">y=y</span><span class="s0">,</span>
                    <span class="s1">yerr=datetime.timedelta(days=-</span><span class="s4">10</span><span class="s1">))</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_errorbar_every(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">15</span><span class="s1">)</span>
    <span class="s1">y = x * (</span><span class="s4">1</span><span class="s1">-x)</span>
    <span class="s1">yerr = y/</span><span class="s4">6</span>

    <span class="s1">ax_ref = fig_ref.subplots()</span>
    <span class="s1">ax_test = fig_test.subplots()</span>

    <span class="s0">for </span><span class="s1">color</span><span class="s0">, </span><span class="s1">shift </span><span class="s0">in </span><span class="s1">zip(</span><span class="s3">'rgbk'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]):</span>
        <span class="s1">y += </span><span class="s4">.02</span>

        <span class="s2"># Check errorevery using an explicit offset and step.</span>
        <span class="s1">ax_test.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">errorevery=(shift</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">,</span>
                         <span class="s1">capsize=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">c=color)</span>

        <span class="s2"># Using manual errorbars</span>
        <span class="s2"># n.b. errorbar draws the main plot at z=2.1 by default</span>
        <span class="s1">ax_ref.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c=color</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">2.1</span><span class="s1">)</span>
        <span class="s1">ax_ref.errorbar(x[shift::</span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[shift::</span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr[shift::</span><span class="s4">4</span><span class="s1">]</span><span class="s0">,</span>
                        <span class="s1">capsize=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">c=color</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'none'</span><span class="s1">)</span>

    <span class="s2"># Check that markevery is propagated to line, without affecting errorbars.</span>
    <span class="s1">ax_test.errorbar(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s4">0.1</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">markevery=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">capsize=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">ax_ref.plot(x[</span><span class="s4">1</span><span class="s1">::</span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">1</span><span class="s1">::</span><span class="s4">4</span><span class="s1">] + </span><span class="s4">0.1</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">2.1</span><span class="s1">)</span>
    <span class="s1">ax_ref.errorbar(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s4">0.1</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">capsize=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'none'</span><span class="s1">)</span>

    <span class="s2"># Check that passing a slice to markevery/errorevery works.</span>
    <span class="s1">ax_test.errorbar(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">errorevery=slice(</span><span class="s4">2</span><span class="s0">, None, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">markevery=slice(</span><span class="s4">2</span><span class="s0">, None, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">capsize=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'C0'</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">ax_ref.plot(x[</span><span class="s4">2</span><span class="s1">::</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">2</span><span class="s1">::</span><span class="s4">3</span><span class="s1">] + </span><span class="s4">0.2</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'C0'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">2.1</span><span class="s1">)</span>
    <span class="s1">ax_ref.errorbar(x[</span><span class="s4">2</span><span class="s1">::</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">2</span><span class="s1">::</span><span class="s4">3</span><span class="s1">] + </span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">yerr[</span><span class="s4">2</span><span class="s1">::</span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">capsize=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'C0'</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'none'</span><span class="s1">)</span>

    <span class="s2"># Check that passing an iterable to markevery/errorevery works.</span>
    <span class="s1">ax_test.errorbar(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">yerr</span><span class="s0">, </span><span class="s1">errorevery=[</span><span class="s0">False, True, False</span><span class="s1">] * </span><span class="s4">5</span><span class="s0">,</span>
                     <span class="s1">markevery=[</span><span class="s0">False, True, False</span><span class="s1">] * </span><span class="s4">5</span><span class="s0">,</span>
                     <span class="s1">capsize=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'C1'</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">ax_ref.plot(x[</span><span class="s4">1</span><span class="s1">::</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">1</span><span class="s1">::</span><span class="s4">3</span><span class="s1">] + </span><span class="s4">0.2</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'C1'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">2.1</span><span class="s1">)</span>
    <span class="s1">ax_ref.errorbar(x[</span><span class="s4">1</span><span class="s1">::</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">1</span><span class="s1">::</span><span class="s4">3</span><span class="s1">] + </span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">yerr[</span><span class="s4">1</span><span class="s1">::</span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">capsize=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'C1'</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">'none'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'elinewidth'</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">,</span>
                                        <span class="s1">np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span><span class="s0">,</span>
                                        <span class="s4">1</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_linewidth_type(elinewidth):</span>
    <span class="s1">plt.errorbar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">elinewidth=elinewidth)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_nan(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.add_subplot()</span>
    <span class="s1">xs = range(</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">ys = np.array([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">es = np.array([</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span>
    <span class="s1">ax.errorbar(xs</span><span class="s0">, </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">es)</span>
    <span class="s1">ax = fig_ref.add_subplot()</span>
    <span class="s1">ax.errorbar([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
    <span class="s1">ax.errorbar([</span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s3">&quot;C0&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_stacked_stepfilled'</span><span class="s0">, </span><span class="s3">'hist_stacked_stepfilled'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_stepfilled():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">d2 = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist((d1</span><span class="s0">, </span><span class="s1">d2)</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;stepfilled&quot;</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;x&quot;</span><span class="s1">: (d1</span><span class="s0">, </span><span class="s1">d2)}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(</span><span class="s3">&quot;x&quot;</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;stepfilled&quot;</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True, </span><span class="s1">data=data)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_offset'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_offset():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>
    <span class="s1">d2 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(d1</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">ax.hist(d2</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s4">15</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_step.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hist_step():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(d1</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;step&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_step_horiz.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_step_horiz():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>
    <span class="s1">d2 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist((d1</span><span class="s0">, </span><span class="s1">d2)</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;step&quot;</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s3">&quot;horizontal&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_stacked_weights'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_weighted():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>
    <span class="s1">d2 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">w1 = np.linspace(</span><span class="s4">0.01</span><span class="s0">, </span><span class="s4">3.5</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>
    <span class="s1">w2 = np.linspace(</span><span class="s4">0.05</span><span class="s0">, </span><span class="s4">2.</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist((d1</span><span class="s0">, </span><span class="s1">d2)</span><span class="s0">, </span><span class="s1">weights=(w1</span><span class="s0">, </span><span class="s1">w2)</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;stepfilled&quot;</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;use_line_collection&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">ids=[</span><span class="s3">'w/ line collection'</span><span class="s0">, </span><span class="s3">'w/o line collection'</span><span class="s1">])</span>
<span class="s1">@image_comparison([</span><span class="s3">'stem.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_stem(use_line_collection):</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">2 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2"># Label is a single space to force a legend to be drawn, but to avoid any</span>
    <span class="s2"># text being drawn</span>
    <span class="s0">if </span><span class="s1">use_line_collection:</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">np.cos(x)</span><span class="s0">,</span>
                <span class="s1">linefmt=</span><span class="s3">'C2-.'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'k+'</span><span class="s0">, </span><span class="s1">basefmt=</span><span class="s3">'C1-.'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">' '</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">with </span><span class="s1">pytest.warns(MatplotlibDeprecationWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'deprecated'</span><span class="s1">):</span>
            <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">np.cos(x)</span><span class="s0">,</span>
                    <span class="s1">linefmt=</span><span class="s3">'C2-.'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'k+'</span><span class="s0">, </span><span class="s1">basefmt=</span><span class="s3">'C1-.'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">' '</span><span class="s0">,</span>
                    <span class="s1">use_line_collection=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>


<span class="s0">def </span><span class="s1">test_stem_args():</span>
    <span class="s5">&quot;&quot;&quot;Test that stem() correctly identifies x and y values.&quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">_assert_equal(stem_container</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s1">x</span><span class="s0">, </span><span class="s1">y = map(list</span><span class="s0">, </span><span class="s1">stem_container.markerline.get_data())</span>
        <span class="s0">assert </span><span class="s1">x == expected[</span><span class="s4">0</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">y == expected[</span><span class="s4">1</span><span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">x = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">9</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>

    <span class="s2"># Test the call signatures</span>
    <span class="s1">_assert_equal(ax.stem(y)</span><span class="s0">, </span><span class="s1">expected=([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y))</span>
    <span class="s1">_assert_equal(ax.stem(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">expected=(x</span><span class="s0">, </span><span class="s1">y))</span>
    <span class="s1">_assert_equal(ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">linefmt=</span><span class="s3">'r--'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected=(x</span><span class="s0">, </span><span class="s1">y))</span>
    <span class="s1">_assert_equal(ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'r--'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected=(x</span><span class="s0">, </span><span class="s1">y))</span>
    <span class="s1">_assert_equal(ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">linefmt=</span><span class="s3">'r--'</span><span class="s0">, </span><span class="s1">basefmt=</span><span class="s3">'b--'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected=(x</span><span class="s0">, </span><span class="s1">y))</span>
    <span class="s1">_assert_equal(ax.stem(y</span><span class="s0">, </span><span class="s1">linefmt=</span><span class="s3">'r--'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected=([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y))</span>
    <span class="s1">_assert_equal(ax.stem(y</span><span class="s0">, </span><span class="s3">'r--'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">expected=([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y))</span>


<span class="s0">def </span><span class="s1">test_stem_markerfmt():</span>
    <span class="s5">&quot;&quot;&quot;Test that stem(..., markerfmt=...) produces the intended markers.&quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">_assert_equal(stem_container</span><span class="s0">, </span><span class="s1">linecolor=</span><span class="s0">None, </span><span class="s1">markercolor=</span><span class="s0">None,</span>
                      <span class="s1">marker=</span><span class="s0">None</span><span class="s1">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Check that the given StemContainer has the properties listed as 
        keyword-arguments. 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">linecolor </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s0">assert </span><span class="s1">mcolors.same_color(</span>
                <span class="s1">stem_container.stemlines.get_color()</span><span class="s0">,</span>
                <span class="s1">linecolor)</span>
        <span class="s0">if </span><span class="s1">markercolor </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s0">assert </span><span class="s1">mcolors.same_color(</span>
                <span class="s1">stem_container.markerline.get_color()</span><span class="s0">,</span>
                <span class="s1">markercolor)</span>
        <span class="s0">if </span><span class="s1">marker </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s0">assert </span><span class="s1">stem_container.markerline.get_marker() == marker</span>
        <span class="s0">assert </span><span class="s1">stem_container.markerline.get_linestyle() == </span><span class="s3">'None'</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">x = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s1">y = [</span><span class="s4">9</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>

    <span class="s2"># no linefmt</span>
    <span class="s1">_assert_equal(ax.stem(x</span><span class="s0">, </span><span class="s1">y)</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'C0'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'x'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'C0'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'rx'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s1">)</span>

    <span class="s2"># positional linefmt</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># marker color follows linefmt if not given</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'rx'</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># the marker is currently not taken from linefmt</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'x'</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># only marker type specified</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'g'</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># only marker color specified</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'gx'</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># marker type and color specified</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">' '</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># markerfmt=' ' for no marker</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'None'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">''</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># markerfmt='' for no marker</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'None'</span><span class="s1">)</span>

    <span class="s2"># with linefmt kwarg</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">linefmt=</span><span class="s3">'r'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">linefmt=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'x'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s1">)</span>
    <span class="s1">_assert_equal(</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">linefmt=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'gx'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">linecolor=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">markercolor=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">'x'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_stem_dates():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">xs = [dateutil.parser.parse(</span><span class="s3">&quot;2013-9-28 11:00:00&quot;</span><span class="s1">)</span><span class="s0">,</span>
          <span class="s1">dateutil.parser.parse(</span><span class="s3">&quot;2013-9-28 12:00:00&quot;</span><span class="s1">)]</span>
    <span class="s1">ys = [</span><span class="s4">100</span><span class="s0">, </span><span class="s4">200</span><span class="s1">]</span>
    <span class="s1">ax.stem(xs</span><span class="s0">, </span><span class="s1">ys)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;use_line_collection&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">ids=[</span><span class="s3">'w/ line collection'</span><span class="s0">, </span><span class="s3">'w/o line collection'</span><span class="s1">])</span>
<span class="s1">@image_comparison([</span><span class="s3">'stem_orientation.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_stem_orientation(use_line_collection):</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*np.pi</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">if </span><span class="s1">use_line_collection:</span>
        <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">np.cos(x)</span><span class="s0">,</span>
                <span class="s1">linefmt=</span><span class="s3">'C2-.'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'kx'</span><span class="s0">, </span><span class="s1">basefmt=</span><span class="s3">'C1-.'</span><span class="s0">,</span>
                <span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">with </span><span class="s1">pytest.warns(MatplotlibDeprecationWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'deprecated'</span><span class="s1">):</span>
            <span class="s1">ax.stem(x</span><span class="s0">, </span><span class="s1">np.cos(x)</span><span class="s0">,</span>
                    <span class="s1">linefmt=</span><span class="s3">'C2-.'</span><span class="s0">, </span><span class="s1">markerfmt=</span><span class="s3">'kx'</span><span class="s0">, </span><span class="s1">basefmt=</span><span class="s3">'C1-.'</span><span class="s0">,</span>
                    <span class="s1">use_line_collection=</span><span class="s0">False,</span>
                    <span class="s1">orientation=</span><span class="s3">'horizontal'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_stacked_stepfilled_alpha'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_stepfilled_alpha():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">d2 = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist((d1</span><span class="s0">, </span><span class="s1">d2)</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;stepfilled&quot;</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True, </span><span class="s1">alpha=</span><span class="s4">0.5</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_stacked_step'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_step():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">d2 = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist((d1</span><span class="s0">, </span><span class="s1">d2)</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;step&quot;</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_stacked_normed'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_density():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">d2 = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist((d1</span><span class="s0">, </span><span class="s1">d2)</span><span class="s0">, </span><span class="s1">stacked=</span><span class="s0">True, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_step_bottom.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hist_step_bottom():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d1 = np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(d1</span><span class="s0">, </span><span class="s1">bottom=np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;stepfilled&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hist_stepfilled_geometry():</span>
    <span class="s1">bins = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">data = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">(polygon</span><span class="s0">, </span><span class="s1">) = plt.hist(data</span><span class="s0">,</span>
                                 <span class="s1">bins=bins</span><span class="s0">,</span>
                                 <span class="s1">histtype=</span><span class="s3">'stepfilled'</span><span class="s1">)</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
          <span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>


<span class="s0">def </span><span class="s1">test_hist_step_geometry():</span>
    <span class="s1">bins = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">data = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">(polygon</span><span class="s0">, </span><span class="s1">) = plt.hist(data</span><span class="s0">,</span>
                                 <span class="s1">bins=bins</span><span class="s0">,</span>
                                 <span class="s1">histtype=</span><span class="s3">'step'</span><span class="s1">)</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>


<span class="s0">def </span><span class="s1">test_hist_stepfilled_bottom_geometry():</span>
    <span class="s1">bins = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">data = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">(polygon</span><span class="s0">, </span><span class="s1">) = plt.hist(data</span><span class="s0">,</span>
                                 <span class="s1">bins=bins</span><span class="s0">,</span>
                                 <span class="s1">bottom=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">histtype=</span><span class="s3">'stepfilled'</span><span class="s1">)</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">,</span>
          <span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>


<span class="s0">def </span><span class="s1">test_hist_step_bottom_geometry():</span>
    <span class="s1">bins = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">data = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">(polygon</span><span class="s0">, </span><span class="s1">) = plt.hist(data</span><span class="s0">,</span>
                                 <span class="s1">bins=bins</span><span class="s0">,</span>
                                 <span class="s1">bottom=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">histtype=</span><span class="s3">'step'</span><span class="s1">)</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>


<span class="s0">def </span><span class="s1">test_hist_stacked_stepfilled_geometry():</span>
    <span class="s1">bins = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">data_1 = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">data_2 = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">patches = plt.hist([data_1</span><span class="s0">, </span><span class="s1">data_2]</span><span class="s0">,</span>
                             <span class="s1">bins=bins</span><span class="s0">,</span>
                             <span class="s1">stacked=</span><span class="s0">True,</span>
                             <span class="s1">histtype=</span><span class="s3">'stepfilled'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">len(patches) == </span><span class="s4">2</span>

    <span class="s1">polygon</span><span class="s0">,  </span><span class="s1">= patches[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
          <span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>

    <span class="s1">polygon</span><span class="s0">,  </span><span class="s1">= patches[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
          <span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>


<span class="s0">def </span><span class="s1">test_hist_stacked_step_geometry():</span>
    <span class="s1">bins = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">data_1 = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">data_2 = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">patches = plt.hist([data_1</span><span class="s0">, </span><span class="s1">data_2]</span><span class="s0">,</span>
                             <span class="s1">bins=bins</span><span class="s0">,</span>
                             <span class="s1">stacked=</span><span class="s0">True,</span>
                             <span class="s1">histtype=</span><span class="s3">'step'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">len(patches) == </span><span class="s4">2</span>

    <span class="s1">polygon</span><span class="s0">,  </span><span class="s1">= patches[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>

    <span class="s1">polygon</span><span class="s0">,  </span><span class="s1">= patches[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>


<span class="s0">def </span><span class="s1">test_hist_stacked_stepfilled_bottom_geometry():</span>
    <span class="s1">bins = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">data_1 = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">data_2 = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">patches = plt.hist([data_1</span><span class="s0">, </span><span class="s1">data_2]</span><span class="s0">,</span>
                             <span class="s1">bins=bins</span><span class="s0">,</span>
                             <span class="s1">stacked=</span><span class="s0">True,</span>
                             <span class="s1">bottom=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">histtype=</span><span class="s3">'stepfilled'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">len(patches) == </span><span class="s4">2</span>

    <span class="s1">polygon</span><span class="s0">,  </span><span class="s1">= patches[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">,</span>
          <span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>

    <span class="s1">polygon</span><span class="s0">,  </span><span class="s1">= patches[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3.5</span><span class="s1">]</span><span class="s0">,</span>
          <span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>


<span class="s0">def </span><span class="s1">test_hist_stacked_step_bottom_geometry():</span>
    <span class="s1">bins = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">data_1 = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">data_2 = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">patches = plt.hist([data_1</span><span class="s0">, </span><span class="s1">data_2]</span><span class="s0">,</span>
                             <span class="s1">bins=bins</span><span class="s0">,</span>
                             <span class="s1">stacked=</span><span class="s0">True,</span>
                             <span class="s1">bottom=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span><span class="s0">,</span>
                             <span class="s1">histtype=</span><span class="s3">'step'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">len(patches) == </span><span class="s4">2</span>

    <span class="s1">polygon</span><span class="s0">,  </span><span class="s1">= patches[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>

    <span class="s1">polygon</span><span class="s0">,  </span><span class="s1">= patches[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">xy = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]]</span>
    <span class="s1">assert_array_equal(polygon.get_xy()</span><span class="s0">, </span><span class="s1">xy)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hist_stacked_bar'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_bar():</span>
    <span class="s2"># make some data</span>
    <span class="s1">d = [[</span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">320</span><span class="s0">, </span><span class="s4">450</span><span class="s0">, </span><span class="s4">80</span><span class="s0">, </span><span class="s4">20</span><span class="s0">, </span><span class="s4">600</span><span class="s0">, </span><span class="s4">310</span><span class="s0">, </span><span class="s4">800</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s4">20</span><span class="s0">, </span><span class="s4">23</span><span class="s0">, </span><span class="s4">50</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">420</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">120</span><span class="s0">, </span><span class="s4">120</span><span class="s0">, </span><span class="s4">120</span><span class="s0">, </span><span class="s4">140</span><span class="s0">, </span><span class="s4">140</span><span class="s0">, </span><span class="s4">150</span><span class="s0">, </span><span class="s4">180</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s4">60</span><span class="s0">, </span><span class="s4">60</span><span class="s0">, </span><span class="s4">60</span><span class="s0">, </span><span class="s4">60</span><span class="s0">, </span><span class="s4">300</span><span class="s0">, </span><span class="s4">300</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">300</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s4">555</span><span class="s0">, </span><span class="s4">555</span><span class="s0">, </span><span class="s4">555</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s1">]</span><span class="s0">,</span>
         <span class="s1">[</span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">400</span><span class="s0">, </span><span class="s4">400</span><span class="s0">, </span><span class="s4">400</span><span class="s0">, </span><span class="s4">400</span><span class="s0">, </span><span class="s4">400</span><span class="s0">, </span><span class="s4">400</span><span class="s0">, </span><span class="s4">400</span><span class="s0">, </span><span class="s4">400</span><span class="s1">]]</span>
    <span class="s1">colors = [(</span><span class="s4">0.5759849696758961</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">0.350624650815206</span><span class="s1">)</span><span class="s0">,</span>
              <span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">0.6549834156005998</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.6569064625276622</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)</span><span class="s0">,</span>
              <span class="s1">(</span><span class="s4">0.28302699607823545</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.6849123462299822</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)]</span>
    <span class="s1">labels = [</span><span class="s3">'green'</span><span class="s0">, </span><span class="s3">'orange'</span><span class="s0">, </span><span class="s3">' yellow'</span><span class="s0">, </span><span class="s3">'magenta'</span><span class="s0">, </span><span class="s3">'black'</span><span class="s1">]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(d</span><span class="s0">, </span><span class="s1">bins=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">'barstacked'</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">'mid'</span><span class="s0">, </span><span class="s1">color=colors</span><span class="s0">,</span>
            <span class="s1">label=labels)</span>
    <span class="s1">ax.legend(loc=</span><span class="s3">'upper right'</span><span class="s0">, </span><span class="s1">bbox_to_anchor=(</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s4">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hist_barstacked_bottom_unchanged():</span>
    <span class="s1">b = np.array([</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s1">])</span>
    <span class="s1">plt.hist([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;barstacked&quot;</span><span class="s0">, </span><span class="s1">bottom=b)</span>
    <span class="s0">assert </span><span class="s1">b.tolist() == [</span><span class="s4">10</span><span class="s0">, </span><span class="s4">20</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_hist_emptydata():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist([[]</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">histtype=</span><span class="s3">&quot;step&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hist_labels():</span>
    <span class="s2"># test singleton labels OK</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">bars = ax.hist([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">bars[</span><span class="s4">0</span><span class="s1">].get_label() == </span><span class="s3">'0'</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">bars = ax.hist([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">bars[</span><span class="s4">0</span><span class="s1">].get_label() == </span><span class="s3">'0'</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">bars = ax.hist([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">bars[</span><span class="s4">0</span><span class="s1">].get_label() == </span><span class="s3">'_nolegend_'</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">bars = ax.hist([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'0'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">bars[</span><span class="s4">0</span><span class="s1">].get_label() == </span><span class="s3">'0'</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">bars = ax.hist([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'00'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">bars[</span><span class="s4">0</span><span class="s1">].get_label() == </span><span class="s3">'00'</span>


<span class="s1">@image_comparison([</span><span class="s3">'transparent_markers'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_transparent_markers():</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">data = np.random.random(</span><span class="s4">50</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(data</span><span class="s0">, </span><span class="s3">'D'</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">markersize=</span><span class="s4">100</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'rgba_markers'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_rgba_markers():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(ncols=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">rcolors = [(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)]</span>
    <span class="s1">bcolors = [(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)]</span>
    <span class="s1">alphas = [</span><span class="s0">None, </span><span class="s4">0.2</span><span class="s1">]</span>
    <span class="s1">kw = dict(ms=</span><span class="s4">100</span><span class="s0">, </span><span class="s1">mew=</span><span class="s4">20</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">alpha </span><span class="s0">in </span><span class="s1">enumerate(alphas):</span>
        <span class="s0">for </span><span class="s1">j</span><span class="s0">, </span><span class="s1">rcolor </span><span class="s0">in </span><span class="s1">enumerate(rcolors):</span>
            <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">bcolor </span><span class="s0">in </span><span class="s1">enumerate(bcolors):</span>
                <span class="s1">axs[i].plot(j+</span><span class="s4">1</span><span class="s0">, </span><span class="s1">k+</span><span class="s4">1</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">mfc=bcolor</span><span class="s0">, </span><span class="s1">mec=rcolor</span><span class="s0">,</span>
                            <span class="s1">alpha=alpha</span><span class="s0">, </span><span class="s1">**kw)</span>
                <span class="s1">axs[i].plot(j+</span><span class="s4">1</span><span class="s0">, </span><span class="s1">k+</span><span class="s4">3</span><span class="s0">, </span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">mec=rcolor</span><span class="s0">, </span><span class="s1">alpha=alpha</span><span class="s0">, </span><span class="s1">**kw)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs:</span>
        <span class="s1">ax.axis([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">'mollweide_grid'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_mollweide_grid():</span>
    <span class="s2"># test that both horizontal and vertical gridlines appear on the Mollweide</span>
    <span class="s2"># projection</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s3">'mollweide'</span><span class="s1">)</span>
    <span class="s1">ax.grid()</span>


<span class="s0">def </span><span class="s1">test_mollweide_forward_inverse_closure():</span>
    <span class="s2"># test that the round-trip Mollweide forward-&gt;inverse transformation is an</span>
    <span class="s2"># approximate identity</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s3">'mollweide'</span><span class="s1">)</span>

    <span class="s2"># set up 1-degree grid in longitude, latitude</span>
    <span class="s1">lon = np.linspace(-np.pi</span><span class="s0">, </span><span class="s1">np.pi</span><span class="s0">, </span><span class="s4">360</span><span class="s1">)</span>
    <span class="s1">lat = np.linspace(-np.pi / </span><span class="s4">2.0</span><span class="s0">, </span><span class="s1">np.pi / </span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">180</span><span class="s1">)</span>
    <span class="s1">lon</span><span class="s0">, </span><span class="s1">lat = np.meshgrid(lon</span><span class="s0">, </span><span class="s1">lat)</span>
    <span class="s1">ll = np.vstack((lon.flatten()</span><span class="s0">, </span><span class="s1">lat.flatten())).T</span>

    <span class="s2"># perform forward transform</span>
    <span class="s1">xy = ax.transProjection.transform(ll)</span>

    <span class="s2"># perform inverse transform</span>
    <span class="s1">ll2 = ax.transProjection.inverted().transform(xy)</span>

    <span class="s2"># compare</span>
    <span class="s1">np.testing.assert_array_almost_equal(ll</span><span class="s0">, </span><span class="s1">ll2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_mollweide_inverse_forward_closure():</span>
    <span class="s2"># test that the round-trip Mollweide inverse-&gt;forward transformation is an</span>
    <span class="s2"># approximate identity</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(projection=</span><span class="s3">'mollweide'</span><span class="s1">)</span>

    <span class="s2"># set up grid in x, y</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">500</span><span class="s1">)</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">x)</span>
    <span class="s1">xy = np.vstack((x.flatten()</span><span class="s0">, </span><span class="s1">y.flatten())).T</span>

    <span class="s2"># perform inverse transform</span>
    <span class="s1">ll = ax.transProjection.inverted().transform(xy)</span>

    <span class="s2"># perform forward transform</span>
    <span class="s1">xy2 = ax.transProjection.transform(ll)</span>

    <span class="s2"># compare</span>
    <span class="s1">np.testing.assert_array_almost_equal(xy</span><span class="s0">, </span><span class="s1">xy2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_alpha'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_alpha():</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">data = np.random.random(</span><span class="s4">50</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s2"># alpha=.5 markers, solid line</span>
    <span class="s1">ax.plot(data</span><span class="s0">, </span><span class="s3">'-D'</span><span class="s0">, </span><span class="s1">color=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mfc=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">markersize=</span><span class="s4">20</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2"># everything solid by kwarg</span>
    <span class="s1">ax.plot(data + </span><span class="s4">2</span><span class="s0">, </span><span class="s3">'-D'</span><span class="s0">, </span><span class="s1">color=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mfc=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">markersize=</span><span class="s4">20</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s0">,</span>
            <span class="s1">alpha=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s2"># everything alpha=.5 by kwarg</span>
    <span class="s1">ax.plot(data + </span><span class="s4">4</span><span class="s0">, </span><span class="s3">'-D'</span><span class="s0">, </span><span class="s1">color=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mfc=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">markersize=</span><span class="s4">20</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s0">,</span>
            <span class="s1">alpha=</span><span class="s4">.5</span><span class="s1">)</span>

    <span class="s2"># everything alpha=.5 by colors</span>
    <span class="s1">ax.plot(data + </span><span class="s4">6</span><span class="s0">, </span><span class="s3">'-D'</span><span class="s0">, </span><span class="s1">color=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mfc=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">markersize=</span><span class="s4">20</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2"># alpha=.5 line, solid markers</span>
    <span class="s1">ax.plot(data + </span><span class="s4">8</span><span class="s0">, </span><span class="s3">'-D'</span><span class="s0">, </span><span class="s1">color=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">mfc=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">markersize=</span><span class="s4">20</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'eventplot'</span><span class="s0">, </span><span class="s3">'eventplot'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_eventplot():</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>

    <span class="s1">data1 = np.random.random([</span><span class="s4">32</span><span class="s0">, </span><span class="s4">20</span><span class="s1">]).tolist()</span>
    <span class="s1">data2 = np.random.random([</span><span class="s4">6</span><span class="s0">, </span><span class="s4">20</span><span class="s1">]).tolist()</span>
    <span class="s1">data = data1 + data2</span>
    <span class="s1">num_datasets = len(data)</span>

    <span class="s1">colors1 = [[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">.7</span><span class="s1">]] * len(data1)</span>
    <span class="s1">colors2 = [[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">.75</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span>
    <span class="s1">colors = colors1 + colors2</span>

    <span class="s1">lineoffsets1 = </span><span class="s4">12 </span><span class="s1">+ np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">len(data1)) * </span><span class="s4">.33</span>
    <span class="s1">lineoffsets2 = [-</span><span class="s4">15</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">lineoffsets = lineoffsets1.tolist() + lineoffsets2</span>

    <span class="s1">linelengths1 = [</span><span class="s4">.33</span><span class="s1">] * len(data1)</span>
    <span class="s1">linelengths2 = [</span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">]</span>
    <span class="s1">linelengths = linelengths1 + linelengths2</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">axobj = fig.add_subplot()</span>
    <span class="s1">colls = axobj.eventplot(data</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">, </span><span class="s1">lineoffsets=lineoffsets</span><span class="s0">,</span>
                            <span class="s1">linelengths=linelengths)</span>

    <span class="s1">num_collections = len(colls)</span>
    <span class="s0">assert </span><span class="s1">num_collections == num_datasets</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;pos&quot;</span><span class="s1">: data</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">: colors</span><span class="s0">, </span><span class="s3">&quot;lo&quot;</span><span class="s1">: lineoffsets</span><span class="s0">, </span><span class="s3">&quot;ll&quot;</span><span class="s1">: linelengths}</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">axobj = fig.add_subplot()</span>
    <span class="s1">colls = axobj.eventplot(</span><span class="s3">&quot;pos&quot;</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s1">lineoffsets=</span><span class="s3">&quot;lo&quot;</span><span class="s0">,</span>
                            <span class="s1">linelengths=</span><span class="s3">&quot;ll&quot;</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">num_collections = len(colls)</span>
    <span class="s0">assert </span><span class="s1">num_collections == num_datasets</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_eventplot_defaults.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_eventplot_defaults():</span>
    <span class="s5">&quot;&quot;&quot; 
    test that eventplot produces the correct output given the default params 
    (see bug #3728) 
    &quot;&quot;&quot;</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>

    <span class="s1">data1 = np.random.random([</span><span class="s4">32</span><span class="s0">, </span><span class="s4">20</span><span class="s1">]).tolist()</span>
    <span class="s1">data2 = np.random.random([</span><span class="s4">6</span><span class="s0">, </span><span class="s4">20</span><span class="s1">]).tolist()</span>
    <span class="s1">data = data1 + data2</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">axobj = fig.add_subplot()</span>
    <span class="s1">axobj.eventplot(data)</span>


<span class="s1">@pytest.mark.parametrize((</span><span class="s3">'colors'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s3">'0.5'</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># string color with multiple characters: not OK before #8193 fix</span>
    <span class="s1">(</span><span class="s3">'tab:orange'</span><span class="s0">, </span><span class="s3">'tab:pink'</span><span class="s0">, </span><span class="s3">'tab:cyan'</span><span class="s0">, </span><span class="s3">'bLacK'</span><span class="s1">)</span><span class="s0">,  </span><span class="s2"># case-insensitive</span>
    <span class="s1">(</span><span class="s3">'red'</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, None, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">))</span><span class="s0">,  </span><span class="s2"># a tricky case mixing types</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_eventplot_colors(colors):</span>
    <span class="s5">&quot;&quot;&quot;Test the *colors* parameter of eventplot. Inspired by issue #8193.&quot;&quot;&quot;</span>
    <span class="s1">data = [[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s1">]]  </span><span class="s2"># 4 successive events of different nature</span>

    <span class="s2"># Build the list of the expected colors</span>
    <span class="s1">expected = [c </span><span class="s0">if </span><span class="s1">c </span><span class="s0">is not None else </span><span class="s3">'C0' </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">colors]</span>
    <span class="s2"># Convert the list into an array of RGBA values</span>
    <span class="s2"># NB: ['rgbk'] is not a valid argument for to_rgba_array, while 'rgbk' is.</span>
    <span class="s0">if </span><span class="s1">len(expected) == </span><span class="s4">1</span><span class="s1">:</span>
        <span class="s1">expected = expected[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">expected = np.broadcast_to(mcolors.to_rgba_array(expected)</span><span class="s0">, </span><span class="s1">(len(data)</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">if </span><span class="s1">len(colors) == </span><span class="s4">1</span><span class="s1">:  </span><span class="s2"># tuple with a single string (like '0.5' or 'rgbk')</span>
        <span class="s1">colors = colors[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">collections = ax.eventplot(data</span><span class="s0">, </span><span class="s1">colors=colors)</span>

    <span class="s0">for </span><span class="s1">coll</span><span class="s0">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip(collections</span><span class="s0">, </span><span class="s1">expected):</span>
        <span class="s1">assert_allclose(coll.get_color()</span><span class="s0">, </span><span class="s1">color)</span>


<span class="s0">def </span><span class="s1">test_eventplot_alpha():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s2"># one alpha for all</span>
    <span class="s1">collections = ax.eventplot([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.7</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">collections[</span><span class="s4">0</span><span class="s1">].get_alpha() == </span><span class="s4">0.7</span>
    <span class="s0">assert </span><span class="s1">collections[</span><span class="s4">1</span><span class="s1">].get_alpha() == </span><span class="s4">0.7</span>

    <span class="s2"># one alpha per collection</span>
    <span class="s1">collections = ax.eventplot([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">alpha=[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.7</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">collections[</span><span class="s4">0</span><span class="s1">].get_alpha() == </span><span class="s4">0.5</span>
    <span class="s0">assert </span><span class="s1">collections[</span><span class="s4">1</span><span class="s1">].get_alpha() == </span><span class="s4">0.7</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;alpha and positions are unequal&quot;</span><span class="s1">):</span>
        <span class="s1">ax.eventplot([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">alpha=[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.7</span><span class="s0">, </span><span class="s4">0.9</span><span class="s1">])</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;alpha and positions are unequal&quot;</span><span class="s1">):</span>
        <span class="s1">ax.eventplot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">alpha=[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.7</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_eventplot_problem_kwargs.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_eventplot_problem_kwargs(recwarn):</span>
    <span class="s5">&quot;&quot;&quot; 
    test that 'singular' versions of LineCollection props raise an 
    MatplotlibDeprecationWarning rather than overriding the 'plural' versions 
    (e.g., to prevent 'color' from overriding 'colors', see issue #4297) 
    &quot;&quot;&quot;</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>

    <span class="s1">data1 = np.random.random([</span><span class="s4">20</span><span class="s1">]).tolist()</span>
    <span class="s1">data2 = np.random.random([</span><span class="s4">10</span><span class="s1">]).tolist()</span>
    <span class="s1">data = [data1</span><span class="s0">, </span><span class="s1">data2]</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">axobj = fig.add_subplot()</span>

    <span class="s1">axobj.eventplot(data</span><span class="s0">,</span>
                    <span class="s1">colors=[</span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">color=[</span><span class="s3">'c'</span><span class="s0">, </span><span class="s3">'m'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">linewidths=[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">linewidth=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">linestyles=[</span><span class="s3">'solid'</span><span class="s0">, </span><span class="s3">'dashed'</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">linestyle=[</span><span class="s3">'dashdot'</span><span class="s0">, </span><span class="s3">'dotted'</span><span class="s1">])</span>

    <span class="s0">assert </span><span class="s1">len(recwarn) == </span><span class="s4">3</span>
    <span class="s0">assert </span><span class="s1">all(issubclass(wi.category</span><span class="s0">, </span><span class="s1">MatplotlibDeprecationWarning)</span>
               <span class="s0">for </span><span class="s1">wi </span><span class="s0">in </span><span class="s1">recwarn)</span>


<span class="s0">def </span><span class="s1">test_empty_eventplot():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.eventplot([[]]</span><span class="s0">, </span><span class="s1">colors=[(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s1">)])</span>
    <span class="s1">plt.draw()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'data'</span><span class="s0">, </span><span class="s1">[[[]]</span><span class="s0">, </span><span class="s1">[[]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[]]])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'orientation'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s3">'vertical'</span><span class="s0">, </span><span class="s3">'horizontal'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_eventplot_orientation(data</span><span class="s0">, </span><span class="s1">orientation):</span>
    <span class="s5">&quot;&quot;&quot;Introduced when fixing issue #6412.&quot;&quot;&quot;</span>
    <span class="s1">opts = {} </span><span class="s0">if </span><span class="s1">orientation </span><span class="s0">is None else </span><span class="s1">{</span><span class="s3">'orientation'</span><span class="s1">: orientation}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.eventplot(data</span><span class="s0">, </span><span class="s1">**opts)</span>
    <span class="s1">plt.draw()</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_eventplot_units_list(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># test that list of lists converted properly:</span>
    <span class="s1">ts_1 = [datetime.datetime(</span><span class="s4">2021</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2021</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">datetime.datetime(</span><span class="s4">2021</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span>
    <span class="s1">ts_2 = [datetime.datetime(</span><span class="s4">2021</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime.datetime(</span><span class="s4">2021</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">16</span><span class="s1">)]</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.eventplot(ts_1</span><span class="s0">, </span><span class="s1">lineoffsets=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ax.eventplot(ts_2</span><span class="s0">, </span><span class="s1">lineoffsets=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.eventplot([ts_1</span><span class="s0">, </span><span class="s1">ts_2])</span>


<span class="s1">@image_comparison([</span><span class="s3">'marker_styles.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_marker_styles():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2"># Since generation of the test image, None was removed but 'none' was</span>
    <span class="s2"># added. By moving 'none' to the front (=former sorted place of None)</span>
    <span class="s2"># we can avoid regenerating the test image. This can be removed if the</span>
    <span class="s2"># test image has to be regenerated for other reasons.</span>
    <span class="s1">markers = sorted(matplotlib.markers.MarkerStyle.markers</span><span class="s0">,</span>
                     <span class="s1">key=</span><span class="s0">lambda </span><span class="s1">x: str(type(x))+str(x))</span>
    <span class="s1">markers.remove(</span><span class="s3">'none'</span><span class="s1">)</span>
    <span class="s1">markers = [</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">*markers]</span>
    <span class="s0">for </span><span class="s1">y</span><span class="s0">, </span><span class="s1">marker </span><span class="s0">in </span><span class="s1">enumerate(markers):</span>
        <span class="s1">ax.plot((y % </span><span class="s4">2</span><span class="s1">)*</span><span class="s4">5 </span><span class="s1">+ np.arange(</span><span class="s4">10</span><span class="s1">)*</span><span class="s4">10</span><span class="s0">, </span><span class="s1">np.ones(</span><span class="s4">10</span><span class="s1">)*</span><span class="s4">10</span><span class="s1">*y</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">''</span><span class="s0">,</span>
                <span class="s1">marker=marker</span><span class="s0">, </span><span class="s1">markersize=</span><span class="s4">10</span><span class="s1">+y/</span><span class="s4">5</span><span class="s0">, </span><span class="s1">label=marker)</span>


<span class="s1">@image_comparison([</span><span class="s3">'rc_markerfill.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_markers_fillstyle_rcparams():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s4">7</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">idx</span><span class="s0">, </span><span class="s1">(style</span><span class="s0">, </span><span class="s1">marker) </span><span class="s0">in </span><span class="s1">enumerate(</span>
            <span class="s1">[(</span><span class="s3">'top'</span><span class="s0">, </span><span class="s3">'s'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'bottom'</span><span class="s0">, </span><span class="s3">'o'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'none'</span><span class="s0">, </span><span class="s3">'^'</span><span class="s1">)]):</span>
        <span class="s1">matplotlib.rcParams[</span><span class="s3">'markers.fillstyle'</span><span class="s1">] = style</span>
        <span class="s1">ax.plot(x+idx</span><span class="s0">, </span><span class="s1">marker=marker)</span>


<span class="s1">@image_comparison([</span><span class="s3">'vertex_markers.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_vertex_markers():</span>
    <span class="s1">data = list(range(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">marker_as_tuple = ((-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">marker_as_list = [(-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(data</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">''</span><span class="s0">, </span><span class="s1">marker=marker_as_tuple</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">ax.plot(data[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">''</span><span class="s0">, </span><span class="s1">marker=marker_as_list</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">'b'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">])</span>
    <span class="s1">ax.set_ylim([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">'vline_hline_zorder'</span><span class="s0">, </span><span class="s3">'errorbar_zorder'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s4">0 </span><span class="s0">if </span><span class="s1">platform.machine() == </span><span class="s3">'x86_64' </span><span class="s0">else </span><span class="s4">0.02</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_eb_line_zorder():</span>
    <span class="s1">x = list(range(</span><span class="s4">10</span><span class="s1">))</span>

    <span class="s2"># First illustrate basic pyplot interface, using defaults where possible.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.gca()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">ax.axhline(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'red'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.axhline(</span><span class="s4">5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'green'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">ax.axvline(</span><span class="s4">7</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'m'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">7</span><span class="s1">)</span>
    <span class="s1">ax.axvline(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">3</span><span class="s1">)</span>

    <span class="s1">ax.set_title(</span><span class="s3">&quot;axvline and axhline zorder test&quot;</span><span class="s1">)</span>

    <span class="s2"># Now switch to a more OO interface to exercise more features.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.gca()</span>
    <span class="s1">x = list(range(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">y = np.zeros(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">yerr = list(range(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax.errorbar(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">yerr=yerr</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'r'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">):</span>
        <span class="s1">ax.axhline(j</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">zorder=j)</span>
        <span class="s1">ax.axhline(-j</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">zorder=j)</span>

    <span class="s1">ax.set_title(</span><span class="s3">&quot;errorbar zorder test&quot;</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_axline_loglog(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.set(xlim=(</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s4">1e-3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.loglog([</span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;.-&quot;</span><span class="s1">)</span>
    <span class="s1">ax.axline((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1e-3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">1e-2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">&quot;k&quot;</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.set(xlim=(</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s4">1e-3</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.loglog([</span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;.-&quot;</span><span class="s1">)</span>
    <span class="s1">ax.loglog([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1e-3</span><span class="s0">, </span><span class="s4">1e-2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">&quot;k&quot;</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_axline(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.set(xlim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C1'</span><span class="s1">)</span>
    <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C2'</span><span class="s1">)</span>
    <span class="s2"># slopes</span>
    <span class="s1">ax.axline((-</span><span class="s4">0.7</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C3'</span><span class="s1">)</span>
    <span class="s1">ax.axline((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C4'</span><span class="s1">)</span>
    <span class="s1">ax.axline((-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=float(</span><span class="s3">'inf'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C5'</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.set(xlim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.plot([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax.axhline(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C1'</span><span class="s1">)</span>
    <span class="s1">ax.axhline(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C2'</span><span class="s1">)</span>
    <span class="s2"># slopes</span>
    <span class="s1">ax.axhline(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C3'</span><span class="s1">)</span>
    <span class="s1">ax.plot([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C4'</span><span class="s1">)</span>
    <span class="s1">ax.axvline(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C5'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_axline_transaxes(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.set(xlim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">transform=ax.transAxes)</span>
    <span class="s1">ax.axline((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C1'</span><span class="s0">, </span><span class="s1">transform=ax.transAxes)</span>
    <span class="s1">ax.axline((</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C2'</span><span class="s0">, </span><span class="s1">transform=ax.transAxes)</span>
    <span class="s1">ax.axline((</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C3'</span><span class="s0">, </span><span class="s1">transform=ax.transAxes)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.set(xlim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.plot([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C1'</span><span class="s1">)</span>
    <span class="s1">ax.plot([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C2'</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C3'</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_axline_transaxes_panzoom(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># test that it is robust against pan/zoom and</span>
    <span class="s2"># figure resize after plotting</span>
    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.set(xlim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">transform=ax.transAxes)</span>
    <span class="s1">ax.axline((</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C1'</span><span class="s0">, </span><span class="s1">transform=ax.transAxes)</span>
    <span class="s1">ax.axline((</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C2'</span><span class="s0">, </span><span class="s1">transform=ax.transAxes)</span>
    <span class="s1">ax.set(xlim=(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">fig_test.set_size_inches(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>

    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.set(xlim=(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">fig_ref.set_size_inches(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
    <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C1'</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C2'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_axline_args():</span>
    <span class="s5">&quot;&quot;&quot;Exactly one of *xy2* and *slope* must be specified.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">))  </span><span class="s2"># missing second parameter</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">1</span><span class="s1">)  </span><span class="s2"># redundant parameters</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">'linear'</span><span class="s1">)</span>
    <span class="s1">ax.set_yscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">slope=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.set_yscale(</span><span class="s3">'linear'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.axline((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">))  </span><span class="s2"># two identical points are not allowed</span>
        <span class="s1">plt.draw()</span>


<span class="s1">@image_comparison([</span><span class="s3">'vlines_basic'</span><span class="s0">, </span><span class="s3">'vlines_with_nan'</span><span class="s0">, </span><span class="s3">'vlines_masked'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_vlines():</span>
    <span class="s2"># normal</span>
    <span class="s1">x1 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>
    <span class="s1">y1 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots()</span>
    <span class="s1">ax1.vlines(x1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">y1</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s2"># GH #7406</span>
    <span class="s1">x2 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>
    <span class="s1">y2 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">(ax2</span><span class="s0">, </span><span class="s1">ax3</span><span class="s0">, </span><span class="s1">ax4) = plt.subplots(nrows=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">8</span><span class="s1">))</span>
    <span class="s1">ax2.vlines(x2</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">x3 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>
    <span class="s1">y3 = [np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">ax3.vlines(x3</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">y3</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">'--'</span><span class="s1">)</span>

    <span class="s1">x4 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>
    <span class="s1">y4 = [np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s1">np.nan]</span>
    <span class="s1">ax4.vlines(x4</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">y4</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s2"># tweak the x-axis so we can see the lines better</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">[ax1</span><span class="s0">, </span><span class="s1">ax2</span><span class="s0">, </span><span class="s1">ax3</span><span class="s0">, </span><span class="s1">ax4]:</span>
        <span class="s1">ax.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2"># check that the y-lims are all automatically the same</span>
    <span class="s0">assert </span><span class="s1">ax1.get_ylim() == ax2.get_ylim()</span>
    <span class="s0">assert </span><span class="s1">ax1.get_ylim() == ax3.get_ylim()</span>
    <span class="s0">assert </span><span class="s1">ax1.get_ylim() == ax4.get_ylim()</span>

    <span class="s1">fig3</span><span class="s0">, </span><span class="s1">ax5 = plt.subplots()</span>
    <span class="s1">x5 = np.ma.masked_equal([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">12</span><span class="s1">]</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span>
    <span class="s1">ymin5 = np.ma.masked_equal([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ymax5 = np.ma.masked_equal([</span><span class="s4">13</span><span class="s0">, </span><span class="s4">14</span><span class="s0">, </span><span class="s4">15</span><span class="s0">, </span><span class="s4">16</span><span class="s0">, </span><span class="s4">17</span><span class="s0">, </span><span class="s4">18</span><span class="s1">]</span><span class="s0">, </span><span class="s4">18</span><span class="s1">)</span>
    <span class="s1">ax5.vlines(x5</span><span class="s0">, </span><span class="s1">ymin5</span><span class="s0">, </span><span class="s1">ymax5</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax5.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">15</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_vlines_default():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context({</span><span class="s3">'lines.color'</span><span class="s1">: </span><span class="s3">'red'</span><span class="s1">}):</span>
        <span class="s1">lines = ax.vlines(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(lines.get_color()</span><span class="s0">, </span><span class="s3">'red'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'hlines_basic'</span><span class="s0">, </span><span class="s3">'hlines_with_nan'</span><span class="s0">, </span><span class="s3">'hlines_masked'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_hlines():</span>
    <span class="s2"># normal</span>
    <span class="s1">y1 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>
    <span class="s1">x1 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots()</span>
    <span class="s1">ax1.hlines(y1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">x1</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s2"># GH #7406</span>
    <span class="s1">y2 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>
    <span class="s1">x2 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">(ax2</span><span class="s0">, </span><span class="s1">ax3</span><span class="s0">, </span><span class="s1">ax4) = plt.subplots(nrows=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">8</span><span class="s1">))</span>
    <span class="s1">ax2.hlines(y2</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">x2</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'g'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">y3 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>
    <span class="s1">x3 = [np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">ax3.hlines(y3</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">x3</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'r'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">'--'</span><span class="s1">)</span>

    <span class="s1">y4 = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">7</span><span class="s1">]</span>
    <span class="s1">x4 = [np.nan</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">-</span><span class="s4">6</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s1">np.nan]</span>
    <span class="s1">ax4.hlines(y4</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s1">x4</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s2"># tweak the y-axis so we can see the lines better</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">[ax1</span><span class="s0">, </span><span class="s1">ax2</span><span class="s0">, </span><span class="s1">ax3</span><span class="s0">, </span><span class="s1">ax4]:</span>
        <span class="s1">ax.set_ylim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2"># check that the x-lims are all automatically the same</span>
    <span class="s0">assert </span><span class="s1">ax1.get_xlim() == ax2.get_xlim()</span>
    <span class="s0">assert </span><span class="s1">ax1.get_xlim() == ax3.get_xlim()</span>
    <span class="s0">assert </span><span class="s1">ax1.get_xlim() == ax4.get_xlim()</span>

    <span class="s1">fig3</span><span class="s0">, </span><span class="s1">ax5 = plt.subplots()</span>
    <span class="s1">y5 = np.ma.masked_equal([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">12</span><span class="s1">]</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span>
    <span class="s1">xmin5 = np.ma.masked_equal([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">xmax5 = np.ma.masked_equal([</span><span class="s4">13</span><span class="s0">, </span><span class="s4">14</span><span class="s0">, </span><span class="s4">15</span><span class="s0">, </span><span class="s4">16</span><span class="s0">, </span><span class="s4">17</span><span class="s0">, </span><span class="s4">18</span><span class="s1">]</span><span class="s0">, </span><span class="s4">18</span><span class="s1">)</span>
    <span class="s1">ax5.hlines(y5</span><span class="s0">, </span><span class="s1">xmin5</span><span class="s0">, </span><span class="s1">xmax5</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax5.set_ylim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">15</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_hlines_default():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context({</span><span class="s3">'lines.color'</span><span class="s1">: </span><span class="s3">'red'</span><span class="s1">}):</span>
        <span class="s1">lines = ax.hlines(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">mpl.colors.same_color(lines.get_color()</span><span class="s0">, </span><span class="s3">'red'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'data'</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">,</span>
                                  <span class="s1">np.ma.masked_equal([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)])</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_lines_with_colors(fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">data):</span>
    <span class="s1">test_colors = [</span><span class="s3">'red'</span><span class="s0">, </span><span class="s3">'green'</span><span class="s0">, </span><span class="s3">'blue'</span><span class="s0">, </span><span class="s3">'purple'</span><span class="s0">, </span><span class="s3">'orange'</span><span class="s1">]</span>
    <span class="s1">fig_test.add_subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">).vlines(data</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">,</span>
                                         <span class="s1">colors=test_colors</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">fig_test.add_subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).hlines(data</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">,</span>
                                         <span class="s1">colors=test_colors</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">5</span><span class="s1">)</span>

    <span class="s1">expect_xy = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span>
    <span class="s1">expect_color = [</span><span class="s3">'red'</span><span class="s0">, </span><span class="s3">'green'</span><span class="s0">, </span><span class="s3">'blue'</span><span class="s0">, </span><span class="s3">'orange'</span><span class="s1">]</span>
    <span class="s1">fig_ref.add_subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">).vlines(expect_xy</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">,</span>
                                        <span class="s1">colors=expect_color</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">fig_ref.add_subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">).hlines(expect_xy</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">,</span>
                                        <span class="s1">colors=expect_color</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">5</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'step_linestyle'</span><span class="s0">, </span><span class="s3">'step_linestyle'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_step_linestyle():</span>
    <span class="s1">x = y = np.arange(</span><span class="s4">10</span><span class="s1">)</span>

    <span class="s2"># First illustrate basic pyplot interface, using defaults where possible.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax_lst = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax_lst = ax_lst.flatten()</span>

    <span class="s1">ln_styles = [</span><span class="s3">'-'</span><span class="s0">, </span><span class="s3">'--'</span><span class="s0">, </span><span class="s3">'-.'</span><span class="s0">, </span><span class="s3">':'</span><span class="s1">]</span>

    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">ls </span><span class="s0">in </span><span class="s1">zip(ax_lst</span><span class="s0">, </span><span class="s1">ln_styles):</span>
        <span class="s1">ax.step(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">linestyle=ls</span><span class="s0">, </span><span class="s1">where=</span><span class="s3">'pre'</span><span class="s1">)</span>
        <span class="s1">ax.step(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s4">1</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">linestyle=ls</span><span class="s0">, </span><span class="s1">where=</span><span class="s3">'mid'</span><span class="s1">)</span>
        <span class="s1">ax.step(x</span><span class="s0">, </span><span class="s1">y + </span><span class="s4">2</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">linestyle=ls</span><span class="s0">, </span><span class="s1">where=</span><span class="s3">'post'</span><span class="s1">)</span>
        <span class="s1">ax.set_xlim([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">ax.set_ylim([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">7</span><span class="s1">])</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;X&quot;</span><span class="s1">: x</span><span class="s0">, </span><span class="s3">&quot;Y0&quot;</span><span class="s1">: y</span><span class="s0">, </span><span class="s3">&quot;Y1&quot;</span><span class="s1">: y+</span><span class="s4">1</span><span class="s0">, </span><span class="s3">&quot;Y2&quot;</span><span class="s1">: y+</span><span class="s4">2</span><span class="s1">}</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax_lst = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax_lst = ax_lst.flatten()</span>
    <span class="s1">ln_styles = [</span><span class="s3">'-'</span><span class="s0">, </span><span class="s3">'--'</span><span class="s0">, </span><span class="s3">'-.'</span><span class="s0">, </span><span class="s3">':'</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">ls </span><span class="s0">in </span><span class="s1">zip(ax_lst</span><span class="s0">, </span><span class="s1">ln_styles):</span>
        <span class="s1">ax.step(</span><span class="s3">&quot;X&quot;</span><span class="s0">, </span><span class="s3">&quot;Y0&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">linestyle=ls</span><span class="s0">, </span><span class="s1">where=</span><span class="s3">'pre'</span><span class="s0">, </span><span class="s1">data=data)</span>
        <span class="s1">ax.step(</span><span class="s3">&quot;X&quot;</span><span class="s0">, </span><span class="s3">&quot;Y1&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">linestyle=ls</span><span class="s0">, </span><span class="s1">where=</span><span class="s3">'mid'</span><span class="s0">, </span><span class="s1">data=data)</span>
        <span class="s1">ax.step(</span><span class="s3">&quot;X&quot;</span><span class="s0">, </span><span class="s3">&quot;Y2&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">linestyle=ls</span><span class="s0">, </span><span class="s1">where=</span><span class="s3">'post'</span><span class="s0">, </span><span class="s1">data=data)</span>
        <span class="s1">ax.set_xlim([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">ax.set_ylim([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">7</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">'mixed_collection'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_mixed_collection():</span>
    <span class="s2"># First illustrate basic pyplot interface, using defaults where possible.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">c = mpatches.Circle((</span><span class="s4">8</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">radius=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'green'</span><span class="s1">)</span>

    <span class="s2"># PDF can optimize this one</span>
    <span class="s1">p1 = mpl.collections.PatchCollection([c]</span><span class="s0">, </span><span class="s1">match_original=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">p1.set_offsets([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">24</span><span class="s0">, </span><span class="s4">24</span><span class="s1">]])</span>
    <span class="s1">p1.set_linewidths([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>

    <span class="s2"># PDF can't optimize this one, because the alpha of the edge changes</span>
    <span class="s1">p2 = mpl.collections.PatchCollection([c]</span><span class="s0">, </span><span class="s1">match_original=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">p2.set_offsets([[</span><span class="s4">48</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">32</span><span class="s0">, </span><span class="s1">-</span><span class="s4">16</span><span class="s1">]])</span>
    <span class="s1">p2.set_linewidths([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
    <span class="s1">p2.set_edgecolors([[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]])</span>

    <span class="s1">ax.patch.set_color(</span><span class="s3">'0.5'</span><span class="s1">)</span>
    <span class="s1">ax.add_collection(p1)</span>
    <span class="s1">ax.add_collection(p2)</span>

    <span class="s1">ax.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">16</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">16</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_subplot_key_hash():</span>
    <span class="s1">ax = plt.subplot(np.int32(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.int64(</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.twinx()</span>
    <span class="s0">assert </span><span class="s1">ax.get_subplotspec().get_geometry() == (</span><span class="s4">5</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s3">&quot;specgram_freqs.png&quot;</span><span class="s0">, </span><span class="s3">&quot;specgram_freqs_linear.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;specgram_noise.png&quot;</span><span class="s0">, </span><span class="s3">&quot;specgram_noise_linear.png&quot;</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">tol=</span><span class="s4">0.07</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">&quot;default&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_specgram():</span>
    <span class="s5">&quot;&quot;&quot;Test axes.specgram in default (psd) mode.&quot;&quot;&quot;</span>

    <span class="s2"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'image.interpolation'</span><span class="s1">] = </span><span class="s3">'nearest'</span>

    <span class="s1">n = </span><span class="s4">1000</span>
    <span class="s1">Fs = </span><span class="s4">10.</span>

    <span class="s1">fstims = [[Fs/</span><span class="s4">4</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[Fs/</span><span class="s4">4.7</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5.6</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11.9</span><span class="s1">]]</span>
    <span class="s1">NFFT_freqs = int(</span><span class="s4">10 </span><span class="s1">* Fs / np.min(fstims))</span>
    <span class="s1">x = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">n</span><span class="s0">, </span><span class="s4">1</span><span class="s1">/Fs)</span>
    <span class="s1">y_freqs = np.concatenate(</span>
        <span class="s1">np.sin(</span><span class="s4">2 </span><span class="s1">* np.pi * np.multiply.outer(fstims</span><span class="s0">, </span><span class="s1">x)).sum(axis=</span><span class="s4">1</span><span class="s1">))</span>

    <span class="s1">NFFT_noise = int(</span><span class="s4">10 </span><span class="s1">* Fs / </span><span class="s4">11</span><span class="s1">)</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">y_noise = np.concatenate([np.random.standard_normal(n)</span><span class="s0">, </span><span class="s1">np.random.rand(n)])</span>

    <span class="s1">all_sides = [</span><span class="s3">&quot;default&quot;</span><span class="s0">, </span><span class="s3">&quot;onesided&quot;</span><span class="s0">, </span><span class="s3">&quot;twosided&quot;</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">y</span><span class="s0">, </span><span class="s1">NFFT </span><span class="s0">in </span><span class="s1">[(y_freqs</span><span class="s0">, </span><span class="s1">NFFT_freqs)</span><span class="s0">, </span><span class="s1">(y_noise</span><span class="s0">, </span><span class="s1">NFFT_noise)]:</span>
        <span class="s1">noverlap = NFFT // </span><span class="s4">2</span>
        <span class="s1">pad_to = int(</span><span class="s4">2 </span><span class="s1">** np.ceil(np.log2(NFFT)))</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
            <span class="s1">ax.specgram(y</span><span class="s0">, </span><span class="s1">NFFT=NFFT</span><span class="s0">, </span><span class="s1">Fs=Fs</span><span class="s0">, </span><span class="s1">noverlap=noverlap</span><span class="s0">,</span>
                        <span class="s1">pad_to=pad_to</span><span class="s0">, </span><span class="s1">sides=sides)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
            <span class="s1">ax.specgram(y</span><span class="s0">, </span><span class="s1">NFFT=NFFT</span><span class="s0">, </span><span class="s1">Fs=Fs</span><span class="s0">, </span><span class="s1">noverlap=noverlap</span><span class="s0">,</span>
                        <span class="s1">pad_to=pad_to</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">,</span>
                        <span class="s1">scale=</span><span class="s3">&quot;linear&quot;</span><span class="s0">, </span><span class="s1">norm=matplotlib.colors.LogNorm())</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s3">&quot;specgram_magnitude_freqs.png&quot;</span><span class="s0">, </span><span class="s3">&quot;specgram_magnitude_freqs_linear.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;specgram_magnitude_noise.png&quot;</span><span class="s0">, </span><span class="s3">&quot;specgram_magnitude_noise_linear.png&quot;</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">tol=</span><span class="s4">0.07</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">&quot;default&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_specgram_magnitude():</span>
    <span class="s5">&quot;&quot;&quot;Test axes.specgram in magnitude mode.&quot;&quot;&quot;</span>

    <span class="s2"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'image.interpolation'</span><span class="s1">] = </span><span class="s3">'nearest'</span>

    <span class="s1">n = </span><span class="s4">1000</span>
    <span class="s1">Fs = </span><span class="s4">10.</span>

    <span class="s1">fstims = [[Fs/</span><span class="s4">4</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[Fs/</span><span class="s4">4.7</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5.6</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11.9</span><span class="s1">]]</span>
    <span class="s1">NFFT_freqs = int(</span><span class="s4">100 </span><span class="s1">* Fs / np.min(fstims))</span>
    <span class="s1">x = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">n</span><span class="s0">, </span><span class="s4">1</span><span class="s1">/Fs)</span>
    <span class="s1">y = np.sin(</span><span class="s4">2 </span><span class="s1">* np.pi * np.multiply.outer(fstims</span><span class="s0">, </span><span class="s1">x)).sum(axis=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">y[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">] = </span><span class="s4">1</span>
    <span class="s1">y_freqs = np.hstack(y)</span>

    <span class="s1">NFFT_noise = int(</span><span class="s4">10 </span><span class="s1">* Fs / </span><span class="s4">11</span><span class="s1">)</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">y_noise = np.concatenate([np.random.standard_normal(n)</span><span class="s0">, </span><span class="s1">np.random.rand(n)])</span>

    <span class="s1">all_sides = [</span><span class="s3">&quot;default&quot;</span><span class="s0">, </span><span class="s3">&quot;onesided&quot;</span><span class="s0">, </span><span class="s3">&quot;twosided&quot;</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">y</span><span class="s0">, </span><span class="s1">NFFT </span><span class="s0">in </span><span class="s1">[(y_freqs</span><span class="s0">, </span><span class="s1">NFFT_freqs)</span><span class="s0">, </span><span class="s1">(y_noise</span><span class="s0">, </span><span class="s1">NFFT_noise)]:</span>
        <span class="s1">noverlap = NFFT // </span><span class="s4">2</span>
        <span class="s1">pad_to = int(</span><span class="s4">2 </span><span class="s1">** np.ceil(np.log2(NFFT)))</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
            <span class="s1">ax.specgram(y</span><span class="s0">, </span><span class="s1">NFFT=NFFT</span><span class="s0">, </span><span class="s1">Fs=Fs</span><span class="s0">, </span><span class="s1">noverlap=noverlap</span><span class="s0">,</span>
                        <span class="s1">pad_to=pad_to</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">&quot;magnitude&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
            <span class="s1">ax.specgram(y</span><span class="s0">, </span><span class="s1">NFFT=NFFT</span><span class="s0">, </span><span class="s1">Fs=Fs</span><span class="s0">, </span><span class="s1">noverlap=noverlap</span><span class="s0">,</span>
                        <span class="s1">pad_to=pad_to</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">, </span><span class="s1">mode=</span><span class="s3">&quot;magnitude&quot;</span><span class="s0">,</span>
                        <span class="s1">scale=</span><span class="s3">&quot;linear&quot;</span><span class="s0">, </span><span class="s1">norm=matplotlib.colors.LogNorm())</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s3">&quot;specgram_angle_freqs.png&quot;</span><span class="s0">, </span><span class="s3">&quot;specgram_phase_freqs.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;specgram_angle_noise.png&quot;</span><span class="s0">, </span><span class="s3">&quot;specgram_phase_noise.png&quot;</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">tol=</span><span class="s4">0.07</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">&quot;default&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_specgram_angle():</span>
    <span class="s5">&quot;&quot;&quot;Test axes.specgram in angle and phase modes.&quot;&quot;&quot;</span>

    <span class="s2"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'image.interpolation'</span><span class="s1">] = </span><span class="s3">'nearest'</span>

    <span class="s1">n = </span><span class="s4">1000</span>
    <span class="s1">Fs = </span><span class="s4">10.</span>

    <span class="s1">fstims = [[Fs/</span><span class="s4">4</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[Fs/</span><span class="s4">4.7</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5.6</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11.9</span><span class="s1">]]</span>
    <span class="s1">NFFT_freqs = int(</span><span class="s4">10 </span><span class="s1">* Fs / np.min(fstims))</span>
    <span class="s1">x = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">n</span><span class="s0">, </span><span class="s4">1</span><span class="s1">/Fs)</span>
    <span class="s1">y = np.sin(</span><span class="s4">2 </span><span class="s1">* np.pi * np.multiply.outer(fstims</span><span class="s0">, </span><span class="s1">x)).sum(axis=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">y[:</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">] = </span><span class="s4">1</span>
    <span class="s1">y_freqs = np.hstack(y)</span>

    <span class="s1">NFFT_noise = int(</span><span class="s4">10 </span><span class="s1">* Fs / </span><span class="s4">11</span><span class="s1">)</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">y_noise = np.concatenate([np.random.standard_normal(n)</span><span class="s0">, </span><span class="s1">np.random.rand(n)])</span>

    <span class="s1">all_sides = [</span><span class="s3">&quot;default&quot;</span><span class="s0">, </span><span class="s3">&quot;onesided&quot;</span><span class="s0">, </span><span class="s3">&quot;twosided&quot;</span><span class="s1">]</span>
    <span class="s0">for </span><span class="s1">y</span><span class="s0">, </span><span class="s1">NFFT </span><span class="s0">in </span><span class="s1">[(y_freqs</span><span class="s0">, </span><span class="s1">NFFT_freqs)</span><span class="s0">, </span><span class="s1">(y_noise</span><span class="s0">, </span><span class="s1">NFFT_noise)]:</span>
        <span class="s1">noverlap = NFFT // </span><span class="s4">2</span>
        <span class="s1">pad_to = int(</span><span class="s4">2 </span><span class="s1">** np.ceil(np.log2(NFFT)))</span>
        <span class="s0">for </span><span class="s1">mode </span><span class="s0">in </span><span class="s1">[</span><span class="s3">&quot;angle&quot;</span><span class="s0">, </span><span class="s3">&quot;phase&quot;</span><span class="s1">]:</span>
            <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
                <span class="s1">ax.specgram(y</span><span class="s0">, </span><span class="s1">NFFT=NFFT</span><span class="s0">, </span><span class="s1">Fs=Fs</span><span class="s0">, </span><span class="s1">noverlap=noverlap</span><span class="s0">,</span>
                            <span class="s1">pad_to=pad_to</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">, </span><span class="s1">mode=mode)</span>
                <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
                    <span class="s1">ax.specgram(y</span><span class="s0">, </span><span class="s1">NFFT=NFFT</span><span class="s0">, </span><span class="s1">Fs=Fs</span><span class="s0">, </span><span class="s1">noverlap=noverlap</span><span class="s0">,</span>
                                <span class="s1">pad_to=pad_to</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">, </span><span class="s1">mode=mode</span><span class="s0">,</span>
                                <span class="s1">scale=</span><span class="s3">&quot;dB&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_specgram_fs_none():</span>
    <span class="s5">&quot;&quot;&quot;Test axes.specgram when Fs is None, should not throw error.&quot;&quot;&quot;</span>
    <span class="s1">spec</span><span class="s0">, </span><span class="s1">freqs</span><span class="s0">, </span><span class="s1">t</span><span class="s0">, </span><span class="s1">im = plt.specgram(np.ones(</span><span class="s4">300</span><span class="s1">)</span><span class="s0">, </span><span class="s1">Fs=</span><span class="s0">None, </span><span class="s1">scale=</span><span class="s3">'linear'</span><span class="s1">)</span>
    <span class="s1">xmin</span><span class="s0">, </span><span class="s1">xmax</span><span class="s0">, </span><span class="s1">freq0</span><span class="s0">, </span><span class="s1">freq1 = im.get_extent()</span>
    <span class="s0">assert </span><span class="s1">xmin == </span><span class="s4">32 </span><span class="s0">and </span><span class="s1">xmax == </span><span class="s4">96</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_specgram_origin_rcparam(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s5">&quot;&quot;&quot;Test specgram ignores image.origin rcParam and uses origin 'upper'.&quot;&quot;&quot;</span>
    <span class="s1">t = np.arange(</span><span class="s4">500</span><span class="s1">)</span>
    <span class="s1">signal = np.sin(t)</span>

    <span class="s1">plt.rcParams[</span><span class="s3">&quot;image.origin&quot;</span><span class="s1">] = </span><span class="s3">'upper'</span>

    <span class="s2"># Reference: First graph using default origin in imshow (upper),</span>
    <span class="s1">fig_ref.subplots().specgram(signal)</span>

    <span class="s2"># Try to overwrite the setting trying to flip the specgram</span>
    <span class="s1">plt.rcParams[</span><span class="s3">&quot;image.origin&quot;</span><span class="s1">] = </span><span class="s3">'lower'</span>

    <span class="s2"># Test: origin='lower' should be ignored</span>
    <span class="s1">fig_test.subplots().specgram(signal)</span>


<span class="s0">def </span><span class="s1">test_specgram_origin_kwarg():</span>
    <span class="s5">&quot;&quot;&quot;Ensure passing origin as a kwarg raises a TypeError.&quot;&quot;&quot;</span>
    <span class="s1">t = np.arange(</span><span class="s4">500</span><span class="s1">)</span>
    <span class="s1">signal = np.sin(t)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">plt.specgram(signal</span><span class="s0">, </span><span class="s1">origin=</span><span class="s3">'lower'</span><span class="s1">)</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s3">&quot;psd_freqs.png&quot;</span><span class="s0">, </span><span class="s3">&quot;csd_freqs.png&quot;</span><span class="s0">, </span><span class="s3">&quot;psd_noise.png&quot;</span><span class="s0">, </span><span class="s3">&quot;csd_noise.png&quot;</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">tol=</span><span class="s4">0.002</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_psd_csd():</span>
    <span class="s1">n = </span><span class="s4">10000</span>
    <span class="s1">Fs = </span><span class="s4">100.</span>

    <span class="s1">fstims = [[Fs/</span><span class="s4">4</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[Fs/</span><span class="s4">4.7</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5.6</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11.9</span><span class="s1">]]</span>
    <span class="s1">NFFT_freqs = int(</span><span class="s4">1000 </span><span class="s1">* Fs / np.min(fstims))</span>
    <span class="s1">x = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">n</span><span class="s0">, </span><span class="s4">1</span><span class="s1">/Fs)</span>
    <span class="s1">ys_freqs = np.sin(</span><span class="s4">2 </span><span class="s1">* np.pi * np.multiply.outer(fstims</span><span class="s0">, </span><span class="s1">x)).sum(axis=</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s1">NFFT_noise = int(</span><span class="s4">1000 </span><span class="s1">* Fs / </span><span class="s4">11</span><span class="s1">)</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ys_noise = [np.random.standard_normal(n)</span><span class="s0">, </span><span class="s1">np.random.rand(n)]</span>

    <span class="s1">all_kwargs = [{</span><span class="s3">&quot;sides&quot;</span><span class="s1">: </span><span class="s3">&quot;default&quot;</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">{</span><span class="s3">&quot;sides&quot;</span><span class="s1">: </span><span class="s3">&quot;onesided&quot;</span><span class="s0">, </span><span class="s3">&quot;return_line&quot;</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">{</span><span class="s3">&quot;sides&quot;</span><span class="s1">: </span><span class="s3">&quot;twosided&quot;</span><span class="s0">, </span><span class="s3">&quot;return_line&quot;</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}]</span>
    <span class="s0">for </span><span class="s1">ys</span><span class="s0">, </span><span class="s1">NFFT </span><span class="s0">in </span><span class="s1">[(ys_freqs</span><span class="s0">, </span><span class="s1">NFFT_freqs)</span><span class="s0">, </span><span class="s1">(ys_noise</span><span class="s0">, </span><span class="s1">NFFT_noise)]:</span>
        <span class="s1">noverlap = NFFT // </span><span class="s4">2</span>
        <span class="s1">pad_to = int(</span><span class="s4">2 </span><span class="s1">** np.ceil(np.log2(NFFT)))</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">kwargs </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_kwargs):</span>
            <span class="s1">ret = ax.psd(np.concatenate(ys)</span><span class="s0">, </span><span class="s1">NFFT=NFFT</span><span class="s0">, </span><span class="s1">Fs=Fs</span><span class="s0">,</span>
                         <span class="s1">noverlap=noverlap</span><span class="s0">, </span><span class="s1">pad_to=pad_to</span><span class="s0">, </span><span class="s1">**kwargs)</span>
            <span class="s0">assert </span><span class="s1">len(ret) == </span><span class="s4">2 </span><span class="s1">+ kwargs.get(</span><span class="s3">&quot;return_line&quot;</span><span class="s0">, False</span><span class="s1">)</span>
            <span class="s1">ax.set(xlabel=</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">ylabel=</span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">kwargs </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_kwargs):</span>
            <span class="s1">ret = ax.csd(*ys</span><span class="s0">, </span><span class="s1">NFFT=NFFT</span><span class="s0">, </span><span class="s1">Fs=Fs</span><span class="s0">,</span>
                         <span class="s1">noverlap=noverlap</span><span class="s0">, </span><span class="s1">pad_to=pad_to</span><span class="s0">, </span><span class="s1">**kwargs)</span>
            <span class="s0">assert </span><span class="s1">len(ret) == </span><span class="s4">2 </span><span class="s1">+ kwargs.get(</span><span class="s3">&quot;return_line&quot;</span><span class="s0">, False</span><span class="s1">)</span>
            <span class="s1">ax.set(xlabel=</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">ylabel=</span><span class="s3">&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s3">&quot;magnitude_spectrum_freqs_linear.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;magnitude_spectrum_freqs_dB.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;angle_spectrum_freqs.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;phase_spectrum_freqs.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;magnitude_spectrum_noise_linear.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;magnitude_spectrum_noise_dB.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;angle_spectrum_noise.png&quot;</span><span class="s0">,</span>
     <span class="s3">&quot;phase_spectrum_noise.png&quot;</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_spectrum():</span>
    <span class="s1">n = </span><span class="s4">10000</span>
    <span class="s1">Fs = </span><span class="s4">100.</span>

    <span class="s1">fstims1 = [Fs/</span><span class="s4">4</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">5</span><span class="s0">, </span><span class="s1">Fs/</span><span class="s4">11</span><span class="s1">]</span>
    <span class="s1">NFFT = int(</span><span class="s4">1000 </span><span class="s1">* Fs / min(fstims1))</span>
    <span class="s1">pad_to = int(</span><span class="s4">2 </span><span class="s1">** np.ceil(np.log2(NFFT)))</span>

    <span class="s1">x = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">n</span><span class="s0">, </span><span class="s4">1</span><span class="s1">/Fs)</span>
    <span class="s1">y_freqs = ((np.sin(</span><span class="s4">2 </span><span class="s1">* np.pi * np.outer(x</span><span class="s0">, </span><span class="s1">fstims1)) * </span><span class="s4">10</span><span class="s1">**np.arange(</span><span class="s4">3</span><span class="s1">))</span>
               <span class="s1">.sum(axis=</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">np.random.seed(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">y_noise = np.hstack([np.random.standard_normal(n)</span><span class="s0">, </span><span class="s1">np.random.rand(n)]) - </span><span class="s4">.5</span>

    <span class="s1">all_sides = [</span><span class="s3">&quot;default&quot;</span><span class="s0">, </span><span class="s3">&quot;onesided&quot;</span><span class="s0">, </span><span class="s3">&quot;twosided&quot;</span><span class="s1">]</span>
    <span class="s1">kwargs = {</span><span class="s3">&quot;Fs&quot;</span><span class="s1">: Fs</span><span class="s0">, </span><span class="s3">&quot;pad_to&quot;</span><span class="s1">: pad_to}</span>
    <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">[y_freqs</span><span class="s0">, </span><span class="s1">y_noise]:</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
            <span class="s1">spec</span><span class="s0">, </span><span class="s1">freqs</span><span class="s0">, </span><span class="s1">line = ax.magnitude_spectrum(y</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">, </span><span class="s1">**kwargs)</span>
            <span class="s1">ax.set(xlabel=</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">ylabel=</span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
            <span class="s1">spec</span><span class="s0">, </span><span class="s1">freqs</span><span class="s0">, </span><span class="s1">line = ax.magnitude_spectrum(y</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">, </span><span class="s1">**kwargs</span><span class="s0">,</span>
                                                      <span class="s1">scale=</span><span class="s3">&quot;dB&quot;</span><span class="s1">)</span>
            <span class="s1">ax.set(xlabel=</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">ylabel=</span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
            <span class="s1">spec</span><span class="s0">, </span><span class="s1">freqs</span><span class="s0">, </span><span class="s1">line = ax.angle_spectrum(y</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">, </span><span class="s1">**kwargs)</span>
            <span class="s1">ax.set(xlabel=</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">ylabel=</span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip(plt.figure().subplots(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">all_sides):</span>
            <span class="s1">spec</span><span class="s0">, </span><span class="s1">freqs</span><span class="s0">, </span><span class="s1">line = ax.phase_spectrum(y</span><span class="s0">, </span><span class="s1">sides=sides</span><span class="s0">, </span><span class="s1">**kwargs)</span>
            <span class="s1">ax.set(xlabel=</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">ylabel=</span><span class="s3">&quot;&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_psd_csd_edge_cases():</span>
    <span class="s2"># Inverted yaxis or fully zero inputs used to throw exceptions.</span>
    <span class="s1">axs = plt.figure().subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs:</span>
        <span class="s1">ax.yaxis.set(inverted=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s3">&quot;ignore&quot;</span><span class="s1">):</span>
        <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].psd(np.zeros(</span><span class="s4">5</span><span class="s1">))</span>
        <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].csd(np.zeros(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.zeros(</span><span class="s4">5</span><span class="s1">))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_twin_remove(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax_test = fig_test.add_subplot()</span>
    <span class="s1">ax_twinx = ax_test.twinx()</span>
    <span class="s1">ax_twiny = ax_test.twiny()</span>
    <span class="s1">ax_twinx.remove()</span>
    <span class="s1">ax_twiny.remove()</span>

    <span class="s1">ax_ref = fig_ref.add_subplot()</span>
    <span class="s2"># Ideally we also undo tick changes when calling ``remove()``, but for now</span>
    <span class="s2"># manually set the ticks of the reference image to match the test image</span>
    <span class="s1">ax_ref.xaxis.tick_bottom()</span>
    <span class="s1">ax_ref.yaxis.tick_left()</span>


<span class="s1">@image_comparison([</span><span class="s3">'twin_spines.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_twin_spines():</span>

    <span class="s0">def </span><span class="s1">make_patch_spines_invisible(ax):</span>
        <span class="s1">ax.set_frame_on(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">ax.patch.set_visible(</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">ax.spines[:].set_visible(</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s1">fig = plt.figure(figsize=(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
    <span class="s1">fig.subplots_adjust(right=</span><span class="s4">0.75</span><span class="s1">)</span>

    <span class="s1">host = fig.add_subplot()</span>
    <span class="s1">par1 = host.twinx()</span>
    <span class="s1">par2 = host.twinx()</span>

    <span class="s2"># Offset the right spine of par2.  The ticks and label have already been</span>
    <span class="s2"># placed on the right by twinx above.</span>
    <span class="s1">par2.spines.right.set_position((</span><span class="s3">&quot;axes&quot;</span><span class="s0">, </span><span class="s4">1.2</span><span class="s1">))</span>
    <span class="s2"># Having been created by twinx, par2 has its frame off, so the line of</span>
    <span class="s2"># its detached spine is invisible.  First, activate the frame but make</span>
    <span class="s2"># the patch and spines invisible.</span>
    <span class="s1">make_patch_spines_invisible(par2)</span>
    <span class="s2"># Second, show the right spine.</span>
    <span class="s1">par2.spines.right.set_visible(</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">p1</span><span class="s0">, </span><span class="s1">= host.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;b-&quot;</span><span class="s1">)</span>
    <span class="s1">p2</span><span class="s0">, </span><span class="s1">= par1.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;r-&quot;</span><span class="s1">)</span>
    <span class="s1">p3</span><span class="s0">, </span><span class="s1">= par2.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">50</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">15</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;g-&quot;</span><span class="s1">)</span>

    <span class="s1">host.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">host.set_ylim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">par1.set_ylim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s1">par2.set_ylim(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">65</span><span class="s1">)</span>

    <span class="s1">host.yaxis.label.set_color(p1.get_color())</span>
    <span class="s1">par1.yaxis.label.set_color(p2.get_color())</span>
    <span class="s1">par2.yaxis.label.set_color(p3.get_color())</span>

    <span class="s1">tkw = dict(size=</span><span class="s4">4</span><span class="s0">, </span><span class="s1">width=</span><span class="s4">1.5</span><span class="s1">)</span>
    <span class="s1">host.tick_params(axis=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">colors=p1.get_color()</span><span class="s0">, </span><span class="s1">**tkw)</span>
    <span class="s1">par1.tick_params(axis=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">colors=p2.get_color()</span><span class="s0">, </span><span class="s1">**tkw)</span>
    <span class="s1">par2.tick_params(axis=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">colors=p3.get_color()</span><span class="s0">, </span><span class="s1">**tkw)</span>
    <span class="s1">host.tick_params(axis=</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">**tkw)</span>


<span class="s1">@image_comparison([</span><span class="s3">'twin_spines_on_top.png'</span><span class="s0">, </span><span class="s3">'twin_spines_on_top.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_twin_spines_on_top():</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'axes.linewidth'</span><span class="s1">] = </span><span class="s4">48.0</span>
    <span class="s1">matplotlib.rcParams[</span><span class="s3">'lines.linewidth'</span><span class="s1">] = </span><span class="s4">48.0</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>

    <span class="s1">data = np.array([[</span><span class="s4">1000</span><span class="s0">, </span><span class="s4">1100</span><span class="s0">, </span><span class="s4">1200</span><span class="s0">, </span><span class="s4">1250</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">[</span><span class="s4">310</span><span class="s0">, </span><span class="s4">301</span><span class="s0">, </span><span class="s4">360</span><span class="s0">, </span><span class="s4">400</span><span class="s1">]])</span>

    <span class="s1">ax2 = ax1.twinx()</span>

    <span class="s1">ax1.plot(data[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data[</span><span class="s4">1</span><span class="s1">]/</span><span class="s4">1E3</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'#BEAED4'</span><span class="s1">)</span>
    <span class="s1">ax1.fill_between(data[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data[</span><span class="s4">1</span><span class="s1">]/</span><span class="s4">1E3</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'#BEAED4'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">.8</span><span class="s1">)</span>

    <span class="s1">ax2.plot(data[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data[</span><span class="s4">1</span><span class="s1">]/</span><span class="s4">1E3</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'#7FC97F'</span><span class="s1">)</span>
    <span class="s1">ax2.fill_between(data[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">data[</span><span class="s4">1</span><span class="s1">]/</span><span class="s4">1E3</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'#7FC97F'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">.5</span><span class="s1">)</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;i&quot;</span><span class="s1">: data[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;j&quot;</span><span class="s1">: data[</span><span class="s4">1</span><span class="s1">]/</span><span class="s4">1E3</span><span class="s1">}</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax2 = ax1.twinx()</span>
    <span class="s1">ax1.plot(</span><span class="s3">&quot;i&quot;</span><span class="s0">, </span><span class="s3">&quot;j&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'#BEAED4'</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">ax1.fill_between(</span><span class="s3">&quot;i&quot;</span><span class="s0">, </span><span class="s3">&quot;j&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'#BEAED4'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">.8</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">ax2.plot(</span><span class="s3">&quot;i&quot;</span><span class="s0">, </span><span class="s3">&quot;j&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'#7FC97F'</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">ax2.fill_between(</span><span class="s3">&quot;i&quot;</span><span class="s0">, </span><span class="s3">&quot;j&quot;</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'#7FC97F'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">.5</span><span class="s0">, </span><span class="s1">data=data)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;grid_which, major_visible, minor_visible&quot;</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s3">&quot;both&quot;</span><span class="s0">, True, True</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s3">&quot;major&quot;</span><span class="s0">, True, False</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s3">&quot;minor&quot;</span><span class="s0">, False, True</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_rcparam_grid_minor(grid_which</span><span class="s0">, </span><span class="s1">major_visible</span><span class="s0">, </span><span class="s1">minor_visible):</span>
    <span class="s1">mpl.rcParams.update({</span><span class="s3">&quot;axes.grid&quot;</span><span class="s1">: </span><span class="s0">True, </span><span class="s3">&quot;axes.grid.which&quot;</span><span class="s1">: grid_which})</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">all(tick.gridline.get_visible() == major_visible</span>
               <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax.xaxis.majorTicks)</span>
    <span class="s0">assert </span><span class="s1">all(tick.gridline.get_visible() == minor_visible</span>
               <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax.xaxis.minorTicks)</span>


<span class="s0">def </span><span class="s1">test_grid():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.grid()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_visible()</span>
    <span class="s1">ax.grid(visible=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_visible()</span>
    <span class="s1">ax.grid(visible=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_visible()</span>
    <span class="s1">ax.grid()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_visible()</span>


<span class="s0">def </span><span class="s1">test_reset_grid():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.tick_params(reset=</span><span class="s0">True, </span><span class="s1">which=</span><span class="s3">'major'</span><span class="s0">, </span><span class="s1">labelsize=</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_visible()</span>
    <span class="s1">ax.grid(color=</span><span class="s3">'red'</span><span class="s1">)  </span><span class="s2"># enables grid</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_visible()</span>

    <span class="s0">with </span><span class="s1">plt.rc_context({</span><span class="s3">'axes.grid'</span><span class="s1">: </span><span class="s0">True</span><span class="s1">}):</span>
        <span class="s1">ax.clear()</span>
        <span class="s1">ax.tick_params(reset=</span><span class="s0">True, </span><span class="s1">which=</span><span class="s3">'major'</span><span class="s0">, </span><span class="s1">labelsize=</span><span class="s4">10</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_visible()</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_reset_ticks(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s0">for </span><span class="s1">fig </span><span class="s0">in </span><span class="s1">[fig_ref</span><span class="s0">, </span><span class="s1">fig_test]:</span>
        <span class="s1">ax = fig.add_subplot()</span>
        <span class="s1">ax.grid(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">ax.tick_params(</span>
            <span class="s1">direction=</span><span class="s3">'in'</span><span class="s0">, </span><span class="s1">length=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">width=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'C0'</span><span class="s0">, </span><span class="s1">pad=</span><span class="s4">12</span><span class="s0">,</span>
            <span class="s1">labelsize=</span><span class="s4">14</span><span class="s0">, </span><span class="s1">labelcolor=</span><span class="s3">'C1'</span><span class="s0">, </span><span class="s1">labelrotation=</span><span class="s4">45</span><span class="s0">,</span>
            <span class="s1">grid_color=</span><span class="s3">'C2'</span><span class="s0">, </span><span class="s1">grid_alpha=</span><span class="s4">0.8</span><span class="s0">, </span><span class="s1">grid_linewidth=</span><span class="s4">3</span><span class="s0">,</span>
            <span class="s1">grid_linestyle=</span><span class="s3">'--'</span><span class="s1">)</span>
        <span class="s1">fig.draw_without_rendering()</span>

    <span class="s2"># After we've changed any setting on ticks, reset_ticks will mean</span>
    <span class="s2"># re-creating them from scratch. This *should* appear the same as not</span>
    <span class="s2"># resetting them.</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig_test.axes:</span>
        <span class="s1">ax.xaxis.reset_ticks()</span>
        <span class="s1">ax.yaxis.reset_ticks()</span>


<span class="s0">def </span><span class="s1">test_vline_limit():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.gca()</span>
    <span class="s1">ax.axvline(</span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">ax.plot([-</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">])</span>
    <span class="s1">assert_allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.2</span><span class="s1">))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'fv, fh, args'</span><span class="s0">, </span><span class="s1">[[plt.axvline</span><span class="s0">, </span><span class="s1">plt.axhline</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">,</span><span class="s1">)]</span><span class="s0">,</span>
                                          <span class="s1">[plt.axvspan</span><span class="s0">, </span><span class="s1">plt.axhspan</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)]])</span>
<span class="s0">def </span><span class="s1">test_axline_minmax(fv</span><span class="s0">, </span><span class="s1">fh</span><span class="s0">, </span><span class="s1">args):</span>
    <span class="s1">bad_lim = matplotlib.dates.num2date(</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s2"># Check vertical functions</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'ymin must be a single scalar value'</span><span class="s1">):</span>
        <span class="s1">fv(*args</span><span class="s0">, </span><span class="s1">ymin=bad_lim</span><span class="s0">, </span><span class="s1">ymax=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'ymax must be a single scalar value'</span><span class="s1">):</span>
        <span class="s1">fv(*args</span><span class="s0">, </span><span class="s1">ymin=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ymax=bad_lim)</span>
    <span class="s2"># Check horizontal functions</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'xmin must be a single scalar value'</span><span class="s1">):</span>
        <span class="s1">fh(*args</span><span class="s0">, </span><span class="s1">xmin=bad_lim</span><span class="s0">, </span><span class="s1">xmax=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'xmax must be a single scalar value'</span><span class="s1">):</span>
        <span class="s1">fh(*args</span><span class="s0">, </span><span class="s1">xmin=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">xmax=bad_lim)</span>


<span class="s0">def </span><span class="s1">test_empty_shared_subplots():</span>
    <span class="s2"># empty plots with shared axes inherit limits from populated plots</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(nrows=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span>
    <span class="s1">x0</span><span class="s0">, </span><span class="s1">x1 = axs[</span><span class="s4">1</span><span class="s1">].get_xlim()</span>
    <span class="s1">y0</span><span class="s0">, </span><span class="s1">y1 = axs[</span><span class="s4">1</span><span class="s1">].get_ylim()</span>
    <span class="s0">assert </span><span class="s1">x0 &lt;= </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">x1 &gt;= </span><span class="s4">3</span>
    <span class="s0">assert </span><span class="s1">y0 &lt;= </span><span class="s4">2</span>
    <span class="s0">assert </span><span class="s1">y1 &gt;= </span><span class="s4">6</span>


<span class="s0">def </span><span class="s1">test_shared_with_aspect_1():</span>
    <span class="s2"># allow sharing one axis</span>
    <span class="s0">for </span><span class="s1">adjustable </span><span class="s0">in </span><span class="s1">[</span><span class="s3">'box'</span><span class="s0">, </span><span class="s3">'datalim'</span><span class="s1">]:</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(nrows=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].set_aspect(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">adjustable=adjustable</span><span class="s0">, </span><span class="s1">share=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">axs[</span><span class="s4">1</span><span class="s1">].get_aspect() == </span><span class="s4">2</span>
        <span class="s0">assert </span><span class="s1">axs[</span><span class="s4">1</span><span class="s1">].get_adjustable() == adjustable</span>

        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(nrows=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].set_aspect(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">adjustable=adjustable)</span>
        <span class="s0">assert </span><span class="s1">axs[</span><span class="s4">1</span><span class="s1">].get_aspect() == </span><span class="s3">'auto'</span>


<span class="s0">def </span><span class="s1">test_shared_with_aspect_2():</span>
    <span class="s2"># Share 2 axes only with 'box':</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(nrows=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].set_aspect(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">share=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].plot([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s1">plt.draw()  </span><span class="s2"># Trigger apply_aspect().</span>
    <span class="s0">assert </span><span class="s1">axs[</span><span class="s4">0</span><span class="s1">].get_xlim() == axs[</span><span class="s4">1</span><span class="s1">].get_xlim()</span>
    <span class="s0">assert </span><span class="s1">axs[</span><span class="s4">0</span><span class="s1">].get_ylim() == axs[</span><span class="s4">1</span><span class="s1">].get_ylim()</span>


<span class="s0">def </span><span class="s1">test_shared_with_aspect_3():</span>
    <span class="s2"># Different aspect ratios:</span>
    <span class="s0">for </span><span class="s1">adjustable </span><span class="s0">in </span><span class="s1">[</span><span class="s3">'box'</span><span class="s0">, </span><span class="s3">'datalim'</span><span class="s1">]:</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(nrows=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].set_aspect(</span><span class="s4">2</span><span class="s0">, </span><span class="s1">adjustable=adjustable)</span>
        <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].set_aspect(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s1">adjustable=adjustable)</span>
        <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
        <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].plot([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
        <span class="s1">plt.draw()  </span><span class="s2"># Trigger apply_aspect().</span>
        <span class="s0">assert </span><span class="s1">axs[</span><span class="s4">0</span><span class="s1">].get_xlim() != axs[</span><span class="s4">1</span><span class="s1">].get_xlim()</span>
        <span class="s0">assert </span><span class="s1">axs[</span><span class="s4">0</span><span class="s1">].get_ylim() == axs[</span><span class="s4">1</span><span class="s1">].get_ylim()</span>
        <span class="s1">fig_aspect = fig.bbox_inches.height / fig.bbox_inches.width</span>
        <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs:</span>
            <span class="s1">p = ax.get_position()</span>
            <span class="s1">box_aspect = p.height / p.width</span>
            <span class="s1">lim_aspect = ax.viewLim.height / ax.viewLim.width</span>
            <span class="s1">expected = fig_aspect * box_aspect / lim_aspect</span>
            <span class="s0">assert </span><span class="s1">round(expected</span><span class="s0">, </span><span class="s4">4</span><span class="s1">) == round(ax.get_aspect()</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_shared_aspect_error():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axes = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">axes[</span><span class="s4">0</span><span class="s1">].axis(</span><span class="s3">&quot;equal&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">r&quot;set_aspect\(..., adjustable=&quot;</span><span class="s1">):</span>
        <span class="s1">fig.draw_without_rendering()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'err, args, kwargs, match'</span><span class="s0">,</span>
                         <span class="s1">((TypeError</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">,</span>
                           <span class="s3">r&quot;axis\(\) takes from 0 to 1 positional arguments &quot;</span>
                           <span class="s3">&quot;but 2 were given&quot;</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">,</span>
                           <span class="s3">&quot;Unrecognized string 'foo' to axis; try 'on' or &quot;</span>
                           <span class="s3">&quot;'off'&quot;</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">,</span>
                           <span class="s3">&quot;the first argument to axis*&quot;</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">tuple()</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'foo'</span><span class="s1">: </span><span class="s0">None</span><span class="s1">}</span><span class="s0">,</span>
                           <span class="s3">r&quot;axis\(\) got an unexpected keyword argument &quot;</span>
                           <span class="s3">&quot;'foo'&quot;</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_axis_errors(err</span><span class="s0">, </span><span class="s1">args</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">match):</span>
    <span class="s0">with </span><span class="s1">pytest.raises(err</span><span class="s0">, </span><span class="s1">match=match):</span>
        <span class="s1">plt.axis(*args</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">test_axis_method_errors():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;unknown value for which: 'foo'&quot;</span><span class="s1">):</span>
        <span class="s1">ax.get_xaxis_transform(</span><span class="s3">'foo'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;unknown value for which: 'foo'&quot;</span><span class="s1">):</span>
        <span class="s1">ax.get_yaxis_transform(</span><span class="s3">'foo'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;Cannot supply both positional and&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_prop_cycle(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'bar'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;argument must be among&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_anchor(</span><span class="s3">'foo'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;scilimits must be a sequence&quot;</span><span class="s1">):</span>
        <span class="s1">ax.ticklabel_format(scilimits=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;Specifying 'loc' is disallowed&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_xlabel(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'left'</span><span class="s0">, </span><span class="s1">x=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;Specifying 'loc' is disallowed&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_ylabel(</span><span class="s3">'foo'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'top'</span><span class="s0">, </span><span class="s1">y=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;Cannot pass both 'left'&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_xlim(left=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">xmin=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;Cannot pass both 'right'&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_xlim(right=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">xmax=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;Cannot pass both 'bottom'&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_ylim(bottom=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">ymin=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;Cannot pass both 'top'&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_ylim(top=</span><span class="s4">0</span><span class="s0">, </span><span class="s1">ymax=</span><span class="s4">1</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'twin'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_twin_with_aspect(twin):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2"># test twinx or twiny</span>
    <span class="s1">ax_twin = getattr(ax</span><span class="s0">, </span><span class="s3">'twin{}'</span><span class="s1">.format(twin))()</span>
    <span class="s1">ax.set_aspect(</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">ax_twin.set_aspect(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">assert_array_equal(ax.bbox.extents</span><span class="s0">,</span>
                       <span class="s1">ax_twin.bbox.extents)</span>


<span class="s0">def </span><span class="s1">test_relim_visible_only():</span>
    <span class="s1">x1 = (</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">10.</span><span class="s1">)</span>
    <span class="s1">y1 = (</span><span class="s4">0.</span><span class="s0">, </span><span class="s4">10.</span><span class="s1">)</span>
    <span class="s1">x2 = (-</span><span class="s4">10.</span><span class="s0">, </span><span class="s4">20.</span><span class="s1">)</span>
    <span class="s1">y2 = (-</span><span class="s4">10.</span><span class="s0">, </span><span class="s4">30.</span><span class="s1">)</span>

    <span class="s1">fig = matplotlib.figure.Figure()</span>
    <span class="s1">ax = fig.add_subplot()</span>
    <span class="s1">ax.plot(x1</span><span class="s0">, </span><span class="s1">y1)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == x1</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == y1</span>
    <span class="s1">line</span><span class="s0">, </span><span class="s1">= ax.plot(x2</span><span class="s0">, </span><span class="s1">y2)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == x2</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == y2</span>
    <span class="s1">line.set_visible(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == x2</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == y2</span>

    <span class="s1">ax.relim(visible_only=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.autoscale_view()</span>

    <span class="s0">assert </span><span class="s1">ax.get_xlim() == x1</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == y1</span>


<span class="s0">def </span><span class="s1">test_text_labelsize():</span>
    <span class="s5">&quot;&quot;&quot; 
    tests for issue #1172 
    &quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.gca()</span>
    <span class="s1">ax.tick_params(labelsize=</span><span class="s3">'large'</span><span class="s1">)</span>
    <span class="s1">ax.tick_params(direction=</span><span class="s3">'out'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pie_default.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_pie_default():</span>
    <span class="s2"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels = </span><span class="s3">'Frogs'</span><span class="s0">, </span><span class="s3">'Hogs'</span><span class="s0">, </span><span class="s3">'Dogs'</span><span class="s0">, </span><span class="s3">'Logs'</span>
    <span class="s1">sizes = [</span><span class="s4">15</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">45</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">colors = [</span><span class="s3">'yellowgreen'</span><span class="s0">, </span><span class="s3">'gold'</span><span class="s0">, </span><span class="s3">'lightskyblue'</span><span class="s0">, </span><span class="s3">'lightcoral'</span><span class="s1">]</span>
    <span class="s1">explode = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)  </span><span class="s2"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>
    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots(figsize=(</span><span class="s4">8</span><span class="s0">, </span><span class="s4">6</span><span class="s1">))</span>
    <span class="s1">ax1.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pie_linewidth_0'</span><span class="s0">, </span><span class="s3">'pie_linewidth_0'</span><span class="s0">, </span><span class="s3">'pie_linewidth_0'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pie_linewidth_0():</span>
    <span class="s2"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels = </span><span class="s3">'Frogs'</span><span class="s0">, </span><span class="s3">'Hogs'</span><span class="s0">, </span><span class="s3">'Dogs'</span><span class="s0">, </span><span class="s3">'Logs'</span>
    <span class="s1">sizes = [</span><span class="s4">15</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">45</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">colors = [</span><span class="s3">'yellowgreen'</span><span class="s0">, </span><span class="s3">'gold'</span><span class="s0">, </span><span class="s3">'lightskyblue'</span><span class="s0">, </span><span class="s3">'lightcoral'</span><span class="s1">]</span>
    <span class="s1">explode = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)  </span><span class="s2"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">wedgeprops={</span><span class="s3">'linewidth'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">})</span>
    <span class="s2"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>

    <span class="s2"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data = {</span><span class="s3">&quot;l&quot;</span><span class="s1">: labels</span><span class="s0">, </span><span class="s3">&quot;s&quot;</span><span class="s1">: sizes</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s1">: colors</span><span class="s0">, </span><span class="s3">&quot;ex&quot;</span><span class="s1">: explode}</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.gca()</span>
    <span class="s1">ax.pie(</span><span class="s3">&quot;s&quot;</span><span class="s0">, </span><span class="s1">explode=</span><span class="s3">&quot;ex&quot;</span><span class="s0">, </span><span class="s1">labels=</span><span class="s3">&quot;l&quot;</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">&quot;c&quot;</span><span class="s0">,</span>
           <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
           <span class="s1">wedgeprops={</span><span class="s3">'linewidth'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">ax.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>

    <span class="s2"># And again to test the pyplot functions which should also be able to be</span>
    <span class="s2"># called with a data kwarg</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.pie(</span><span class="s3">&quot;s&quot;</span><span class="s0">, </span><span class="s1">explode=</span><span class="s3">&quot;ex&quot;</span><span class="s0">, </span><span class="s1">labels=</span><span class="s3">&quot;l&quot;</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">&quot;c&quot;</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">wedgeprops={</span><span class="s3">'linewidth'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s0">, </span><span class="s1">data=data)</span>
    <span class="s1">plt.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pie_center_radius.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pie_center_radius():</span>
    <span class="s2"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels = </span><span class="s3">'Frogs'</span><span class="s0">, </span><span class="s3">'Hogs'</span><span class="s0">, </span><span class="s3">'Dogs'</span><span class="s0">, </span><span class="s3">'Logs'</span>
    <span class="s1">sizes = [</span><span class="s4">15</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">45</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">colors = [</span><span class="s3">'yellowgreen'</span><span class="s0">, </span><span class="s3">'gold'</span><span class="s0">, </span><span class="s3">'lightskyblue'</span><span class="s0">, </span><span class="s3">'lightcoral'</span><span class="s1">]</span>
    <span class="s1">explode = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)  </span><span class="s2"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">wedgeprops={</span><span class="s3">'linewidth'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s0">, </span><span class="s1">center=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">radius=</span><span class="s4">1.5</span><span class="s1">)</span>

    <span class="s1">plt.annotate(</span><span class="s3">&quot;Center point&quot;</span><span class="s0">, </span><span class="s1">xy=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">xytext=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1.3</span><span class="s1">)</span><span class="s0">,</span>
                 <span class="s1">arrowprops=dict(arrowstyle=</span><span class="s3">&quot;-&gt;&quot;</span><span class="s0">,</span>
                                 <span class="s1">connectionstyle=</span><span class="s3">&quot;arc3&quot;</span><span class="s1">)</span><span class="s0">,</span>
                 <span class="s1">bbox=dict(boxstyle=</span><span class="s3">&quot;square&quot;</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;lightgrey&quot;</span><span class="s1">))</span>
    <span class="s2"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pie_linewidth_2.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pie_linewidth_2():</span>
    <span class="s2"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels = </span><span class="s3">'Frogs'</span><span class="s0">, </span><span class="s3">'Hogs'</span><span class="s0">, </span><span class="s3">'Dogs'</span><span class="s0">, </span><span class="s3">'Logs'</span>
    <span class="s1">sizes = [</span><span class="s4">15</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">45</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">colors = [</span><span class="s3">'yellowgreen'</span><span class="s0">, </span><span class="s3">'gold'</span><span class="s0">, </span><span class="s3">'lightskyblue'</span><span class="s0">, </span><span class="s3">'lightcoral'</span><span class="s1">]</span>
    <span class="s1">explode = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)  </span><span class="s2"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">wedgeprops={</span><span class="s3">'linewidth'</span><span class="s1">: </span><span class="s4">2</span><span class="s1">})</span>
    <span class="s2"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pie_ccw_true.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pie_ccw_true():</span>
    <span class="s2"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels = </span><span class="s3">'Frogs'</span><span class="s0">, </span><span class="s3">'Hogs'</span><span class="s0">, </span><span class="s3">'Dogs'</span><span class="s0">, </span><span class="s3">'Logs'</span>
    <span class="s1">sizes = [</span><span class="s4">15</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">45</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">colors = [</span><span class="s3">'yellowgreen'</span><span class="s0">, </span><span class="s3">'gold'</span><span class="s0">, </span><span class="s3">'lightskyblue'</span><span class="s0">, </span><span class="s3">'lightcoral'</span><span class="s1">]</span>
    <span class="s1">explode = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)  </span><span class="s2"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">counterclock=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s2"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pie_frame_grid.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pie_frame_grid():</span>
    <span class="s2"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels = </span><span class="s3">'Frogs'</span><span class="s0">, </span><span class="s3">'Hogs'</span><span class="s0">, </span><span class="s3">'Dogs'</span><span class="s0">, </span><span class="s3">'Logs'</span>
    <span class="s1">sizes = [</span><span class="s4">15</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">45</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">colors = [</span><span class="s3">'yellowgreen'</span><span class="s0">, </span><span class="s3">'gold'</span><span class="s0">, </span><span class="s3">'lightskyblue'</span><span class="s0">, </span><span class="s3">'lightcoral'</span><span class="s1">]</span>
    <span class="s2"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>
    <span class="s1">explode = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>

    <span class="s1">plt.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">wedgeprops={</span><span class="s3">'linewidth'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">frame=</span><span class="s0">True, </span><span class="s1">center=(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span>

    <span class="s1">plt.pie(sizes[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">wedgeprops={</span><span class="s3">'linewidth'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">frame=</span><span class="s0">True, </span><span class="s1">center=(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span>

    <span class="s1">plt.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode[::-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">wedgeprops={</span><span class="s3">'linewidth'</span><span class="s1">: </span><span class="s4">0</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">frame=</span><span class="s0">True, </span><span class="s1">center=(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>
    <span class="s2"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pie_rotatelabels_true.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pie_rotatelabels_true():</span>
    <span class="s2"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels = </span><span class="s3">'Hogwarts'</span><span class="s0">, </span><span class="s3">'Frogs'</span><span class="s0">, </span><span class="s3">'Dogs'</span><span class="s0">, </span><span class="s3">'Logs'</span>
    <span class="s1">sizes = [</span><span class="s4">15</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">45</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">colors = [</span><span class="s3">'yellowgreen'</span><span class="s0">, </span><span class="s3">'gold'</span><span class="s0">, </span><span class="s3">'lightskyblue'</span><span class="s0">, </span><span class="s3">'lightcoral'</span><span class="s1">]</span>
    <span class="s1">explode = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)  </span><span class="s2"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">,</span>
            <span class="s1">rotatelabels=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s2"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'pie_no_label.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_pie_nolabel_but_legend():</span>
    <span class="s1">labels = </span><span class="s3">'Frogs'</span><span class="s0">, </span><span class="s3">'Hogs'</span><span class="s0">, </span><span class="s3">'Dogs'</span><span class="s0">, </span><span class="s3">'Logs'</span>
    <span class="s1">sizes = [</span><span class="s4">15</span><span class="s0">, </span><span class="s4">30</span><span class="s0">, </span><span class="s4">45</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">colors = [</span><span class="s3">'yellowgreen'</span><span class="s0">, </span><span class="s3">'gold'</span><span class="s0">, </span><span class="s3">'lightskyblue'</span><span class="s0">, </span><span class="s3">'lightcoral'</span><span class="s1">]</span>
    <span class="s1">explode = (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)  </span><span class="s2"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>
    <span class="s1">plt.pie(sizes</span><span class="s0">, </span><span class="s1">explode=explode</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">colors=colors</span><span class="s0">,</span>
            <span class="s1">autopct=</span><span class="s3">'%1.1f%%'</span><span class="s0">, </span><span class="s1">shadow=</span><span class="s0">True, </span><span class="s1">startangle=</span><span class="s4">90</span><span class="s0">, </span><span class="s1">labeldistance=</span><span class="s0">None,</span>
            <span class="s1">rotatelabels=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">plt.axis(</span><span class="s3">'equal'</span><span class="s1">)</span>
    <span class="s1">plt.ylim(-</span><span class="s4">1.2</span><span class="s0">, </span><span class="s4">1.2</span><span class="s1">)</span>
    <span class="s1">plt.legend()</span>


<span class="s0">def </span><span class="s1">test_pie_textprops():</span>
    <span class="s1">data = [</span><span class="s4">23</span><span class="s0">, </span><span class="s4">34</span><span class="s0">, </span><span class="s4">45</span><span class="s1">]</span>
    <span class="s1">labels = [</span><span class="s3">&quot;Long name 1&quot;</span><span class="s0">, </span><span class="s3">&quot;Long name 2&quot;</span><span class="s0">, </span><span class="s3">&quot;Long name 3&quot;</span><span class="s1">]</span>

    <span class="s1">textprops = dict(horizontalalignment=</span><span class="s3">&quot;center&quot;</span><span class="s0">,</span>
                     <span class="s1">verticalalignment=</span><span class="s3">&quot;top&quot;</span><span class="s0">,</span>
                     <span class="s1">rotation=</span><span class="s4">90</span><span class="s0">,</span>
                     <span class="s1">rotation_mode=</span><span class="s3">&quot;anchor&quot;</span><span class="s0">,</span>
                     <span class="s1">size=</span><span class="s4">12</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">&quot;red&quot;</span><span class="s1">)</span>

    <span class="s1">_</span><span class="s0">, </span><span class="s1">texts</span><span class="s0">, </span><span class="s1">autopct = plt.gca().pie(data</span><span class="s0">, </span><span class="s1">labels=labels</span><span class="s0">, </span><span class="s1">autopct=</span><span class="s3">'%.2f'</span><span class="s0">,</span>
                                      <span class="s1">textprops=textprops)</span>
    <span class="s0">for </span><span class="s1">labels </span><span class="s0">in </span><span class="s1">[texts</span><span class="s0">, </span><span class="s1">autopct]:</span>
        <span class="s0">for </span><span class="s1">tx </span><span class="s0">in </span><span class="s1">labels:</span>
            <span class="s0">assert </span><span class="s1">tx.get_ha() == textprops[</span><span class="s3">&quot;horizontalalignment&quot;</span><span class="s1">]</span>
            <span class="s0">assert </span><span class="s1">tx.get_va() == textprops[</span><span class="s3">&quot;verticalalignment&quot;</span><span class="s1">]</span>
            <span class="s0">assert </span><span class="s1">tx.get_rotation() == textprops[</span><span class="s3">&quot;rotation&quot;</span><span class="s1">]</span>
            <span class="s0">assert </span><span class="s1">tx.get_rotation_mode() == textprops[</span><span class="s3">&quot;rotation_mode&quot;</span><span class="s1">]</span>
            <span class="s0">assert </span><span class="s1">tx.get_size() == textprops[</span><span class="s3">&quot;size&quot;</span><span class="s1">]</span>
            <span class="s0">assert </span><span class="s1">tx.get_color() == textprops[</span><span class="s3">&quot;color&quot;</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_pie_get_negative_values():</span>
    <span class="s2"># Test the ValueError raised when feeding negative values into axes.pie</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.pie([</span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s1">-</span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">explode=[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.2</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_normalize_kwarg_pie():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = [</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">]</span>
    <span class="s1">t1 = ax.pie(x=x</span><span class="s0">, </span><span class="s1">normalize=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">abs(t1[</span><span class="s4">0</span><span class="s1">][-</span><span class="s4">1</span><span class="s1">].theta2 - </span><span class="s4">360.</span><span class="s1">) &lt; </span><span class="s4">1e-3</span>
    <span class="s1">t2 = ax.pie(x=x</span><span class="s0">, </span><span class="s1">normalize=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">abs(t2[</span><span class="s4">0</span><span class="s1">][-</span><span class="s4">1</span><span class="s1">].theta2 - </span><span class="s4">360.</span><span class="s1">) &gt; </span><span class="s4">1e-3</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_pie_hatch_single(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x = [</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">]</span>
    <span class="s1">hatch = </span><span class="s3">'+'</span>
    <span class="s1">fig_test.subplots().pie(x</span><span class="s0">, </span><span class="s1">hatch=hatch)</span>
    <span class="s1">wedges</span><span class="s0">, </span><span class="s1">_ = fig_ref.subplots().pie(x)</span>
    <span class="s1">[w.set_hatch(hatch) </span><span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s1">wedges]</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_pie_hatch_multi(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x = [</span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">]</span>
    <span class="s1">hatch = [</span><span class="s3">'/'</span><span class="s0">, </span><span class="s3">'+'</span><span class="s0">, </span><span class="s3">'.'</span><span class="s1">]</span>
    <span class="s1">fig_test.subplots().pie(x</span><span class="s0">, </span><span class="s1">hatch=hatch)</span>
    <span class="s1">wedges</span><span class="s0">, </span><span class="s1">_ = fig_ref.subplots().pie(x)</span>
    <span class="s1">[w.set_hatch(hp) </span><span class="s0">for </span><span class="s1">w</span><span class="s0">, </span><span class="s1">hp </span><span class="s0">in </span><span class="s1">zip(wedges</span><span class="s0">, </span><span class="s1">hatch)]</span>


<span class="s1">@image_comparison([</span><span class="s3">'set_get_ticklabels.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_set_get_ticklabels():</span>
    <span class="s2"># test issue 2246</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ha = [</span><span class="s3">'normal'</span><span class="s0">, </span><span class="s3">'set_x/yticklabels'</span><span class="s1">]</span>

    <span class="s1">ax[</span><span class="s4">0</span><span class="s1">].plot(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax[</span><span class="s4">0</span><span class="s1">].set_title(ha[</span><span class="s4">0</span><span class="s1">])</span>

    <span class="s1">ax[</span><span class="s4">1</span><span class="s1">].plot(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax[</span><span class="s4">1</span><span class="s1">].set_title(ha[</span><span class="s4">1</span><span class="s1">])</span>

    <span class="s2"># set ticklabel to 1 plot in normal way</span>
    <span class="s1">ax[</span><span class="s4">0</span><span class="s1">].set_xticks(range(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax[</span><span class="s4">0</span><span class="s1">].set_yticks(range(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax[</span><span class="s4">0</span><span class="s1">].set_xticklabels([</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'c'</span><span class="s0">, </span><span class="s3">'d'</span><span class="s1">] + </span><span class="s4">6 </span><span class="s1">* [</span><span class="s3">''</span><span class="s1">])</span>
    <span class="s1">ax[</span><span class="s4">0</span><span class="s1">].set_yticklabels([</span><span class="s3">'11'</span><span class="s0">, </span><span class="s3">'12'</span><span class="s0">, </span><span class="s3">'13'</span><span class="s0">, </span><span class="s3">'14'</span><span class="s1">] + </span><span class="s4">6 </span><span class="s1">* [</span><span class="s3">''</span><span class="s1">])</span>

    <span class="s2"># set ticklabel to the other plot, expect the 2 plots have same label</span>
    <span class="s2"># setting pass get_ticklabels return value as ticklabels argument</span>
    <span class="s1">ax[</span><span class="s4">1</span><span class="s1">].set_xticks(ax[</span><span class="s4">0</span><span class="s1">].get_xticks())</span>
    <span class="s1">ax[</span><span class="s4">1</span><span class="s1">].set_yticks(ax[</span><span class="s4">0</span><span class="s1">].get_yticks())</span>
    <span class="s1">ax[</span><span class="s4">1</span><span class="s1">].set_xticklabels(ax[</span><span class="s4">0</span><span class="s1">].get_xticklabels())</span>
    <span class="s1">ax[</span><span class="s4">1</span><span class="s1">].set_yticklabels(ax[</span><span class="s4">0</span><span class="s1">].get_yticklabels())</span>


<span class="s0">def </span><span class="s1">test_set_ticks_kwargs_raise_error_without_labels():</span>
    <span class="s5">&quot;&quot;&quot; 
    When labels=None and any kwarg is passed, axis.set_ticks() raises a 
    ValueError. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ticks = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.xaxis.set_ticks(ticks</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">0.5</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_set_ticks_with_labels(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s5">&quot;&quot;&quot; 
    Test that these two are identical:: 
 
        set_xticks(ticks); set_xticklabels(labels, **kwargs) 
        set_xticks(ticks, labels, **kwargs) 
 
    &quot;&quot;&quot;</span>
    <span class="s1">ax = fig_ref.subplots()</span>
    <span class="s1">ax.set_xticks([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s1">])</span>
    <span class="s1">ax.set_xticklabels([</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'c'</span><span class="s0">, </span><span class="s3">'d'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fontweight=</span><span class="s3">'bold'</span><span class="s1">)</span>
    <span class="s1">ax.set_yticks([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
    <span class="s1">ax.set_yticks([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_yticklabels([</span><span class="s3">'A'</span><span class="s0">, </span><span class="s3">'B'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">ax = fig_test.subplots()</span>
    <span class="s1">ax.set_xticks([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'c'</span><span class="s0">, </span><span class="s3">'d'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">fontweight=</span><span class="s3">'bold'</span><span class="s1">)</span>
    <span class="s1">ax.set_yticks([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
    <span class="s1">ax.set_yticks([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'A'</span><span class="s0">, </span><span class="s3">'B'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">minor=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_xticks_bad_args():</span>
    <span class="s1">ax = plt.figure().add_subplot()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'must be a sequence'</span><span class="s1">):</span>
        <span class="s1">ax.set_xticks([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">9</span><span class="s1">]</span><span class="s0">, </span><span class="s4">3.1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'must be 1D'</span><span class="s1">):</span>
        <span class="s1">plt.xticks(np.arange(</span><span class="s4">4</span><span class="s1">).reshape((-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'must be 1D'</span><span class="s1">):</span>
        <span class="s1">plt.xticks(np.arange(</span><span class="s4">4</span><span class="s1">).reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'must be 1D'</span><span class="s1">):</span>
        <span class="s1">plt.xticks(np.arange(</span><span class="s4">4</span><span class="s1">).reshape((-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">labels=range(</span><span class="s4">4</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'must be 1D'</span><span class="s1">):</span>
        <span class="s1">plt.xticks(np.arange(</span><span class="s4">4</span><span class="s1">).reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">labels=range(</span><span class="s4">4</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_subsampled_ticklabels():</span>
    <span class="s2"># test issue 11937</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax.xaxis.set_ticks(np.arange(</span><span class="s4">10</span><span class="s1">) + </span><span class="s4">0.1</span><span class="s1">)</span>
    <span class="s1">ax.locator_params(nbins=</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">ax.xaxis.set_ticklabels([c </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s3">&quot;bcdefghijk&quot;</span><span class="s1">])</span>
    <span class="s1">plt.draw()</span>
    <span class="s1">labels = [t.get_text() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">ax.xaxis.get_ticklabels()]</span>
    <span class="s0">assert </span><span class="s1">labels == [</span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'d'</span><span class="s0">, </span><span class="s3">'f'</span><span class="s0">, </span><span class="s3">'h'</span><span class="s0">, </span><span class="s3">'j'</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_mismatched_ticklabels():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">ax.xaxis.set_ticks([</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.xaxis.set_ticklabels([</span><span class="s3">'a'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'c'</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_empty_ticks_fixed_loc():</span>
    <span class="s2"># Smoke test that [] can be used to unset all tick labels</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s1">ax.set_xticks([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s1">ax.set_xticklabels([])</span>


<span class="s1">@image_comparison([</span><span class="s3">'retain_tick_visibility.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_retain_tick_visibility():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">plt.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">plt.setp(ax.get_yticklabels()</span><span class="s0">, </span><span class="s1">visible=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.tick_params(axis=</span><span class="s3">&quot;y&quot;</span><span class="s0">, </span><span class="s1">which=</span><span class="s3">&quot;both&quot;</span><span class="s0">, </span><span class="s1">length=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_tick_label_update():</span>
    <span class="s2"># test issue 9397</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s2"># Set up a dummy formatter</span>
    <span class="s0">def </span><span class="s1">formatter_func(x</span><span class="s0">, </span><span class="s1">pos):</span>
        <span class="s0">return </span><span class="s3">&quot;unit value&quot; </span><span class="s0">if </span><span class="s1">x == </span><span class="s4">1 </span><span class="s0">else </span><span class="s3">&quot;&quot;</span>
    <span class="s1">ax.xaxis.set_major_formatter(plt.FuncFormatter(formatter_func))</span>

    <span class="s2"># Force some of the x-axis ticks to be outside of the drawn range</span>
    <span class="s1">ax.set_xticks([-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">ax.set_xlim(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">)</span>

    <span class="s1">ax.figure.canvas.draw()</span>
    <span class="s1">tick_texts = [tick.get_text() </span><span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax.xaxis.get_ticklabels()]</span>
    <span class="s0">assert </span><span class="s1">tick_texts == [</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s3">&quot;unit value&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s3">&quot;&quot;</span><span class="s1">]</span>


<span class="s1">@image_comparison([</span><span class="s3">'o_marker_path_snap.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">72</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_o_marker_path_snap():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.margins(</span><span class="s4">.1</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ms </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">15</span><span class="s1">):</span>
        <span class="s1">ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.ones(</span><span class="s4">2</span><span class="s1">) + ms</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ms=ms)</span>

    <span class="s0">for </span><span class="s1">ms </span><span class="s0">in </span><span class="s1">np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">25</span><span class="s1">):</span>
        <span class="s1">ax.plot([</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s1">]</span><span class="s0">, </span><span class="s1">np.ones(</span><span class="s4">2</span><span class="s1">) + ms</span><span class="s0">, </span><span class="s3">'o'</span><span class="s0">, </span><span class="s1">ms=ms)</span>


<span class="s0">def </span><span class="s1">test_margins():</span>
    <span class="s2"># test all ways margins can be called</span>
    <span class="s1">data = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]</span>
    <span class="s1">xmin = </span><span class="s4">0.0</span>
    <span class="s1">xmax = len(data) - </span><span class="s4">1.0</span>
    <span class="s1">ymin = min(data)</span>
    <span class="s1">ymax = max(data)</span>

    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax1.plot(data)</span>
    <span class="s1">ax1.margins(</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax1.margins() == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax1.get_xlim() == (xmin - (xmax - xmin) * </span><span class="s4">1</span><span class="s0">,</span>
                              <span class="s1">xmax + (xmax - xmin) * </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax1.get_ylim() == (ymin - (ymax - ymin) * </span><span class="s4">1</span><span class="s0">,</span>
                              <span class="s1">ymax + (ymax - ymin) * </span><span class="s4">1</span><span class="s1">)</span>

    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax2.plot(data)</span>
    <span class="s1">ax2.margins(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax2.margins() == (</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax2.get_xlim() == (xmin - (xmax - xmin) * </span><span class="s4">0.5</span><span class="s0">,</span>
                              <span class="s1">xmax + (xmax - xmin) * </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax2.get_ylim() == (ymin - (ymax - ymin) * </span><span class="s4">2</span><span class="s0">,</span>
                              <span class="s1">ymax + (ymax - ymin) * </span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">fig3</span><span class="s0">, </span><span class="s1">ax3 = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax3.plot(data)</span>
    <span class="s1">ax3.margins(x=-</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">y=</span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax3.margins() == (-</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax3.get_xlim() == (xmin - (xmax - xmin) * -</span><span class="s4">0.2</span><span class="s0">,</span>
                              <span class="s1">xmax + (xmax - xmin) * -</span><span class="s4">0.2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax3.get_ylim() == (ymin - (ymax - ymin) * </span><span class="s4">0.5</span><span class="s0">,</span>
                              <span class="s1">ymax + (ymax - ymin) * </span><span class="s4">0.5</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_set_margin_updates_limits():</span>
    <span class="s1">mpl.style.use(</span><span class="s3">&quot;default&quot;</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s1">ax.set(xscale=</span><span class="s3">&quot;log&quot;</span><span class="s0">, </span><span class="s1">xmargin=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'err, args, kwargs, match'</span><span class="s0">, </span><span class="s1">(</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">1</span><span class="s0">,</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s3">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s3">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">tuple()</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'x'</span><span class="s1">: -</span><span class="s4">1</span><span class="s1">}</span><span class="s0">, </span><span class="s3">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(ValueError</span><span class="s0">, </span><span class="s1">tuple()</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'y'</span><span class="s1">: -</span><span class="s4">1</span><span class="s1">}</span><span class="s0">, </span><span class="s3">r'margin must be greater than -0\.5'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'x'</span><span class="s1">: </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'y'</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span><span class="s0">,</span>
         <span class="s3">'Cannot pass both positional and keyword arguments for x and/or y'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">{</span><span class="s3">'x'</span><span class="s1">: </span><span class="s4">1</span><span class="s1">}</span><span class="s0">,</span>
         <span class="s3">'Cannot pass both positional and keyword arguments for x and/or y'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(TypeError</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">{}</span><span class="s0">, </span><span class="s3">'Must pass a single positional argument'</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_margins_errors(err</span><span class="s0">, </span><span class="s1">args</span><span class="s0">, </span><span class="s1">kwargs</span><span class="s0">, </span><span class="s1">match):</span>
    <span class="s0">with </span><span class="s1">pytest.raises(err</span><span class="s0">, </span><span class="s1">match=match):</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax = fig.add_subplot()</span>
        <span class="s1">ax.margins(*args</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">test_length_one_hist():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.hist([</span><span class="s4">1</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_set_xy_bound():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot()</span>
    <span class="s1">ax.set_xbound(</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xbound() == (</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">)</span>
    <span class="s1">ax.set_xbound(upper=</span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xbound() == (</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s1">ax.set_xbound(lower=</span><span class="s4">3.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xbound() == (</span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">)</span>

    <span class="s1">ax.set_ybound(</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound() == (</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">)</span>
    <span class="s1">ax.set_ybound(upper=</span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound() == (</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (</span><span class="s4">2.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s1">ax.set_ybound(lower=</span><span class="s4">3.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound() == (</span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (</span><span class="s4">3.0</span><span class="s0">, </span><span class="s4">4.0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_pathological_hexbin():</span>
    <span class="s2"># issue #2863</span>
    <span class="s1">mylist = [</span><span class="s4">10</span><span class="s1">] * </span><span class="s4">100</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.hexbin(mylist</span><span class="s0">, </span><span class="s1">mylist)</span>
    <span class="s1">fig.savefig(io.BytesIO())  </span><span class="s2"># Check that no warning is emitted.</span>


<span class="s0">def </span><span class="s1">test_color_None():</span>
    <span class="s2"># issue 3855</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">color=</span><span class="s0">None</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_color_alias():</span>
    <span class="s2"># issues 4157 and 4162</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line = ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=</span><span class="s3">'lime'</span><span class="s1">)[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s3">'lime' </span><span class="s1">== line.get_color()</span>


<span class="s0">def </span><span class="s1">test_numerical_hist_label():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist([range(</span><span class="s4">15</span><span class="s1">)] * </span><span class="s4">5</span><span class="s0">, </span><span class="s1">label=range(</span><span class="s4">5</span><span class="s1">))</span>
    <span class="s1">ax.legend()</span>


<span class="s0">def </span><span class="s1">test_unicode_hist_label():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">a = (</span><span class="s6">b'</span><span class="s0">\xe5\xbe\x88\xe6\xbc\x82\xe4\xba\xae</span><span class="s6">, ' </span><span class="s1">+</span>
         <span class="s6">b'r</span><span class="s0">\xc3\xb6</span><span class="s6">m</span><span class="s0">\xc3\xa4</span><span class="s6">n ch</span><span class="s0">\xc3\xa4</span><span class="s6">r</span><span class="s0">\xc3\xa1</span><span class="s6">ct</span><span class="s0">\xc3\xa8</span><span class="s6">rs'</span><span class="s1">)</span>
    <span class="s1">b = </span><span class="s6">b'</span><span class="s0">\xd7\xa9\xd7\x9c\xd7\x95\xd7\x9d</span><span class="s6">'</span>
    <span class="s1">labels = [a.decode(</span><span class="s3">'utf-8'</span><span class="s1">)</span><span class="s0">,</span>
              <span class="s3">'hi aardvark'</span><span class="s0">,</span>
              <span class="s1">b.decode(</span><span class="s3">'utf-8'</span><span class="s1">)</span><span class="s0">,</span>
              <span class="s1">]</span>

    <span class="s1">ax.hist([range(</span><span class="s4">15</span><span class="s1">)] * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">label=labels)</span>
    <span class="s1">ax.legend()</span>


<span class="s0">def </span><span class="s1">test_move_offsetlabel():</span>
    <span class="s1">data = np.random.random(</span><span class="s4">10</span><span class="s1">) * </span><span class="s4">1e-22</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(data)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">before = ax.yaxis.offsetText.get_position()</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.offsetText.get_horizontalalignment() == </span><span class="s3">'left'</span>
    <span class="s1">ax.yaxis.tick_right()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">after = ax.yaxis.offsetText.get_position()</span>
    <span class="s0">assert </span><span class="s1">after[</span><span class="s4">0</span><span class="s1">] &gt; before[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">and </span><span class="s1">after[</span><span class="s4">1</span><span class="s1">] == before[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.offsetText.get_horizontalalignment() == </span><span class="s3">'right'</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(data)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">before = ax.xaxis.offsetText.get_position()</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.offsetText.get_verticalalignment() == </span><span class="s3">'top'</span>
    <span class="s1">ax.xaxis.tick_top()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">after = ax.xaxis.offsetText.get_position()</span>
    <span class="s0">assert </span><span class="s1">after[</span><span class="s4">0</span><span class="s1">] == before[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">and </span><span class="s1">after[</span><span class="s4">1</span><span class="s1">] &gt; before[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.offsetText.get_verticalalignment() == </span><span class="s3">'bottom'</span>


<span class="s1">@image_comparison([</span><span class="s3">'rc_spines.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_rc_spines():</span>
    <span class="s1">rc_dict = {</span>
        <span class="s3">'axes.spines.left'</span><span class="s1">: </span><span class="s0">False,</span>
        <span class="s3">'axes.spines.right'</span><span class="s1">: </span><span class="s0">False,</span>
        <span class="s3">'axes.spines.top'</span><span class="s1">: </span><span class="s0">False,</span>
        <span class="s3">'axes.spines.bottom'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}</span>
    <span class="s0">with </span><span class="s1">matplotlib.rc_context(rc_dict):</span>
        <span class="s1">plt.subplots()  </span><span class="s2"># create a figure and axes with the spine properties</span>


<span class="s1">@image_comparison([</span><span class="s3">'rc_grid.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">savefig_kwarg={</span><span class="s3">'dpi'</span><span class="s1">: </span><span class="s4">40</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_rc_grid():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">rc_dict0 = {</span>
        <span class="s3">'axes.grid'</span><span class="s1">: </span><span class="s0">True,</span>
        <span class="s3">'axes.grid.axis'</span><span class="s1">: </span><span class="s3">'both'</span>
    <span class="s1">}</span>
    <span class="s1">rc_dict1 = {</span>
        <span class="s3">'axes.grid'</span><span class="s1">: </span><span class="s0">True,</span>
        <span class="s3">'axes.grid.axis'</span><span class="s1">: </span><span class="s3">'x'</span>
    <span class="s1">}</span>
    <span class="s1">rc_dict2 = {</span>
        <span class="s3">'axes.grid'</span><span class="s1">: </span><span class="s0">True,</span>
        <span class="s3">'axes.grid.axis'</span><span class="s1">: </span><span class="s3">'y'</span>
    <span class="s1">}</span>
    <span class="s1">dict_list = [rc_dict0</span><span class="s0">, </span><span class="s1">rc_dict1</span><span class="s0">, </span><span class="s1">rc_dict2]</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">rc_dict </span><span class="s0">in </span><span class="s1">enumerate(dict_list</span><span class="s0">, </span><span class="s4">1</span><span class="s1">):</span>
        <span class="s0">with </span><span class="s1">matplotlib.rc_context(rc_dict):</span>
            <span class="s1">fig.add_subplot(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">i)</span>


<span class="s0">def </span><span class="s1">test_rc_tick():</span>
    <span class="s1">d = {</span><span class="s3">'xtick.bottom'</span><span class="s1">: </span><span class="s0">False, </span><span class="s3">'xtick.top'</span><span class="s1">: </span><span class="s0">True,</span>
         <span class="s3">'ytick.left'</span><span class="s1">: </span><span class="s0">True, </span><span class="s3">'ytick.right'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}</span>
    <span class="s0">with </span><span class="s1">plt.rc_context(rc=d):</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax1 = fig.add_subplot(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">xax = ax1.xaxis</span>
        <span class="s1">yax = ax1.yaxis</span>
        <span class="s2"># tick1On bottom/left</span>
        <span class="s0">assert not </span><span class="s1">xax._major_tick_kw[</span><span class="s3">'tick1On'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">xax._major_tick_kw[</span><span class="s3">'tick2On'</span><span class="s1">]</span>
        <span class="s0">assert not </span><span class="s1">xax._minor_tick_kw[</span><span class="s3">'tick1On'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">xax._minor_tick_kw[</span><span class="s3">'tick2On'</span><span class="s1">]</span>

        <span class="s0">assert </span><span class="s1">yax._major_tick_kw[</span><span class="s3">'tick1On'</span><span class="s1">]</span>
        <span class="s0">assert not </span><span class="s1">yax._major_tick_kw[</span><span class="s3">'tick2On'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">yax._minor_tick_kw[</span><span class="s3">'tick1On'</span><span class="s1">]</span>
        <span class="s0">assert not </span><span class="s1">yax._minor_tick_kw[</span><span class="s3">'tick2On'</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_rc_major_minor_tick():</span>
    <span class="s1">d = {</span><span class="s3">'xtick.top'</span><span class="s1">: </span><span class="s0">True, </span><span class="s3">'ytick.right'</span><span class="s1">: </span><span class="s0">True,  </span><span class="s2"># Enable all ticks</span>
         <span class="s3">'xtick.bottom'</span><span class="s1">: </span><span class="s0">True, </span><span class="s3">'ytick.left'</span><span class="s1">: </span><span class="s0">True,</span>
         <span class="s2"># Selectively disable</span>
         <span class="s3">'xtick.minor.bottom'</span><span class="s1">: </span><span class="s0">False, </span><span class="s3">'xtick.major.bottom'</span><span class="s1">: </span><span class="s0">False,</span>
         <span class="s3">'ytick.major.left'</span><span class="s1">: </span><span class="s0">False, </span><span class="s3">'ytick.minor.left'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}</span>
    <span class="s0">with </span><span class="s1">plt.rc_context(rc=d):</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax1 = fig.add_subplot(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">xax = ax1.xaxis</span>
        <span class="s1">yax = ax1.yaxis</span>
        <span class="s2"># tick1On bottom/left</span>
        <span class="s0">assert not </span><span class="s1">xax._major_tick_kw[</span><span class="s3">'tick1On'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">xax._major_tick_kw[</span><span class="s3">'tick2On'</span><span class="s1">]</span>
        <span class="s0">assert not </span><span class="s1">xax._minor_tick_kw[</span><span class="s3">'tick1On'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">xax._minor_tick_kw[</span><span class="s3">'tick2On'</span><span class="s1">]</span>

        <span class="s0">assert not </span><span class="s1">yax._major_tick_kw[</span><span class="s3">'tick1On'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">yax._major_tick_kw[</span><span class="s3">'tick2On'</span><span class="s1">]</span>
        <span class="s0">assert not </span><span class="s1">yax._minor_tick_kw[</span><span class="s3">'tick1On'</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">yax._minor_tick_kw[</span><span class="s3">'tick2On'</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_square_plot():</span>
    <span class="s1">x = np.arange(</span><span class="s4">4</span><span class="s1">)</span>
    <span class="s1">y = np.array([</span><span class="s4">1.</span><span class="s0">, </span><span class="s4">3.</span><span class="s0">, </span><span class="s4">5.</span><span class="s0">, </span><span class="s4">7.</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">'mo'</span><span class="s1">)</span>
    <span class="s1">ax.axis(</span><span class="s3">'square'</span><span class="s1">)</span>
    <span class="s1">xlim</span><span class="s0">, </span><span class="s1">ylim = ax.get_xlim()</span><span class="s0">, </span><span class="s1">ax.get_ylim()</span>
    <span class="s0">assert </span><span class="s1">np.diff(xlim) == np.diff(ylim)</span>
    <span class="s0">assert </span><span class="s1">ax.get_aspect() == </span><span class="s4">1</span>
    <span class="s1">assert_array_almost_equal(</span>
        <span class="s1">ax.get_position(original=</span><span class="s0">True</span><span class="s1">).extents</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.125</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.9</span><span class="s0">, </span><span class="s4">0.9</span><span class="s1">))</span>
    <span class="s1">assert_array_almost_equal(</span>
        <span class="s1">ax.get_position(original=</span><span class="s0">False</span><span class="s1">).extents</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.2125</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.8125</span><span class="s0">, </span><span class="s4">0.9</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_bad_plot_args():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.plot(</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.plot(</span><span class="s0">None, None</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.plot(np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.zeros((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.plot((np.arange(</span><span class="s4">5</span><span class="s1">).reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">5</span><span class="s1">).reshape(-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)))</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;xy, cls&quot;</span><span class="s0">, </span><span class="s1">[</span>
        <span class="s1">(()</span><span class="s0">, </span><span class="s1">mpl.image.AxesImage)</span><span class="s0">,  </span><span class="s2"># (0, N)</span>
        <span class="s1">(((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">6</span><span class="s1">))</span><span class="s0">, </span><span class="s1">mpl.image.AxesImage)</span><span class="s0">,  </span><span class="s2"># (xmin, xmax)</span>
        <span class="s1">((range(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">4</span><span class="s1">))</span><span class="s0">, </span><span class="s1">mpl.image.AxesImage)</span><span class="s0">,  </span><span class="s2"># regular grid</span>
        <span class="s1">(([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">8</span><span class="s0">, </span><span class="s4">16</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span><span class="s0">,  </span><span class="s2"># irregular grid</span>
         <span class="s1">mpl.image.PcolorImage)</span><span class="s0">,</span>
        <span class="s1">((np.random.random((</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.random.random((</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)))</span><span class="s0">,  </span><span class="s2"># 2D coords</span>
         <span class="s1">mpl.collections.QuadMesh)</span><span class="s0">,</span>
    <span class="s1">]</span>
<span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;data&quot;</span><span class="s0">, </span><span class="s1">[np.arange(</span><span class="s4">12</span><span class="s1">).reshape((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.random.rand(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_pcolorfast(xy</span><span class="s0">, </span><span class="s1">data</span><span class="s0">, </span><span class="s1">cls):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">assert </span><span class="s1">type(ax.pcolorfast(*xy</span><span class="s0">, </span><span class="s1">data)) == cls</span>


<span class="s0">def </span><span class="s1">test_shared_scale():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].set_xscale(</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].set_yscale(</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s0">assert </span><span class="s1">ax.get_yscale() == </span><span class="s3">'log'</span>
        <span class="s0">assert </span><span class="s1">ax.get_xscale() == </span><span class="s3">'log'</span>

    <span class="s1">axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].set_xscale(</span><span class="s3">&quot;linear&quot;</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].set_yscale(</span><span class="s3">&quot;linear&quot;</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s0">assert </span><span class="s1">ax.get_yscale() == </span><span class="s3">'linear'</span>
        <span class="s0">assert </span><span class="s1">ax.get_xscale() == </span><span class="s3">'linear'</span>


<span class="s0">def </span><span class="s1">test_shared_bool():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">plt.subplot(sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">plt.subplot(sharey=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_violin_point_mass():</span>
    <span class="s5">&quot;&quot;&quot;Violin plot should handle point mass pdf gracefully.&quot;&quot;&quot;</span>
    <span class="s1">plt.violinplot(np.array([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]))</span>


<span class="s0">def </span><span class="s1">generate_errorbar_inputs():</span>
    <span class="s1">base_xy = cycler(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">[np.arange(</span><span class="s4">5</span><span class="s1">)]) + cycler(</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">[np.ones(</span><span class="s4">5</span><span class="s1">)])</span>
    <span class="s1">err_cycler = cycler(</span><span class="s3">'err'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">,</span>
                                <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                                <span class="s1">[[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
                                 <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]]</span><span class="s0">,</span>
                                <span class="s1">np.ones(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">,</span>
                                <span class="s1">np.ones((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span><span class="s0">,</span>
                                <span class="s0">None</span>
                                <span class="s1">])</span>
    <span class="s1">xerr_cy = cycler(</span><span class="s3">'xerr'</span><span class="s0">, </span><span class="s1">err_cycler)</span>
    <span class="s1">yerr_cy = cycler(</span><span class="s3">'yerr'</span><span class="s0">, </span><span class="s1">err_cycler)</span>

    <span class="s1">empty = ((cycler(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">[[]]) + cycler(</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">[[]])) *</span>
             <span class="s1">cycler(</span><span class="s3">'xerr'</span><span class="s0">, </span><span class="s1">[[]</span><span class="s0">, None</span><span class="s1">]) * cycler(</span><span class="s3">'yerr'</span><span class="s0">, </span><span class="s1">[[]</span><span class="s0">, None</span><span class="s1">]))</span>
    <span class="s1">xerr_only = base_xy * xerr_cy</span>
    <span class="s1">yerr_only = base_xy * yerr_cy</span>
    <span class="s1">both_err = base_xy * yerr_cy * xerr_cy</span>

    <span class="s0">return </span><span class="s1">[*xerr_only</span><span class="s0">, </span><span class="s1">*yerr_only</span><span class="s0">, </span><span class="s1">*both_err</span><span class="s0">, </span><span class="s1">*empty]</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'kwargs'</span><span class="s0">, </span><span class="s1">generate_errorbar_inputs())</span>
<span class="s0">def </span><span class="s1">test_errorbar_inputs_shotgun(kwargs):</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">eb = ax.errorbar(**kwargs)</span>
    <span class="s1">eb.remove()</span>


<span class="s1">@image_comparison([</span><span class="s3">&quot;dash_offset&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_dash_offset():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y = np.ones_like(x)</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">100</span><span class="s0">, </span><span class="s4">2</span><span class="s1">):</span>
        <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">j*y</span><span class="s0">, </span><span class="s1">ls=(j</span><span class="s0">, </span><span class="s1">(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">))</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'k'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_title_pad():</span>
    <span class="s2"># check that title padding puts the title in the right</span>
    <span class="s2"># place...</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_title(</span><span class="s3">'aardvark'</span><span class="s0">, </span><span class="s1">pad=</span><span class="s4">30.</span><span class="s1">)</span>
    <span class="s1">m = ax.titleOffsetTrans.get_matrix()</span>
    <span class="s0">assert </span><span class="s1">m[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">] == (</span><span class="s4">30. </span><span class="s1">/ </span><span class="s4">72. </span><span class="s1">* fig.dpi)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'aardvark'</span><span class="s0">, </span><span class="s1">pad=</span><span class="s4">0.</span><span class="s1">)</span>
    <span class="s1">m = ax.titleOffsetTrans.get_matrix()</span>
    <span class="s0">assert </span><span class="s1">m[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">] == </span><span class="s4">0.</span>
    <span class="s2"># check that it is reverted...</span>
    <span class="s1">ax.set_title(</span><span class="s3">'aardvark'</span><span class="s0">, </span><span class="s1">pad=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">m = ax.titleOffsetTrans.get_matrix()</span>
    <span class="s0">assert </span><span class="s1">m[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">] == (matplotlib.rcParams[</span><span class="s3">'axes.titlepad'</span><span class="s1">] / </span><span class="s4">72. </span><span class="s1">* fig.dpi)</span>


<span class="s0">def </span><span class="s1">test_title_location_roundtrip():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2"># set default title location</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'axes.titlelocation'</span><span class="s1">] = </span><span class="s3">'center'</span>
    <span class="s1">ax.set_title(</span><span class="s3">'aardvark'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'left'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'left'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'right'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'right'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s3">'left' </span><span class="s1">== ax.get_title(loc=</span><span class="s3">'left'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s3">'right' </span><span class="s1">== ax.get_title(loc=</span><span class="s3">'right'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s3">'aardvark' </span><span class="s1">== ax.get_title(loc=</span><span class="s3">'center'</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.get_title(loc=</span><span class="s3">'foo'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.set_title(</span><span class="s3">'fail'</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'foo'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'sharex'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_title_location_shared(sharex):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">sharex=sharex)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].set_title(</span><span class="s3">'A'</span><span class="s0">, </span><span class="s1">pad=-</span><span class="s4">40</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].set_title(</span><span class="s3">'B'</span><span class="s0">, </span><span class="s1">pad=-</span><span class="s4">40</span><span class="s1">)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y1 = axs[</span><span class="s4">0</span><span class="s1">].title.get_position()</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y2 = axs[</span><span class="s4">1</span><span class="s1">].title.get_position()</span>
    <span class="s0">assert </span><span class="s1">y1 == y2 == </span><span class="s4">1.0</span>


<span class="s1">@image_comparison([</span><span class="s3">&quot;loglog.png&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">tol=</span><span class="s4">0.02</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_loglog():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span>
    <span class="s1">ax.loglog(x</span><span class="s0">, </span><span class="s1">x**</span><span class="s4">3</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">ax.tick_params(length=</span><span class="s4">25</span><span class="s0">, </span><span class="s1">width=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax.tick_params(length=</span><span class="s4">15</span><span class="s0">, </span><span class="s1">width=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">which=</span><span class="s3">'minor'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">&quot;test_loglog_nonpos.png&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_loglog_nonpos():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">x = np.arange(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span>
    <span class="s1">y = x**</span><span class="s4">3</span>
    <span class="s1">y[</span><span class="s4">7</span><span class="s1">] = -</span><span class="s4">3.</span>
    <span class="s1">x[</span><span class="s4">4</span><span class="s1">] = -</span><span class="s4">10</span>
    <span class="s0">for </span><span class="s1">(mcy</span><span class="s0">, </span><span class="s1">mcx)</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">zip(product([</span><span class="s3">'mask'</span><span class="s0">, </span><span class="s3">'clip'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">]</span><span class="s0">, </span><span class="s1">repeat=</span><span class="s4">2</span><span class="s1">)</span><span class="s0">,</span>
                              <span class="s1">axs.flat):</span>
        <span class="s0">if </span><span class="s1">mcx == mcy:</span>
            <span class="s0">if </span><span class="s1">mcx:</span>
                <span class="s1">ax.loglog(x</span><span class="s0">, </span><span class="s1">y**</span><span class="s4">3</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">nonpositive=mcx)</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">ax.loglog(x</span><span class="s0">, </span><span class="s1">y**</span><span class="s4">3</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s1">)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">ax.loglog(x</span><span class="s0">, </span><span class="s1">y**</span><span class="s4">3</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">2</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">mcx:</span>
                <span class="s1">ax.set_xscale(</span><span class="s3">&quot;log&quot;</span><span class="s0">, </span><span class="s1">nonpositive=mcx)</span>
            <span class="s0">if </span><span class="s1">mcy:</span>
                <span class="s1">ax.set_yscale(</span><span class="s3">&quot;log&quot;</span><span class="s0">, </span><span class="s1">nonpositive=mcy)</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axes_margins():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound()[</span><span class="s4">0</span><span class="s1">] != </span><span class="s4">0</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.bar([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound()[</span><span class="s4">0</span><span class="s1">] == </span><span class="s4">0</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.barh([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_xbound()[</span><span class="s4">0</span><span class="s1">] == </span><span class="s4">0</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.pcolor(np.zeros((</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">ax.get_xbound() == (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound() == (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.pcolorfast(np.zeros((</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">ax.get_xbound() == (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound() == (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound()[</span><span class="s4">0</span><span class="s1">] == </span><span class="s4">0</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.imshow(np.zeros((</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">ax.get_xbound() == (-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">9.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound() == (-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">9.5</span><span class="s1">)</span>


<span class="s1">@pytest.fixture(params=[</span><span class="s3">'x'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">shared_axis_remover(request):</span>
    <span class="s0">def </span><span class="s1">_helper_x(ax):</span>
        <span class="s1">ax2 = ax.twinx()</span>
        <span class="s1">ax2.remove()</span>
        <span class="s1">ax.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">15</span><span class="s1">)</span>
        <span class="s1">r = ax.xaxis.get_major_locator()()</span>
        <span class="s0">assert </span><span class="s1">r[-</span><span class="s4">1</span><span class="s1">] &gt; </span><span class="s4">14</span>

    <span class="s0">def </span><span class="s1">_helper_y(ax):</span>
        <span class="s1">ax2 = ax.twiny()</span>
        <span class="s1">ax2.remove()</span>
        <span class="s1">ax.set_ylim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">15</span><span class="s1">)</span>
        <span class="s1">r = ax.yaxis.get_major_locator()()</span>
        <span class="s0">assert </span><span class="s1">r[-</span><span class="s4">1</span><span class="s1">] &gt; </span><span class="s4">14</span>

    <span class="s0">return </span><span class="s1">{</span><span class="s3">&quot;x&quot;</span><span class="s1">: _helper_x</span><span class="s0">, </span><span class="s3">&quot;y&quot;</span><span class="s1">: _helper_y}[request.param]</span>


<span class="s1">@pytest.fixture(params=[</span><span class="s3">'gca'</span><span class="s0">, </span><span class="s3">'subplots'</span><span class="s0">, </span><span class="s3">'subplots_shared'</span><span class="s0">, </span><span class="s3">'add_axes'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">shared_axes_generator(request):</span>
    <span class="s2"># test all of the ways to get fig/ax sets</span>
    <span class="s0">if </span><span class="s1">request.param == </span><span class="s3">'gca'</span><span class="s1">:</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax = fig.gca()</span>
    <span class="s0">elif </span><span class="s1">request.param == </span><span class="s3">'subplots'</span><span class="s1">:</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">elif </span><span class="s1">request.param == </span><span class="s3">'subplots_shared'</span><span class="s1">:</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax_lst = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s3">'all'</span><span class="s0">, </span><span class="s1">sharey=</span><span class="s3">'all'</span><span class="s1">)</span>
        <span class="s1">ax = ax_lst[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s0">elif </span><span class="s1">request.param == </span><span class="s3">'add_axes'</span><span class="s1">:</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax = fig.add_axes([</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.8</span><span class="s0">, </span><span class="s4">.8</span><span class="s1">])</span>
    <span class="s0">return </span><span class="s1">fig</span><span class="s0">, </span><span class="s1">ax</span>


<span class="s0">def </span><span class="s1">test_remove_shared_axes(shared_axes_generator</span><span class="s0">, </span><span class="s1">shared_axis_remover):</span>
    <span class="s2"># test all of the ways to get fig/ax sets</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = shared_axes_generator</span>
    <span class="s1">shared_axis_remover(ax)</span>


<span class="s0">def </span><span class="s1">test_remove_shared_axes_relim():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax_lst = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s3">'all'</span><span class="s0">, </span><span class="s1">sharey=</span><span class="s3">'all'</span><span class="s1">)</span>
    <span class="s1">ax = ax_lst[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">orig_xlim = ax_lst[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">].get_xlim()</span>
    <span class="s1">ax.remove()</span>
    <span class="s1">ax.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">assert_array_equal(ax_lst[</span><span class="s4">0</span><span class="s1">][</span><span class="s4">1</span><span class="s1">].get_xlim()</span><span class="s0">, </span><span class="s1">orig_xlim)</span>


<span class="s0">def </span><span class="s1">test_shared_axes_autoscale():</span>
    <span class="s1">l = np.arange(-</span><span class="s4">80</span><span class="s0">, </span><span class="s4">90</span><span class="s0">, </span><span class="s4">40</span><span class="s1">)</span>
    <span class="s1">t = np.random.random_sample((l.size</span><span class="s0">, </span><span class="s1">l.size))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">ax1.set_xlim(-</span><span class="s4">1000</span><span class="s0">, </span><span class="s4">1000</span><span class="s1">)</span>
    <span class="s1">ax1.set_ylim(-</span><span class="s4">1000</span><span class="s0">, </span><span class="s4">1000</span><span class="s1">)</span>
    <span class="s1">ax1.contour(l</span><span class="s0">, </span><span class="s1">l</span><span class="s0">, </span><span class="s1">t)</span>

    <span class="s1">ax2.contour(l</span><span class="s0">, </span><span class="s1">l</span><span class="s0">, </span><span class="s1">t)</span>
    <span class="s0">assert not </span><span class="s1">ax1.get_autoscalex_on() </span><span class="s0">and not </span><span class="s1">ax2.get_autoscalex_on()</span>
    <span class="s0">assert not </span><span class="s1">ax1.get_autoscaley_on() </span><span class="s0">and not </span><span class="s1">ax2.get_autoscaley_on()</span>
    <span class="s0">assert </span><span class="s1">ax1.get_xlim() == ax2.get_xlim() == (-</span><span class="s4">1000</span><span class="s0">, </span><span class="s4">1000</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax1.get_ylim() == ax2.get_ylim() == (-</span><span class="s4">1000</span><span class="s0">, </span><span class="s4">1000</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_adjust_numtick_aspect():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.yaxis.get_major_locator().set_params(nbins=</span><span class="s3">'auto'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1000</span><span class="s1">)</span>
    <span class="s1">ax.set_aspect(</span><span class="s3">'equal'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">len(ax.yaxis.get_major_locator()()) == </span><span class="s4">2</span>
    <span class="s1">ax.set_ylim(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1000</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">len(ax.yaxis.get_major_locator()()) &gt; </span><span class="s4">2</span>


<span class="s1">@mpl.style.context(</span><span class="s3">&quot;default&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_auto_numticks():</span>
    <span class="s1">axs = plt.figure().subplots(</span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:  </span><span class="s2"># Tiny, empty subplots have only 3 ticks.</span>
        <span class="s0">assert </span><span class="s1">[*ax.get_xticks()] == [*ax.get_yticks()] == [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span>


<span class="s1">@mpl.style.context(</span><span class="s3">&quot;default&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_auto_numticks_log():</span>
    <span class="s2"># Verify that there are not too many ticks with a large log range.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">mpl.rcParams[</span><span class="s3">'axes.autolimit_mode'</span><span class="s1">] = </span><span class="s3">'round_numbers'</span>
    <span class="s1">ax.loglog([</span><span class="s4">1e-20</span><span class="s0">, </span><span class="s4">1e5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1e-16</span><span class="s0">, </span><span class="s4">10</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">(np.log10(ax.get_xticks()) == np.arange(-</span><span class="s4">26</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s4">4</span><span class="s1">)).all()</span>
    <span class="s0">assert </span><span class="s1">(np.log10(ax.get_yticks()) == np.arange(-</span><span class="s4">20</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)).all()</span>


<span class="s0">def </span><span class="s1">test_broken_barh_empty():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.broken_barh([]</span><span class="s0">, </span><span class="s1">(</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.5</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_broken_barh_timedelta():</span>
    <span class="s5">&quot;&quot;&quot;Check that timedelta works as x, dx pair for this method.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">d0 = datetime.datetime(</span><span class="s4">2018</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s4">9</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">pp = ax.broken_barh([(d0</span><span class="s0">, </span><span class="s1">datetime.timedelta(hours=</span><span class="s4">1</span><span class="s1">))]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">pp.get_paths()[</span><span class="s4">0</span><span class="s1">].vertices[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">] == mdates.date2num(d0)</span>
    <span class="s0">assert </span><span class="s1">pp.get_paths()[</span><span class="s4">0</span><span class="s1">].vertices[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">] == mdates.date2num(d0) + </span><span class="s4">1 </span><span class="s1">/ </span><span class="s4">24</span>


<span class="s0">def </span><span class="s1">test_pandas_pcolormesh(pd):</span>
    <span class="s1">time = pd.date_range(</span><span class="s3">'2000-01-01'</span><span class="s0">, </span><span class="s1">periods=</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">depth = np.arange(</span><span class="s4">20</span><span class="s1">)</span>
    <span class="s1">data = np.random.rand(</span><span class="s4">19</span><span class="s0">, </span><span class="s4">9</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.pcolormesh(time</span><span class="s0">, </span><span class="s1">depth</span><span class="s0">, </span><span class="s1">data)</span>


<span class="s0">def </span><span class="s1">test_pandas_indexing_dates(pd):</span>
    <span class="s1">dates = np.arange(</span><span class="s3">'2005-02'</span><span class="s0">, </span><span class="s3">'2005-03'</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s3">'datetime64[D]'</span><span class="s1">)</span>
    <span class="s1">values = np.sin(range(len(dates)))</span>
    <span class="s1">df = pd.DataFrame({</span><span class="s3">'dates'</span><span class="s1">: dates</span><span class="s0">, </span><span class="s3">'values'</span><span class="s1">: values})</span>

    <span class="s1">ax = plt.gca()</span>

    <span class="s1">without_zero_index = df[np.array(df.index) % </span><span class="s4">2 </span><span class="s1">== </span><span class="s4">1</span><span class="s1">].copy()</span>
    <span class="s1">ax.plot(</span><span class="s3">'dates'</span><span class="s0">, </span><span class="s3">'values'</span><span class="s0">, </span><span class="s1">data=without_zero_index)</span>


<span class="s0">def </span><span class="s1">test_pandas_errorbar_indexing(pd):</span>
    <span class="s1">df = pd.DataFrame(np.random.uniform(size=(</span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span><span class="s0">,</span>
                      <span class="s1">columns=[</span><span class="s3">'x'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s0">, </span><span class="s3">'xe'</span><span class="s0">, </span><span class="s3">'ye'</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">index=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.errorbar(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">xerr=</span><span class="s3">'xe'</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s3">'ye'</span><span class="s0">, </span><span class="s1">data=df)</span>


<span class="s0">def </span><span class="s1">test_pandas_index_shape(pd):</span>
    <span class="s1">df = pd.DataFrame({</span><span class="s3">&quot;XX&quot;</span><span class="s1">: [</span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;YY&quot;</span><span class="s1">: [</span><span class="s4">7</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]})</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(df.index</span><span class="s0">, </span><span class="s1">df[</span><span class="s3">'YY'</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_pandas_indexing_hist(pd):</span>
    <span class="s1">ser_1 = pd.Series(data=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">])</span>
    <span class="s1">ser_2 = ser_1.iloc[</span><span class="s4">1</span><span class="s1">:]</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.hist(ser_2)</span>


<span class="s0">def </span><span class="s1">test_pandas_bar_align_center(pd):</span>
    <span class="s2"># Tests fix for issue 8767</span>
    <span class="s1">df = pd.DataFrame({</span><span class="s3">'a'</span><span class="s1">: range(</span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">: range(</span><span class="s4">2</span><span class="s1">)})</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">1</span><span class="s1">)</span>

    <span class="s1">ax.bar(df.loc[df[</span><span class="s3">'a'</span><span class="s1">] == </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
           <span class="s1">df.loc[df[</span><span class="s3">'a'</span><span class="s1">] == </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s0">,</span>
           <span class="s1">align=</span><span class="s3">'center'</span><span class="s1">)</span>

    <span class="s1">fig.canvas.draw()</span>


<span class="s0">def </span><span class="s1">test_axis_get_tick_params():</span>
    <span class="s1">axis = plt.subplot().yaxis</span>
    <span class="s1">initial_major_style_translated = {**axis.get_tick_params(which=</span><span class="s3">'major'</span><span class="s1">)}</span>
    <span class="s1">initial_minor_style_translated = {**axis.get_tick_params(which=</span><span class="s3">'minor'</span><span class="s1">)}</span>

    <span class="s1">translated_major_kw = axis._translate_tick_params(</span>
        <span class="s1">axis._major_tick_kw</span><span class="s0">, </span><span class="s1">reverse=</span><span class="s0">True</span>
    <span class="s1">)</span>
    <span class="s1">translated_minor_kw = axis._translate_tick_params(</span>
        <span class="s1">axis._minor_tick_kw</span><span class="s0">, </span><span class="s1">reverse=</span><span class="s0">True</span>
    <span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">translated_major_kw == initial_major_style_translated</span>
    <span class="s0">assert </span><span class="s1">translated_minor_kw == initial_minor_style_translated</span>
    <span class="s1">axis.set_tick_params(labelsize=</span><span class="s4">30</span><span class="s0">, </span><span class="s1">labelcolor=</span><span class="s3">'red'</span><span class="s0">,</span>
                         <span class="s1">direction=</span><span class="s3">'out'</span><span class="s0">, </span><span class="s1">which=</span><span class="s3">'both'</span><span class="s1">)</span>

    <span class="s1">new_major_style_translated = {**axis.get_tick_params(which=</span><span class="s3">'major'</span><span class="s1">)}</span>
    <span class="s1">new_minor_style_translated = {**axis.get_tick_params(which=</span><span class="s3">'minor'</span><span class="s1">)}</span>
    <span class="s1">new_major_style = axis._translate_tick_params(new_major_style_translated)</span>
    <span class="s1">new_minor_style = axis._translate_tick_params(new_minor_style_translated)</span>
    <span class="s0">assert </span><span class="s1">initial_major_style_translated != new_major_style_translated</span>
    <span class="s0">assert </span><span class="s1">axis._major_tick_kw == new_major_style</span>
    <span class="s0">assert </span><span class="s1">initial_minor_style_translated != new_minor_style_translated</span>
    <span class="s0">assert </span><span class="s1">axis._minor_tick_kw == new_minor_style</span>


<span class="s0">def </span><span class="s1">test_axis_set_tick_params_labelsize_labelcolor():</span>
    <span class="s2"># Tests fix for issue 4346</span>
    <span class="s1">axis_1 = plt.subplot()</span>
    <span class="s1">axis_1.yaxis.set_tick_params(labelsize=</span><span class="s4">30</span><span class="s0">, </span><span class="s1">labelcolor=</span><span class="s3">'red'</span><span class="s0">,</span>
                                 <span class="s1">direction=</span><span class="s3">'out'</span><span class="s1">)</span>

    <span class="s2"># Expected values after setting the ticks</span>
    <span class="s0">assert </span><span class="s1">axis_1.yaxis.majorTicks[</span><span class="s4">0</span><span class="s1">]._size == </span><span class="s4">4.0</span>
    <span class="s0">assert </span><span class="s1">axis_1.yaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].tick1line.get_color() == </span><span class="s3">'k'</span>
    <span class="s0">assert </span><span class="s1">axis_1.yaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].label1.get_size() == </span><span class="s4">30.0</span>
    <span class="s0">assert </span><span class="s1">axis_1.yaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].label1.get_color() == </span><span class="s3">'red'</span>


<span class="s0">def </span><span class="s1">test_axes_tick_params_gridlines():</span>
    <span class="s2"># Now treating grid params like other Tick params</span>
    <span class="s1">ax = plt.subplot()</span>
    <span class="s1">ax.tick_params(grid_color=</span><span class="s3">'b'</span><span class="s0">, </span><span class="s1">grid_linewidth=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">grid_alpha=</span><span class="s4">0.5</span><span class="s0">,</span>
                   <span class="s1">grid_linestyle=</span><span class="s3">'dashdot'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">ax.xaxis</span><span class="s0">, </span><span class="s1">ax.yaxis:</span>
        <span class="s0">assert </span><span class="s1">axis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_color() == </span><span class="s3">'b'</span>
        <span class="s0">assert </span><span class="s1">axis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_linewidth() == </span><span class="s4">5</span>
        <span class="s0">assert </span><span class="s1">axis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_alpha() == </span><span class="s4">0.5</span>
        <span class="s0">assert </span><span class="s1">axis.majorTicks[</span><span class="s4">0</span><span class="s1">].gridline.get_linestyle() == </span><span class="s3">'-.'</span>


<span class="s0">def </span><span class="s1">test_axes_tick_params_ylabelside():</span>
    <span class="s2"># Tests fix for issue 10267</span>
    <span class="s1">ax = plt.subplot()</span>
    <span class="s1">ax.tick_params(labelleft=</span><span class="s0">False, </span><span class="s1">labelright=</span><span class="s0">True,</span>
                   <span class="s1">which=</span><span class="s3">'major'</span><span class="s1">)</span>
    <span class="s1">ax.tick_params(labelleft=</span><span class="s0">False, </span><span class="s1">labelright=</span><span class="s0">True,</span>
                   <span class="s1">which=</span><span class="s3">'minor'</span><span class="s1">)</span>
    <span class="s2"># expects left false, right true</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].label1.get_visible() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].label2.get_visible() </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.minorTicks[</span><span class="s4">0</span><span class="s1">].label1.get_visible() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.minorTicks[</span><span class="s4">0</span><span class="s1">].label2.get_visible() </span><span class="s0">is True</span>


<span class="s0">def </span><span class="s1">test_axes_tick_params_xlabelside():</span>
    <span class="s2"># Tests fix for issue 10267</span>
    <span class="s1">ax = plt.subplot()</span>
    <span class="s1">ax.tick_params(labeltop=</span><span class="s0">True, </span><span class="s1">labelbottom=</span><span class="s0">False,</span>
                   <span class="s1">which=</span><span class="s3">'major'</span><span class="s1">)</span>
    <span class="s1">ax.tick_params(labeltop=</span><span class="s0">True, </span><span class="s1">labelbottom=</span><span class="s0">False,</span>
                   <span class="s1">which=</span><span class="s3">'minor'</span><span class="s1">)</span>
    <span class="s2"># expects top True, bottom False</span>
    <span class="s2"># label1.get_visible() mapped to labelbottom</span>
    <span class="s2"># label2.get_visible() mapped to labeltop</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].label1.get_visible() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.majorTicks[</span><span class="s4">0</span><span class="s1">].label2.get_visible() </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.minorTicks[</span><span class="s4">0</span><span class="s1">].label1.get_visible() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ax.xaxis.minorTicks[</span><span class="s4">0</span><span class="s1">].label2.get_visible() </span><span class="s0">is True</span>


<span class="s0">def </span><span class="s1">test_none_kwargs():</span>
    <span class="s1">ax = plt.figure().subplots()</span>
    <span class="s1">ln</span><span class="s0">, </span><span class="s1">= ax.plot(range(</span><span class="s4">32</span><span class="s1">)</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ln.get_linestyle() == </span><span class="s3">'-'</span>


<span class="s0">def </span><span class="s1">test_bar_uint8():</span>
    <span class="s1">xs = [</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">b = plt.bar(np.array(xs</span><span class="s0">, </span><span class="s1">dtype=np.uint8)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">align=</span><span class="s3">&quot;edge&quot;</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">(patch</span><span class="s0">, </span><span class="s1">x) </span><span class="s0">in </span><span class="s1">zip(b.patches</span><span class="s0">, </span><span class="s1">xs):</span>
        <span class="s0">assert </span><span class="s1">patch.xy[</span><span class="s4">0</span><span class="s1">] == x</span>


<span class="s1">@image_comparison([</span><span class="s3">'date_timezone_x.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s4">1.0</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_date_timezone_x():</span>
    <span class="s2"># Tests issue 5575</span>
    <span class="s1">time_index = [datetime.datetime(</span><span class="s4">2016</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">22</span><span class="s0">, </span><span class="s1">hour=x</span><span class="s0">,</span>
                                    <span class="s1">tzinfo=dateutil.tz.gettz(</span><span class="s3">'Canada/Eastern'</span><span class="s1">))</span>
                  <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)]</span>

    <span class="s2"># Same Timezone</span>
    <span class="s1">plt.figure(figsize=(</span><span class="s4">20</span><span class="s0">, </span><span class="s4">12</span><span class="s1">))</span>
    <span class="s1">plt.subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">plt.plot_date(time_index</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">'Canada/Eastern'</span><span class="s1">)</span>

    <span class="s2"># Different Timezone</span>
    <span class="s1">plt.subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">plt.plot_date(time_index</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">'UTC'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'date_timezone_y.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date_timezone_y():</span>
    <span class="s2"># Tests issue 5575</span>
    <span class="s1">time_index = [datetime.datetime(</span><span class="s4">2016</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">22</span><span class="s0">, </span><span class="s1">hour=x</span><span class="s0">,</span>
                                    <span class="s1">tzinfo=dateutil.tz.gettz(</span><span class="s3">'Canada/Eastern'</span><span class="s1">))</span>
                  <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)]</span>

    <span class="s2"># Same Timezone</span>
    <span class="s1">plt.figure(figsize=(</span><span class="s4">20</span><span class="s0">, </span><span class="s4">12</span><span class="s1">))</span>
    <span class="s1">plt.subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">plt.plot_date([</span><span class="s4">3</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">,</span>
                  <span class="s1">time_index</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">'Canada/Eastern'</span><span class="s0">, </span><span class="s1">xdate=</span><span class="s0">False, </span><span class="s1">ydate=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s2"># Different Timezone</span>
    <span class="s1">plt.subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">plt.plot_date([</span><span class="s4">3</span><span class="s1">] * </span><span class="s4">3</span><span class="s0">, </span><span class="s1">time_index</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">'UTC'</span><span class="s0">, </span><span class="s1">xdate=</span><span class="s0">False, </span><span class="s1">ydate=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'date_timezone_x_and_y.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">tol=</span><span class="s4">1.0</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_date_timezone_x_and_y():</span>
    <span class="s2"># Tests issue 5575</span>
    <span class="s1">UTC = datetime.timezone.utc</span>
    <span class="s1">time_index = [datetime.datetime(</span><span class="s4">2016</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">22</span><span class="s0">, </span><span class="s1">hour=x</span><span class="s0">, </span><span class="s1">tzinfo=UTC)</span>
                  <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)]</span>

    <span class="s2"># Same Timezone</span>
    <span class="s1">plt.figure(figsize=(</span><span class="s4">20</span><span class="s0">, </span><span class="s4">12</span><span class="s1">))</span>
    <span class="s1">plt.subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">plt.plot_date(time_index</span><span class="s0">, </span><span class="s1">time_index</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">'UTC'</span><span class="s0">, </span><span class="s1">ydate=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s2"># Different Timezone</span>
    <span class="s1">plt.subplot(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">plt.plot_date(time_index</span><span class="s0">, </span><span class="s1">time_index</span><span class="s0">, </span><span class="s1">tz=</span><span class="s3">'US/Eastern'</span><span class="s0">, </span><span class="s1">ydate=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'axisbelow.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axisbelow():</span>
    <span class="s2"># Test 'line' setting added in 6287.</span>
    <span class="s2"># Show only grids, not frame or ticks, to make this test</span>
    <span class="s2"># independent of future change to drawing order of those elements.</span>
    <span class="s1">axs = plt.figure().subplots(ncols=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">settings = (</span><span class="s0">False, </span><span class="s3">'line'</span><span class="s0">, True</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">setting </span><span class="s0">in </span><span class="s1">zip(axs</span><span class="s0">, </span><span class="s1">settings):</span>
        <span class="s1">ax.plot((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">10</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'m'</span><span class="s1">)</span>
        <span class="s1">circ = mpatches.Circle((</span><span class="s4">3</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=</span><span class="s3">'r'</span><span class="s1">)</span>
        <span class="s1">ax.add_patch(circ)</span>
        <span class="s1">ax.grid(color=</span><span class="s3">'c'</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s3">'-'</span><span class="s0">, </span><span class="s1">linewidth=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">ax.tick_params(top=</span><span class="s0">False, </span><span class="s1">bottom=</span><span class="s0">False,</span>
                       <span class="s1">left=</span><span class="s0">False, </span><span class="s1">right=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">ax.spines[:].set_visible(</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">ax.set_axisbelow(setting)</span>
        <span class="s0">assert </span><span class="s1">ax.get_axisbelow() == setting</span>


<span class="s0">def </span><span class="s1">test_titletwiny():</span>
    <span class="s1">plt.style.use(</span><span class="s3">'mpl20'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s4">72</span><span class="s1">)</span>
    <span class="s1">ax2 = ax.twiny()</span>
    <span class="s1">xlabel2 = ax2.set_xlabel(</span><span class="s3">'Xlabel2'</span><span class="s1">)</span>
    <span class="s1">title = ax.set_title(</span><span class="s3">'Title'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">renderer = fig.canvas.get_renderer()</span>
    <span class="s2"># ------- Test that title is put above Xlabel2 (Xlabel2 at top) ----------</span>
    <span class="s1">bbox_y0_title = title.get_window_extent(renderer).y0  </span><span class="s2"># bottom of title</span>
    <span class="s1">bbox_y1_xlabel2 = xlabel2.get_window_extent(renderer).y1  </span><span class="s2"># top of xlabel2</span>
    <span class="s1">y_diff = bbox_y0_title - bbox_y1_xlabel2</span>
    <span class="s0">assert </span><span class="s1">np.isclose(y_diff</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_titlesetpos():</span>
    <span class="s2"># Test that title stays put if we set it manually</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.subplots_adjust(top=</span><span class="s4">0.8</span><span class="s1">)</span>
    <span class="s1">ax2 = ax.twiny()</span>
    <span class="s1">ax.set_xlabel(</span><span class="s3">'Xlabel'</span><span class="s1">)</span>
    <span class="s1">ax2.set_xlabel(</span><span class="s3">'Xlabel2'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'Title'</span><span class="s1">)</span>
    <span class="s1">pos = (</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.11</span><span class="s1">)</span>
    <span class="s1">ax.title.set_position(pos)</span>
    <span class="s1">renderer = fig.canvas.get_renderer()</span>
    <span class="s1">ax._update_title_position(renderer)</span>
    <span class="s0">assert </span><span class="s1">ax.title.get_position() == pos</span>


<span class="s0">def </span><span class="s1">test_title_xticks_top():</span>
    <span class="s2"># Test that title moves if xticks on top of axes.</span>
    <span class="s1">mpl.rcParams[</span><span class="s3">'axes.titley'</span><span class="s1">] = </span><span class="s0">None</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.xaxis.set_ticks_position(</span><span class="s3">'top'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'xlabel top'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.title.get_position()[</span><span class="s4">1</span><span class="s1">] &gt; </span><span class="s4">1.04</span>


<span class="s0">def </span><span class="s1">test_title_xticks_top_both():</span>
    <span class="s2"># Test that title moves if xticks on top of axes.</span>
    <span class="s1">mpl.rcParams[</span><span class="s3">'axes.titley'</span><span class="s1">] = </span><span class="s0">None</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.tick_params(axis=</span><span class="s3">&quot;x&quot;</span><span class="s0">,</span>
                   <span class="s1">bottom=</span><span class="s0">True, </span><span class="s1">top=</span><span class="s0">True, </span><span class="s1">labelbottom=</span><span class="s0">True, </span><span class="s1">labeltop=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.set_title(</span><span class="s3">'xlabel top'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.title.get_position()[</span><span class="s4">1</span><span class="s1">] &gt; </span><span class="s4">1.04</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">'left, center'</span><span class="s0">, </span><span class="s1">[</span>
        <span class="s1">(</span><span class="s3">'left'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">''</span><span class="s0">, </span><span class="s3">'center'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s3">'left'</span><span class="s0">, </span><span class="s3">'center'</span><span class="s1">)</span>
    <span class="s1">]</span><span class="s0">, </span><span class="s1">ids=[</span>
        <span class="s3">'left title moved'</span><span class="s0">,</span>
        <span class="s3">'center title kept'</span><span class="s0">,</span>
        <span class="s3">'both titles aligned'</span>
    <span class="s1">]</span>
<span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_title_above_offset(left</span><span class="s0">, </span><span class="s1">center):</span>
    <span class="s2"># Test that title moves if overlaps with yaxis offset text.</span>
    <span class="s1">mpl.rcParams[</span><span class="s3">'axes.titley'</span><span class="s1">] = </span><span class="s0">None</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_ylim(</span><span class="s4">1e11</span><span class="s1">)</span>
    <span class="s1">ax.set_title(left</span><span class="s0">, </span><span class="s1">loc=</span><span class="s3">'left'</span><span class="s1">)</span>
    <span class="s1">ax.set_title(center)</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">if </span><span class="s1">left </span><span class="s0">and not </span><span class="s1">center:</span>
        <span class="s0">assert </span><span class="s1">ax._left_title.get_position()[</span><span class="s4">1</span><span class="s1">] &gt; </span><span class="s4">1.0</span>
    <span class="s0">elif not </span><span class="s1">left </span><span class="s0">and </span><span class="s1">center:</span>
        <span class="s0">assert </span><span class="s1">ax.title.get_position()[</span><span class="s4">1</span><span class="s1">] == </span><span class="s4">1.0</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">yleft = ax._left_title.get_position()[</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s1">ycenter = ax.title.get_position()[</span><span class="s4">1</span><span class="s1">]</span>
        <span class="s0">assert </span><span class="s1">yleft &gt; </span><span class="s4">1.0</span>
        <span class="s0">assert </span><span class="s1">ycenter == yleft</span>


<span class="s0">def </span><span class="s1">test_title_no_move_off_page():</span>
    <span class="s2"># If an Axes is off the figure (ie. if it is cropped during a save)</span>
    <span class="s2"># make sure that the automatic title repositioning does not get done.</span>
    <span class="s1">mpl.rcParams[</span><span class="s3">'axes.titley'</span><span class="s1">] = </span><span class="s0">None</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_axes([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.8</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">])</span>
    <span class="s1">ax.tick_params(axis=</span><span class="s3">&quot;x&quot;</span><span class="s0">,</span>
                   <span class="s1">bottom=</span><span class="s0">True, </span><span class="s1">top=</span><span class="s0">True, </span><span class="s1">labelbottom=</span><span class="s0">True, </span><span class="s1">labeltop=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">tt = ax.set_title(</span><span class="s3">'Boo'</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">tt.get_position()[</span><span class="s4">1</span><span class="s1">] == </span><span class="s4">1.0</span>


<span class="s0">def </span><span class="s1">test_offset_label_color():</span>
    <span class="s2"># Tests issue 6440</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s4">1.01e9</span><span class="s0">, </span><span class="s4">1.02e9</span><span class="s0">, </span><span class="s4">1.03e9</span><span class="s1">])</span>
    <span class="s1">ax.yaxis.set_tick_params(labelcolor=</span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.get_offset_text().get_color() == </span><span class="s3">'red'</span>


<span class="s0">def </span><span class="s1">test_offset_text_visible():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s4">1.01e9</span><span class="s0">, </span><span class="s4">1.02e9</span><span class="s0">, </span><span class="s4">1.03e9</span><span class="s1">])</span>
    <span class="s1">ax.yaxis.set_tick_params(label1On=</span><span class="s0">False, </span><span class="s1">label2On=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.get_offset_text().get_visible()</span>
    <span class="s1">ax.yaxis.set_tick_params(label2On=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">ax.yaxis.get_offset_text().get_visible()</span>


<span class="s0">def </span><span class="s1">test_large_offset():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot((</span><span class="s4">1 </span><span class="s1">+ np.array([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.e-12</span><span class="s1">])) * </span><span class="s4">1.e27</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s0">def </span><span class="s1">test_barb_units():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">dates = [datetime.datetime(</span><span class="s4">2017</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">15</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s1">i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">60</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)]</span>
    <span class="s1">y = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s1">len(dates))</span>
    <span class="s1">u = v = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">50</span><span class="s0">, </span><span class="s1">len(dates))</span>
    <span class="s1">ax.barbs(dates</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">u</span><span class="s0">, </span><span class="s1">v)</span>


<span class="s0">def </span><span class="s1">test_quiver_units():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">dates = [datetime.datetime(</span><span class="s4">2017</span><span class="s0">, </span><span class="s4">7</span><span class="s0">, </span><span class="s4">15</span><span class="s0">, </span><span class="s4">18</span><span class="s0">, </span><span class="s1">i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">60</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)]</span>
    <span class="s1">y = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s1">len(dates))</span>
    <span class="s1">u = v = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">50</span><span class="s0">, </span><span class="s1">len(dates))</span>
    <span class="s1">ax.quiver(dates</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">u</span><span class="s0">, </span><span class="s1">v)</span>


<span class="s0">def </span><span class="s1">test_bar_color_cycle():</span>
    <span class="s1">to_rgb = mcolors.to_rgb</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">5</span><span class="s1">):</span>
        <span class="s1">ln</span><span class="s0">, </span><span class="s1">= ax.plot(range(</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">brs = ax.bar(range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s0">for </span><span class="s1">br </span><span class="s0">in </span><span class="s1">brs:</span>
            <span class="s0">assert </span><span class="s1">to_rgb(ln.get_color()) == to_rgb(br.get_facecolor())</span>


<span class="s0">def </span><span class="s1">test_tick_param_label_rotation():</span>
    <span class="s1">fix</span><span class="s0">, </span><span class="s1">(ax</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax2.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax.xaxis.set_tick_params(which=</span><span class="s3">'both'</span><span class="s0">, </span><span class="s1">rotation=</span><span class="s4">75</span><span class="s1">)</span>
    <span class="s1">ax.yaxis.set_tick_params(which=</span><span class="s3">'both'</span><span class="s0">, </span><span class="s1">rotation=</span><span class="s4">90</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax.get_xticklabels(which=</span><span class="s3">'both'</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">text.get_rotation() == </span><span class="s4">75</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax.get_yticklabels(which=</span><span class="s3">'both'</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">text.get_rotation() == </span><span class="s4">90</span>

    <span class="s1">ax2.tick_params(axis=</span><span class="s3">'x'</span><span class="s0">, </span><span class="s1">labelrotation=</span><span class="s4">53</span><span class="s1">)</span>
    <span class="s1">ax2.tick_params(axis=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">rotation=</span><span class="s4">35</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax2.get_xticklabels(which=</span><span class="s3">'major'</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">text.get_rotation() == </span><span class="s4">53</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax2.get_yticklabels(which=</span><span class="s3">'major'</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">text.get_rotation() == </span><span class="s4">35</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_fillbetween_cycle():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">):</span>
        <span class="s1">cc = ax.fill_between(range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">target = mcolors.to_rgba(</span><span class="s3">'C{}'</span><span class="s1">.format(j))</span>
        <span class="s0">assert </span><span class="s1">tuple(cc.get_facecolors().squeeze()) == tuple(target)</span>

    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">3</span><span class="s0">, </span><span class="s4">6</span><span class="s1">):</span>
        <span class="s1">cc = ax.fill_betweenx(range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">))</span>
        <span class="s1">target = mcolors.to_rgba(</span><span class="s3">'C{}'</span><span class="s1">.format(j))</span>
        <span class="s0">assert </span><span class="s1">tuple(cc.get_facecolors().squeeze()) == tuple(target)</span>

    <span class="s1">target = mcolors.to_rgba(</span><span class="s3">'k'</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">al </span><span class="s0">in </span><span class="s1">[</span><span class="s3">'facecolor'</span><span class="s0">, </span><span class="s3">'facecolors'</span><span class="s0">, </span><span class="s3">'color'</span><span class="s1">]:</span>
        <span class="s1">cc = ax.fill_between(range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">**{al: </span><span class="s3">'k'</span><span class="s1">})</span>
        <span class="s0">assert </span><span class="s1">tuple(cc.get_facecolors().squeeze()) == tuple(target)</span>

    <span class="s1">edge_target = mcolors.to_rgba(</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">j</span><span class="s0">, </span><span class="s1">el </span><span class="s0">in </span><span class="s1">enumerate([</span><span class="s3">'edgecolor'</span><span class="s0">, </span><span class="s3">'edgecolors'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">start=</span><span class="s4">6</span><span class="s1">):</span>
        <span class="s1">cc = ax.fill_between(range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">**{el: </span><span class="s3">'k'</span><span class="s1">})</span>
        <span class="s1">face_target = mcolors.to_rgba(</span><span class="s3">'C{}'</span><span class="s1">.format(j))</span>
        <span class="s0">assert </span><span class="s1">tuple(cc.get_facecolors().squeeze()) == tuple(face_target)</span>
        <span class="s0">assert </span><span class="s1">tuple(cc.get_edgecolors().squeeze()) == tuple(edge_target)</span>


<span class="s0">def </span><span class="s1">test_log_margins():</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'axes.autolimit_mode'</span><span class="s1">] = </span><span class="s3">'data'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">margin = </span><span class="s4">0.05</span>
    <span class="s1">ax.set_xmargin(margin)</span>
    <span class="s1">ax.semilogx([</span><span class="s4">10</span><span class="s0">, </span><span class="s4">100</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">10</span><span class="s0">, </span><span class="s4">100</span><span class="s1">])</span>
    <span class="s1">xlim0</span><span class="s0">, </span><span class="s1">xlim1 = ax.get_xlim()</span>
    <span class="s1">transform = ax.xaxis.get_transform()</span>
    <span class="s1">xlim0t</span><span class="s0">, </span><span class="s1">xlim1t = transform.transform([xlim0</span><span class="s0">, </span><span class="s1">xlim1])</span>
    <span class="s1">x0t</span><span class="s0">, </span><span class="s1">x1t = transform.transform([</span><span class="s4">10</span><span class="s0">, </span><span class="s4">100</span><span class="s1">])</span>
    <span class="s1">delta = (x1t - x0t) * margin</span>
    <span class="s1">assert_allclose([xlim0t + delta</span><span class="s0">, </span><span class="s1">xlim1t - delta]</span><span class="s0">, </span><span class="s1">[x0t</span><span class="s0">, </span><span class="s1">x1t])</span>


<span class="s0">def </span><span class="s1">test_color_length_mismatch():</span>
    <span class="s1">N = </span><span class="s4">5</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.arange(N)</span><span class="s0">, </span><span class="s1">np.arange(N)</span>
    <span class="s1">colors = np.arange(N+</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c=colors)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(match=</span><span class="s3">&quot;argument looks like a single numeric RGB&quot;</span><span class="s1">):</span>
        <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c=(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">))</span>
    <span class="s1">ax.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c=[(</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)] * N)</span>


<span class="s0">def </span><span class="s1">test_eventplot_legend():</span>
    <span class="s1">plt.eventplot([</span><span class="s4">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'Label'</span><span class="s1">)</span>
    <span class="s1">plt.legend()</span>


<span class="s0">def </span><span class="s1">test_bar_broadcast_args():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2"># Check that a bar chart with a single height for all bars works.</span>
    <span class="s1">ax.bar(range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s2"># Check that a horizontal chart with one width works.</span>
    <span class="s1">ax.barh(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">left=range(</span><span class="s4">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">height=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s2"># Check that edgecolor gets broadcast.</span>
    <span class="s1">rect1</span><span class="s0">, </span><span class="s1">rect2 = ax.bar([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">edgecolor=(</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.2</span><span class="s0">, </span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.4</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">rect1.get_edgecolor() == rect2.get_edgecolor() == (</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.2</span><span class="s0">, </span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.4</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_invalid_axis_limits():</span>
    <span class="s1">plt.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.xlim(np.nan)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.xlim(np.inf)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.ylim(np.nan)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.ylim(np.inf)</span>


<span class="s2"># Test all 4 combinations of logs/symlogs for minorticks_on()</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'xscale'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'symlog'</span><span class="s0">, </span><span class="s3">'log'</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'yscale'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'symlog'</span><span class="s0">, </span><span class="s3">'log'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_minorticks_on(xscale</span><span class="s0">, </span><span class="s1">yscale):</span>
    <span class="s1">ax = plt.subplot()</span>
    <span class="s1">ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">ax.set_xscale(xscale)</span>
    <span class="s1">ax.set_yscale(yscale)</span>
    <span class="s1">ax.minorticks_on()</span>


<span class="s0">def </span><span class="s1">test_twinx_knows_limits():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.axvspan(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">xtwin = ax.twinx()</span>
    <span class="s1">xtwin.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s2"># control axis</span>
    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots()</span>

    <span class="s1">ax2.axvspan(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax2.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>

    <span class="s1">assert_array_equal(xtwin.viewLim.intervalx</span><span class="s0">, </span><span class="s1">ax2.viewLim.intervalx)</span>


<span class="s0">def </span><span class="s1">test_zero_linewidth():</span>
    <span class="s2"># Check that setting a zero linewidth doesn't error</span>
    <span class="s1">plt.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ls=</span><span class="s3">'--'</span><span class="s0">, </span><span class="s1">lw=</span><span class="s4">0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_empty_errorbar_legend():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.errorbar([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">xerr=[]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'empty y'</span><span class="s1">)</span>
    <span class="s1">ax.errorbar([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">yerr=[]</span><span class="s0">, </span><span class="s1">label=</span><span class="s3">'empty x'</span><span class="s1">)</span>
    <span class="s1">ax.legend()</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_plot_decimal(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x0 = np.arange(-</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">)</span>
    <span class="s1">y0 = [</span><span class="s4">5.2 </span><span class="s1">* x ** </span><span class="s4">3 </span><span class="s1">- </span><span class="s4">2.1 </span><span class="s1">* x ** </span><span class="s4">2 </span><span class="s1">+ </span><span class="s4">7.34 </span><span class="s1">* x + </span><span class="s4">4.5 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">x0]</span>
    <span class="s1">x = [Decimal(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">x0]</span>
    <span class="s1">y = [Decimal(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">y0]</span>
    <span class="s2"># Test image - line plot with Decimal input</span>
    <span class="s1">fig_test.subplots().plot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s2"># Reference image</span>
    <span class="s1">fig_ref.subplots().plot(x0</span><span class="s0">, </span><span class="s1">y0)</span>


<span class="s2"># pdf and svg tests fail using travis' old versions of gs and inkscape.</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_markerfacecolor_none_alpha(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">fig_test.subplots().plot(</span><span class="s4">0</span><span class="s0">, </span><span class="s3">&quot;o&quot;</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">&quot;none&quot;</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">.5</span><span class="s1">)</span>
    <span class="s1">fig_ref.subplots().plot(</span><span class="s4">0</span><span class="s0">, </span><span class="s3">&quot;o&quot;</span><span class="s0">, </span><span class="s1">mfc=</span><span class="s3">&quot;w&quot;</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s4">.5</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_tick_padding_tightbbox():</span>
    <span class="s5">&quot;&quot;&quot;Test that tick padding gets turned off if axis is off&quot;&quot;&quot;</span>
    <span class="s1">plt.rcParams[</span><span class="s3">&quot;xtick.direction&quot;</span><span class="s1">] = </span><span class="s3">&quot;out&quot;</span>
    <span class="s1">plt.rcParams[</span><span class="s3">&quot;ytick.direction&quot;</span><span class="s1">] = </span><span class="s3">&quot;out&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">bb = ax.get_tightbbox(fig.canvas.get_renderer())</span>
    <span class="s1">ax.axis(</span><span class="s3">'off'</span><span class="s1">)</span>
    <span class="s1">bb2 = ax.get_tightbbox(fig.canvas.get_renderer())</span>
    <span class="s0">assert </span><span class="s1">bb.x0 &lt; bb2.x0</span>
    <span class="s0">assert </span><span class="s1">bb.y0 &lt; bb2.y0</span>


<span class="s0">def </span><span class="s1">test_inset():</span>
    <span class="s5">&quot;&quot;&quot; 
    Ensure that inset_ax argument is indeed optional 
    &quot;&quot;&quot;</span>
    <span class="s1">dx</span><span class="s0">, </span><span class="s1">dy = </span><span class="s4">0.05</span><span class="s0">, </span><span class="s4">0.05</span>
    <span class="s2"># generate 2 2d grids for the x &amp; y bounds</span>
    <span class="s1">y</span><span class="s0">, </span><span class="s1">x = np.mgrid[slice(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5 </span><span class="s1">+ dy</span><span class="s0">, </span><span class="s1">dy)</span><span class="s0">,</span>
                    <span class="s1">slice(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5 </span><span class="s1">+ dx</span><span class="s0">, </span><span class="s1">dx)]</span>
    <span class="s1">z = np.sin(x) ** </span><span class="s4">10 </span><span class="s1">+ np.cos(</span><span class="s4">10 </span><span class="s1">+ y * x) * np.cos(x)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax.set_aspect(</span><span class="s4">1.</span><span class="s1">)</span>
    <span class="s1">ax.apply_aspect()</span>
    <span class="s2"># we need to apply_aspect to make the drawing below work.</span>

    <span class="s1">xlim = [</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">2.15</span><span class="s1">]</span>
    <span class="s1">ylim = [</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]</span>

    <span class="s1">rect = [xlim[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ylim[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xlim[</span><span class="s4">1</span><span class="s1">] - xlim[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ylim[</span><span class="s4">1</span><span class="s1">] - ylim[</span><span class="s4">0</span><span class="s1">]]</span>

    <span class="s1">rec</span><span class="s0">, </span><span class="s1">connectors = ax.indicate_inset(bounds=rect)</span>
    <span class="s0">assert </span><span class="s1">connectors </span><span class="s0">is None</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">xx = np.array([[</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">2.</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s4">2.15</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]])</span>
    <span class="s0">assert </span><span class="s1">np.all(rec.get_bbox().get_points() == xx)</span>


<span class="s0">def </span><span class="s1">test_zoom_inset():</span>
    <span class="s1">dx</span><span class="s0">, </span><span class="s1">dy = </span><span class="s4">0.05</span><span class="s0">, </span><span class="s4">0.05</span>
    <span class="s2"># generate 2 2d grids for the x &amp; y bounds</span>
    <span class="s1">y</span><span class="s0">, </span><span class="s1">x = np.mgrid[slice(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5 </span><span class="s1">+ dy</span><span class="s0">, </span><span class="s1">dy)</span><span class="s0">,</span>
                    <span class="s1">slice(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">5 </span><span class="s1">+ dx</span><span class="s0">, </span><span class="s1">dx)]</span>
    <span class="s1">z = np.sin(x)**</span><span class="s4">10 </span><span class="s1">+ np.cos(</span><span class="s4">10 </span><span class="s1">+ y*x) * np.cos(x)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">ax.set_aspect(</span><span class="s4">1.</span><span class="s1">)</span>
    <span class="s1">ax.apply_aspect()</span>
    <span class="s2"># we need to apply_aspect to make the drawing below work.</span>

    <span class="s2"># Make the inset_axes...  Position axes coordinates...</span>
    <span class="s1">axin1 = ax.inset_axes([</span><span class="s4">0.7</span><span class="s0">, </span><span class="s4">0.7</span><span class="s0">, </span><span class="s4">0.35</span><span class="s0">, </span><span class="s4">0.35</span><span class="s1">])</span>
    <span class="s2"># redraw the data in the inset axes...</span>
    <span class="s1">axin1.pcolormesh(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z[:-</span><span class="s4">1</span><span class="s0">, </span><span class="s1">:-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">axin1.set_xlim([</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">2.15</span><span class="s1">])</span>
    <span class="s1">axin1.set_ylim([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">])</span>
    <span class="s1">axin1.set_aspect(ax.get_aspect())</span>

    <span class="s1">rec</span><span class="s0">, </span><span class="s1">connectors = ax.indicate_inset_zoom(axin1)</span>
    <span class="s0">assert </span><span class="s1">len(connectors) == </span><span class="s4">4</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">xx = np.array([[</span><span class="s4">1.5</span><span class="s0">,  </span><span class="s4">2.</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s4">2.15</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">]])</span>
    <span class="s0">assert </span><span class="s1">np.all(rec.get_bbox().get_points() == xx)</span>
    <span class="s1">xx = np.array([[</span><span class="s4">0.6325</span><span class="s0">, </span><span class="s4">0.692308</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s4">0.8425</span><span class="s0">, </span><span class="s4">0.907692</span><span class="s1">]])</span>
    <span class="s1">np.testing.assert_allclose(</span>
        <span class="s1">axin1.get_position().get_points()</span><span class="s0">, </span><span class="s1">xx</span><span class="s0">, </span><span class="s1">rtol=</span><span class="s4">1e-4</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'inset_polar.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_inset_polar():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">axins = ax.inset_axes([</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.45</span><span class="s1">]</span><span class="s0">, </span><span class="s1">polar=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(axins</span><span class="s0">, </span><span class="s1">PolarAxes)</span>

    <span class="s1">r = np.arange(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">)</span>
    <span class="s1">theta = </span><span class="s4">2 </span><span class="s1">* np.pi * r</span>

    <span class="s1">ax.plot(theta</span><span class="s0">, </span><span class="s1">r)</span>
    <span class="s1">axins.plot(theta</span><span class="s0">, </span><span class="s1">r)</span>


<span class="s0">def </span><span class="s1">test_inset_projection():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">axins = ax.inset_axes([</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">projection=</span><span class="s3">&quot;hammer&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(axins</span><span class="s0">, </span><span class="s1">HammerAxes)</span>


<span class="s0">def </span><span class="s1">test_inset_subclass():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">axins = ax.inset_axes([</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">axes_class=AA.Axes)</span>
    <span class="s0">assert </span><span class="s1">isinstance(axins</span><span class="s0">, </span><span class="s1">AA.Axes)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'x_inverted'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'y_inverted'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_indicate_inset_inverted(x_inverted</span><span class="s0">, </span><span class="s1">y_inverted):</span>
    <span class="s5">&quot;&quot;&quot; 
    Test that the inset lines are correctly located with inverted data axes. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">x = np.arange(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">ax1.plot(x</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s3">'o'</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">x_inverted:</span>
        <span class="s1">ax1.invert_xaxis()</span>
    <span class="s0">if </span><span class="s1">y_inverted:</span>
        <span class="s1">ax1.invert_yaxis()</span>

    <span class="s1">rect</span><span class="s0">, </span><span class="s1">bounds = ax1.indicate_inset([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ax2)</span>
    <span class="s1">lower_left</span><span class="s0">, </span><span class="s1">upper_left</span><span class="s0">, </span><span class="s1">lower_right</span><span class="s0">, </span><span class="s1">upper_right = bounds</span>

    <span class="s1">sign_x = -</span><span class="s4">1 </span><span class="s0">if </span><span class="s1">x_inverted </span><span class="s0">else </span><span class="s4">1</span>
    <span class="s1">sign_y = -</span><span class="s4">1 </span><span class="s0">if </span><span class="s1">y_inverted </span><span class="s0">else </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">sign_x * (lower_right.xy2[</span><span class="s4">0</span><span class="s1">] - lower_left.xy2[</span><span class="s4">0</span><span class="s1">]) &gt; </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">sign_x * (upper_right.xy2[</span><span class="s4">0</span><span class="s1">] - upper_left.xy2[</span><span class="s4">0</span><span class="s1">]) &gt; </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">sign_y * (upper_left.xy2[</span><span class="s4">1</span><span class="s1">] - lower_left.xy2[</span><span class="s4">1</span><span class="s1">]) &gt; </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">sign_y * (upper_right.xy2[</span><span class="s4">1</span><span class="s1">] - lower_right.xy2[</span><span class="s4">1</span><span class="s1">]) &gt; </span><span class="s4">0</span>


<span class="s0">def </span><span class="s1">test_set_position():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_aspect(</span><span class="s4">3.</span><span class="s1">)</span>
    <span class="s1">ax.set_position([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.4</span><span class="s0">, </span><span class="s4">0.4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">which=</span><span class="s3">'both'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">np.allclose(ax.get_position().width</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)</span>
    <span class="s1">ax.set_aspect(</span><span class="s4">2.</span><span class="s1">)</span>
    <span class="s1">ax.set_position([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.4</span><span class="s0">, </span><span class="s4">0.4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">which=</span><span class="s3">'original'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">np.allclose(ax.get_position().width</span><span class="s0">, </span><span class="s4">0.15</span><span class="s1">)</span>
    <span class="s1">ax.set_aspect(</span><span class="s4">3.</span><span class="s1">)</span>
    <span class="s1">ax.set_position([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.4</span><span class="s0">, </span><span class="s4">0.4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">which=</span><span class="s3">'active'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">np.allclose(ax.get_position().width</span><span class="s0">, </span><span class="s4">0.1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_spines_properbbox_after_zoom():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">bb = ax.spines.bottom.get_window_extent(fig.canvas.get_renderer())</span>
    <span class="s2"># this is what zoom calls:</span>
    <span class="s1">ax._set_view_from_bbox((</span><span class="s4">320</span><span class="s0">, </span><span class="s4">320</span><span class="s0">, </span><span class="s4">500</span><span class="s0">, </span><span class="s4">500</span><span class="s1">)</span><span class="s0">, </span><span class="s3">'in'</span><span class="s0">,</span>
                           <span class="s0">None, False, False</span><span class="s1">)</span>
    <span class="s1">bb2 = ax.spines.bottom.get_window_extent(fig.canvas.get_renderer())</span>
    <span class="s1">np.testing.assert_allclose(bb.get_points()</span><span class="s0">, </span><span class="s1">bb2.get_points()</span><span class="s0">, </span><span class="s1">rtol=</span><span class="s4">1e-6</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_limits_after_scroll_zoom():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2">#</span>
    <span class="s1">xlim = (-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">ylim = (-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(xlim)</span>
    <span class="s1">ax.set_ylim(ymin=ylim[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ymax=ylim[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s2"># This is what scroll zoom calls:</span>
    <span class="s2"># Zoom with factor 1, small numerical change</span>
    <span class="s1">ax._set_view_from_bbox((</span><span class="s4">200</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">1.</span><span class="s1">))</span>
    <span class="s1">np.testing.assert_allclose(xlim</span><span class="s0">, </span><span class="s1">ax.get_xlim()</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-16</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(ylim</span><span class="s0">, </span><span class="s1">ax.get_ylim()</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-16</span><span class="s1">)</span>

    <span class="s2"># Zoom in</span>
    <span class="s1">ax._set_view_from_bbox((</span><span class="s4">200</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">2.</span><span class="s1">))</span>
    <span class="s2"># Hard-coded values</span>
    <span class="s1">new_xlim = (-</span><span class="s4">0.3790322580645161</span><span class="s0">, </span><span class="s4">0.12096774193548387</span><span class="s1">)</span>
    <span class="s1">new_ylim = (-</span><span class="s4">0.40625</span><span class="s0">, </span><span class="s4">1.09375</span><span class="s1">)</span>

    <span class="s1">res_xlim = ax.get_xlim()</span>
    <span class="s1">res_ylim = ax.get_ylim()</span>
    <span class="s1">np.testing.assert_allclose(res_xlim[</span><span class="s4">1</span><span class="s1">] - res_xlim[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(res_ylim[</span><span class="s4">1</span><span class="s1">] - res_ylim[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(new_xlim</span><span class="s0">, </span><span class="s1">res_xlim</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-16</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(new_ylim</span><span class="s0">, </span><span class="s1">res_ylim)</span>

    <span class="s2"># Zoom out, should be same as before, except for numerical issues</span>
    <span class="s1">ax._set_view_from_bbox((</span><span class="s4">200</span><span class="s0">, </span><span class="s4">200</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">))</span>
    <span class="s1">res_xlim = ax.get_xlim()</span>
    <span class="s1">res_ylim = ax.get_ylim()</span>
    <span class="s1">np.testing.assert_allclose(res_xlim[</span><span class="s4">1</span><span class="s1">] - res_xlim[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(res_ylim[</span><span class="s4">1</span><span class="s1">] - res_ylim[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(xlim</span><span class="s0">, </span><span class="s1">res_xlim</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-16</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(ylim</span><span class="s0">, </span><span class="s1">res_ylim</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-16</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_gettightbbox_ignore_nan():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">remove_ticks_and_titles(fig)</span>
    <span class="s1">ax.text(np.NaN</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s3">'Boo'</span><span class="s1">)</span>
    <span class="s1">renderer = fig.canvas.get_renderer()</span>
    <span class="s1">np.testing.assert_allclose(ax.get_tightbbox(renderer).width</span><span class="s0">, </span><span class="s4">496</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_scatter_series_non_zero_index(pd):</span>
    <span class="s2"># create non-zero index</span>
    <span class="s1">ids = range(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">18</span><span class="s1">)</span>
    <span class="s1">x = pd.Series(np.random.uniform(size=</span><span class="s4">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=ids)</span>
    <span class="s1">y = pd.Series(np.random.uniform(size=</span><span class="s4">8</span><span class="s1">)</span><span class="s0">, </span><span class="s1">index=ids)</span>
    <span class="s1">c = pd.Series([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">index=ids)</span>
    <span class="s1">plt.scatter(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">c)</span>


<span class="s0">def </span><span class="s1">test_scatter_empty_data():</span>
    <span class="s2"># making sure this does not raise an exception</span>
    <span class="s1">plt.scatter([]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">plt.scatter([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">s=[]</span><span class="s0">, </span><span class="s1">c=[])</span>


<span class="s1">@image_comparison([</span><span class="s3">'annotate_across_transforms.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_annotate_across_transforms():</span>
    <span class="s1">x = np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">200</span><span class="s1">)</span>
    <span class="s1">y = np.exp(-x) * np.sin(x)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s4">3.39</span><span class="s0">, </span><span class="s4">3</span><span class="s1">))</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">axins = ax.inset_axes([</span><span class="s4">0.4</span><span class="s0">, </span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.3</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">])</span>
    <span class="s1">axins.set_aspect(</span><span class="s4">0.2</span><span class="s1">)</span>
    <span class="s1">axins.xaxis.set_visible(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">axins.yaxis.set_visible(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.annotate(</span><span class="s3">&quot;&quot;</span><span class="s0">, </span><span class="s1">xy=(x[</span><span class="s4">150</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y[</span><span class="s4">150</span><span class="s1">])</span><span class="s0">, </span><span class="s1">xycoords=ax.transData</span><span class="s0">,</span>
                <span class="s1">xytext=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">textcoords=axins.transAxes</span><span class="s0">,</span>
                <span class="s1">arrowprops=dict(arrowstyle=</span><span class="s3">&quot;-&gt;&quot;</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'secondary_xy.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_secondary_xy():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">invert(x):</span>
        <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s3">'ignore'</span><span class="s1">):</span>
            <span class="s0">return </span><span class="s4">1 </span><span class="s1">/ x</span>

    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs):</span>
        <span class="s1">ax.plot(np.arange(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">))</span>
        <span class="s0">if </span><span class="s1">nn == </span><span class="s4">0</span><span class="s1">:</span>
            <span class="s1">secax = ax.secondary_xaxis</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">secax = ax.secondary_yaxis</span>

        <span class="s1">secax(</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">functions=(invert</span><span class="s0">, </span><span class="s1">invert))</span>
        <span class="s1">secax(</span><span class="s4">0.4</span><span class="s0">, </span><span class="s1">functions=(</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s4">2 </span><span class="s1">* x</span><span class="s0">, lambda </span><span class="s1">x: x / </span><span class="s4">2</span><span class="s1">))</span>
        <span class="s1">secax(</span><span class="s4">0.6</span><span class="s0">, </span><span class="s1">functions=(</span><span class="s0">lambda </span><span class="s1">x: x**</span><span class="s4">2</span><span class="s0">, lambda </span><span class="s1">x: x**(</span><span class="s4">1</span><span class="s1">/</span><span class="s4">2</span><span class="s1">)))</span>
        <span class="s1">secax(</span><span class="s4">0.8</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_secondary_fail():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.secondary_xaxis(</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">functions=(</span><span class="s0">lambda </span><span class="s1">x: </span><span class="s4">1 </span><span class="s1">/ x))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.secondary_xaxis(</span><span class="s3">'right'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">ax.secondary_yaxis(</span><span class="s3">'bottom'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_secondary_resize():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">invert(x):</span>
        <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s3">'ignore'</span><span class="s1">):</span>
            <span class="s0">return </span><span class="s4">1 </span><span class="s1">/ x</span>

    <span class="s1">ax.secondary_xaxis(</span><span class="s3">'top'</span><span class="s0">, </span><span class="s1">functions=(invert</span><span class="s0">, </span><span class="s1">invert))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">fig.set_size_inches((</span><span class="s4">7</span><span class="s0">, </span><span class="s4">4</span><span class="s1">))</span>
    <span class="s1">assert_allclose(ax.get_position().extents</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.125</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.9</span><span class="s0">, </span><span class="s4">0.9</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_secondary_minorloc():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">11</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">invert(x):</span>
        <span class="s0">with </span><span class="s1">np.errstate(divide=</span><span class="s3">'ignore'</span><span class="s1">):</span>
            <span class="s0">return </span><span class="s4">1 </span><span class="s1">/ x</span>

    <span class="s1">secax = ax.secondary_xaxis(</span><span class="s3">'top'</span><span class="s0">, </span><span class="s1">functions=(invert</span><span class="s0">, </span><span class="s1">invert))</span>
    <span class="s0">assert </span><span class="s1">isinstance(secax._axis.get_minor_locator()</span><span class="s0">,</span>
                      <span class="s1">mticker.NullLocator)</span>
    <span class="s1">secax.minorticks_on()</span>
    <span class="s0">assert </span><span class="s1">isinstance(secax._axis.get_minor_locator()</span><span class="s0">,</span>
                      <span class="s1">mticker.AutoMinorLocator)</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s1">plt.draw()</span>
    <span class="s0">assert </span><span class="s1">isinstance(secax._axis.get_minor_locator()</span><span class="s0">,</span>
                      <span class="s1">mticker.LogLocator)</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">'linear'</span><span class="s1">)</span>
    <span class="s1">plt.draw()</span>
    <span class="s0">assert </span><span class="s1">isinstance(secax._axis.get_minor_locator()</span><span class="s0">,</span>
                      <span class="s1">mticker.NullLocator)</span>


<span class="s0">def </span><span class="s1">test_secondary_formatter():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">&quot;log&quot;</span><span class="s1">)</span>
    <span class="s1">secax = ax.secondary_xaxis(</span><span class="s3">&quot;top&quot;</span><span class="s1">)</span>
    <span class="s1">secax.xaxis.set_major_formatter(mticker.ScalarFormatter())</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">isinstance(</span>
        <span class="s1">secax.xaxis.get_major_formatter()</span><span class="s0">, </span><span class="s1">mticker.ScalarFormatter)</span>


<span class="s0">def </span><span class="s1">test_secondary_repr():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">secax = ax.secondary_xaxis(</span><span class="s3">&quot;top&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">repr(secax) == </span><span class="s3">'&lt;SecondaryAxis: &gt;'</span>


<span class="s1">@image_comparison([</span><span class="s3">'axis_options.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_axis_options():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axes = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">option </span><span class="s0">in </span><span class="s1">enumerate((</span><span class="s3">'scaled'</span><span class="s0">, </span><span class="s3">'tight'</span><span class="s0">, </span><span class="s3">'image'</span><span class="s1">)):</span>
        <span class="s2"># Draw a line and a circle fitting within the boundaries of the line</span>
        <span class="s2"># The circle should look like a circle for 'scaled' and 'image'</span>
        <span class="s2"># High/narrow aspect ratio</span>
        <span class="s1">axes[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">i].plot((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">3.2</span><span class="s1">))</span>
        <span class="s1">axes[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">i].axis(option)</span>
        <span class="s1">axes[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">i].add_artist(mpatches.Circle((</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">radius=</span><span class="s4">0.5</span><span class="s0">,</span>
                                              <span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'k'</span><span class="s1">))</span>
        <span class="s2"># Low/wide aspect ratio</span>
        <span class="s1">axes[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">i].plot((</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1.75</span><span class="s1">))</span>
        <span class="s1">axes[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">i].axis(option)</span>
        <span class="s1">axes[</span><span class="s4">1</span><span class="s0">, </span><span class="s1">i].add_artist(mpatches.Circle((</span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">1.25</span><span class="s1">)</span><span class="s0">, </span><span class="s1">radius=</span><span class="s4">0.25</span><span class="s0">,</span>
                                              <span class="s1">facecolor=</span><span class="s3">'none'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'k'</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">color_boxes(fig</span><span class="s0">, </span><span class="s1">ax):</span>
    <span class="s5">&quot;&quot;&quot; 
    Helper for the tests below that test the extents of various axes elements 
    &quot;&quot;&quot;</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s1">renderer = fig.canvas.get_renderer()</span>
    <span class="s1">bbaxis = []</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">axx </span><span class="s0">in </span><span class="s1">enumerate([ax.xaxis</span><span class="s0">, </span><span class="s1">ax.yaxis]):</span>
        <span class="s1">bb = axx.get_tightbbox(renderer)</span>
        <span class="s0">if </span><span class="s1">bb:</span>
            <span class="s1">axisr = mpatches.Rectangle(</span>
                <span class="s1">(bb.x0</span><span class="s0">, </span><span class="s1">bb.y0)</span><span class="s0">, </span><span class="s1">width=bb.width</span><span class="s0">, </span><span class="s1">height=bb.height</span><span class="s0">,</span>
                <span class="s1">linewidth=</span><span class="s4">0.7</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">'y'</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;none&quot;</span><span class="s0">, </span><span class="s1">transform=</span><span class="s0">None,</span>
                <span class="s1">zorder=</span><span class="s4">3</span><span class="s1">)</span>
            <span class="s1">fig.add_artist(axisr)</span>
        <span class="s1">bbaxis += [bb]</span>

    <span class="s1">bbspines = []</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">a </span><span class="s0">in </span><span class="s1">enumerate([</span><span class="s3">'bottom'</span><span class="s0">, </span><span class="s3">'top'</span><span class="s0">, </span><span class="s3">'left'</span><span class="s0">, </span><span class="s3">'right'</span><span class="s1">]):</span>
        <span class="s1">bb = ax.spines[a].get_window_extent(renderer)</span>
        <span class="s1">spiner = mpatches.Rectangle(</span>
            <span class="s1">(bb.x0</span><span class="s0">, </span><span class="s1">bb.y0)</span><span class="s0">, </span><span class="s1">width=bb.width</span><span class="s0">, </span><span class="s1">height=bb.height</span><span class="s0">,</span>
            <span class="s1">linewidth=</span><span class="s4">0.7</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">&quot;green&quot;</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;none&quot;</span><span class="s0">, </span><span class="s1">transform=</span><span class="s0">None,</span>
            <span class="s1">zorder=</span><span class="s4">3</span><span class="s1">)</span>
        <span class="s1">fig.add_artist(spiner)</span>
        <span class="s1">bbspines += [bb]</span>

    <span class="s1">bb = ax.get_window_extent()</span>
    <span class="s1">rect2 = mpatches.Rectangle(</span>
        <span class="s1">(bb.x0</span><span class="s0">, </span><span class="s1">bb.y0)</span><span class="s0">, </span><span class="s1">width=bb.width</span><span class="s0">, </span><span class="s1">height=bb.height</span><span class="s0">,</span>
        <span class="s1">linewidth=</span><span class="s4">1.5</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">&quot;magenta&quot;</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;none&quot;</span><span class="s0">, </span><span class="s1">transform=</span><span class="s0">None,</span>
        <span class="s1">zorder=</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">fig.add_artist(rect2)</span>
    <span class="s1">bbax = bb</span>

    <span class="s1">bb2 = ax.get_tightbbox(renderer)</span>
    <span class="s1">rect2 = mpatches.Rectangle(</span>
        <span class="s1">(bb2.x0</span><span class="s0">, </span><span class="s1">bb2.y0)</span><span class="s0">, </span><span class="s1">width=bb2.width</span><span class="s0">, </span><span class="s1">height=bb2.height</span><span class="s0">,</span>
        <span class="s1">linewidth=</span><span class="s4">3</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">&quot;red&quot;</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;none&quot;</span><span class="s0">, </span><span class="s1">transform=</span><span class="s0">None,</span>
        <span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">fig.add_artist(rect2)</span>
    <span class="s1">bbtb = bb2</span>
    <span class="s0">return </span><span class="s1">bbaxis</span><span class="s0">, </span><span class="s1">bbspines</span><span class="s0">, </span><span class="s1">bbax</span><span class="s0">, </span><span class="s1">bbtb</span>


<span class="s0">def </span><span class="s1">test_normal_axes():</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s3">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s4">200</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">))</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">plt.close(fig)</span>
        <span class="s1">bbaxis</span><span class="s0">, </span><span class="s1">bbspines</span><span class="s0">, </span><span class="s1">bbax</span><span class="s0">, </span><span class="s1">bbtb = color_boxes(fig</span><span class="s0">, </span><span class="s1">ax)</span>

    <span class="s2"># test the axis bboxes</span>
    <span class="s1">target = [</span>
        <span class="s1">[</span><span class="s4">123.375</span><span class="s0">, </span><span class="s4">75.88888888888886</span><span class="s0">, </span><span class="s4">983.25</span><span class="s0">, </span><span class="s4">33.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">85.51388888888889</span><span class="s0">, </span><span class="s4">99.99999999999997</span><span class="s0">, </span><span class="s4">53.375</span><span class="s0">, </span><span class="s4">993.0</span><span class="s1">]</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate(bbaxis):</span>
        <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target[nn])</span>
        <span class="s1">assert_array_almost_equal(b.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">target = [</span>
        <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">119.999</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">11.111</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">1080.0</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">119.9999</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">1068.8888</span><span class="s0">, </span><span class="s4">119.9999</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate(bbspines):</span>
        <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target[nn])</span>
        <span class="s1">assert_array_almost_equal(b.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">target = [</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">119.99999999999997</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span>
    <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target)</span>
    <span class="s1">assert_array_almost_equal(bbax.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">target = [</span><span class="s4">85.5138</span><span class="s0">, </span><span class="s4">75.88888</span><span class="s0">, </span><span class="s4">1021.11</span><span class="s0">, </span><span class="s4">1017.11</span><span class="s1">]</span>
    <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target)</span>
    <span class="s1">assert_array_almost_equal(bbtb.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s2"># test that get_position roundtrips to get_window_extent</span>
    <span class="s1">axbb = ax.get_position().transformed(fig.transFigure).bounds</span>
    <span class="s1">assert_array_almost_equal(axbb</span><span class="s0">, </span><span class="s1">ax.get_window_extent().bounds</span><span class="s0">, </span><span class="s1">decimal=</span><span class="s4">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_nodecorator():</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s3">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s4">200</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">))</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">ax.set(xticklabels=[]</span><span class="s0">, </span><span class="s1">yticklabels=[])</span>
        <span class="s1">bbaxis</span><span class="s0">, </span><span class="s1">bbspines</span><span class="s0">, </span><span class="s1">bbax</span><span class="s0">, </span><span class="s1">bbtb = color_boxes(fig</span><span class="s0">, </span><span class="s1">ax)</span>

    <span class="s2"># test the axis bboxes</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate(bbaxis):</span>
        <span class="s0">assert </span><span class="s1">b </span><span class="s0">is None</span>

    <span class="s1">target = [</span>
        <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">119.999</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">11.111</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">1080.0</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">119.9999</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">1068.8888</span><span class="s0">, </span><span class="s4">119.9999</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate(bbspines):</span>
        <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target[nn])</span>
        <span class="s1">assert_allclose(b.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>

    <span class="s1">target = [</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">119.99999999999997</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span>
    <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target)</span>
    <span class="s1">assert_allclose(bbax.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>

    <span class="s1">target = [</span><span class="s4">150.</span><span class="s0">, </span><span class="s4">120.</span><span class="s0">, </span><span class="s4">930.</span><span class="s0">, </span><span class="s4">960.</span><span class="s1">]</span>
    <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target)</span>
    <span class="s1">assert_allclose(bbtb.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_displaced_spine():</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s3">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s4">200</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">))</span>
        <span class="s1">ax.set(xticklabels=[]</span><span class="s0">, </span><span class="s1">yticklabels=[])</span>
        <span class="s1">ax.spines.bottom.set_position((</span><span class="s3">'axes'</span><span class="s0">, </span><span class="s1">-</span><span class="s4">0.1</span><span class="s1">))</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">bbaxis</span><span class="s0">, </span><span class="s1">bbspines</span><span class="s0">, </span><span class="s1">bbax</span><span class="s0">, </span><span class="s1">bbtb = color_boxes(fig</span><span class="s0">, </span><span class="s1">ax)</span>

    <span class="s1">targets = [</span>
        <span class="s1">[</span><span class="s4">150.</span><span class="s0">, </span><span class="s4">24.</span><span class="s0">, </span><span class="s4">930.</span><span class="s0">, </span><span class="s4">11.111111</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">1080.0</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">0.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">119.9999</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">1068.8888</span><span class="s0">, </span><span class="s4">119.9999</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">target</span><span class="s0">, </span><span class="s1">bbspine </span><span class="s0">in </span><span class="s1">zip(targets</span><span class="s0">, </span><span class="s1">bbspines):</span>
        <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target)</span>
        <span class="s1">assert_allclose(bbspine.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>

    <span class="s1">target = [</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">119.99999999999997</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]</span>
    <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target)</span>
    <span class="s1">assert_allclose(bbax.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>

    <span class="s1">target = [</span><span class="s4">150.</span><span class="s0">, </span><span class="s4">24.</span><span class="s0">, </span><span class="s4">930.</span><span class="s0">, </span><span class="s4">1056.</span><span class="s1">]</span>
    <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*target)</span>
    <span class="s1">assert_allclose(bbtb.bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_tickdirs():</span>
    <span class="s5">&quot;&quot;&quot; 
    Switch the tickdirs and make sure the bboxes switch with them 
    &quot;&quot;&quot;</span>
    <span class="s1">targets = [[[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">120.0</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">11.1111</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">120.0</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]]</span><span class="s0">,</span>
               <span class="s1">[[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">108.8889</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">11.111111111111114</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">138.889</span><span class="s0">, </span><span class="s4">120</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]]</span><span class="s0">,</span>
               <span class="s1">[[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">114.44444444444441</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">11.111111111111114</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">144.44444444444446</span><span class="s0">, </span><span class="s4">119.999</span><span class="s0">, </span><span class="s4">11.111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]]]</span>
    <span class="s0">for </span><span class="s1">dnum</span><span class="s0">, </span><span class="s1">dirs </span><span class="s0">in </span><span class="s1">enumerate([</span><span class="s3">'in'</span><span class="s0">, </span><span class="s3">'out'</span><span class="s0">, </span><span class="s3">'inout'</span><span class="s1">]):</span>
        <span class="s0">with </span><span class="s1">rc_context({</span><span class="s3">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
            <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s4">200</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">))</span>
            <span class="s1">ax.tick_params(direction=dirs)</span>
            <span class="s1">fig.canvas.draw()</span>
            <span class="s1">bbaxis</span><span class="s0">, </span><span class="s1">bbspines</span><span class="s0">, </span><span class="s1">bbax</span><span class="s0">, </span><span class="s1">bbtb = color_boxes(fig</span><span class="s0">, </span><span class="s1">ax)</span>
            <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">num </span><span class="s0">in </span><span class="s1">enumerate([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]):</span>
                <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*targets[dnum][nn])</span>
                <span class="s1">assert_allclose(</span>
                    <span class="s1">bbspines[num].bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_minor_accountedfor():</span>
    <span class="s0">with </span><span class="s1">rc_context({</span><span class="s3">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s4">200</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">))</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">ax.tick_params(which=</span><span class="s3">'both'</span><span class="s0">, </span><span class="s1">direction=</span><span class="s3">'out'</span><span class="s1">)</span>

        <span class="s1">bbaxis</span><span class="s0">, </span><span class="s1">bbspines</span><span class="s0">, </span><span class="s1">bbax</span><span class="s0">, </span><span class="s1">bbtb = color_boxes(fig</span><span class="s0">, </span><span class="s1">ax)</span>
        <span class="s1">bbaxis</span><span class="s0">, </span><span class="s1">bbspines</span><span class="s0">, </span><span class="s1">bbax</span><span class="s0">, </span><span class="s1">bbtb = color_boxes(fig</span><span class="s0">, </span><span class="s1">ax)</span>
        <span class="s1">targets = [[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">108.88888888888886</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">11.111111111111114</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s4">138.8889</span><span class="s0">, </span><span class="s4">119.9999</span><span class="s0">, </span><span class="s4">11.1111</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]]</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">2</span><span class="s1">):</span>
            <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*targets[n])</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">bbspines[n * </span><span class="s4">2</span><span class="s1">].bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>

        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(dpi=</span><span class="s4">200</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s4">6</span><span class="s0">, </span><span class="s4">6</span><span class="s1">))</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">ax.tick_params(which=</span><span class="s3">'both'</span><span class="s0">, </span><span class="s1">direction=</span><span class="s3">'out'</span><span class="s1">)</span>
        <span class="s1">ax.minorticks_on()</span>
        <span class="s1">ax.tick_params(axis=</span><span class="s3">'both'</span><span class="s0">, </span><span class="s1">which=</span><span class="s3">'minor'</span><span class="s0">, </span><span class="s1">length=</span><span class="s4">30</span><span class="s1">)</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">bbaxis</span><span class="s0">, </span><span class="s1">bbspines</span><span class="s0">, </span><span class="s1">bbax</span><span class="s0">, </span><span class="s1">bbtb = color_boxes(fig</span><span class="s0">, </span><span class="s1">ax)</span>
        <span class="s1">targets = [[</span><span class="s4">150.0</span><span class="s0">, </span><span class="s4">36.66666666666663</span><span class="s0">, </span><span class="s4">930.0</span><span class="s0">, </span><span class="s4">83.33333333333334</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s4">66.6667</span><span class="s0">, </span><span class="s4">120.0</span><span class="s0">, </span><span class="s4">83.3333</span><span class="s0">, </span><span class="s4">960.0</span><span class="s1">]]</span>

        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">2</span><span class="s1">):</span>
            <span class="s1">targetbb = mtransforms.Bbox.from_bounds(*targets[n])</span>
            <span class="s1">assert_allclose(</span>
                <span class="s1">bbspines[n * </span><span class="s4">2</span><span class="s1">].bounds</span><span class="s0">, </span><span class="s1">targetbb.bounds</span><span class="s0">, </span><span class="s1">atol=</span><span class="s4">1e-2</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_axis_bool_arguments(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># Test if False and &quot;off&quot; give the same</span>
    <span class="s1">fig_test.add_subplot(</span><span class="s4">211</span><span class="s1">).axis(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig_ref.add_subplot(</span><span class="s4">211</span><span class="s1">).axis(</span><span class="s3">&quot;off&quot;</span><span class="s1">)</span>
    <span class="s2"># Test if True after False gives the same as &quot;on&quot;</span>
    <span class="s1">ax = fig_test.add_subplot(</span><span class="s4">212</span><span class="s1">)</span>
    <span class="s1">ax.axis(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax.axis(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig_ref.add_subplot(</span><span class="s4">212</span><span class="s1">).axis(</span><span class="s3">&quot;on&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_axis_extent_arg():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">xmin = </span><span class="s4">5</span>
    <span class="s1">xmax = </span><span class="s4">10</span>
    <span class="s1">ymin = </span><span class="s4">15</span>
    <span class="s1">ymax = </span><span class="s4">20</span>
    <span class="s1">extent = ax.axis([xmin</span><span class="s0">, </span><span class="s1">xmax</span><span class="s0">, </span><span class="s1">ymin</span><span class="s0">, </span><span class="s1">ymax])</span>

    <span class="s2"># test that the docstring is correct</span>
    <span class="s0">assert </span><span class="s1">tuple(extent) == (xmin</span><span class="s0">, </span><span class="s1">xmax</span><span class="s0">, </span><span class="s1">ymin</span><span class="s0">, </span><span class="s1">ymax)</span>

    <span class="s2"># test that limits were set per the docstring</span>
    <span class="s0">assert </span><span class="s1">(xmin</span><span class="s0">, </span><span class="s1">xmax) == ax.get_xlim()</span>
    <span class="s0">assert </span><span class="s1">(ymin</span><span class="s0">, </span><span class="s1">ymax) == ax.get_ylim()</span>


<span class="s0">def </span><span class="s1">test_axis_extent_arg2():</span>
    <span class="s2"># Same as test_axis_extent_arg, but with keyword arguments</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">xmin = </span><span class="s4">5</span>
    <span class="s1">xmax = </span><span class="s4">10</span>
    <span class="s1">ymin = </span><span class="s4">15</span>
    <span class="s1">ymax = </span><span class="s4">20</span>
    <span class="s1">extent = ax.axis(xmin=xmin</span><span class="s0">, </span><span class="s1">xmax=xmax</span><span class="s0">, </span><span class="s1">ymin=ymin</span><span class="s0">, </span><span class="s1">ymax=ymax)</span>

    <span class="s2"># test that the docstring is correct</span>
    <span class="s0">assert </span><span class="s1">tuple(extent) == (xmin</span><span class="s0">, </span><span class="s1">xmax</span><span class="s0">, </span><span class="s1">ymin</span><span class="s0">, </span><span class="s1">ymax)</span>

    <span class="s2"># test that limits were set per the docstring</span>
    <span class="s0">assert </span><span class="s1">(xmin</span><span class="s0">, </span><span class="s1">xmax) == ax.get_xlim()</span>
    <span class="s0">assert </span><span class="s1">(ymin</span><span class="s0">, </span><span class="s1">ymax) == ax.get_ylim()</span>


<span class="s0">def </span><span class="s1">test_hist_auto_bins():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">_ = plt.hist([[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">6</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">bins=</span><span class="s3">'auto'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">bins[</span><span class="s4">0</span><span class="s1">] &lt;= </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">bins[-</span><span class="s4">1</span><span class="s1">] &gt;= </span><span class="s4">6</span>


<span class="s0">def </span><span class="s1">test_hist_nan_data():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s4">2</span><span class="s1">)</span>

    <span class="s1">data = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">nan_data = data + [np.nan]</span>

    <span class="s1">bins</span><span class="s0">, </span><span class="s1">edges</span><span class="s0">, </span><span class="s1">_ = ax1.hist(data)</span>
    <span class="s0">with </span><span class="s1">np.errstate(invalid=</span><span class="s3">'ignore'</span><span class="s1">):</span>
        <span class="s1">nanbins</span><span class="s0">, </span><span class="s1">nanedges</span><span class="s0">, </span><span class="s1">_ = ax2.hist(nan_data)</span>

    <span class="s1">np.testing.assert_allclose(bins</span><span class="s0">, </span><span class="s1">nanbins)</span>
    <span class="s1">np.testing.assert_allclose(edges</span><span class="s0">, </span><span class="s1">nanedges)</span>


<span class="s0">def </span><span class="s1">test_hist_range_and_density():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">bins</span><span class="s0">, </span><span class="s1">_ = plt.hist(np.random.rand(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;auto&quot;</span><span class="s0">,</span>
                          <span class="s1">range=(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">density=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">bins[</span><span class="s4">0</span><span class="s1">] == </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">bins[-</span><span class="s4">1</span><span class="s1">] == </span><span class="s4">1</span>


<span class="s0">def </span><span class="s1">test_bar_errbar_zorder():</span>
    <span class="s2"># Check that the zorder of errorbars is always greater than the bar they</span>
    <span class="s2"># are plotted on</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s1">barcont = ax.bar(x=x</span><span class="s0">, </span><span class="s1">height=x</span><span class="s0">, </span><span class="s1">yerr=x</span><span class="s0">, </span><span class="s1">capsize=</span><span class="s4">5</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s4">3</span><span class="s1">)</span>

    <span class="s1">data_line</span><span class="s0">, </span><span class="s1">caplines</span><span class="s0">, </span><span class="s1">barlinecols = barcont.errorbar.lines</span>
    <span class="s0">for </span><span class="s1">bar </span><span class="s0">in </span><span class="s1">barcont.patches:</span>
        <span class="s0">for </span><span class="s1">capline </span><span class="s0">in </span><span class="s1">caplines:</span>
            <span class="s0">assert </span><span class="s1">capline.zorder &gt; bar.zorder</span>
        <span class="s0">for </span><span class="s1">barlinecol </span><span class="s0">in </span><span class="s1">barlinecols:</span>
            <span class="s0">assert </span><span class="s1">barlinecol.zorder &gt; bar.zorder</span>


<span class="s0">def </span><span class="s1">test_set_ticks_inverted():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.invert_xaxis()</span>
    <span class="s1">ax.set_xticks([</span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.7</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ax.set_xticks([-</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_aspect_nonlinear_adjustable_box():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">))  </span><span class="s2"># Square.</span>

    <span class="s1">ax = fig.add_subplot()</span>
    <span class="s1">ax.plot([</span><span class="s4">.4</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.4</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">])  </span><span class="s2"># Set minpos to keep logit happy.</span>
    <span class="s1">ax.set(xscale=</span><span class="s3">&quot;log&quot;</span><span class="s0">, </span><span class="s1">xlim=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">)</span><span class="s0">,</span>
           <span class="s1">yscale=</span><span class="s3">&quot;logit&quot;</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s4">1</span><span class="s1">/</span><span class="s4">11</span><span class="s0">, </span><span class="s4">1</span><span class="s1">/</span><span class="s4">1001</span><span class="s1">)</span><span class="s0">,</span>
           <span class="s1">aspect=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">adjustable=</span><span class="s3">&quot;box&quot;</span><span class="s1">)</span>
    <span class="s1">ax.margins(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">pos = fig.transFigure.transform_bbox(ax.get_position())</span>
    <span class="s0">assert </span><span class="s1">pos.height / pos.width == pytest.approx(</span><span class="s4">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_aspect_nonlinear_adjustable_datalim():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s4">10</span><span class="s0">, </span><span class="s4">10</span><span class="s1">))  </span><span class="s2"># Square.</span>

    <span class="s1">ax = fig.add_axes([</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.8</span><span class="s0">, </span><span class="s4">.8</span><span class="s1">])  </span><span class="s2"># Square.</span>
    <span class="s1">ax.plot([</span><span class="s4">.4</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">.4</span><span class="s0">, </span><span class="s4">.6</span><span class="s1">])  </span><span class="s2"># Set minpos to keep logit happy.</span>
    <span class="s1">ax.set(xscale=</span><span class="s3">&quot;log&quot;</span><span class="s0">, </span><span class="s1">xlim=(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span><span class="s0">,</span>
           <span class="s1">yscale=</span><span class="s3">&quot;logit&quot;</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s4">1 </span><span class="s1">/ </span><span class="s4">101</span><span class="s0">, </span><span class="s4">1 </span><span class="s1">/ </span><span class="s4">11</span><span class="s1">)</span><span class="s0">,</span>
           <span class="s1">aspect=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">adjustable=</span><span class="s3">&quot;datalim&quot;</span><span class="s1">)</span>
    <span class="s1">ax.margins(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ax.apply_aspect()</span>

    <span class="s0">assert </span><span class="s1">ax.get_xlim() == pytest.approx([</span><span class="s4">1</span><span class="s1">*</span><span class="s4">10</span><span class="s1">**(</span><span class="s4">1</span><span class="s1">/</span><span class="s4">2</span><span class="s1">)</span><span class="s0">, </span><span class="s4">100</span><span class="s1">/</span><span class="s4">10</span><span class="s1">**(</span><span class="s4">1</span><span class="s1">/</span><span class="s4">2</span><span class="s1">)])</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (</span><span class="s4">1 </span><span class="s1">/ </span><span class="s4">101</span><span class="s0">, </span><span class="s4">1 </span><span class="s1">/ </span><span class="s4">11</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_box_aspect():</span>
    <span class="s2"># Test if axes with box_aspect=1 has same dimensions</span>
    <span class="s2"># as axes with aspect equal and adjustable=&quot;box&quot;</span>

    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots()</span>
    <span class="s1">axtwin = ax1.twinx()</span>
    <span class="s1">axtwin.plot([</span><span class="s4">12</span><span class="s0">, </span><span class="s4">344</span><span class="s1">])</span>

    <span class="s1">ax1.set_box_aspect(</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax1.get_box_aspect() == </span><span class="s4">1.0</span>

    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots()</span>
    <span class="s1">ax2.margins(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s1">ax2.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">6</span><span class="s0">, </span><span class="s4">8</span><span class="s1">])</span>
    <span class="s1">ax2.set_aspect(</span><span class="s3">&quot;equal&quot;</span><span class="s0">, </span><span class="s1">adjustable=</span><span class="s3">&quot;box&quot;</span><span class="s1">)</span>

    <span class="s1">fig1.canvas.draw()</span>
    <span class="s1">fig2.canvas.draw()</span>

    <span class="s1">bb1 = ax1.get_position()</span>
    <span class="s1">bbt = axtwin.get_position()</span>
    <span class="s1">bb2 = ax2.get_position()</span>

    <span class="s1">assert_array_equal(bb1.extents</span><span class="s0">, </span><span class="s1">bb2.extents)</span>
    <span class="s1">assert_array_equal(bbt.extents</span><span class="s0">, </span><span class="s1">bb2.extents)</span>


<span class="s0">def </span><span class="s1">test_box_aspect_custom_position():</span>
    <span class="s2"># Test if axes with custom position and box_aspect</span>
    <span class="s2"># behaves the same independent of the order of setting those.</span>

    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots()</span>
    <span class="s1">ax1.set_position([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.9</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">])</span>
    <span class="s1">fig1.canvas.draw()</span>
    <span class="s1">ax1.set_box_aspect(</span><span class="s4">1.</span><span class="s1">)</span>

    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots()</span>
    <span class="s1">ax2.set_box_aspect(</span><span class="s4">1.</span><span class="s1">)</span>
    <span class="s1">fig2.canvas.draw()</span>
    <span class="s1">ax2.set_position([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.9</span><span class="s0">, </span><span class="s4">0.2</span><span class="s1">])</span>

    <span class="s1">fig1.canvas.draw()</span>
    <span class="s1">fig2.canvas.draw()</span>

    <span class="s1">bb1 = ax1.get_position()</span>
    <span class="s1">bb2 = ax2.get_position()</span>

    <span class="s1">assert_array_equal(bb1.extents</span><span class="s0">, </span><span class="s1">bb2.extents)</span>


<span class="s0">def </span><span class="s1">test_bbox_aspect_axes_init():</span>
    <span class="s2"># Test that box_aspect can be given to axes init and produces</span>
    <span class="s2"># all equal square axes.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">subplot_kw=dict(box_aspect=</span><span class="s4">1</span><span class="s1">)</span><span class="s0">,</span>
                            <span class="s1">constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">renderer = fig.canvas.get_renderer()</span>
    <span class="s1">sizes = []</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">bb = ax.get_window_extent(renderer)</span>
        <span class="s1">sizes.extend([bb.width</span><span class="s0">, </span><span class="s1">bb.height])</span>

    <span class="s1">assert_allclose(sizes</span><span class="s0">, </span><span class="s1">sizes[</span><span class="s4">0</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_set_aspect_negative():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;must be finite and positive&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_aspect(-</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;must be finite and positive&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_aspect(</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;must be finite and positive&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_aspect(np.inf)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;must be finite and positive&quot;</span><span class="s1">):</span>
        <span class="s1">ax.set_aspect(-np.inf)</span>


<span class="s0">def </span><span class="s1">test_redraw_in_frame():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">ax.redraw_in_frame()</span>


<span class="s0">def </span><span class="s1">test_invisible_axes_events():</span>
    <span class="s2"># invisible axes should not respond to events...</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.inaxes((</span><span class="s4">200</span><span class="s0">, </span><span class="s4">200</span><span class="s1">)) </span><span class="s0">is not None</span>
    <span class="s1">ax.set_visible(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.inaxes((</span><span class="s4">200</span><span class="s0">, </span><span class="s4">200</span><span class="s1">)) </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_xtickcolor_is_not_markercolor():</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'lines.markeredgecolor'</span><span class="s1">] = </span><span class="s3">'white'</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s1">ticks = ax.xaxis.get_major_ticks()</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ticks:</span>
        <span class="s0">assert </span><span class="s1">tick.tick1line.get_markeredgecolor() != </span><span class="s3">'white'</span>


<span class="s0">def </span><span class="s1">test_ytickcolor_is_not_markercolor():</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'lines.markeredgecolor'</span><span class="s1">] = </span><span class="s3">'white'</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s1">ticks = ax.yaxis.get_major_ticks()</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ticks:</span>
        <span class="s0">assert </span><span class="s1">tick.tick1line.get_markeredgecolor() != </span><span class="s3">'white'</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'axis'</span><span class="s0">, </span><span class="s1">(</span><span class="s3">'x'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s1">))</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'auto'</span><span class="s0">, </span><span class="s1">(</span><span class="s0">True, False, None</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_unautoscale(axis</span><span class="s0">, </span><span class="s1">auto):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">x = np.arange(</span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">y = np.linspace(-</span><span class="s4">.1</span><span class="s0">, </span><span class="s4">.1</span><span class="s0">, </span><span class="s4">100</span><span class="s1">)</span>
    <span class="s1">ax.scatter(y</span><span class="s0">, </span><span class="s1">x)</span>

    <span class="s1">get_autoscale_on = getattr(ax</span><span class="s0">, </span><span class="s3">f'get_autoscale</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s3">_on'</span><span class="s1">)</span>
    <span class="s1">set_lim = getattr(ax</span><span class="s0">, </span><span class="s3">f'set_</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s3">lim'</span><span class="s1">)</span>
    <span class="s1">get_lim = getattr(ax</span><span class="s0">, </span><span class="s3">f'get_</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s3">lim'</span><span class="s1">)</span>

    <span class="s1">post_auto = get_autoscale_on() </span><span class="s0">if </span><span class="s1">auto </span><span class="s0">is None else </span><span class="s1">auto</span>

    <span class="s1">set_lim((-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">auto=auto)</span>
    <span class="s0">assert </span><span class="s1">post_auto == get_autoscale_on()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">assert_array_equal(get_lim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_polar_interpolation_steps_variable_r(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">l</span><span class="s0">, </span><span class="s1">= fig_test.add_subplot(projection=</span><span class="s3">&quot;polar&quot;</span><span class="s1">).plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.pi/</span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">])</span>
    <span class="s1">l.get_path()._interpolation_steps = </span><span class="s4">100</span>
    <span class="s1">fig_ref.add_subplot(projection=</span><span class="s3">&quot;polar&quot;</span><span class="s1">).plot(</span>
        <span class="s1">np.linspace(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">np.pi/</span><span class="s4">2</span><span class="s0">, </span><span class="s4">101</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.linspace(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">101</span><span class="s1">))</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_autoscale_tiny_sticky():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.bar(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1e-9</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim() == (</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1.05e-9</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_xtickcolor_is_not_xticklabelcolor():</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'xtick.color'</span><span class="s1">] = </span><span class="s3">'yellow'</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'xtick.labelcolor'</span><span class="s1">] = </span><span class="s3">'blue'</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s1">ticks = ax.xaxis.get_major_ticks()</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ticks:</span>
        <span class="s0">assert </span><span class="s1">tick.tick1line.get_color() == </span><span class="s3">'yellow'</span>
        <span class="s0">assert </span><span class="s1">tick.label1.get_color() == </span><span class="s3">'blue'</span>


<span class="s0">def </span><span class="s1">test_ytickcolor_is_not_yticklabelcolor():</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'ytick.color'</span><span class="s1">] = </span><span class="s3">'yellow'</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'ytick.labelcolor'</span><span class="s1">] = </span><span class="s3">'blue'</span>
    <span class="s1">ax = plt.axes()</span>
    <span class="s1">ticks = ax.yaxis.get_major_ticks()</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ticks:</span>
        <span class="s0">assert </span><span class="s1">tick.tick1line.get_color() == </span><span class="s3">'yellow'</span>
        <span class="s0">assert </span><span class="s1">tick.label1.get_color() == </span><span class="s3">'blue'</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'size'</span><span class="s0">, </span><span class="s1">[size </span><span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">mfont_manager.font_scalings</span>
                                  <span class="s0">if </span><span class="s1">size </span><span class="s0">is not None</span><span class="s1">] + [</span><span class="s4">8</span><span class="s0">, </span><span class="s4">10</span><span class="s0">, </span><span class="s4">12</span><span class="s1">])</span>
<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_relative_ticklabel_sizes(size):</span>
    <span class="s1">mpl.rcParams[</span><span class="s3">'xtick.labelsize'</span><span class="s1">] = size</span>
    <span class="s1">mpl.rcParams[</span><span class="s3">'ytick.labelsize'</span><span class="s1">] = size</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.canvas.draw()</span>

    <span class="s0">for </span><span class="s1">name</span><span class="s0">, </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">zip([</span><span class="s3">'x'</span><span class="s0">, </span><span class="s3">'y'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[ax.xaxis</span><span class="s0">, </span><span class="s1">ax.yaxis]):</span>
        <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">axis.get_major_ticks():</span>
            <span class="s0">assert </span><span class="s1">tick.label1.get_size() == axis._get_tick_label_size(name)</span>


<span class="s0">def </span><span class="s1">test_multiplot_autoscale():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax1</span><span class="s0">, </span><span class="s1">ax2 = fig.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s3">'all'</span><span class="s1">)</span>
    <span class="s1">ax1.scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">])</span>
    <span class="s1">ax2.axhspan(-</span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">xlim = ax1.get_xlim()</span>
    <span class="s0">assert </span><span class="s1">np.allclose(xlim</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">4.5</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_sharing_does_not_link_positions():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax0 = fig.add_subplot(</span><span class="s4">221</span><span class="s1">)</span>
    <span class="s1">ax1 = fig.add_axes([</span><span class="s4">.6</span><span class="s0">, </span><span class="s4">.6</span><span class="s0">, </span><span class="s4">.3</span><span class="s0">, </span><span class="s4">.3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">sharex=ax0)</span>
    <span class="s1">init_pos = ax1.get_position()</span>
    <span class="s1">fig.subplots_adjust(left=</span><span class="s4">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">(ax1.get_position().get_points() == init_pos.get_points()).all()</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;pdf&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_2dcolor_plot(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">color = np.array([</span><span class="s4">0.1</span><span class="s0">, </span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.3</span><span class="s1">])</span>
    <span class="s2"># plot with 1D-color:</span>
    <span class="s1">axs = fig_test.subplots(</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=color.reshape(-</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.warns(match=</span><span class="s3">&quot;argument looks like a single numeric RGB&quot;</span><span class="s1">):</span>
        <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=color.reshape(-</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">axs[</span><span class="s4">2</span><span class="s1">].step([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=color.reshape(-</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">axs[</span><span class="s4">3</span><span class="s1">].hist(np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=color.reshape(-</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s1">axs[</span><span class="s4">4</span><span class="s1">].bar(np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=color.reshape(-</span><span class="s4">1</span><span class="s1">))</span>
    <span class="s2"># plot with 2D-color:</span>
    <span class="s1">axs = fig_ref.subplots(</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s1">].plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=color.reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)))</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s1">].scatter([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=color.reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)))</span>
    <span class="s1">axs[</span><span class="s4">2</span><span class="s1">].step([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">c=color.reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)))</span>
    <span class="s1">axs[</span><span class="s4">3</span><span class="s1">].hist(np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=color.reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)))</span>
    <span class="s1">axs[</span><span class="s4">4</span><span class="s1">].bar(np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">color=color.reshape((</span><span class="s4">1</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_shared_axes_clear(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">x = np.arange(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">*np.pi</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">)</span>
    <span class="s1">y = np.sin(x)</span>

    <span class="s1">axs = fig_ref.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">axs = fig_test.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">ax.clear()</span>
        <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>


<span class="s0">def </span><span class="s1">test_shared_axes_retick():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s3">'all'</span><span class="s0">, </span><span class="s1">sharey=</span><span class="s3">'all'</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">ax.plot([</span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'o-'</span><span class="s1">)</span>

    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].set_xticks([-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">1.5</span><span class="s1">])  </span><span class="s2"># should affect all axes xlims</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s0">assert </span><span class="s1">ax.get_xlim() == axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].get_xlim()</span>

    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].set_yticks([-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2.5</span><span class="s1">])  </span><span class="s2"># should affect all axes ylims</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s0">assert </span><span class="s1">ax.get_ylim() == axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].get_ylim()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'ha'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'left'</span><span class="s0">, </span><span class="s3">'center'</span><span class="s0">, </span><span class="s3">'right'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_ylabel_ha_with_position(ha):</span>
    <span class="s1">fig = Figure()</span>
    <span class="s1">ax = fig.subplots()</span>
    <span class="s1">ax.set_ylabel(</span><span class="s3">&quot;test&quot;</span><span class="s0">, </span><span class="s1">y=</span><span class="s4">1</span><span class="s0">, </span><span class="s1">ha=ha)</span>
    <span class="s1">ax.yaxis.set_label_position(</span><span class="s3">&quot;right&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.yaxis.get_label().get_ha() == ha</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_vertical():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">xs</span><span class="s0">, </span><span class="s1">heights = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">rects = ax.bar(xs</span><span class="s0">, </span><span class="s1">heights)</span>
    <span class="s1">labels = ax.bar_label(rects)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (xs[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">heights[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_ha() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'bottom'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].xy == (xs[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">heights[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_ha() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_va() == </span><span class="s3">'top'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_vertical_yinverted():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.invert_yaxis()</span>
    <span class="s1">xs</span><span class="s0">, </span><span class="s1">heights = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">rects = ax.bar(xs</span><span class="s0">, </span><span class="s1">heights)</span>
    <span class="s1">labels = ax.bar_label(rects)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (xs[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">heights[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_ha() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'top'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].xy == (xs[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">heights[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_ha() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_va() == </span><span class="s3">'bottom'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_horizontal():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ys</span><span class="s0">, </span><span class="s1">widths = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">rects = ax.barh(ys</span><span class="s0">, </span><span class="s1">widths)</span>
    <span class="s1">labels = ax.bar_label(rects)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (widths[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_ha() == </span><span class="s3">'left'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].xy == (widths[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_ha() == </span><span class="s3">'right'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_horizontal_yinverted():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.invert_yaxis()</span>
    <span class="s1">ys</span><span class="s0">, </span><span class="s1">widths = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">rects = ax.barh(ys</span><span class="s0">, </span><span class="s1">widths)</span>
    <span class="s1">labels = ax.bar_label(rects)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (widths[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_ha() == </span><span class="s3">'left'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].xy == (widths[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_ha() == </span><span class="s3">'right'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_horizontal_xinverted():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.invert_xaxis()</span>
    <span class="s1">ys</span><span class="s0">, </span><span class="s1">widths = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">rects = ax.barh(ys</span><span class="s0">, </span><span class="s1">widths)</span>
    <span class="s1">labels = ax.bar_label(rects)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (widths[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_ha() == </span><span class="s3">'right'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].xy == (widths[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_ha() == </span><span class="s3">'left'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_horizontal_xyinverted():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.invert_xaxis()</span>
    <span class="s1">ax.invert_yaxis()</span>
    <span class="s1">ys</span><span class="s0">, </span><span class="s1">widths = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">rects = ax.barh(ys</span><span class="s0">, </span><span class="s1">widths)</span>
    <span class="s1">labels = ax.bar_label(rects)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (widths[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_ha() == </span><span class="s3">'right'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].xy == (widths[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ys[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_ha() == </span><span class="s3">'left'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_center():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ys</span><span class="s0">, </span><span class="s1">widths = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">rects = ax.barh(ys</span><span class="s0">, </span><span class="s1">widths)</span>
    <span class="s1">labels = ax.bar_label(rects</span><span class="s0">, </span><span class="s1">label_type=</span><span class="s3">'center'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_ha() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].xy == (</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">0.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_ha() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_va() == </span><span class="s3">'center'</span>


<span class="s1">@image_comparison([</span><span class="s3">'test_centered_bar_label_nonlinear.svg'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_centered_bar_label_nonlinear():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">bar_container = ax.barh([</span><span class="s3">'c'</span><span class="s0">, </span><span class="s3">'b'</span><span class="s0">, </span><span class="s3">'a'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1_000</span><span class="s0">, </span><span class="s4">5_000</span><span class="s0">, </span><span class="s4">7_000</span><span class="s1">])</span>
    <span class="s1">ax.set_xscale(</span><span class="s3">'log'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(</span><span class="s4">1</span><span class="s0">, None</span><span class="s1">)</span>
    <span class="s1">ax.bar_label(bar_container</span><span class="s0">, </span><span class="s1">label_type=</span><span class="s3">'center'</span><span class="s1">)</span>
    <span class="s1">ax.set_axis_off()</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_errorbars():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">xs</span><span class="s0">, </span><span class="s1">heights = [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">]</span>
    <span class="s1">rects = ax.bar(xs</span><span class="s0">, </span><span class="s1">heights</span><span class="s0">, </span><span class="s1">yerr=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">labels = ax.bar_label(rects)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (xs[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">heights[</span><span class="s4">0</span><span class="s1">] + </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_ha() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'bottom'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].xy == (xs[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">heights[</span><span class="s4">1</span><span class="s1">] - </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_ha() == </span><span class="s3">'center'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_va() == </span><span class="s3">'top'</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'fmt'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s3">'%.2f'</span><span class="s0">, </span><span class="s3">'{:.2f}'</span><span class="s0">, </span><span class="s3">'{:.2f}'</span><span class="s1">.format</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar_label_fmt(fmt):</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">rects = ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">labels = ax.bar_label(rects</span><span class="s0">, </span><span class="s1">fmt=fmt)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'3.00'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_text() == </span><span class="s3">'-4.00'</span>


<span class="s0">def </span><span class="s1">test_bar_label_fmt_error():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">rects = ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'str or callable'</span><span class="s1">):</span>
        <span class="s1">_ = ax.bar_label(rects</span><span class="s0">, </span><span class="s1">fmt=</span><span class="s4">10</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_bar_label_labels():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">rects = ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3</span><span class="s0">, </span><span class="s1">-</span><span class="s4">4</span><span class="s1">])</span>
    <span class="s1">labels = ax.bar_label(rects</span><span class="s0">, </span><span class="s1">labels=[</span><span class="s3">'A'</span><span class="s0">, </span><span class="s3">'B'</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'A'</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">1</span><span class="s1">].get_text() == </span><span class="s3">'B'</span>


<span class="s0">def </span><span class="s1">test_bar_label_nan_ydata():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">bars = ax.bar([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">labels = ax.bar_label(bars)</span>
    <span class="s0">assert </span><span class="s1">[l.get_text() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels] == [</span><span class="s3">''</span><span class="s0">, </span><span class="s3">'1'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'bottom'</span>


<span class="s0">def </span><span class="s1">test_bar_label_nan_ydata_inverted():</span>
    <span class="s1">ax = plt.gca()</span>
    <span class="s1">ax.yaxis_inverted()</span>
    <span class="s1">bars = ax.bar([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">labels = ax.bar_label(bars)</span>
    <span class="s0">assert </span><span class="s1">[l.get_text() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels] == [</span><span class="s3">''</span><span class="s0">, </span><span class="s3">'1'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].xy == (</span><span class="s4">2</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">labels[</span><span class="s4">0</span><span class="s1">].get_va() == </span><span class="s3">'bottom'</span>


<span class="s0">def </span><span class="s1">test_nan_barlabels():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">bars = ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=[</span><span class="s4">0.2</span><span class="s0">, </span><span class="s4">0.4</span><span class="s0">, </span><span class="s4">0.6</span><span class="s1">])</span>
    <span class="s1">labels = ax.bar_label(bars)</span>
    <span class="s0">assert </span><span class="s1">[l.get_text() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels] == [</span><span class="s3">''</span><span class="s0">, </span><span class="s3">'1'</span><span class="s0">, </span><span class="s3">'2'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">np.allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">bars = ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=[</span><span class="s4">0.2</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">0.6</span><span class="s1">])</span>
    <span class="s1">labels = ax.bar_label(bars)</span>
    <span class="s0">assert </span><span class="s1">[l.get_text() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels] == [</span><span class="s3">'0'</span><span class="s0">, </span><span class="s3">'1'</span><span class="s0">, </span><span class="s3">'2'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">np.allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">(-</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">bars = ax.bar([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[np.nan</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yerr=[np.nan</span><span class="s0">, </span><span class="s1">np.nan</span><span class="s0">, </span><span class="s4">0.6</span><span class="s1">])</span>
    <span class="s1">labels = ax.bar_label(bars)</span>
    <span class="s0">assert </span><span class="s1">[l.get_text() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels] == [</span><span class="s3">''</span><span class="s0">, </span><span class="s3">'1'</span><span class="s0">, </span><span class="s3">'2'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">np.allclose(ax.get_ylim()</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0.0</span><span class="s0">, </span><span class="s4">3.0</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_patch_bounds():  </span><span class="s2"># PR 19078</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.add_patch(mpatches.Wedge((</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1.05</span><span class="s0">, </span><span class="s4">60</span><span class="s0">, </span><span class="s4">120</span><span class="s0">, </span><span class="s1">width=</span><span class="s4">0.1</span><span class="s1">))</span>
    <span class="s1">bot = </span><span class="s4">1.9</span><span class="s1">*np.sin(</span><span class="s4">15</span><span class="s1">*np.pi/</span><span class="s4">180</span><span class="s1">)**</span><span class="s4">2</span>
    <span class="s1">np.testing.assert_array_almost_equal_nulp(</span>
        <span class="s1">np.array((-</span><span class="s4">0.525</span><span class="s0">, </span><span class="s1">-(bot+</span><span class="s4">0.05</span><span class="s1">)</span><span class="s0">, </span><span class="s4">1.05</span><span class="s0">, </span><span class="s1">bot+</span><span class="s4">0.1</span><span class="s1">))</span><span class="s0">, </span><span class="s1">ax.dataLim.bounds</span><span class="s0">, </span><span class="s4">16</span><span class="s1">)</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_warn_ignored_scatter_kwargs():</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s3">r&quot;You passed a edgecolor/edgecolors&quot;</span><span class="s1">):</span>
        <span class="s1">plt.scatter([</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s3">&quot;+&quot;</span><span class="s0">, </span><span class="s1">s=</span><span class="s4">500</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s3">&quot;r&quot;</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s3">&quot;b&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_artist_sublists():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">lines = [ax.plot(np.arange(i</span><span class="s0">, </span><span class="s1">i + </span><span class="s4">5</span><span class="s1">))[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">6</span><span class="s1">)]</span>
    <span class="s1">col = ax.scatter(np.arange(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s4">5</span><span class="s1">))</span>
    <span class="s1">im = ax.imshow(np.zeros((</span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s1">)))</span>
    <span class="s1">patch = ax.add_patch(mpatches.Rectangle((</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s4">5</span><span class="s1">))</span>
    <span class="s1">text = ax.text(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s3">'foo'</span><span class="s1">)</span>

    <span class="s2"># Get items, which should not be mixed.</span>
    <span class="s0">assert </span><span class="s1">list(ax.collections) == [col]</span>
    <span class="s0">assert </span><span class="s1">list(ax.images) == [im]</span>
    <span class="s0">assert </span><span class="s1">list(ax.lines) == lines</span>
    <span class="s0">assert </span><span class="s1">list(ax.patches) == [patch]</span>
    <span class="s0">assert not </span><span class="s1">ax.tables</span>
    <span class="s0">assert </span><span class="s1">list(ax.texts) == [text]</span>

    <span class="s2"># Get items should work like lists/tuple.</span>
    <span class="s0">assert </span><span class="s1">ax.lines[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">is </span><span class="s1">lines[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">ax.lines[-</span><span class="s4">1</span><span class="s1">] </span><span class="s0">is </span><span class="s1">lines[-</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s0">with </span><span class="s1">pytest.raises(IndexError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">'out of range'</span><span class="s1">):</span>
        <span class="s1">ax.lines[len(lines) + </span><span class="s4">1</span><span class="s1">]</span>

    <span class="s2"># Adding to other lists should produce a regular list.</span>
    <span class="s0">assert </span><span class="s1">ax.lines + [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">] == [*lines</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">] + ax.lines == [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">*lines]</span>

    <span class="s2"># Adding to other tuples should produce a regular tuples.</span>
    <span class="s0">assert </span><span class="s1">ax.lines + (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">) == (*lines</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">(</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">) + ax.lines == (</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">*lines)</span>

    <span class="s2"># Lists should be empty after removing items.</span>
    <span class="s1">col.remove()</span>
    <span class="s0">assert not </span><span class="s1">ax.collections</span>
    <span class="s1">im.remove()</span>
    <span class="s0">assert not </span><span class="s1">ax.images</span>
    <span class="s1">patch.remove()</span>
    <span class="s0">assert not </span><span class="s1">ax.patches</span>
    <span class="s0">assert not </span><span class="s1">ax.tables</span>
    <span class="s1">text.remove()</span>
    <span class="s0">assert not </span><span class="s1">ax.texts</span>

    <span class="s0">for </span><span class="s1">ln </span><span class="s0">in </span><span class="s1">ax.lines:</span>
        <span class="s1">ln.remove()</span>
    <span class="s0">assert </span><span class="s1">len(ax.lines) == </span><span class="s4">0</span>


<span class="s0">def </span><span class="s1">test_empty_line_plots():</span>
    <span class="s2"># Incompatible nr columns, plot &quot;nothing&quot;</span>
    <span class="s1">x = np.ones(</span><span class="s4">10</span><span class="s1">)</span>
    <span class="s1">y = np.ones((</span><span class="s4">10</span><span class="s0">, </span><span class="s4">0</span><span class="s1">))</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line = ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s0">assert </span><span class="s1">len(line) == </span><span class="s4">0</span>

    <span class="s2"># Ensure plot([],[]) creates line</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line = ax.plot([]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s0">assert </span><span class="s1">len(line) == </span><span class="s4">1</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'fmt, match'</span><span class="s0">, </span><span class="s1">(</span>
    <span class="s1">(</span><span class="s3">&quot;f&quot;</span><span class="s0">, </span><span class="s3">r&quot;'f' is not a valid format string \(unrecognized character 'f'\)&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s3">&quot;o+&quot;</span><span class="s0">, </span><span class="s3">r&quot;'o\+' is not a valid format string \(two marker symbols\)&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s3">&quot;:-&quot;</span><span class="s0">, </span><span class="s3">r&quot;':-' is not a valid format string \(two linestyle symbols\)&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s3">&quot;rk&quot;</span><span class="s0">, </span><span class="s3">r&quot;'rk' is not a valid format string \(two color symbols\)&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s3">&quot;:o-r&quot;</span><span class="s0">, </span><span class="s3">r&quot;':o-r' is not a valid format string \(two linestyle symbols\)&quot;</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">))</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;data&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s1">{</span><span class="s3">&quot;string&quot;</span><span class="s1">: range(</span><span class="s4">3</span><span class="s1">)}])</span>
<span class="s0">def </span><span class="s1">test_plot_format_errors(fmt</span><span class="s0">, </span><span class="s1">match</span><span class="s0">, </span><span class="s1">data):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">if </span><span class="s1">data </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">match = match.replace(</span><span class="s3">&quot;not&quot;</span><span class="s0">, </span><span class="s3">&quot;neither a data key nor&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">r&quot;\A&quot; </span><span class="s1">+ match + </span><span class="s3">r&quot;\Z&quot;</span><span class="s1">):</span>
        <span class="s1">ax.plot(</span><span class="s3">&quot;string&quot;</span><span class="s0">, </span><span class="s1">fmt</span><span class="s0">, </span><span class="s1">data=data)</span>


<span class="s0">def </span><span class="s1">test_plot_format():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line = ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'1.0'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">line[</span><span class="s4">0</span><span class="s1">].get_color() == (</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">line[</span><span class="s4">0</span><span class="s1">].get_marker() == </span><span class="s3">'None'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line = ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'1'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">line[</span><span class="s4">0</span><span class="s1">].get_marker() == </span><span class="s3">'1'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line = ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'1.0'</span><span class="s0">, </span><span class="s3">&quot;1&quot;</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">line[</span><span class="s4">0</span><span class="s1">].get_color() == (</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">1.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_yticklabels()[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'1'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line = ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'1'</span><span class="s0">, </span><span class="s3">&quot;1.0&quot;</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">line[</span><span class="s4">0</span><span class="s1">].get_marker() == </span><span class="s3">'1'</span>
    <span class="s0">assert </span><span class="s1">ax.get_yticklabels()[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'1.0'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line = ax.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s3">'k3'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">line[</span><span class="s4">0</span><span class="s1">].get_marker() == </span><span class="s3">'3'</span>
    <span class="s0">assert </span><span class="s1">line[</span><span class="s4">0</span><span class="s1">].get_color() == </span><span class="s3">'k'</span>


<span class="s0">def </span><span class="s1">test_automatic_legend():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s1">data={</span><span class="s3">&quot;d&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s1">})</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">leg.get_texts()[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'a'</span>
    <span class="s0">assert </span><span class="s1">ax.get_yticklabels()[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'a'</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s1">data={</span><span class="s3">&quot;d&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s1">})</span>
    <span class="s1">leg = ax.legend()</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">leg.get_texts()[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'b'</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'a'</span>
    <span class="s0">assert </span><span class="s1">ax.get_yticklabels()[</span><span class="s4">0</span><span class="s1">].get_text() == </span><span class="s3">'b'</span>


<span class="s0">def </span><span class="s1">test_plot_errors():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">r&quot;plot\(\) got an unexpected keyword&quot;</span><span class="s1">):</span>
        <span class="s1">plt.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">r&quot;plot\(\) with multiple groups&quot;</span><span class="s1">):</span>
        <span class="s1">plt.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s4">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=[</span><span class="s3">'1'</span><span class="s0">, </span><span class="s3">'2'</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;x and y must have same first&quot;</span><span class="s1">):</span>
        <span class="s1">plt.plot([</span><span class="s4">1</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;x and y can be no greater than&quot;</span><span class="s1">):</span>
        <span class="s1">plt.plot(np.ones((</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)))</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">&quot;Using arbitrary long args with&quot;</span><span class="s1">):</span>
        <span class="s1">plt.plot(</span><span class="s3">&quot;a&quot;</span><span class="s0">, </span><span class="s3">&quot;b&quot;</span><span class="s0">, </span><span class="s3">&quot;c&quot;</span><span class="s0">, </span><span class="s3">&quot;d&quot;</span><span class="s0">, </span><span class="s1">data={</span><span class="s3">&quot;a&quot;</span><span class="s1">: </span><span class="s4">2</span><span class="s1">})</span>


<span class="s0">def </span><span class="s1">test_clim():</span>
    <span class="s1">ax = plt.figure().add_subplot()</span>
    <span class="s0">for </span><span class="s1">plot_method </span><span class="s0">in </span><span class="s1">[</span>
            <span class="s1">partial(ax.scatter</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">c=range(</span><span class="s4">3</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">partial(ax.imshow</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]])</span><span class="s0">,</span>
            <span class="s1">partial(ax.pcolor</span><span class="s0">,  </span><span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]])</span><span class="s0">,</span>
            <span class="s1">partial(ax.pcolormesh</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]])</span><span class="s0">,</span>
            <span class="s1">partial(ax.pcolorfast</span><span class="s0">, </span><span class="s1">[[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2</span><span class="s0">, </span><span class="s4">3</span><span class="s1">]])</span><span class="s0">,</span>
    <span class="s1">]:</span>
        <span class="s1">clim = (</span><span class="s4">7</span><span class="s0">, </span><span class="s4">8</span><span class="s1">)</span>
        <span class="s1">norm = plot_method(clim=clim).norm</span>
        <span class="s0">assert </span><span class="s1">(norm.vmin</span><span class="s0">, </span><span class="s1">norm.vmax) == clim</span>


<span class="s0">def </span><span class="s1">test_bezier_autoscale():</span>
    <span class="s2"># Check that bezier curves autoscale to their curves, and not their</span>
    <span class="s2"># control points</span>
    <span class="s1">verts = [[-</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">0</span><span class="s0">, </span><span class="s1">-</span><span class="s4">1</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">]]</span>
    <span class="s1">codes = [mpath.Path.MOVETO</span><span class="s0">,</span>
             <span class="s1">mpath.Path.CURVE3</span><span class="s0">,</span>
             <span class="s1">mpath.Path.CURVE3</span><span class="s0">,</span>
             <span class="s1">mpath.Path.CLOSEPOLY]</span>
    <span class="s1">p = mpath.Path(verts</span><span class="s0">, </span><span class="s1">codes)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.add_patch(mpatches.PathPatch(p))</span>
    <span class="s1">ax.autoscale()</span>
    <span class="s2"># Bottom ylim should be at the edge of the curve (-0.5), and not include</span>
    <span class="s2"># the control point (at -1)</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim()[</span><span class="s4">0</span><span class="s1">] == -</span><span class="s4">0.5</span>


<span class="s0">def </span><span class="s1">test_small_autoscale():</span>
    <span class="s2"># Check that paths with small values autoscale correctly #24097.</span>
    <span class="s1">verts = np.array([</span>
        <span class="s1">[-</span><span class="s4">5.45</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">5.45</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">5.29</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">5.29</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">5.13</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">5.13</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.97</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.97</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">4.81</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.81</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.65</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.65</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">4.49</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.49</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.33</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.33</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">4.17</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.17</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.01</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">4.01</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">3.85</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.85</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.69</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.69</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">3.53</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.53</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.37</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.37</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">3.21</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.21</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.05</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">3.05</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">2.89</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.89</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.73</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.73</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">2.57</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.57</span><span class="s0">, </span><span class="s4">0.04</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.41</span><span class="s0">, </span><span class="s4">0.04</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.41</span><span class="s0">, </span><span class="s4">0.04</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">2.25</span><span class="s0">, </span><span class="s4">0.04</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.25</span><span class="s0">, </span><span class="s4">0.06</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.09</span><span class="s0">, </span><span class="s4">0.06</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">2.09</span><span class="s0">, </span><span class="s4">0.08</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">1.93</span><span class="s0">, </span><span class="s4">0.08</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.93</span><span class="s0">, </span><span class="s4">0.10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.77</span><span class="s0">, </span><span class="s4">0.10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.77</span><span class="s0">, </span><span class="s4">0.12</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">1.61</span><span class="s0">, </span><span class="s4">0.12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.61</span><span class="s0">, </span><span class="s4">0.14</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.45</span><span class="s0">, </span><span class="s4">0.14</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.45</span><span class="s0">, </span><span class="s4">0.17</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">1.30</span><span class="s0">, </span><span class="s4">0.17</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.30</span><span class="s0">, </span><span class="s4">0.19</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.14</span><span class="s0">, </span><span class="s4">0.19</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">1.14</span><span class="s0">, </span><span class="s4">0.22</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">0.98</span><span class="s0">, </span><span class="s4">0.22</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.98</span><span class="s0">, </span><span class="s4">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.82</span><span class="s0">, </span><span class="s4">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.82</span><span class="s0">, </span><span class="s4">0.27</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">0.66</span><span class="s0">, </span><span class="s4">0.27</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.66</span><span class="s0">, </span><span class="s4">0.29</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.50</span><span class="s0">, </span><span class="s4">0.29</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.50</span><span class="s0">, </span><span class="s4">0.30</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">0.34</span><span class="s0">, </span><span class="s4">0.30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.34</span><span class="s0">, </span><span class="s4">0.32</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.18</span><span class="s0">, </span><span class="s4">0.32</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.18</span><span class="s0">, </span><span class="s4">0.33</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[-</span><span class="s4">0.02</span><span class="s0">, </span><span class="s4">0.33</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s4">0.02</span><span class="s0">, </span><span class="s4">0.32</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.13</span><span class="s0">, </span><span class="s4">0.32</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.13</span><span class="s0">, </span><span class="s4">0.33</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.29</span><span class="s0">, </span><span class="s4">0.33</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">0.29</span><span class="s0">, </span><span class="s4">0.31</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.31</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.45</span><span class="s0">, </span><span class="s4">0.30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.61</span><span class="s0">, </span><span class="s4">0.30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.61</span><span class="s0">, </span><span class="s4">0.28</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">0.77</span><span class="s0">, </span><span class="s4">0.28</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.77</span><span class="s0">, </span><span class="s4">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.93</span><span class="s0">, </span><span class="s4">0.25</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">0.93</span><span class="s0">, </span><span class="s4">0.22</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.09</span><span class="s0">, </span><span class="s4">0.22</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">1.09</span><span class="s0">, </span><span class="s4">0.19</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.25</span><span class="s0">, </span><span class="s4">0.19</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.25</span><span class="s0">, </span><span class="s4">0.17</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.41</span><span class="s0">, </span><span class="s4">0.17</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.41</span><span class="s0">, </span><span class="s4">0.15</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">1.57</span><span class="s0">, </span><span class="s4">0.15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.57</span><span class="s0">, </span><span class="s4">0.12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.73</span><span class="s0">, </span><span class="s4">0.12</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.73</span><span class="s0">, </span><span class="s4">0.10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1.89</span><span class="s0">, </span><span class="s4">0.10</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">1.89</span><span class="s0">, </span><span class="s4">0.08</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.05</span><span class="s0">, </span><span class="s4">0.08</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.05</span><span class="s0">, </span><span class="s4">0.07</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.21</span><span class="s0">, </span><span class="s4">0.07</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.21</span><span class="s0">, </span><span class="s4">0.05</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">2.37</span><span class="s0">, </span><span class="s4">0.05</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.37</span><span class="s0">, </span><span class="s4">0.04</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.53</span><span class="s0">, </span><span class="s4">0.04</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.53</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.69</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">2.69</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.85</span><span class="s0">, </span><span class="s4">0.02</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">2.85</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.01</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.01</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">3.17</span><span class="s0">, </span><span class="s4">0.01</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.17</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.33</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.33</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.49</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">3.49</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.65</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.65</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.81</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.81</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">3.97</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">3.97</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.13</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.13</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.29</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">4.29</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.45</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.45</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.61</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.61</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">[</span><span class="s4">4.77</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.77</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.93</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">4.93</span><span class="s0">, </span><span class="s4">0.00</span><span class="s1">]</span><span class="s0">,</span>
    <span class="s1">])</span>

    <span class="s1">minx = np.min(verts[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>
    <span class="s1">miny = np.min(verts[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">maxx = np.max(verts[:</span><span class="s0">, </span><span class="s4">0</span><span class="s1">])</span>
    <span class="s1">maxy = np.max(verts[:</span><span class="s0">, </span><span class="s4">1</span><span class="s1">])</span>

    <span class="s1">p = mpath.Path(verts)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.add_patch(mpatches.PathPatch(p))</span>
    <span class="s1">ax.autoscale()</span>

    <span class="s0">assert </span><span class="s1">ax.get_xlim()[</span><span class="s4">0</span><span class="s1">] &lt;= minx</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim()[</span><span class="s4">1</span><span class="s1">] &gt;= maxx</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim()[</span><span class="s4">0</span><span class="s1">] &lt;= miny</span>
    <span class="s0">assert </span><span class="s1">ax.get_ylim()[</span><span class="s4">1</span><span class="s1">] &gt;= maxy</span>


<span class="s0">def </span><span class="s1">test_get_xticklabel():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s0">for </span><span class="s1">ind </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">):</span>
        <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[ind].get_text() == </span><span class="s3">f'</span><span class="s0">{</span><span class="s1">ind</span><span class="s0">}</span><span class="s3">'</span>
        <span class="s0">assert </span><span class="s1">ax.get_yticklabels()[ind].get_text() == </span><span class="s3">f'</span><span class="s0">{</span><span class="s1">ind</span><span class="s0">}</span><span class="s3">'</span>


<span class="s0">def </span><span class="s1">test_bar_leading_nan():</span>

    <span class="s1">barx = np.arange(</span><span class="s4">3</span><span class="s0">, </span><span class="s1">dtype=float)</span>
    <span class="s1">barheights = np.array([</span><span class="s4">0.5</span><span class="s0">, </span><span class="s4">1.5</span><span class="s0">, </span><span class="s4">2.0</span><span class="s1">])</span>
    <span class="s1">barstarts = np.array([</span><span class="s4">0.77</span><span class="s1">]*</span><span class="s4">3</span><span class="s1">)</span>

    <span class="s1">barx[</span><span class="s4">0</span><span class="s1">] = np.NaN</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">bars = ax.bar(barx</span><span class="s0">, </span><span class="s1">barheights</span><span class="s0">, </span><span class="s1">bottom=barstarts)</span>

    <span class="s1">hbars = ax.barh(barx</span><span class="s0">, </span><span class="s1">barheights</span><span class="s0">, </span><span class="s1">left=barstarts)</span>

    <span class="s0">for </span><span class="s1">bar_set </span><span class="s0">in </span><span class="s1">(bars</span><span class="s0">, </span><span class="s1">hbars):</span>
        <span class="s2"># the first bar should have a nan in the location</span>
        <span class="s1">nanful</span><span class="s0">, </span><span class="s1">*rest = bar_set</span>
        <span class="s0">assert </span><span class="s1">(~np.isfinite(nanful.xy)).any()</span>
        <span class="s0">assert </span><span class="s1">np.isfinite(nanful.get_width())</span>
        <span class="s0">for </span><span class="s1">b </span><span class="s0">in </span><span class="s1">rest:</span>
            <span class="s0">assert </span><span class="s1">np.isfinite(b.xy).all()</span>
            <span class="s0">assert </span><span class="s1">np.isfinite(b.get_width())</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_bar_all_nan(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">mpl.style.use(</span><span class="s3">&quot;mpl20&quot;</span><span class="s1">)</span>
    <span class="s1">ax_test = fig_test.subplots()</span>
    <span class="s1">ax_ref = fig_ref.subplots()</span>

    <span class="s1">ax_test.bar([np.nan]</span><span class="s0">, </span><span class="s1">[np.nan])</span>
    <span class="s1">ax_test.bar([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">])</span>

    <span class="s1">ax_ref.bar([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">]).remove()</span>
    <span class="s1">ax_ref.bar([</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s4">1</span><span class="s1">])</span>


<span class="s1">@image_comparison([</span><span class="s3">&quot;extent_units.png&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">&quot;mpl20&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_extent_units():</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s4">2</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">date_first = np.datetime64(</span><span class="s3">'2020-01-01'</span><span class="s0">, </span><span class="s3">'D'</span><span class="s1">)</span>
    <span class="s1">date_last = np.datetime64(</span><span class="s3">'2020-01-11'</span><span class="s0">, </span><span class="s3">'D'</span><span class="s1">)</span>
    <span class="s1">arr = [[i+j </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)] </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">10</span><span class="s1">)]</span>

    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].set_title(</span><span class="s3">'Date extents on y axis'</span><span class="s1">)</span>
    <span class="s1">im = axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].imshow(arr</span><span class="s0">, </span><span class="s1">origin=</span><span class="s3">'lower'</span><span class="s0">,</span>
                          <span class="s1">extent=[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">11</span><span class="s0">, </span><span class="s1">date_first</span><span class="s0">, </span><span class="s1">date_last]</span><span class="s0">,</span>
                          <span class="s1">cmap=mpl.colormaps[</span><span class="s3">&quot;plasma&quot;</span><span class="s1">])</span>

    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].set_title(</span><span class="s3">'Date extents on x axis (Day of Jan 2020)'</span><span class="s1">)</span>
    <span class="s1">im = axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].imshow(arr</span><span class="s0">, </span><span class="s1">origin=</span><span class="s3">'lower'</span><span class="s0">,</span>
                          <span class="s1">extent=[date_first</span><span class="s0">, </span><span class="s1">date_last</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s4">11</span><span class="s1">]</span><span class="s0">,</span>
                          <span class="s1">cmap=mpl.colormaps[</span><span class="s3">&quot;plasma&quot;</span><span class="s1">])</span>
    <span class="s1">axs[</span><span class="s4">0</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].xaxis.set_major_formatter(mdates.DateFormatter(</span><span class="s3">'%d'</span><span class="s1">))</span>

    <span class="s1">im = axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].imshow(arr</span><span class="s0">, </span><span class="s1">origin=</span><span class="s3">'lower'</span><span class="s0">,</span>
                          <span class="s1">extent=[date_first</span><span class="s0">, </span><span class="s1">date_last</span><span class="s0">,</span>
                                  <span class="s1">date_first</span><span class="s0">, </span><span class="s1">date_last]</span><span class="s0">,</span>
                          <span class="s1">cmap=mpl.colormaps[</span><span class="s3">&quot;plasma&quot;</span><span class="s1">])</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].xaxis.set_major_formatter(mdates.DateFormatter(</span><span class="s3">'%d'</span><span class="s1">))</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">0</span><span class="s1">].set(xlabel=</span><span class="s3">'Day of Jan 2020'</span><span class="s1">)</span>

    <span class="s1">im = axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].imshow(arr</span><span class="s0">, </span><span class="s1">origin=</span><span class="s3">'lower'</span><span class="s0">,</span>
                          <span class="s1">cmap=mpl.colormaps[</span><span class="s3">&quot;plasma&quot;</span><span class="s1">])</span>
    <span class="s1">im.set_extent([date_last</span><span class="s0">, </span><span class="s1">date_first</span><span class="s0">, </span><span class="s1">date_last</span><span class="s0">, </span><span class="s1">date_first])</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].xaxis.set_major_formatter(mdates.DateFormatter(</span><span class="s3">'%d'</span><span class="s1">))</span>
    <span class="s1">axs[</span><span class="s4">1</span><span class="s0">, </span><span class="s4">1</span><span class="s1">].set(xlabel=</span><span class="s3">'Day of Jan 2020'</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s3">r&quot;set_extent\(\) got an unexpected&quot;</span><span class="s1">):</span>
        <span class="s1">im.set_extent([</span><span class="s4">2</span><span class="s0">, </span><span class="s4">12</span><span class="s0">, </span><span class="s1">date_first</span><span class="s0">, </span><span class="s1">date_last]</span><span class="s0">, </span><span class="s1">clip=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_cla_clears_children_axes_and_fig():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">lines = ax.plot([]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">img = ax.imshow([[</span><span class="s4">1</span><span class="s1">]])</span>
    <span class="s0">for </span><span class="s1">art </span><span class="s0">in </span><span class="s1">lines + [img]:</span>
        <span class="s0">assert </span><span class="s1">art.axes </span><span class="s0">is </span><span class="s1">ax</span>
        <span class="s0">assert </span><span class="s1">art.figure </span><span class="s0">is </span><span class="s1">fig</span>
    <span class="s1">ax.clear()</span>
    <span class="s0">for </span><span class="s1">art </span><span class="s0">in </span><span class="s1">lines + [img]:</span>
        <span class="s0">assert </span><span class="s1">art.axes </span><span class="s0">is None</span>
        <span class="s0">assert </span><span class="s1">art.figure </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_scatter_color_repr_error():</span>

    <span class="s0">def </span><span class="s1">get_next_color():</span>
        <span class="s0">return </span><span class="s3">'blue'  </span><span class="s2"># pragma: no cover</span>
    <span class="s1">msg = (</span>
            <span class="s3">r&quot;'c' argument must be a color, a sequence of colors&quot;</span>
            <span class="s3">r&quot;, or a sequence of numbers, not 'red\\n'&quot;</span>
        <span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">c = </span><span class="s3">'red</span><span class="s0">\n</span><span class="s3">'</span>
        <span class="s1">mpl.axes.Axes._parse_scatter_color_args(</span>
            <span class="s1">c</span><span class="s0">, None, </span><span class="s1">kwargs={}</span><span class="s0">, </span><span class="s1">xsize=</span><span class="s4">2</span><span class="s0">, </span><span class="s1">get_next_color_func=get_next_color)</span>


<span class="s0">def </span><span class="s1">test_zorder_and_explicit_rasterization():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_rasterization_zorder(</span><span class="s4">5</span><span class="s1">)</span>
    <span class="s1">ln</span><span class="s0">, </span><span class="s1">= ax.plot(range(</span><span class="s4">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">rasterized=</span><span class="s0">True, </span><span class="s1">zorder=</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">io.BytesIO() </span><span class="s0">as </span><span class="s1">b:</span>
        <span class="s1">fig.savefig(b</span><span class="s0">, </span><span class="s1">format=</span><span class="s3">'pdf'</span><span class="s1">)</span>
</pre>
</body>
</html>