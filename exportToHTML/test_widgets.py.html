<html>
<head>
<title>test_widgets.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_widgets.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">functools</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">from </span><span class="s1">unittest </span><span class="s0">import </span><span class="s1">mock</span>

<span class="s0">from </span><span class="s1">matplotlib._api.deprecation </span><span class="s0">import </span><span class="s1">MatplotlibDeprecationWarning</span>
<span class="s0">from </span><span class="s1">matplotlib.backend_bases </span><span class="s0">import </span><span class="s1">MouseEvent</span>
<span class="s0">import </span><span class="s1">matplotlib.colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">matplotlib.widgets </span><span class="s0">as </span><span class="s1">widgets</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib.patches </span><span class="s0">import </span><span class="s1">Rectangle</span>
<span class="s0">from </span><span class="s1">matplotlib.lines </span><span class="s0">import </span><span class="s1">Line2D</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s0">, </span><span class="s1">image_comparison</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.widgets </span><span class="s0">import </span><span class="s1">(click_and_drag</span><span class="s0">, </span><span class="s1">do_event</span><span class="s0">, </span><span class="s1">get_ax</span><span class="s0">,</span>
                                        <span class="s1">mock_event</span><span class="s0">, </span><span class="s1">noop)</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">assert_allclose</span>

<span class="s0">import </span><span class="s1">pytest</span>


<span class="s1">@pytest.fixture</span>
<span class="s0">def </span><span class="s1">ax():</span>
    <span class="s0">return </span><span class="s1">get_ax()</span>


<span class="s0">def </span><span class="s1">test_save_blitted_widget_as_pdf():</span>
    <span class="s0">from </span><span class="s1">matplotlib.widgets </span><span class="s0">import </span><span class="s1">CheckButtons</span><span class="s0">, </span><span class="s1">RadioButtons</span>
    <span class="s0">from </span><span class="s1">matplotlib.cbook </span><span class="s0">import </span><span class="s1">_get_running_interactive_framework</span>
    <span class="s0">if </span><span class="s1">_get_running_interactive_framework() </span><span class="s0">not in </span><span class="s1">[</span><span class="s2">'headless'</span><span class="s0">, None</span><span class="s1">]:</span>
        <span class="s1">pytest.xfail(</span><span class="s2">&quot;Callback exceptions are not raised otherwise.&quot;</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span>
        <span class="s1">nrows=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">width_ratios=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">default_rb = RadioButtons(ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'Apples'</span><span class="s0">, </span><span class="s2">'Oranges'</span><span class="s1">])</span>
    <span class="s1">styled_rb = RadioButtons(</span>
        <span class="s1">ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'Apples'</span><span class="s0">, </span><span class="s2">'Oranges'</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">label_props={</span><span class="s2">'color'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'orange'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s2">'fontsize'</span><span class="s1">: [</span><span class="s3">16</span><span class="s0">, </span><span class="s3">20</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">radio_props={</span><span class="s2">'edgecolor'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'orange'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s2">'facecolor'</span><span class="s1">: [</span><span class="s2">'mistyrose'</span><span class="s0">, </span><span class="s2">'peachpuff'</span><span class="s1">]}</span>
    <span class="s1">)</span>

    <span class="s1">default_cb = CheckButtons(ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'Apples'</span><span class="s0">, </span><span class="s2">'Oranges'</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">actives=[</span><span class="s0">True, True</span><span class="s1">])</span>
    <span class="s1">styled_cb = CheckButtons(</span>
        <span class="s1">ax[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'Apples'</span><span class="s0">, </span><span class="s2">'Oranges'</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">actives=[</span><span class="s0">True, True</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">label_props={</span><span class="s2">'color'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'orange'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s2">'fontsize'</span><span class="s1">: [</span><span class="s3">16</span><span class="s0">, </span><span class="s3">20</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">frame_props={</span><span class="s2">'edgecolor'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'orange'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s2">'facecolor'</span><span class="s1">: [</span><span class="s2">'mistyrose'</span><span class="s0">, </span><span class="s2">'peachpuff'</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">check_props={</span><span class="s2">'color'</span><span class="s1">: [</span><span class="s2">'darkred'</span><span class="s0">, </span><span class="s2">'darkorange'</span><span class="s1">]}</span>
    <span class="s1">)</span>

    <span class="s1">ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">].set_title(</span><span class="s2">'Default'</span><span class="s1">)</span>
    <span class="s1">ax[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">].set_title(</span><span class="s2">'Stylized'</span><span class="s1">)</span>
    <span class="s4"># force an Agg render</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s4"># force a pdf save</span>
    <span class="s0">with </span><span class="s1">io.BytesIO() </span><span class="s0">as </span><span class="s1">result_after:</span>
        <span class="s1">fig.savefig(result_after</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">'pdf'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'kwargs'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">dict()</span><span class="s0">,</span>
    <span class="s1">dict(useblit=</span><span class="s0">True, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">dict(minspanx=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">minspany=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">spancoords=</span><span class="s2">'pixels'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">dict(props=dict(fill=</span><span class="s0">True</span><span class="s1">))</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_selector(ax</span><span class="s0">, </span><span class="s1">kwargs):</span>
    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">199</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">199</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s4"># purposely drag outside of axis for release</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">250</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">250</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">kwargs.get(</span><span class="s2">'drawtype'</span><span class="s0">, None</span><span class="s1">) </span><span class="s0">not in </span><span class="s1">[</span><span class="s2">'line'</span><span class="s0">, </span><span class="s2">'none'</span><span class="s1">]:</span>
        <span class="s1">assert_allclose(tool.geometry</span><span class="s0">,</span>
                        <span class="s1">[[</span><span class="s3">100.</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">199</span><span class="s0">, </span><span class="s3">199</span><span class="s0">, </span><span class="s3">100</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">[</span><span class="s3">100</span><span class="s0">, </span><span class="s3">199</span><span class="s0">, </span><span class="s3">199</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">]]</span><span class="s0">,</span>
                        <span class="s1">err_msg=tool.geometry)</span>

    <span class="s1">onselect.assert_called_once()</span>
    <span class="s1">(epress</span><span class="s0">, </span><span class="s1">erelease)</span><span class="s0">, </span><span class="s1">kwargs = onselect.call_args</span>
    <span class="s0">assert </span><span class="s1">epress.xdata == </span><span class="s3">100</span>
    <span class="s0">assert </span><span class="s1">epress.ydata == </span><span class="s3">100</span>
    <span class="s0">assert </span><span class="s1">erelease.xdata == </span><span class="s3">199</span>
    <span class="s0">assert </span><span class="s1">erelease.ydata == </span><span class="s3">199</span>
    <span class="s0">assert </span><span class="s1">kwargs == {}</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'spancoords'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'data'</span><span class="s0">, </span><span class="s2">'pixels'</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'minspanx, x1'</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">10.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">11</span><span class="s1">]])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'minspany, y1'</span><span class="s0">, </span><span class="s1">[[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">10.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">11</span><span class="s1">]])</span>
<span class="s0">def </span><span class="s1">test_rectangle_minspan(ax</span><span class="s0">, </span><span class="s1">spancoords</span><span class="s0">, </span><span class="s1">minspanx</span><span class="s0">, </span><span class="s1">x1</span><span class="s0">, </span><span class="s1">minspany</span><span class="s0">, </span><span class="s1">y1):</span>

    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">x0</span><span class="s0">, </span><span class="s1">y0 = (</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">spancoords == </span><span class="s2">'pixels'</span><span class="s1">:</span>
        <span class="s1">minspanx</span><span class="s0">, </span><span class="s1">minspany = (ax.transData.transform((x1</span><span class="s0">, </span><span class="s1">y1)) -</span>
                              <span class="s1">ax.transData.transform((x0</span><span class="s0">, </span><span class="s1">y0)))</span>

    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True,</span>
                                     <span class="s1">spancoords=spancoords</span><span class="s0">,</span>
                                     <span class="s1">minspanx=minspanx</span><span class="s0">, </span><span class="s1">minspany=minspany)</span>
    <span class="s4"># Too small to create a selector</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(x0</span><span class="s0">, </span><span class="s1">x1)</span><span class="s0">, </span><span class="s1">end=(y0</span><span class="s0">, </span><span class="s1">y1))</span>
    <span class="s0">assert not </span><span class="s1">tool._selection_completed</span>
    <span class="s1">onselect.assert_not_called()</span>

    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool._selection_completed</span>
    <span class="s1">onselect.assert_called_once()</span>

    <span class="s4"># Too small to create a selector. Should clear existing selector, and</span>
    <span class="s4"># trigger onselect because there was a preexisting selector</span>
    <span class="s1">onselect.reset_mock()</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(x0</span><span class="s0">, </span><span class="s1">y0)</span><span class="s0">, </span><span class="s1">end=(x1</span><span class="s0">, </span><span class="s1">y1))</span>
    <span class="s0">assert not </span><span class="s1">tool._selection_completed</span>
    <span class="s1">onselect.assert_called_once()</span>
    <span class="s1">(epress</span><span class="s0">, </span><span class="s1">erelease)</span><span class="s0">, </span><span class="s1">kwargs = onselect.call_args</span>
    <span class="s0">assert </span><span class="s1">epress.xdata == x0</span>
    <span class="s0">assert </span><span class="s1">epress.ydata == y0</span>
    <span class="s0">assert </span><span class="s1">erelease.xdata == x1</span>
    <span class="s0">assert </span><span class="s1">erelease.ydata == y1</span>
    <span class="s0">assert </span><span class="s1">kwargs == {}</span>


<span class="s0">def </span><span class="s1">test_deprecation_selector_visible_attribute(ax):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, lambda </span><span class="s1">*args: </span><span class="s0">None</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">tool.get_visible()</span>

    <span class="s0">with </span><span class="s1">pytest.warns(</span>
        <span class="s1">MatplotlibDeprecationWarning</span><span class="s0">,</span>
            <span class="s1">match=</span><span class="s2">&quot;was deprecated in Matplotlib 3.6&quot;</span><span class="s1">):</span>
        <span class="s1">tool.visible = </span><span class="s0">False</span>
    <span class="s0">assert not </span><span class="s1">tool.get_visible()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'drag_from_anywhere, new_center'</span><span class="s0">,</span>
                         <span class="s1">[[</span><span class="s0">True, </span><span class="s1">(</span><span class="s3">60</span><span class="s0">, </span><span class="s3">75</span><span class="s1">)]</span><span class="s0">,</span>
                          <span class="s1">[</span><span class="s0">False, </span><span class="s1">(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)]])</span>
<span class="s0">def </span><span class="s1">test_rectangle_drag(ax</span><span class="s0">, </span><span class="s1">drag_from_anywhere</span><span class="s0">, </span><span class="s1">new_center):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True,</span>
                                     <span class="s1">drag_from_anywhere=drag_from_anywhere)</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.center == (</span><span class="s3">50</span><span class="s0">, </span><span class="s3">65</span><span class="s1">)</span>
    <span class="s4"># Drag inside rectangle, but away from centre handle</span>
    <span class="s4">#</span>
    <span class="s4"># If drag_from_anywhere == True, this will move the rectangle by (10, 10),</span>
    <span class="s4"># giving it a new center of (60, 75)</span>
    <span class="s4">#</span>
    <span class="s4"># If drag_from_anywhere == False, this will create a new rectangle with</span>
    <span class="s4"># center (30, 20)</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">25</span><span class="s0">, </span><span class="s3">15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">35</span><span class="s0">, </span><span class="s3">25</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.center == new_center</span>
    <span class="s4"># Check that in both cases, dragging outside the rectangle draws a new</span>
    <span class="s4"># rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">175</span><span class="s0">, </span><span class="s3">185</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">185</span><span class="s0">, </span><span class="s3">195</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.center == (</span><span class="s3">180</span><span class="s0">, </span><span class="s3">190</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_rectangle_selector_set_props_handle_props(ax):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True,</span>
                                     <span class="s1">props=dict(facecolor=</span><span class="s2">'b'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">,</span>
                                     <span class="s1">handle_props=dict(alpha=</span><span class="s3">0.5</span><span class="s1">))</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>

    <span class="s1">artist = tool._selection_artist</span>
    <span class="s0">assert </span><span class="s1">artist.get_facecolor() == mcolors.to_rgba(</span><span class="s2">'b'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">tool.set_props(facecolor=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">artist.get_facecolor() == mcolors.to_rgba(</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.3</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool._handles_artists:</span>
        <span class="s0">assert </span><span class="s1">artist.get_markeredgecolor() == </span><span class="s2">'black'</span>
        <span class="s0">assert </span><span class="s1">artist.get_alpha() == </span><span class="s3">0.5</span>
    <span class="s1">tool.set_handle_props(markeredgecolor=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool._handles_artists:</span>
        <span class="s0">assert </span><span class="s1">artist.get_markeredgecolor() == </span><span class="s2">'r'</span>
        <span class="s0">assert </span><span class="s1">artist.get_alpha() == </span><span class="s3">0.3</span>


<span class="s0">def </span><span class="s1">test_rectangle_resize(ax):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">100.0</span><span class="s0">, </span><span class="s3">10.0</span><span class="s0">, </span><span class="s3">120.0</span><span class="s1">)</span>

    <span class="s4"># resize NE handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + </span><span class="s3">10</span><span class="s0">, </span><span class="s1">ydata + </span><span class="s3">5</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ydata_new)</span>

    <span class="s4"># resize E handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + </span><span class="s3">10</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s4"># resize W handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + </span><span class="s3">15</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s4"># resize SW handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + </span><span class="s3">20</span><span class="s0">, </span><span class="s1">ydata + </span><span class="s3">25</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ydata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_rectangle_add_state(ax):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">70</span><span class="s0">, </span><span class="s3">65</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">125</span><span class="s0">, </span><span class="s3">130</span><span class="s1">))</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">tool.add_state(</span><span class="s2">'unsupported_state'</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">tool.add_state(</span><span class="s2">'clear'</span><span class="s1">)</span>
    <span class="s1">tool.add_state(</span><span class="s2">'move'</span><span class="s1">)</span>
    <span class="s1">tool.add_state(</span><span class="s2">'square'</span><span class="s1">)</span>
    <span class="s1">tool.add_state(</span><span class="s2">'center'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'add_state'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_resize_center(ax</span><span class="s0">, </span><span class="s1">add_state):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">70</span><span class="s0">, </span><span class="s3">65</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">125</span><span class="s0">, </span><span class="s3">130</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">70.0</span><span class="s0">, </span><span class="s3">125.0</span><span class="s0">, </span><span class="s3">65.0</span><span class="s0">, </span><span class="s3">130.0</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">add_state:</span>
        <span class="s1">tool.add_state(</span><span class="s2">'center'</span><span class="s1">)</span>
        <span class="s1">use_key = </span><span class="s0">None</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">use_key = </span><span class="s2">'control'</span>

    <span class="s4"># resize NE handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">xdiff</span><span class="s0">, </span><span class="s1">ydiff = </span><span class="s3">10</span><span class="s0">, </span><span class="s3">5</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata + ydiff</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">] - ydiff</span><span class="s0">, </span><span class="s1">ydata_new)</span>

    <span class="s4"># resize E handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = </span><span class="s3">10</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s4"># resize E handle negative diff</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = -</span><span class="s3">20</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s4"># resize W handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = </span><span class="s3">15</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">] - xdiff</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s4"># resize W handle negative diff</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = -</span><span class="s3">25</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">] - xdiff</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s4"># resize SW handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">xdiff</span><span class="s0">, </span><span class="s1">ydiff = </span><span class="s3">20</span><span class="s0">, </span><span class="s3">25</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata + ydiff</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">] - xdiff</span><span class="s0">,</span>
                            <span class="s1">ydata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] - ydiff)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'add_state'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_resize_square(ax</span><span class="s0">, </span><span class="s1">add_state):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">70</span><span class="s0">, </span><span class="s3">65</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">120</span><span class="s0">, </span><span class="s3">115</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">70.0</span><span class="s0">, </span><span class="s3">120.0</span><span class="s0">, </span><span class="s3">65.0</span><span class="s0">, </span><span class="s3">115.0</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">add_state:</span>
        <span class="s1">tool.add_state(</span><span class="s2">'square'</span><span class="s1">)</span>
        <span class="s1">use_key = </span><span class="s0">None</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">use_key = </span><span class="s2">'shift'</span>

    <span class="s4"># resize NE handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">xdiff</span><span class="s0">, </span><span class="s1">ydiff = </span><span class="s3">10</span><span class="s0">, </span><span class="s3">5</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata + ydiff</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] + xdiff)</span>

    <span class="s4"># resize E handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = </span><span class="s3">10</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] + xdiff)</span>

    <span class="s4"># resize E handle negative diff</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = -</span><span class="s3">20</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] + xdiff)</span>

    <span class="s4"># resize W handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = </span><span class="s3">15</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] - xdiff)</span>

    <span class="s4"># resize W handle negative diff</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = -</span><span class="s3">25</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] - xdiff)</span>

    <span class="s4"># resize SW handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">xdiff</span><span class="s0">, </span><span class="s1">ydiff = </span><span class="s3">20</span><span class="s0">, </span><span class="s3">25</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata + ydiff</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new)</span><span class="s0">,</span>
                   <span class="s1">key=use_key)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (extents[</span><span class="s3">0</span><span class="s1">] + ydiff</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">,</span>
                            <span class="s1">ydata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_rectangle_resize_square_center(ax):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">70</span><span class="s0">, </span><span class="s3">65</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">120</span><span class="s0">, </span><span class="s3">115</span><span class="s1">))</span>
    <span class="s1">tool.add_state(</span><span class="s2">'square'</span><span class="s1">)</span>
    <span class="s1">tool.add_state(</span><span class="s2">'center'</span><span class="s1">)</span>
    <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">(</span><span class="s3">70.0</span><span class="s0">, </span><span class="s3">120.0</span><span class="s0">, </span><span class="s3">65.0</span><span class="s0">, </span><span class="s3">115.0</span><span class="s1">))</span>

    <span class="s4"># resize NE handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">xdiff</span><span class="s0">, </span><span class="s1">ydiff = </span><span class="s3">10</span><span class="s0">, </span><span class="s3">5</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata + ydiff</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">(extents[</span><span class="s3">0</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                                   <span class="s1">extents[</span><span class="s3">2</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] + xdiff))</span>

    <span class="s4"># resize E handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = </span><span class="s3">10</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">(extents[</span><span class="s3">0</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                                   <span class="s1">extents[</span><span class="s3">2</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] + xdiff))</span>

    <span class="s4"># resize E handle negative diff</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = -</span><span class="s3">20</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">(extents[</span><span class="s3">0</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                                   <span class="s1">extents[</span><span class="s3">2</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] + xdiff))</span>

    <span class="s4"># resize W handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = </span><span class="s3">5</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">(xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">] - xdiff</span><span class="s0">,</span>
                                   <span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + xdiff</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] - xdiff))</span>

    <span class="s4"># resize W handle negative diff</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
    <span class="s1">xdiff = -</span><span class="s3">25</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">(xdata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">] - xdiff</span><span class="s0">,</span>
                                   <span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + xdiff</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] - xdiff))</span>

    <span class="s4"># resize SW handle</span>
    <span class="s1">extents = tool.extents</span>
    <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">xdiff</span><span class="s0">, </span><span class="s1">ydiff = </span><span class="s3">20</span><span class="s0">, </span><span class="s3">25</span>
    <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata + ydiff</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
    <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">(extents[</span><span class="s3">0</span><span class="s1">] + ydiff</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">] - ydiff</span><span class="s0">,</span>
                                   <span class="s1">ydata_new</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">] - ydiff))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'selector_class'</span><span class="s0">,</span>
                         <span class="s1">[widgets.RectangleSelector</span><span class="s0">, </span><span class="s1">widgets.EllipseSelector])</span>
<span class="s0">def </span><span class="s1">test_rectangle_rotate(ax</span><span class="s0">, </span><span class="s1">selector_class):</span>
    <span class="s1">tool = selector_class(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># Draw rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">130</span><span class="s0">, </span><span class="s3">140</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">130</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">140</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(tool._state) == </span><span class="s3">0</span>

    <span class="s4"># Rotate anticlockwise using top-right corner</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">tool._state == set([</span><span class="s2">'rotate'</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">len(tool._state) == </span><span class="s3">1</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">130</span><span class="s0">, </span><span class="s3">140</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">120</span><span class="s0">, </span><span class="s3">145</span><span class="s1">))</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(tool._state) == </span><span class="s3">0</span>
    <span class="s4"># Extents shouldn't change (as shape of rectangle hasn't changed)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">130</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">140</span><span class="s1">)</span>
    <span class="s1">assert_allclose(tool.rotation</span><span class="s0">, </span><span class="s3">25.56</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">0.01</span><span class="s1">)</span>
    <span class="s1">tool.rotation = </span><span class="s3">45</span>
    <span class="s0">assert </span><span class="s1">tool.rotation == </span><span class="s3">45</span>
    <span class="s4"># Corners should move</span>
    <span class="s1">assert_allclose(tool.corners</span><span class="s0">,</span>
                    <span class="s1">np.array([[</span><span class="s3">118.53</span><span class="s0">, </span><span class="s3">139.75</span><span class="s0">, </span><span class="s3">111.46</span><span class="s0">, </span><span class="s3">90.25</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">[</span><span class="s3">95.25</span><span class="s0">, </span><span class="s3">116.46</span><span class="s0">, </span><span class="s3">144.75</span><span class="s0">, </span><span class="s3">123.54</span><span class="s1">]])</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">0.01</span><span class="s1">)</span>

    <span class="s4"># Scale using top-right corner</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">110</span><span class="s0">, </span><span class="s3">145</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">110</span><span class="s0">, </span><span class="s3">160</span><span class="s1">))</span>
    <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">139.75</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">151.82</span><span class="s1">)</span><span class="s0">, </span><span class="s1">atol=</span><span class="s3">0.01</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">selector_class == widgets.RectangleSelector:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">tool._selection_artist.rotation_point = </span><span class="s2">'unvalid_value'</span>


<span class="s0">def </span><span class="s1">test_rectangle_add_remove_set(ax):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s4"># Draw rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">130</span><span class="s0">, </span><span class="s3">140</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">130</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">140</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(tool._state) == </span><span class="s3">0</span>
    <span class="s0">for </span><span class="s1">state </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'rotate'</span><span class="s0">, </span><span class="s2">'square'</span><span class="s0">, </span><span class="s2">'center'</span><span class="s1">]:</span>
        <span class="s1">tool.add_state(state)</span>
        <span class="s0">assert </span><span class="s1">len(tool._state) == </span><span class="s3">1</span>
        <span class="s1">tool.remove_state(state)</span>
        <span class="s0">assert </span><span class="s1">len(tool._state) == </span><span class="s3">0</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'use_data_coordinates'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_resize_square_center_aspect(ax</span><span class="s0">, </span><span class="s1">use_data_coordinates):</span>
    <span class="s1">ax.set_aspect(</span><span class="s3">0.8</span><span class="s1">)</span>

    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True,</span>
                                     <span class="s1">use_data_coordinates=use_data_coordinates)</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">70</span><span class="s0">, </span><span class="s3">65</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">120</span><span class="s0">, </span><span class="s3">115</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">70.0</span><span class="s0">, </span><span class="s3">120.0</span><span class="s0">, </span><span class="s3">65.0</span><span class="s0">, </span><span class="s3">115.0</span><span class="s1">)</span>
    <span class="s1">tool.add_state(</span><span class="s2">'square'</span><span class="s1">)</span>
    <span class="s1">tool.add_state(</span><span class="s2">'center'</span><span class="s1">)</span>

    <span class="s0">if </span><span class="s1">use_data_coordinates:</span>
        <span class="s4"># resize E handle</span>
        <span class="s1">extents = tool.extents</span>
        <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata</span><span class="s0">, </span><span class="s1">width = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">1</span><span class="s1">] - extents[</span><span class="s3">0</span><span class="s1">]</span>
        <span class="s1">xdiff</span><span class="s0">, </span><span class="s1">ycenter = </span><span class="s3">10</span><span class="s0">,  </span><span class="s1">extents[</span><span class="s3">2</span><span class="s1">] + (extents[</span><span class="s3">3</span><span class="s1">] - extents[</span><span class="s3">2</span><span class="s1">]) / </span><span class="s3">2</span>
        <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
        <span class="s1">ychange = width / </span><span class="s3">2 </span><span class="s1">+ xdiff</span>
        <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
        <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">[extents[</span><span class="s3">0</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                                       <span class="s1">ycenter - ychange</span><span class="s0">, </span><span class="s1">ycenter + ychange])</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s4"># resize E handle</span>
        <span class="s1">extents = tool.extents</span>
        <span class="s1">xdata</span><span class="s0">, </span><span class="s1">ydata = extents[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extents[</span><span class="s3">3</span><span class="s1">]</span>
        <span class="s1">xdiff = </span><span class="s3">10</span>
        <span class="s1">xdata_new</span><span class="s0">, </span><span class="s1">ydata_new = xdata + xdiff</span><span class="s0">, </span><span class="s1">ydata</span>
        <span class="s1">ychange = xdiff * </span><span class="s3">1 </span><span class="s1">/ tool._aspect_ratio_correction</span>
        <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(xdata</span><span class="s0">, </span><span class="s1">ydata)</span><span class="s0">, </span><span class="s1">end=(xdata_new</span><span class="s0">, </span><span class="s1">ydata_new))</span>
        <span class="s1">assert_allclose(tool.extents</span><span class="s0">, </span><span class="s1">[extents[</span><span class="s3">0</span><span class="s1">] - xdiff</span><span class="s0">, </span><span class="s1">xdata_new</span><span class="s0">,</span>
                                       <span class="s3">46.25</span><span class="s0">, </span><span class="s3">133.75</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_ellipse(ax):</span>
    <span class="s5">&quot;&quot;&quot;For ellipse, test out the key modifiers&quot;&quot;&quot;</span>
    <span class="s1">tool = widgets.EllipseSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">,</span>
                                   <span class="s1">grab_range=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">tool.extents = (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span>

    <span class="s4"># drag the rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">125</span><span class="s0">, </span><span class="s3">125</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">145</span><span class="s0">, </span><span class="s3">145</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">120</span><span class="s0">, </span><span class="s3">170</span><span class="s0">, </span><span class="s3">120</span><span class="s0">, </span><span class="s3">170</span><span class="s1">)</span>

    <span class="s4"># create from center</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">125</span><span class="s0">, </span><span class="s3">125</span><span class="s1">)</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">'control'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">75</span><span class="s0">, </span><span class="s3">125</span><span class="s0">, </span><span class="s3">75</span><span class="s0">, </span><span class="s3">125</span><span class="s1">)</span>

    <span class="s4"># create a square</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">35</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">'shift'</span><span class="s1">)</span>
    <span class="s1">extents = [int(e) </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">tool.extents]</span>
    <span class="s0">assert </span><span class="s1">extents == [</span><span class="s3">10</span><span class="s0">, </span><span class="s3">35</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">35</span><span class="s1">]</span>

    <span class="s4"># create a square from center</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">125</span><span class="s0">, </span><span class="s3">130</span><span class="s1">)</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">'ctrl+shift'</span><span class="s1">)</span>
    <span class="s1">extents = [int(e) </span><span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">tool.extents]</span>
    <span class="s0">assert </span><span class="s1">extents == [</span><span class="s3">70</span><span class="s0">, </span><span class="s3">130</span><span class="s0">, </span><span class="s3">70</span><span class="s0">, </span><span class="s3">130</span><span class="s1">]</span>

    <span class="s0">assert </span><span class="s1">tool.geometry.shape == (</span><span class="s3">2</span><span class="s0">, </span><span class="s3">73</span><span class="s1">)</span>
    <span class="s1">assert_allclose(tool.geometry[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">70.</span><span class="s0">, </span><span class="s3">100</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_rectangle_handles(ax):</span>
    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">,</span>
                                     <span class="s1">grab_range=</span><span class="s3">10</span><span class="s0">,</span>
                                     <span class="s1">interactive=</span><span class="s0">True,</span>
                                     <span class="s1">handle_props={</span><span class="s2">'markerfacecolor'</span><span class="s1">: </span><span class="s2">'r'</span><span class="s0">,</span>
                                                   <span class="s2">'markeredgecolor'</span><span class="s1">: </span><span class="s2">'b'</span><span class="s1">})</span>
    <span class="s1">tool.extents = (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span>

    <span class="s1">assert_allclose(tool.corners</span><span class="s0">, </span><span class="s1">((</span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span>
    <span class="s1">assert_allclose(tool.edge_centers</span><span class="s0">,</span>
                    <span class="s1">((</span><span class="s3">100</span><span class="s0">, </span><span class="s3">125.0</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">125.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">125.0</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">125.0</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span>

    <span class="s4"># grab a corner and move it</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">120</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">120</span><span class="s0">, </span><span class="s3">150</span><span class="s0">, </span><span class="s3">120</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span>

    <span class="s4"># grab the center and move it</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">132</span><span class="s0">, </span><span class="s3">132</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">120</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">108</span><span class="s0">, </span><span class="s3">138</span><span class="s0">, </span><span class="s3">108</span><span class="s0">, </span><span class="s3">138</span><span class="s1">)</span>

    <span class="s4"># create a new rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>

    <span class="s4"># Check that marker_props worked.</span>
    <span class="s0">assert </span><span class="s1">mcolors.same_color(</span>
        <span class="s1">tool._corner_handles.artists[</span><span class="s3">0</span><span class="s1">].get_markerfacecolor()</span><span class="s0">, </span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">mcolors.same_color(</span>
        <span class="s1">tool._corner_handles.artists[</span><span class="s3">0</span><span class="s1">].get_markeredgecolor()</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'interactive'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_selector_onselect(ax</span><span class="s0">, </span><span class="s1">interactive):</span>
    <span class="s4"># check when press and release events take place at the same position</span>
    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s1">interactive=interactive)</span>
    <span class="s4"># move outside of axis</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">110</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>

    <span class="s1">onselect.assert_called_once()</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100.0</span><span class="s0">, </span><span class="s3">150.0</span><span class="s0">, </span><span class="s3">110.0</span><span class="s0">, </span><span class="s3">120.0</span><span class="s1">)</span>

    <span class="s1">onselect.reset_mock()</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s1">))</span>
    <span class="s1">onselect.assert_called_once()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'ignore_event_outside'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_rectangle_selector_ignore_outside(ax</span><span class="s0">, </span><span class="s1">ignore_event_outside):</span>
    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">,</span>
                                     <span class="s1">ignore_event_outside=ignore_event_outside)</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">110</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>
    <span class="s1">onselect.assert_called_once()</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100.0</span><span class="s0">, </span><span class="s3">150.0</span><span class="s0">, </span><span class="s3">110.0</span><span class="s0">, </span><span class="s3">120.0</span><span class="s1">)</span>

    <span class="s1">onselect.reset_mock()</span>
    <span class="s4"># Trigger event outside of span</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">160</span><span class="s0">, </span><span class="s3">160</span><span class="s1">))</span>
    <span class="s0">if </span><span class="s1">ignore_event_outside:</span>
        <span class="s4"># event have been ignored and span haven't changed.</span>
        <span class="s1">onselect.assert_not_called()</span>
        <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100.0</span><span class="s0">, </span><span class="s3">150.0</span><span class="s0">, </span><span class="s3">110.0</span><span class="s0">, </span><span class="s3">120.0</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s4"># A new shape is created</span>
        <span class="s1">onselect.assert_called_once()</span>
        <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">150.0</span><span class="s0">, </span><span class="s3">160.0</span><span class="s0">, </span><span class="s3">150.0</span><span class="s0">, </span><span class="s3">160.0</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'orientation, onmove_callback, kwargs'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s2">'horizontal'</span><span class="s0">, False, </span><span class="s1">dict(minspan=</span><span class="s3">10</span><span class="s0">, </span><span class="s1">useblit=</span><span class="s0">True</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'vertical'</span><span class="s0">, True, </span><span class="s1">dict(button=</span><span class="s3">1</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'horizontal'</span><span class="s0">, False, </span><span class="s1">dict(props=dict(fill=</span><span class="s0">True</span><span class="s1">)))</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s2">'horizontal'</span><span class="s0">, False, </span><span class="s1">dict(interactive=</span><span class="s0">True</span><span class="s1">))</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_span_selector(ax</span><span class="s0">, </span><span class="s1">orientation</span><span class="s0">, </span><span class="s1">onmove_callback</span><span class="s0">, </span><span class="s1">kwargs):</span>
    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">onmove = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">onmove_callback:</span>
        <span class="s1">kwargs[</span><span class="s2">'onmove_callback'</span><span class="s1">] = onmove</span>

    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s1">orientation</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s4"># move outside of axis</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">199</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">199</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">250</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">250</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">onselect.assert_called_once_with(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">199</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">onmove_callback:</span>
        <span class="s1">onmove.assert_called_once_with(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">199</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'interactive'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_span_selector_onselect(ax</span><span class="s0">, </span><span class="s1">interactive):</span>
    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                <span class="s1">interactive=interactive)</span>
    <span class="s4"># move outside of axis</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">100</span><span class="s1">))</span>
    <span class="s1">onselect.assert_called_once()</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span>

    <span class="s1">onselect.reset_mock()</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s1">))</span>
    <span class="s1">onselect.assert_called_once()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'ignore_event_outside'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_span_selector_ignore_outside(ax</span><span class="s0">, </span><span class="s1">ignore_event_outside):</span>
    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">onmove = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                <span class="s1">onmove_callback=onmove</span><span class="s0">,</span>
                                <span class="s1">ignore_event_outside=ignore_event_outside)</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">125</span><span class="s0">, </span><span class="s3">125</span><span class="s1">))</span>
    <span class="s1">onselect.assert_called_once()</span>
    <span class="s1">onmove.assert_called_once()</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">125</span><span class="s1">)</span>

    <span class="s1">onselect.reset_mock()</span>
    <span class="s1">onmove.reset_mock()</span>
    <span class="s4"># Trigger event outside of span</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">160</span><span class="s0">, </span><span class="s3">160</span><span class="s1">))</span>
    <span class="s0">if </span><span class="s1">ignore_event_outside:</span>
        <span class="s4"># event have been ignored and span haven't changed.</span>
        <span class="s1">onselect.assert_not_called()</span>
        <span class="s1">onmove.assert_not_called()</span>
        <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">100</span><span class="s0">, </span><span class="s3">125</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s4"># A new shape is created</span>
        <span class="s1">onselect.assert_called_once()</span>
        <span class="s1">onmove.assert_called_once()</span>
        <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">150</span><span class="s0">, </span><span class="s3">160</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'drag_from_anywhere'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, False</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_span_selector_drag(ax</span><span class="s0">, </span><span class="s1">drag_from_anywhere):</span>
    <span class="s4"># Create span</span>
    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                <span class="s1">interactive=</span><span class="s0">True,</span>
                                <span class="s1">drag_from_anywhere=drag_from_anywhere)</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s4"># Drag inside span</span>
    <span class="s4">#</span>
    <span class="s4"># If drag_from_anywhere == True, this will move the span by 10,</span>
    <span class="s4"># giving new value extents = 20, 110</span>
    <span class="s4">#</span>
    <span class="s4"># If drag_from_anywhere == False, this will create a new span with</span>
    <span class="s4"># value extents = 25, 35</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">25</span><span class="s0">, </span><span class="s3">15</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">35</span><span class="s0">, </span><span class="s3">25</span><span class="s1">))</span>
    <span class="s0">if </span><span class="s1">drag_from_anywhere:</span>
        <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">20</span><span class="s0">, </span><span class="s3">110</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">25</span><span class="s0">, </span><span class="s3">35</span><span class="s1">)</span>

    <span class="s4"># Check that in both cases, dragging outside the span draws a new span</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">175</span><span class="s0">, </span><span class="s3">185</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">185</span><span class="s0">, </span><span class="s3">195</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">175</span><span class="s0">, </span><span class="s3">185</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_span_selector_direction(ax):</span>
    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                <span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">tool.direction == </span><span class="s2">'horizontal'</span>
    <span class="s0">assert </span><span class="s1">tool._edge_handles.direction == </span><span class="s2">'horizontal'</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">,</span>
                                    <span class="s1">direction=</span><span class="s2">'invalid_direction'</span><span class="s1">)</span>

    <span class="s1">tool.direction = </span><span class="s2">'vertical'</span>
    <span class="s0">assert </span><span class="s1">tool.direction == </span><span class="s2">'vertical'</span>
    <span class="s0">assert </span><span class="s1">tool._edge_handles.direction == </span><span class="s2">'vertical'</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">tool.direction = </span><span class="s2">'invalid_string'</span>


<span class="s0">def </span><span class="s1">test_span_selector_set_props_handle_props(ax):</span>
    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                <span class="s1">interactive=</span><span class="s0">True,</span>
                                <span class="s1">props=dict(facecolor=</span><span class="s2">'b'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">,</span>
                                <span class="s1">handle_props=dict(alpha=</span><span class="s3">0.5</span><span class="s1">))</span>
    <span class="s4"># Create rectangle</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>

    <span class="s1">artist = tool._selection_artist</span>
    <span class="s0">assert </span><span class="s1">artist.get_facecolor() == mcolors.to_rgba(</span><span class="s2">'b'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.2</span><span class="s1">)</span>
    <span class="s1">tool.set_props(facecolor=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">artist.get_facecolor() == mcolors.to_rgba(</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.3</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool._handles_artists:</span>
        <span class="s0">assert </span><span class="s1">artist.get_color() == </span><span class="s2">'b'</span>
        <span class="s0">assert </span><span class="s1">artist.get_alpha() == </span><span class="s3">0.5</span>
    <span class="s1">tool.set_handle_props(color=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool._handles_artists:</span>
        <span class="s0">assert </span><span class="s1">artist.get_color() == </span><span class="s2">'r'</span>
        <span class="s0">assert </span><span class="s1">artist.get_alpha() == </span><span class="s3">0.3</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'selector'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'span'</span><span class="s0">, </span><span class="s2">'rectangle'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_selector_clear(ax</span><span class="s0">, </span><span class="s1">selector):</span>
    <span class="s1">kwargs = dict(ax=ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">if </span><span class="s1">selector == </span><span class="s2">'span'</span><span class="s1">:</span>
        <span class="s1">Selector = widgets.SpanSelector</span>
        <span class="s1">kwargs[</span><span class="s2">'direction'</span><span class="s1">] = </span><span class="s2">'horizontal'</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">Selector = widgets.RectangleSelector</span>

    <span class="s1">tool = Selector(**kwargs)</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>

    <span class="s4"># press-release event outside the selector to clear the selector</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">130</span><span class="s0">, </span><span class="s3">130</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">130</span><span class="s0">, </span><span class="s3">130</span><span class="s1">))</span>
    <span class="s0">assert not </span><span class="s1">tool._selection_completed</span>

    <span class="s1">kwargs[</span><span class="s2">'ignore_event_outside'</span><span class="s1">] = </span><span class="s0">True</span>
    <span class="s1">tool = Selector(**kwargs)</span>
    <span class="s0">assert </span><span class="s1">tool.ignore_event_outside</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>

    <span class="s4"># press-release event outside the selector ignored</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">130</span><span class="s0">, </span><span class="s3">130</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">130</span><span class="s0">, </span><span class="s3">130</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool._selection_completed</span>

    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">'escape'</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">tool._selection_completed</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'selector'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'span'</span><span class="s0">, </span><span class="s2">'rectangle'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_selector_clear_method(ax</span><span class="s0">, </span><span class="s1">selector):</span>
    <span class="s0">if </span><span class="s1">selector == </span><span class="s2">'span'</span><span class="s1">:</span>
        <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                    <span class="s1">interactive=</span><span class="s0">True,</span>
                                    <span class="s1">ignore_event_outside=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">tool = widgets.RectangleSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool._selection_completed</span>
    <span class="s0">assert </span><span class="s1">tool.get_visible()</span>
    <span class="s0">if </span><span class="s1">selector == </span><span class="s2">'span'</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">10</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>

    <span class="s1">tool.clear()</span>
    <span class="s0">assert not </span><span class="s1">tool._selection_completed</span>
    <span class="s0">assert not </span><span class="s1">tool.get_visible()</span>

    <span class="s4"># Do another cycle of events to make sure we can</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">end=(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">120</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">tool._selection_completed</span>
    <span class="s0">assert </span><span class="s1">tool.get_visible()</span>
    <span class="s0">if </span><span class="s1">selector == </span><span class="s2">'span'</span><span class="s1">:</span>
        <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">10</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_span_selector_add_state(ax):</span>
    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">noop</span><span class="s0">, </span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                <span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">tool.add_state(</span><span class="s2">'unsupported_state'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">tool.add_state(</span><span class="s2">'center'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">tool.add_state(</span><span class="s2">'square'</span><span class="s1">)</span>

    <span class="s1">tool.add_state(</span><span class="s2">'move'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_tool_line_handle(ax):</span>
    <span class="s1">positions = [</span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">50</span><span class="s1">]</span>
    <span class="s1">tool_line_handle = widgets.ToolLineHandles(ax</span><span class="s0">, </span><span class="s1">positions</span><span class="s0">, </span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                               <span class="s1">useblit=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool_line_handle.artists:</span>
        <span class="s0">assert not </span><span class="s1">artist.get_animated()</span>
        <span class="s0">assert not </span><span class="s1">artist.get_visible()</span>

    <span class="s1">tool_line_handle.set_visible(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">tool_line_handle.set_animated(</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool_line_handle.artists:</span>
        <span class="s0">assert </span><span class="s1">artist.get_animated()</span>
        <span class="s0">assert </span><span class="s1">artist.get_visible()</span>

    <span class="s0">assert </span><span class="s1">tool_line_handle.positions == positions</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'direction'</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;horizontal&quot;</span><span class="s0">, </span><span class="s2">&quot;vertical&quot;</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_span_selector_bound(direction):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.plot([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">30</span><span class="s1">])</span>
    <span class="s1">ax.figure.canvas.draw()</span>
    <span class="s1">x_bound = ax.get_xbound()</span>
    <span class="s1">y_bound = ax.get_ybound()</span>

    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">print</span><span class="s0">, </span><span class="s1">direction</span><span class="s0">, </span><span class="s1">interactive=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xbound() == x_bound</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound() == y_bound</span>

    <span class="s1">bound = x_bound </span><span class="s0">if </span><span class="s1">direction == </span><span class="s2">'horizontal' </span><span class="s0">else </span><span class="s1">y_bound</span>
    <span class="s0">assert </span><span class="s1">tool._edge_handles.positions == list(bound)</span>

    <span class="s1">press_data = [</span><span class="s3">10.5</span><span class="s0">, </span><span class="s3">11.5</span><span class="s1">]</span>
    <span class="s1">move_data = [</span><span class="s3">11</span><span class="s0">, </span><span class="s3">13</span><span class="s1">]  </span><span class="s4"># Updating selector is done in onmove</span>
    <span class="s1">release_data = move_data</span>
    <span class="s1">click_and_drag(tool</span><span class="s0">, </span><span class="s1">start=press_data</span><span class="s0">, </span><span class="s1">end=move_data)</span>

    <span class="s0">assert </span><span class="s1">ax.get_xbound() == x_bound</span>
    <span class="s0">assert </span><span class="s1">ax.get_ybound() == y_bound</span>

    <span class="s1">index = </span><span class="s3">0 </span><span class="s0">if </span><span class="s1">direction == </span><span class="s2">'horizontal' </span><span class="s0">else </span><span class="s3">1</span>
    <span class="s1">handle_positions = [press_data[index]</span><span class="s0">, </span><span class="s1">release_data[index]]</span>
    <span class="s0">assert </span><span class="s1">tool._edge_handles.positions == handle_positions</span>


<span class="s1">@pytest.mark.backend(</span><span class="s2">'QtAgg'</span><span class="s0">, </span><span class="s1">skip_on_importerror=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_span_selector_animated_artists_callback():</span>
    <span class="s5">&quot;&quot;&quot;Check that the animated artists changed in callbacks are updated.&quot;&quot;&quot;</span>
    <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2 </span><span class="s1">* np.pi</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">values = np.sin(x)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ln</span><span class="s0">, </span><span class="s1">= ax.plot(x</span><span class="s0">, </span><span class="s1">values</span><span class="s0">, </span><span class="s1">animated=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ln2</span><span class="s0">, </span><span class="s1">= ax.plot([]</span><span class="s0">, </span><span class="s1">animated=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s4"># spin the event loop to let the backend process any pending operations</span>
    <span class="s4"># before drawing artists</span>
    <span class="s4"># See blitting tutorial</span>
    <span class="s1">plt.pause(</span><span class="s3">0.1</span><span class="s1">)</span>
    <span class="s1">ax.draw_artist(ln)</span>
    <span class="s1">fig.canvas.blit(fig.bbox)</span>

    <span class="s0">def </span><span class="s1">mean(vmin</span><span class="s0">, </span><span class="s1">vmax):</span>
        <span class="s4"># Return mean of values in x between *vmin* and *vmax*</span>
        <span class="s1">indmin</span><span class="s0">, </span><span class="s1">indmax = np.searchsorted(x</span><span class="s0">, </span><span class="s1">(vmin</span><span class="s0">, </span><span class="s1">vmax))</span>
        <span class="s1">v = values[indmin:indmax].mean()</span>
        <span class="s1">ln2.set_data(x</span><span class="s0">, </span><span class="s1">np.full_like(x</span><span class="s0">, </span><span class="s1">v))</span>

    <span class="s1">span = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">mean</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                <span class="s1">onmove_callback=mean</span><span class="s0">,</span>
                                <span class="s1">interactive=</span><span class="s0">True,</span>
                                <span class="s1">drag_from_anywhere=</span><span class="s0">True,</span>
                                <span class="s1">useblit=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s4"># Add span selector and check that the line is draw after it was updated</span>
    <span class="s4"># by the callback</span>
    <span class="s1">press_data = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">move_data = [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">do_event(span</span><span class="s0">, </span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">xdata=press_data[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ydata=press_data[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">do_event(span</span><span class="s0">, </span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">xdata=move_data[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ydata=move_data[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">span._get_animated_artists() == (ln</span><span class="s0">, </span><span class="s1">ln2)</span>
    <span class="s0">assert </span><span class="s1">ln.stale </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ln2.stale</span>
    <span class="s1">assert_allclose(ln2.get_ydata()</span><span class="s0">, </span><span class="s3">0.9547335049088455</span><span class="s1">)</span>
    <span class="s1">span.update()</span>
    <span class="s0">assert </span><span class="s1">ln2.stale </span><span class="s0">is False</span>

    <span class="s4"># Change span selector and check that the line is drawn/updated after its</span>
    <span class="s4"># value was updated by the callback</span>
    <span class="s1">press_data = [</span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">move_data = [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">release_data = [</span><span class="s3">5</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">do_event(span</span><span class="s0">, </span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">xdata=press_data[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ydata=press_data[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">do_event(span</span><span class="s0">, </span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">xdata=move_data[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">ydata=move_data[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ln.stale </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ln2.stale</span>
    <span class="s1">assert_allclose(ln2.get_ydata()</span><span class="s0">, </span><span class="s1">-</span><span class="s3">0.9424150707548072</span><span class="s1">)</span>
    <span class="s1">do_event(span</span><span class="s0">, </span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">xdata=release_data[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">ydata=release_data[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ln2.stale </span><span class="s0">is False</span>


<span class="s0">def </span><span class="s1">test_snapping_values_span_selector(ax):</span>
    <span class="s0">def </span><span class="s1">onselect(*args):</span>
        <span class="s0">pass</span>

    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">'horizontal'</span><span class="s0">,</span><span class="s1">)</span>
    <span class="s1">snap_function = tool._snap</span>

    <span class="s1">snap_values = np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">11</span><span class="s1">)</span>
    <span class="s1">values = np.array([-</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.6</span><span class="s0">, </span><span class="s3">0.7</span><span class="s0">, </span><span class="s3">0.9</span><span class="s0">, </span><span class="s3">4.76</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s3">5.5</span><span class="s1">])</span>
    <span class="s1">expect = np.array([</span><span class="s3">00.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1.0</span><span class="s0">, </span><span class="s3">5.00</span><span class="s0">, </span><span class="s3">5.0</span><span class="s0">, </span><span class="s3">5.0</span><span class="s1">])</span>
    <span class="s1">values = snap_function(values</span><span class="s0">, </span><span class="s1">snap_values)</span>
    <span class="s1">assert_allclose(values</span><span class="s0">, </span><span class="s1">expect)</span>


<span class="s0">def </span><span class="s1">test_span_selector_snap(ax):</span>
    <span class="s0">def </span><span class="s1">onselect(vmin</span><span class="s0">, </span><span class="s1">vmax):</span>
        <span class="s1">ax._got_onselect = </span><span class="s0">True</span>

    <span class="s1">snap_values = np.arange(</span><span class="s3">50</span><span class="s1">) * </span><span class="s3">4</span>

    <span class="s1">tool = widgets.SpanSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s1">direction=</span><span class="s2">'horizontal'</span><span class="s0">,</span>
                                <span class="s1">snap_values=snap_values)</span>
    <span class="s1">tool.extents = (</span><span class="s3">17</span><span class="s0">, </span><span class="s3">35</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">16</span><span class="s0">, </span><span class="s3">36</span><span class="s1">)</span>

    <span class="s1">tool.snap_values = </span><span class="s0">None</span>
    <span class="s0">assert </span><span class="s1">tool.snap_values </span><span class="s0">is None</span>
    <span class="s1">tool.extents = (</span><span class="s3">17</span><span class="s0">, </span><span class="s3">35</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">tool.extents == (</span><span class="s3">17</span><span class="s0">, </span><span class="s3">35</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'kwargs'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">dict()</span><span class="s0">,</span>
    <span class="s1">dict(useblit=</span><span class="s0">False, </span><span class="s1">props=dict(color=</span><span class="s2">'red'</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">dict(useblit=</span><span class="s0">True, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_lasso_selector(ax</span><span class="s0">, </span><span class="s1">kwargs):</span>
    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">tool = widgets.LassoSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s1">**kwargs)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">125</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">150</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">150</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">onselect.assert_called_once_with([(</span><span class="s3">100</span><span class="s0">, </span><span class="s3">100</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">125</span><span class="s0">, </span><span class="s3">125</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)])</span>


<span class="s0">def </span><span class="s1">test_CheckButtons(ax):</span>
    <span class="s1">check = widgets.CheckButtons(ax</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s0">, </span><span class="s2">'c'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">True, False, True</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">check.get_status() == [</span><span class="s0">True, False, True</span><span class="s1">]</span>
    <span class="s1">check.set_active(</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">check.get_status() == [</span><span class="s0">False, False, True</span><span class="s1">]</span>

    <span class="s1">cid = check.on_clicked(</span><span class="s0">lambda</span><span class="s1">: </span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">check.disconnect(cid)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;toolbar&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;none&quot;</span><span class="s0">, </span><span class="s2">&quot;toolbar2&quot;</span><span class="s0">, </span><span class="s2">&quot;toolmanager&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_TextBox(ax</span><span class="s0">, </span><span class="s1">toolbar):</span>
    <span class="s4"># Avoid &quot;toolmanager is provisional&quot; warning.</span>
    <span class="s1">plt.rcParams._set(</span><span class="s2">&quot;toolbar&quot;</span><span class="s0">, </span><span class="s1">toolbar)</span>

    <span class="s1">submit_event = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">text_change_event = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">tool = widgets.TextBox(ax</span><span class="s0">, </span><span class="s2">''</span><span class="s1">)</span>
    <span class="s1">tool.on_submit(submit_event)</span>
    <span class="s1">tool.on_text_change(text_change_event)</span>

    <span class="s0">assert </span><span class="s1">tool.text == </span><span class="s2">''</span>

    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'_click'</span><span class="s1">)</span>

    <span class="s1">tool.set_val(</span><span class="s2">'x**2'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">tool.text == </span><span class="s2">'x**2'</span>
    <span class="s0">assert </span><span class="s1">text_change_event.call_count == </span><span class="s3">1</span>

    <span class="s1">tool.begin_typing()</span>
    <span class="s1">tool.stop_typing()</span>

    <span class="s0">assert </span><span class="s1">submit_event.call_count == </span><span class="s3">2</span>

    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'_click'</span><span class="s1">)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'_keypress'</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">'+'</span><span class="s1">)</span>
    <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s2">'_keypress'</span><span class="s0">, </span><span class="s1">key=</span><span class="s2">'5'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">text_change_event.call_count == </span><span class="s3">3</span>


<span class="s1">@image_comparison([</span><span class="s2">'check_radio_buttons.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_check_radio_buttons_image():</span>
    <span class="s1">ax = get_ax()</span>
    <span class="s1">fig = ax.figure</span>
    <span class="s1">fig.subplots_adjust(left=</span><span class="s3">0.3</span><span class="s1">)</span>

    <span class="s1">rax1 = fig.add_axes([</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.7</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.15</span><span class="s1">])</span>
    <span class="s1">rb1 = widgets.RadioButtons(rax1</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'Radio 1'</span><span class="s0">, </span><span class="s2">'Radio 2'</span><span class="s0">, </span><span class="s2">'Radio 3'</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.warns(DeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">'The circles attribute was deprecated'</span><span class="s1">):</span>
        <span class="s1">rb1.circles  </span><span class="s4"># Trigger the old-style elliptic radiobuttons.</span>

    <span class="s1">rax2 = fig.add_axes([</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.15</span><span class="s1">])</span>
    <span class="s1">cb1 = widgets.CheckButtons(rax2</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'Check 1'</span><span class="s0">, </span><span class="s2">'Check 2'</span><span class="s0">, </span><span class="s2">'Check 3'</span><span class="s1">)</span><span class="s0">,</span>
                               <span class="s1">(</span><span class="s0">False, True, True</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">pytest.warns(DeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">'The rectangles attribute was deprecated'</span><span class="s1">):</span>
        <span class="s1">cb1.rectangles  </span><span class="s4"># Trigger old-style Rectangle check boxes</span>

    <span class="s1">rax3 = fig.add_axes([</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.15</span><span class="s1">])</span>
    <span class="s1">rb3 = widgets.RadioButtons(</span>
        <span class="s1">rax3</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'Radio 1'</span><span class="s0">, </span><span class="s2">'Radio 2'</span><span class="s0">, </span><span class="s2">'Radio 3'</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">label_props={</span><span class="s2">'fontsize'</span><span class="s1">: [</span><span class="s3">8</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">16</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s2">'color'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">radio_props={</span><span class="s2">'edgecolor'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s2">'facecolor'</span><span class="s1">: [</span><span class="s2">'mistyrose'</span><span class="s0">, </span><span class="s2">'palegreen'</span><span class="s0">, </span><span class="s2">'lightblue'</span><span class="s1">]})</span>

    <span class="s1">rax4 = fig.add_axes([</span><span class="s3">0.05</span><span class="s0">, </span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.15</span><span class="s1">])</span>
    <span class="s1">cb4 = widgets.CheckButtons(</span>
        <span class="s1">rax4</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'Check 1'</span><span class="s0">, </span><span class="s2">'Check 2'</span><span class="s0">, </span><span class="s2">'Check 3'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">False, True, True</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">label_props={</span><span class="s2">'fontsize'</span><span class="s1">: [</span><span class="s3">8</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">16</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s2">'color'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">frame_props={</span><span class="s2">'edgecolor'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s2">'facecolor'</span><span class="s1">: [</span><span class="s2">'mistyrose'</span><span class="s0">, </span><span class="s2">'palegreen'</span><span class="s0">, </span><span class="s2">'lightblue'</span><span class="s1">]}</span><span class="s0">,</span>
        <span class="s1">check_props={</span><span class="s2">'color'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s1">]})</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_radio_buttons(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">widgets.RadioButtons(fig_test.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;tea&quot;</span><span class="s0">, </span><span class="s2">&quot;coffee&quot;</span><span class="s1">])</span>
    <span class="s1">ax = fig_ref.add_subplot(xticks=[]</span><span class="s0">, </span><span class="s1">yticks=[])</span>
    <span class="s1">ax.scatter([</span><span class="s3">.15</span><span class="s0">, </span><span class="s3">.15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
               <span class="s1">s=(plt.rcParams[</span><span class="s2">&quot;font.size&quot;</span><span class="s1">] / </span><span class="s3">2</span><span class="s1">) ** </span><span class="s3">2</span><span class="s0">, </span><span class="s1">c=[</span><span class="s2">&quot;C0&quot;</span><span class="s0">, </span><span class="s2">&quot;none&quot;</span><span class="s1">])</span>
    <span class="s1">ax.text(</span><span class="s3">.25</span><span class="s0">, </span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s2">&quot;tea&quot;</span><span class="s0">, </span><span class="s1">transform=ax.transAxes</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">&quot;center&quot;</span><span class="s1">)</span>
    <span class="s1">ax.text(</span><span class="s3">.25</span><span class="s0">, </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s2">&quot;coffee&quot;</span><span class="s0">, </span><span class="s1">transform=ax.transAxes</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">&quot;center&quot;</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_radio_buttons_props(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">label_props = {</span><span class="s2">'color'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s1">]</span><span class="s0">, </span><span class="s2">'fontsize'</span><span class="s1">: [</span><span class="s3">24</span><span class="s1">]}</span>
    <span class="s1">radio_props = {</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'edgecolor'</span><span class="s1">: </span><span class="s2">'blue'</span><span class="s0">, </span><span class="s2">'linewidth'</span><span class="s1">: </span><span class="s3">2</span><span class="s1">}</span>

    <span class="s1">widgets.RadioButtons(fig_ref.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'tea'</span><span class="s0">, </span><span class="s2">'coffee'</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">label_props=label_props</span><span class="s0">, </span><span class="s1">radio_props=radio_props)</span>

    <span class="s1">cb = widgets.RadioButtons(fig_test.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'tea'</span><span class="s0">, </span><span class="s2">'coffee'</span><span class="s1">])</span>
    <span class="s1">cb.set_label_props(label_props)</span>
    <span class="s4"># Setting the label size automatically increases default marker size, so we</span>
    <span class="s4"># need to do that here as well.</span>
    <span class="s1">cb.set_radio_props({**radio_props</span><span class="s0">, </span><span class="s2">'s'</span><span class="s1">: (</span><span class="s3">24 </span><span class="s1">/ </span><span class="s3">2</span><span class="s1">)**</span><span class="s3">2</span><span class="s1">})</span>


<span class="s0">def </span><span class="s1">test_radio_button_active_conflict(ax):</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">r'Both the \*activecolor\* parameter'</span><span class="s1">):</span>
        <span class="s1">rb = widgets.RadioButtons(ax</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'tea'</span><span class="s0">, </span><span class="s2">'coffee'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">activecolor=</span><span class="s2">'red'</span><span class="s0">,</span>
                                  <span class="s1">radio_props={</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'green'</span><span class="s1">})</span>
    <span class="s4"># *radio_props*' facecolor wins over *activecolor*</span>
    <span class="s0">assert </span><span class="s1">mcolors.same_color(rb._buttons.get_facecolor()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'none'</span><span class="s1">])</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_radio_buttons_activecolor_change(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">widgets.RadioButtons(fig_ref.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'tea'</span><span class="s0">, </span><span class="s2">'coffee'</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">activecolor=</span><span class="s2">'green'</span><span class="s1">)</span>

    <span class="s4"># Test property setter.</span>
    <span class="s1">cb = widgets.RadioButtons(fig_test.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'tea'</span><span class="s0">, </span><span class="s2">'coffee'</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">activecolor=</span><span class="s2">'red'</span><span class="s1">)</span>
    <span class="s1">cb.activecolor = </span><span class="s2">'green'</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_check_buttons(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">widgets.CheckButtons(fig_test.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;tea&quot;</span><span class="s0">, </span><span class="s2">&quot;coffee&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, True</span><span class="s1">])</span>
    <span class="s1">ax = fig_ref.add_subplot(xticks=[]</span><span class="s0">, </span><span class="s1">yticks=[])</span>
    <span class="s1">ax.scatter([</span><span class="s3">.15</span><span class="s0">, </span><span class="s3">.15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'s'</span><span class="s0">, </span><span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
               <span class="s1">s=(plt.rcParams[</span><span class="s2">&quot;font.size&quot;</span><span class="s1">] / </span><span class="s3">2</span><span class="s1">) ** </span><span class="s3">2</span><span class="s0">, </span><span class="s1">c=[</span><span class="s2">&quot;none&quot;</span><span class="s0">, </span><span class="s2">&quot;none&quot;</span><span class="s1">])</span>
    <span class="s1">ax.scatter([</span><span class="s3">.15</span><span class="s0">, </span><span class="s3">.15</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'x'</span><span class="s0">, </span><span class="s1">transform=ax.transAxes</span><span class="s0">,</span>
               <span class="s1">s=(plt.rcParams[</span><span class="s2">&quot;font.size&quot;</span><span class="s1">] / </span><span class="s3">2</span><span class="s1">) ** </span><span class="s3">2</span><span class="s0">, </span><span class="s1">c=[</span><span class="s2">&quot;k&quot;</span><span class="s0">, </span><span class="s2">&quot;k&quot;</span><span class="s1">])</span>
    <span class="s1">ax.text(</span><span class="s3">.25</span><span class="s0">, </span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s2">&quot;tea&quot;</span><span class="s0">, </span><span class="s1">transform=ax.transAxes</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">&quot;center&quot;</span><span class="s1">)</span>
    <span class="s1">ax.text(</span><span class="s3">.25</span><span class="s0">, </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s2">&quot;coffee&quot;</span><span class="s0">, </span><span class="s1">transform=ax.transAxes</span><span class="s0">, </span><span class="s1">va=</span><span class="s2">&quot;center&quot;</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_check_button_props(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">label_props = {</span><span class="s2">'color'</span><span class="s1">: [</span><span class="s2">'red'</span><span class="s1">]</span><span class="s0">, </span><span class="s2">'fontsize'</span><span class="s1">: [</span><span class="s3">24</span><span class="s1">]}</span>
    <span class="s1">frame_props = {</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'edgecolor'</span><span class="s1">: </span><span class="s2">'blue'</span><span class="s0">, </span><span class="s2">'linewidth'</span><span class="s1">: </span><span class="s3">2</span><span class="s1">}</span>
    <span class="s1">check_props = {</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'linewidth'</span><span class="s1">: </span><span class="s3">2</span><span class="s1">}</span>

    <span class="s1">widgets.CheckButtons(fig_ref.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'tea'</span><span class="s0">, </span><span class="s2">'coffee'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, True</span><span class="s1">]</span><span class="s0">,</span>
                         <span class="s1">label_props=label_props</span><span class="s0">, </span><span class="s1">frame_props=frame_props</span><span class="s0">,</span>
                         <span class="s1">check_props=check_props)</span>

    <span class="s1">cb = widgets.CheckButtons(fig_test.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'tea'</span><span class="s0">, </span><span class="s2">'coffee'</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">[</span><span class="s0">True, True</span><span class="s1">])</span>
    <span class="s1">cb.set_label_props(label_props)</span>
    <span class="s4"># Setting the label size automatically increases default marker size, so we</span>
    <span class="s4"># need to do that here as well.</span>
    <span class="s1">cb.set_frame_props({**frame_props</span><span class="s0">, </span><span class="s2">'s'</span><span class="s1">: (</span><span class="s3">24 </span><span class="s1">/ </span><span class="s3">2</span><span class="s1">)**</span><span class="s3">2</span><span class="s1">})</span>
    <span class="s4"># FIXME: Axes.scatter promotes facecolor to edgecolor on unfilled markers,</span>
    <span class="s4"># but Collection.update doesn't do that (it forgot the marker already).</span>
    <span class="s4"># This means we cannot pass facecolor to both setters directly.</span>
    <span class="s1">check_props[</span><span class="s2">'edgecolor'</span><span class="s1">] = check_props.pop(</span><span class="s2">'facecolor'</span><span class="s1">)</span>
    <span class="s1">cb.set_check_props({**check_props</span><span class="s0">, </span><span class="s2">'s'</span><span class="s1">: (</span><span class="s3">24 </span><span class="s1">/ </span><span class="s3">2</span><span class="s1">)**</span><span class="s3">2</span><span class="s1">})</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_check_buttons_rectangles(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s4"># Test should be removed once .rectangles is removed</span>
    <span class="s1">cb = widgets.CheckButtons(fig_test.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">]</span><span class="s0">,</span>
                              <span class="s1">[</span><span class="s0">False, False</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.warns(DeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">'The rectangles attribute was deprecated'</span><span class="s1">):</span>
        <span class="s1">cb.rectangles</span>
    <span class="s1">ax = fig_ref.add_subplot(xticks=[]</span><span class="s0">, </span><span class="s1">yticks=[])</span>
    <span class="s1">ys = [</span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">dy = </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span>
    <span class="s1">w</span><span class="s0">, </span><span class="s1">h = dy / </span><span class="s3">2</span><span class="s0">, </span><span class="s1">dy / </span><span class="s3">2</span>
    <span class="s1">rectangles = [</span>
        <span class="s1">Rectangle(xy=(</span><span class="s3">0.05</span><span class="s0">, </span><span class="s1">ys[i] - h / </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">width=w</span><span class="s0">, </span><span class="s1">height=h</span><span class="s0">,</span>
                  <span class="s1">edgecolor=</span><span class="s2">&quot;black&quot;</span><span class="s0">,</span>
                  <span class="s1">facecolor=</span><span class="s2">&quot;none&quot;</span><span class="s0">,</span>
                  <span class="s1">transform=ax.transAxes</span>
                  <span class="s1">)</span>
        <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">enumerate(ys)</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">rectangle </span><span class="s0">in </span><span class="s1">rectangles:</span>
        <span class="s1">ax.add_patch(rectangle)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_check_buttons_lines(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s4"># Test should be removed once .lines is removed</span>
    <span class="s1">cb = widgets.CheckButtons(fig_test.subplots()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s2">&quot;&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">True, True</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.warns(DeprecationWarning</span><span class="s0">,</span>
                      <span class="s1">match=</span><span class="s2">'The lines attribute was deprecated'</span><span class="s1">):</span>
        <span class="s1">cb.lines</span>
    <span class="s0">for </span><span class="s1">rectangle </span><span class="s0">in </span><span class="s1">cb._rectangles:</span>
        <span class="s1">rectangle.set_visible(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">ax = fig_ref.add_subplot(xticks=[]</span><span class="s0">, </span><span class="s1">yticks=[])</span>
    <span class="s1">ys = [</span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span><span class="s1">]</span>
    <span class="s1">dy = </span><span class="s3">1</span><span class="s1">/</span><span class="s3">3</span>
    <span class="s1">w</span><span class="s0">, </span><span class="s1">h = dy / </span><span class="s3">2</span><span class="s0">, </span><span class="s1">dy / </span><span class="s3">2</span>
    <span class="s1">lineparams = {</span><span class="s2">'color'</span><span class="s1">: </span><span class="s2">'k'</span><span class="s0">, </span><span class="s2">'linewidth'</span><span class="s1">: </span><span class="s3">1.25</span><span class="s0">,</span>
                    <span class="s2">'transform'</span><span class="s1">: ax.transAxes</span><span class="s0">,</span>
                    <span class="s2">'solid_capstyle'</span><span class="s1">: </span><span class="s2">'butt'</span><span class="s1">}</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">enumerate(ys):</span>
        <span class="s1">x</span><span class="s0">, </span><span class="s1">y = </span><span class="s3">0.05</span><span class="s0">, </span><span class="s1">y - h / </span><span class="s3">2</span>
        <span class="s1">l1 = Line2D([x</span><span class="s0">, </span><span class="s1">x + w]</span><span class="s0">, </span><span class="s1">[y + h</span><span class="s0">, </span><span class="s1">y]</span><span class="s0">, </span><span class="s1">**lineparams)</span>
        <span class="s1">l2 = Line2D([x</span><span class="s0">, </span><span class="s1">x + w]</span><span class="s0">, </span><span class="s1">[y</span><span class="s0">, </span><span class="s1">y + h]</span><span class="s0">, </span><span class="s1">**lineparams)</span>

        <span class="s1">l1.set_visible(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">l2.set_visible(</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">ax.add_line(l1)</span>
        <span class="s1">ax.add_line(l2)</span>


<span class="s0">def </span><span class="s1">test_slider_slidermin_slidermax_invalid():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s4"># test min/max with floats</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                       <span class="s1">slidermin=</span><span class="s3">10.0</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                       <span class="s1">slidermax=</span><span class="s3">10.0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_slider_slidermin_slidermax():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">slider_ = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                             <span class="s1">valinit=</span><span class="s3">5.0</span><span class="s1">)</span>

    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                            <span class="s1">valinit=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">slidermin=slider_)</span>
    <span class="s0">assert </span><span class="s1">slider.val == slider_.val</span>

    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                            <span class="s1">valinit=</span><span class="s3">10.0</span><span class="s0">, </span><span class="s1">slidermax=slider_)</span>
    <span class="s0">assert </span><span class="s1">slider.val == slider_.val</span>


<span class="s0">def </span><span class="s1">test_slider_valmin_valmax():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                            <span class="s1">valinit=-</span><span class="s3">10.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">slider.val == slider.valmin</span>

    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                            <span class="s1">valinit=</span><span class="s3">25.0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">slider.val == slider.valmax</span>


<span class="s0">def </span><span class="s1">test_slider_valstep_snapping():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                            <span class="s1">valinit=</span><span class="s3">11.4</span><span class="s0">, </span><span class="s1">valstep=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">slider.val == </span><span class="s3">11</span>

    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24.0</span><span class="s0">,</span>
                            <span class="s1">valinit=</span><span class="s3">11.4</span><span class="s0">, </span><span class="s1">valstep=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">5.5</span><span class="s0">, </span><span class="s3">19.7</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">slider.val == </span><span class="s3">5.5</span>


<span class="s0">def </span><span class="s1">test_slider_horizontal_vertical():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24</span><span class="s0">,</span>
                            <span class="s1">valinit=</span><span class="s3">12</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s2">'horizontal'</span><span class="s1">)</span>
    <span class="s1">slider.set_val(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">slider.val == </span><span class="s3">10</span>
    <span class="s4"># check the dimension of the slider patch in axes units</span>
    <span class="s1">box = slider.poly.get_extents().transformed(ax.transAxes.inverted())</span>
    <span class="s1">assert_allclose(box.bounds</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">.25</span><span class="s0">, </span><span class="s3">10</span><span class="s1">/</span><span class="s3">24</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">24</span><span class="s0">,</span>
                            <span class="s1">valinit=</span><span class="s3">12</span><span class="s0">, </span><span class="s1">orientation=</span><span class="s2">'vertical'</span><span class="s1">)</span>
    <span class="s1">slider.set_val(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">slider.val == </span><span class="s3">10</span>
    <span class="s4"># check the dimension of the slider patch in axes units</span>
    <span class="s1">box = slider.poly.get_extents().transformed(ax.transAxes.inverted())</span>
    <span class="s1">assert_allclose(box.bounds</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.25</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s3">10</span><span class="s1">/</span><span class="s3">24</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_slider_reset():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">slider = widgets.Slider(ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">''</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">valinit=</span><span class="s3">.5</span><span class="s1">)</span>
    <span class="s1">slider.set_val(</span><span class="s3">0.75</span><span class="s1">)</span>
    <span class="s1">slider.reset()</span>
    <span class="s0">assert </span><span class="s1">slider.val == </span><span class="s3">0.5</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;orientation&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;horizontal&quot;</span><span class="s0">, </span><span class="s2">&quot;vertical&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_range_slider(orientation):</span>
    <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;vertical&quot;</span><span class="s1">:</span>
        <span class="s1">idx = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">idx = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">slider = widgets.RangeSlider(</span>
        <span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">orientation=orientation</span><span class="s0">,</span>
        <span class="s1">valinit=[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.34</span><span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s1">box = slider.poly.get_extents().transformed(ax.transAxes.inverted())</span>
    <span class="s1">assert_allclose(box.get_points().flatten()[idx]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0.34</span><span class="s0">, </span><span class="s3">0.75</span><span class="s1">])</span>

    <span class="s4"># Check initial value is set correctly</span>
    <span class="s1">assert_allclose(slider.val</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.34</span><span class="s1">))</span>

    <span class="s0">def </span><span class="s1">handle_positions(slider):</span>
        <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;vertical&quot;</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">[h.get_ydata()[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">for </span><span class="s1">h </span><span class="s0">in </span><span class="s1">slider._handles]</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">return </span><span class="s1">[h.get_xdata()[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">for </span><span class="s1">h </span><span class="s0">in </span><span class="s1">slider._handles]</span>

    <span class="s1">slider.set_val((</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.6</span><span class="s1">))</span>
    <span class="s1">assert_allclose(slider.val</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.6</span><span class="s1">))</span>
    <span class="s1">assert_allclose(handle_positions(slider)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.6</span><span class="s1">))</span>

    <span class="s1">box = slider.poly.get_extents().transformed(ax.transAxes.inverted())</span>
    <span class="s1">assert_allclose(box.get_points().flatten()[idx]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">.25</span><span class="s0">, </span><span class="s3">0.6</span><span class="s0">, </span><span class="s3">.75</span><span class="s1">])</span>

    <span class="s1">slider.set_val((</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.1</span><span class="s1">))</span>
    <span class="s1">assert_allclose(slider.val</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">))</span>
    <span class="s1">assert_allclose(handle_positions(slider)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">))</span>

    <span class="s1">slider.set_val((-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">assert_allclose(slider.val</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">assert_allclose(handle_positions(slider)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>

    <span class="s1">slider.reset()</span>
    <span class="s1">assert_allclose(slider.val</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.34</span><span class="s1">))</span>
    <span class="s1">assert_allclose(handle_positions(slider)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.34</span><span class="s1">))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;orientation&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;horizontal&quot;</span><span class="s0">, </span><span class="s2">&quot;vertical&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_range_slider_same_init_values(orientation):</span>
    <span class="s0">if </span><span class="s1">orientation == </span><span class="s2">&quot;vertical&quot;</span><span class="s1">:</span>
        <span class="s1">idx = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">idx = [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">slider = widgets.RangeSlider(</span>
         <span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">&quot;&quot;</span><span class="s0">, </span><span class="s1">valmin=</span><span class="s3">0.0</span><span class="s0">, </span><span class="s1">valmax=</span><span class="s3">1.0</span><span class="s0">, </span><span class="s1">orientation=orientation</span><span class="s0">,</span>
         <span class="s1">valinit=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span>
     <span class="s1">)</span>
    <span class="s1">box = slider.poly.get_extents().transformed(ax.transAxes.inverted())</span>
    <span class="s1">assert_allclose(box.get_points().flatten()[idx]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.25</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0.75</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">check_polygon_selector(event_sequence</span><span class="s0">, </span><span class="s1">expected_result</span><span class="s0">, </span><span class="s1">selections_count</span><span class="s0">,</span>
                           <span class="s1">**kwargs):</span>
    <span class="s5">&quot;&quot;&quot; 
    Helper function to test Polygon Selector. 
 
    Parameters 
    ---------- 
    event_sequence : list of tuples (etype, dict()) 
        A sequence of events to perform. The sequence is a list of tuples 
        where the first element of the tuple is an etype (e.g., 'onmove', 
        'press', etc.), and the second element of the tuple is a dictionary of 
         the arguments for the event (e.g., xdata=5, key='shift', etc.). 
    expected_result : list of vertices (xdata, ydata) 
        The list of vertices that are expected to result from the event 
        sequence. 
    selections_count : int 
        Wait for the tool to call its `onselect` function `selections_count` 
        times, before comparing the result to the `expected_result` 
    **kwargs 
        Keyword arguments are passed to PolygonSelector. 
    &quot;&quot;&quot;</span>
    <span class="s1">ax = get_ax()</span>

    <span class="s1">onselect = mock.Mock(spec=noop</span><span class="s0">, </span><span class="s1">return_value=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s1">tool = widgets.PolygonSelector(ax</span><span class="s0">, </span><span class="s1">onselect</span><span class="s0">, </span><span class="s1">**kwargs)</span>

    <span class="s0">for </span><span class="s1">(etype</span><span class="s0">, </span><span class="s1">event_args) </span><span class="s0">in </span><span class="s1">event_sequence:</span>
        <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s1">etype</span><span class="s0">, </span><span class="s1">**event_args)</span>

    <span class="s0">assert </span><span class="s1">onselect.call_count == selections_count</span>
    <span class="s0">assert </span><span class="s1">onselect.call_args == ((expected_result</span><span class="s0">, </span><span class="s1">)</span><span class="s0">, </span><span class="s1">{})</span>


<span class="s0">def </span><span class="s1">polygon_place_vertex(xdata</span><span class="s0">, </span><span class="s1">ydata):</span>
    <span class="s0">return </span><span class="s1">[(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=xdata</span><span class="s0">, </span><span class="s1">ydata=ydata))</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">dict(xdata=xdata</span><span class="s0">, </span><span class="s1">ydata=ydata))</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">dict(xdata=xdata</span><span class="s0">, </span><span class="s1">ydata=ydata))]</span>


<span class="s0">def </span><span class="s1">polygon_remove_vertex(xdata</span><span class="s0">, </span><span class="s1">ydata):</span>
    <span class="s0">return </span><span class="s1">[(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=xdata</span><span class="s0">, </span><span class="s1">ydata=ydata))</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">dict(xdata=xdata</span><span class="s0">, </span><span class="s1">ydata=ydata</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">3</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">dict(xdata=xdata</span><span class="s0">, </span><span class="s1">ydata=ydata</span><span class="s0">, </span><span class="s1">button=</span><span class="s3">3</span><span class="s1">))]</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'draw_bounding_box'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector(draw_bounding_box):</span>
    <span class="s1">check_selector = functools.partial(</span>
        <span class="s1">check_polygon_selector</span><span class="s0">, </span><span class="s1">draw_bounding_box=draw_bounding_box)</span>

    <span class="s4"># Simple polygon</span>
    <span class="s1">expected_result = [(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">check_selector(event_sequence</span><span class="s0">, </span><span class="s1">expected_result</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s4"># Move first vertex before completing the polygon.</span>
    <span class="s1">expected_result = [(</span><span class="s3">75</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'control'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">50</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">50</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">50</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">50</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">75</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">50</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">75</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">50</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_release'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'control'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">75</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">check_selector(event_sequence</span><span class="s0">, </span><span class="s1">expected_result</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s4"># Move first two vertices at once before completing the polygon.</span>
    <span class="s1">expected_result = [(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">75</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">75</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'shift'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_release'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'shift'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">75</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">check_selector(event_sequence</span><span class="s0">, </span><span class="s1">expected_result</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s4"># Move first vertex after completing the polygon.</span>
    <span class="s1">expected_result = [(</span><span class="s3">75</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">50</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">50</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">50</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">50</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">75</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">50</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">75</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">50</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">check_selector(event_sequence</span><span class="s0">, </span><span class="s1">expected_result</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># Move all vertices after completing the polygon.</span>
    <span class="s1">expected_result = [(</span><span class="s3">75</span><span class="s0">, </span><span class="s3">75</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">175</span><span class="s0">, </span><span class="s3">75</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">75</span><span class="s0">, </span><span class="s3">175</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'shift'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">125</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">125</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_release'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'shift'</span><span class="s1">))</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">check_selector(event_sequence</span><span class="s0">, </span><span class="s1">expected_result</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># Try to move a vertex and move all before placing any vertices.</span>
    <span class="s1">expected_result = [(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">(</span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'control'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">125</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">125</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_release'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'control'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'shift'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'press'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">100</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'onmove'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">125</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'release'</span><span class="s0">, </span><span class="s1">dict(xdata=</span><span class="s3">125</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">125</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_release'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'shift'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">check_selector(event_sequence</span><span class="s0">, </span><span class="s1">expected_result</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s4"># Try to place vertex out-of-bounds, then reset, and start a new polygon.</span>
    <span class="s1">expected_result = [(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">250</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_press'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'escape'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">'on_key_release'</span><span class="s0">, </span><span class="s1">dict(key=</span><span class="s2">'escape'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">check_selector(event_sequence</span><span class="s0">, </span><span class="s1">expected_result</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'draw_bounding_box'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_set_props_handle_props(ax</span><span class="s0">, </span><span class="s1">draw_bounding_box):</span>
    <span class="s1">tool = widgets.PolygonSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">,</span>
                                   <span class="s1">props=dict(color=</span><span class="s2">'b'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.2</span><span class="s1">)</span><span class="s0">,</span>
                                   <span class="s1">handle_props=dict(alpha=</span><span class="s3">0.5</span><span class="s1">)</span><span class="s0">,</span>
                                   <span class="s1">draw_bounding_box=draw_bounding_box)</span>

    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s0">for </span><span class="s1">(etype</span><span class="s0">, </span><span class="s1">event_args) </span><span class="s0">in </span><span class="s1">event_sequence:</span>
        <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s1">etype</span><span class="s0">, </span><span class="s1">**event_args)</span>

    <span class="s1">artist = tool._selection_artist</span>
    <span class="s0">assert </span><span class="s1">artist.get_color() == </span><span class="s2">'b'</span>
    <span class="s0">assert </span><span class="s1">artist.get_alpha() == </span><span class="s3">0.2</span>
    <span class="s1">tool.set_props(color=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">artist.get_color() == </span><span class="s2">'r'</span>
    <span class="s0">assert </span><span class="s1">artist.get_alpha() == </span><span class="s3">0.3</span>

    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool._handles_artists:</span>
        <span class="s0">assert </span><span class="s1">artist.get_color() == </span><span class="s2">'b'</span>
        <span class="s0">assert </span><span class="s1">artist.get_alpha() == </span><span class="s3">0.5</span>
    <span class="s1">tool.set_handle_props(color=</span><span class="s2">'r'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">artist </span><span class="s0">in </span><span class="s1">tool._handles_artists:</span>
        <span class="s0">assert </span><span class="s1">artist.get_color() == </span><span class="s2">'r'</span>
        <span class="s0">assert </span><span class="s1">artist.get_alpha() == </span><span class="s3">0.3</span>


<span class="s1">@check_figures_equal()</span>
<span class="s0">def </span><span class="s1">test_rect_visibility(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s4"># Check that requesting an invisible selector makes it invisible</span>
    <span class="s1">ax_test = fig_test.subplots()</span>
    <span class="s1">_ = fig_ref.subplots()</span>

    <span class="s1">tool = widgets.RectangleSelector(ax_test</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">,</span>
                                     <span class="s1">props={</span><span class="s2">'visible'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">})</span>
    <span class="s1">tool.extents = (</span><span class="s3">0.2</span><span class="s0">, </span><span class="s3">0.8</span><span class="s0">, </span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.7</span><span class="s1">)</span>


<span class="s4"># Change the order that the extra point is inserted in</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'idx'</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'draw_bounding_box'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_remove(idx</span><span class="s0">, </span><span class="s1">draw_bounding_box):</span>
    <span class="s1">verts = [(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
                      <span class="s1">polygon_place_vertex(*verts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
                      <span class="s1">polygon_place_vertex(*verts[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">,</span>
                      <span class="s4"># Finish the polygon</span>
                      <span class="s1">polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])]</span>
    <span class="s4"># Add an extra point</span>
    <span class="s1">event_sequence.insert(idx</span><span class="s0">, </span><span class="s1">polygon_place_vertex(</span><span class="s3">200</span><span class="s0">, </span><span class="s3">200</span><span class="s1">))</span>
    <span class="s4"># Remove the extra point</span>
    <span class="s1">event_sequence.append(polygon_remove_vertex(</span><span class="s3">200</span><span class="s0">, </span><span class="s3">200</span><span class="s1">))</span>
    <span class="s4"># Flatten list of lists</span>
    <span class="s1">event_sequence = sum(event_sequence</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">check_polygon_selector(event_sequence</span><span class="s0">, </span><span class="s1">verts</span><span class="s0">, </span><span class="s3">2</span><span class="s0">,</span>
                           <span class="s1">draw_bounding_box=draw_bounding_box)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'draw_bounding_box'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_remove_first_point(draw_bounding_box):</span>
    <span class="s1">verts = [(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_remove_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s1">check_polygon_selector(event_sequence</span><span class="s0">, </span><span class="s1">verts[</span><span class="s3">1</span><span class="s1">:]</span><span class="s0">, </span><span class="s3">2</span><span class="s0">,</span>
                           <span class="s1">draw_bounding_box=draw_bounding_box)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'draw_bounding_box'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_redraw(ax</span><span class="s0">, </span><span class="s1">draw_bounding_box):</span>
    <span class="s1">verts = [(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">150</span><span class="s0">, </span><span class="s3">50</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">50</span><span class="s0">, </span><span class="s3">150</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s4"># Polygon completed, now remove first two verts.</span>
        <span class="s1">*polygon_remove_vertex(*verts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_remove_vertex(*verts[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s4"># At this point the tool should be reset so we can add more vertices.</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s1">tool = widgets.PolygonSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">,</span>
                                   <span class="s1">draw_bounding_box=draw_bounding_box)</span>
    <span class="s0">for </span><span class="s1">(etype</span><span class="s0">, </span><span class="s1">event_args) </span><span class="s0">in </span><span class="s1">event_sequence:</span>
        <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s1">etype</span><span class="s0">, </span><span class="s1">**event_args)</span>
    <span class="s4"># After removing two verts, only one remains, and the</span>
    <span class="s4"># selector should be automatically resete</span>
    <span class="s0">assert </span><span class="s1">tool.verts == verts[</span><span class="s3">0</span><span class="s1">:</span><span class="s3">2</span><span class="s1">]</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'draw_bounding_box'</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_polygon_selector_verts_setter(fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">draw_bounding_box):</span>
    <span class="s1">verts = [(</span><span class="s3">0.1</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0.3</span><span class="s0">, </span><span class="s3">0.2</span><span class="s1">)]</span>
    <span class="s1">ax_test = fig_test.add_subplot()</span>

    <span class="s1">tool_test = widgets.PolygonSelector(</span>
        <span class="s1">ax_test</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">draw_bounding_box=draw_bounding_box)</span>
    <span class="s1">tool_test.verts = verts</span>
    <span class="s0">assert </span><span class="s1">tool_test.verts == verts</span>

    <span class="s1">ax_ref = fig_ref.add_subplot()</span>
    <span class="s1">tool_ref = widgets.PolygonSelector(</span>
        <span class="s1">ax_ref</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">draw_bounding_box=draw_bounding_box)</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">(etype</span><span class="s0">, </span><span class="s1">event_args) </span><span class="s0">in </span><span class="s1">event_sequence:</span>
        <span class="s1">do_event(tool_ref</span><span class="s0">, </span><span class="s1">etype</span><span class="s0">, </span><span class="s1">**event_args)</span>


<span class="s0">def </span><span class="s1">test_polygon_selector_box(ax):</span>
    <span class="s4"># Create a diamond shape</span>
    <span class="s1">verts = [(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">40</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)]</span>
    <span class="s1">event_sequence = [</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">*polygon_place_vertex(*verts[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s4"># Create selector</span>
    <span class="s1">tool = widgets.PolygonSelector(ax</span><span class="s0">, </span><span class="s1">onselect=noop</span><span class="s0">, </span><span class="s1">draw_bounding_box=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">(etype</span><span class="s0">, </span><span class="s1">event_args) </span><span class="s0">in </span><span class="s1">event_sequence:</span>
        <span class="s1">do_event(tool</span><span class="s0">, </span><span class="s1">etype</span><span class="s0">, </span><span class="s1">**event_args)</span>

    <span class="s4"># In order to trigger the correct callbacks, trigger events on the canvas</span>
    <span class="s4"># instead of the individual tools</span>
    <span class="s1">t = ax.transData</span>
    <span class="s1">canvas = ax.figure.canvas</span>

    <span class="s4"># Scale to half size using the top right corner of the bounding box</span>
    <span class="s1">MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">*t.transform((</span><span class="s3">40</span><span class="s0">, </span><span class="s3">40</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)._process()</span>
    <span class="s1">MouseEvent(</span>
        <span class="s2">&quot;motion_notify_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">*t.transform((</span><span class="s3">20</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)))._process()</span>
    <span class="s1">MouseEvent(</span>
        <span class="s2">&quot;button_release_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">*t.transform((</span><span class="s3">20</span><span class="s0">, </span><span class="s3">20</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)._process()</span>
    <span class="s1">np.testing.assert_allclose(</span>
        <span class="s1">tool.verts</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">10</span><span class="s1">)])</span>

    <span class="s4"># Move using the center of the bounding box</span>
    <span class="s1">MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">*t.transform((</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)._process()</span>
    <span class="s1">MouseEvent(</span>
        <span class="s2">&quot;motion_notify_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">*t.transform((</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)))._process()</span>
    <span class="s1">MouseEvent(</span>
        <span class="s2">&quot;button_release_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">*t.transform((</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)._process()</span>
    <span class="s1">np.testing.assert_allclose(</span>
        <span class="s1">tool.verts</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">40</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)])</span>

    <span class="s4"># Remove a point from the polygon and check that the box extents update</span>
    <span class="s1">np.testing.assert_allclose(</span>
        <span class="s1">tool._box.extents</span><span class="s0">, </span><span class="s1">(</span><span class="s3">20.0</span><span class="s0">, </span><span class="s3">40.0</span><span class="s0">, </span><span class="s3">20.0</span><span class="s0">, </span><span class="s3">40.0</span><span class="s1">))</span>

    <span class="s1">MouseEvent(</span>
        <span class="s2">&quot;button_press_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">*t.transform((</span><span class="s3">30</span><span class="s0">, </span><span class="s3">20</span><span class="s1">))</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)._process()</span>
    <span class="s1">MouseEvent(</span>
        <span class="s2">&quot;button_release_event&quot;</span><span class="s0">, </span><span class="s1">canvas</span><span class="s0">, </span><span class="s1">*t.transform((</span><span class="s3">30</span><span class="s0">, </span><span class="s3">20</span><span class="s1">))</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)._process()</span>
    <span class="s1">np.testing.assert_allclose(</span>
        <span class="s1">tool.verts</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">40</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">40</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)])</span>
    <span class="s1">np.testing.assert_allclose(</span>
        <span class="s1">tool._box.extents</span><span class="s0">, </span><span class="s1">(</span><span class="s3">20.0</span><span class="s0">, </span><span class="s3">40.0</span><span class="s0">, </span><span class="s3">30.0</span><span class="s0">, </span><span class="s3">40.0</span><span class="s1">))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;horizOn&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;vertOn&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_MultiCursor(horizOn</span><span class="s0">, </span><span class="s1">vertOn):</span>
    <span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax3) = plt.figure().subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax2 = plt.figure().subplots()</span>

    <span class="s4"># useblit=false to avoid having to draw the figure to cache the renderer</span>
    <span class="s1">multi = widgets.MultiCursor(</span>
        <span class="s0">None, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2)</span><span class="s0">, </span><span class="s1">useblit=</span><span class="s0">False, </span><span class="s1">horizOn=horizOn</span><span class="s0">, </span><span class="s1">vertOn=vertOn</span>
    <span class="s1">)</span>

    <span class="s4"># Only two of the axes should have a line drawn on them.</span>
    <span class="s0">assert </span><span class="s1">len(multi.vlines) == </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">len(multi.hlines) == </span><span class="s3">2</span>

    <span class="s4"># mock a motion_notify_event</span>
    <span class="s4"># Can't use `do_event` as that helper requires the widget</span>
    <span class="s4"># to have a single .ax attribute.</span>
    <span class="s1">event = mock_event(ax1</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">.5</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">.25</span><span class="s1">)</span>
    <span class="s1">multi.onmove(event)</span>
    <span class="s4"># force a draw + draw event to exercise clear</span>
    <span class="s1">ax1.figure.canvas.draw()</span>

    <span class="s4"># the lines in the first two ax should both move</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">multi.vlines:</span>
        <span class="s0">assert </span><span class="s1">l.get_xdata() == (</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">multi.hlines:</span>
        <span class="s0">assert </span><span class="s1">l.get_ydata() == (</span><span class="s3">.25</span><span class="s0">, </span><span class="s3">.25</span><span class="s1">)</span>
    <span class="s4"># The relevant lines get turned on after move.</span>
    <span class="s0">assert </span><span class="s1">len([line </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">multi.vlines </span><span class="s0">if </span><span class="s1">line.get_visible()]) == (</span>
        <span class="s3">2 </span><span class="s0">if </span><span class="s1">vertOn </span><span class="s0">else </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len([line </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">multi.hlines </span><span class="s0">if </span><span class="s1">line.get_visible()]) == (</span>
        <span class="s3">2 </span><span class="s0">if </span><span class="s1">horizOn </span><span class="s0">else </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s4"># After toggling settings, the opposite lines should be visible after move.</span>
    <span class="s1">multi.horizOn = </span><span class="s0">not </span><span class="s1">multi.horizOn</span>
    <span class="s1">multi.vertOn = </span><span class="s0">not </span><span class="s1">multi.vertOn</span>
    <span class="s1">event = mock_event(ax1</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">.5</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">.25</span><span class="s1">)</span>
    <span class="s1">multi.onmove(event)</span>
    <span class="s0">assert </span><span class="s1">len([line </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">multi.vlines </span><span class="s0">if </span><span class="s1">line.get_visible()]) == (</span>
        <span class="s3">0 </span><span class="s0">if </span><span class="s1">vertOn </span><span class="s0">else </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len([line </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">multi.hlines </span><span class="s0">if </span><span class="s1">line.get_visible()]) == (</span>
        <span class="s3">0 </span><span class="s0">if </span><span class="s1">horizOn </span><span class="s0">else </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s4"># test a move event in an Axes not part of the MultiCursor</span>
    <span class="s4"># the lines in ax1 and ax2 should not have moved.</span>
    <span class="s1">event = mock_event(ax3</span><span class="s0">, </span><span class="s1">xdata=</span><span class="s3">.75</span><span class="s0">, </span><span class="s1">ydata=</span><span class="s3">.75</span><span class="s1">)</span>
    <span class="s1">multi.onmove(event)</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">multi.vlines:</span>
        <span class="s0">assert </span><span class="s1">l.get_xdata() == (</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">multi.hlines:</span>
        <span class="s0">assert </span><span class="s1">l.get_ydata() == (</span><span class="s3">.25</span><span class="s0">, </span><span class="s3">.25</span><span class="s1">)</span>
</pre>
</body>
</html>