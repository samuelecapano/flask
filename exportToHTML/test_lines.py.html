<html>
<head>
<title>test_lines.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_lines.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests specific to the lines module. 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">itertools</span>
<span class="s2">import </span><span class="s1">platform</span>
<span class="s2">import </span><span class="s1">timeit</span>
<span class="s2">from </span><span class="s1">types </span><span class="s2">import </span><span class="s1">SimpleNamespace</span>

<span class="s2">from </span><span class="s1">cycler </span><span class="s2">import </span><span class="s1">cycler</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy.testing </span><span class="s2">import </span><span class="s1">assert_array_equal</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">import </span><span class="s1">matplotlib</span>
<span class="s2">import </span><span class="s1">matplotlib </span><span class="s2">as </span><span class="s1">mpl</span>
<span class="s2">import </span><span class="s1">matplotlib.lines </span><span class="s2">as </span><span class="s1">mlines</span>
<span class="s2">from </span><span class="s1">matplotlib.markers </span><span class="s2">import </span><span class="s1">MarkerStyle</span>
<span class="s2">from </span><span class="s1">matplotlib.path </span><span class="s2">import </span><span class="s1">Path</span>
<span class="s2">import </span><span class="s1">matplotlib.pyplot </span><span class="s2">as </span><span class="s1">plt</span>
<span class="s2">import </span><span class="s1">matplotlib.transforms </span><span class="s2">as </span><span class="s1">mtransforms</span>
<span class="s2">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s2">import </span><span class="s1">image_comparison</span><span class="s2">, </span><span class="s1">check_figures_equal</span>
<span class="s2">from </span><span class="s1">matplotlib._api.deprecation </span><span class="s2">import </span><span class="s1">MatplotlibDeprecationWarning</span>


<span class="s2">def </span><span class="s1">test_segment_hits():</span>
    <span class="s0">&quot;&quot;&quot;Test a problematic case.&quot;&quot;&quot;</span>
    <span class="s1">cx</span><span class="s2">, </span><span class="s1">cy = </span><span class="s3">553</span><span class="s2">, </span><span class="s3">902</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y = np.array([</span><span class="s3">553.</span><span class="s2">, </span><span class="s3">553.</span><span class="s1">])</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">95.</span><span class="s2">, </span><span class="s3">947.</span><span class="s1">])</span>
    <span class="s1">radius = </span><span class="s3">6.94</span>
    <span class="s1">assert_array_equal(mlines.segment_hits(cx</span><span class="s2">, </span><span class="s1">cy</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">radius)</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">])</span>


<span class="s4"># Runtimes on a loaded system are inherently flaky. Not so much that a rerun</span>
<span class="s4"># won't help, hopefully.</span>
<span class="s1">@pytest.mark.flaky(reruns=</span><span class="s3">3</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_invisible_Line_rendering():</span>
    <span class="s0">&quot;&quot;&quot; 
    GitHub issue #1256 identified a bug in Line.draw method 
 
    Despite visibility attribute set to False, the draw method was not 
    returning early enough and some pre-rendering code was executed 
    though not necessary. 
 
    Consequence was an excessive draw time for invisible Line instances 
    holding a large number of points (Npts&gt; 10**6) 
    &quot;&quot;&quot;</span>
    <span class="s4"># Creates big x and y data:</span>
    <span class="s1">N = </span><span class="s3">10</span><span class="s1">**</span><span class="s3">7</span>
    <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">N)</span>
    <span class="s1">y = np.random.normal(size=N)</span>

    <span class="s4"># Create a plot figure:</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = plt.subplot()</span>

    <span class="s4"># Create a &quot;big&quot; Line instance:</span>
    <span class="s1">l = mlines.Line2D(x</span><span class="s2">, </span><span class="s1">y)</span>
    <span class="s1">l.set_visible(</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s4"># but don't add it to the Axis instance `ax`</span>

    <span class="s4"># [here Interactive panning and zooming is pretty responsive]</span>
    <span class="s4"># Time the canvas drawing:</span>
    <span class="s1">t_no_line = min(timeit.repeat(fig.canvas.draw</span><span class="s2">, </span><span class="s1">number=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">repeat=</span><span class="s3">3</span><span class="s1">))</span>
    <span class="s4"># (gives about 25 ms)</span>

    <span class="s4"># Add the big invisible Line:</span>
    <span class="s1">ax.add_line(l)</span>

    <span class="s4"># [Now interactive panning and zooming is very slow]</span>
    <span class="s4"># Time the canvas drawing:</span>
    <span class="s1">t_invisible_line = min(timeit.repeat(fig.canvas.draw</span><span class="s2">, </span><span class="s1">number=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">repeat=</span><span class="s3">3</span><span class="s1">))</span>
    <span class="s4"># gives about 290 ms for N = 10**7 pts</span>

    <span class="s1">slowdown_factor = t_invisible_line / t_no_line</span>
    <span class="s1">slowdown_threshold = </span><span class="s3">2  </span><span class="s4"># trying to avoid false positive failures</span>
    <span class="s2">assert </span><span class="s1">slowdown_factor &lt; slowdown_threshold</span>


<span class="s2">def </span><span class="s1">test_set_line_coll_dash():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">np.random.seed(</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s4"># Testing setting linestyles for line collections.</span>
    <span class="s4"># This should not produce an error.</span>
    <span class="s1">ax.contour(np.random.randn(</span><span class="s3">20</span><span class="s2">, </span><span class="s3">30</span><span class="s1">)</span><span class="s2">, </span><span class="s1">linestyles=[(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">))])</span>


<span class="s2">def </span><span class="s1">test_invalid_line_data():</span>
    <span class="s2">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s2">, </span><span class="s1">match=</span><span class="s5">'xdata must be'</span><span class="s1">):</span>
        <span class="s1">mlines.Line2D(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">[])</span>
    <span class="s2">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s2">, </span><span class="s1">match=</span><span class="s5">'ydata must be'</span><span class="s1">):</span>
        <span class="s1">mlines.Line2D([]</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">line = mlines.Line2D([]</span><span class="s2">, </span><span class="s1">[])</span>
    <span class="s4"># when deprecation cycle is completed</span>
    <span class="s4"># with pytest.raises(RuntimeError, match='x must be'):</span>
    <span class="s2">with </span><span class="s1">pytest.warns(MatplotlibDeprecationWarning):</span>
        <span class="s1">line.set_xdata(</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s4"># with pytest.raises(RuntimeError, match='y must be'):</span>
    <span class="s2">with </span><span class="s1">pytest.warns(MatplotlibDeprecationWarning):</span>
        <span class="s1">line.set_ydata(</span><span class="s3">0</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s5">'line_dashes'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">remove_text=</span><span class="s2">True</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_line_dashes():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">linestyle=(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">))</span><span class="s2">, </span><span class="s1">lw=</span><span class="s3">5</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_line_colors():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=</span><span class="s5">'none'</span><span class="s1">)</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=</span><span class="s5">'r'</span><span class="s1">)</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=</span><span class="s5">'.3'</span><span class="s1">)</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">))</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s2">def </span><span class="s1">test_valid_colors():</span>
    <span class="s1">line = mlines.Line2D([]</span><span class="s2">, </span><span class="s1">[])</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">line.set_color(</span><span class="s5">&quot;foobar&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_linestyle_variants():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s2">for </span><span class="s1">ls </span><span class="s2">in </span><span class="s1">[</span><span class="s5">&quot;-&quot;</span><span class="s2">, </span><span class="s5">&quot;solid&quot;</span><span class="s2">, </span><span class="s5">&quot;--&quot;</span><span class="s2">, </span><span class="s5">&quot;dashed&quot;</span><span class="s2">,</span>
               <span class="s5">&quot;-.&quot;</span><span class="s2">, </span><span class="s5">&quot;dashdot&quot;</span><span class="s2">, </span><span class="s5">&quot;:&quot;</span><span class="s2">, </span><span class="s5">&quot;dotted&quot;</span><span class="s2">,</span>
               <span class="s1">(</span><span class="s3">0</span><span class="s2">, None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">())</span><span class="s2">, </span><span class="s1">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">[])</span><span class="s2">,  </span><span class="s4"># gh-22930</span>
               <span class="s1">]:</span>
        <span class="s1">ax.plot(range(</span><span class="s3">10</span><span class="s1">)</span><span class="s2">, </span><span class="s1">linestyle=ls)</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s2">def </span><span class="s1">test_valid_linestyles():</span>
    <span class="s1">line = mlines.Line2D([]</span><span class="s2">, </span><span class="s1">[])</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">line.set_linestyle(</span><span class="s5">'aardvark'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s5">'drawstyle_variants.png'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">remove_text=</span><span class="s2">True</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_drawstyle_variants():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">6</span><span class="s1">)</span>
    <span class="s1">dss = [</span><span class="s5">&quot;default&quot;</span><span class="s2">, </span><span class="s5">&quot;steps-mid&quot;</span><span class="s2">, </span><span class="s5">&quot;steps-pre&quot;</span><span class="s2">, </span><span class="s5">&quot;steps-post&quot;</span><span class="s2">, </span><span class="s5">&quot;steps&quot;</span><span class="s2">, None</span><span class="s1">]</span>
    <span class="s4"># We want to check that drawstyles are properly handled even for very long</span>
    <span class="s4"># lines (for which the subslice optimization is on); however, we need</span>
    <span class="s4"># to zoom in so that the difference between the drawstyles is actually</span>
    <span class="s4"># visible.</span>
    <span class="s2">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">ds </span><span class="s2">in </span><span class="s1">zip(axs.flat</span><span class="s2">, </span><span class="s1">dss):</span>
        <span class="s1">ax.plot(range(</span><span class="s3">2000</span><span class="s1">)</span><span class="s2">, </span><span class="s1">drawstyle=ds)</span>
        <span class="s1">ax.set(xlim=(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">, </span><span class="s1">ylim=(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s1">))</span>


<span class="s1">@check_figures_equal(extensions=(</span><span class="s5">'png'</span><span class="s2">,</span><span class="s1">))</span>
<span class="s2">def </span><span class="s1">test_no_subslice_with_transform(fig_ref</span><span class="s2">, </span><span class="s1">fig_test):</span>
    <span class="s1">ax = fig_ref.add_subplot()</span>
    <span class="s1">x = np.arange(</span><span class="s3">2000</span><span class="s1">)</span>
    <span class="s1">ax.plot(x + </span><span class="s3">2000</span><span class="s2">, </span><span class="s1">x)</span>

    <span class="s1">ax = fig_test.add_subplot()</span>
    <span class="s1">t = mtransforms.Affine2D().translate(</span><span class="s3">2000.0</span><span class="s2">, </span><span class="s3">0.0</span><span class="s1">)</span>
    <span class="s1">ax.plot(x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">transform=t+ax.transData)</span>


<span class="s2">def </span><span class="s1">test_valid_drawstyles():</span>
    <span class="s1">line = mlines.Line2D([]</span><span class="s2">, </span><span class="s1">[])</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">line.set_drawstyle(</span><span class="s5">'foobar'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">test_set_drawstyle():</span>
    <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s1">*np.pi</span><span class="s2">, </span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">y = np.sin(x)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line</span><span class="s2">, </span><span class="s1">= ax.plot(x</span><span class="s2">, </span><span class="s1">y)</span>
    <span class="s1">line.set_drawstyle(</span><span class="s5">&quot;steps-pre&quot;</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">len(line.get_path().vertices) == </span><span class="s3">2</span><span class="s1">*len(x)-</span><span class="s3">1</span>

    <span class="s1">line.set_drawstyle(</span><span class="s5">&quot;default&quot;</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">len(line.get_path().vertices) == len(x)</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s5">'line_collection_dashes'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">remove_text=</span><span class="s2">True, </span><span class="s1">style=</span><span class="s5">'mpl20'</span><span class="s2">,</span>
    <span class="s1">tol=</span><span class="s3">0.62 </span><span class="s2">if </span><span class="s1">platform.machine() </span><span class="s2">in </span><span class="s1">(</span><span class="s5">'aarch64'</span><span class="s2">, </span><span class="s5">'ppc64le'</span><span class="s2">, </span><span class="s5">'s390x'</span><span class="s1">) </span><span class="s2">else </span><span class="s3">0</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_set_line_coll_dash_image():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">np.random.seed(</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">ax.contour(np.random.randn(</span><span class="s3">20</span><span class="s2">, </span><span class="s3">30</span><span class="s1">)</span><span class="s2">, </span><span class="s1">linestyles=[(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">))])</span>


<span class="s1">@image_comparison([</span><span class="s5">'marker_fill_styles.png'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">remove_text=</span><span class="s2">True</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_marker_fill_styles():</span>
    <span class="s1">colors = itertools.cycle([[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'#ff0000'</span><span class="s2">, </span><span class="s5">'c'</span><span class="s2">, </span><span class="s5">'m'</span><span class="s2">, </span><span class="s5">'y'</span><span class="s2">,</span>
                              <span class="s1">np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">])])</span>
    <span class="s1">altcolor = </span><span class="s5">'lightgreen'</span>

    <span class="s1">y = np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">x = np.array([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">9</span><span class="s1">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s4"># This hard-coded list of markers correspond to an earlier iteration of</span>
    <span class="s4"># MarkerStyle.filled_markers; the value of that attribute has changed but</span>
    <span class="s4"># we kept the old value here to not regenerate the baseline image.</span>
    <span class="s4"># Replace with mlines.Line2D.filled_markers when the image is regenerated.</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">marker </span><span class="s2">in </span><span class="s1">enumerate(</span><span class="s5">&quot;ov^&lt;&gt;8sp*hHDdPX&quot;</span><span class="s1">):</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">fs </span><span class="s2">in </span><span class="s1">enumerate(mlines.Line2D.fillStyles):</span>
            <span class="s1">color = next(colors)</span>
            <span class="s1">ax.plot(j * </span><span class="s3">10 </span><span class="s1">+ x</span><span class="s2">, </span><span class="s1">y + i + </span><span class="s3">.5 </span><span class="s1">* (j % </span><span class="s3">2</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">marker=marker</span><span class="s2">,</span>
                    <span class="s1">markersize=</span><span class="s3">20</span><span class="s2">,</span>
                    <span class="s1">markerfacecoloralt=altcolor</span><span class="s2">,</span>
                    <span class="s1">fillstyle=fs</span><span class="s2">,</span>
                    <span class="s1">label=fs</span><span class="s2">,</span>
                    <span class="s1">linewidth=</span><span class="s3">5</span><span class="s2">,</span>
                    <span class="s1">color=color</span><span class="s2">,</span>
                    <span class="s1">markeredgecolor=color</span><span class="s2">,</span>
                    <span class="s1">markeredgewidth=</span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">ax.set_ylim([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">7.5</span><span class="s1">])</span>
    <span class="s1">ax.set_xlim([-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">155</span><span class="s1">])</span>


<span class="s2">def </span><span class="s1">test_markerfacecolor_fillstyle():</span>
    <span class="s0">&quot;&quot;&quot;Test that markerfacecolor does not override fillstyle='none'.&quot;&quot;&quot;</span>
    <span class="s1">l</span><span class="s2">, </span><span class="s1">= plt.plot([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">marker=MarkerStyle(</span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">fillstyle=</span><span class="s5">'none'</span><span class="s1">)</span><span class="s2">,</span>
                  <span class="s1">markerfacecolor=</span><span class="s5">'red'</span><span class="s1">)</span>
    <span class="s2">assert </span><span class="s1">l.get_fillstyle() == </span><span class="s5">'none'</span>
    <span class="s2">assert </span><span class="s1">l.get_markerfacecolor() == </span><span class="s5">'none'</span>


<span class="s1">@image_comparison([</span><span class="s5">'scaled_lines'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">style=</span><span class="s5">'default'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_lw_scaling():</span>
    <span class="s1">th = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">32</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">lins_styles = [</span><span class="s5">'dashed'</span><span class="s2">, </span><span class="s5">'dotted'</span><span class="s2">, </span><span class="s5">'dashdot'</span><span class="s1">]</span>
    <span class="s1">cy = cycler(matplotlib.rcParams[</span><span class="s5">'axes.prop_cycle'</span><span class="s1">])</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">(ls</span><span class="s2">, </span><span class="s1">sty) </span><span class="s2">in </span><span class="s1">enumerate(zip(lins_styles</span><span class="s2">, </span><span class="s1">cy)):</span>
        <span class="s2">for </span><span class="s1">lw </span><span class="s2">in </span><span class="s1">np.linspace(</span><span class="s3">.5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s1">):</span>
            <span class="s1">ax.plot(th</span><span class="s2">, </span><span class="s1">j*np.ones(</span><span class="s3">50</span><span class="s1">) + </span><span class="s3">.1 </span><span class="s1">* lw</span><span class="s2">, </span><span class="s1">linestyle=ls</span><span class="s2">, </span><span class="s1">lw=lw</span><span class="s2">, </span><span class="s1">**sty)</span>


<span class="s2">def </span><span class="s1">test_nan_is_sorted():</span>
    <span class="s1">line = mlines.Line2D([]</span><span class="s2">, </span><span class="s1">[])</span>
    <span class="s2">assert </span><span class="s1">line._is_sorted(np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]))</span>
    <span class="s2">assert </span><span class="s1">line._is_sorted(np.array([</span><span class="s3">1</span><span class="s2">, </span><span class="s1">np.nan</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]))</span>
    <span class="s2">assert not </span><span class="s1">line._is_sorted([</span><span class="s3">3</span><span class="s2">, </span><span class="s3">5</span><span class="s1">] + [np.nan] * </span><span class="s3">100 </span><span class="s1">+ [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s1">])</span>


<span class="s1">@check_figures_equal()</span>
<span class="s2">def </span><span class="s1">test_step_markers(fig_test</span><span class="s2">, </span><span class="s1">fig_ref):</span>
    <span class="s1">fig_test.subplots().step([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">&quot;-o&quot;</span><span class="s1">)</span>
    <span class="s1">fig_ref.subplots().plot([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s5">&quot;-o&quot;</span><span class="s2">, </span><span class="s1">markevery=[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s1">])</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s5">&quot;parent&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s5">&quot;figure&quot;</span><span class="s2">, </span><span class="s5">&quot;axes&quot;</span><span class="s1">])</span>
<span class="s1">@check_figures_equal(extensions=(</span><span class="s5">'png'</span><span class="s2">,</span><span class="s1">))</span>
<span class="s2">def </span><span class="s1">test_markevery(fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">parent):</span>
    <span class="s1">np.random.seed(</span><span class="s3">42</span><span class="s1">)</span>
    <span class="s1">x = np.linspace(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">14</span><span class="s1">)</span>
    <span class="s1">y = np.random.rand(len(x))</span>

    <span class="s1">cases_test = [</span><span class="s2">None, </span><span class="s3">4</span><span class="s2">, </span><span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">11</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">slice(</span><span class="s3">5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span><span class="s2">,</span>
                  <span class="s1">np.arange(len(x))[y &gt; </span><span class="s3">0.5</span><span class="s1">]</span><span class="s2">,</span>
                  <span class="s3">0.3</span><span class="s2">, </span><span class="s1">(</span><span class="s3">0.3</span><span class="s2">, </span><span class="s3">0.4</span><span class="s1">)]</span>
    <span class="s1">cases_ref = [</span><span class="s5">&quot;11111111111111&quot;</span><span class="s2">, </span><span class="s5">&quot;10001000100010&quot;</span><span class="s2">, </span><span class="s5">&quot;00100001000010&quot;</span><span class="s2">,</span>
                 <span class="s5">&quot;01000100000100&quot;</span><span class="s2">, </span><span class="s5">&quot;10000000000001&quot;</span><span class="s2">, </span><span class="s5">&quot;00000101010000&quot;</span><span class="s2">,</span>
                 <span class="s5">&quot;01110001110110&quot;</span><span class="s2">, </span><span class="s5">&quot;11011011011110&quot;</span><span class="s2">, </span><span class="s5">&quot;01010011011101&quot;</span><span class="s1">]</span>

    <span class="s2">if </span><span class="s1">parent == </span><span class="s5">&quot;figure&quot;</span><span class="s1">:</span>
        <span class="s4"># float markevery (&quot;relative to axes size&quot;) is not supported.</span>
        <span class="s1">cases_test = cases_test[:-</span><span class="s3">2</span><span class="s1">]</span>
        <span class="s1">cases_ref = cases_ref[:-</span><span class="s3">2</span><span class="s1">]</span>

        <span class="s2">def </span><span class="s1">add_test(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">*</span><span class="s2">, </span><span class="s1">markevery):</span>
            <span class="s1">fig_test.add_artist(</span>
                <span class="s1">mlines.Line2D(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">marker=</span><span class="s5">&quot;o&quot;</span><span class="s2">, </span><span class="s1">markevery=markevery))</span>

        <span class="s2">def </span><span class="s1">add_ref(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">*</span><span class="s2">, </span><span class="s1">markevery):</span>
            <span class="s1">fig_ref.add_artist(</span>
                <span class="s1">mlines.Line2D(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">marker=</span><span class="s5">&quot;o&quot;</span><span class="s2">, </span><span class="s1">markevery=markevery))</span>

    <span class="s2">elif </span><span class="s1">parent == </span><span class="s5">&quot;axes&quot;</span><span class="s1">:</span>
        <span class="s1">axs_test = iter(fig_test.subplots(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">).flat)</span>
        <span class="s1">axs_ref = iter(fig_ref.subplots(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s1">).flat)</span>

        <span class="s2">def </span><span class="s1">add_test(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">*</span><span class="s2">, </span><span class="s1">markevery):</span>
            <span class="s1">next(axs_test).plot(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s5">&quot;-gD&quot;</span><span class="s2">, </span><span class="s1">markevery=markevery)</span>

        <span class="s2">def </span><span class="s1">add_ref(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">*</span><span class="s2">, </span><span class="s1">markevery):</span>
            <span class="s1">next(axs_ref).plot(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s5">&quot;-gD&quot;</span><span class="s2">, </span><span class="s1">markevery=markevery)</span>

    <span class="s2">for </span><span class="s1">case </span><span class="s2">in </span><span class="s1">cases_test:</span>
        <span class="s1">add_test(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">markevery=case)</span>

    <span class="s2">for </span><span class="s1">case </span><span class="s2">in </span><span class="s1">cases_ref:</span>
        <span class="s1">me = np.array(list(case)).astype(int).astype(bool)</span>
        <span class="s1">add_ref(x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">markevery=me)</span>


<span class="s2">def </span><span class="s1">test_markevery_figure_line_unsupported_relsize():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.add_artist(mlines.Line2D([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">marker=</span><span class="s5">&quot;o&quot;</span><span class="s2">, </span><span class="s1">markevery=</span><span class="s3">.5</span><span class="s1">))</span>
    <span class="s2">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">fig.canvas.draw()</span>


<span class="s2">def </span><span class="s1">test_marker_as_markerstyle():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">line</span><span class="s2">, </span><span class="s1">= ax.plot([</span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">marker=MarkerStyle(</span><span class="s5">&quot;D&quot;</span><span class="s1">))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s2">assert </span><span class="s1">line.get_marker() == </span><span class="s5">&quot;D&quot;</span>

    <span class="s4"># continue with smoke tests:</span>
    <span class="s1">line.set_marker(</span><span class="s5">&quot;s&quot;</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">line.set_marker(MarkerStyle(</span><span class="s5">&quot;o&quot;</span><span class="s1">))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s4"># test Path roundtrip</span>
    <span class="s1">triangle1 = Path._create_closed([[-</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">1</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]])</span>
    <span class="s1">line2</span><span class="s2">, </span><span class="s1">= ax.plot([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">marker=MarkerStyle(triangle1)</span><span class="s2">, </span><span class="s1">ms=</span><span class="s3">22</span><span class="s1">)</span>
    <span class="s1">line3</span><span class="s2">, </span><span class="s1">= ax.plot([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">marker=triangle1</span><span class="s2">, </span><span class="s1">ms=</span><span class="s3">22</span><span class="s1">)</span>

    <span class="s1">assert_array_equal(line2.get_marker().vertices</span><span class="s2">, </span><span class="s1">triangle1.vertices)</span>
    <span class="s1">assert_array_equal(line3.get_marker().vertices</span><span class="s2">, </span><span class="s1">triangle1.vertices)</span>


<span class="s1">@image_comparison([</span><span class="s5">'striped_line.png'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">remove_text=</span><span class="s2">True, </span><span class="s1">style=</span><span class="s5">'mpl20'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_striped_lines():</span>
    <span class="s1">rng = np.random.default_rng(</span><span class="s3">19680801</span><span class="s1">)</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(rng.uniform(size=</span><span class="s3">12</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=</span><span class="s5">'orange'</span><span class="s2">, </span><span class="s1">gapcolor=</span><span class="s5">'blue'</span><span class="s2">,</span>
            <span class="s1">linestyle=</span><span class="s5">'--'</span><span class="s2">, </span><span class="s1">lw=</span><span class="s3">5</span><span class="s2">, </span><span class="s1">label=</span><span class="s5">' '</span><span class="s1">)</span>
    <span class="s1">ax.plot(rng.uniform(size=</span><span class="s3">12</span><span class="s1">)</span><span class="s2">, </span><span class="s1">color=</span><span class="s5">'red'</span><span class="s2">, </span><span class="s1">gapcolor=</span><span class="s5">'black'</span><span class="s2">,</span>
            <span class="s1">linestyle=(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">2</span><span class="s1">))</span><span class="s2">, </span><span class="s1">lw=</span><span class="s3">5</span><span class="s2">, </span><span class="s1">label=</span><span class="s5">' '</span><span class="s2">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">ax.legend(handlelength=</span><span class="s3">5</span><span class="s1">)</span>


<span class="s1">@check_figures_equal()</span>
<span class="s2">def </span><span class="s1">test_odd_dashes(fig_test</span><span class="s2">, </span><span class="s1">fig_ref):</span>
    <span class="s1">fig_test.add_subplot().plot([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dashes=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">fig_ref.add_subplot().plot([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s1">]</span><span class="s2">, </span><span class="s1">dashes=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s1">])</span>


<span class="s2">def </span><span class="s1">test_picking():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">mouse_event = SimpleNamespace(x=fig.bbox.width // </span><span class="s3">2</span><span class="s2">,</span>
                                  <span class="s1">y=fig.bbox.height // </span><span class="s3">2 </span><span class="s1">+ </span><span class="s3">15</span><span class="s1">)</span>

    <span class="s4"># Default pickradius is 5, so event should not pick this line.</span>
    <span class="s1">l0</span><span class="s2">, </span><span class="s1">= ax.plot([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">picker=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s1">found</span><span class="s2">, </span><span class="s1">indices = l0.contains(mouse_event)</span>
    <span class="s2">assert not </span><span class="s1">found</span>

    <span class="s4"># But with a larger pickradius, this should be picked.</span>
    <span class="s1">l1</span><span class="s2">, </span><span class="s1">= ax.plot([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">picker=</span><span class="s2">True, </span><span class="s1">pickradius=</span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">found</span><span class="s2">, </span><span class="s1">indices = l1.contains(mouse_event)</span>
    <span class="s2">assert </span><span class="s1">found</span>
    <span class="s1">assert_array_equal(indices[</span><span class="s5">'ind'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">])</span>

    <span class="s4"># And if we modify the pickradius after creation, it should work as well.</span>
    <span class="s1">l2</span><span class="s2">, </span><span class="s1">= ax.plot([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">picker=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s1">found</span><span class="s2">, </span><span class="s1">indices = l2.contains(mouse_event)</span>
    <span class="s2">assert not </span><span class="s1">found</span>
    <span class="s1">l2.set_pickradius(</span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">found</span><span class="s2">, </span><span class="s1">indices = l2.contains(mouse_event)</span>
    <span class="s2">assert </span><span class="s1">found</span>
    <span class="s1">assert_array_equal(indices[</span><span class="s5">'ind'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">])</span>


<span class="s1">@check_figures_equal()</span>
<span class="s2">def </span><span class="s1">test_input_copy(fig_test</span><span class="s2">, </span><span class="s1">fig_ref):</span>

    <span class="s1">t = np.arange(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">l</span><span class="s2">, </span><span class="s1">= fig_test.add_subplot().plot(t</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s5">&quot;.-&quot;</span><span class="s1">)</span>
    <span class="s1">t[:] = range(</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s4"># Trigger cache invalidation</span>
    <span class="s1">l.set_drawstyle(</span><span class="s5">&quot;steps&quot;</span><span class="s1">)</span>
    <span class="s1">fig_ref.add_subplot().plot([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s1">]</span><span class="s2">, </span><span class="s5">&quot;.-&quot;</span><span class="s2">, </span><span class="s1">drawstyle=</span><span class="s5">&quot;steps&quot;</span><span class="s1">)</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s5">&quot;png&quot;</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_markevery_prop_cycle(fig_test</span><span class="s2">, </span><span class="s1">fig_ref):</span>
    <span class="s0">&quot;&quot;&quot;Test that we can set markevery prop_cycle.&quot;&quot;&quot;</span>
    <span class="s1">cases = [</span><span class="s2">None, </span><span class="s3">8</span><span class="s2">, </span><span class="s1">(</span><span class="s3">30</span><span class="s2">, </span><span class="s3">8</span><span class="s1">)</span><span class="s2">, </span><span class="s1">[</span><span class="s3">16</span><span class="s2">, </span><span class="s3">24</span><span class="s2">, </span><span class="s3">30</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">,</span>
             <span class="s1">slice(</span><span class="s3">100</span><span class="s2">, </span><span class="s3">200</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s3">0.1</span><span class="s2">, </span><span class="s3">0.3</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">,</span>
             <span class="s1">(</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">0.1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">0.45</span><span class="s2">, </span><span class="s3">0.1</span><span class="s1">)]</span>

    <span class="s1">cmap = mpl.colormaps[</span><span class="s5">'jet'</span><span class="s1">]</span>
    <span class="s1">colors = cmap(np.linspace(</span><span class="s3">0.2</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s1">len(cases)))</span>

    <span class="s1">x = np.linspace(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">y = </span><span class="s3">5 </span><span class="s1">* x**</span><span class="s3">2</span>

    <span class="s1">axs = fig_ref.add_subplot()</span>
    <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">markevery </span><span class="s2">in </span><span class="s1">enumerate(cases):</span>
        <span class="s1">axs.plot(y - i</span><span class="s2">, </span><span class="s5">'o-'</span><span class="s2">, </span><span class="s1">markevery=markevery</span><span class="s2">, </span><span class="s1">color=colors[i])</span>

    <span class="s1">matplotlib.rcParams[</span><span class="s5">'axes.prop_cycle'</span><span class="s1">] = cycler(markevery=cases</span><span class="s2">,</span>
                                                    <span class="s1">color=colors)</span>

    <span class="s1">ax = fig_test.add_subplot()</span>
    <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">in </span><span class="s1">enumerate(cases):</span>
        <span class="s1">ax.plot(y - i</span><span class="s2">, </span><span class="s5">'o-'</span><span class="s1">)</span>
</pre>
</body>
</html>