<html>
<head>
<title>test_dates.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_dates.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime</span>

<span class="s0">import </span><span class="s1">dateutil.tz</span>
<span class="s0">import </span><span class="s1">dateutil.rrule</span>
<span class="s0">import </span><span class="s1">functools</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">_api</span><span class="s0">, </span><span class="s1">rc_context</span><span class="s0">, </span><span class="s1">style</span>
<span class="s0">import </span><span class="s1">matplotlib.dates </span><span class="s0">as </span><span class="s1">mdates</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">matplotlib.ticker </span><span class="s0">as </span><span class="s1">mticker</span>


<span class="s0">def </span><span class="s1">test_date_numpyx():</span>
    <span class="s2"># test that numpy dates work properly...</span>
    <span class="s1">base = datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">time = [base + datetime.timedelta(days=x) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)]</span>
    <span class="s1">timenp = np.array(time</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">'datetime64[ns]'</span><span class="s1">)</span>
    <span class="s1">data = np.array([</span><span class="s3">0.</span><span class="s0">, </span><span class="s3">2.</span><span class="s0">, </span><span class="s3">1.</span><span class="s1">])</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">h</span><span class="s0">, </span><span class="s1">= ax.plot(time</span><span class="s0">, </span><span class="s1">data)</span>
    <span class="s1">hnp</span><span class="s0">, </span><span class="s1">= ax.plot(timenp</span><span class="s0">, </span><span class="s1">data)</span>
    <span class="s1">np.testing.assert_equal(h.get_xdata(orig=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">hnp.get_xdata(orig=</span><span class="s0">False</span><span class="s1">))</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">h</span><span class="s0">, </span><span class="s1">= ax.plot(data</span><span class="s0">, </span><span class="s1">time)</span>
    <span class="s1">hnp</span><span class="s0">, </span><span class="s1">= ax.plot(data</span><span class="s0">, </span><span class="s1">timenp)</span>
    <span class="s1">np.testing.assert_equal(h.get_ydata(orig=</span><span class="s0">False</span><span class="s1">)</span><span class="s0">, </span><span class="s1">hnp.get_ydata(orig=</span><span class="s0">False</span><span class="s1">))</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'t0'</span><span class="s0">, </span><span class="s1">[datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>

                                <span class="s1">[datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                 <span class="s1">datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">,</span>

                                <span class="s1">[[datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                  <span class="s1">datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">,</span>
                                 <span class="s1">[datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                  <span class="s1">datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]]])</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'dtype'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'datetime64[s]'</span><span class="s0">,</span>
                                   <span class="s4">'datetime64[us]'</span><span class="s0">,</span>
                                   <span class="s4">'datetime64[ms]'</span><span class="s0">,</span>
                                   <span class="s4">'datetime64[ns]'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date_date2num_numpy(t0</span><span class="s0">, </span><span class="s1">dtype):</span>
    <span class="s1">time = mdates.date2num(t0)</span>
    <span class="s1">tnp = np.array(t0</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">nptime = mdates.date2num(tnp)</span>
    <span class="s1">np.testing.assert_equal(time</span><span class="s0">, </span><span class="s1">nptime)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'dtype'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'datetime64[s]'</span><span class="s0">,</span>
                                   <span class="s4">'datetime64[us]'</span><span class="s0">,</span>
                                   <span class="s4">'datetime64[ms]'</span><span class="s0">,</span>
                                   <span class="s4">'datetime64[ns]'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date2num_NaT(dtype):</span>
    <span class="s1">t0 = datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">tmpl = [mdates.date2num(t0)</span><span class="s0">, </span><span class="s1">np.nan]</span>
    <span class="s1">tnp = np.array([t0</span><span class="s0">, </span><span class="s4">'NaT'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">dtype=dtype)</span>
    <span class="s1">nptime = mdates.date2num(tnp)</span>
    <span class="s1">np.testing.assert_array_equal(tmpl</span><span class="s0">, </span><span class="s1">nptime)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'units'</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'s'</span><span class="s0">, </span><span class="s4">'ms'</span><span class="s0">, </span><span class="s4">'us'</span><span class="s0">, </span><span class="s4">'ns'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date2num_NaT_scalar(units):</span>
    <span class="s1">tmpl = mdates.date2num(np.datetime64(</span><span class="s4">'NaT'</span><span class="s0">, </span><span class="s1">units))</span>
    <span class="s0">assert </span><span class="s1">np.isnan(tmpl)</span>


<span class="s0">def </span><span class="s1">test_date2num_masked():</span>
    <span class="s2"># Without tzinfo</span>
    <span class="s1">base = datetime.datetime(</span><span class="s3">2022</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">15</span><span class="s1">)</span>
    <span class="s1">dates = np.ma.array([base + datetime.timedelta(days=(</span><span class="s3">2 </span><span class="s1">* i))</span>
                         <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">7</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">npdates = mdates.date2num(dates)</span>
    <span class="s1">np.testing.assert_array_equal(np.ma.getmask(npdates)</span><span class="s0">,</span>
                                  <span class="s1">(</span><span class="s0">False, True, True, False, False, False,</span>
                                   <span class="s0">True</span><span class="s1">))</span>

    <span class="s2"># With tzinfo</span>
    <span class="s1">base = datetime.datetime(</span><span class="s3">2022</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">15</span><span class="s0">, </span><span class="s1">tzinfo=mdates.UTC)</span>
    <span class="s1">dates = np.ma.array([base + datetime.timedelta(days=(</span><span class="s3">2 </span><span class="s1">* i))</span>
                         <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">7</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">mask=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">npdates = mdates.date2num(dates)</span>
    <span class="s1">np.testing.assert_array_equal(np.ma.getmask(npdates)</span><span class="s0">,</span>
                                  <span class="s1">(</span><span class="s0">False, True, True, False, False, False,</span>
                                   <span class="s0">True</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_date_empty():</span>
    <span class="s2"># make sure we do the right thing when told to plot dates even</span>
    <span class="s2"># if no date data has been presented, cf</span>
    <span class="s2"># http://sourceforge.net/tracker/?func=detail&amp;aid=2850075&amp;group_id=80706&amp;atid=560720</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.xaxis_date()</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">np.testing.assert_allclose(ax.get_xlim()</span><span class="s0">,</span>
                               <span class="s1">[mdates.date2num(np.datetime64(</span><span class="s4">'1970-01-01'</span><span class="s1">))</span><span class="s0">,</span>
                                <span class="s1">mdates.date2num(np.datetime64(</span><span class="s4">'1970-01-02'</span><span class="s1">))])</span>

    <span class="s1">mdates._reset_epoch_test_example()</span>
    <span class="s1">mdates.set_epoch(</span><span class="s4">'0000-12-31'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.xaxis_date()</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">np.testing.assert_allclose(ax.get_xlim()</span><span class="s0">,</span>
                               <span class="s1">[mdates.date2num(np.datetime64(</span><span class="s4">'1970-01-01'</span><span class="s1">))</span><span class="s0">,</span>
                                <span class="s1">mdates.date2num(np.datetime64(</span><span class="s4">'1970-01-02'</span><span class="s1">))])</span>
    <span class="s1">mdates._reset_epoch_test_example()</span>


<span class="s0">def </span><span class="s1">test_date_not_empty():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot()</span>

    <span class="s1">ax.plot([</span><span class="s3">50</span><span class="s0">, </span><span class="s3">70</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">ax.xaxis.axis_date()</span>
    <span class="s1">np.testing.assert_allclose(ax.get_xlim()</span><span class="s0">, </span><span class="s1">[</span><span class="s3">50</span><span class="s0">, </span><span class="s3">70</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_axhline():</span>
    <span class="s2"># make sure that axhline doesn't set the xlimits...</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.axhline(</span><span class="s3">1.5</span><span class="s1">)</span>
    <span class="s1">ax.plot([np.datetime64(</span><span class="s4">'2016-01-01'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.datetime64(</span><span class="s4">'2016-01-02'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">np.testing.assert_allclose(ax.get_xlim()</span><span class="s0">,</span>
                               <span class="s1">[mdates.date2num(np.datetime64(</span><span class="s4">'2016-01-01'</span><span class="s1">))</span><span class="s0">,</span>
                                <span class="s1">mdates.date2num(np.datetime64(</span><span class="s4">'2016-01-02'</span><span class="s1">))])</span>

    <span class="s1">mdates._reset_epoch_test_example()</span>
    <span class="s1">mdates.set_epoch(</span><span class="s4">'0000-12-31'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.axhline(</span><span class="s3">1.5</span><span class="s1">)</span>
    <span class="s1">ax.plot([np.datetime64(</span><span class="s4">'2016-01-01'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.datetime64(</span><span class="s4">'2016-01-02'</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">np.testing.assert_allclose(ax.get_xlim()</span><span class="s0">,</span>
                               <span class="s1">[mdates.date2num(np.datetime64(</span><span class="s4">'2016-01-01'</span><span class="s1">))</span><span class="s0">,</span>
                                <span class="s1">mdates.date2num(np.datetime64(</span><span class="s4">'2016-01-02'</span><span class="s1">))])</span>
    <span class="s1">mdates._reset_epoch_test_example()</span>


<span class="s1">@image_comparison([</span><span class="s4">'date_axhspan.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date_axhspan():</span>
    <span class="s2"># test axhspan with date inputs</span>
    <span class="s1">t0 = datetime.datetime(</span><span class="s3">2009</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">tf = datetime.datetime(</span><span class="s3">2009</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">21</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.axhspan(t0</span><span class="s0">, </span><span class="s1">tf</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s4">&quot;blue&quot;</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.25</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(t0 - datetime.timedelta(days=</span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">tf + datetime.timedelta(days=</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">fig.subplots_adjust(left=</span><span class="s3">0.25</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'date_axvspan.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date_axvspan():</span>
    <span class="s2"># test axvspan with date inputs</span>
    <span class="s1">t0 = datetime.datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">tf = datetime.datetime(</span><span class="s3">2010</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">21</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.axvspan(t0</span><span class="s0">, </span><span class="s1">tf</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s4">&quot;blue&quot;</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.25</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(t0 - datetime.timedelta(days=</span><span class="s3">720</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">tf + datetime.timedelta(days=</span><span class="s3">720</span><span class="s1">))</span>
    <span class="s1">fig.autofmt_xdate()</span>


<span class="s1">@image_comparison([</span><span class="s4">'date_axhline.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date_axhline():</span>
    <span class="s2"># test axhline with date inputs</span>
    <span class="s1">t0 = datetime.datetime(</span><span class="s3">2009</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">tf = datetime.datetime(</span><span class="s3">2009</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">31</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.axhline(t0</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">&quot;blue&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(t0 - datetime.timedelta(days=</span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">tf + datetime.timedelta(days=</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">fig.subplots_adjust(left=</span><span class="s3">0.25</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s4">'date_axvline.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date_axvline():</span>
    <span class="s2"># test axvline with date inputs</span>
    <span class="s1">t0 = datetime.datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">tf = datetime.datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">21</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.axvline(t0</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">&quot;red&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(t0 - datetime.timedelta(days=</span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">tf + datetime.timedelta(days=</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">fig.autofmt_xdate()</span>


<span class="s0">def </span><span class="s1">test_too_many_date_ticks(caplog):</span>
    <span class="s2"># Attempt to test SF 2715172, see</span>
    <span class="s2"># https://sourceforge.net/tracker/?func=detail&amp;aid=2715172&amp;group_id=80706&amp;atid=560720</span>
    <span class="s2"># setting equal datetimes triggers and expander call in</span>
    <span class="s2"># transforms.nonsingular which results in too many ticks in the</span>
    <span class="s2"># DayLocator.  This should emit a log at WARNING level.</span>
    <span class="s1">caplog.set_level(</span><span class="s4">&quot;WARNING&quot;</span><span class="s1">)</span>
    <span class="s1">t0 = datetime.datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">tf = datetime.datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning) </span><span class="s0">as </span><span class="s1">rec:</span>
        <span class="s1">ax.set_xlim((t0</span><span class="s0">, </span><span class="s1">tf)</span><span class="s0">, </span><span class="s1">auto=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">len(rec) == </span><span class="s3">1</span>
        <span class="s0">assert </span><span class="s1">(</span><span class="s4">'Attempting to set identical low and high xlims'</span>
                <span class="s0">in </span><span class="s1">str(rec[</span><span class="s3">0</span><span class="s1">].message))</span>
    <span class="s1">ax.plot([]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">ax.xaxis.set_major_locator(mdates.DayLocator())</span>
    <span class="s1">v = ax.xaxis.get_major_locator()()</span>
    <span class="s0">assert </span><span class="s1">len(v) &gt; </span><span class="s3">1000</span>
    <span class="s2"># The warning is emitted multiple times because the major locator is also</span>
    <span class="s2"># called both when placing the minor ticks (for overstriking detection) and</span>
    <span class="s2"># during tick label positioning.</span>
    <span class="s0">assert </span><span class="s1">caplog.records </span><span class="s0">and </span><span class="s1">all(</span>
        <span class="s1">record.name == </span><span class="s4">&quot;matplotlib.ticker&quot; </span><span class="s0">and </span><span class="s1">record.levelname == </span><span class="s4">&quot;WARNING&quot;</span>
        <span class="s0">for </span><span class="s1">record </span><span class="s0">in </span><span class="s1">caplog.records)</span>
    <span class="s0">assert </span><span class="s1">len(caplog.records) &gt; </span><span class="s3">0</span>


<span class="s0">def </span><span class="s1">_new_epoch_decorator(thefunc):</span>
    <span class="s1">@functools.wraps(thefunc)</span>
    <span class="s0">def </span><span class="s1">wrapper():</span>
        <span class="s1">mdates._reset_epoch_test_example()</span>
        <span class="s1">mdates.set_epoch(</span><span class="s4">'2000-01-01'</span><span class="s1">)</span>
        <span class="s1">thefunc()</span>
        <span class="s1">mdates._reset_epoch_test_example()</span>
    <span class="s0">return </span><span class="s1">wrapper</span>


<span class="s1">@image_comparison([</span><span class="s4">'RRuleLocator_bounds.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_RRuleLocator():</span>
    <span class="s0">import </span><span class="s1">matplotlib.testing.jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units.register()</span>
    <span class="s2"># This will cause the RRuleLocator to go out of bounds when it tries</span>
    <span class="s2"># to add padding to the limits, so we make sure it caps at the correct</span>
    <span class="s2"># boundary values.</span>
    <span class="s1">t0 = datetime.datetime(</span><span class="s3">1000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">tf = datetime.datetime(</span><span class="s3">6000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = plt.subplot()</span>
    <span class="s1">ax.set_autoscale_on(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.plot([t0</span><span class="s0">, </span><span class="s1">tf]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">'o'</span><span class="s1">)</span>

    <span class="s1">rrule = mdates.rrulewrapper(dateutil.rrule.YEARLY</span><span class="s0">, </span><span class="s1">interval=</span><span class="s3">500</span><span class="s1">)</span>
    <span class="s1">locator = mdates.RRuleLocator(rrule)</span>
    <span class="s1">ax.xaxis.set_major_locator(locator)</span>
    <span class="s1">ax.xaxis.set_major_formatter(mdates.AutoDateFormatter(locator))</span>

    <span class="s1">ax.autoscale_view()</span>
    <span class="s1">fig.autofmt_xdate()</span>


<span class="s0">def </span><span class="s1">test_RRuleLocator_dayrange():</span>
    <span class="s1">loc = mdates.DayLocator()</span>
    <span class="s1">x1 = datetime.datetime(year=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">tzinfo=mdates.UTC)</span>
    <span class="s1">y1 = datetime.datetime(year=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">16</span><span class="s0">, </span><span class="s1">tzinfo=mdates.UTC)</span>
    <span class="s1">loc.tick_values(x1</span><span class="s0">, </span><span class="s1">y1)</span>
    <span class="s2"># On success, no overflow error shall be thrown</span>


<span class="s0">def </span><span class="s1">test_RRuleLocator_close_minmax():</span>
    <span class="s2"># if d1 and d2 are very close together, rrule cannot create</span>
    <span class="s2"># reasonable tick intervals; ensure that this is handled properly</span>
    <span class="s1">rrule = mdates.rrulewrapper(dateutil.rrule.SECONDLY</span><span class="s0">, </span><span class="s1">interval=</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">loc = mdates.RRuleLocator(rrule)</span>
    <span class="s1">d1 = datetime.datetime(year=</span><span class="s3">2020</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">d2 = datetime.datetime(year=</span><span class="s3">2020</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">microsecond=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">expected = [</span><span class="s4">'2020-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                <span class="s4">'2020-01-01 00:00:00.000001+00:00'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">list(map(str</span><span class="s0">, </span><span class="s1">mdates.num2date(loc.tick_values(d1</span><span class="s0">, </span><span class="s1">d2)))) == expected</span>


<span class="s1">@image_comparison([</span><span class="s4">'DateFormatter_fractionalSeconds.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_DateFormatter():</span>
    <span class="s0">import </span><span class="s1">matplotlib.testing.jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units.register()</span>

    <span class="s2"># Lets make sure that DateFormatter will allow us to have tick marks</span>
    <span class="s2"># at intervals of fractional seconds.</span>

    <span class="s1">t0 = datetime.datetime(</span><span class="s3">2001</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">tf = datetime.datetime(</span><span class="s3">2001</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = plt.subplot()</span>
    <span class="s1">ax.set_autoscale_on(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax.plot([t0</span><span class="s0">, </span><span class="s1">tf]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.0</span><span class="s0">, </span><span class="s3">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s4">'o'</span><span class="s1">)</span>

    <span class="s2"># rrule = mpldates.rrulewrapper( dateutil.rrule.YEARLY, interval=500 )</span>
    <span class="s2"># locator = mpldates.RRuleLocator( rrule )</span>
    <span class="s2"># ax.xaxis.set_major_locator( locator )</span>
    <span class="s2"># ax.xaxis.set_major_formatter( mpldates.AutoDateFormatter(locator) )</span>

    <span class="s1">ax.autoscale_view()</span>
    <span class="s1">fig.autofmt_xdate()</span>


<span class="s0">def </span><span class="s1">test_locator_set_formatter():</span>
    <span class="s5">&quot;&quot;&quot; 
    Test if setting the locator only will update the AutoDateFormatter to use 
    the new locator. 
    &quot;&quot;&quot;</span>
    <span class="s1">plt.rcParams[</span><span class="s4">&quot;date.autoformatter.minute&quot;</span><span class="s1">] = </span><span class="s4">&quot;%d %H:%M&quot;</span>
    <span class="s1">t = [datetime.datetime(</span><span class="s3">2018</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
         <span class="s1">datetime.datetime(</span><span class="s3">2018</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">59</span><span class="s1">)</span><span class="s0">,</span>
         <span class="s1">datetime.datetime(</span><span class="s3">2018</span><span class="s0">, </span><span class="s3">9</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)]</span>
    <span class="s1">x = [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(t</span><span class="s0">, </span><span class="s1">x)</span>
    <span class="s1">ax.xaxis.set_major_locator(mdates.MinuteLocator((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">ticklabels = [tl.get_text() </span><span class="s0">for </span><span class="s1">tl </span><span class="s0">in </span><span class="s1">ax.get_xticklabels()]</span>
    <span class="s1">expected = [</span><span class="s4">'30 08:00'</span><span class="s0">, </span><span class="s4">'30 08:30'</span><span class="s0">, </span><span class="s4">'30 09:00'</span><span class="s0">,</span>
                <span class="s4">'30 09:30'</span><span class="s0">, </span><span class="s4">'30 10:00'</span><span class="s0">, </span><span class="s4">'30 10:30'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">ticklabels == expected</span>

    <span class="s1">ax.xaxis.set_major_locator(mticker.NullLocator())</span>
    <span class="s1">ax.xaxis.set_minor_locator(mdates.MinuteLocator((</span><span class="s3">5</span><span class="s0">, </span><span class="s3">55</span><span class="s1">)))</span>
    <span class="s1">decoy_loc = mdates.MinuteLocator((</span><span class="s3">12</span><span class="s0">, </span><span class="s3">27</span><span class="s1">))</span>
    <span class="s1">ax.xaxis.set_minor_formatter(mdates.AutoDateFormatter(decoy_loc))</span>

    <span class="s1">ax.xaxis.set_minor_locator(mdates.MinuteLocator((</span><span class="s3">15</span><span class="s0">, </span><span class="s3">45</span><span class="s1">)))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s1">ticklabels = [tl.get_text() </span><span class="s0">for </span><span class="s1">tl </span><span class="s0">in </span><span class="s1">ax.get_xticklabels(which=</span><span class="s4">&quot;minor&quot;</span><span class="s1">)]</span>
    <span class="s1">expected = [</span><span class="s4">'30 08:15'</span><span class="s0">, </span><span class="s4">'30 08:45'</span><span class="s0">, </span><span class="s4">'30 09:15'</span><span class="s0">, </span><span class="s4">'30 09:45'</span><span class="s0">, </span><span class="s4">'30 10:15'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">ticklabels == expected</span>


<span class="s0">def </span><span class="s1">test_date_formatter_callable():</span>

    <span class="s0">class </span><span class="s1">_Locator:</span>
        <span class="s0">def </span><span class="s1">_get_unit(self): </span><span class="s0">return </span><span class="s1">-</span><span class="s3">11</span>

    <span class="s0">def </span><span class="s1">callable_formatting_function(dates</span><span class="s0">, </span><span class="s1">_):</span>
        <span class="s0">return </span><span class="s1">[dt.strftime(</span><span class="s4">'%d-%m//%Y'</span><span class="s1">) </span><span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">dates]</span>

    <span class="s1">formatter = mdates.AutoDateFormatter(_Locator())</span>
    <span class="s1">formatter.scaled[-</span><span class="s3">10</span><span class="s1">] = callable_formatting_function</span>
    <span class="s0">assert </span><span class="s1">formatter([datetime.datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">12</span><span class="s0">, </span><span class="s3">25</span><span class="s1">)]) == [</span><span class="s4">'25-12//2014'</span><span class="s1">]</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'delta, expected'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">[</span><span class="s4">r'$\mathdefault{%d}$' </span><span class="s1">% year </span><span class="s0">for </span><span class="s1">year </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1990</span><span class="s0">, </span><span class="s3">2171</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)])</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(days=</span><span class="s3">30</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">[</span><span class="s4">r'$\mathdefault{1990{-}01{-}%02d}$' </span><span class="s1">% day </span><span class="s0">for </span><span class="s1">day </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">32</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)])</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(hours=</span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">[</span><span class="s4">r'$\mathdefault{01{-}01\;%02d}$' </span><span class="s1">% hour </span><span class="s0">for </span><span class="s1">hour </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">21</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)])</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(minutes=</span><span class="s3">10</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">[</span><span class="s4">r'$\mathdefault{01\;00{:}%02d}$' </span><span class="s1">% minu </span><span class="s0">for </span><span class="s1">minu </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">11</span><span class="s1">)])</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date_formatter_usetex(delta</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">style.use(</span><span class="s4">&quot;default&quot;</span><span class="s1">)</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1990</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">d2 = d1 + delta</span>

    <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">locator.create_dummy_axis()</span>
    <span class="s1">locator.axis.set_view_interval(mdates.date2num(d1)</span><span class="s0">, </span><span class="s1">mdates.date2num(d2))</span>

    <span class="s1">formatter = mdates.AutoDateFormatter(locator</span><span class="s0">, </span><span class="s1">usetex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">[formatter(loc) </span><span class="s0">for </span><span class="s1">loc </span><span class="s0">in </span><span class="s1">locator()] == expected</span>


<span class="s0">def </span><span class="s1">test_drange():</span>
    <span class="s5">&quot;&quot;&quot; 
    This test should check if drange works as expected, and if all the 
    rounding errors are fixed 
    &quot;&quot;&quot;</span>
    <span class="s1">start = datetime.datetime(</span><span class="s3">2011</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">tzinfo=mdates.UTC)</span>
    <span class="s1">end = datetime.datetime(</span><span class="s3">2011</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">tzinfo=mdates.UTC)</span>
    <span class="s1">delta = datetime.timedelta(hours=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s2"># We expect 24 values in drange(start, end, delta), because drange returns</span>
    <span class="s2"># dates from an half open interval [start, end)</span>
    <span class="s0">assert </span><span class="s1">len(mdates.drange(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">delta)) == </span><span class="s3">24</span>

    <span class="s2"># Same if interval ends slightly earlier</span>
    <span class="s1">end = end - datetime.timedelta(microseconds=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(mdates.drange(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">delta)) == </span><span class="s3">24</span>

    <span class="s2"># if end is a little bit later, we expect the range to contain one element</span>
    <span class="s2"># more</span>
    <span class="s1">end = end + datetime.timedelta(microseconds=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(mdates.drange(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">delta)) == </span><span class="s3">25</span>

    <span class="s2"># reset end</span>
    <span class="s1">end = datetime.datetime(</span><span class="s3">2011</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">tzinfo=mdates.UTC)</span>

    <span class="s2"># and tst drange with &quot;complicated&quot; floats:</span>
    <span class="s2"># 4 hours = 1/6 day, this is an &quot;dangerous&quot; float</span>
    <span class="s1">delta = datetime.timedelta(hours=</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">daterange = mdates.drange(start</span><span class="s0">, </span><span class="s1">end</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s0">assert </span><span class="s1">len(daterange) == </span><span class="s3">6</span>
    <span class="s0">assert </span><span class="s1">mdates.num2date(daterange[-</span><span class="s3">1</span><span class="s1">]) == (end - delta)</span>


<span class="s1">@_new_epoch_decorator</span>
<span class="s0">def </span><span class="s1">test_auto_date_locator():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator(date1</span><span class="s0">, </span><span class="s1">date2):</span>
        <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">locator.create_dummy_axis()</span>
        <span class="s1">locator.axis.set_view_interval(*mdates.date2num([date1</span><span class="s0">, </span><span class="s1">date2]))</span>
        <span class="s0">return </span><span class="s1">locator</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1990</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">results = ([datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1990-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2010-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2030-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2050-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2070-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2090-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2110-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2130-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2150-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2170-01-01 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1990-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-02-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-03-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-04-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-05-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-06-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-07-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-08-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-09-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-10-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-11-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-12-01 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">141</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1990-01-05 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-26 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-02-16 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-03-09 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-03-30 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-04-20 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-05-11 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1990-01-03 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-10 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-17 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-24 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-31 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-02-07 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(hours=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1990-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 04:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 08:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 12:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 16:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 20:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-02 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-02 04:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-02 08:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-02 12:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-02 16:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(minutes=</span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1990-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 00:05:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:10:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 00:15:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:20:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1990-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 00:00:05+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:10+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 00:00:15+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:20+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 00:00:25+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:30+00:00'</span><span class="s0">, </span><span class="s4">'1990-01-01 00:00:35+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:40+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(microseconds=</span><span class="s3">1500</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1989-12-31 23:59:59.999500+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:00.000500+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:00.001000+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:00.001500+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1990-01-01 00:00:00.002000+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">t_delta</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s1">d2 = d1 + t_delta</span>
        <span class="s1">locator = _create_auto_date_locator(d1</span><span class="s0">, </span><span class="s1">d2)</span>
        <span class="s0">assert </span><span class="s1">list(map(str</span><span class="s0">, </span><span class="s1">mdates.num2date(locator()))) == expected</span>

    <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">locator.maxticks == {</span><span class="s3">0</span><span class="s1">: </span><span class="s3">11</span><span class="s0">, </span><span class="s3">1</span><span class="s1">: </span><span class="s3">12</span><span class="s0">, </span><span class="s3">3</span><span class="s1">: </span><span class="s3">11</span><span class="s0">, </span><span class="s3">4</span><span class="s1">: </span><span class="s3">12</span><span class="s0">, </span><span class="s3">5</span><span class="s1">: </span><span class="s3">11</span><span class="s0">, </span><span class="s3">6</span><span class="s1">: </span><span class="s3">11</span><span class="s0">, </span><span class="s3">7</span><span class="s1">: </span><span class="s3">8</span><span class="s1">}</span>

    <span class="s1">locator = mdates.AutoDateLocator(maxticks={dateutil.rrule.MONTHLY: </span><span class="s3">5</span><span class="s1">})</span>
    <span class="s0">assert </span><span class="s1">locator.maxticks == {</span><span class="s3">0</span><span class="s1">: </span><span class="s3">11</span><span class="s0">, </span><span class="s3">1</span><span class="s1">: </span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s1">: </span><span class="s3">11</span><span class="s0">, </span><span class="s3">4</span><span class="s1">: </span><span class="s3">12</span><span class="s0">, </span><span class="s3">5</span><span class="s1">: </span><span class="s3">11</span><span class="s0">, </span><span class="s3">6</span><span class="s1">: </span><span class="s3">11</span><span class="s0">, </span><span class="s3">7</span><span class="s1">: </span><span class="s3">8</span><span class="s1">}</span>

    <span class="s1">locator = mdates.AutoDateLocator(maxticks=</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">locator.maxticks == {</span><span class="s3">0</span><span class="s1">: </span><span class="s3">5</span><span class="s0">, </span><span class="s3">1</span><span class="s1">: </span><span class="s3">5</span><span class="s0">, </span><span class="s3">3</span><span class="s1">: </span><span class="s3">5</span><span class="s0">, </span><span class="s3">4</span><span class="s1">: </span><span class="s3">5</span><span class="s0">, </span><span class="s3">5</span><span class="s1">: </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s1">: </span><span class="s3">5</span><span class="s0">, </span><span class="s3">7</span><span class="s1">: </span><span class="s3">5</span><span class="s1">}</span>


<span class="s1">@_new_epoch_decorator</span>
<span class="s0">def </span><span class="s1">test_auto_date_locator_intmult():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator(date1</span><span class="s0">, </span><span class="s1">date2):</span>
        <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">locator.create_dummy_axis()</span>
        <span class="s1">locator.axis.set_view_interval(*mdates.date2num([date1</span><span class="s0">, </span><span class="s1">date2]))</span>
        <span class="s0">return </span><span class="s1">locator</span>

    <span class="s1">results = ([datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1980-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2000-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2020-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2040-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2060-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2080-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2100-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2120-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2140-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2160-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2180-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2200-01-01 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-02-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-03-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-04-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-05-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-06-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-07-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-08-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-09-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-10-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-11-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-12-01 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">141</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-15 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-02-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-02-15 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-03-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-03-15 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-04-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-04-15 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-05-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-05-15 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-05 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-09 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-13 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-17 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-21 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-25 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-29 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-02-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-02-05 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-02-09 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(hours=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 04:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 08:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 12:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 16:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 20:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-02 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-02 04:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-02 08:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-02 12:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-02 16:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(minutes=</span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:05:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:10:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:15:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:20:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:00:05+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:10+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:00:15+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:20+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:00:25+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:30+00:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:00:35+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:40+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(microseconds=</span><span class="s3">1500</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1996-12-31 23:59:59.999500+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:00.000500+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:00.001000+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:00.001500+00:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:00.002000+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">)</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s1">d2 = d1 + t_delta</span>
        <span class="s1">locator = _create_auto_date_locator(d1</span><span class="s0">, </span><span class="s1">d2)</span>
        <span class="s0">assert </span><span class="s1">list(map(str</span><span class="s0">, </span><span class="s1">mdates.num2date(locator()))) == expected</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_subsecond():</span>
    <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">formatter = mdates.ConciseDateFormatter(locator)</span>
    <span class="s1">year_1996 = </span><span class="s3">9861.0</span>
    <span class="s1">strings = formatter.format_ticks([</span>
        <span class="s1">year_1996</span><span class="s0">,</span>
        <span class="s1">year_1996 + </span><span class="s3">500 </span><span class="s1">/ mdates.MUSECONDS_PER_DAY</span><span class="s0">,</span>
        <span class="s1">year_1996 + </span><span class="s3">900 </span><span class="s1">/ mdates.MUSECONDS_PER_DAY])</span>
    <span class="s0">assert </span><span class="s1">strings == [</span><span class="s4">'00:00'</span><span class="s0">, </span><span class="s4">'00.0005'</span><span class="s0">, </span><span class="s4">'00.0009'</span><span class="s1">]</span>


<span class="s0">def </span><span class="s1">test_concise_formatter():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator(date1</span><span class="s0">, </span><span class="s1">date2):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

        <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">formatter = mdates.ConciseDateFormatter(locator)</span>
        <span class="s1">ax.yaxis.set_major_locator(locator)</span>
        <span class="s1">ax.yaxis.set_major_formatter(formatter)</span>
        <span class="s1">ax.set_ylim(date1</span><span class="s0">, </span><span class="s1">date2)</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">sts = [st.get_text() </span><span class="s0">for </span><span class="s1">st </span><span class="s0">in </span><span class="s1">ax.get_yticklabels()]</span>
        <span class="s0">return </span><span class="s1">sts</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">results = ([datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[str(t) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1980</span><span class="s0">, </span><span class="s3">2201</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997'</span><span class="s0">, </span><span class="s4">'Feb'</span><span class="s0">, </span><span class="s4">'Mar'</span><span class="s0">, </span><span class="s4">'Apr'</span><span class="s0">, </span><span class="s4">'May'</span><span class="s0">, </span><span class="s4">'Jun'</span><span class="s0">, </span><span class="s4">'Jul'</span><span class="s0">, </span><span class="s4">'Aug'</span><span class="s0">,</span>
                 <span class="s4">'Sep'</span><span class="s0">, </span><span class="s4">'Oct'</span><span class="s0">, </span><span class="s4">'Nov'</span><span class="s0">, </span><span class="s4">'Dec'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">141</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'Jan'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'Feb'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'Mar'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'Apr'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">,</span>
                 <span class="s4">'May'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'Jan'</span><span class="s0">, </span><span class="s4">'05'</span><span class="s0">, </span><span class="s4">'09'</span><span class="s0">, </span><span class="s4">'13'</span><span class="s0">, </span><span class="s4">'17'</span><span class="s0">, </span><span class="s4">'21'</span><span class="s0">, </span><span class="s4">'25'</span><span class="s0">, </span><span class="s4">'29'</span><span class="s0">, </span><span class="s4">'Feb'</span><span class="s0">,</span>
                 <span class="s4">'05'</span><span class="s0">, </span><span class="s4">'09'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(hours=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'Jan-01'</span><span class="s0">, </span><span class="s4">'04:00'</span><span class="s0">, </span><span class="s4">'08:00'</span><span class="s0">, </span><span class="s4">'12:00'</span><span class="s0">, </span><span class="s4">'16:00'</span><span class="s0">, </span><span class="s4">'20:00'</span><span class="s0">,</span>
                 <span class="s4">'Jan-02'</span><span class="s0">, </span><span class="s4">'04:00'</span><span class="s0">, </span><span class="s4">'08:00'</span><span class="s0">, </span><span class="s4">'12:00'</span><span class="s0">, </span><span class="s4">'16:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(minutes=</span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'00:00'</span><span class="s0">, </span><span class="s4">'00:05'</span><span class="s0">, </span><span class="s4">'00:10'</span><span class="s0">, </span><span class="s4">'00:15'</span><span class="s0">, </span><span class="s4">'00:20'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'00:00'</span><span class="s0">, </span><span class="s4">'05'</span><span class="s0">, </span><span class="s4">'10'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'20'</span><span class="s0">, </span><span class="s4">'25'</span><span class="s0">, </span><span class="s4">'30'</span><span class="s0">, </span><span class="s4">'35'</span><span class="s0">, </span><span class="s4">'40'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'59.5'</span><span class="s0">, </span><span class="s4">'00:00'</span><span class="s0">, </span><span class="s4">'00.5'</span><span class="s0">, </span><span class="s4">'01.0'</span><span class="s0">, </span><span class="s4">'01.5'</span><span class="s0">, </span><span class="s4">'02.0'</span><span class="s0">, </span><span class="s4">'02.5'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s1">d2 = d1 + t_delta</span>
        <span class="s1">strings = _create_auto_date_locator(d1</span><span class="s0">, </span><span class="s1">d2)</span>
        <span class="s0">assert </span><span class="s1">strings == expected</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'t_delta, expected'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(datetime.timedelta(seconds=</span><span class="s3">0.01</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'1997-Jan-01 00:00'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(minutes=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'1997-Jan-01 00:01'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(hours=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'1997-Jan-01'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(days=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'1997-Jan-02'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(weeks=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'1997-Jan'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(weeks=</span><span class="s3">26</span><span class="s1">)</span><span class="s0">, </span><span class="s4">''</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(weeks=</span><span class="s3">520</span><span class="s1">)</span><span class="s0">, </span><span class="s4">''</span><span class="s1">)</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_concise_formatter_show_offset(t_delta</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">d2 = d1 + t_delta</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">locator = mdates.AutoDateLocator()</span>
    <span class="s1">formatter = mdates.ConciseDateFormatter(locator)</span>
    <span class="s1">ax.xaxis.set_major_locator(locator)</span>
    <span class="s1">ax.xaxis.set_major_formatter(formatter)</span>

    <span class="s1">ax.plot([d1</span><span class="s0">, </span><span class="s1">d2]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">formatter.get_offset() == expected</span>


<span class="s0">def </span><span class="s1">test_offset_changes():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">d2 = d1 + datetime.timedelta(weeks=</span><span class="s3">520</span><span class="s1">)</span>

    <span class="s1">locator = mdates.AutoDateLocator()</span>
    <span class="s1">formatter = mdates.ConciseDateFormatter(locator)</span>
    <span class="s1">ax.xaxis.set_major_locator(locator)</span>
    <span class="s1">ax.xaxis.set_major_formatter(formatter)</span>

    <span class="s1">ax.plot([d1</span><span class="s0">, </span><span class="s1">d2]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">assert </span><span class="s1">formatter.get_offset() == </span><span class="s4">''</span>
    <span class="s1">ax.set_xlim(d1</span><span class="s0">, </span><span class="s1">d1 + datetime.timedelta(weeks=</span><span class="s3">3</span><span class="s1">))</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">assert </span><span class="s1">formatter.get_offset() == </span><span class="s4">'1997-Jan'</span>
    <span class="s1">ax.set_xlim(d1 + datetime.timedelta(weeks=</span><span class="s3">7</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">d1 + datetime.timedelta(weeks=</span><span class="s3">30</span><span class="s1">))</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">assert </span><span class="s1">formatter.get_offset() == </span><span class="s4">'1997'</span>
    <span class="s1">ax.set_xlim(d1</span><span class="s0">, </span><span class="s1">d1 + datetime.timedelta(weeks=</span><span class="s3">520</span><span class="s1">))</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">assert </span><span class="s1">formatter.get_offset() == </span><span class="s4">''</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'t_delta, expected'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">[</span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{%d}$' </span><span class="s1">% (t</span><span class="s0">, </span><span class="s1">) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1980</span><span class="s0">, </span><span class="s3">2201</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)])</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(days=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">[</span><span class="s4">'Jan'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{05}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{09}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{13}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{17}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{21}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{25}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{29}$'</span><span class="s0">, </span><span class="s4">'Feb'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{05}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{09}$'</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(hours=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">[</span><span class="s4">'Jan$</span><span class="s0">\\</span><span class="s4">mathdefault{{-}01}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{04{:}00}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{08{:}00}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{12{:}00}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{16{:}00}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{20{:}00}$'</span><span class="s0">,</span>
      <span class="s4">'Jan$</span><span class="s0">\\</span><span class="s4">mathdefault{{-}02}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{04{:}00}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{08{:}00}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{12{:}00}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{16{:}00}$'</span><span class="s1">])</span><span class="s0">,</span>
    <span class="s1">(datetime.timedelta(seconds=</span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
     <span class="s1">[</span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{59.5}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{00{:}00}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{00.5}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{01.0}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{01.5}$'</span><span class="s0">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{02.0}$'</span><span class="s0">,</span>
      <span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{02.5}$'</span><span class="s1">])</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_concise_formatter_usetex(t_delta</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">d2 = d1 + t_delta</span>

    <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">locator.create_dummy_axis()</span>
    <span class="s1">locator.axis.set_view_interval(mdates.date2num(d1)</span><span class="s0">, </span><span class="s1">mdates.date2num(d2))</span>

    <span class="s1">formatter = mdates.ConciseDateFormatter(locator</span><span class="s0">, </span><span class="s1">usetex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">formatter.format_ticks(locator()) == expected</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_formats():</span>
    <span class="s1">formats = [</span><span class="s4">'%Y'</span><span class="s0">, </span><span class="s4">'%m/%Y'</span><span class="s0">, </span><span class="s4">'day: %d'</span><span class="s0">,</span>
               <span class="s4">'%H hr %M min'</span><span class="s0">, </span><span class="s4">'%H hr %M min'</span><span class="s0">, </span><span class="s4">'%S.%f sec'</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">_create_auto_date_locator(date1</span><span class="s0">, </span><span class="s1">date2):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

        <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">formatter = mdates.ConciseDateFormatter(locator</span><span class="s0">, </span><span class="s1">formats=formats)</span>
        <span class="s1">ax.yaxis.set_major_locator(locator)</span>
        <span class="s1">ax.yaxis.set_major_formatter(formatter)</span>
        <span class="s1">ax.set_ylim(date1</span><span class="s0">, </span><span class="s1">date2)</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">sts = [st.get_text() </span><span class="s0">for </span><span class="s1">st </span><span class="s0">in </span><span class="s1">ax.get_yticklabels()]</span>
        <span class="s0">return </span><span class="s1">sts</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">results = (</span>
        <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[str(t) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1980</span><span class="s0">,</span>
         <span class="s3">2201</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)]]</span><span class="s0">,</span>
        <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s4">'1997'</span><span class="s0">, </span><span class="s4">'02/1997'</span><span class="s0">, </span><span class="s4">'03/1997'</span><span class="s0">, </span><span class="s4">'04/1997'</span><span class="s0">, </span><span class="s4">'05/1997'</span><span class="s0">, </span><span class="s4">'06/1997'</span><span class="s0">,</span>
            <span class="s4">'07/1997'</span><span class="s0">, </span><span class="s4">'08/1997'</span><span class="s0">, </span><span class="s4">'09/1997'</span><span class="s0">, </span><span class="s4">'10/1997'</span><span class="s0">, </span><span class="s4">'11/1997'</span><span class="s0">, </span><span class="s4">'12/1997'</span><span class="s0">,</span>
            <span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[datetime.timedelta(days=</span><span class="s3">141</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s4">'01/1997'</span><span class="s0">, </span><span class="s4">'day: 15'</span><span class="s0">, </span><span class="s4">'02/1997'</span><span class="s0">, </span><span class="s4">'day: 15'</span><span class="s0">, </span><span class="s4">'03/1997'</span><span class="s0">, </span><span class="s4">'day: 15'</span><span class="s0">,</span>
            <span class="s4">'04/1997'</span><span class="s0">, </span><span class="s4">'day: 15'</span><span class="s0">, </span><span class="s4">'05/1997'</span><span class="s0">, </span><span class="s4">'day: 15'</span><span class="s0">,</span>
            <span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[datetime.timedelta(days=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s4">'01/1997'</span><span class="s0">, </span><span class="s4">'day: 05'</span><span class="s0">, </span><span class="s4">'day: 09'</span><span class="s0">, </span><span class="s4">'day: 13'</span><span class="s0">, </span><span class="s4">'day: 17'</span><span class="s0">, </span><span class="s4">'day: 21'</span><span class="s0">,</span>
            <span class="s4">'day: 25'</span><span class="s0">, </span><span class="s4">'day: 29'</span><span class="s0">, </span><span class="s4">'02/1997'</span><span class="s0">, </span><span class="s4">'day: 05'</span><span class="s0">, </span><span class="s4">'day: 09'</span><span class="s0">,</span>
            <span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[datetime.timedelta(hours=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s4">'day: 01'</span><span class="s0">, </span><span class="s4">'04 hr 00 min'</span><span class="s0">, </span><span class="s4">'08 hr 00 min'</span><span class="s0">, </span><span class="s4">'12 hr 00 min'</span><span class="s0">,</span>
            <span class="s4">'16 hr 00 min'</span><span class="s0">, </span><span class="s4">'20 hr 00 min'</span><span class="s0">, </span><span class="s4">'day: 02'</span><span class="s0">, </span><span class="s4">'04 hr 00 min'</span><span class="s0">,</span>
            <span class="s4">'08 hr 00 min'</span><span class="s0">, </span><span class="s4">'12 hr 00 min'</span><span class="s0">, </span><span class="s4">'16 hr 00 min'</span><span class="s0">,</span>
            <span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[datetime.timedelta(minutes=</span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span><span class="s4">'00 hr 00 min'</span><span class="s0">, </span><span class="s4">'00 hr 05 min'</span><span class="s0">,</span>
         <span class="s4">'00 hr 10 min'</span><span class="s0">, </span><span class="s4">'00 hr 15 min'</span><span class="s0">, </span><span class="s4">'00 hr 20 min'</span><span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s4">'00 hr 00 min'</span><span class="s0">, </span><span class="s4">'05.000000 sec'</span><span class="s0">, </span><span class="s4">'10.000000 sec'</span><span class="s0">,</span>
            <span class="s4">'15.000000 sec'</span><span class="s0">, </span><span class="s4">'20.000000 sec'</span><span class="s0">, </span><span class="s4">'25.000000 sec'</span><span class="s0">,</span>
            <span class="s4">'30.000000 sec'</span><span class="s0">, </span><span class="s4">'35.000000 sec'</span><span class="s0">, </span><span class="s4">'40.000000 sec'</span><span class="s0">,</span>
            <span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s4">'59.500000 sec'</span><span class="s0">, </span><span class="s4">'00 hr 00 min'</span><span class="s0">, </span><span class="s4">'00.500000 sec'</span><span class="s0">, </span><span class="s4">'01.000000 sec'</span><span class="s0">,</span>
            <span class="s4">'01.500000 sec'</span><span class="s0">, </span><span class="s4">'02.000000 sec'</span><span class="s0">, </span><span class="s4">'02.500000 sec'</span><span class="s0">,</span>
            <span class="s1">]]</span><span class="s0">,</span>
        <span class="s1">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s1">d2 = d1 + t_delta</span>
        <span class="s1">strings = _create_auto_date_locator(d1</span><span class="s0">, </span><span class="s1">d2)</span>
        <span class="s0">assert </span><span class="s1">strings == expected</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_zformats():</span>
    <span class="s1">zero_formats = [</span><span class="s4">''</span><span class="s0">, </span><span class="s4">&quot;'%y&quot;</span><span class="s0">, </span><span class="s4">'%B'</span><span class="s0">, </span><span class="s4">'%m-%d'</span><span class="s0">, </span><span class="s4">'%S'</span><span class="s0">, </span><span class="s4">'%S.%f'</span><span class="s1">]</span>

    <span class="s0">def </span><span class="s1">_create_auto_date_locator(date1</span><span class="s0">, </span><span class="s1">date2):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

        <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">formatter = mdates.ConciseDateFormatter(</span>
            <span class="s1">locator</span><span class="s0">, </span><span class="s1">zero_formats=zero_formats)</span>
        <span class="s1">ax.yaxis.set_major_locator(locator)</span>
        <span class="s1">ax.yaxis.set_major_formatter(formatter)</span>
        <span class="s1">ax.set_ylim(date1</span><span class="s0">, </span><span class="s1">date2)</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">sts = [st.get_text() </span><span class="s0">for </span><span class="s1">st </span><span class="s0">in </span><span class="s1">ax.get_yticklabels()]</span>
        <span class="s0">return </span><span class="s1">sts</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">results = ([datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[str(t) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1980</span><span class="s0">, </span><span class="s3">2201</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">&quot;'97&quot;</span><span class="s0">, </span><span class="s4">'Feb'</span><span class="s0">, </span><span class="s4">'Mar'</span><span class="s0">, </span><span class="s4">'Apr'</span><span class="s0">, </span><span class="s4">'May'</span><span class="s0">, </span><span class="s4">'Jun'</span><span class="s0">,</span>
                    <span class="s4">'Jul'</span><span class="s0">, </span><span class="s4">'Aug'</span><span class="s0">, </span><span class="s4">'Sep'</span><span class="s0">, </span><span class="s4">'Oct'</span><span class="s0">, </span><span class="s4">'Nov'</span><span class="s0">, </span><span class="s4">'Dec'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">141</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'January'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'February'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'March'</span><span class="s0">,</span>
                    <span class="s4">'15'</span><span class="s0">, </span><span class="s4">'April'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'May'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'January'</span><span class="s0">, </span><span class="s4">'05'</span><span class="s0">, </span><span class="s4">'09'</span><span class="s0">, </span><span class="s4">'13'</span><span class="s0">, </span><span class="s4">'17'</span><span class="s0">, </span><span class="s4">'21'</span><span class="s0">,</span>
                    <span class="s4">'25'</span><span class="s0">, </span><span class="s4">'29'</span><span class="s0">, </span><span class="s4">'February'</span><span class="s0">, </span><span class="s4">'05'</span><span class="s0">, </span><span class="s4">'09'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(hours=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'01-01'</span><span class="s0">, </span><span class="s4">'04:00'</span><span class="s0">, </span><span class="s4">'08:00'</span><span class="s0">, </span><span class="s4">'12:00'</span><span class="s0">, </span><span class="s4">'16:00'</span><span class="s0">, </span><span class="s4">'20:00'</span><span class="s0">,</span>
                    <span class="s4">'01-02'</span><span class="s0">, </span><span class="s4">'04:00'</span><span class="s0">, </span><span class="s4">'08:00'</span><span class="s0">, </span><span class="s4">'12:00'</span><span class="s0">, </span><span class="s4">'16:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(minutes=</span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'00'</span><span class="s0">, </span><span class="s4">'00:05'</span><span class="s0">, </span><span class="s4">'00:10'</span><span class="s0">, </span><span class="s4">'00:15'</span><span class="s0">, </span><span class="s4">'00:20'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'00'</span><span class="s0">, </span><span class="s4">'05'</span><span class="s0">, </span><span class="s4">'10'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'20'</span><span class="s0">, </span><span class="s4">'25'</span><span class="s0">, </span><span class="s4">'30'</span><span class="s0">, </span><span class="s4">'35'</span><span class="s0">, </span><span class="s4">'40'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'59.5'</span><span class="s0">, </span><span class="s4">'00.0'</span><span class="s0">, </span><span class="s4">'00.5'</span><span class="s0">, </span><span class="s4">'01.0'</span><span class="s0">, </span><span class="s4">'01.5'</span><span class="s0">, </span><span class="s4">'02.0'</span><span class="s0">, </span><span class="s4">'02.5'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s1">d2 = d1 + t_delta</span>
        <span class="s1">strings = _create_auto_date_locator(d1</span><span class="s0">, </span><span class="s1">d2)</span>
        <span class="s0">assert </span><span class="s1">strings == expected</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_tz():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator(date1</span><span class="s0">, </span><span class="s1">date2</span><span class="s0">, </span><span class="s1">tz):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

        <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">formatter = mdates.ConciseDateFormatter(locator</span><span class="s0">, </span><span class="s1">tz=tz)</span>
        <span class="s1">ax.yaxis.set_major_locator(locator)</span>
        <span class="s1">ax.yaxis.set_major_formatter(formatter)</span>
        <span class="s1">ax.set_ylim(date1</span><span class="s0">, </span><span class="s1">date2)</span>
        <span class="s1">fig.canvas.draw()</span>
        <span class="s1">sts = [st.get_text() </span><span class="s0">for </span><span class="s1">st </span><span class="s0">in </span><span class="s1">ax.get_yticklabels()]</span>
        <span class="s0">return </span><span class="s1">sts</span><span class="s0">, </span><span class="s1">ax.yaxis.get_offset_text().get_text()</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">).replace(tzinfo=datetime.timezone.utc)</span>
    <span class="s1">results = ([datetime.timedelta(hours=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'03:00'</span><span class="s0">, </span><span class="s4">'07:00'</span><span class="s0">, </span><span class="s4">'11:00'</span><span class="s0">, </span><span class="s4">'15:00'</span><span class="s0">, </span><span class="s4">'19:00'</span><span class="s0">, </span><span class="s4">'23:00'</span><span class="s0">,</span>
                 <span class="s4">'03:00'</span><span class="s0">, </span><span class="s4">'07:00'</span><span class="s0">, </span><span class="s4">'11:00'</span><span class="s0">, </span><span class="s4">'15:00'</span><span class="s0">, </span><span class="s4">'19:00'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s4">&quot;1997-Jan-02&quot;</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(minutes=</span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'03:00'</span><span class="s0">, </span><span class="s4">'03:05'</span><span class="s0">, </span><span class="s4">'03:10'</span><span class="s0">, </span><span class="s4">'03:15'</span><span class="s0">, </span><span class="s4">'03:20'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s4">&quot;1997-Jan-01&quot;</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'03:00'</span><span class="s0">, </span><span class="s4">'05'</span><span class="s0">, </span><span class="s4">'10'</span><span class="s0">, </span><span class="s4">'15'</span><span class="s0">, </span><span class="s4">'20'</span><span class="s0">, </span><span class="s4">'25'</span><span class="s0">, </span><span class="s4">'30'</span><span class="s0">, </span><span class="s4">'35'</span><span class="s0">, </span><span class="s4">'40'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s4">&quot;1997-Jan-01 03:00&quot;</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">2</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'59.5'</span><span class="s0">, </span><span class="s4">'03:00'</span><span class="s0">, </span><span class="s4">'00.5'</span><span class="s0">, </span><span class="s4">'01.0'</span><span class="s0">, </span><span class="s4">'01.5'</span><span class="s0">, </span><span class="s4">'02.0'</span><span class="s0">, </span><span class="s4">'02.5'</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s4">&quot;1997-Jan-01 03:00&quot;</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">)</span>

    <span class="s1">new_tz = datetime.timezone(datetime.timedelta(hours=</span><span class="s3">3</span><span class="s1">))</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s0">, </span><span class="s1">expected_strings</span><span class="s0">, </span><span class="s1">expected_offset </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s1">d2 = d1 + t_delta</span>
        <span class="s1">strings</span><span class="s0">, </span><span class="s1">offset = _create_auto_date_locator(d1</span><span class="s0">, </span><span class="s1">d2</span><span class="s0">, </span><span class="s1">new_tz)</span>
        <span class="s0">assert </span><span class="s1">strings == expected_strings</span>
        <span class="s0">assert </span><span class="s1">offset == expected_offset</span>


<span class="s0">def </span><span class="s1">test_auto_date_locator_intmult_tz():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator(date1</span><span class="s0">, </span><span class="s1">date2</span><span class="s0">, </span><span class="s1">tz):</span>
        <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True, </span><span class="s1">tz=tz)</span>
        <span class="s1">locator.create_dummy_axis()</span>
        <span class="s1">locator.axis.set_view_interval(*mdates.date2num([date1</span><span class="s0">, </span><span class="s1">date2]))</span>
        <span class="s0">return </span><span class="s1">locator</span>

    <span class="s1">results = ([datetime.timedelta(weeks=</span><span class="s3">52</span><span class="s1">*</span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1980-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'2000-01-01 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'2020-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'2040-01-01 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'2060-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'2080-01-01 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'2100-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'2120-01-01 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'2140-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'2160-01-01 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'2180-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'2200-01-01 00:00:00-08:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-02-01 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-03-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-04-01 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-05-01 00:00:00-07:00'</span><span class="s0">, </span><span class="s4">'1997-06-01 00:00:00-07:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-07-01 00:00:00-07:00'</span><span class="s0">, </span><span class="s4">'1997-08-01 00:00:00-07:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-09-01 00:00:00-07:00'</span><span class="s0">, </span><span class="s4">'1997-10-01 00:00:00-07:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-11-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-12-01 00:00:00-08:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">141</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-15 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-02-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-02-15 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-03-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-03-15 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-04-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-04-15 00:00:00-07:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-05-01 00:00:00-07:00'</span><span class="s0">, </span><span class="s4">'1997-05-15 00:00:00-07:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(days=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-05 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-09 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-13 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-17 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-21 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-25 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-29 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-02-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-02-05 00:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-02-09 00:00:00-08:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(hours=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 04:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 08:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 12:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 16:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 20:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-02 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-02 04:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-02 08:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-02 12:00:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-02 16:00:00-08:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(minutes=</span><span class="s3">20</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:05:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:10:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:15:00-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:20:00-08:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(seconds=</span><span class="s3">40</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1997-01-01 00:00:00-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:00:05-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:10-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:00:15-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:20-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:00:25-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:30-08:00'</span><span class="s0">, </span><span class="s4">'1997-01-01 00:00:35-08:00'</span><span class="s0">,</span>
                 <span class="s4">'1997-01-01 00:00:40-08:00'</span><span class="s1">]</span>
                <span class="s1">]</span>
               <span class="s1">)</span>

    <span class="s1">tz = dateutil.tz.gettz(</span><span class="s4">'Canada/Pacific'</span><span class="s1">)</span>
    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1997</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">tzinfo=tz)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s0">with </span><span class="s1">rc_context({</span><span class="s4">'_internal.classic_mode'</span><span class="s1">: </span><span class="s0">False</span><span class="s1">}):</span>
            <span class="s1">d2 = d1 + t_delta</span>
            <span class="s1">locator = _create_auto_date_locator(d1</span><span class="s0">, </span><span class="s1">d2</span><span class="s0">, </span><span class="s1">tz)</span>
            <span class="s1">st = list(map(str</span><span class="s0">, </span><span class="s1">mdates.num2date(locator()</span><span class="s0">, </span><span class="s1">tz=tz)))</span>
            <span class="s0">assert </span><span class="s1">st == expected</span>


<span class="s1">@image_comparison([</span><span class="s4">'date_inverted_limit.png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_date_inverted_limit():</span>
    <span class="s2"># test ax hline with date inputs</span>
    <span class="s1">t0 = datetime.datetime(</span><span class="s3">2009</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">tf = datetime.datetime(</span><span class="s3">2009</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">31</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.axhline(t0</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">&quot;blue&quot;</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(t0 - datetime.timedelta(days=</span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">tf + datetime.timedelta(days=</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">ax.invert_yaxis()</span>
    <span class="s1">fig.subplots_adjust(left=</span><span class="s3">0.25</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">_test_date2num_dst(date_range</span><span class="s0">, </span><span class="s1">tz_convert):</span>
    <span class="s2"># Timezones</span>

    <span class="s1">BRUSSELS = dateutil.tz.gettz(</span><span class="s4">'Europe/Brussels'</span><span class="s1">)</span>
    <span class="s1">UTC = mdates.UTC</span>

    <span class="s2"># Create a list of timezone-aware datetime objects in UTC</span>
    <span class="s2"># Interval is 0b0.0000011 days, to prevent float rounding issues</span>
    <span class="s1">dtstart = datetime.datetime(</span><span class="s3">2014</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">tzinfo=UTC)</span>
    <span class="s1">interval = datetime.timedelta(minutes=</span><span class="s3">33</span><span class="s0">, </span><span class="s1">seconds=</span><span class="s3">45</span><span class="s1">)</span>
    <span class="s1">interval_days = interval.seconds / </span><span class="s3">86400</span>
    <span class="s1">N = </span><span class="s3">8</span>

    <span class="s1">dt_utc = date_range(start=dtstart</span><span class="s0">, </span><span class="s1">freq=interval</span><span class="s0">, </span><span class="s1">periods=N)</span>
    <span class="s1">dt_bxl = tz_convert(dt_utc</span><span class="s0">, </span><span class="s1">BRUSSELS)</span>
    <span class="s1">t0 = </span><span class="s3">735322.0 </span><span class="s1">+ mdates.date2num(np.datetime64(</span><span class="s4">'0000-12-31'</span><span class="s1">))</span>
    <span class="s1">expected_ordinalf = [t0 + (i * interval_days) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(N)]</span>
    <span class="s1">actual_ordinalf = list(mdates.date2num(dt_bxl))</span>

    <span class="s0">assert </span><span class="s1">actual_ordinalf == expected_ordinalf</span>


<span class="s0">def </span><span class="s1">test_date2num_dst():</span>
    <span class="s2"># Test for github issue #3896, but in date2num around DST transitions</span>
    <span class="s2"># with a timezone-aware pandas date_range object.</span>

    <span class="s0">class </span><span class="s1">dt_tzaware(datetime.datetime):</span>
        <span class="s5">&quot;&quot;&quot; 
        This bug specifically occurs because of the normalization behavior of 
        pandas Timestamp objects, so in order to replicate it, we need a 
        datetime-like object that applies timezone normalization after 
        subtraction. 
        &quot;&quot;&quot;</span>

        <span class="s0">def </span><span class="s1">__sub__(self</span><span class="s0">, </span><span class="s1">other):</span>
            <span class="s1">r = super().__sub__(other)</span>
            <span class="s1">tzinfo = getattr(r</span><span class="s0">, </span><span class="s4">'tzinfo'</span><span class="s0">, None</span><span class="s1">)</span>

            <span class="s0">if </span><span class="s1">tzinfo </span><span class="s0">is not None</span><span class="s1">:</span>
                <span class="s1">localizer = getattr(tzinfo</span><span class="s0">, </span><span class="s4">'normalize'</span><span class="s0">, None</span><span class="s1">)</span>
                <span class="s0">if </span><span class="s1">localizer </span><span class="s0">is not None</span><span class="s1">:</span>
                    <span class="s1">r = tzinfo.normalize(r)</span>

            <span class="s0">if </span><span class="s1">isinstance(r</span><span class="s0">, </span><span class="s1">datetime.datetime):</span>
                <span class="s1">r = self.mk_tzaware(r)</span>

            <span class="s0">return </span><span class="s1">r</span>

        <span class="s0">def </span><span class="s1">__add__(self</span><span class="s0">, </span><span class="s1">other):</span>
            <span class="s0">return </span><span class="s1">self.mk_tzaware(super().__add__(other))</span>

        <span class="s0">def </span><span class="s1">astimezone(self</span><span class="s0">, </span><span class="s1">tzinfo):</span>
            <span class="s1">dt = super().astimezone(tzinfo)</span>
            <span class="s0">return </span><span class="s1">self.mk_tzaware(dt)</span>

        <span class="s1">@classmethod</span>
        <span class="s0">def </span><span class="s1">mk_tzaware(cls</span><span class="s0">, </span><span class="s1">datetime_obj):</span>
            <span class="s1">kwargs = {}</span>
            <span class="s1">attrs = (</span><span class="s4">'year'</span><span class="s0">,</span>
                     <span class="s4">'month'</span><span class="s0">,</span>
                     <span class="s4">'day'</span><span class="s0">,</span>
                     <span class="s4">'hour'</span><span class="s0">,</span>
                     <span class="s4">'minute'</span><span class="s0">,</span>
                     <span class="s4">'second'</span><span class="s0">,</span>
                     <span class="s4">'microsecond'</span><span class="s0">,</span>
                     <span class="s4">'tzinfo'</span><span class="s1">)</span>

            <span class="s0">for </span><span class="s1">attr </span><span class="s0">in </span><span class="s1">attrs:</span>
                <span class="s1">val = getattr(datetime_obj</span><span class="s0">, </span><span class="s1">attr</span><span class="s0">, None</span><span class="s1">)</span>
                <span class="s0">if </span><span class="s1">val </span><span class="s0">is not None</span><span class="s1">:</span>
                    <span class="s1">kwargs[attr] = val</span>

            <span class="s0">return </span><span class="s1">cls(**kwargs)</span>

    <span class="s2"># Define a date_range function similar to pandas.date_range</span>
    <span class="s0">def </span><span class="s1">date_range(start</span><span class="s0">, </span><span class="s1">freq</span><span class="s0">, </span><span class="s1">periods):</span>
        <span class="s1">dtstart = dt_tzaware.mk_tzaware(start)</span>

        <span class="s0">return </span><span class="s1">[dtstart + (i * freq) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(periods)]</span>

    <span class="s2"># Define a tz_convert function that converts a list to a new timezone.</span>
    <span class="s0">def </span><span class="s1">tz_convert(dt_list</span><span class="s0">, </span><span class="s1">tzinfo):</span>
        <span class="s0">return </span><span class="s1">[d.astimezone(tzinfo) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">dt_list]</span>

    <span class="s1">_test_date2num_dst(date_range</span><span class="s0">, </span><span class="s1">tz_convert)</span>


<span class="s0">def </span><span class="s1">test_date2num_dst_pandas(pd):</span>
    <span class="s2"># Test for github issue #3896, but in date2num around DST transitions</span>
    <span class="s2"># with a timezone-aware pandas date_range object.</span>

    <span class="s0">def </span><span class="s1">tz_convert(*args):</span>
        <span class="s0">return </span><span class="s1">pd.DatetimeIndex.tz_convert(*args).astype(object)</span>

    <span class="s1">_test_date2num_dst(pd.date_range</span><span class="s0">, </span><span class="s1">tz_convert)</span>


<span class="s0">def </span><span class="s1">_test_rrulewrapper(attach_tz</span><span class="s0">, </span><span class="s1">get_tz):</span>
    <span class="s1">SYD = get_tz(</span><span class="s4">'Australia/Sydney'</span><span class="s1">)</span>

    <span class="s1">dtstart = attach_tz(datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">SYD)</span>
    <span class="s1">dtend = attach_tz(datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">SYD)</span>

    <span class="s1">rule = mdates.rrulewrapper(freq=dateutil.rrule.DAILY</span><span class="s0">, </span><span class="s1">dtstart=dtstart)</span>

    <span class="s1">act = rule.between(dtstart</span><span class="s0">, </span><span class="s1">dtend)</span>
    <span class="s1">exp = [datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">13</span><span class="s0">, </span><span class="s1">tzinfo=dateutil.tz.tzutc())</span><span class="s0">,</span>
           <span class="s1">datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">14</span><span class="s0">, </span><span class="s1">tzinfo=dateutil.tz.tzutc())]</span>

    <span class="s0">assert </span><span class="s1">act == exp</span>


<span class="s0">def </span><span class="s1">test_rrulewrapper():</span>
    <span class="s0">def </span><span class="s1">attach_tz(dt</span><span class="s0">, </span><span class="s1">zi):</span>
        <span class="s0">return </span><span class="s1">dt.replace(tzinfo=zi)</span>

    <span class="s1">_test_rrulewrapper(attach_tz</span><span class="s0">, </span><span class="s1">dateutil.tz.gettz)</span>

    <span class="s1">SYD = dateutil.tz.gettz(</span><span class="s4">'Australia/Sydney'</span><span class="s1">)</span>
    <span class="s1">dtstart = datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">dtend = datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">rule = mdates.rrulewrapper(freq=dateutil.rrule.DAILY</span><span class="s0">, </span><span class="s1">dtstart=dtstart</span><span class="s0">,</span>
                               <span class="s1">tzinfo=SYD</span><span class="s0">, </span><span class="s1">until=dtend)</span>
    <span class="s0">assert </span><span class="s1">rule.after(dtstart) == datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">,</span>
                                                    <span class="s1">tzinfo=SYD)</span>
    <span class="s0">assert </span><span class="s1">rule.before(dtend) == datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">,</span>
                                                   <span class="s1">tzinfo=SYD)</span>

    <span class="s2"># Test parts of __getattr__</span>
    <span class="s0">assert </span><span class="s1">rule._base_tzinfo == SYD</span>
    <span class="s0">assert </span><span class="s1">rule._interval == </span><span class="s3">1</span>


<span class="s1">@pytest.mark.pytz</span>
<span class="s0">def </span><span class="s1">test_rrulewrapper_pytz():</span>
    <span class="s2"># Test to make sure pytz zones are supported in rrules</span>
    <span class="s1">pytz = pytest.importorskip(</span><span class="s4">&quot;pytz&quot;</span><span class="s1">)</span>

    <span class="s0">def </span><span class="s1">attach_tz(dt</span><span class="s0">, </span><span class="s1">zi):</span>
        <span class="s0">return </span><span class="s1">zi.localize(dt)</span>

    <span class="s1">_test_rrulewrapper(attach_tz</span><span class="s0">, </span><span class="s1">pytz.timezone)</span>


<span class="s1">@pytest.mark.pytz</span>
<span class="s0">def </span><span class="s1">test_yearlocator_pytz():</span>
    <span class="s1">pytz = pytest.importorskip(</span><span class="s4">&quot;pytz&quot;</span><span class="s1">)</span>

    <span class="s1">tz = pytz.timezone(</span><span class="s4">'America/New_York'</span><span class="s1">)</span>
    <span class="s1">x = [tz.localize(datetime.datetime(</span><span class="s3">2010</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
         <span class="s1">+ datetime.timedelta(i) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">2000</span><span class="s1">)]</span>
    <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">True, </span><span class="s1">tz=tz)</span>
    <span class="s1">locator.create_dummy_axis()</span>
    <span class="s1">locator.axis.set_view_interval(mdates.date2num(x[</span><span class="s3">0</span><span class="s1">])-</span><span class="s3">1.0</span><span class="s0">,</span>
                                   <span class="s1">mdates.date2num(x[-</span><span class="s3">1</span><span class="s1">])+</span><span class="s3">1.0</span><span class="s1">)</span>
    <span class="s1">t = np.array([</span><span class="s3">733408.208333</span><span class="s0">, </span><span class="s3">733773.208333</span><span class="s0">, </span><span class="s3">734138.208333</span><span class="s0">,</span>
                  <span class="s3">734503.208333</span><span class="s0">, </span><span class="s3">734869.208333</span><span class="s0">, </span><span class="s3">735234.208333</span><span class="s0">, </span><span class="s3">735599.208333</span><span class="s1">])</span>
    <span class="s2"># convert to new epoch from old...</span>
    <span class="s1">t = t + mdates.date2num(np.datetime64(</span><span class="s4">'0000-12-31'</span><span class="s1">))</span>
    <span class="s1">np.testing.assert_allclose(t</span><span class="s0">, </span><span class="s1">locator())</span>
    <span class="s1">expected = [</span><span class="s4">'2009-01-01 00:00:00-05:00'</span><span class="s0">,</span>
                <span class="s4">'2010-01-01 00:00:00-05:00'</span><span class="s0">, </span><span class="s4">'2011-01-01 00:00:00-05:00'</span><span class="s0">,</span>
                <span class="s4">'2012-01-01 00:00:00-05:00'</span><span class="s0">, </span><span class="s4">'2013-01-01 00:00:00-05:00'</span><span class="s0">,</span>
                <span class="s4">'2014-01-01 00:00:00-05:00'</span><span class="s0">, </span><span class="s4">'2015-01-01 00:00:00-05:00'</span><span class="s1">]</span>
    <span class="s1">st = list(map(str</span><span class="s0">, </span><span class="s1">mdates.num2date(locator()</span><span class="s0">, </span><span class="s1">tz=tz)))</span>
    <span class="s0">assert </span><span class="s1">st == expected</span>
    <span class="s0">assert </span><span class="s1">np.allclose(locator.tick_values(x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">, </span><span class="s1">np.array(</span>
        <span class="s1">[</span><span class="s3">14610.20833333</span><span class="s0">, </span><span class="s3">14610.33333333</span><span class="s0">, </span><span class="s3">14610.45833333</span><span class="s0">, </span><span class="s3">14610.58333333</span><span class="s0">,</span>
         <span class="s3">14610.70833333</span><span class="s0">, </span><span class="s3">14610.83333333</span><span class="s0">, </span><span class="s3">14610.95833333</span><span class="s0">, </span><span class="s3">14611.08333333</span><span class="s0">,</span>
         <span class="s3">14611.20833333</span><span class="s1">]))</span>
    <span class="s0">assert </span><span class="s1">np.allclose(locator.get_locator(x[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">0</span><span class="s1">]).tick_values(x[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">x[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
                       <span class="s1">np.array(</span>
        <span class="s1">[</span><span class="s3">14610.20833333</span><span class="s0">, </span><span class="s3">14610.33333333</span><span class="s0">, </span><span class="s3">14610.45833333</span><span class="s0">, </span><span class="s3">14610.58333333</span><span class="s0">,</span>
         <span class="s3">14610.70833333</span><span class="s0">, </span><span class="s3">14610.83333333</span><span class="s0">, </span><span class="s3">14610.95833333</span><span class="s0">, </span><span class="s3">14611.08333333</span><span class="s0">,</span>
         <span class="s3">14611.20833333</span><span class="s1">]))</span>


<span class="s0">def </span><span class="s1">test_YearLocator():</span>
    <span class="s0">def </span><span class="s1">_create_year_locator(date1</span><span class="s0">, </span><span class="s1">date2</span><span class="s0">, </span><span class="s1">**kwargs):</span>
        <span class="s1">locator = mdates.YearLocator(**kwargs)</span>
        <span class="s1">locator.create_dummy_axis()</span>
        <span class="s1">locator.axis.set_view_interval(mdates.date2num(date1)</span><span class="s0">,</span>
                                       <span class="s1">mdates.date2num(date2))</span>
        <span class="s0">return </span><span class="s1">locator</span>

    <span class="s1">d1 = datetime.datetime(</span><span class="s3">1990</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">results = ([datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s4">'base'</span><span class="s1">: </span><span class="s3">20</span><span class="s0">, </span><span class="s4">'month'</span><span class="s1">: </span><span class="s3">1</span><span class="s0">, </span><span class="s4">'day'</span><span class="s1">: </span><span class="s3">1</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1980-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2000-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2020-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2040-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2060-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2080-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2100-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2120-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2140-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2160-01-01 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2180-01-01 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2200-01-01 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">200</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s4">'base'</span><span class="s1">: </span><span class="s3">20</span><span class="s0">, </span><span class="s4">'month'</span><span class="s1">: </span><span class="s3">5</span><span class="s0">, </span><span class="s4">'day'</span><span class="s1">: </span><span class="s3">16</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1980-05-16 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2000-05-16 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2020-05-16 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2040-05-16 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2060-05-16 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2080-05-16 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2100-05-16 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2120-05-16 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2140-05-16 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2160-05-16 00:00:00+00:00'</span><span class="s0">,</span>
                 <span class="s4">'2180-05-16 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2200-05-16 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">[datetime.timedelta(weeks=</span><span class="s3">52 </span><span class="s1">* </span><span class="s3">5</span><span class="s1">)</span><span class="s0">,</span>
                <span class="s1">{</span><span class="s4">'base'</span><span class="s1">: </span><span class="s3">20</span><span class="s0">, </span><span class="s4">'month'</span><span class="s1">: </span><span class="s3">9</span><span class="s0">, </span><span class="s4">'day'</span><span class="s1">: </span><span class="s3">25</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">[</span><span class="s4">'1980-09-25 00:00:00+00:00'</span><span class="s0">, </span><span class="s4">'2000-09-25 00:00:00+00:00'</span><span class="s1">]</span>
                <span class="s1">]</span><span class="s0">,</span>
               <span class="s1">)</span>

    <span class="s0">for </span><span class="s1">delta</span><span class="s0">, </span><span class="s1">arguments</span><span class="s0">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s1">d2 = d1 + delta</span>
        <span class="s1">locator = _create_year_locator(d1</span><span class="s0">, </span><span class="s1">d2</span><span class="s0">, </span><span class="s1">**arguments)</span>
        <span class="s0">assert </span><span class="s1">list(map(str</span><span class="s0">, </span><span class="s1">mdates.num2date(locator()))) == expected</span>


<span class="s0">def </span><span class="s1">test_DayLocator():</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mdates.DayLocator(interval=-</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mdates.DayLocator(interval=-</span><span class="s3">1.5</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mdates.DayLocator(interval=</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">mdates.DayLocator(interval=</span><span class="s3">1.3</span><span class="s1">)</span>
    <span class="s1">mdates.DayLocator(interval=</span><span class="s3">1.0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_tz_utc():</span>
    <span class="s1">dt = datetime.datetime(</span><span class="s3">1970</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">tzinfo=mdates.UTC)</span>
    <span class="s0">assert </span><span class="s1">dt.tzname() == </span><span class="s4">'UTC'</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">&quot;x, tdelta&quot;</span><span class="s0">,</span>
                         <span class="s1">[(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">datetime.timedelta(days=</span><span class="s3">1</span><span class="s1">))</span><span class="s0">,</span>
                          <span class="s1">([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[datetime.timedelta(days=</span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
                                      <span class="s1">datetime.timedelta(days=</span><span class="s3">1.5</span><span class="s1">)])])</span>
<span class="s0">def </span><span class="s1">test_num2timedelta(x</span><span class="s0">, </span><span class="s1">tdelta):</span>
    <span class="s1">dt = mdates.num2timedelta(x)</span>
    <span class="s0">assert </span><span class="s1">dt == tdelta</span>


<span class="s0">def </span><span class="s1">test_datetime64_in_list():</span>
    <span class="s1">dt = [np.datetime64(</span><span class="s4">'2000-01-01'</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.datetime64(</span><span class="s4">'2001-01-01'</span><span class="s1">)]</span>
    <span class="s1">dn = mdates.date2num(dt)</span>
    <span class="s2"># convert fixed values from old to new epoch</span>
    <span class="s1">t = (np.array([</span><span class="s3">730120.</span><span class="s0">,  </span><span class="s3">730486.</span><span class="s1">]) +</span>
         <span class="s1">mdates.date2num(np.datetime64(</span><span class="s4">'0000-12-31'</span><span class="s1">)))</span>
    <span class="s1">np.testing.assert_equal(dn</span><span class="s0">, </span><span class="s1">t)</span>


<span class="s0">def </span><span class="s1">test_change_epoch():</span>
    <span class="s1">date = np.datetime64(</span><span class="s4">'2000-01-01'</span><span class="s1">)</span>

    <span class="s2"># use private method to clear the epoch and allow it to be set...</span>
    <span class="s1">mdates._reset_epoch_test_example()</span>
    <span class="s1">mdates.get_epoch()  </span><span class="s2"># Set default.</span>

    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError):</span>
        <span class="s2"># this should fail here because there is a sentinel on the epoch</span>
        <span class="s2"># if the epoch has been used then it cannot be set.</span>
        <span class="s1">mdates.set_epoch(</span><span class="s4">'0000-01-01'</span><span class="s1">)</span>

    <span class="s1">mdates._reset_epoch_test_example()</span>
    <span class="s1">mdates.set_epoch(</span><span class="s4">'1970-01-01'</span><span class="s1">)</span>
    <span class="s1">dt = (date - np.datetime64(</span><span class="s4">'1970-01-01'</span><span class="s1">)).astype(</span><span class="s4">'datetime64[D]'</span><span class="s1">)</span>
    <span class="s1">dt = dt.astype(</span><span class="s4">'int'</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_equal(mdates.date2num(date)</span><span class="s0">, </span><span class="s1">float(dt))</span>

    <span class="s1">mdates._reset_epoch_test_example()</span>
    <span class="s1">mdates.set_epoch(</span><span class="s4">'0000-12-31'</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_equal(mdates.date2num(date)</span><span class="s0">, </span><span class="s3">730120.0</span><span class="s1">)</span>

    <span class="s1">mdates._reset_epoch_test_example()</span>
    <span class="s1">mdates.set_epoch(</span><span class="s4">'1970-01-01T01:00:00'</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(mdates.date2num(date)</span><span class="s0">, </span><span class="s1">dt - </span><span class="s3">1.</span><span class="s1">/</span><span class="s3">24.</span><span class="s1">)</span>
    <span class="s1">mdates._reset_epoch_test_example()</span>
    <span class="s1">mdates.set_epoch(</span><span class="s4">'1970-01-01T00:00:00'</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(</span>
        <span class="s1">mdates.date2num(np.datetime64(</span><span class="s4">'1970-01-01T12:00:00'</span><span class="s1">))</span><span class="s0">,</span>
        <span class="s3">0.5</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_warn_notintervals():</span>
    <span class="s1">dates = np.arange(</span><span class="s4">'2001-01-10'</span><span class="s0">, </span><span class="s4">'2001-03-04'</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">'datetime64[D]'</span><span class="s1">)</span>
    <span class="s1">locator = mdates.AutoDateLocator(interval_multiples=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">locator.intervald[</span><span class="s3">3</span><span class="s1">] = [</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">locator.create_dummy_axis()</span>
    <span class="s1">locator.axis.set_view_interval(mdates.date2num(dates[</span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
                                   <span class="s1">mdates.date2num(dates[-</span><span class="s3">1</span><span class="s1">]))</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;AutoDateLocator was unable&quot;</span><span class="s1">):</span>
        <span class="s1">locs = locator()</span>


<span class="s0">def </span><span class="s1">test_change_converter():</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'date.converter'</span><span class="s1">] = </span><span class="s4">'concise'</span>
    <span class="s1">dates = np.arange(</span><span class="s4">'2020-01-01'</span><span class="s0">, </span><span class="s4">'2020-05-01'</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">'datetime64[D]'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.plot(dates</span><span class="s0">, </span><span class="s1">np.arange(len(dates)))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s3">0</span><span class="s1">].get_text() == </span><span class="s4">'Jan'</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s3">1</span><span class="s1">].get_text() == </span><span class="s4">'15'</span>

    <span class="s1">plt.rcParams[</span><span class="s4">'date.converter'</span><span class="s1">] = </span><span class="s4">'auto'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.plot(dates</span><span class="s0">, </span><span class="s1">np.arange(len(dates)))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s3">0</span><span class="s1">].get_text() == </span><span class="s4">'Jan 01 2020'</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s3">1</span><span class="s1">].get_text() == </span><span class="s4">'Jan 15 2020'</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.rcParams[</span><span class="s4">'date.converter'</span><span class="s1">] = </span><span class="s4">'boo'</span>


<span class="s0">def </span><span class="s1">test_change_interval_multiples():</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'date.interval_multiples'</span><span class="s1">] = </span><span class="s0">False</span>
    <span class="s1">dates = np.arange(</span><span class="s4">'2020-01-10'</span><span class="s0">, </span><span class="s4">'2020-05-01'</span><span class="s0">, </span><span class="s1">dtype=</span><span class="s4">'datetime64[D]'</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.plot(dates</span><span class="s0">, </span><span class="s1">np.arange(len(dates)))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s3">0</span><span class="s1">].get_text() == </span><span class="s4">'Jan 10 2020'</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s3">1</span><span class="s1">].get_text() == </span><span class="s4">'Jan 24 2020'</span>

    <span class="s1">plt.rcParams[</span><span class="s4">'date.interval_multiples'</span><span class="s1">] = </span><span class="s4">'True'</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.plot(dates</span><span class="s0">, </span><span class="s1">np.arange(len(dates)))</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s3">0</span><span class="s1">].get_text() == </span><span class="s4">'Jan 15 2020'</span>
    <span class="s0">assert </span><span class="s1">ax.get_xticklabels()[</span><span class="s3">1</span><span class="s1">].get_text() == </span><span class="s4">'Feb 01 2020'</span>


<span class="s0">def </span><span class="s1">test_julian2num():</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning):</span>
        <span class="s1">mdates._reset_epoch_test_example()</span>
        <span class="s1">mdates.set_epoch(</span><span class="s4">'0000-12-31'</span><span class="s1">)</span>
        <span class="s2"># 2440587.5 is julian date for 1970-01-01T00:00:00</span>
        <span class="s2"># https://en.wikipedia.org/wiki/Julian_day</span>
        <span class="s0">assert </span><span class="s1">mdates.julian2num(</span><span class="s3">2440588.5</span><span class="s1">) == </span><span class="s3">719164.0</span>
        <span class="s0">assert </span><span class="s1">mdates.num2julian(</span><span class="s3">719165.0</span><span class="s1">) == </span><span class="s3">2440589.5</span>
        <span class="s2"># set back to the default</span>
        <span class="s1">mdates._reset_epoch_test_example()</span>
        <span class="s1">mdates.set_epoch(</span><span class="s4">'1970-01-01T00:00:00'</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">mdates.julian2num(</span><span class="s3">2440588.5</span><span class="s1">) == </span><span class="s3">1.0</span>
        <span class="s0">assert </span><span class="s1">mdates.num2julian(</span><span class="s3">2.0</span><span class="s1">) == </span><span class="s3">2440589.5</span>


<span class="s0">def </span><span class="s1">test_DateLocator():</span>
    <span class="s1">locator = mdates.DateLocator()</span>
    <span class="s2"># Test nonsingular</span>
    <span class="s0">assert </span><span class="s1">locator.nonsingular(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">np.inf) == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">locator.nonsingular(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">) == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">locator.nonsingular(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">) == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">locator.nonsingular(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">) == (-</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">locator.create_dummy_axis()</span>
    <span class="s2"># default values</span>
    <span class="s0">assert </span><span class="s1">locator.datalim_to_dt() == (</span>
        <span class="s1">datetime.datetime(</span><span class="s3">1970</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">tzinfo=datetime.timezone.utc)</span><span class="s0">,</span>
        <span class="s1">datetime.datetime(</span><span class="s3">1970</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">tzinfo=datetime.timezone.utc))</span>

    <span class="s2"># Check default is UTC</span>
    <span class="s0">assert </span><span class="s1">locator.tz == mdates.UTC</span>
    <span class="s1">tz_str = </span><span class="s4">'Iceland'</span>
    <span class="s1">iceland_tz = dateutil.tz.gettz(tz_str)</span>
    <span class="s2"># Check not Iceland</span>
    <span class="s0">assert </span><span class="s1">locator.tz != iceland_tz</span>
    <span class="s2"># Set it to to Iceland</span>
    <span class="s1">locator.set_tzinfo(</span><span class="s4">'Iceland'</span><span class="s1">)</span>
    <span class="s2"># Check now it is Iceland</span>
    <span class="s0">assert </span><span class="s1">locator.tz == iceland_tz</span>
    <span class="s1">locator.create_dummy_axis()</span>
    <span class="s1">locator.axis.set_data_interval(*mdates.date2num([</span><span class="s4">&quot;2022-01-10&quot;</span><span class="s0">,</span>
                                                     <span class="s4">&quot;2022-01-08&quot;</span><span class="s1">]))</span>
    <span class="s0">assert </span><span class="s1">locator.datalim_to_dt() == (</span>
        <span class="s1">datetime.datetime(</span><span class="s3">2022</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">8</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">tzinfo=iceland_tz)</span><span class="s0">,</span>
        <span class="s1">datetime.datetime(</span><span class="s3">2022</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s1">tzinfo=iceland_tz))</span>

    <span class="s2"># Set rcParam</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'timezone'</span><span class="s1">] = tz_str</span>

    <span class="s2"># Create a new one in a similar way</span>
    <span class="s1">locator = mdates.DateLocator()</span>
    <span class="s2"># Check now it is Iceland</span>
    <span class="s0">assert </span><span class="s1">locator.tz == iceland_tz</span>

    <span class="s2"># Test invalid tz values</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;Aiceland is not a valid timezone&quot;</span><span class="s1">):</span>
        <span class="s1">mdates.DateLocator(tz=</span><span class="s4">&quot;Aiceland&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s4">&quot;tz must be string or tzinfo subclass.&quot;</span><span class="s1">):</span>
        <span class="s1">mdates.DateLocator(tz=</span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_datestr2num():</span>
    <span class="s0">assert </span><span class="s1">mdates.datestr2num(</span><span class="s4">'2022-01-10'</span><span class="s1">) == </span><span class="s3">19002.0</span>
    <span class="s1">dt = datetime.date(year=</span><span class="s3">2022</span><span class="s0">, </span><span class="s1">month=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">mdates.datestr2num(</span><span class="s4">'2022-01'</span><span class="s0">, </span><span class="s1">default=dt) == </span><span class="s3">19002.0</span>
    <span class="s0">assert </span><span class="s1">np.all(mdates.datestr2num(</span>
        <span class="s1">[</span><span class="s4">'2022-01'</span><span class="s0">, </span><span class="s4">'2022-02'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">default=dt</span>
        <span class="s1">) == np.array([</span><span class="s3">19002.</span><span class="s0">, </span><span class="s3">19033.</span><span class="s1">]))</span>
    <span class="s0">assert </span><span class="s1">mdates.datestr2num([]).size == </span><span class="s3">0</span>
    <span class="s0">assert </span><span class="s1">mdates.datestr2num([]</span><span class="s0">, </span><span class="s1">datetime.date(year=</span><span class="s3">2022</span><span class="s0">,</span>
                                                <span class="s1">month=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">day=</span><span class="s3">10</span><span class="s1">)).size == </span><span class="s3">0</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'kwarg'</span><span class="s0">,</span>
                         <span class="s1">(</span><span class="s4">'formats'</span><span class="s0">, </span><span class="s4">'zero_formats'</span><span class="s0">, </span><span class="s4">'offset_formats'</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_concise_formatter_exceptions(kwarg):</span>
    <span class="s1">locator = mdates.AutoDateLocator()</span>
    <span class="s1">kwargs = {kwarg: [</span><span class="s4">''</span><span class="s0">, </span><span class="s4">'%Y'</span><span class="s1">]}</span>
    <span class="s1">match = </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">kwarg</span><span class="s0">} </span><span class="s4">argument must be a list&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=match):</span>
        <span class="s1">mdates.ConciseDateFormatter(locator</span><span class="s0">, </span><span class="s1">**kwargs)</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_call():</span>
    <span class="s1">locator = mdates.AutoDateLocator()</span>
    <span class="s1">formatter = mdates.ConciseDateFormatter(locator)</span>
    <span class="s0">assert </span><span class="s1">formatter(</span><span class="s3">19002.0</span><span class="s1">) == </span><span class="s4">'2022'</span>
    <span class="s0">assert </span><span class="s1">formatter.format_data_short(</span><span class="s3">19002.0</span><span class="s1">) == </span><span class="s4">'2022-01-10 00:00:00'</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'span, expected_locator'</span><span class="s0">,</span>
                         <span class="s1">((</span><span class="s3">0.02</span><span class="s0">, </span><span class="s1">mdates.MinuteLocator)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">mdates.HourLocator)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s3">19</span><span class="s0">, </span><span class="s1">mdates.DayLocator)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s3">40</span><span class="s0">, </span><span class="s1">mdates.WeekdayLocator)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s3">200</span><span class="s0">, </span><span class="s1">mdates.MonthLocator)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s3">2000</span><span class="s0">, </span><span class="s1">mdates.YearLocator)))</span>
<span class="s0">def </span><span class="s1">test_date_ticker_factory(span</span><span class="s0">, </span><span class="s1">expected_locator):</span>
    <span class="s0">with </span><span class="s1">pytest.warns(_api.MatplotlibDeprecationWarning):</span>
        <span class="s1">locator</span><span class="s0">, </span><span class="s1">_ = mdates.date_ticker_factory(span)</span>
        <span class="s0">assert </span><span class="s1">isinstance(locator</span><span class="s0">, </span><span class="s1">expected_locator)</span>


<span class="s0">def </span><span class="s1">test_datetime_masked():</span>
    <span class="s2"># make sure that all-masked data falls back to the viewlim</span>
    <span class="s2"># set in convert.axisinfo....</span>
    <span class="s1">x = np.array([datetime.datetime(</span><span class="s3">2017</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">n) </span><span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">6</span><span class="s1">)])</span>
    <span class="s1">y = np.array([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">])</span>
    <span class="s1">m = np.ma.masked_greater(y</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">m)</span>
    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'val'</span><span class="s0">, </span><span class="s1">(-</span><span class="s3">1000000</span><span class="s0">, </span><span class="s3">10000000</span><span class="s1">))</span>
<span class="s0">def </span><span class="s1">test_num2date_error(val):</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">f&quot;Date ordinal </span><span class="s0">{</span><span class="s1">val</span><span class="s0">} </span><span class="s4">converts&quot;</span><span class="s1">):</span>
        <span class="s1">mdates.num2date(val)</span>


<span class="s0">def </span><span class="s1">test_num2date_roundoff():</span>
    <span class="s0">assert </span><span class="s1">mdates.num2date(</span><span class="s3">100000.0000578702</span><span class="s1">) == datetime.datetime(</span>
        <span class="s3">2243</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">17</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">999980</span><span class="s0">, </span><span class="s1">tzinfo=datetime.timezone.utc)</span>
    <span class="s2"># Slightly larger, steps of 20 microseconds</span>
    <span class="s0">assert </span><span class="s1">mdates.num2date(</span><span class="s3">100000.0000578703</span><span class="s1">) == datetime.datetime(</span>
        <span class="s3">2243</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">17</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s1">tzinfo=datetime.timezone.utc)</span>


<span class="s0">def </span><span class="s1">test_DateFormatter_settz():</span>
    <span class="s1">time = mdates.date2num(datetime.datetime(</span><span class="s3">2011</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">,</span>
                                             <span class="s1">tzinfo=mdates.UTC))</span>
    <span class="s1">formatter = mdates.DateFormatter(</span><span class="s4">'%Y-%b-%d %H:%M'</span><span class="s1">)</span>
    <span class="s2"># Default UTC</span>
    <span class="s0">assert </span><span class="s1">formatter(time) == </span><span class="s4">'2011-Jan-01 00:00'</span>

    <span class="s2"># Set tzinfo</span>
    <span class="s1">formatter.set_tzinfo(</span><span class="s4">'Pacific/Kiritimati'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">formatter(time) == </span><span class="s4">'2011-Jan-01 14:00'</span>
</pre>
</body>
</html>