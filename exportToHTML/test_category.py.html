<html>
<head>
<title>test_category.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #808080;}
.s6 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_category.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Catch all for categorical functions&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>

<span class="s2">import </span><span class="s1">matplotlib </span><span class="s2">as </span><span class="s1">mpl</span>
<span class="s2">from </span><span class="s1">matplotlib.axes </span><span class="s2">import </span><span class="s1">Axes</span>
<span class="s2">import </span><span class="s1">matplotlib.pyplot </span><span class="s2">as </span><span class="s1">plt</span>
<span class="s2">import </span><span class="s1">matplotlib.category </span><span class="s2">as </span><span class="s1">cat</span>
<span class="s2">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s2">import </span><span class="s1">check_figures_equal</span>


<span class="s2">class </span><span class="s1">TestUnitData:</span>
    <span class="s1">test_cases = [(</span><span class="s3">'single'</span><span class="s2">, </span><span class="s1">([</span><span class="s3">&quot;hello world&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]))</span><span class="s2">,</span>
                  <span class="s1">(</span><span class="s3">'unicode'</span><span class="s2">, </span><span class="s1">([</span><span class="s3">&quot;Здравствуйте мир&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s1">]))</span><span class="s2">,</span>
                  <span class="s1">(</span><span class="s3">'mixed'</span><span class="s2">, </span><span class="s1">([</span><span class="s3">'A'</span><span class="s2">, </span><span class="s3">&quot;np.nan&quot;</span><span class="s2">, </span><span class="s3">'B'</span><span class="s2">, </span><span class="s3">&quot;3.14&quot;</span><span class="s2">, </span><span class="s3">&quot;мир&quot;</span><span class="s1">]</span><span class="s2">,</span>
                             <span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">]))]</span>
    <span class="s1">ids</span><span class="s2">, </span><span class="s1">data = zip(*test_cases)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;data, locs&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">ids=ids)</span>
    <span class="s2">def </span><span class="s1">test_unit(self</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">locs):</span>
        <span class="s1">unit = cat.UnitData(data)</span>
        <span class="s2">assert </span><span class="s1">list(unit._mapping.keys()) == data</span>
        <span class="s2">assert </span><span class="s1">list(unit._mapping.values()) == locs</span>

    <span class="s2">def </span><span class="s1">test_update(self):</span>
        <span class="s1">data = [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s1">]</span>
        <span class="s1">locs = [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">]</span>

        <span class="s1">data_update = [</span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s2">, </span><span class="s3">'e'</span><span class="s1">]</span>
        <span class="s1">unique_data = [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'e'</span><span class="s1">]</span>
        <span class="s1">updated_locs = [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span>

        <span class="s1">unit = cat.UnitData(data)</span>
        <span class="s2">assert </span><span class="s1">list(unit._mapping.keys()) == data</span>
        <span class="s2">assert </span><span class="s1">list(unit._mapping.values()) == locs</span>

        <span class="s1">unit.update(data_update)</span>
        <span class="s2">assert </span><span class="s1">list(unit._mapping.keys()) == unique_data</span>
        <span class="s2">assert </span><span class="s1">list(unit._mapping.values()) == updated_locs</span>

    <span class="s1">failing_test_cases = [(</span><span class="s3">&quot;number&quot;</span><span class="s2">, </span><span class="s4">3.14</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;nan&quot;</span><span class="s2">, </span><span class="s1">np.nan)</span><span class="s2">,</span>
                          <span class="s1">(</span><span class="s3">&quot;list&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3.14</span><span class="s2">, </span><span class="s4">12</span><span class="s1">])</span><span class="s2">, </span><span class="s1">(</span><span class="s3">&quot;mixed type&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])]</span>

    <span class="s1">fids</span><span class="s2">, </span><span class="s1">fdata = zip(*test_cases)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;fdata&quot;</span><span class="s2">, </span><span class="s1">fdata</span><span class="s2">, </span><span class="s1">ids=fids)</span>
    <span class="s2">def </span><span class="s1">test_non_string_fails(self</span><span class="s2">, </span><span class="s1">fdata):</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">cat.UnitData(fdata)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;fdata&quot;</span><span class="s2">, </span><span class="s1">fdata</span><span class="s2">, </span><span class="s1">ids=fids)</span>
    <span class="s2">def </span><span class="s1">test_non_string_update_fails(self</span><span class="s2">, </span><span class="s1">fdata):</span>
        <span class="s1">unitdata = cat.UnitData()</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">unitdata.update(fdata)</span>


<span class="s2">class </span><span class="s1">FakeAxis:</span>
    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">units):</span>
        <span class="s1">self.units = units</span>


<span class="s2">class </span><span class="s1">TestStrCategoryConverter:</span>
    <span class="s0">&quot;&quot;&quot; 
    Based on the pandas conversion and factorization tests: 
 
    ref: /pandas/tseries/tests/test_converter.py 
         /pandas/tests/test_algos.py:TestFactorize 
    &quot;&quot;&quot;</span>
    <span class="s1">test_cases = [(</span><span class="s3">&quot;unicode&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;Здравствуйте мир&quot;</span><span class="s1">])</span><span class="s2">,</span>
                  <span class="s1">(</span><span class="s3">&quot;ascii&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;hello world&quot;</span><span class="s1">])</span><span class="s2">,</span>
                  <span class="s1">(</span><span class="s3">&quot;single&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'c'</span><span class="s1">])</span><span class="s2">,</span>
                  <span class="s1">(</span><span class="s3">&quot;integer string&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s1">])</span><span class="s2">,</span>
                  <span class="s1">(</span><span class="s3">&quot;single + values&gt;10&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;E&quot;</span><span class="s2">, </span><span class="s3">&quot;F&quot;</span><span class="s2">, </span><span class="s3">&quot;G&quot;</span><span class="s2">,</span>
                                          <span class="s3">&quot;H&quot;</span><span class="s2">, </span><span class="s3">&quot;I&quot;</span><span class="s2">, </span><span class="s3">&quot;J&quot;</span><span class="s2">, </span><span class="s3">&quot;K&quot;</span><span class="s2">, </span><span class="s3">&quot;L&quot;</span><span class="s2">, </span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;N&quot;</span><span class="s2">,</span>
                                          <span class="s3">&quot;O&quot;</span><span class="s2">, </span><span class="s3">&quot;P&quot;</span><span class="s2">, </span><span class="s3">&quot;Q&quot;</span><span class="s2">, </span><span class="s3">&quot;R&quot;</span><span class="s2">, </span><span class="s3">&quot;S&quot;</span><span class="s2">, </span><span class="s3">&quot;T&quot;</span><span class="s2">, </span><span class="s3">&quot;U&quot;</span><span class="s2">,</span>
                                          <span class="s3">&quot;V&quot;</span><span class="s2">, </span><span class="s3">&quot;W&quot;</span><span class="s2">, </span><span class="s3">&quot;X&quot;</span><span class="s2">, </span><span class="s3">&quot;Y&quot;</span><span class="s2">, </span><span class="s3">&quot;Z&quot;</span><span class="s1">])]</span>

    <span class="s1">ids</span><span class="s2">, </span><span class="s1">values = zip(*test_cases)</span>

    <span class="s1">failing_test_cases = [(</span><span class="s3">&quot;mixed&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s4">3.14</span><span class="s2">, </span><span class="s3">'A'</span><span class="s2">, </span><span class="s1">np.inf])</span><span class="s2">,</span>
                          <span class="s1">(</span><span class="s3">&quot;string integer&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'42'</span><span class="s2">, </span><span class="s4">42</span><span class="s1">])]</span>

    <span class="s1">fids</span><span class="s2">, </span><span class="s1">fvalues = zip(*failing_test_cases)</span>

    <span class="s1">@pytest.fixture(autouse=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">def </span><span class="s1">mock_axis(self</span><span class="s2">, </span><span class="s1">request):</span>
        <span class="s1">self.cc = cat.StrCategoryConverter()</span>
        <span class="s5"># self.unit should be probably be replaced with real mock unit</span>
        <span class="s1">self.unit = cat.UnitData()</span>
        <span class="s1">self.ax = FakeAxis(self.unit)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;vals&quot;</span><span class="s2">, </span><span class="s1">values</span><span class="s2">, </span><span class="s1">ids=ids)</span>
    <span class="s2">def </span><span class="s1">test_convert(self</span><span class="s2">, </span><span class="s1">vals):</span>
        <span class="s1">np.testing.assert_allclose(self.cc.convert(vals</span><span class="s2">, </span><span class="s1">self.ax.units</span><span class="s2">,</span>
                                                   <span class="s1">self.ax)</span><span class="s2">,</span>
                                   <span class="s1">range(len(vals)))</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;value&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;hi&quot;</span><span class="s2">, </span><span class="s3">&quot;мир&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ids=[</span><span class="s3">&quot;ascii&quot;</span><span class="s2">, </span><span class="s3">&quot;unicode&quot;</span><span class="s1">])</span>
    <span class="s2">def </span><span class="s1">test_convert_one_string(self</span><span class="s2">, </span><span class="s1">value):</span>
        <span class="s2">assert </span><span class="s1">self.cc.convert(value</span><span class="s2">, </span><span class="s1">self.unit</span><span class="s2">, </span><span class="s1">self.ax) == </span><span class="s4">0</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;fvals&quot;</span><span class="s2">, </span><span class="s1">fvalues</span><span class="s2">, </span><span class="s1">ids=fids)</span>
    <span class="s2">def </span><span class="s1">test_convert_fail(self</span><span class="s2">, </span><span class="s1">fvals):</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">self.cc.convert(fvals</span><span class="s2">, </span><span class="s1">self.unit</span><span class="s2">, </span><span class="s1">self.ax)</span>

    <span class="s2">def </span><span class="s1">test_axisinfo(self):</span>
        <span class="s1">axis = self.cc.axisinfo(self.unit</span><span class="s2">, </span><span class="s1">self.ax)</span>
        <span class="s2">assert </span><span class="s1">isinstance(axis.majloc</span><span class="s2">, </span><span class="s1">cat.StrCategoryLocator)</span>
        <span class="s2">assert </span><span class="s1">isinstance(axis.majfmt</span><span class="s2">, </span><span class="s1">cat.StrCategoryFormatter)</span>

    <span class="s2">def </span><span class="s1">test_default_units(self):</span>
        <span class="s2">assert </span><span class="s1">isinstance(self.cc.default_units([</span><span class="s3">&quot;a&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">self.ax)</span><span class="s2">, </span><span class="s1">cat.UnitData)</span>


<span class="s1">PLOT_LIST = [Axes.scatter</span><span class="s2">, </span><span class="s1">Axes.plot</span><span class="s2">, </span><span class="s1">Axes.bar]</span>
<span class="s1">PLOT_IDS = [</span><span class="s3">&quot;scatter&quot;</span><span class="s2">, </span><span class="s3">&quot;plot&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">]</span>


<span class="s2">class </span><span class="s1">TestStrCategoryLocator:</span>
    <span class="s2">def </span><span class="s1">test_StrCategoryLocator(self):</span>
        <span class="s1">locs = [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s1">]</span>
        <span class="s1">unit = cat.UnitData([str(j) </span><span class="s2">for </span><span class="s1">j </span><span class="s2">in </span><span class="s1">locs])</span>
        <span class="s1">ticks = cat.StrCategoryLocator(unit._mapping)</span>
        <span class="s1">np.testing.assert_array_equal(ticks.tick_values(</span><span class="s2">None, None</span><span class="s1">)</span><span class="s2">, </span><span class="s1">locs)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s2">def </span><span class="s1">test_StrCategoryLocatorPlot(self</span><span class="s2">, </span><span class="s1">plotter):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s1">])</span>
        <span class="s1">np.testing.assert_array_equal(ax.yaxis.major.locator()</span><span class="s2">, </span><span class="s1">range(</span><span class="s4">3</span><span class="s1">))</span>


<span class="s2">class </span><span class="s1">TestStrCategoryFormatter:</span>
    <span class="s1">test_cases = [(</span><span class="s3">&quot;ascii&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;hello&quot;</span><span class="s2">, </span><span class="s3">&quot;world&quot;</span><span class="s2">, </span><span class="s3">&quot;hi&quot;</span><span class="s1">])</span><span class="s2">,</span>
                  <span class="s1">(</span><span class="s3">&quot;unicode&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;Здравствуйте&quot;</span><span class="s2">, </span><span class="s3">&quot;привет&quot;</span><span class="s1">])]</span>

    <span class="s1">ids</span><span class="s2">, </span><span class="s1">cases = zip(*test_cases)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;ydata&quot;</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">, </span><span class="s1">ids=ids)</span>
    <span class="s2">def </span><span class="s1">test_StrCategoryFormatter(self</span><span class="s2">, </span><span class="s1">ydata):</span>
        <span class="s1">unit = cat.UnitData(ydata)</span>
        <span class="s1">labels = cat.StrCategoryFormatter(unit._mapping)</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">d </span><span class="s2">in </span><span class="s1">enumerate(ydata):</span>
            <span class="s2">assert </span><span class="s1">labels(i</span><span class="s2">, </span><span class="s1">i) == d</span>
            <span class="s2">assert </span><span class="s1">labels(i</span><span class="s2">, None</span><span class="s1">) == d</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;ydata&quot;</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">, </span><span class="s1">ids=ids)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s2">def </span><span class="s1">test_StrCategoryFormatterPlot(self</span><span class="s2">, </span><span class="s1">ydata</span><span class="s2">, </span><span class="s1">plotter):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">range(len(ydata))</span><span class="s2">, </span><span class="s1">ydata)</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">d </span><span class="s2">in </span><span class="s1">enumerate(ydata):</span>
            <span class="s2">assert </span><span class="s1">ax.yaxis.major.formatter(i) == d</span>
        <span class="s2">assert </span><span class="s1">ax.yaxis.major.formatter(i+</span><span class="s4">1</span><span class="s1">) == </span><span class="s3">&quot;&quot;</span>


<span class="s2">def </span><span class="s1">axis_test(axis</span><span class="s2">, </span><span class="s1">labels):</span>
    <span class="s1">ticks = list(range(len(labels)))</span>
    <span class="s1">np.testing.assert_array_equal(axis.get_majorticklocs()</span><span class="s2">, </span><span class="s1">ticks)</span>
    <span class="s1">graph_labels = [axis.major.formatter(i</span><span class="s2">, </span><span class="s1">i) </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">ticks]</span>
    <span class="s5"># _text also decodes bytes as utf-8.</span>
    <span class="s2">assert </span><span class="s1">graph_labels == [cat.StrCategoryFormatter._text(l) </span><span class="s2">for </span><span class="s1">l </span><span class="s2">in </span><span class="s1">labels]</span>
    <span class="s2">assert </span><span class="s1">list(axis.units._mapping.keys()) == [l </span><span class="s2">for </span><span class="s1">l </span><span class="s2">in </span><span class="s1">labels]</span>
    <span class="s2">assert </span><span class="s1">list(axis.units._mapping.values()) == ticks</span>


<span class="s2">class </span><span class="s1">TestPlotBytes:</span>
    <span class="s1">bytes_cases = [(</span><span class="s3">'string list'</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'c'</span><span class="s1">])</span><span class="s2">,</span>
                   <span class="s1">(</span><span class="s3">'bytes list'</span><span class="s2">, </span><span class="s1">[</span><span class="s6">b'a'</span><span class="s2">, </span><span class="s6">b'b'</span><span class="s2">, </span><span class="s6">b'c'</span><span class="s1">])</span><span class="s2">,</span>
                   <span class="s1">(</span><span class="s3">'bytes ndarray'</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s6">b'a'</span><span class="s2">, </span><span class="s6">b'b'</span><span class="s2">, </span><span class="s6">b'c'</span><span class="s1">]))]</span>

    <span class="s1">bytes_ids</span><span class="s2">, </span><span class="s1">bytes_data = zip(*bytes_cases)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;bdata&quot;</span><span class="s2">, </span><span class="s1">bytes_data</span><span class="s2">, </span><span class="s1">ids=bytes_ids)</span>
    <span class="s2">def </span><span class="s1">test_plot_bytes(self</span><span class="s2">, </span><span class="s1">plotter</span><span class="s2">, </span><span class="s1">bdata):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">counts = np.array([</span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">bdata</span><span class="s2">, </span><span class="s1">counts)</span>
        <span class="s1">axis_test(ax.xaxis</span><span class="s2">, </span><span class="s1">bdata)</span>


<span class="s2">class </span><span class="s1">TestPlotNumlike:</span>
    <span class="s1">numlike_cases = [(</span><span class="s3">'string list'</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'1'</span><span class="s2">, </span><span class="s3">'11'</span><span class="s2">, </span><span class="s3">'3'</span><span class="s1">])</span><span class="s2">,</span>
                     <span class="s1">(</span><span class="s3">'string ndarray'</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s3">'1'</span><span class="s2">, </span><span class="s3">'11'</span><span class="s2">, </span><span class="s3">'3'</span><span class="s1">]))</span><span class="s2">,</span>
                     <span class="s1">(</span><span class="s3">'bytes list'</span><span class="s2">, </span><span class="s1">[</span><span class="s6">b'1'</span><span class="s2">, </span><span class="s6">b'11'</span><span class="s2">, </span><span class="s6">b'3'</span><span class="s1">])</span><span class="s2">,</span>
                     <span class="s1">(</span><span class="s3">'bytes ndarray'</span><span class="s2">, </span><span class="s1">np.array([</span><span class="s6">b'1'</span><span class="s2">, </span><span class="s6">b'11'</span><span class="s2">, </span><span class="s6">b'3'</span><span class="s1">]))]</span>
    <span class="s1">numlike_ids</span><span class="s2">, </span><span class="s1">numlike_data = zip(*numlike_cases)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;ndata&quot;</span><span class="s2">, </span><span class="s1">numlike_data</span><span class="s2">, </span><span class="s1">ids=numlike_ids)</span>
    <span class="s2">def </span><span class="s1">test_plot_numlike(self</span><span class="s2">, </span><span class="s1">plotter</span><span class="s2">, </span><span class="s1">ndata):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">counts = np.array([</span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s1">])</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">ndata</span><span class="s2">, </span><span class="s1">counts)</span>
        <span class="s1">axis_test(ax.xaxis</span><span class="s2">, </span><span class="s1">ndata)</span>


<span class="s2">class </span><span class="s1">TestPlotTypes:</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s2">def </span><span class="s1">test_plot_unicode(self</span><span class="s2">, </span><span class="s1">plotter):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">words = [</span><span class="s3">'Здравствуйте'</span><span class="s2">, </span><span class="s3">'привет'</span><span class="s1">]</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">words</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span>
        <span class="s1">axis_test(ax.xaxis</span><span class="s2">, </span><span class="s1">words)</span>

    <span class="s1">@pytest.fixture</span>
    <span class="s2">def </span><span class="s1">test_data(self):</span>
        <span class="s1">self.x = [</span><span class="s3">&quot;hello&quot;</span><span class="s2">, </span><span class="s3">&quot;happy&quot;</span><span class="s2">, </span><span class="s3">&quot;world&quot;</span><span class="s1">]</span>
        <span class="s1">self.xy = [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span>
        <span class="s1">self.y = [</span><span class="s3">&quot;Python&quot;</span><span class="s2">, </span><span class="s3">&quot;is&quot;</span><span class="s2">, </span><span class="s3">&quot;fun&quot;</span><span class="s1">]</span>
        <span class="s1">self.yx = [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s1">]</span>

    <span class="s1">@pytest.mark.usefixtures(</span><span class="s3">&quot;test_data&quot;</span><span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s2">def </span><span class="s1">test_plot_xaxis(self</span><span class="s2">, </span><span class="s1">test_data</span><span class="s2">, </span><span class="s1">plotter):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">self.x</span><span class="s2">, </span><span class="s1">self.xy)</span>
        <span class="s1">axis_test(ax.xaxis</span><span class="s2">, </span><span class="s1">self.x)</span>

    <span class="s1">@pytest.mark.usefixtures(</span><span class="s3">&quot;test_data&quot;</span><span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s2">def </span><span class="s1">test_plot_yaxis(self</span><span class="s2">, </span><span class="s1">test_data</span><span class="s2">, </span><span class="s1">plotter):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">self.yx</span><span class="s2">, </span><span class="s1">self.y)</span>
        <span class="s1">axis_test(ax.yaxis</span><span class="s2">, </span><span class="s1">self.y)</span>

    <span class="s1">@pytest.mark.usefixtures(</span><span class="s3">&quot;test_data&quot;</span><span class="s1">)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s2">def </span><span class="s1">test_plot_xyaxis(self</span><span class="s2">, </span><span class="s1">test_data</span><span class="s2">, </span><span class="s1">plotter):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">self.x</span><span class="s2">, </span><span class="s1">self.y)</span>
        <span class="s1">axis_test(ax.xaxis</span><span class="s2">, </span><span class="s1">self.x)</span>
        <span class="s1">axis_test(ax.yaxis</span><span class="s2">, </span><span class="s1">self.y)</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">PLOT_LIST</span><span class="s2">, </span><span class="s1">ids=PLOT_IDS)</span>
    <span class="s2">def </span><span class="s1">test_update_plot(self</span><span class="s2">, </span><span class="s1">plotter):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'e'</span><span class="s2">, </span><span class="s3">'g'</span><span class="s1">])</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'f'</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s1">])</span>
        <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'c'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'e'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s1">])</span>
        <span class="s1">axis_test(ax.xaxis</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s2">, </span><span class="s3">'c'</span><span class="s1">])</span>
        <span class="s1">axis_test(ax.yaxis</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'e'</span><span class="s2">, </span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'f'</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'d'</span><span class="s1">])</span>

    <span class="s1">failing_test_cases = [(</span><span class="s3">&quot;mixed&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'A'</span><span class="s2">, </span><span class="s4">3.14</span><span class="s1">])</span><span class="s2">,</span>
                          <span class="s1">(</span><span class="s3">&quot;number integer&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'1'</span><span class="s2">, </span><span class="s4">1</span><span class="s1">])</span><span class="s2">,</span>
                          <span class="s1">(</span><span class="s3">&quot;string integer&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'42'</span><span class="s2">, </span><span class="s4">42</span><span class="s1">])</span><span class="s2">,</span>
                          <span class="s1">(</span><span class="s3">&quot;missing&quot;</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'12'</span><span class="s2">, </span><span class="s1">np.nan])]</span>

    <span class="s1">fids</span><span class="s2">, </span><span class="s1">fvalues = zip(*failing_test_cases)</span>

    <span class="s1">plotters = [Axes.scatter</span><span class="s2">, </span><span class="s1">Axes.bar</span><span class="s2">,</span>
                <span class="s1">pytest.param(Axes.plot</span><span class="s2">, </span><span class="s1">marks=pytest.mark.xfail)]</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">plotters)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;xdata&quot;</span><span class="s2">, </span><span class="s1">fvalues</span><span class="s2">, </span><span class="s1">ids=fids)</span>
    <span class="s2">def </span><span class="s1">test_mixed_type_exception(self</span><span class="s2">, </span><span class="s1">plotter</span><span class="s2">, </span><span class="s1">xdata):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;plotter&quot;</span><span class="s2">, </span><span class="s1">plotters)</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;xdata&quot;</span><span class="s2">, </span><span class="s1">fvalues</span><span class="s2">, </span><span class="s1">ids=fids)</span>
    <span class="s2">def </span><span class="s1">test_mixed_type_update_exception(self</span><span class="s2">, </span><span class="s1">plotter</span><span class="s2">, </span><span class="s1">xdata):</span>
        <span class="s1">ax = plt.figure().subplots()</span>
        <span class="s2">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s1">]</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s1">])</span>
            <span class="s1">plotter(ax</span><span class="s2">, </span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s1">])</span>


<span class="s1">@mpl.style.context(</span><span class="s3">'default'</span><span class="s1">)</span>
<span class="s1">@check_figures_equal(extensions=[</span><span class="s3">&quot;png&quot;</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_overriding_units_in_plot(fig_test</span><span class="s2">, </span><span class="s1">fig_ref):</span>
    <span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">datetime</span>

    <span class="s1">t0 = datetime(</span><span class="s4">2018</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">t1 = datetime(</span><span class="s4">2018</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">t2 = datetime(</span><span class="s4">2018</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s1">)</span>
    <span class="s1">t3 = datetime(</span><span class="s4">2018</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s1">)</span>

    <span class="s1">ax_test = fig_test.subplots()</span>
    <span class="s1">ax_ref = fig_ref.subplots()</span>
    <span class="s2">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">kwargs </span><span class="s2">in </span><span class="s1">zip([ax_test</span><span class="s2">, </span><span class="s1">ax_ref]</span><span class="s2">,</span>
                          <span class="s1">({}</span><span class="s2">, </span><span class="s1">dict(xunits=</span><span class="s2">None, </span><span class="s1">yunits=</span><span class="s2">None</span><span class="s1">))):</span>
        <span class="s5"># First call works</span>
        <span class="s1">ax.plot([t0</span><span class="s2">, </span><span class="s1">t1]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;V1&quot;</span><span class="s2">, </span><span class="s3">&quot;V2&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">**kwargs)</span>
        <span class="s1">x_units = ax.xaxis.units</span>
        <span class="s1">y_units = ax.yaxis.units</span>
        <span class="s5"># this should not raise</span>
        <span class="s1">ax.plot([t2</span><span class="s2">, </span><span class="s1">t3]</span><span class="s2">, </span><span class="s1">[</span><span class="s3">&quot;V1&quot;</span><span class="s2">, </span><span class="s3">&quot;V2&quot;</span><span class="s1">]</span><span class="s2">, </span><span class="s1">**kwargs)</span>
        <span class="s5"># assert that we have not re-set the units attribute at all</span>
        <span class="s2">assert </span><span class="s1">x_units </span><span class="s2">is </span><span class="s1">ax.xaxis.units</span>
        <span class="s2">assert </span><span class="s1">y_units </span><span class="s2">is </span><span class="s1">ax.yaxis.units</span>


<span class="s2">def </span><span class="s1">test_no_deprecation_on_empty_data():</span>
    <span class="s0">&quot;&quot;&quot; 
    Smoke test to check that no deprecation warning is emitted. See #22640. 
    &quot;&quot;&quot;</span>
    <span class="s1">f</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.xaxis.update_units([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s1">])</span>
    <span class="s1">ax.plot([]</span><span class="s2">, </span><span class="s1">[])</span>


<span class="s2">def </span><span class="s1">test_hist():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">n</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">patches = ax.hist([</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'c'</span><span class="s2">, </span><span class="s3">'ff'</span><span class="s1">])</span>
    <span class="s2">assert </span><span class="s1">n.shape == (</span><span class="s4">10</span><span class="s2">,</span><span class="s1">)</span>
    <span class="s1">np.testing.assert_allclose(n</span><span class="s2">, </span><span class="s1">[</span><span class="s4">2.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s1">])</span>
</pre>
</body>
</html>