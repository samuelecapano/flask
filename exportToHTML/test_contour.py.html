<html>
<head>
<title>test_contour.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #6a8759;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_contour.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">platform</span>
<span class="s0">import </span><span class="s1">re</span>

<span class="s0">import </span><span class="s1">contourpy</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy.testing </span><span class="s0">import </span><span class="s1">(</span>
    <span class="s1">assert_array_almost_equal</span><span class="s0">, </span><span class="s1">assert_array_almost_equal_nulp)</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span><span class="s0">, </span><span class="s1">rc_context</span><span class="s0">, </span><span class="s1">ticker</span>
<span class="s0">from </span><span class="s1">matplotlib.colors </span><span class="s0">import </span><span class="s1">LogNorm</span><span class="s0">, </span><span class="s1">same_color</span>
<span class="s0">import </span><span class="s1">pytest</span>


<span class="s0">def </span><span class="s1">test_contour_shape_1d_valid():</span>

    <span class="s1">x = np.arange(</span><span class="s2">10</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s2">9</span><span class="s1">)</span>
    <span class="s1">z = np.random.random((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>


<span class="s0">def </span><span class="s1">test_contour_shape_2d_valid():</span>

    <span class="s1">x = np.arange(</span><span class="s2">10</span><span class="s1">)</span>
    <span class="s1">y = np.arange(</span><span class="s2">9</span><span class="s1">)</span>
    <span class="s1">xg</span><span class="s0">, </span><span class="s1">yg = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">z = np.random.random((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.contour(xg</span><span class="s0">, </span><span class="s1">yg</span><span class="s0">, </span><span class="s1">z)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;args, message&quot;</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">((np.arange(</span><span class="s2">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)))</span><span class="s0">,</span>
     <span class="s3">'Length of x (9) must match number of columns in z (10)'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((np.arange(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)))</span><span class="s0">,</span>
     <span class="s3">'Length of y (10) must match number of rows in z (9)'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((np.empty((</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)))</span><span class="s0">,</span>
     <span class="s3">'Number of dimensions of x (2) and y (1) do not match'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((np.arange(</span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)))</span><span class="s0">,</span>
     <span class="s3">'Number of dimensions of x (1) and y (2) do not match'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">9</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)))</span><span class="s0">,</span>
     <span class="s3">'Shapes of x (9, 9) and z (9, 10) do not match'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">9</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)))</span><span class="s0">,</span>
     <span class="s3">'Shapes of y (9, 9) and z (9, 10) do not match'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((np.empty((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)))</span><span class="s0">,</span>
     <span class="s3">'Inputs x and y must be 1D or 2D, not 3D'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">((np.empty((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">))</span><span class="s0">, </span><span class="s1">np.empty((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)))</span><span class="s0">,</span>
     <span class="s3">'Input z must be 2D, not 3D'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(([[</span><span class="s2">0</span><span class="s1">]]</span><span class="s0">,</span><span class="s1">)</span><span class="s0">,  </span><span class="s4"># github issue 8197</span>
     <span class="s3">'Input z must be at least a (2, 2) shaped array, but has shape (1, 1)'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(([</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">0</span><span class="s1">]])</span><span class="s0">,</span>
     <span class="s3">'Input z must be at least a (2, 2) shaped array, but has shape (1, 1)'</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contour_shape_error(args</span><span class="s0">, </span><span class="s1">message):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=re.escape(message)):</span>
        <span class="s1">ax.contour(*args)</span>


<span class="s0">def </span><span class="s1">test_contour_no_valid_levels():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s4"># no warning for empty levels.</span>
    <span class="s1">ax.contour(np.random.rand(</span><span class="s2">9</span><span class="s0">, </span><span class="s2">9</span><span class="s1">)</span><span class="s0">, </span><span class="s1">levels=[])</span>
    <span class="s4"># no warning if levels is given and is not within the range of z.</span>
    <span class="s1">cs = ax.contour(np.arange(</span><span class="s2">81</span><span class="s1">).reshape((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">9</span><span class="s1">))</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s2">100</span><span class="s1">])</span>
    <span class="s4"># ... and if fmt is given.</span>
    <span class="s1">ax.clabel(cs</span><span class="s0">, </span><span class="s1">fmt={</span><span class="s2">100</span><span class="s1">: </span><span class="s3">'%1.2f'</span><span class="s1">})</span>
    <span class="s4"># no warning if z is uniform.</span>
    <span class="s1">ax.contour(np.ones((</span><span class="s2">9</span><span class="s0">, </span><span class="s2">9</span><span class="s1">)))</span>


<span class="s0">def </span><span class="s1">test_contour_Nlevels():</span>
    <span class="s4"># A scalar levels arg or kwarg should trigger auto level generation.</span>
    <span class="s4"># https://github.com/matplotlib/matplotlib/issues/11913</span>
    <span class="s1">z = np.arange(</span><span class="s2">12</span><span class="s1">).reshape((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">cs1 = ax.contour(z</span><span class="s0">, </span><span class="s2">5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(cs1.levels) &gt; </span><span class="s2">1</span>
    <span class="s1">cs2 = ax.contour(z</span><span class="s0">, </span><span class="s1">levels=</span><span class="s2">5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">(cs1.levels == cs2.levels).all()</span>


<span class="s1">@image_comparison([</span><span class="s3">'contour_manual_labels'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_manual_labels():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(np.arange(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>
    <span class="s1">z = np.max(np.dstack([abs(x)</span><span class="s0">, </span><span class="s1">abs(y)])</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>

    <span class="s1">plt.figure(figsize=(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dpi=</span><span class="s2">200</span><span class="s1">)</span>
    <span class="s1">cs = plt.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">pts = np.array([(</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">3.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">4.4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">6.0</span><span class="s1">)])</span>
    <span class="s1">plt.clabel(cs</span><span class="s0">, </span><span class="s1">manual=pts)</span>
    <span class="s1">pts = np.array([(</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">3.0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">4.4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">6.0</span><span class="s1">)])</span>
    <span class="s1">plt.clabel(cs</span><span class="s0">, </span><span class="s1">manual=pts</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s3">'small'</span><span class="s0">, </span><span class="s1">colors=(</span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'g'</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s3">'contour_manual_colors_and_levels.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_given_colors_levels_and_extends():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">_</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>

    <span class="s1">data = np.arange(</span><span class="s2">12</span><span class="s1">).reshape(</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span>

    <span class="s1">colors = [</span><span class="s3">'red'</span><span class="s0">, </span><span class="s3">'yellow'</span><span class="s0">, </span><span class="s3">'pink'</span><span class="s0">, </span><span class="s3">'blue'</span><span class="s0">, </span><span class="s3">'black'</span><span class="s1">]</span>
    <span class="s1">levels = [</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">8</span><span class="s0">, </span><span class="s2">10</span><span class="s1">]</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">filled = i % </span><span class="s2">2 </span><span class="s1">== </span><span class="s2">0.</span>
        <span class="s1">extend = [</span><span class="s3">'neither'</span><span class="s0">, </span><span class="s3">'min'</span><span class="s0">, </span><span class="s3">'max'</span><span class="s0">, </span><span class="s3">'both'</span><span class="s1">][i // </span><span class="s2">2</span><span class="s1">]</span>

        <span class="s0">if </span><span class="s1">filled:</span>
            <span class="s4"># If filled, we have 3 colors with no extension,</span>
            <span class="s4"># 4 colors with one extension, and 5 colors with both extensions</span>
            <span class="s1">first_color = </span><span class="s2">1 </span><span class="s0">if </span><span class="s1">extend </span><span class="s0">in </span><span class="s1">[</span><span class="s3">'max'</span><span class="s0">, </span><span class="s3">'neither'</span><span class="s1">] </span><span class="s0">else None</span>
            <span class="s1">last_color = -</span><span class="s2">1 </span><span class="s0">if </span><span class="s1">extend </span><span class="s0">in </span><span class="s1">[</span><span class="s3">'min'</span><span class="s0">, </span><span class="s3">'neither'</span><span class="s1">] </span><span class="s0">else None</span>
            <span class="s1">c = ax.contourf(data</span><span class="s0">, </span><span class="s1">colors=colors[first_color:last_color]</span><span class="s0">,</span>
                            <span class="s1">levels=levels</span><span class="s0">, </span><span class="s1">extend=extend)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s4"># If not filled, we have 4 levels and 4 colors</span>
            <span class="s1">c = ax.contour(data</span><span class="s0">, </span><span class="s1">colors=colors[:-</span><span class="s2">1</span><span class="s1">]</span><span class="s0">,</span>
                           <span class="s1">levels=levels</span><span class="s0">, </span><span class="s1">extend=extend)</span>

        <span class="s1">plt.colorbar(c</span><span class="s0">, </span><span class="s1">ax=ax)</span>


<span class="s1">@image_comparison([</span><span class="s3">'contour_log_locator.svg'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">False</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_log_locator_levels():</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">N = </span><span class="s2">100</span>
    <span class="s1">x = np.linspace(-</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">3.0</span><span class="s0">, </span><span class="s1">N)</span>
    <span class="s1">y = np.linspace(-</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s1">N)</span>

    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>

    <span class="s1">Z1 = np.exp(-X**</span><span class="s2">2 </span><span class="s1">- Y**</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">Z2 = np.exp(-(X * </span><span class="s2">10</span><span class="s1">)**</span><span class="s2">2 </span><span class="s1">- (Y * </span><span class="s2">10</span><span class="s1">)**</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">data = Z1 + </span><span class="s2">50 </span><span class="s1">* Z2</span>

    <span class="s1">c = ax.contourf(data</span><span class="s0">, </span><span class="s1">locator=ticker.LogLocator())</span>
    <span class="s1">assert_array_almost_equal(c.levels</span><span class="s0">, </span><span class="s1">np.power(</span><span class="s2">10.0</span><span class="s0">, </span><span class="s1">np.arange(-</span><span class="s2">6</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)))</span>
    <span class="s1">cb = fig.colorbar(c</span><span class="s0">, </span><span class="s1">ax=ax)</span>
    <span class="s1">assert_array_almost_equal(cb.ax.get_yticks()</span><span class="s0">, </span><span class="s1">c.levels)</span>


<span class="s1">@image_comparison([</span><span class="s3">'contour_datetime_axis.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_datetime_axis():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.subplots_adjust(hspace=</span><span class="s2">0.4</span><span class="s0">, </span><span class="s1">top=</span><span class="s2">0.98</span><span class="s0">, </span><span class="s1">bottom=</span><span class="s2">.15</span><span class="s1">)</span>
    <span class="s1">base = datetime.datetime(</span><span class="s2">2013</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">x = np.array([base + datetime.timedelta(days=d) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">range(</span><span class="s2">20</span><span class="s1">)])</span>
    <span class="s1">y = np.arange(</span><span class="s2">20</span><span class="s1">)</span>
    <span class="s1">z1</span><span class="s0">, </span><span class="s1">z2 = np.meshgrid(np.arange(</span><span class="s2">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">20</span><span class="s1">))</span>
    <span class="s1">z = z1 * z2</span>
    <span class="s1">plt.subplot(</span><span class="s2">221</span><span class="s1">)</span>
    <span class="s1">plt.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">plt.subplot(</span><span class="s2">222</span><span class="s1">)</span>
    <span class="s1">plt.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">x = np.repeat(x[np.newaxis]</span><span class="s0">, </span><span class="s2">20</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">0</span><span class="s1">)</span>
    <span class="s1">y = np.repeat(y[:</span><span class="s0">, </span><span class="s1">np.newaxis]</span><span class="s0">, </span><span class="s2">20</span><span class="s0">, </span><span class="s1">axis=</span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">plt.subplot(</span><span class="s2">223</span><span class="s1">)</span>
    <span class="s1">plt.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">plt.subplot(</span><span class="s2">224</span><span class="s1">)</span>
    <span class="s1">plt.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig.get_axes():</span>
        <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">ax.get_xticklabels():</span>
            <span class="s1">label.set_ha(</span><span class="s3">'right'</span><span class="s1">)</span>
            <span class="s1">label.set_rotation(</span><span class="s2">30</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'contour_test_label_transforms.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s2">0 </span><span class="s0">if </span><span class="s1">platform.machine() == </span><span class="s3">'x86_64' </span><span class="s0">else </span><span class="s2">0.08</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_labels():</span>
    <span class="s4"># Adapted from pylab_examples example code: contour_demo.py</span>
    <span class="s4"># see issues #2475, #2843, and #2818 for explanation</span>
    <span class="s1">delta = </span><span class="s2">0.025</span>
    <span class="s1">x = np.arange(-</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">3.0</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s1">y = np.arange(-</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z1 = np.exp(-(X**</span><span class="s2">2 </span><span class="s1">+ Y**</span><span class="s2">2</span><span class="s1">) / </span><span class="s2">2</span><span class="s1">) / (</span><span class="s2">2 </span><span class="s1">* np.pi)</span>
    <span class="s1">Z2 = (np.exp(-(((X - </span><span class="s2">1</span><span class="s1">) / </span><span class="s2">1.5</span><span class="s1">)**</span><span class="s2">2 </span><span class="s1">+ ((Y - </span><span class="s2">1</span><span class="s1">) / </span><span class="s2">0.5</span><span class="s1">)**</span><span class="s2">2</span><span class="s1">) / </span><span class="s2">2</span><span class="s1">) /</span>
          <span class="s1">(</span><span class="s2">2 </span><span class="s1">* np.pi * </span><span class="s2">0.5 </span><span class="s1">* </span><span class="s2">1.5</span><span class="s1">))</span>

    <span class="s4"># difference of Gaussians</span>
    <span class="s1">Z = </span><span class="s2">10.0 </span><span class="s1">* (Z2 - Z1)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">CS = ax.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z)</span>
    <span class="s1">disp_units = [(</span><span class="s2">216</span><span class="s0">, </span><span class="s2">177</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">359</span><span class="s0">, </span><span class="s2">290</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">521</span><span class="s0">, </span><span class="s2">406</span><span class="s1">)]</span>
    <span class="s1">data_units = [(-</span><span class="s2">2</span><span class="s0">, </span><span class="s2">.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">0</span><span class="s0">, </span><span class="s1">-</span><span class="s2">1.5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">2.8</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)]</span>

    <span class="s1">CS.clabel()</span>

    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">data_units:</span>
        <span class="s1">CS.add_label_near(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True, </span><span class="s1">transform=</span><span class="s0">None</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">disp_units:</span>
        <span class="s1">CS.add_label_near(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True, </span><span class="s1">transform=</span><span class="s0">False</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s3">'contour_corner_mask_False.png'</span><span class="s0">,</span>
                   <span class="s3">'contour_corner_mask_True.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_corner_mask():</span>
    <span class="s1">n = </span><span class="s2">60</span>
    <span class="s1">mask_level = </span><span class="s2">0.95</span>
    <span class="s1">noise_amp = </span><span class="s2">1.0</span>
    <span class="s1">np.random.seed([</span><span class="s2">1</span><span class="s1">])</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(np.linspace(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s1">n)</span><span class="s0">, </span><span class="s1">np.linspace(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s1">n))</span>
    <span class="s1">z = np.cos(</span><span class="s2">7</span><span class="s1">*x)*np.sin(</span><span class="s2">8</span><span class="s1">*y) + noise_amp*np.random.rand(n</span><span class="s0">, </span><span class="s1">n)</span>
    <span class="s1">mask = np.random.rand(n</span><span class="s0">, </span><span class="s1">n) &gt;= mask_level</span>
    <span class="s1">z = np.ma.array(z</span><span class="s0">, </span><span class="s1">mask=mask)</span>

    <span class="s0">for </span><span class="s1">corner_mask </span><span class="s0">in </span><span class="s1">[</span><span class="s0">False, True</span><span class="s1">]:</span>
        <span class="s1">plt.figure()</span>
        <span class="s1">plt.contourf(z</span><span class="s0">, </span><span class="s1">corner_mask=corner_mask)</span>


<span class="s0">def </span><span class="s1">test_contourf_decreasing_levels():</span>
    <span class="s4"># github issue 5477.</span>
    <span class="s1">z = [[</span><span class="s2">0.1</span><span class="s0">, </span><span class="s2">0.3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s0">, </span><span class="s2">0.7</span><span class="s1">]]</span>
    <span class="s1">plt.figure()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.contourf(z</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">0.0</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_contourf_symmetric_locator():</span>
    <span class="s4"># github issue 7271</span>
    <span class="s1">z = np.arange(</span><span class="s2">12</span><span class="s1">).reshape((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
    <span class="s1">locator = plt.MaxNLocator(nbins=</span><span class="s2">4</span><span class="s0">, </span><span class="s1">symmetric=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">cs = plt.contourf(z</span><span class="s0">, </span><span class="s1">locator=locator)</span>
    <span class="s1">assert_array_almost_equal(cs.levels</span><span class="s0">, </span><span class="s1">np.linspace(-</span><span class="s2">12</span><span class="s0">, </span><span class="s2">12</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_circular_contour_warning():</span>
    <span class="s4"># Check that almost circular contours don't throw a warning</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(np.linspace(-</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.linspace(-</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
    <span class="s1">r = np.hypot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">cs = plt.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">r)</span>
    <span class="s1">plt.clabel(cs)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s3">&quot;use_clabeltext, contour_zorder, clabel_zorder&quot;</span><span class="s0">,</span>
                         <span class="s1">[(</span><span class="s0">True, </span><span class="s2">123</span><span class="s0">, </span><span class="s2">1234</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">False, </span><span class="s2">123</span><span class="s0">, </span><span class="s2">1234</span><span class="s1">)</span><span class="s0">,</span>
                          <span class="s1">(</span><span class="s0">True, </span><span class="s2">123</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s0">False, </span><span class="s2">123</span><span class="s0">, None</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_clabel_zorder(use_clabeltext</span><span class="s0">, </span><span class="s1">contour_zorder</span><span class="s0">, </span><span class="s1">clabel_zorder):</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(np.arange(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s2">0</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>
    <span class="s1">z = np.max(np.dstack([abs(x)</span><span class="s0">, </span><span class="s1">abs(y)])</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(ncols=</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">cs = ax1.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zorder=contour_zorder)</span>
    <span class="s1">cs_filled = ax2.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">zorder=contour_zorder)</span>
    <span class="s1">clabels1 = cs.clabel(zorder=clabel_zorder</span><span class="s0">, </span><span class="s1">use_clabeltext=use_clabeltext)</span>
    <span class="s1">clabels2 = cs_filled.clabel(zorder=clabel_zorder</span><span class="s0">,</span>
                                <span class="s1">use_clabeltext=use_clabeltext)</span>

    <span class="s0">if </span><span class="s1">clabel_zorder </span><span class="s0">is None</span><span class="s1">:</span>
        <span class="s1">expected_clabel_zorder = </span><span class="s2">2</span><span class="s1">+contour_zorder</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s1">expected_clabel_zorder = clabel_zorder</span>

    <span class="s0">for </span><span class="s1">clabel </span><span class="s0">in </span><span class="s1">clabels1:</span>
        <span class="s0">assert </span><span class="s1">clabel.get_zorder() == expected_clabel_zorder</span>
    <span class="s0">for </span><span class="s1">clabel </span><span class="s0">in </span><span class="s1">clabels2:</span>
        <span class="s0">assert </span><span class="s1">clabel.get_zorder() == expected_clabel_zorder</span>


<span class="s4"># tol because ticks happen to fall on pixel boundaries so small</span>
<span class="s4"># floating point changes in tick location flip which pixel gets</span>
<span class="s4"># the tick.</span>
<span class="s1">@image_comparison([</span><span class="s3">'contour_log_extension.png'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s2">1.444</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contourf_log_extension():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s4"># Test that contourf with lognorm is extended correctly</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2</span><span class="s0">, </span><span class="s1">ax3) = plt.subplots(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>
    <span class="s1">fig.subplots_adjust(left=</span><span class="s2">0.05</span><span class="s0">, </span><span class="s1">right=</span><span class="s2">0.95</span><span class="s1">)</span>

    <span class="s4"># make data set with large range e.g. between 1e-8 and 1e10</span>
    <span class="s1">data_exp = np.linspace(-</span><span class="s2">7.5</span><span class="s0">, </span><span class="s2">9.5</span><span class="s0">, </span><span class="s2">1200</span><span class="s1">)</span>
    <span class="s1">data = np.power(</span><span class="s2">10</span><span class="s0">, </span><span class="s1">data_exp).reshape(</span><span class="s2">30</span><span class="s0">, </span><span class="s2">40</span><span class="s1">)</span>
    <span class="s4"># make manual levels e.g. between 1e-4 and 1e-6</span>
    <span class="s1">levels_exp = np.arange(-</span><span class="s2">4.</span><span class="s0">, </span><span class="s2">7.</span><span class="s1">)</span>
    <span class="s1">levels = np.power(</span><span class="s2">10.</span><span class="s0">, </span><span class="s1">levels_exp)</span>

    <span class="s4"># original data</span>
    <span class="s1">c1 = ax1.contourf(data</span><span class="s0">,</span>
                      <span class="s1">norm=LogNorm(vmin=data.min()</span><span class="s0">, </span><span class="s1">vmax=data.max()))</span>
    <span class="s4"># just show data in levels</span>
    <span class="s1">c2 = ax2.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels</span><span class="s0">,</span>
                      <span class="s1">norm=LogNorm(vmin=levels.min()</span><span class="s0">, </span><span class="s1">vmax=levels.max())</span><span class="s0">,</span>
                      <span class="s1">extend=</span><span class="s3">'neither'</span><span class="s1">)</span>
    <span class="s4"># extend data from levels</span>
    <span class="s1">c3 = ax3.contourf(data</span><span class="s0">, </span><span class="s1">levels=levels</span><span class="s0">,</span>
                      <span class="s1">norm=LogNorm(vmin=levels.min()</span><span class="s0">, </span><span class="s1">vmax=levels.max())</span><span class="s0">,</span>
                      <span class="s1">extend=</span><span class="s3">'both'</span><span class="s1">)</span>
    <span class="s1">cb = plt.colorbar(c1</span><span class="s0">, </span><span class="s1">ax=ax1)</span>
    <span class="s0">assert </span><span class="s1">cb.ax.get_ylim() == (</span><span class="s2">1e-8</span><span class="s0">, </span><span class="s2">1e10</span><span class="s1">)</span>
    <span class="s1">cb = plt.colorbar(c2</span><span class="s0">, </span><span class="s1">ax=ax2)</span>
    <span class="s1">assert_array_almost_equal_nulp(cb.ax.get_ylim()</span><span class="s0">, </span><span class="s1">np.array((</span><span class="s2">1e-4</span><span class="s0">, </span><span class="s2">1e6</span><span class="s1">)))</span>
    <span class="s1">cb = plt.colorbar(c3</span><span class="s0">, </span><span class="s1">ax=ax3)</span>


<span class="s1">@image_comparison(</span>
    <span class="s1">[</span><span class="s3">'contour_addlines.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s0">,</span>
    <span class="s1">tol=</span><span class="s2">0.15 </span><span class="s0">if </span><span class="s1">platform.machine() </span><span class="s0">in </span><span class="s1">(</span><span class="s3">'aarch64'</span><span class="s0">, </span><span class="s3">'ppc64le'</span><span class="s0">, </span><span class="s3">'s390x'</span><span class="s1">)</span>
        <span class="s0">else </span><span class="s2">0.03</span><span class="s1">)</span>
<span class="s4"># tolerance is because image changed minutely when tick finding on</span>
<span class="s4"># colorbars was cleaned up...</span>
<span class="s0">def </span><span class="s1">test_contour_addlines():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">np.random.seed(</span><span class="s2">19680812</span><span class="s1">)</span>
    <span class="s1">X = np.random.rand(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)*</span><span class="s2">10000</span>
    <span class="s1">pcm = ax.pcolormesh(X)</span>
    <span class="s4"># add 1000 to make colors visible...</span>
    <span class="s1">cont = ax.contour(X+</span><span class="s2">1000</span><span class="s1">)</span>
    <span class="s1">cb = fig.colorbar(pcm)</span>
    <span class="s1">cb.add_lines(cont)</span>
    <span class="s1">assert_array_almost_equal(cb.ax.get_ylim()</span><span class="s0">, </span><span class="s1">[</span><span class="s2">114.3091</span><span class="s0">, </span><span class="s2">9972.30735</span><span class="s1">]</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>


<span class="s1">@image_comparison(baseline_images=[</span><span class="s3">'contour_uneven'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s3">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_uneven():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'pcolormesh.snap'</span><span class="s1">] = </span><span class="s0">False</span>

    <span class="s1">z = np.arange(</span><span class="s2">24</span><span class="s1">).reshape(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">ax = axs[</span><span class="s2">0</span><span class="s1">]</span>
    <span class="s1">cs = ax.contourf(z</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s1">])</span>
    <span class="s1">fig.colorbar(cs</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">spacing=</span><span class="s3">'proportional'</span><span class="s1">)</span>
    <span class="s1">ax = axs[</span><span class="s2">1</span><span class="s1">]</span>
    <span class="s1">cs = ax.contourf(z</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">4</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s2">20</span><span class="s1">])</span>
    <span class="s1">fig.colorbar(cs</span><span class="s0">, </span><span class="s1">ax=ax</span><span class="s0">, </span><span class="s1">spacing=</span><span class="s3">'uniform'</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;rc_lines_linewidth, rc_contour_linewidth, call_linewidths, expected&quot;</span><span class="s0">, </span><span class="s1">[</span>
        <span class="s1">(</span><span class="s2">1.23</span><span class="s0">, None, None, </span><span class="s2">1.23</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">1.23</span><span class="s0">, </span><span class="s2">4.24</span><span class="s0">, None, </span><span class="s2">4.24</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">(</span><span class="s2">1.23</span><span class="s0">, </span><span class="s2">4.24</span><span class="s0">, </span><span class="s2">5.02</span><span class="s0">, </span><span class="s2">5.02</span><span class="s1">)</span>
        <span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_contour_linewidth(</span>
        <span class="s1">rc_lines_linewidth</span><span class="s0">, </span><span class="s1">rc_contour_linewidth</span><span class="s0">, </span><span class="s1">call_linewidths</span><span class="s0">, </span><span class="s1">expected):</span>

    <span class="s0">with </span><span class="s1">rc_context(rc={</span><span class="s3">&quot;lines.linewidth&quot;</span><span class="s1">: rc_lines_linewidth</span><span class="s0">,</span>
                        <span class="s3">&quot;contour.linewidth&quot;</span><span class="s1">: rc_contour_linewidth}):</span>
        <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
        <span class="s1">X = np.arange(</span><span class="s2">4</span><span class="s1">*</span><span class="s2">3</span><span class="s1">).reshape(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)</span>
        <span class="s1">cs = ax.contour(X</span><span class="s0">, </span><span class="s1">linewidths=call_linewidths)</span>
        <span class="s0">assert </span><span class="s1">cs.tlinewidths[</span><span class="s2">0</span><span class="s1">][</span><span class="s2">0</span><span class="s1">] == expected</span>


<span class="s1">@pytest.mark.backend(</span><span class="s3">&quot;pdf&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_label_nonagg():</span>
    <span class="s4"># This should not crash even if the canvas doesn't have a get_renderer().</span>
    <span class="s1">plt.clabel(plt.contour([[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]))</span>


<span class="s1">@image_comparison(baseline_images=[</span><span class="s3">'contour_closed_line_loop'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_closed_line_loop():</span>
    <span class="s4"># github issue 19568.</span>
    <span class="s1">z = [[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">))</span>
    <span class="s1">ax.contour(z</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">linewidths=[</span><span class="s2">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s2">0.7</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(-</span><span class="s2">0.1</span><span class="s0">, </span><span class="s2">2.1</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(-</span><span class="s2">0.1</span><span class="s0">, </span><span class="s2">3.1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_quadcontourset_reuse():</span>
    <span class="s4"># If QuadContourSet returned from one contour(f) call is passed as first</span>
    <span class="s4"># argument to another the underlying C++ contour generator will be reused.</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid([</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s1">])</span>
    <span class="s1">z = x + y</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">qcs1 = ax.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s1">qcs2 = ax.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s0">assert </span><span class="s1">qcs2._contour_generator != qcs1._contour_generator</span>
    <span class="s1">qcs3 = ax.contour(qcs1</span><span class="s0">, </span><span class="s1">z)</span>
    <span class="s0">assert </span><span class="s1">qcs3._contour_generator == qcs1._contour_generator</span>


<span class="s1">@image_comparison(baseline_images=[</span><span class="s3">'contour_manual'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_manual():</span>
    <span class="s4"># Manually specifying contour lines/polygons to plot.</span>
    <span class="s0">from </span><span class="s1">matplotlib.contour </span><span class="s0">import </span><span class="s1">ContourSet</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">))</span>
    <span class="s1">cmap = </span><span class="s3">'viridis'</span>

    <span class="s4"># Segments only (no 'kind' codes).</span>
    <span class="s1">lines0 = [[[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]]]  </span><span class="s4"># Single line.</span>
    <span class="s1">lines1 = [[[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]]]  </span><span class="s4"># Two lines.</span>
    <span class="s1">filled01 = [[[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]]]</span>
    <span class="s1">filled12 = [[[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]]</span><span class="s0">,  </span><span class="s4"># Two polygons.</span>
                <span class="s1">[[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]]]</span>
    <span class="s1">ContourSet(ax</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[filled01</span><span class="s0">, </span><span class="s1">filled12]</span><span class="s0">, </span><span class="s1">filled=</span><span class="s0">True, </span><span class="s1">cmap=cmap)</span>
    <span class="s1">ContourSet(ax</span><span class="s0">, </span><span class="s1">[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[lines0</span><span class="s0">, </span><span class="s1">lines1]</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s2">3</span><span class="s0">, </span><span class="s1">colors=[</span><span class="s3">'r'</span><span class="s0">, </span><span class="s3">'k'</span><span class="s1">])</span>

    <span class="s4"># Segments and kind codes (1 = MOVETO, 2 = LINETO, 79 = CLOSEPOLY).</span>
    <span class="s1">segs = [[[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">7</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">4</span><span class="s0">, </span><span class="s2">0</span><span class="s1">]</span><span class="s0">,</span>
             <span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">6</span><span class="s0">, </span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">6</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]]]</span>
    <span class="s1">kinds = [[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">79</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">79</span><span class="s1">]]  </span><span class="s4"># Polygon containing hole.</span>
    <span class="s1">ContourSet(ax</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[segs]</span><span class="s0">, </span><span class="s1">[kinds]</span><span class="s0">, </span><span class="s1">filled=</span><span class="s0">True, </span><span class="s1">cmap=cmap)</span>
    <span class="s1">ContourSet(ax</span><span class="s0">, </span><span class="s1">[</span><span class="s2">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[segs]</span><span class="s0">, </span><span class="s1">[kinds]</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">linewidths=</span><span class="s2">3</span><span class="s1">)</span>


<span class="s1">@image_comparison(baseline_images=[</span><span class="s3">'contour_line_start_on_corner_edge'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_line_start_on_corner_edge():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(figsize=(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">5</span><span class="s1">))</span>

    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid([</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s0">, </span><span class="s2">3</span><span class="s0">, </span><span class="s2">4</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">0</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s2">2</span><span class="s1">])</span>
    <span class="s1">z = </span><span class="s2">1.2 </span><span class="s1">- (x - </span><span class="s2">2</span><span class="s1">)**</span><span class="s2">2 </span><span class="s1">+ (y - </span><span class="s2">1</span><span class="s1">)**</span><span class="s2">2</span>
    <span class="s1">mask = np.zeros_like(z</span><span class="s0">, </span><span class="s1">dtype=bool)</span>
    <span class="s1">mask[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">] = mask[</span><span class="s2">1</span><span class="s0">, </span><span class="s2">3</span><span class="s1">] = </span><span class="s0">True</span>
    <span class="s1">z = np.ma.array(z</span><span class="s0">, </span><span class="s1">mask=mask)</span>

    <span class="s1">filled = ax.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">corner_mask=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">cbar = fig.colorbar(filled)</span>
    <span class="s1">lines = ax.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">corner_mask=</span><span class="s0">True, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">cbar.add_lines(lines)</span>


<span class="s0">def </span><span class="s1">test_find_nearest_contour():</span>
    <span class="s1">xy = np.indices((</span><span class="s2">15</span><span class="s0">, </span><span class="s2">15</span><span class="s1">))</span>
    <span class="s1">img = np.exp(-np.pi * (np.sum((xy - </span><span class="s2">5</span><span class="s1">)**</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)/</span><span class="s2">5.</span><span class="s1">**</span><span class="s2">2</span><span class="s1">))</span>
    <span class="s1">cs = plt.contour(img</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span>

    <span class="s1">nearest_contour = cs.find_nearest_contour(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">pixel=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_nearest = (</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">33</span><span class="s0">, </span><span class="s2">1.965966</span><span class="s0">, </span><span class="s2">1.965966</span><span class="s0">, </span><span class="s2">1.866183</span><span class="s1">)</span>
    <span class="s1">assert_array_almost_equal(nearest_contour</span><span class="s0">, </span><span class="s1">expected_nearest)</span>

    <span class="s1">nearest_contour = cs.find_nearest_contour(</span><span class="s2">8</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">pixel=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_nearest = (</span><span class="s2">1</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s2">7.550173</span><span class="s0">, </span><span class="s2">1.587542</span><span class="s0">, </span><span class="s2">0.547550</span><span class="s1">)</span>
    <span class="s1">assert_array_almost_equal(nearest_contour</span><span class="s0">, </span><span class="s1">expected_nearest)</span>

    <span class="s1">nearest_contour = cs.find_nearest_contour(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s1">pixel=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_nearest = (</span><span class="s2">3</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">21</span><span class="s0">, </span><span class="s2">1.884384</span><span class="s0">, </span><span class="s2">5.023335</span><span class="s0">, </span><span class="s2">0.013911</span><span class="s1">)</span>
    <span class="s1">assert_array_almost_equal(nearest_contour</span><span class="s0">, </span><span class="s1">expected_nearest)</span>

    <span class="s1">nearest_contour = cs.find_nearest_contour(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">5</span><span class="s0">,</span>
                                              <span class="s1">indices=(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">,</span>
                                              <span class="s1">pixel=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">expected_nearest = (</span><span class="s2">5</span><span class="s0">, </span><span class="s2">0</span><span class="s0">, </span><span class="s2">16</span><span class="s0">, </span><span class="s2">2.628202</span><span class="s0">, </span><span class="s2">5.0</span><span class="s0">, </span><span class="s2">0.394638</span><span class="s1">)</span>
    <span class="s1">assert_array_almost_equal(nearest_contour</span><span class="s0">, </span><span class="s1">expected_nearest)</span>


<span class="s0">def </span><span class="s1">test_find_nearest_contour_no_filled():</span>
    <span class="s1">xy = np.indices((</span><span class="s2">15</span><span class="s0">, </span><span class="s2">15</span><span class="s1">))</span>
    <span class="s1">img = np.exp(-np.pi * (np.sum((xy - </span><span class="s2">5</span><span class="s1">)**</span><span class="s2">2</span><span class="s0">, </span><span class="s2">0</span><span class="s1">)/</span><span class="s2">5.</span><span class="s1">**</span><span class="s2">2</span><span class="s1">))</span>
    <span class="s1">cs = plt.contourf(img</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;Method does not support filled contours.&quot;</span><span class="s1">):</span>
        <span class="s1">cs.find_nearest_contour(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s0">, </span><span class="s1">pixel=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;Method does not support filled contours.&quot;</span><span class="s1">):</span>
        <span class="s1">cs.find_nearest_contour(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s0">, </span><span class="s1">indices=(</span><span class="s2">5</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pixel=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s3">&quot;Method does not support filled contours.&quot;</span><span class="s1">):</span>
        <span class="s1">cs.find_nearest_contour(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">5</span><span class="s0">, </span><span class="s1">indices=(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">7</span><span class="s1">)</span><span class="s0">, </span><span class="s1">pixel=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@mpl.style.context(</span><span class="s3">&quot;default&quot;</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_contour_autolabel_beyond_powerlimits():</span>
    <span class="s1">ax = plt.figure().add_subplot()</span>
    <span class="s1">cs = plt.contour(np.geomspace(</span><span class="s2">1e-6</span><span class="s0">, </span><span class="s2">1e-4</span><span class="s0">, </span><span class="s2">100</span><span class="s1">).reshape(</span><span class="s2">10</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">,</span>
                     <span class="s1">levels=[</span><span class="s2">.25e-5</span><span class="s0">, </span><span class="s2">1e-5</span><span class="s0">, </span><span class="s2">4e-5</span><span class="s1">])</span>
    <span class="s1">ax.clabel(cs)</span>
    <span class="s4"># Currently, the exponent is missing, but that may be fixed in the future.</span>
    <span class="s0">assert </span><span class="s1">{text.get_text() </span><span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax.texts} == {</span><span class="s3">&quot;0.25&quot;</span><span class="s0">, </span><span class="s3">&quot;1.00&quot;</span><span class="s0">, </span><span class="s3">&quot;4.00&quot;</span><span class="s1">}</span>


<span class="s0">def </span><span class="s1">test_contourf_legend_elements():</span>
    <span class="s0">from </span><span class="s1">matplotlib.patches </span><span class="s0">import </span><span class="s1">Rectangle</span>
    <span class="s1">x = np.arange(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span>
    <span class="s1">y = x.reshape(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">h = x * y</span>

    <span class="s1">cs = plt.contourf(h</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s2">10</span><span class="s0">, </span><span class="s2">30</span><span class="s0">, </span><span class="s2">50</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">colors=[</span><span class="s3">'#FFFF00'</span><span class="s0">, </span><span class="s3">'#FF00FF'</span><span class="s0">, </span><span class="s3">'#00FFFF'</span><span class="s1">]</span><span class="s0">,</span>
                      <span class="s1">extend=</span><span class="s3">'both'</span><span class="s1">)</span>
    <span class="s1">cs.cmap.set_over(</span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s1">cs.cmap.set_under(</span><span class="s3">'blue'</span><span class="s1">)</span>
    <span class="s1">cs.changed()</span>
    <span class="s1">artists</span><span class="s0">, </span><span class="s1">labels = cs.legend_elements()</span>
    <span class="s0">assert </span><span class="s1">labels == [</span><span class="s3">'$x </span><span class="s0">\\</span><span class="s3">leq -1e+250s$'</span><span class="s0">,</span>
                      <span class="s3">'$10.0 &lt; x </span><span class="s0">\\</span><span class="s3">leq 30.0$'</span><span class="s0">,</span>
                      <span class="s3">'$30.0 &lt; x </span><span class="s0">\\</span><span class="s3">leq 50.0$'</span><span class="s0">,</span>
                      <span class="s3">'$x &gt; 1e+250s$'</span><span class="s1">]</span>
    <span class="s1">expected_colors = (</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s3">'#FFFF00'</span><span class="s0">, </span><span class="s3">'#FF00FF'</span><span class="s0">, </span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">all(isinstance(a</span><span class="s0">, </span><span class="s1">Rectangle) </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">artists)</span>
    <span class="s0">assert </span><span class="s1">all(same_color(a.get_facecolor()</span><span class="s0">, </span><span class="s1">c)</span>
               <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">c </span><span class="s0">in </span><span class="s1">zip(artists</span><span class="s0">, </span><span class="s1">expected_colors))</span>


<span class="s0">def </span><span class="s1">test_contour_legend_elements():</span>
    <span class="s0">from </span><span class="s1">matplotlib.collections </span><span class="s0">import </span><span class="s1">LineCollection</span>
    <span class="s1">x = np.arange(</span><span class="s2">1</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span>
    <span class="s1">y = x.reshape(-</span><span class="s2">1</span><span class="s0">, </span><span class="s2">1</span><span class="s1">)</span>
    <span class="s1">h = x * y</span>

    <span class="s1">colors = [</span><span class="s3">'blue'</span><span class="s0">, </span><span class="s3">'#00FF00'</span><span class="s0">, </span><span class="s3">'red'</span><span class="s1">]</span>
    <span class="s1">cs = plt.contour(h</span><span class="s0">, </span><span class="s1">levels=[</span><span class="s2">10</span><span class="s0">, </span><span class="s2">30</span><span class="s0">, </span><span class="s2">50</span><span class="s1">]</span><span class="s0">,</span>
                     <span class="s1">colors=colors</span><span class="s0">,</span>
                     <span class="s1">extend=</span><span class="s3">'both'</span><span class="s1">)</span>
    <span class="s1">artists</span><span class="s0">, </span><span class="s1">labels = cs.legend_elements()</span>
    <span class="s0">assert </span><span class="s1">labels == [</span><span class="s3">'$x = 10.0$'</span><span class="s0">, </span><span class="s3">'$x = 30.0$'</span><span class="s0">, </span><span class="s3">'$x = 50.0$'</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">all(isinstance(a</span><span class="s0">, </span><span class="s1">LineCollection) </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">artists)</span>
    <span class="s0">assert </span><span class="s1">all(same_color(a.get_color()</span><span class="s0">, </span><span class="s1">c)</span>
               <span class="s0">for </span><span class="s1">a</span><span class="s0">, </span><span class="s1">c </span><span class="s0">in </span><span class="s1">zip(artists</span><span class="s0">, </span><span class="s1">colors))</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;algorithm, klass&quot;</span><span class="s0">,</span>
    <span class="s1">[(</span><span class="s3">'mpl2005'</span><span class="s0">, </span><span class="s1">contourpy.Mpl2005ContourGenerator)</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s3">'mpl2014'</span><span class="s0">, </span><span class="s1">contourpy.Mpl2014ContourGenerator)</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s3">'serial'</span><span class="s0">, </span><span class="s1">contourpy.SerialContourGenerator)</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s3">'threaded'</span><span class="s0">, </span><span class="s1">contourpy.ThreadedContourGenerator)</span><span class="s0">,</span>
     <span class="s1">(</span><span class="s3">'invalid'</span><span class="s0">, None</span><span class="s1">)])</span>
<span class="s0">def </span><span class="s1">test_algorithm_name(algorithm</span><span class="s0">, </span><span class="s1">klass):</span>
    <span class="s1">z = np.array([[</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">]])</span>
    <span class="s0">if </span><span class="s1">klass </span><span class="s0">is not None</span><span class="s1">:</span>
        <span class="s1">cs = plt.contourf(z</span><span class="s0">, </span><span class="s1">algorithm=algorithm)</span>
        <span class="s0">assert </span><span class="s1">isinstance(cs._contour_generator</span><span class="s0">, </span><span class="s1">klass)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">plt.contourf(z</span><span class="s0">, </span><span class="s1">algorithm=algorithm)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;algorithm&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'mpl2005'</span><span class="s0">, </span><span class="s3">'mpl2014'</span><span class="s0">, </span><span class="s3">'serial'</span><span class="s0">, </span><span class="s3">'threaded'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_algorithm_supports_corner_mask(algorithm):</span>
    <span class="s1">z = np.array([[</span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">4.0</span><span class="s1">]])</span>

    <span class="s4"># All algorithms support corner_mask=False</span>
    <span class="s1">plt.contourf(z</span><span class="s0">, </span><span class="s1">algorithm=algorithm</span><span class="s0">, </span><span class="s1">corner_mask=</span><span class="s0">False</span><span class="s1">)</span>

    <span class="s4"># Only some algorithms support corner_mask=True</span>
    <span class="s0">if </span><span class="s1">algorithm != </span><span class="s3">'mpl2005'</span><span class="s1">:</span>
        <span class="s1">plt.contourf(z</span><span class="s0">, </span><span class="s1">algorithm=algorithm</span><span class="s0">, </span><span class="s1">corner_mask=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
            <span class="s1">plt.contourf(z</span><span class="s0">, </span><span class="s1">algorithm=algorithm</span><span class="s0">, </span><span class="s1">corner_mask=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s1">@image_comparison(baseline_images=[</span><span class="s3">'contour_all_algorithms'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">extensions=[</span><span class="s3">'png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_all_algorithms():</span>
    <span class="s1">algorithms = [</span><span class="s3">'mpl2005'</span><span class="s0">, </span><span class="s3">'mpl2014'</span><span class="s0">, </span><span class="s3">'serial'</span><span class="s0">, </span><span class="s3">'threaded'</span><span class="s1">]</span>

    <span class="s1">rng = np.random.default_rng(</span><span class="s2">2981</span><span class="s1">)</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.meshgrid(np.linspace(</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.linspace(</span><span class="s2">0.0</span><span class="s0">, </span><span class="s2">1.0</span><span class="s0">, </span><span class="s2">6</span><span class="s1">))</span>
    <span class="s1">z = np.sin(</span><span class="s2">15</span><span class="s1">*x)*np.cos(</span><span class="s2">10</span><span class="s1">*y) + rng.normal(scale=</span><span class="s2">0.5</span><span class="s0">, </span><span class="s1">size=(</span><span class="s2">6</span><span class="s0">, </span><span class="s2">10</span><span class="s1">))</span>
    <span class="s1">mask = np.zeros_like(z</span><span class="s0">, </span><span class="s1">dtype=bool)</span>
    <span class="s1">mask[</span><span class="s2">3</span><span class="s0">, </span><span class="s2">7</span><span class="s1">] = </span><span class="s0">True</span>
    <span class="s1">z = np.ma.array(z</span><span class="s0">, </span><span class="s1">mask=mask)</span>

    <span class="s1">_</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s0">, </span><span class="s1">algorithm </span><span class="s0">in </span><span class="s1">zip(axs.ravel()</span><span class="s0">, </span><span class="s1">algorithms):</span>
        <span class="s1">ax.contourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">algorithm=algorithm)</span>
        <span class="s1">ax.contour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z</span><span class="s0">, </span><span class="s1">algorithm=algorithm</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s1">)</span>
        <span class="s1">ax.set_title(algorithm)</span>


<span class="s0">def </span><span class="s1">test_subfigure_clabel():</span>
    <span class="s4"># Smoke test for gh#23173</span>
    <span class="s1">delta = </span><span class="s2">0.025</span>
    <span class="s1">x = np.arange(-</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">3.0</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s1">y = np.arange(-</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z1 = np.exp(-(X**</span><span class="s2">2</span><span class="s1">) - Y**</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">Z2 = np.exp(-((X - </span><span class="s2">1</span><span class="s1">) ** </span><span class="s2">2</span><span class="s1">) - (Y - </span><span class="s2">1</span><span class="s1">) ** </span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">Z = (Z1 - Z2) * </span><span class="s2">2</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">figs = fig.subfigures(nrows=</span><span class="s2">1</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s2">2</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">figs:</span>
        <span class="s1">ax = f.subplots()</span>
        <span class="s1">CS = ax.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z)</span>
        <span class="s1">ax.clabel(CS</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True, </span><span class="s1">fontsize=</span><span class="s2">10</span><span class="s1">)</span>
        <span class="s1">ax.set_title(</span><span class="s3">&quot;Simplest default with labels&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;style&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'solid'</span><span class="s0">, </span><span class="s3">'dashed'</span><span class="s0">, </span><span class="s3">'dashdot'</span><span class="s0">, </span><span class="s3">'dotted'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_linestyles(style):</span>
    <span class="s1">delta = </span><span class="s2">0.025</span>
    <span class="s1">x = np.arange(-</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">3.0</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s1">y = np.arange(-</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z1 = np.exp(-X**</span><span class="s2">2 </span><span class="s1">- Y**</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">Z2 = np.exp(-(X - </span><span class="s2">1</span><span class="s1">)**</span><span class="s2">2 </span><span class="s1">- (Y - </span><span class="s2">1</span><span class="s1">)**</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">Z = (Z1 - Z2) * </span><span class="s2">2</span>

    <span class="s4"># Positive contour defaults to solid</span>
    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots()</span>
    <span class="s1">CS1 = ax1.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">ax1.clabel(CS1</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax1.set_title(</span><span class="s3">'Single color - positive contours solid (default)'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">CS1.linestyles </span><span class="s0">is None  </span><span class="s4"># default</span>

    <span class="s4"># Change linestyles using linestyles kwarg</span>
    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots()</span>
    <span class="s1">CS2 = ax2.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">linestyles=style)</span>
    <span class="s1">ax2.clabel(CS2</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax2.set_title(</span><span class="s3">f'Single color - positive contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s3">'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">CS2.linestyles == style</span>

    <span class="s4"># Ensure linestyles do not change when negative_linestyles is defined</span>
    <span class="s1">fig3</span><span class="s0">, </span><span class="s1">ax3 = plt.subplots()</span>
    <span class="s1">CS3 = ax3.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">linestyles=style</span><span class="s0">,</span>
                      <span class="s1">negative_linestyles=</span><span class="s3">'dashdot'</span><span class="s1">)</span>
    <span class="s1">ax3.clabel(CS3</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax3.set_title(</span><span class="s3">f'Single color - positive contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s3">'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">CS3.linestyles == style</span>


<span class="s1">@pytest.mark.parametrize(</span>
    <span class="s3">&quot;style&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s3">'solid'</span><span class="s0">, </span><span class="s3">'dashed'</span><span class="s0">, </span><span class="s3">'dashdot'</span><span class="s0">, </span><span class="s3">'dotted'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_negative_linestyles(style):</span>
    <span class="s1">delta = </span><span class="s2">0.025</span>
    <span class="s1">x = np.arange(-</span><span class="s2">3.0</span><span class="s0">, </span><span class="s2">3.0</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s1">y = np.arange(-</span><span class="s2">2.0</span><span class="s0">, </span><span class="s2">2.0</span><span class="s0">, </span><span class="s1">delta)</span>
    <span class="s1">X</span><span class="s0">, </span><span class="s1">Y = np.meshgrid(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">Z1 = np.exp(-X**</span><span class="s2">2 </span><span class="s1">- Y**</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">Z2 = np.exp(-(X - </span><span class="s2">1</span><span class="s1">)**</span><span class="s2">2 </span><span class="s1">- (Y - </span><span class="s2">1</span><span class="s1">)**</span><span class="s2">2</span><span class="s1">)</span>
    <span class="s1">Z = (Z1 - Z2) * </span><span class="s2">2</span>

    <span class="s4"># Negative contour defaults to dashed</span>
    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax1 = plt.subplots()</span>
    <span class="s1">CS1 = ax1.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">ax1.clabel(CS1</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax1.set_title(</span><span class="s3">'Single color - negative contours dashed (default)'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">CS1.negative_linestyles == </span><span class="s3">'dashed'  </span><span class="s4"># default</span>

    <span class="s4"># Change negative_linestyles using rcParams</span>
    <span class="s1">plt.rcParams[</span><span class="s3">'contour.negative_linestyle'</span><span class="s1">] = style</span>
    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots()</span>
    <span class="s1">CS2 = ax2.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s1">)</span>
    <span class="s1">ax2.clabel(CS2</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax2.set_title(</span><span class="s3">f'Single color - negative contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s3">'</span>
                   <span class="s3">'(using rcParams)'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">CS2.negative_linestyles == style</span>

    <span class="s4"># Change negative_linestyles using negative_linestyles kwarg</span>
    <span class="s1">fig3</span><span class="s0">, </span><span class="s1">ax3 = plt.subplots()</span>
    <span class="s1">CS3 = ax3.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">negative_linestyles=style)</span>
    <span class="s1">ax3.clabel(CS3</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax3.set_title(</span><span class="s3">f'Single color - negative contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s3">'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">CS3.negative_linestyles == style</span>

    <span class="s4"># Ensure negative_linestyles do not change when linestyles is defined</span>
    <span class="s1">fig4</span><span class="s0">, </span><span class="s1">ax4 = plt.subplots()</span>
    <span class="s1">CS4 = ax4.contour(X</span><span class="s0">, </span><span class="s1">Y</span><span class="s0">, </span><span class="s1">Z</span><span class="s0">, </span><span class="s2">6</span><span class="s0">, </span><span class="s1">colors=</span><span class="s3">'k'</span><span class="s0">, </span><span class="s1">linestyles=</span><span class="s3">'dashdot'</span><span class="s0">,</span>
                      <span class="s1">negative_linestyles=style)</span>
    <span class="s1">ax4.clabel(CS4</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">9</span><span class="s0">, </span><span class="s1">inline=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">ax4.set_title(</span><span class="s3">f'Single color - negative contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s3">'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">CS4.negative_linestyles == style</span>


<span class="s0">def </span><span class="s1">test_contour_remove():</span>
    <span class="s1">ax = plt.figure().add_subplot()</span>
    <span class="s1">orig_children = ax.get_children()</span>
    <span class="s1">cs = ax.contour(np.arange(</span><span class="s2">16</span><span class="s1">).reshape((</span><span class="s2">4</span><span class="s0">, </span><span class="s2">4</span><span class="s1">)))</span>
    <span class="s1">cs.clabel()</span>
    <span class="s0">assert </span><span class="s1">ax.get_children() != orig_children</span>
    <span class="s1">cs.remove()</span>
    <span class="s0">assert </span><span class="s1">ax.get_children() == orig_children</span>


<span class="s0">def </span><span class="s1">test_bool_autolevel():</span>
    <span class="s1">x</span><span class="s0">, </span><span class="s1">y = np.random.rand(</span><span class="s2">2</span><span class="s0">, </span><span class="s2">9</span><span class="s1">)</span>
    <span class="s1">z = (np.arange(</span><span class="s2">9</span><span class="s1">) % </span><span class="s2">2</span><span class="s1">).reshape((</span><span class="s2">3</span><span class="s0">, </span><span class="s2">3</span><span class="s1">)).astype(bool)</span>
    <span class="s1">m = [[</span><span class="s0">False, False, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, True, False</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">False, False, False</span><span class="s1">]]</span>
    <span class="s0">assert </span><span class="s1">plt.contour(z.tolist()).levels.tolist() == [</span><span class="s2">.5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.contour(z).levels.tolist() == [</span><span class="s2">.5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.contour(np.ma.array(z</span><span class="s0">, </span><span class="s1">mask=m)).levels.tolist() == [</span><span class="s2">.5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.contourf(z.tolist()).levels.tolist() == [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">.5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.contourf(z).levels.tolist() == [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">.5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.contourf(np.ma.array(z</span><span class="s0">, </span><span class="s1">mask=m)).levels.tolist() == [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">.5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span>
    <span class="s1">z = z.ravel()</span>
    <span class="s0">assert </span><span class="s1">plt.tricontour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z.tolist()).levels.tolist() == [</span><span class="s2">.5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.tricontour(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z).levels.tolist() == [</span><span class="s2">.5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.tricontourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z.tolist()).levels.tolist() == [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">.5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.tricontourf(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s1">z).levels.tolist() == [</span><span class="s2">0</span><span class="s0">, </span><span class="s2">.5</span><span class="s0">, </span><span class="s2">1</span><span class="s1">]</span>
</pre>
</body>
</html>