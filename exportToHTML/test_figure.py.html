<html>
<head>
<title>test_figure.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_figure.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">copy</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>
<span class="s0">import </span><span class="s1">pickle</span>
<span class="s0">import </span><span class="s1">platform</span>
<span class="s0">from </span><span class="s1">threading </span><span class="s0">import </span><span class="s1">Timer</span>
<span class="s0">from </span><span class="s1">types </span><span class="s0">import </span><span class="s1">SimpleNamespace</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">PIL </span><span class="s0">import </span><span class="s1">Image</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">gridspec</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">image_comparison</span><span class="s0">, </span><span class="s1">check_figures_equal</span>
<span class="s0">from </span><span class="s1">matplotlib.axes </span><span class="s0">import </span><span class="s1">Axes</span>
<span class="s0">from </span><span class="s1">matplotlib.figure </span><span class="s0">import </span><span class="s1">Figure</span><span class="s0">, </span><span class="s1">FigureBase</span>
<span class="s0">from </span><span class="s1">matplotlib.layout_engine </span><span class="s0">import </span><span class="s1">(ConstrainedLayoutEngine</span><span class="s0">,</span>
                                      <span class="s1">TightLayoutEngine</span><span class="s0">,</span>
                                      <span class="s1">PlaceHolderLayoutEngine)</span>
<span class="s0">from </span><span class="s1">matplotlib.ticker </span><span class="s0">import </span><span class="s1">AutoMinorLocator</span><span class="s0">, </span><span class="s1">FixedFormatter</span><span class="s0">, </span><span class="s1">ScalarFormatter</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib.dates </span><span class="s0">as </span><span class="s1">mdates</span>


<span class="s1">@image_comparison([</span><span class="s2">'figure_align_labels'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">extensions=[</span><span class="s2">'png'</span><span class="s0">, </span><span class="s2">'svg'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">tol=</span><span class="s3">0 </span><span class="s0">if </span><span class="s1">platform.machine() == </span><span class="s2">'x86_64' </span><span class="s0">else </span><span class="s3">0.01</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_align_labels():</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s2">'tight'</span><span class="s1">)</span>
    <span class="s1">gs = gridspec.GridSpec(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">ax = fig.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">:</span><span class="s3">2</span><span class="s1">])</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1e6</span><span class="s0">, </span><span class="s3">1000</span><span class="s1">))</span>
    <span class="s1">ax.set_ylabel(</span><span class="s2">'Ylabel0 0'</span><span class="s1">)</span>
    <span class="s1">ax = fig.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1e4</span><span class="s0">, </span><span class="s3">100</span><span class="s1">))</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">):</span>
        <span class="s1">ax = fig.add_subplot(gs[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">i])</span>
        <span class="s1">ax.set_ylabel(</span><span class="s2">'YLabel1 %d' </span><span class="s1">% i)</span>
        <span class="s1">ax.set_xlabel(</span><span class="s2">'XLabel1 %d' </span><span class="s1">% i)</span>
        <span class="s0">if </span><span class="s1">i </span><span class="s0">in </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]:</span>
            <span class="s1">ax.xaxis.set_label_position(</span><span class="s2">&quot;top&quot;</span><span class="s1">)</span>
            <span class="s1">ax.xaxis.tick_top()</span>
        <span class="s0">if </span><span class="s1">i == </span><span class="s3">0</span><span class="s1">:</span>
            <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax.get_xticklabels():</span>
                <span class="s1">tick.set_rotation(</span><span class="s3">90</span><span class="s1">)</span>
        <span class="s0">if </span><span class="s1">i == </span><span class="s3">2</span><span class="s1">:</span>
            <span class="s1">ax.yaxis.set_label_position(</span><span class="s2">&quot;right&quot;</span><span class="s1">)</span>
            <span class="s1">ax.yaxis.tick_right()</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">):</span>
        <span class="s1">ax = fig.add_subplot(gs[</span><span class="s3">2</span><span class="s0">, </span><span class="s1">i])</span>
        <span class="s1">ax.set_xlabel(</span><span class="s2">f'XLabel2 </span><span class="s0">{</span><span class="s1">i</span><span class="s0">}</span><span class="s2">'</span><span class="s1">)</span>
        <span class="s1">ax.set_ylabel(</span><span class="s2">f'YLabel2 </span><span class="s0">{</span><span class="s1">i</span><span class="s0">}</span><span class="s2">'</span><span class="s1">)</span>

        <span class="s0">if </span><span class="s1">i == </span><span class="s3">2</span><span class="s1">:</span>
            <span class="s1">ax.plot(np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1e4</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>
            <span class="s1">ax.yaxis.set_label_position(</span><span class="s2">&quot;right&quot;</span><span class="s1">)</span>
            <span class="s1">ax.yaxis.tick_right()</span>
            <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax.get_xticklabels():</span>
                <span class="s1">tick.set_rotation(</span><span class="s3">90</span><span class="s1">)</span>

    <span class="s1">fig.align_labels()</span>


<span class="s0">def </span><span class="s1">test_align_labels_stray_axes():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">ax.set_xlabel(</span><span class="s2">'Boo'</span><span class="s1">)</span>
        <span class="s1">ax.set_xlabel(</span><span class="s2">'Who'</span><span class="s1">)</span>
        <span class="s1">ax.plot(np.arange(</span><span class="s3">4</span><span class="s1">)**nn</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">4</span><span class="s1">)**nn)</span>
    <span class="s1">fig.align_ylabels()</span>
    <span class="s1">fig.align_xlabels()</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">xn = np.zeros(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">yn = np.zeros(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">yn[nn] = ax.xaxis.label.get_position()[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">xn[nn] = ax.yaxis.label.get_position()[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">np.testing.assert_allclose(xn[:</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xn[</span><span class="s3">2</span><span class="s1">:])</span>
    <span class="s1">np.testing.assert_allclose(yn[::</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yn[</span><span class="s3">1</span><span class="s1">::</span><span class="s3">2</span><span class="s1">])</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">ax.set_xlabel(</span><span class="s2">'Boo'</span><span class="s1">)</span>
        <span class="s1">ax.set_xlabel(</span><span class="s2">'Who'</span><span class="s1">)</span>
        <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span>
    <span class="s1">fig.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=ax)</span>
    <span class="s1">fig.align_ylabels()</span>
    <span class="s1">fig.align_xlabels()</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">xn = np.zeros(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">yn = np.zeros(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axs.flat):</span>
        <span class="s1">yn[nn] = ax.xaxis.label.get_position()[</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">xn[nn] = ax.yaxis.label.get_position()[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">np.testing.assert_allclose(xn[:</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">xn[</span><span class="s3">2</span><span class="s1">:])</span>
    <span class="s1">np.testing.assert_allclose(yn[::</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">yn[</span><span class="s3">1</span><span class="s1">::</span><span class="s3">2</span><span class="s1">])</span>


<span class="s0">def </span><span class="s1">test_figure_label():</span>
    <span class="s4"># pyplot figure creation, selection, and closing with label/number/instance</span>
    <span class="s1">plt.close(</span><span class="s2">'all'</span><span class="s1">)</span>
    <span class="s1">fig_today = plt.figure(</span><span class="s2">'today'</span><span class="s1">)</span>
    <span class="s1">plt.figure(</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">plt.figure(</span><span class="s2">'tomorrow'</span><span class="s1">)</span>
    <span class="s1">plt.figure()</span>
    <span class="s1">plt.figure(</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">plt.figure(</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">plt.figure(</span><span class="s3">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">plt.get_fignums() == [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.get_figlabels() == [</span><span class="s2">''</span><span class="s0">, </span><span class="s2">'today'</span><span class="s0">, </span><span class="s2">''</span><span class="s0">, </span><span class="s2">'tomorrow'</span><span class="s0">, </span><span class="s2">''</span><span class="s1">]</span>
    <span class="s1">plt.close(</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s1">plt.close()</span>
    <span class="s1">plt.close(</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">plt.close(</span><span class="s2">'tomorrow'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">plt.get_fignums() == [</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>
    <span class="s0">assert </span><span class="s1">plt.get_figlabels() == [</span><span class="s2">''</span><span class="s0">, </span><span class="s2">'today'</span><span class="s1">]</span>
    <span class="s1">plt.figure(fig_today)</span>
    <span class="s0">assert </span><span class="s1">plt.gcf() == fig_today</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.figure(Figure())</span>


<span class="s0">def </span><span class="s1">test_fignum_exists():</span>
    <span class="s4"># pyplot figure creation, selection and closing with fignum_exists</span>
    <span class="s1">plt.figure(</span><span class="s2">'one'</span><span class="s1">)</span>
    <span class="s1">plt.figure(</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">plt.figure(</span><span class="s2">'three'</span><span class="s1">)</span>
    <span class="s1">plt.figure()</span>
    <span class="s0">assert </span><span class="s1">plt.fignum_exists(</span><span class="s2">'one'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">plt.fignum_exists(</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">plt.fignum_exists(</span><span class="s2">'three'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">plt.fignum_exists(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">plt.close(</span><span class="s2">'one'</span><span class="s1">)</span>
    <span class="s1">plt.close(</span><span class="s3">4</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">plt.fignum_exists(</span><span class="s2">'one'</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">plt.fignum_exists(</span><span class="s3">4</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_clf_keyword():</span>
    <span class="s4"># test if existing figure is cleared with figure() and subplots()</span>
    <span class="s1">text1 = </span><span class="s2">'A fancy plot'</span>
    <span class="s1">text2 = </span><span class="s2">'Really fancy!'</span>

    <span class="s1">fig0 = plt.figure(num=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">fig0.suptitle(text1)</span>
    <span class="s0">assert </span><span class="s1">[t.get_text() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">fig0.texts] == [text1]</span>

    <span class="s1">fig1 = plt.figure(num=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">clear=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">fig1.text(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">text2)</span>
    <span class="s0">assert </span><span class="s1">fig0 </span><span class="s0">is </span><span class="s1">fig1</span>
    <span class="s0">assert </span><span class="s1">[t.get_text() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">fig1.texts] == [text1</span><span class="s0">, </span><span class="s1">text2]</span>

    <span class="s1">fig2</span><span class="s0">, </span><span class="s1">ax2 = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">num=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">clear=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig0 </span><span class="s0">is </span><span class="s1">fig2</span>
    <span class="s0">assert </span><span class="s1">[t.get_text() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">fig2.texts] == []</span>


<span class="s1">@image_comparison([</span><span class="s2">'figure_today'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_figure():</span>
    <span class="s4"># named figure support</span>
    <span class="s1">fig = plt.figure(</span><span class="s2">'today'</span><span class="s1">)</span>
    <span class="s1">ax = fig.add_subplot()</span>
    <span class="s1">ax.set_title(fig.get_label())</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">5</span><span class="s1">))</span>
    <span class="s4"># plot red line in a different figure.</span>
    <span class="s1">plt.figure(</span><span class="s2">'tomorrow'</span><span class="s1">)</span>
    <span class="s1">plt.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s4"># Return to the original; make sure the red line is not there.</span>
    <span class="s1">plt.figure(</span><span class="s2">'today'</span><span class="s1">)</span>
    <span class="s1">plt.close(</span><span class="s2">'tomorrow'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'figure_legend'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_figure_legend():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s3">0</span><span class="s1">].plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'x'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'g'</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s3">0</span><span class="s1">].plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'y'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s3">0</span><span class="s1">].plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'y'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'k'</span><span class="s1">)</span>

    <span class="s1">axs[</span><span class="s3">1</span><span class="s1">].plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'_y'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s3">1</span><span class="s1">].plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'z'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'b'</span><span class="s1">)</span>
    <span class="s1">fig.legend()</span>


<span class="s0">def </span><span class="s1">test_gca():</span>
    <span class="s1">fig = plt.figure()</span>

    <span class="s4"># test that gca() picks up Axes created via add_axes()</span>
    <span class="s1">ax0 = fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">fig.gca() </span><span class="s0">is </span><span class="s1">ax0</span>

    <span class="s4"># test that gca() picks up Axes created via add_subplot()</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">111</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig.gca() </span><span class="s0">is </span><span class="s1">ax1</span>

    <span class="s4"># add_axes on an existing Axes should not change stored order, but will</span>
    <span class="s4"># make it current.</span>
    <span class="s1">fig.add_axes(ax0)</span>
    <span class="s0">assert </span><span class="s1">fig.axes == [ax0</span><span class="s0">, </span><span class="s1">ax1]</span>
    <span class="s0">assert </span><span class="s1">fig.gca() </span><span class="s0">is </span><span class="s1">ax0</span>

    <span class="s4"># sca() should not change stored order of Axes, which is order added.</span>
    <span class="s1">fig.sca(ax0)</span>
    <span class="s0">assert </span><span class="s1">fig.axes == [ax0</span><span class="s0">, </span><span class="s1">ax1]</span>

    <span class="s4"># add_subplot on an existing Axes should not change stored order, but will</span>
    <span class="s4"># make it current.</span>
    <span class="s1">fig.add_subplot(ax1)</span>
    <span class="s0">assert </span><span class="s1">fig.axes == [ax0</span><span class="s0">, </span><span class="s1">ax1]</span>
    <span class="s0">assert </span><span class="s1">fig.gca() </span><span class="s0">is </span><span class="s1">ax1</span>


<span class="s0">def </span><span class="s1">test_add_subplot_subclass():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.add_subplot(axes_class=Axes)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">fig.add_subplot(axes_class=Axes</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">&quot;3d&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">fig.add_subplot(axes_class=Axes</span><span class="s0">, </span><span class="s1">polar=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">fig.add_subplot(projection=</span><span class="s2">&quot;3d&quot;</span><span class="s0">, </span><span class="s1">polar=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
        <span class="s1">fig.add_subplot(projection=</span><span class="s3">42</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_add_subplot_invalid():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">'Number of columns must be a positive integer'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">'Number of rows must be a positive integer'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'num must be an integer with '</span>
                                         <span class="s2">'1 &lt;= num &lt;= 4'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'num must be an integer with '</span>
                                         <span class="s2">'1 &lt;= num &lt;= 4'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'num must be an integer with '</span>
                                         <span class="s2">'1 &lt;= num &lt;= 4'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">0.5</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'must be a three-digit integer'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">42</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'must be a three-digit integer'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">1000</span><span class="s1">)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'takes 1 or 3 positional arguments '</span>
                                        <span class="s2">'but 2 were given'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'takes 1 or 3 positional arguments '</span>
                                        <span class="s2">'but 4 were given'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">&quot;Number of rows must be a positive integer, &quot;</span>
                             <span class="s2">&quot;not '2'&quot;</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s2">'2'</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">'Number of columns must be a positive integer, '</span>
                             <span class="s2">'not 2.0'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2.0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">'The Axes must have been created in the '</span>
                             <span class="s2">'present figure'</span><span class="s1">):</span>
        <span class="s1">fig.add_subplot(ax)</span>


<span class="s1">@image_comparison([</span><span class="s2">'figure_suptitle'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_suptitle():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">_ = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s2">'hello'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s1">fig.suptitle(</span><span class="s2">'title'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'g'</span><span class="s0">, </span><span class="s1">rotation=</span><span class="s3">30</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_suptitle_fontproperties():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fps = mpl.font_manager.FontProperties(size=</span><span class="s2">'large'</span><span class="s0">, </span><span class="s1">weight=</span><span class="s2">'bold'</span><span class="s1">)</span>
    <span class="s1">txt = fig.suptitle(</span><span class="s2">'fontprops title'</span><span class="s0">, </span><span class="s1">fontproperties=fps)</span>
    <span class="s0">assert </span><span class="s1">txt.get_fontsize() == fps.get_size_in_points()</span>
    <span class="s0">assert </span><span class="s1">txt.get_weight() == fps.get_weight()</span>


<span class="s1">@image_comparison([</span><span class="s2">'alpha_background'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s4"># only test png and svg. The PDF output appears correct,</span>
                  <span class="s4"># but Ghostscript does not preserve the background color.</span>
                  <span class="s1">extensions=[</span><span class="s2">'png'</span><span class="s0">, </span><span class="s2">'svg'</span><span class="s1">]</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s2">'facecolor'</span><span class="s1">: (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">)</span><span class="s0">,</span>
                                 <span class="s2">'edgecolor'</span><span class="s1">: </span><span class="s2">'none'</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_alpha():</span>
    <span class="s4"># We want an image which has a background color and an alpha of 0.4.</span>
    <span class="s1">fig = plt.figure(figsize=[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">fig.set_facecolor((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">0.4</span><span class="s1">))</span>
    <span class="s1">fig.patch.set_alpha(</span><span class="s3">0.4</span><span class="s1">)</span>
    <span class="s1">fig.patches.append(mpl.patches.CirclePolygon(</span>
        <span class="s1">[</span><span class="s3">20</span><span class="s0">, </span><span class="s3">20</span><span class="s1">]</span><span class="s0">, </span><span class="s1">radius=</span><span class="s3">15</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.6</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s2">'red'</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_too_many_figures():</span>
    <span class="s0">with </span><span class="s1">pytest.warns(RuntimeWarning):</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(mpl.rcParams[</span><span class="s2">'figure.max_open_warning'</span><span class="s1">] + </span><span class="s3">1</span><span class="s1">):</span>
            <span class="s1">plt.figure()</span>


<span class="s0">def </span><span class="s1">test_iterability_axes_argument():</span>

    <span class="s4"># This is a regression test for matplotlib/matplotlib#3196. If one of the</span>
    <span class="s4"># arguments returned by _as_mpl_axes defines __getitem__ but is not</span>
    <span class="s4"># iterable, this would raise an exception. This is because we check</span>
    <span class="s4"># whether the arguments are iterable, and if so we try and convert them</span>
    <span class="s4"># to a tuple. However, the ``iterable`` function returns True if</span>
    <span class="s4"># __getitem__ is present, but some classes can define __getitem__ without</span>
    <span class="s4"># being iterable. The tuple conversion is now done in a try...except in</span>
    <span class="s4"># case it fails.</span>

    <span class="s0">class </span><span class="s1">MyAxes(Axes):</span>
        <span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">*args</span><span class="s0">, </span><span class="s1">myclass=</span><span class="s0">None, </span><span class="s1">**kwargs):</span>
            <span class="s1">Axes.__init__(self</span><span class="s0">, </span><span class="s1">*args</span><span class="s0">, </span><span class="s1">**kwargs)</span>

    <span class="s0">class </span><span class="s1">MyClass:</span>

        <span class="s0">def </span><span class="s1">__getitem__(self</span><span class="s0">, </span><span class="s1">item):</span>
            <span class="s0">if </span><span class="s1">item != </span><span class="s2">'a'</span><span class="s1">:</span>
                <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s2">&quot;item should be a&quot;</span><span class="s1">)</span>

        <span class="s0">def </span><span class="s1">_as_mpl_axes(self):</span>
            <span class="s0">return </span><span class="s1">MyAxes</span><span class="s0">, </span><span class="s1">{</span><span class="s2">'myclass'</span><span class="s1">: self}</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=MyClass())</span>
    <span class="s1">plt.close(fig)</span>


<span class="s0">def </span><span class="s1">test_set_fig_size():</span>
    <span class="s1">fig = plt.figure()</span>

    <span class="s4"># check figwidth</span>
    <span class="s1">fig.set_figwidth(</span><span class="s3">5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig.get_figwidth() == </span><span class="s3">5</span>

    <span class="s4"># check figheight</span>
    <span class="s1">fig.set_figheight(</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig.get_figheight() == </span><span class="s3">1</span>

    <span class="s4"># check using set_size_inches</span>
    <span class="s1">fig.set_size_inches(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig.get_figwidth() == </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">fig.get_figheight() == </span><span class="s3">4</span>

    <span class="s4"># check using tuple to first argument</span>
    <span class="s1">fig.set_size_inches((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">fig.get_figwidth() == </span><span class="s3">1</span>
    <span class="s0">assert </span><span class="s1">fig.get_figheight() == </span><span class="s3">3</span>


<span class="s0">def </span><span class="s1">test_axes_remove():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">axs[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">].remove()</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.ravel()[:-</span><span class="s3">1</span><span class="s1">]:</span>
        <span class="s0">assert </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig.axes</span>
    <span class="s0">assert </span><span class="s1">axs[-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">] </span><span class="s0">not in </span><span class="s1">fig.axes</span>
    <span class="s0">assert </span><span class="s1">len(fig.axes) == </span><span class="s3">3</span>


<span class="s0">def </span><span class="s1">test_figaspect():</span>
    <span class="s1">w</span><span class="s0">, </span><span class="s1">h = plt.figaspect(np.float64(</span><span class="s3">2</span><span class="s1">) / np.float64(</span><span class="s3">1</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">h / w == </span><span class="s3">2</span>
    <span class="s1">w</span><span class="s0">, </span><span class="s1">h = plt.figaspect(</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">h / w == </span><span class="s3">2</span>
    <span class="s1">w</span><span class="s0">, </span><span class="s1">h = plt.figaspect(np.zeros((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">h / w == </span><span class="s3">0.5</span>
    <span class="s1">w</span><span class="s0">, </span><span class="s1">h = plt.figaspect(np.zeros((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)))</span>
    <span class="s0">assert </span><span class="s1">h / w == </span><span class="s3">1</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'which'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'both'</span><span class="s0">, </span><span class="s2">'major'</span><span class="s0">, </span><span class="s2">'minor'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_autofmt_xdate(which):</span>
    <span class="s1">date = [</span><span class="s2">'3 Jan 2013'</span><span class="s0">, </span><span class="s2">'4 Jan 2013'</span><span class="s0">, </span><span class="s2">'5 Jan 2013'</span><span class="s0">, </span><span class="s2">'6 Jan 2013'</span><span class="s0">,</span>
            <span class="s2">'7 Jan 2013'</span><span class="s0">, </span><span class="s2">'8 Jan 2013'</span><span class="s0">, </span><span class="s2">'9 Jan 2013'</span><span class="s0">, </span><span class="s2">'10 Jan 2013'</span><span class="s0">,</span>
            <span class="s2">'11 Jan 2013'</span><span class="s0">, </span><span class="s2">'12 Jan 2013'</span><span class="s0">, </span><span class="s2">'13 Jan 2013'</span><span class="s0">, </span><span class="s2">'14 Jan 2013'</span><span class="s1">]</span>

    <span class="s1">time = [</span><span class="s2">'16:44:00'</span><span class="s0">, </span><span class="s2">'16:45:00'</span><span class="s0">, </span><span class="s2">'16:46:00'</span><span class="s0">, </span><span class="s2">'16:47:00'</span><span class="s0">, </span><span class="s2">'16:48:00'</span><span class="s0">,</span>
            <span class="s2">'16:49:00'</span><span class="s0">, </span><span class="s2">'16:51:00'</span><span class="s0">, </span><span class="s2">'16:52:00'</span><span class="s0">, </span><span class="s2">'16:53:00'</span><span class="s0">, </span><span class="s2">'16:55:00'</span><span class="s0">,</span>
            <span class="s2">'16:56:00'</span><span class="s0">, </span><span class="s2">'16:57:00'</span><span class="s1">]</span>

    <span class="s1">angle = </span><span class="s3">60</span>
    <span class="s1">minors = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s0">, </span><span class="s3">6</span><span class="s0">, </span><span class="s3">7</span><span class="s1">]</span>

    <span class="s1">x = mdates.datestr2num(date)</span>
    <span class="s1">y = mdates.datestr2num(time)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y)</span>
    <span class="s1">ax.yaxis_date()</span>
    <span class="s1">ax.xaxis_date()</span>

    <span class="s1">ax.xaxis.set_minor_locator(AutoMinorLocator(</span><span class="s3">2</span><span class="s1">))</span>
    <span class="s0">with </span><span class="s1">warnings.catch_warnings():</span>
        <span class="s1">warnings.filterwarnings(</span>
            <span class="s2">'ignore'</span><span class="s0">,</span>
            <span class="s2">'FixedFormatter should only be used together with FixedLocator'</span><span class="s1">)</span>
        <span class="s1">ax.xaxis.set_minor_formatter(FixedFormatter(minors))</span>

    <span class="s1">fig.autofmt_xdate(</span><span class="s3">0.2</span><span class="s0">, </span><span class="s1">angle</span><span class="s0">, </span><span class="s2">'right'</span><span class="s0">, </span><span class="s1">which)</span>

    <span class="s0">if </span><span class="s1">which </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'both'</span><span class="s0">, </span><span class="s2">'major'</span><span class="s1">):</span>
        <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">fig.axes[</span><span class="s3">0</span><span class="s1">].get_xticklabels(</span><span class="s0">False, </span><span class="s2">'major'</span><span class="s1">):</span>
            <span class="s0">assert </span><span class="s1">int(label.get_rotation()) == angle</span>

    <span class="s0">if </span><span class="s1">which </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'both'</span><span class="s0">, </span><span class="s2">'minor'</span><span class="s1">):</span>
        <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">fig.axes[</span><span class="s3">0</span><span class="s1">].get_xticklabels(</span><span class="s0">True, </span><span class="s2">'minor'</span><span class="s1">):</span>
            <span class="s0">assert </span><span class="s1">int(label.get_rotation()) == angle</span>


<span class="s1">@mpl.style.context(</span><span class="s2">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_change_dpi():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">4</span><span class="s1">))</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.renderer.height == </span><span class="s3">400</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.renderer.width == </span><span class="s3">400</span>
    <span class="s1">fig.dpi = </span><span class="s3">50</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.renderer.height == </span><span class="s3">200</span>
    <span class="s0">assert </span><span class="s1">fig.canvas.renderer.width == </span><span class="s3">200</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'width, height'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">np.nan)</span><span class="s0">,</span>
    <span class="s1">(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(np.inf</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_invalid_figure_size(width</span><span class="s0">, </span><span class="s1">height):</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">plt.figure(figsize=(width</span><span class="s0">, </span><span class="s1">height))</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">fig.set_size_inches(width</span><span class="s0">, </span><span class="s1">height)</span>


<span class="s0">def </span><span class="s1">test_invalid_figure_add_axes():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">&quot;missing 1 required positional argument: 'rect'&quot;</span><span class="s1">):</span>
        <span class="s1">fig.add_axes()</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError):</span>
        <span class="s1">fig.add_axes((</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">.1</span><span class="s0">, </span><span class="s3">.5</span><span class="s0">, </span><span class="s1">np.nan))</span>

    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;multiple values for argument 'rect'&quot;</span><span class="s1">):</span>
        <span class="s1">fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">rect=[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>

    <span class="s1">_</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">&quot;The Axes must have been created in the present &quot;</span>
                             <span class="s2">&quot;figure&quot;</span><span class="s1">):</span>
        <span class="s1">fig.add_axes(ax)</span>


<span class="s0">def </span><span class="s1">test_subplots_shareax_loglabels():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True, </span><span class="s1">squeeze=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">ax.plot([</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s1">])</span>

    <span class="s1">ax.set_yscale(</span><span class="s2">&quot;log&quot;</span><span class="s1">)</span>
    <span class="s1">ax.set_xscale(</span><span class="s2">&quot;log&quot;</span><span class="s1">)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">:]:</span>
        <span class="s0">assert </span><span class="s3">0 </span><span class="s1">== len(ax.xaxis.get_ticklabels(which=</span><span class="s2">'both'</span><span class="s1">))</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs[</span><span class="s3">1</span><span class="s0">, </span><span class="s1">:]:</span>
        <span class="s0">assert </span><span class="s3">0 </span><span class="s1">&lt; len(ax.xaxis.get_ticklabels(which=</span><span class="s2">'both'</span><span class="s1">))</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs[:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]:</span>
        <span class="s0">assert </span><span class="s3">0 </span><span class="s1">== len(ax.yaxis.get_ticklabels(which=</span><span class="s2">'both'</span><span class="s1">))</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs[:</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]:</span>
        <span class="s0">assert </span><span class="s3">0 </span><span class="s1">&lt; len(ax.yaxis.get_ticklabels(which=</span><span class="s2">'both'</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_savefig():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">msg = </span><span class="s2">r&quot;savefig\(\) takes 2 positional arguments but 3 were given&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=msg):</span>
        <span class="s1">fig.savefig(</span><span class="s2">&quot;fname1.png&quot;</span><span class="s0">, </span><span class="s2">&quot;fname2.png&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_savefig_warns():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s0">for </span><span class="s1">format </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'png'</span><span class="s0">, </span><span class="s2">'pdf'</span><span class="s0">, </span><span class="s2">'svg'</span><span class="s0">, </span><span class="s2">'tif'</span><span class="s0">, </span><span class="s2">'jpg'</span><span class="s1">]:</span>
        <span class="s0">with </span><span class="s1">pytest.raises(TypeError):</span>
            <span class="s1">fig.savefig(io.BytesIO()</span><span class="s0">, </span><span class="s1">format=format</span><span class="s0">, </span><span class="s1">non_existent_kwarg=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_savefig_backend():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s4"># Intentionally use an invalid module name.</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ModuleNotFoundError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">&quot;No module named '@absent'&quot;</span><span class="s1">):</span>
        <span class="s1">fig.savefig(</span><span class="s2">&quot;test&quot;</span><span class="s0">, </span><span class="s1">backend=</span><span class="s2">&quot;module://@absent&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">&quot;The 'pdf' backend does not support png output&quot;</span><span class="s1">):</span>
        <span class="s1">fig.savefig(</span><span class="s2">&quot;test.png&quot;</span><span class="s0">, </span><span class="s1">backend=</span><span class="s2">&quot;pdf&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'backend'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">pytest.param(</span><span class="s2">'Agg'</span><span class="s0">, </span><span class="s1">marks=[pytest.mark.backend(</span><span class="s2">'Agg'</span><span class="s1">)])</span><span class="s0">,</span>
    <span class="s1">pytest.param(</span><span class="s2">'Cairo'</span><span class="s0">, </span><span class="s1">marks=[pytest.mark.backend(</span><span class="s2">'Cairo'</span><span class="s1">)])</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_savefig_pixel_ratio(backend):</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">io.BytesIO() </span><span class="s0">as </span><span class="s1">buf:</span>
        <span class="s1">fig.savefig(buf</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">'png'</span><span class="s1">)</span>
        <span class="s1">ratio1 = Image.open(buf)</span>
        <span class="s1">ratio1.load()</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">fig.canvas._set_device_pixel_ratio(</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">io.BytesIO() </span><span class="s0">as </span><span class="s1">buf:</span>
        <span class="s1">fig.savefig(buf</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">'png'</span><span class="s1">)</span>
        <span class="s1">ratio2 = Image.open(buf)</span>
        <span class="s1">ratio2.load()</span>

    <span class="s0">assert </span><span class="s1">ratio1 == ratio2</span>


<span class="s0">def </span><span class="s1">test_savefig_preserve_layout_engine(tmp_path):</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s2">'compressed'</span><span class="s1">)</span>
    <span class="s1">fig.savefig(tmp_path / </span><span class="s2">'foo.png'</span><span class="s0">, </span><span class="s1">bbox_inches=</span><span class="s2">'tight'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">fig.get_layout_engine()._compress</span>


<span class="s0">def </span><span class="s1">test_figure_repr():</span>
    <span class="s1">fig = plt.figure(figsize=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s1">dpi=</span><span class="s3">10</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">repr(fig) == </span><span class="s2">&quot;&lt;Figure size 100x200 with 0 Axes&gt;&quot;</span>


<span class="s0">def </span><span class="s1">test_valid_layouts():</span>
    <span class="s1">fig = Figure(layout=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">fig.get_tight_layout()</span>
    <span class="s0">assert not </span><span class="s1">fig.get_constrained_layout()</span>

    <span class="s1">fig = Figure(layout=</span><span class="s2">'tight'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig.get_tight_layout()</span>
    <span class="s0">assert not </span><span class="s1">fig.get_constrained_layout()</span>

    <span class="s1">fig = Figure(layout=</span><span class="s2">'constrained'</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">fig.get_tight_layout()</span>
    <span class="s0">assert </span><span class="s1">fig.get_constrained_layout()</span>


<span class="s0">def </span><span class="s1">test_invalid_layouts():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning):</span>
        <span class="s4"># this should warn,</span>
        <span class="s1">fig.subplots_adjust(top=</span><span class="s3">0.8</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(fig.get_layout_engine()</span><span class="s0">, </span><span class="s1">ConstrainedLayoutEngine)</span>

    <span class="s4"># Using layout + (tight|constrained)_layout warns, but the former takes</span>
    <span class="s4"># precedence.</span>
    <span class="s1">wst = </span><span class="s2">&quot;The Figure parameters 'layout' and 'tight_layout'&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=wst):</span>
        <span class="s1">fig = Figure(layout=</span><span class="s2">'tight'</span><span class="s0">, </span><span class="s1">tight_layout=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(fig.get_layout_engine()</span><span class="s0">, </span><span class="s1">TightLayoutEngine)</span>
    <span class="s1">wst = </span><span class="s2">&quot;The Figure parameters 'layout' and 'constrained_layout'&quot;</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=wst):</span>
        <span class="s1">fig = Figure(layout=</span><span class="s2">'constrained'</span><span class="s0">, </span><span class="s1">constrained_layout=</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s0">assert not </span><span class="s1">isinstance(fig.get_layout_engine()</span><span class="s0">, </span><span class="s1">TightLayoutEngine)</span>
    <span class="s0">assert </span><span class="s1">isinstance(fig.get_layout_engine()</span><span class="s0">, </span><span class="s1">ConstrainedLayoutEngine)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">,</span>
                       <span class="s1">match=</span><span class="s2">&quot;Invalid value for 'layout'&quot;</span><span class="s1">):</span>
        <span class="s1">Figure(layout=</span><span class="s2">'foobar'</span><span class="s1">)</span>

    <span class="s4"># test that layouts can be swapped if no colorbar:</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">fig.set_layout_engine(</span><span class="s2">&quot;tight&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(fig.get_layout_engine()</span><span class="s0">, </span><span class="s1">TightLayoutEngine)</span>
    <span class="s1">fig.set_layout_engine(</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(fig.get_layout_engine()</span><span class="s0">, </span><span class="s1">ConstrainedLayoutEngine)</span>

    <span class="s4"># test that layouts cannot be swapped if there is a colorbar:</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">fig.colorbar(pc)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'Colorbar layout of new layout'</span><span class="s1">):</span>
        <span class="s1">fig.set_layout_engine(</span><span class="s2">&quot;tight&quot;</span><span class="s1">)</span>
    <span class="s1">fig.set_layout_engine(</span><span class="s2">&quot;none&quot;</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'Colorbar layout of new layout'</span><span class="s1">):</span>
        <span class="s1">fig.set_layout_engine(</span><span class="s2">&quot;tight&quot;</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=</span><span class="s2">&quot;tight&quot;</span><span class="s1">)</span>
    <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
    <span class="s1">fig.colorbar(pc)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'Colorbar layout of new layout'</span><span class="s1">):</span>
        <span class="s1">fig.set_layout_engine(</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>
    <span class="s1">fig.set_layout_engine(</span><span class="s2">&quot;none&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">isinstance(fig.get_layout_engine()</span><span class="s0">, </span><span class="s1">PlaceHolderLayoutEngine)</span>

    <span class="s0">with </span><span class="s1">pytest.raises(RuntimeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'Colorbar layout of new layout'</span><span class="s1">):</span>
        <span class="s1">fig.set_layout_engine(</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'layout'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'constrained'</span><span class="s0">, </span><span class="s2">'compressed'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_layout_change_warning(layout):</span>
    <span class="s5">&quot;&quot;&quot; 
    Raise a warning when a previously assigned layout changes to tight using 
    plt.tight_layout(). 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(layout=layout)</span>
    <span class="s0">with </span><span class="s1">pytest.warns(UserWarning</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'The figure layout has changed to'</span><span class="s1">):</span>
        <span class="s1">plt.tight_layout()</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s0">, </span><span class="s2">&quot;pdf&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_add_artist(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">fig_test.dpi = </span><span class="s3">100</span>
    <span class="s1">fig_ref.dpi = </span><span class="s3">100</span>

    <span class="s1">fig_test.subplots()</span>
    <span class="s1">l1 = plt.Line2D([</span><span class="s3">.2</span><span class="s0">, </span><span class="s3">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.7</span><span class="s0">, </span><span class="s3">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gid=</span><span class="s2">'l1'</span><span class="s1">)</span>
    <span class="s1">l2 = plt.Line2D([</span><span class="s3">.2</span><span class="s0">, </span><span class="s3">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.8</span><span class="s0">, </span><span class="s3">.8</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gid=</span><span class="s2">'l2'</span><span class="s1">)</span>
    <span class="s1">r1 = plt.Circle((</span><span class="s3">20</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s1">transform=</span><span class="s0">None, </span><span class="s1">gid=</span><span class="s2">'C1'</span><span class="s1">)</span>
    <span class="s1">r2 = plt.Circle((</span><span class="s3">.7</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">)</span><span class="s0">, </span><span class="s3">.05</span><span class="s0">, </span><span class="s1">gid=</span><span class="s2">'C2'</span><span class="s1">)</span>
    <span class="s1">r3 = plt.Circle((</span><span class="s3">4.5</span><span class="s0">, </span><span class="s3">.8</span><span class="s1">)</span><span class="s0">, </span><span class="s3">.55</span><span class="s0">, </span><span class="s1">transform=fig_test.dpi_scale_trans</span><span class="s0">,</span>
                    <span class="s1">facecolor=</span><span class="s2">'crimson'</span><span class="s0">, </span><span class="s1">gid=</span><span class="s2">'C3'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">[l1</span><span class="s0">, </span><span class="s1">l2</span><span class="s0">, </span><span class="s1">r1</span><span class="s0">, </span><span class="s1">r2</span><span class="s0">, </span><span class="s1">r3]:</span>
        <span class="s1">fig_test.add_artist(a)</span>
    <span class="s1">l2.remove()</span>

    <span class="s1">ax2 = fig_ref.subplots()</span>
    <span class="s1">l1 = plt.Line2D([</span><span class="s3">.2</span><span class="s0">, </span><span class="s3">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">.7</span><span class="s0">, </span><span class="s3">.7</span><span class="s1">]</span><span class="s0">, </span><span class="s1">transform=fig_ref.transFigure</span><span class="s0">,</span>
                    <span class="s1">gid=</span><span class="s2">'l1'</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s3">21</span><span class="s1">)</span>
    <span class="s1">r1 = plt.Circle((</span><span class="s3">20</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s3">100</span><span class="s0">, </span><span class="s1">transform=</span><span class="s0">None, </span><span class="s1">clip_on=</span><span class="s0">False, </span><span class="s1">zorder=</span><span class="s3">20</span><span class="s0">,</span>
                    <span class="s1">gid=</span><span class="s2">'C1'</span><span class="s1">)</span>
    <span class="s1">r2 = plt.Circle((</span><span class="s3">.7</span><span class="s0">, </span><span class="s3">.5</span><span class="s1">)</span><span class="s0">, </span><span class="s3">.05</span><span class="s0">, </span><span class="s1">transform=fig_ref.transFigure</span><span class="s0">, </span><span class="s1">gid=</span><span class="s2">'C2'</span><span class="s0">,</span>
                    <span class="s1">zorder=</span><span class="s3">20</span><span class="s1">)</span>
    <span class="s1">r3 = plt.Circle((</span><span class="s3">4.5</span><span class="s0">, </span><span class="s3">.8</span><span class="s1">)</span><span class="s0">, </span><span class="s3">.55</span><span class="s0">, </span><span class="s1">transform=fig_ref.dpi_scale_trans</span><span class="s0">,</span>
                    <span class="s1">facecolor=</span><span class="s2">'crimson'</span><span class="s0">, </span><span class="s1">clip_on=</span><span class="s0">False, </span><span class="s1">zorder=</span><span class="s3">20</span><span class="s0">, </span><span class="s1">gid=</span><span class="s2">'C3'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">[l1</span><span class="s0">, </span><span class="s1">r1</span><span class="s0">, </span><span class="s1">r2</span><span class="s0">, </span><span class="s1">r3]:</span>
        <span class="s1">ax2.add_artist(a)</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;fmt&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;png&quot;</span><span class="s0">, </span><span class="s2">&quot;pdf&quot;</span><span class="s0">, </span><span class="s2">&quot;ps&quot;</span><span class="s0">, </span><span class="s2">&quot;eps&quot;</span><span class="s0">, </span><span class="s2">&quot;svg&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_fspath(fmt</span><span class="s0">, </span><span class="s1">tmpdir):</span>
    <span class="s1">out = Path(tmpdir</span><span class="s0">, </span><span class="s2">&quot;test.{}&quot;</span><span class="s1">.format(fmt))</span>
    <span class="s1">plt.savefig(out)</span>
    <span class="s0">with </span><span class="s1">out.open(</span><span class="s2">&quot;rb&quot;</span><span class="s1">) </span><span class="s0">as </span><span class="s1">file:</span>
        <span class="s4"># All the supported formats include the format name (case-insensitive)</span>
        <span class="s4"># in the first 100 bytes.</span>
        <span class="s0">assert </span><span class="s1">fmt.encode(</span><span class="s2">&quot;ascii&quot;</span><span class="s1">) </span><span class="s0">in </span><span class="s1">file.read(</span><span class="s3">100</span><span class="s1">).lower()</span>


<span class="s0">def </span><span class="s1">test_tightbbox():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.set_xlim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">t = ax.text(</span><span class="s3">1.</span><span class="s0">, </span><span class="s3">0.5</span><span class="s0">, </span><span class="s2">'This dangles over end'</span><span class="s1">)</span>
    <span class="s1">renderer = fig.canvas.get_renderer()</span>
    <span class="s1">x1Nom0 = </span><span class="s3">9.035  </span><span class="s4"># inches</span>
    <span class="s0">assert </span><span class="s1">abs(t.get_tightbbox(renderer).x1 - x1Nom0 * fig.dpi) &lt; </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">abs(ax.get_tightbbox(renderer).x1 - x1Nom0 * fig.dpi) &lt; </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">abs(fig.get_tightbbox(renderer).x1 - x1Nom0) &lt; </span><span class="s3">0.05</span>
    <span class="s0">assert </span><span class="s1">abs(fig.get_tightbbox(renderer).x0 - </span><span class="s3">0.679</span><span class="s1">) &lt; </span><span class="s3">0.05</span>
    <span class="s4"># now exclude t from the tight bbox so now the bbox is quite a bit</span>
    <span class="s4"># smaller</span>
    <span class="s1">t.set_in_layout(</span><span class="s0">False</span><span class="s1">)</span>
    <span class="s1">x1Nom = </span><span class="s3">7.333</span>
    <span class="s0">assert </span><span class="s1">abs(ax.get_tightbbox(renderer).x1 - x1Nom * fig.dpi) &lt; </span><span class="s3">2</span>
    <span class="s0">assert </span><span class="s1">abs(fig.get_tightbbox(renderer).x1 - x1Nom) &lt; </span><span class="s3">0.05</span>

    <span class="s1">t.set_in_layout(</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">x1Nom = </span><span class="s3">7.333</span>
    <span class="s0">assert </span><span class="s1">abs(ax.get_tightbbox(renderer).x1 - x1Nom0 * fig.dpi) &lt; </span><span class="s3">2</span>
    <span class="s4"># test bbox_extra_artists method...</span>
    <span class="s0">assert </span><span class="s1">abs(ax.get_tightbbox(renderer</span><span class="s0">, </span><span class="s1">bbox_extra_artists=[]).x1</span>
               <span class="s1">- x1Nom * fig.dpi) &lt; </span><span class="s3">2</span>


<span class="s0">def </span><span class="s1">test_axes_removal():</span>
    <span class="s4"># Check that units can set the formatter after an Axes removal</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s3">1</span><span class="s1">].remove()</span>
    <span class="s1">axs[</span><span class="s3">0</span><span class="s1">].plot([datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">isinstance(axs[</span><span class="s3">0</span><span class="s1">].xaxis.get_major_formatter()</span><span class="s0">,</span>
                      <span class="s1">mdates.AutoDateFormatter)</span>

    <span class="s4"># Check that manually setting the formatter, then removing Axes keeps</span>
    <span class="s4"># the set formatter.</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s3">1</span><span class="s1">].xaxis.set_major_formatter(ScalarFormatter())</span>
    <span class="s1">axs[</span><span class="s3">1</span><span class="s1">].remove()</span>
    <span class="s1">axs[</span><span class="s3">0</span><span class="s1">].plot([datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">datetime(</span><span class="s3">2000</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">isinstance(axs[</span><span class="s3">0</span><span class="s1">].xaxis.get_major_formatter()</span><span class="s0">,</span>
                      <span class="s1">ScalarFormatter)</span>


<span class="s0">def </span><span class="s1">test_removed_axis():</span>
    <span class="s4"># Simple smoke test to make sure removing a shared axis works</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">axs = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">axs[</span><span class="s3">0</span><span class="s1">].remove()</span>
    <span class="s1">fig.canvas.draw()</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s2">'clear_meth'</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'clear'</span><span class="s0">, </span><span class="s2">'clf'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_figure_clear(clear_meth):</span>
    <span class="s4"># we test the following figure clearing scenarios:</span>
    <span class="s1">fig = plt.figure()</span>

    <span class="s4"># a) an empty figure</span>
    <span class="s1">fig.clear()</span>
    <span class="s0">assert </span><span class="s1">fig.axes == []</span>

    <span class="s4"># b) a figure with a single unnested axes</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">111</span><span class="s1">)</span>
    <span class="s1">getattr(fig</span><span class="s0">, </span><span class="s1">clear_meth)()</span>
    <span class="s0">assert </span><span class="s1">fig.axes == []</span>

    <span class="s4"># c) a figure multiple unnested axes</span>
    <span class="s1">axes = [fig.add_subplot(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">i+</span><span class="s3">1</span><span class="s1">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">2</span><span class="s1">)]</span>
    <span class="s1">getattr(fig</span><span class="s0">, </span><span class="s1">clear_meth)()</span>
    <span class="s0">assert </span><span class="s1">fig.axes == []</span>

    <span class="s4"># d) a figure with a subfigure</span>
    <span class="s1">gs = fig.add_gridspec(ncols=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">nrows=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">subfig = fig.add_subfigure(gs[</span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">subaxes = subfig.add_subplot(</span><span class="s3">111</span><span class="s1">)</span>
    <span class="s1">getattr(fig</span><span class="s0">, </span><span class="s1">clear_meth)()</span>
    <span class="s0">assert </span><span class="s1">subfig </span><span class="s0">not in </span><span class="s1">fig.subfigs</span>
    <span class="s0">assert </span><span class="s1">fig.axes == []</span>

    <span class="s4"># e) a figure with a subfigure and a subplot</span>
    <span class="s1">subfig = fig.add_subfigure(gs[</span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">subaxes = subfig.add_subplot(</span><span class="s3">111</span><span class="s1">)</span>
    <span class="s1">mainaxes = fig.add_subplot(gs[</span><span class="s3">1</span><span class="s1">])</span>

    <span class="s4"># e.1) removing just the axes leaves the subplot</span>
    <span class="s1">mainaxes.remove()</span>
    <span class="s0">assert </span><span class="s1">fig.axes == [subaxes]</span>

    <span class="s4"># e.2) removing just the subaxes leaves the subplot</span>
    <span class="s4"># and subfigure</span>
    <span class="s1">mainaxes = fig.add_subplot(gs[</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">subaxes.remove()</span>
    <span class="s0">assert </span><span class="s1">fig.axes == [mainaxes]</span>
    <span class="s0">assert </span><span class="s1">subfig </span><span class="s0">in </span><span class="s1">fig.subfigs</span>

    <span class="s4"># e.3) clearing the subfigure leaves the subplot</span>
    <span class="s1">subaxes = subfig.add_subplot(</span><span class="s3">111</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">mainaxes </span><span class="s0">in </span><span class="s1">fig.axes</span>
    <span class="s0">assert </span><span class="s1">subaxes </span><span class="s0">in </span><span class="s1">fig.axes</span>
    <span class="s1">getattr(subfig</span><span class="s0">, </span><span class="s1">clear_meth)()</span>
    <span class="s0">assert </span><span class="s1">subfig </span><span class="s0">in </span><span class="s1">fig.subfigs</span>
    <span class="s0">assert </span><span class="s1">subaxes </span><span class="s0">not in </span><span class="s1">subfig.axes</span>
    <span class="s0">assert </span><span class="s1">subaxes </span><span class="s0">not in </span><span class="s1">fig.axes</span>
    <span class="s0">assert </span><span class="s1">mainaxes </span><span class="s0">in </span><span class="s1">fig.axes</span>

    <span class="s4"># e.4) clearing the whole thing</span>
    <span class="s1">subaxes = subfig.add_subplot(</span><span class="s3">111</span><span class="s1">)</span>
    <span class="s1">getattr(fig</span><span class="s0">, </span><span class="s1">clear_meth)()</span>
    <span class="s0">assert </span><span class="s1">fig.axes == []</span>
    <span class="s0">assert </span><span class="s1">fig.subfigs == []</span>

    <span class="s4"># f) multiple subfigures</span>
    <span class="s1">subfigs = [fig.add_subfigure(gs[i]) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]]</span>
    <span class="s1">subaxes = [sfig.add_subplot(</span><span class="s3">111</span><span class="s1">) </span><span class="s0">for </span><span class="s1">sfig </span><span class="s0">in </span><span class="s1">subfigs]</span>
    <span class="s0">assert </span><span class="s1">all(ax </span><span class="s0">in </span><span class="s1">fig.axes </span><span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">subaxes)</span>
    <span class="s0">assert </span><span class="s1">all(sfig </span><span class="s0">in </span><span class="s1">fig.subfigs </span><span class="s0">for </span><span class="s1">sfig </span><span class="s0">in </span><span class="s1">subfigs)</span>

    <span class="s4"># f.1) clearing only one subfigure</span>
    <span class="s1">getattr(subfigs[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">clear_meth)()</span>
    <span class="s0">assert </span><span class="s1">subaxes[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">not in </span><span class="s1">fig.axes</span>
    <span class="s0">assert </span><span class="s1">subaxes[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">in </span><span class="s1">fig.axes</span>
    <span class="s0">assert </span><span class="s1">subfigs[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">in </span><span class="s1">fig.subfigs</span>

    <span class="s4"># f.2) clearing the whole thing</span>
    <span class="s1">getattr(subfigs[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">clear_meth)()</span>
    <span class="s1">subfigs = [fig.add_subfigure(gs[i]) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]]</span>
    <span class="s1">subaxes = [sfig.add_subplot(</span><span class="s3">111</span><span class="s1">) </span><span class="s0">for </span><span class="s1">sfig </span><span class="s0">in </span><span class="s1">subfigs]</span>
    <span class="s0">assert </span><span class="s1">all(ax </span><span class="s0">in </span><span class="s1">fig.axes </span><span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">subaxes)</span>
    <span class="s0">assert </span><span class="s1">all(sfig </span><span class="s0">in </span><span class="s1">fig.subfigs </span><span class="s0">for </span><span class="s1">sfig </span><span class="s0">in </span><span class="s1">subfigs)</span>
    <span class="s1">getattr(fig</span><span class="s0">, </span><span class="s1">clear_meth)()</span>
    <span class="s0">assert </span><span class="s1">fig.subfigs == []</span>
    <span class="s0">assert </span><span class="s1">fig.axes == []</span>


<span class="s0">def </span><span class="s1">test_clf_not_redefined():</span>
    <span class="s0">for </span><span class="s1">klass </span><span class="s0">in </span><span class="s1">FigureBase.__subclasses__():</span>
        <span class="s4"># check that subclasses do not get redefined in our Figure subclasses</span>
        <span class="s0">assert </span><span class="s2">'clf' </span><span class="s0">not in </span><span class="s1">klass.__dict__</span>


<span class="s1">@mpl.style.context(</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_picking_does_not_stale():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.scatter([</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1000</span><span class="s1">]</span><span class="s0">, </span><span class="s1">picker=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert not </span><span class="s1">fig.stale</span>

    <span class="s1">mouse_event = SimpleNamespace(x=ax.bbox.x0 + ax.bbox.width / </span><span class="s3">2</span><span class="s0">,</span>
                                  <span class="s1">y=ax.bbox.y0 + ax.bbox.height / </span><span class="s3">2</span><span class="s0">,</span>
                                  <span class="s1">inaxes=ax</span><span class="s0">, </span><span class="s1">guiEvent=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">fig.pick(mouse_event)</span>
    <span class="s0">assert not </span><span class="s1">fig.stale</span>


<span class="s0">def </span><span class="s1">test_add_subplot_twotuple():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">ax1.get_subplotspec().rowspan == range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax1.get_subplotspec().colspan == range(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax2 = fig.add_subplot(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">6</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">ax2.get_subplotspec().rowspan == range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax2.get_subplotspec().colspan == range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax3 = fig.add_subplot(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">6</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">ax3.get_subplotspec().rowspan == range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax3.get_subplotspec().colspan == range(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax4 = fig.add_subplot(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">(</span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s0">assert </span><span class="s1">ax4.get_subplotspec().rowspan == range(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax4.get_subplotspec().colspan == range(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(IndexError):</span>
        <span class="s1">fig.add_subplot(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>


<span class="s1">@image_comparison([</span><span class="s2">'tightbbox_box_aspect.svg'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s2">'bbox_inches'</span><span class="s1">: </span><span class="s2">'tight'</span><span class="s0">,</span>
                                 <span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'teal'</span><span class="s1">}</span><span class="s0">,</span>
                  <span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_tightbbox_box_aspect():</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">gs = fig.add_gridspec(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax1 = fig.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">ax2 = fig.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'3d'</span><span class="s1">)</span>
    <span class="s1">ax1.set_box_aspect(</span><span class="s3">.5</span><span class="s1">)</span>
    <span class="s1">ax2.set_box_aspect((</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;svg&quot;</span><span class="s0">, </span><span class="s2">&quot;pdf&quot;</span><span class="s0">, </span><span class="s2">&quot;eps&quot;</span><span class="s0">, </span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_animated_with_canvas_change(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">ax_ref = fig_ref.subplots()</span>
    <span class="s1">ax_ref.plot(range(</span><span class="s3">5</span><span class="s1">))</span>

    <span class="s1">ax_test = fig_test.subplots()</span>
    <span class="s1">ax_test.plot(range(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">animated=</span><span class="s0">True</span><span class="s1">)</span>


<span class="s0">class </span><span class="s1">TestSubplotMosaic:</span>
    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;x&quot;</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s1">[[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">[[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s1">((</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">))</span><span class="s0">,</span>
            <span class="s1">((</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">2</span><span class="s1">))</span>
        <span class="s1">]</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_basic(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">x):</span>
        <span class="s1">grid_axes = fig_test.subplot_mosaic(x)</span>

        <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">grid_axes.items():</span>
            <span class="s1">ax.set_title(k)</span>

        <span class="s1">labels = sorted(np.unique(x))</span>

        <span class="s0">assert </span><span class="s1">len(labels) == len(grid_axes)</span>

        <span class="s1">gs = fig_ref.add_gridspec(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
        <span class="s1">axA = fig_ref.add_subplot(gs[:</span><span class="s3">1</span><span class="s0">, </span><span class="s1">:</span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">axA.set_title(labels[</span><span class="s3">0</span><span class="s1">])</span>

        <span class="s1">axB = fig_ref.add_subplot(gs[:</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>
        <span class="s1">axB.set_title(labels[</span><span class="s3">1</span><span class="s1">])</span>

        <span class="s1">axC = fig_ref.add_subplot(gs[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">axC.set_title(labels[</span><span class="s3">2</span><span class="s1">])</span>

        <span class="s1">axD = fig_ref.add_subplot(gs[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">axD.set_title(labels[</span><span class="s3">3</span><span class="s1">])</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_all_nested(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s1">x = [[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">]]</span>
        <span class="s1">y = [[</span><span class="s2">&quot;E&quot;</span><span class="s0">, </span><span class="s2">&quot;F&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;G&quot;</span><span class="s0">, </span><span class="s2">&quot;H&quot;</span><span class="s1">]]</span>

        <span class="s1">fig_ref.set_layout_engine(</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>
        <span class="s1">fig_test.set_layout_engine(</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>

        <span class="s1">grid_axes = fig_test.subplot_mosaic([[x</span><span class="s0">, </span><span class="s1">y]])</span>
        <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">grid_axes.values():</span>
            <span class="s1">ax.set_title(ax.get_label())</span>

        <span class="s1">gs = fig_ref.add_gridspec(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">gs_left = gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">].subgridspec(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">j</span><span class="s0">, </span><span class="s1">r </span><span class="s0">in </span><span class="s1">enumerate(x):</span>
            <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">enumerate(r):</span>
                <span class="s1">fig_ref.add_subplot(gs_left[j</span><span class="s0">, </span><span class="s1">k]).set_title(label)</span>

        <span class="s1">gs_right = gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">].subgridspec(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">j</span><span class="s0">, </span><span class="s1">r </span><span class="s0">in </span><span class="s1">enumerate(y):</span>
            <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">enumerate(r):</span>
                <span class="s1">fig_ref.add_subplot(gs_right[j</span><span class="s0">, </span><span class="s1">k]).set_title(label)</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_nested(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>

        <span class="s1">fig_ref.set_layout_engine(</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>
        <span class="s1">fig_test.set_layout_engine(</span><span class="s2">&quot;constrained&quot;</span><span class="s1">)</span>

        <span class="s1">x = [[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">]]</span>

        <span class="s1">y = [[</span><span class="s2">&quot;F&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[x]]</span>

        <span class="s1">grid_axes = fig_test.subplot_mosaic(y)</span>

        <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">grid_axes.items():</span>
            <span class="s1">ax.set_title(k)</span>

        <span class="s1">gs = fig_ref.add_gridspec(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

        <span class="s1">gs_n = gs[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">].subgridspec(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

        <span class="s1">axA = fig_ref.add_subplot(gs_n[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">axA.set_title(</span><span class="s2">&quot;A&quot;</span><span class="s1">)</span>

        <span class="s1">axB = fig_ref.add_subplot(gs_n[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">axB.set_title(</span><span class="s2">&quot;B&quot;</span><span class="s1">)</span>

        <span class="s1">axC = fig_ref.add_subplot(gs_n[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">axC.set_title(</span><span class="s2">&quot;C&quot;</span><span class="s1">)</span>

        <span class="s1">axD = fig_ref.add_subplot(gs_n[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">axD.set_title(</span><span class="s2">&quot;D&quot;</span><span class="s1">)</span>

        <span class="s1">axF = fig_ref.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">axF.set_title(</span><span class="s2">&quot;F&quot;</span><span class="s1">)</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_nested_tuple(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s1">x = [[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">]]</span>
        <span class="s1">xt = ((</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">))</span>

        <span class="s1">fig_ref.subplot_mosaic([[</span><span class="s2">&quot;F&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[x]])</span>
        <span class="s1">fig_test.subplot_mosaic([[</span><span class="s2">&quot;F&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[xt]])</span>

    <span class="s0">def </span><span class="s1">test_nested_width_ratios(self):</span>
        <span class="s1">x = [[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">[</span><span class="s2">&quot;C&quot;</span><span class="s1">]]]]</span>
        <span class="s1">width_ratios = [</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span>

        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axd = plt.subplot_mosaic(x</span><span class="s0">, </span><span class="s1">width_ratios=width_ratios)</span>

        <span class="s0">assert </span><span class="s1">axd[</span><span class="s2">&quot;A&quot;</span><span class="s1">].get_gridspec().get_width_ratios() == width_ratios</span>
        <span class="s0">assert </span><span class="s1">axd[</span><span class="s2">&quot;B&quot;</span><span class="s1">].get_gridspec().get_width_ratios() != width_ratios</span>

    <span class="s0">def </span><span class="s1">test_nested_height_ratios(self):</span>
        <span class="s1">x = [[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">[</span><span class="s2">&quot;C&quot;</span><span class="s1">]]]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">]]</span>
        <span class="s1">height_ratios = [</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span>

        <span class="s1">fig</span><span class="s0">, </span><span class="s1">axd = plt.subplot_mosaic(x</span><span class="s0">, </span><span class="s1">height_ratios=height_ratios)</span>

        <span class="s0">assert </span><span class="s1">axd[</span><span class="s2">&quot;D&quot;</span><span class="s1">].get_gridspec().get_height_ratios() == height_ratios</span>
        <span class="s0">assert </span><span class="s1">axd[</span><span class="s2">&quot;B&quot;</span><span class="s1">].get_gridspec().get_height_ratios() != height_ratios</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;x, empty_sentinel&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">([[</span><span class="s2">&quot;A&quot;</span><span class="s0">, None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s2">&quot;B&quot;</span><span class="s1">]]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">([[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;.&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;.&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">&quot;SKIP&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">([[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]]</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">([[</span><span class="s3">1</span><span class="s0">, None</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, None</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">([[</span><span class="s3">1</span><span class="s0">, </span><span class="s2">&quot;.&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;.&quot;</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s2">&quot;SKIP&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">([[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_empty(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">empty_sentinel):</span>
        <span class="s0">if </span><span class="s1">empty_sentinel != </span><span class="s2">&quot;SKIP&quot;</span><span class="s1">:</span>
            <span class="s1">kwargs = {</span><span class="s2">&quot;empty_sentinel&quot;</span><span class="s1">: empty_sentinel}</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">kwargs = {}</span>
        <span class="s1">grid_axes = fig_test.subplot_mosaic(x</span><span class="s0">, </span><span class="s1">**kwargs)</span>

        <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">grid_axes.items():</span>
            <span class="s1">ax.set_title(k)</span>

        <span class="s1">labels = sorted(</span>
            <span class="s1">{name </span><span class="s0">for </span><span class="s1">row </span><span class="s0">in </span><span class="s1">x </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">row} - {empty_sentinel</span><span class="s0">, </span><span class="s2">&quot;.&quot;</span><span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s0">assert </span><span class="s1">len(labels) == len(grid_axes)</span>

        <span class="s1">gs = fig_ref.add_gridspec(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">axA = fig_ref.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">axA.set_title(labels[</span><span class="s3">0</span><span class="s1">])</span>

        <span class="s1">axB = fig_ref.add_subplot(gs[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">axB.set_title(labels[</span><span class="s3">1</span><span class="s1">])</span>

    <span class="s0">def </span><span class="s1">test_fail_list_of_str(self):</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'must be 2D'</span><span class="s1">):</span>
            <span class="s1">plt.subplot_mosaic([</span><span class="s2">'foo'</span><span class="s0">, </span><span class="s2">'bar'</span><span class="s1">])</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'must be 2D'</span><span class="s1">):</span>
            <span class="s1">plt.subplot_mosaic([</span><span class="s2">'foo'</span><span class="s1">])</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'must be 2D'</span><span class="s1">):</span>
            <span class="s1">plt.subplot_mosaic([[</span><span class="s2">'foo'</span><span class="s0">, </span><span class="s1">(</span><span class="s2">'bar'</span><span class="s0">,</span><span class="s1">)]])</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">'must be 2D'</span><span class="s1">):</span>
            <span class="s1">plt.subplot_mosaic([[</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[(</span><span class="s2">'a'</span><span class="s0">, </span><span class="s2">'b'</span><span class="s1">)</span><span class="s0">, </span><span class="s2">'c'</span><span class="s1">]])</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;subplot_kw&quot;</span><span class="s0">, </span><span class="s1">[{}</span><span class="s0">, </span><span class="s1">{</span><span class="s2">&quot;projection&quot;</span><span class="s1">: </span><span class="s2">&quot;polar&quot;</span><span class="s1">}</span><span class="s0">, None</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_subplot_kw(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">subplot_kw):</span>
        <span class="s1">x = [[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]]</span>
        <span class="s1">grid_axes = fig_test.subplot_mosaic(x</span><span class="s0">, </span><span class="s1">subplot_kw=subplot_kw)</span>
        <span class="s1">subplot_kw = subplot_kw </span><span class="s0">or </span><span class="s1">{}</span>

        <span class="s1">gs = fig_ref.add_gridspec(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s1">axA = fig_ref.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">**subplot_kw)</span>

        <span class="s1">axB = fig_ref.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">**subplot_kw)</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;multi_value&quot;</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'BC'</span><span class="s0">, </span><span class="s1">tuple(</span><span class="s2">'BC'</span><span class="s1">)])</span>
    <span class="s0">def </span><span class="s1">test_per_subplot_kw(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">multi_value):</span>
        <span class="s1">x = </span><span class="s2">'AB;CD'</span>
        <span class="s1">grid_axes = fig_test.subplot_mosaic(</span>
            <span class="s1">x</span><span class="s0">,</span>
            <span class="s1">subplot_kw={</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'red'</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">per_subplot_kw={</span>
                <span class="s2">'D'</span><span class="s1">: {</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'blue'</span><span class="s1">}</span><span class="s0">,</span>
                <span class="s1">multi_value: {</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'green'</span><span class="s1">}</span><span class="s0">,</span>
            <span class="s1">}</span>
        <span class="s1">)</span>

        <span class="s1">gs = fig_ref.add_gridspec(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">color</span><span class="s0">, </span><span class="s1">spec </span><span class="s0">in </span><span class="s1">zip([</span><span class="s2">'red'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'green'</span><span class="s0">, </span><span class="s2">'blue'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gs):</span>
            <span class="s1">fig_ref.add_subplot(spec</span><span class="s0">, </span><span class="s1">facecolor=color)</span>

    <span class="s0">def </span><span class="s1">test_string_parser(self):</span>
        <span class="s1">normalize = Figure._normalize_grid_string</span>

        <span class="s0">assert </span><span class="s1">normalize(</span><span class="s2">'ABC'</span><span class="s1">) == [[</span><span class="s2">'A'</span><span class="s0">, </span><span class="s2">'B'</span><span class="s0">, </span><span class="s2">'C'</span><span class="s1">]]</span>
        <span class="s0">assert </span><span class="s1">normalize(</span><span class="s2">'AB;CC'</span><span class="s1">) == [[</span><span class="s2">'A'</span><span class="s0">, </span><span class="s2">'B'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'C'</span><span class="s0">, </span><span class="s2">'C'</span><span class="s1">]]</span>
        <span class="s0">assert </span><span class="s1">normalize(</span><span class="s2">'AB;CC;DE'</span><span class="s1">) == [[</span><span class="s2">'A'</span><span class="s0">, </span><span class="s2">'B'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'C'</span><span class="s0">, </span><span class="s2">'C'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'D'</span><span class="s0">, </span><span class="s2">'E'</span><span class="s1">]]</span>
        <span class="s0">assert </span><span class="s1">normalize(</span><span class="s2">&quot;&quot;&quot; 
                         ABC 
                         &quot;&quot;&quot;</span><span class="s1">) == [[</span><span class="s2">'A'</span><span class="s0">, </span><span class="s2">'B'</span><span class="s0">, </span><span class="s2">'C'</span><span class="s1">]]</span>
        <span class="s0">assert </span><span class="s1">normalize(</span><span class="s2">&quot;&quot;&quot; 
                         AB 
                         CC 
                         &quot;&quot;&quot;</span><span class="s1">) == [[</span><span class="s2">'A'</span><span class="s0">, </span><span class="s2">'B'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'C'</span><span class="s0">, </span><span class="s2">'C'</span><span class="s1">]]</span>
        <span class="s0">assert </span><span class="s1">normalize(</span><span class="s2">&quot;&quot;&quot; 
                         AB 
                         CC 
                         DE 
                         &quot;&quot;&quot;</span><span class="s1">) == [[</span><span class="s2">'A'</span><span class="s0">, </span><span class="s2">'B'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'C'</span><span class="s0">, </span><span class="s2">'C'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">'D'</span><span class="s0">, </span><span class="s2">'E'</span><span class="s1">]]</span>

    <span class="s0">def </span><span class="s1">test_per_subplot_kw_expander(self):</span>
        <span class="s1">normalize = Figure._norm_per_subplot_kw</span>
        <span class="s0">assert </span><span class="s1">normalize({</span><span class="s2">&quot;A&quot;</span><span class="s1">: {}</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: {}}) == {</span><span class="s2">&quot;A&quot;</span><span class="s1">: {}</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: {}}</span>
        <span class="s0">assert </span><span class="s1">normalize({(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">): {}}) == {</span><span class="s2">&quot;A&quot;</span><span class="s1">: {}</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: {}}</span>
        <span class="s0">with </span><span class="s1">pytest.raises(</span>
                <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">f'The key </span><span class="s0">{</span><span class="s2">&quot;B&quot;</span><span class="s0">!r} </span><span class="s2">appears multiple times'</span>
        <span class="s1">):</span>
            <span class="s1">normalize({(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">): {}</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">: {}})</span>
        <span class="s0">with </span><span class="s1">pytest.raises(</span>
                <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">f'The key </span><span class="s0">{</span><span class="s2">&quot;B&quot;</span><span class="s0">!r} </span><span class="s2">appears multiple times'</span>
        <span class="s1">):</span>
            <span class="s1">normalize({</span><span class="s2">&quot;B&quot;</span><span class="s1">: {}</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">): {}})</span>

    <span class="s0">def </span><span class="s1">test_extra_per_subplot_kw(self):</span>
        <span class="s0">with </span><span class="s1">pytest.raises(</span>
                <span class="s1">ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s2">f'The keys </span><span class="s0">{</span><span class="s1">set(</span><span class="s2">&quot;B&quot;</span><span class="s1">)</span><span class="s0">!r} </span><span class="s2">are in'</span>
        <span class="s1">):</span>
            <span class="s1">Figure().subplot_mosaic(</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s1">per_subplot_kw={</span><span class="s2">&quot;B&quot;</span><span class="s1">: {}})</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">&quot;str_pattern&quot;</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">&quot;AAA</span><span class="s0">\n</span><span class="s2">BBB&quot;</span><span class="s0">, </span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">AAA</span><span class="s0">\n</span><span class="s2">BBB</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s0">, </span><span class="s2">&quot;ABC</span><span class="s0">\n</span><span class="s2">DEF&quot;</span><span class="s1">]</span>
                             <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_single_str_input(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref</span><span class="s0">, </span><span class="s1">str_pattern):</span>
        <span class="s1">grid_axes = fig_test.subplot_mosaic(str_pattern)</span>

        <span class="s1">grid_axes = fig_ref.subplot_mosaic(</span>
            <span class="s1">[list(ln) </span><span class="s0">for </span><span class="s1">ln </span><span class="s0">in </span><span class="s1">str_pattern.strip().split(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s1">)]</span>
        <span class="s1">)</span>

    <span class="s1">@pytest.mark.parametrize(</span>
        <span class="s2">&quot;x,match&quot;</span><span class="s0">,</span>
        <span class="s1">[</span>
            <span class="s1">(</span>
                <span class="s1">[[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;.&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;.&quot;</span><span class="s0">, </span><span class="s2">&quot;A&quot;</span><span class="s1">]]</span><span class="s0">,</span>
                <span class="s1">(</span>
                    <span class="s2">&quot;(?m)we found that the label .A. specifies a &quot;</span>
                    <span class="s1">+ </span><span class="s2">&quot;non-rectangular or non-contiguous area.&quot;</span>
                <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">[[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s0">None, </span><span class="s1">[[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;C&quot;</span><span class="s0">, </span><span class="s2">&quot;D&quot;</span><span class="s1">]]]]</span><span class="s0">,</span>
                <span class="s2">&quot;There are duplicate keys .* between the outer layout&quot;</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span><span class="s2">&quot;AAA</span><span class="s0">\n</span><span class="s2">c</span><span class="s0">\n</span><span class="s2">BBB&quot;</span><span class="s0">, </span><span class="s2">&quot;All of the rows must be the same length&quot;</span><span class="s1">)</span><span class="s0">,</span>
            <span class="s1">(</span>
                <span class="s1">[[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s1">]]]</span><span class="s0">, </span><span class="s1">[</span><span class="s2">&quot;E&quot;</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s1">]]</span><span class="s0">,</span>
                <span class="s2">&quot;All of the rows must be the same length&quot;</span><span class="s0">,</span>
            <span class="s1">)</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">,</span>
    <span class="s1">)</span>
    <span class="s0">def </span><span class="s1">test_fail(self</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">match):</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=match):</span>
            <span class="s1">fig.subplot_mosaic(x)</span>

    <span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_hashable_keys(self</span><span class="s0">, </span><span class="s1">fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
        <span class="s1">fig_test.subplot_mosaic([[object()</span><span class="s0">, </span><span class="s1">object()]])</span>
        <span class="s1">fig_ref.subplot_mosaic([[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s2">&quot;B&quot;</span><span class="s1">]])</span>

    <span class="s1">@pytest.mark.parametrize(</span><span class="s2">'str_pattern'</span><span class="s0">,</span>
                             <span class="s1">[</span><span class="s2">'abc'</span><span class="s0">, </span><span class="s2">'cab'</span><span class="s0">, </span><span class="s2">'bca'</span><span class="s0">, </span><span class="s2">'cba'</span><span class="s0">, </span><span class="s2">'acb'</span><span class="s0">, </span><span class="s2">'bac'</span><span class="s1">])</span>
    <span class="s0">def </span><span class="s1">test_user_order(self</span><span class="s0">, </span><span class="s1">str_pattern):</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax_dict = fig.subplot_mosaic(str_pattern)</span>
        <span class="s0">assert </span><span class="s1">list(str_pattern) == list(ax_dict)</span>
        <span class="s0">assert </span><span class="s1">list(fig.axes) == list(ax_dict.values())</span>

    <span class="s0">def </span><span class="s1">test_nested_user_order(self):</span>
        <span class="s1">layout = [</span>
            <span class="s1">[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s1">]]]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;F&quot;</span><span class="s0">, </span><span class="s2">&quot;G&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;.&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;I&quot;</span><span class="s1">]</span><span class="s0">,</span>
                          <span class="s1">[</span><span class="s2">&quot;.&quot;</span><span class="s1">]]]]]</span>
        <span class="s1">]</span>

        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax_dict = fig.subplot_mosaic(layout)</span>
        <span class="s0">assert </span><span class="s1">list(ax_dict) == list(</span><span class="s2">&quot;ABCDEFGHI&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">list(fig.axes) == list(ax_dict.values())</span>

    <span class="s0">def </span><span class="s1">test_share_all(self):</span>
        <span class="s1">layout = [</span>
            <span class="s1">[</span><span class="s2">&quot;A&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;B&quot;</span><span class="s0">, </span><span class="s2">&quot;C&quot;</span><span class="s1">]</span><span class="s0">,</span>
                   <span class="s1">[</span><span class="s2">&quot;D&quot;</span><span class="s0">, </span><span class="s2">&quot;E&quot;</span><span class="s1">]]]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;F&quot;</span><span class="s0">, </span><span class="s2">&quot;G&quot;</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s1">[</span><span class="s2">&quot;.&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;H&quot;</span><span class="s0">, </span><span class="s1">[[</span><span class="s2">&quot;I&quot;</span><span class="s1">]</span><span class="s0">,</span>
                          <span class="s1">[</span><span class="s2">&quot;.&quot;</span><span class="s1">]]]]]</span>
        <span class="s1">]</span>
        <span class="s1">fig = plt.figure()</span>
        <span class="s1">ax_dict = fig.subplot_mosaic(layout</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">ax_dict[</span><span class="s2">&quot;A&quot;</span><span class="s1">].set(xscale=</span><span class="s2">&quot;log&quot;</span><span class="s0">, </span><span class="s1">yscale=</span><span class="s2">&quot;logit&quot;</span><span class="s1">)</span>
        <span class="s0">assert </span><span class="s1">all(ax.get_xscale() == </span><span class="s2">&quot;log&quot; </span><span class="s0">and </span><span class="s1">ax.get_yscale() == </span><span class="s2">&quot;logit&quot;</span>
                   <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">ax_dict.values())</span>


<span class="s0">def </span><span class="s1">test_reused_gridspec():</span>
    <span class="s5">&quot;&quot;&quot;Test that these all use the same gridspec&quot;&quot;&quot;</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">5</span><span class="s1">))</span>
    <span class="s1">ax2 = fig.add_subplot(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">4</span><span class="s1">)</span>
    <span class="s1">ax3 = plt.subplot2grid((</span><span class="s3">3</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">colspan=</span><span class="s3">2</span><span class="s0">, </span><span class="s1">fig=fig)</span>

    <span class="s1">gs1 = ax1.get_subplotspec().get_gridspec()</span>
    <span class="s1">gs2 = ax2.get_subplotspec().get_gridspec()</span>
    <span class="s1">gs3 = ax3.get_subplotspec().get_gridspec()</span>

    <span class="s0">assert </span><span class="s1">gs1 == gs2</span>
    <span class="s0">assert </span><span class="s1">gs1 == gs3</span>


<span class="s1">@image_comparison([</span><span class="s2">'test_subfigure.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'teal'</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_subfigure():</span>
    <span class="s1">np.random.seed(</span><span class="s3">19680801</span><span class="s1">)</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s2">'constrained'</span><span class="s1">)</span>
    <span class="s1">sub = fig.subfigures(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">axs = sub[</span><span class="s3">0</span><span class="s1">].subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vmin=-</span><span class="s3">2</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">sub[</span><span class="s3">0</span><span class="s1">].colorbar(pc</span><span class="s0">, </span><span class="s1">ax=axs)</span>
    <span class="s1">sub[</span><span class="s3">0</span><span class="s1">].suptitle(</span><span class="s2">'Left Side'</span><span class="s1">)</span>

    <span class="s1">axs = sub[</span><span class="s3">1</span><span class="s1">].subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vmin=-</span><span class="s3">2</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">sub[</span><span class="s3">1</span><span class="s1">].colorbar(pc</span><span class="s0">, </span><span class="s1">ax=axs</span><span class="s0">, </span><span class="s1">location=</span><span class="s2">'bottom'</span><span class="s1">)</span>
    <span class="s1">sub[</span><span class="s3">1</span><span class="s1">].suptitle(</span><span class="s2">'Right Side'</span><span class="s1">)</span>

    <span class="s1">fig.suptitle(</span><span class="s2">'Figure suptitle'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">'xx-large'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_subfigure_tightbbox():</span>
    <span class="s4"># test that we can get the tightbbox with a subfigure...</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s2">'constrained'</span><span class="s1">)</span>
    <span class="s1">sub = fig.subfigures(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">np.testing.assert_allclose(</span>
            <span class="s1">fig.get_tightbbox(fig.canvas.get_renderer()).width</span><span class="s0">,</span>
            <span class="s3">8.0</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_subfigure_dpi():</span>
    <span class="s1">fig = plt.figure(dpi=</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">sub_fig = fig.subfigures()</span>
    <span class="s0">assert </span><span class="s1">sub_fig.get_dpi() == fig.get_dpi()</span>

    <span class="s1">sub_fig.set_dpi(</span><span class="s3">200</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">sub_fig.get_dpi() == </span><span class="s3">200</span>
    <span class="s0">assert </span><span class="s1">fig.get_dpi() == </span><span class="s3">200</span>


<span class="s1">@image_comparison([</span><span class="s2">'test_subfigure_ss.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'teal'</span><span class="s1">}</span><span class="s0">, </span><span class="s1">tol=</span><span class="s3">0.02</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_subfigure_ss():</span>
    <span class="s4"># test assigning the subfigure via subplotspec</span>
    <span class="s1">np.random.seed(</span><span class="s3">19680801</span><span class="s1">)</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s2">'constrained'</span><span class="s1">)</span>
    <span class="s1">gs = fig.add_gridspec(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">sub = fig.add_subfigure(gs[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s2">'pink'</span><span class="s1">)</span>

    <span class="s1">axs = sub.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs.flat:</span>
        <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vmin=-</span><span class="s3">2</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">sub.colorbar(pc</span><span class="s0">, </span><span class="s1">ax=axs)</span>
    <span class="s1">sub.suptitle(</span><span class="s2">'Left Side'</span><span class="s1">)</span>

    <span class="s1">ax = fig.add_subplot(gs[</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax.plot(np.arange(</span><span class="s3">20</span><span class="s1">))</span>
    <span class="s1">ax.set_title(</span><span class="s2">'Axes'</span><span class="s1">)</span>

    <span class="s1">fig.suptitle(</span><span class="s2">'Figure suptitle'</span><span class="s0">, </span><span class="s1">fontsize=</span><span class="s2">'xx-large'</span><span class="s1">)</span>


<span class="s1">@image_comparison([</span><span class="s2">'test_subfigure_double.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                  <span class="s1">savefig_kwarg={</span><span class="s2">'facecolor'</span><span class="s1">: </span><span class="s2">'teal'</span><span class="s1">})</span>
<span class="s0">def </span><span class="s1">test_subfigure_double():</span>
    <span class="s4"># test assigning the subfigure via subplotspec</span>
    <span class="s1">np.random.seed(</span><span class="s3">19680801</span><span class="s1">)</span>

    <span class="s1">fig = plt.figure(layout=</span><span class="s2">'constrained'</span><span class="s0">, </span><span class="s1">figsize=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">8</span><span class="s1">))</span>

    <span class="s1">fig.suptitle(</span><span class="s2">'fig'</span><span class="s1">)</span>

    <span class="s1">subfigs = fig.subfigures(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">wspace=</span><span class="s3">0.07</span><span class="s1">)</span>

    <span class="s1">subfigs[</span><span class="s3">0</span><span class="s1">].set_facecolor(</span><span class="s2">'coral'</span><span class="s1">)</span>
    <span class="s1">subfigs[</span><span class="s3">0</span><span class="s1">].suptitle(</span><span class="s2">'subfigs[0]'</span><span class="s1">)</span>

    <span class="s1">subfigs[</span><span class="s3">1</span><span class="s1">].set_facecolor(</span><span class="s2">'coral'</span><span class="s1">)</span>
    <span class="s1">subfigs[</span><span class="s3">1</span><span class="s1">].suptitle(</span><span class="s2">'subfigs[1]'</span><span class="s1">)</span>

    <span class="s1">subfigsnest = subfigs[</span><span class="s3">0</span><span class="s1">].subfigures(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">height_ratios=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1.4</span><span class="s1">])</span>
    <span class="s1">subfigsnest[</span><span class="s3">0</span><span class="s1">].suptitle(</span><span class="s2">'subfigsnest[0]'</span><span class="s1">)</span>
    <span class="s1">subfigsnest[</span><span class="s3">0</span><span class="s1">].set_facecolor(</span><span class="s2">'r'</span><span class="s1">)</span>
    <span class="s1">axsnest0 = subfigsnest[</span><span class="s3">0</span><span class="s1">].subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axsnest0:</span>
        <span class="s1">fontsize = </span><span class="s3">12</span>
        <span class="s1">pc = ax.pcolormesh(np.random.randn(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">, </span><span class="s1">vmin=-</span><span class="s3">2.5</span><span class="s0">, </span><span class="s1">vmax=</span><span class="s3">2.5</span><span class="s1">)</span>
        <span class="s1">ax.set_xlabel(</span><span class="s2">'x-label'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>
        <span class="s1">ax.set_ylabel(</span><span class="s2">'y-label'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>
        <span class="s1">ax.set_title(</span><span class="s2">'Title'</span><span class="s0">, </span><span class="s1">fontsize=fontsize)</span>

    <span class="s1">subfigsnest[</span><span class="s3">0</span><span class="s1">].colorbar(pc</span><span class="s0">, </span><span class="s1">ax=axsnest0)</span>

    <span class="s1">subfigsnest[</span><span class="s3">1</span><span class="s1">].suptitle(</span><span class="s2">'subfigsnest[1]'</span><span class="s1">)</span>
    <span class="s1">subfigsnest[</span><span class="s3">1</span><span class="s1">].set_facecolor(</span><span class="s2">'g'</span><span class="s1">)</span>
    <span class="s1">axsnest1 = subfigsnest[</span><span class="s3">1</span><span class="s1">].subplots(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s0">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate(axsnest1):</span>
        <span class="s1">ax.set_ylabel(</span><span class="s2">f'ylabel</span><span class="s0">{</span><span class="s1">nn</span><span class="s0">}</span><span class="s2">'</span><span class="s1">)</span>
    <span class="s1">subfigsnest[</span><span class="s3">1</span><span class="s1">].supxlabel(</span><span class="s2">'supxlabel'</span><span class="s1">)</span>
    <span class="s1">subfigsnest[</span><span class="s3">1</span><span class="s1">].supylabel(</span><span class="s2">'supylabel'</span><span class="s1">)</span>

    <span class="s1">axsRight = subfigs[</span><span class="s3">1</span><span class="s1">].subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_subfigure_spanning():</span>
    <span class="s4"># test that subfigures get laid out properly...</span>
    <span class="s1">fig = plt.figure(constrained_layout=</span><span class="s0">True</span><span class="s1">)</span>
    <span class="s1">gs = fig.add_gridspec(</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>
    <span class="s1">sub_figs = [</span>
        <span class="s1">fig.add_subfigure(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">fig.add_subfigure(gs[</span><span class="s3">0</span><span class="s1">:</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">fig.add_subfigure(gs[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">:</span><span class="s3">3</span><span class="s1">])</span><span class="s0">,</span>
        <span class="s1">fig.add_subfigure(gs[</span><span class="s3">0</span><span class="s1">:</span><span class="s0">, </span><span class="s3">1</span><span class="s1">:])</span>
    <span class="s1">]</span>

    <span class="s1">w = </span><span class="s3">640</span>
    <span class="s1">h = </span><span class="s3">480</span>
    <span class="s1">np.testing.assert_allclose(sub_figs[</span><span class="s3">0</span><span class="s1">].bbox.min</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0.</span><span class="s0">, </span><span class="s1">h * </span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">np.testing.assert_allclose(sub_figs[</span><span class="s3">0</span><span class="s1">].bbox.max</span><span class="s0">, </span><span class="s1">[w / </span><span class="s3">3</span><span class="s0">, </span><span class="s1">h])</span>

    <span class="s1">np.testing.assert_allclose(sub_figs[</span><span class="s3">1</span><span class="s1">].bbox.min</span><span class="s0">, </span><span class="s1">[w / </span><span class="s3">3</span><span class="s0">, </span><span class="s1">h / </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">np.testing.assert_allclose(sub_figs[</span><span class="s3">1</span><span class="s1">].bbox.max</span><span class="s0">, </span><span class="s1">[w * </span><span class="s3">2</span><span class="s1">/</span><span class="s3">3</span><span class="s0">, </span><span class="s1">h])</span>

    <span class="s1">np.testing.assert_allclose(sub_figs[</span><span class="s3">2</span><span class="s1">].bbox.min</span><span class="s0">, </span><span class="s1">[w / </span><span class="s3">3</span><span class="s0">, </span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">np.testing.assert_allclose(sub_figs[</span><span class="s3">2</span><span class="s1">].bbox.max</span><span class="s0">, </span><span class="s1">[w</span><span class="s0">, </span><span class="s1">h / </span><span class="s3">3</span><span class="s1">])</span>

    <span class="s4"># check here that slicing actually works.  Last sub_fig</span>
    <span class="s4"># with open slices failed, but only on draw...</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(</span><span class="s3">4</span><span class="s1">):</span>
        <span class="s1">sub_figs[i].add_subplot()</span>
    <span class="s1">fig.draw_without_rendering()</span>


<span class="s1">@mpl.style.context(</span><span class="s2">'mpl20'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_subfigure_ticks():</span>
    <span class="s4"># This tests a tick-spacing error that only seems applicable</span>
    <span class="s4"># when the subfigures are saved to file.  It is very hard to replicate</span>
    <span class="s1">fig = plt.figure(constrained_layout=</span><span class="s0">True, </span><span class="s1">figsize=(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
    <span class="s4"># create left/right subfigs nested in bottom subfig</span>
    <span class="s1">(subfig_bl</span><span class="s0">, </span><span class="s1">subfig_br) = fig.subfigures(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">wspace=</span><span class="s3">0.01</span><span class="s0">,</span>
                                            <span class="s1">width_ratios=[</span><span class="s3">7</span><span class="s0">, </span><span class="s3">2</span><span class="s1">])</span>

    <span class="s4"># put ax1-ax3 in gridspec of bottom-left subfig</span>
    <span class="s1">gs = subfig_bl.add_gridspec(nrows=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">ncols=</span><span class="s3">14</span><span class="s1">)</span>

    <span class="s1">ax1 = subfig_bl.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s1">:</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax1.scatter(x=[-</span><span class="s3">56.46881504821776</span><span class="s0">, </span><span class="s3">24.179891162109396</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s3">1500</span><span class="s0">, </span><span class="s3">3600</span><span class="s1">])</span>

    <span class="s1">ax2 = subfig_bl.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">:</span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">sharey=ax1)</span>
    <span class="s1">ax2.scatter(x=[-</span><span class="s3">126.5357270050049</span><span class="s0">, </span><span class="s3">94.68456736755368</span><span class="s1">]</span><span class="s0">, </span><span class="s1">y=[</span><span class="s3">1500</span><span class="s0">, </span><span class="s3">3600</span><span class="s1">])</span>
    <span class="s1">ax3 = subfig_bl.add_subplot(gs[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">3</span><span class="s1">:</span><span class="s3">14</span><span class="s1">]</span><span class="s0">, </span><span class="s1">sharey=ax1)</span>

    <span class="s1">fig.dpi = </span><span class="s3">120</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">ticks120 = ax2.get_xticks()</span>
    <span class="s1">fig.dpi = </span><span class="s3">300</span>
    <span class="s1">fig.draw_without_rendering()</span>
    <span class="s1">ticks300 = ax2.get_xticks()</span>
    <span class="s1">np.testing.assert_allclose(ticks120</span><span class="s0">, </span><span class="s1">ticks300)</span>


<span class="s1">@image_comparison([</span><span class="s2">'test_subfigure_scatter_size.png'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">style=</span><span class="s2">'mpl20'</span><span class="s0">,</span>
                   <span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_subfigure_scatter_size():</span>
    <span class="s4"># markers in the left- and right-most subplots should be the same</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">gs = fig.add_gridspec(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">ax0 = fig.add_subplot(gs[</span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax0.scatter([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">30</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'s'</span><span class="s1">)</span>
    <span class="s1">ax0.scatter([</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=[</span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">40</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'s'</span><span class="s1">)</span>

    <span class="s1">sfig = fig.add_subfigure(gs[</span><span class="s3">0</span><span class="s1">])</span>
    <span class="s1">axs = sfig.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">[ax0</span><span class="s0">, </span><span class="s1">axs[</span><span class="s3">0</span><span class="s1">]]:</span>
        <span class="s1">ax.scatter([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=</span><span class="s3">30</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'s'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'r'</span><span class="s1">)</span>
        <span class="s1">ax.scatter([</span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s3">5</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">s=[</span><span class="s3">20</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s3">40</span><span class="s1">]</span><span class="s0">, </span><span class="s1">marker=</span><span class="s2">'s'</span><span class="s0">, </span><span class="s1">color=</span><span class="s2">'g'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_subfigure_pdf():</span>
    <span class="s1">fig = plt.figure(layout=</span><span class="s2">'constrained'</span><span class="s1">)</span>
    <span class="s1">sub_fig = fig.subfigures()</span>
    <span class="s1">ax = sub_fig.add_subplot(</span><span class="s3">111</span><span class="s1">)</span>
    <span class="s1">b = ax.bar(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax.bar_label(b)</span>
    <span class="s1">buffer = io.BytesIO()</span>
    <span class="s1">fig.savefig(buffer</span><span class="s0">, </span><span class="s1">format=</span><span class="s2">'pdf'</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_add_subplot_kwargs():</span>
    <span class="s4"># fig.add_subplot() always creates new axes, even if axes kwargs differ.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax </span><span class="s0">is not None</span>
    <span class="s0">assert </span><span class="s1">ax1 </span><span class="s0">is not </span><span class="s1">ax</span>
    <span class="s1">plt.close()</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'polar'</span><span class="s1">)</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'polar'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax </span><span class="s0">is not None</span>
    <span class="s0">assert </span><span class="s1">ax1 </span><span class="s0">is not </span><span class="s1">ax</span>
    <span class="s1">plt.close()</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'polar'</span><span class="s1">)</span>
    <span class="s1">ax1 = fig.add_subplot(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax </span><span class="s0">is not None</span>
    <span class="s0">assert </span><span class="s1">ax1.name == </span><span class="s2">'rectilinear'</span>
    <span class="s0">assert </span><span class="s1">ax1 </span><span class="s0">is not </span><span class="s1">ax</span>
    <span class="s1">plt.close()</span>


<span class="s0">def </span><span class="s1">test_add_axes_kwargs():</span>
    <span class="s4"># fig.add_axes() always creates new axes, even if axes kwargs differ.</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax1 = fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax </span><span class="s0">is not None</span>
    <span class="s0">assert </span><span class="s1">ax1 </span><span class="s0">is not </span><span class="s1">ax</span>
    <span class="s1">plt.close()</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'polar'</span><span class="s1">)</span>
    <span class="s1">ax1 = fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'polar'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax </span><span class="s0">is not None</span>
    <span class="s0">assert </span><span class="s1">ax1 </span><span class="s0">is not </span><span class="s1">ax</span>
    <span class="s1">plt.close()</span>

    <span class="s1">fig = plt.figure()</span>
    <span class="s1">ax = fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">projection=</span><span class="s2">'polar'</span><span class="s1">)</span>
    <span class="s1">ax1 = fig.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s0">assert </span><span class="s1">ax </span><span class="s0">is not None</span>
    <span class="s0">assert </span><span class="s1">ax1.name == </span><span class="s2">'rectilinear'</span>
    <span class="s0">assert </span><span class="s1">ax1 </span><span class="s0">is not </span><span class="s1">ax</span>
    <span class="s1">plt.close()</span>


<span class="s0">def </span><span class="s1">test_ginput(recwarn):  </span><span class="s4"># recwarn undoes warn filters at exit.</span>
    <span class="s1">warnings.filterwarnings(</span><span class="s2">&quot;ignore&quot;</span><span class="s0">, </span><span class="s2">&quot;cannot show the figure&quot;</span><span class="s1">)</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>

    <span class="s0">def </span><span class="s1">single_press():</span>
        <span class="s1">fig.canvas.button_press_event(*ax.transData.transform((</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">.2</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s1">Timer(</span><span class="s3">.1</span><span class="s0">, </span><span class="s1">single_press).start()</span>
    <span class="s0">assert </span><span class="s1">fig.ginput() == [(</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">.2</span><span class="s1">)]</span>

    <span class="s0">def </span><span class="s1">multi_presses():</span>
        <span class="s1">fig.canvas.button_press_event(*ax.transData.transform((</span><span class="s3">.1</span><span class="s0">, </span><span class="s3">.2</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">fig.canvas.key_press_event(</span><span class="s2">&quot;backspace&quot;</span><span class="s1">)</span>
        <span class="s1">fig.canvas.button_press_event(*ax.transData.transform((</span><span class="s3">.3</span><span class="s0">, </span><span class="s3">.4</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">fig.canvas.button_press_event(*ax.transData.transform((</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.6</span><span class="s1">))</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">fig.canvas.button_press_event(*ax.transData.transform((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">Timer(</span><span class="s3">.1</span><span class="s0">, </span><span class="s1">multi_presses).start()</span>
    <span class="s1">np.testing.assert_allclose(fig.ginput(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">, </span><span class="s1">[(</span><span class="s3">.3</span><span class="s0">, </span><span class="s3">.4</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">.5</span><span class="s0">, </span><span class="s3">.6</span><span class="s1">)])</span>


<span class="s0">def </span><span class="s1">test_waitforbuttonpress(recwarn):  </span><span class="s4"># recwarn undoes warn filters at exit.</span>
    <span class="s1">warnings.filterwarnings(</span><span class="s2">&quot;ignore&quot;</span><span class="s0">, </span><span class="s2">&quot;cannot show the figure&quot;</span><span class="s1">)</span>
    <span class="s1">fig = plt.figure()</span>
    <span class="s0">assert </span><span class="s1">fig.waitforbuttonpress(timeout=</span><span class="s3">.1</span><span class="s1">) </span><span class="s0">is None</span>
    <span class="s1">Timer(</span><span class="s3">.1</span><span class="s0">, </span><span class="s1">fig.canvas.key_press_event</span><span class="s0">, </span><span class="s1">(</span><span class="s2">&quot;z&quot;</span><span class="s0">,</span><span class="s1">)).start()</span>
    <span class="s0">assert </span><span class="s1">fig.waitforbuttonpress() </span><span class="s0">is True</span>
    <span class="s1">Timer(</span><span class="s3">.1</span><span class="s0">, </span><span class="s1">fig.canvas.button_press_event</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)).start()</span>
    <span class="s0">assert </span><span class="s1">fig.waitforbuttonpress() </span><span class="s0">is False</span>


<span class="s0">def </span><span class="s1">test_kwargs_pass():</span>
    <span class="s1">fig = Figure(label=</span><span class="s2">'whole Figure'</span><span class="s1">)</span>
    <span class="s1">sub_fig = fig.subfigures(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s1">label=</span><span class="s2">'sub figure'</span><span class="s1">)</span>

    <span class="s0">assert </span><span class="s1">fig.get_label() == </span><span class="s2">'whole Figure'</span>
    <span class="s0">assert </span><span class="s1">sub_fig.get_label() == </span><span class="s2">'sub figure'</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s2">&quot;png&quot;</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_rcparams(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s1">fig_ref.supxlabel(</span><span class="s2">&quot;xlabel&quot;</span><span class="s0">, </span><span class="s1">weight=</span><span class="s2">'bold'</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">15</span><span class="s1">)</span>
    <span class="s1">fig_ref.supylabel(</span><span class="s2">&quot;ylabel&quot;</span><span class="s0">, </span><span class="s1">weight=</span><span class="s2">'bold'</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">15</span><span class="s1">)</span>
    <span class="s1">fig_ref.suptitle(</span><span class="s2">&quot;Title&quot;</span><span class="s0">, </span><span class="s1">weight=</span><span class="s2">'light'</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">20</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">mpl.rc_context({</span><span class="s2">'figure.labelweight'</span><span class="s1">: </span><span class="s2">'bold'</span><span class="s0">,</span>
                         <span class="s2">'figure.labelsize'</span><span class="s1">: </span><span class="s3">15</span><span class="s0">,</span>
                         <span class="s2">'figure.titleweight'</span><span class="s1">: </span><span class="s2">'light'</span><span class="s0">,</span>
                         <span class="s2">'figure.titlesize'</span><span class="s1">: </span><span class="s3">20</span><span class="s1">}):</span>
        <span class="s1">fig_test.supxlabel(</span><span class="s2">&quot;xlabel&quot;</span><span class="s1">)</span>
        <span class="s1">fig_test.supylabel(</span><span class="s2">&quot;ylabel&quot;</span><span class="s1">)</span>
        <span class="s1">fig_test.suptitle(</span><span class="s2">&quot;Title&quot;</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_deepcopy():</span>
    <span class="s1">fig1</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">ax.set_yscale(</span><span class="s2">'log'</span><span class="s1">)</span>

    <span class="s1">fig2 = copy.deepcopy(fig1)</span>

    <span class="s4"># Make sure it is a new object</span>
    <span class="s0">assert </span><span class="s1">fig2.axes[</span><span class="s3">0</span><span class="s1">] </span><span class="s0">is not </span><span class="s1">ax</span>
    <span class="s4"># And that the axis scale got propagated</span>
    <span class="s0">assert </span><span class="s1">fig2.axes[</span><span class="s3">0</span><span class="s1">].get_yscale() == </span><span class="s2">'log'</span>
    <span class="s4"># Update the deepcopy and check the original isn't modified</span>
    <span class="s1">fig2.axes[</span><span class="s3">0</span><span class="s1">].set_yscale(</span><span class="s2">'linear'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ax.get_yscale() == </span><span class="s2">'log'</span>

    <span class="s4"># And test the limits of the axes don't get propagated</span>
    <span class="s1">ax.set_xlim(</span><span class="s3">1e-1</span><span class="s0">, </span><span class="s3">1e2</span><span class="s1">)</span>
    <span class="s4"># Draw these to make sure limits are updated</span>
    <span class="s1">fig1.draw_without_rendering()</span>
    <span class="s1">fig2.draw_without_rendering()</span>

    <span class="s0">assert </span><span class="s1">ax.get_xlim() == (</span><span class="s3">1e-1</span><span class="s0">, </span><span class="s3">1e2</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig2.axes[</span><span class="s3">0</span><span class="s1">].get_xlim() == (</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_unpickle_with_device_pixel_ratio():</span>
    <span class="s1">fig = Figure(dpi=</span><span class="s3">42</span><span class="s1">)</span>
    <span class="s1">fig.canvas._set_device_pixel_ratio(</span><span class="s3">7</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">fig.dpi == </span><span class="s3">42</span><span class="s1">*</span><span class="s3">7</span>
    <span class="s1">fig2 = pickle.loads(pickle.dumps(fig))</span>
    <span class="s0">assert </span><span class="s1">fig2.dpi == </span><span class="s3">42</span>


<span class="s0">def </span><span class="s1">test_gridspec_no_mutate_input():</span>
    <span class="s1">gs = {</span><span class="s2">'left'</span><span class="s1">: </span><span class="s3">.1</span><span class="s1">}</span>
    <span class="s1">gs_orig = dict(gs)</span>
    <span class="s1">plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">width_ratios=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gridspec_kw=gs)</span>
    <span class="s0">assert </span><span class="s1">gs == gs_orig</span>
    <span class="s1">plt.subplot_mosaic(</span><span class="s2">'AB'</span><span class="s0">, </span><span class="s1">width_ratios=[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s1">gridspec_kw=gs)</span>
</pre>
</body>
</html>