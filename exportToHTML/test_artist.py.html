<html>
<head>
<title>test_artist.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_artist.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">io</span>
<span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">chain</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib.colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib.patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">import </span><span class="s1">matplotlib.lines </span><span class="s0">as </span><span class="s1">mlines</span>
<span class="s0">import </span><span class="s1">matplotlib.path </span><span class="s0">as </span><span class="s1">mpath</span>
<span class="s0">import </span><span class="s1">matplotlib.transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">import </span><span class="s1">matplotlib.collections </span><span class="s0">as </span><span class="s1">mcollections</span>
<span class="s0">import </span><span class="s1">matplotlib.artist </span><span class="s0">as </span><span class="s1">martist</span>
<span class="s0">import </span><span class="s1">matplotlib.backend_bases </span><span class="s0">as </span><span class="s1">mbackend_bases</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib.testing.decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s0">, </span><span class="s1">image_comparison</span>


<span class="s0">def </span><span class="s1">test_patch_transform_of_none():</span>
    <span class="s2"># tests the behaviour of patches added to an Axes with various transform</span>
    <span class="s2"># specifications</span>

    <span class="s1">ax = plt.axes()</span>
    <span class="s1">ax.set_xlim([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">ax.set_ylim([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>

    <span class="s2"># Draw an ellipse over data coord (2, 2) by specifying device coords.</span>
    <span class="s1">xy_data = (</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">xy_pix = ax.transData.transform(xy_data)</span>

    <span class="s2"># Not providing a transform of None puts the ellipse in data coordinates .</span>
    <span class="s1">e = mpatches.Ellipse(xy_data</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">fc=</span><span class="s4">'yellow'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(e)</span>
    <span class="s0">assert </span><span class="s1">e._transform == ax.transData</span>

    <span class="s2"># Providing a transform of None puts the ellipse in device coordinates.</span>
    <span class="s1">e = mpatches.Ellipse(xy_pix</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">120</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">120</span><span class="s0">, </span><span class="s1">fc=</span><span class="s4">'coral'</span><span class="s0">,</span>
                         <span class="s1">transform=</span><span class="s0">None, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">e.is_transform_set()</span>
    <span class="s1">ax.add_patch(e)</span>
    <span class="s0">assert </span><span class="s1">isinstance(e._transform</span><span class="s0">, </span><span class="s1">mtransforms.IdentityTransform)</span>

    <span class="s2"># Providing an IdentityTransform puts the ellipse in device coordinates.</span>
    <span class="s1">e = mpatches.Ellipse(xy_pix</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">100</span><span class="s0">,</span>
                         <span class="s1">transform=mtransforms.IdentityTransform()</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(e)</span>
    <span class="s0">assert </span><span class="s1">isinstance(e._transform</span><span class="s0">, </span><span class="s1">mtransforms.IdentityTransform)</span>

    <span class="s2"># Not providing a transform, and then subsequently &quot;get_transform&quot; should</span>
    <span class="s2"># not mean that &quot;is_transform_set&quot;.</span>
    <span class="s1">e = mpatches.Ellipse(xy_pix</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">120</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">120</span><span class="s0">, </span><span class="s1">fc=</span><span class="s4">'coral'</span><span class="s0">,</span>
                         <span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">intermediate_transform = e.get_transform()</span>
    <span class="s0">assert not </span><span class="s1">e.is_transform_set()</span>
    <span class="s1">ax.add_patch(e)</span>
    <span class="s0">assert </span><span class="s1">e.get_transform() != intermediate_transform</span>
    <span class="s0">assert </span><span class="s1">e.is_transform_set()</span>
    <span class="s0">assert </span><span class="s1">e._transform == ax.transData</span>


<span class="s0">def </span><span class="s1">test_collection_transform_of_none():</span>
    <span class="s2"># tests the behaviour of collections added to an Axes with various</span>
    <span class="s2"># transform specifications</span>

    <span class="s1">ax = plt.axes()</span>
    <span class="s1">ax.set_xlim([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">ax.set_ylim([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>

    <span class="s2"># draw an ellipse over data coord (2, 2) by specifying device coords</span>
    <span class="s1">xy_data = (</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>
    <span class="s1">xy_pix = ax.transData.transform(xy_data)</span>

    <span class="s2"># not providing a transform of None puts the ellipse in data coordinates</span>
    <span class="s1">e = mpatches.Ellipse(xy_data</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">1</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">c = mcollections.PatchCollection([e]</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s4">'yellow'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">ax.add_collection(c)</span>
    <span class="s2"># the collection should be in data coordinates</span>
    <span class="s0">assert </span><span class="s1">c.get_offset_transform() + c.get_transform() == ax.transData</span>

    <span class="s2"># providing a transform of None puts the ellipse in device coordinates</span>
    <span class="s1">e = mpatches.Ellipse(xy_pix</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">120</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">120</span><span class="s1">)</span>
    <span class="s1">c = mcollections.PatchCollection([e]</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s4">'coral'</span><span class="s0">,</span>
                                     <span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">c.set_transform(</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s1">ax.add_collection(c)</span>
    <span class="s0">assert </span><span class="s1">isinstance(c.get_transform()</span><span class="s0">, </span><span class="s1">mtransforms.IdentityTransform)</span>

    <span class="s2"># providing an IdentityTransform puts the ellipse in device coordinates</span>
    <span class="s1">e = mpatches.Ellipse(xy_pix</span><span class="s0">, </span><span class="s1">width=</span><span class="s3">100</span><span class="s0">, </span><span class="s1">height=</span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">c = mcollections.PatchCollection([e]</span><span class="s0">,</span>
                                     <span class="s1">transform=mtransforms.IdentityTransform()</span><span class="s0">,</span>
                                     <span class="s1">alpha=</span><span class="s3">0.5</span><span class="s1">)</span>
    <span class="s1">ax.add_collection(c)</span>
    <span class="s0">assert </span><span class="s1">isinstance(c.get_offset_transform()</span><span class="s0">, </span><span class="s1">mtransforms.IdentityTransform)</span>


<span class="s1">@image_comparison([</span><span class="s4">&quot;clip_path_clipping&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_clipping():</span>
    <span class="s1">exterior = mpath.Path.unit_rectangle().deepcopy()</span>
    <span class="s1">exterior.vertices *= </span><span class="s3">4</span>
    <span class="s1">exterior.vertices -= </span><span class="s3">2</span>
    <span class="s1">interior = mpath.Path.unit_circle().deepcopy()</span>
    <span class="s1">interior.vertices = interior.vertices[::-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">clip_path = mpath.Path.make_compound_path(exterior</span><span class="s0">, </span><span class="s1">interior)</span>

    <span class="s1">star = mpath.Path.unit_regular_star(</span><span class="s3">6</span><span class="s1">).deepcopy()</span>
    <span class="s1">star.vertices *= </span><span class="s3">2.6</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">(ax1</span><span class="s0">, </span><span class="s1">ax2) = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">sharex=</span><span class="s0">True, </span><span class="s1">sharey=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s1">col = mcollections.PathCollection([star]</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">5</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'blue'</span><span class="s0">,</span>
                                      <span class="s1">facecolor=</span><span class="s4">'red'</span><span class="s0">, </span><span class="s1">alpha=</span><span class="s3">0.7</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s4">'*'</span><span class="s1">)</span>
    <span class="s1">col.set_clip_path(clip_path</span><span class="s0">, </span><span class="s1">ax1.transData)</span>
    <span class="s1">ax1.add_collection(col)</span>

    <span class="s1">patch = mpatches.PathPatch(star</span><span class="s0">, </span><span class="s1">lw=</span><span class="s3">5</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'blue'</span><span class="s0">, </span><span class="s1">facecolor=</span><span class="s4">'red'</span><span class="s0">,</span>
                               <span class="s1">alpha=</span><span class="s3">0.7</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s4">'*'</span><span class="s1">)</span>
    <span class="s1">patch.set_clip_path(clip_path</span><span class="s0">, </span><span class="s1">ax2.transData)</span>
    <span class="s1">ax2.add_patch(patch)</span>

    <span class="s1">ax1.set_xlim([-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s1">ax1.set_ylim([-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>


<span class="s1">@check_figures_equal(extensions=[</span><span class="s4">'png'</span><span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_clipping_zoom(fig_test</span><span class="s0">, </span><span class="s1">fig_ref):</span>
    <span class="s2"># This test places the Axes and sets its limits such that the clip path is</span>
    <span class="s2"># outside the figure entirely. This should not break the clip path.</span>
    <span class="s1">ax_test = fig_test.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">l</span><span class="s0">, </span><span class="s1">= ax_test.plot([-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s2"># Explicit Path instead of a Rectangle uses clip path processing, instead</span>
    <span class="s2"># of a clip box optimization.</span>
    <span class="s1">p = mpath.Path([[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">]])</span>
    <span class="s1">p = mpatches.PathPatch(p</span><span class="s0">, </span><span class="s1">transform=ax_test.transData)</span>
    <span class="s1">l.set_clip_path(p)</span>

    <span class="s1">ax_ref = fig_ref.add_axes([</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">])</span>
    <span class="s1">ax_ref.plot([-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[-</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>

    <span class="s1">ax_ref.set(xlim=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.75</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.75</span><span class="s1">))</span>
    <span class="s1">ax_test.set(xlim=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.75</span><span class="s1">)</span><span class="s0">, </span><span class="s1">ylim=(</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">0.75</span><span class="s1">))</span>


<span class="s0">def </span><span class="s1">test_cull_markers():</span>
    <span class="s1">x = np.random.random(</span><span class="s3">20000</span><span class="s1">)</span>
    <span class="s1">y = np.random.random(</span><span class="s3">20000</span><span class="s1">)</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ax.plot(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s4">'k.'</span><span class="s1">)</span>
    <span class="s1">ax.set_xlim(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">pdf = io.BytesIO()</span>
    <span class="s1">fig.savefig(pdf</span><span class="s0">, </span><span class="s1">format=</span><span class="s4">&quot;pdf&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(pdf.getvalue()) &lt; </span><span class="s3">8000</span>

    <span class="s1">svg = io.BytesIO()</span>
    <span class="s1">fig.savefig(svg</span><span class="s0">, </span><span class="s1">format=</span><span class="s4">&quot;svg&quot;</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">len(svg.getvalue()) &lt; </span><span class="s3">20000</span>


<span class="s1">@image_comparison([</span><span class="s4">'hatching'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s4">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_hatching():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>

    <span class="s2"># Default hatch color.</span>
    <span class="s1">rect1 = mpatches.Rectangle((</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s4">'/'</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(rect1)</span>

    <span class="s1">rect2 = mcollections.RegularPolyCollection(</span>
        <span class="s3">4</span><span class="s0">, </span><span class="s1">sizes=[</span><span class="s3">16000</span><span class="s1">]</span><span class="s0">, </span><span class="s1">offsets=[(</span><span class="s3">1.5</span><span class="s0">, </span><span class="s3">6.5</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">offset_transform=ax.transData</span><span class="s0">,</span>
        <span class="s1">hatch=</span><span class="s4">'/'</span><span class="s1">)</span>
    <span class="s1">ax.add_collection(rect2)</span>

    <span class="s2"># Ensure edge color is not applied to hatching.</span>
    <span class="s1">rect3 = mpatches.Rectangle((</span><span class="s3">4</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s3">3</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">hatch=</span><span class="s4">'/'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'C1'</span><span class="s1">)</span>
    <span class="s1">ax.add_patch(rect3)</span>

    <span class="s1">rect4 = mcollections.RegularPolyCollection(</span>
        <span class="s3">4</span><span class="s0">, </span><span class="s1">sizes=[</span><span class="s3">16000</span><span class="s1">]</span><span class="s0">, </span><span class="s1">offsets=[(</span><span class="s3">5.5</span><span class="s0">, </span><span class="s3">6.5</span><span class="s1">)]</span><span class="s0">, </span><span class="s1">offset_transform=ax.transData</span><span class="s0">,</span>
        <span class="s1">hatch=</span><span class="s4">'/'</span><span class="s0">, </span><span class="s1">edgecolor=</span><span class="s4">'C1'</span><span class="s1">)</span>
    <span class="s1">ax.add_collection(rect4)</span>

    <span class="s1">ax.set_xlim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">7</span><span class="s1">)</span>
    <span class="s1">ax.set_ylim(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">9</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">test_remove():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">im = ax.imshow(np.arange(</span><span class="s3">36</span><span class="s1">).reshape(</span><span class="s3">6</span><span class="s0">, </span><span class="s3">6</span><span class="s1">))</span>
    <span class="s1">ln</span><span class="s0">, </span><span class="s1">= ax.plot(range(</span><span class="s3">5</span><span class="s1">))</span>

    <span class="s0">assert </span><span class="s1">fig.stale</span>
    <span class="s0">assert </span><span class="s1">ax.stale</span>

    <span class="s1">fig.canvas.draw()</span>
    <span class="s0">assert not </span><span class="s1">fig.stale</span>
    <span class="s0">assert not </span><span class="s1">ax.stale</span>
    <span class="s0">assert not </span><span class="s1">ln.stale</span>

    <span class="s0">assert </span><span class="s1">im </span><span class="s0">in </span><span class="s1">ax._mouseover_set</span>
    <span class="s0">assert </span><span class="s1">ln </span><span class="s0">not in </span><span class="s1">ax._mouseover_set</span>
    <span class="s0">assert </span><span class="s1">im.axes </span><span class="s0">is </span><span class="s1">ax</span>

    <span class="s1">im.remove()</span>
    <span class="s1">ln.remove()</span>

    <span class="s0">for </span><span class="s1">art </span><span class="s0">in </span><span class="s1">[im</span><span class="s0">, </span><span class="s1">ln]:</span>
        <span class="s0">assert </span><span class="s1">art.axes </span><span class="s0">is None</span>
        <span class="s0">assert </span><span class="s1">art.figure </span><span class="s0">is None</span>

    <span class="s0">assert </span><span class="s1">im </span><span class="s0">not in </span><span class="s1">ax._mouseover_set</span>
    <span class="s0">assert </span><span class="s1">fig.stale</span>
    <span class="s0">assert </span><span class="s1">ax.stale</span>


<span class="s1">@image_comparison([</span><span class="s4">&quot;default_edges.png&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">remove_text=</span><span class="s0">True, </span><span class="s1">style=</span><span class="s4">'default'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">test_default_edges():</span>
    <span class="s2"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt.rcParams[</span><span class="s4">'text.kerning_factor'</span><span class="s1">] = </span><span class="s3">6</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">[[ax1</span><span class="s0">, </span><span class="s1">ax2]</span><span class="s0">, </span><span class="s1">[ax3</span><span class="s0">, </span><span class="s1">ax4]] = plt.subplots(</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">)</span>

    <span class="s1">ax1.plot(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'x'</span><span class="s0">,</span>
             <span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">) + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s4">'o'</span><span class="s1">)</span>
    <span class="s1">ax2.bar(np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">np.arange(</span><span class="s3">10</span><span class="s1">)</span><span class="s0">, </span><span class="s1">align=</span><span class="s4">'edge'</span><span class="s1">)</span>
    <span class="s1">ax3.text(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s4">&quot;BOX&quot;</span><span class="s0">, </span><span class="s1">size=</span><span class="s3">24</span><span class="s0">, </span><span class="s1">bbox=dict(boxstyle=</span><span class="s4">'sawtooth'</span><span class="s1">))</span>
    <span class="s1">ax3.set_xlim((-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">ax3.set_ylim((-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">pp1 = mpatches.PathPatch(</span>
        <span class="s1">mpath.Path([(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)]</span><span class="s0">,</span>
                   <span class="s1">[mpath.Path.MOVETO</span><span class="s0">, </span><span class="s1">mpath.Path.CURVE3</span><span class="s0">,</span>
                    <span class="s1">mpath.Path.CURVE3</span><span class="s0">, </span><span class="s1">mpath.Path.CLOSEPOLY])</span><span class="s0">,</span>
        <span class="s1">fc=</span><span class="s4">&quot;none&quot;</span><span class="s0">, </span><span class="s1">transform=ax4.transData)</span>
    <span class="s1">ax4.add_patch(pp1)</span>


<span class="s0">def </span><span class="s1">test_properties():</span>
    <span class="s1">ln = mlines.Line2D([]</span><span class="s0">, </span><span class="s1">[])</span>
    <span class="s1">ln.properties()  </span><span class="s2"># Check that no warning is emitted.</span>


<span class="s0">def </span><span class="s1">test_setp():</span>
    <span class="s2"># Check empty list</span>
    <span class="s1">plt.setp([])</span>
    <span class="s1">plt.setp([[]])</span>

    <span class="s2"># Check arbitrary iterables</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">lines1 = ax.plot(range(</span><span class="s3">3</span><span class="s1">))</span>
    <span class="s1">lines2 = ax.plot(range(</span><span class="s3">3</span><span class="s1">))</span>
    <span class="s1">martist.setp(chain(lines1</span><span class="s0">, </span><span class="s1">lines2)</span><span class="s0">, </span><span class="s4">'lw'</span><span class="s0">, </span><span class="s3">5</span><span class="s1">)</span>
    <span class="s1">plt.setp(ax.spines.values()</span><span class="s0">, </span><span class="s1">color=</span><span class="s4">'green'</span><span class="s1">)</span>

    <span class="s2"># Check *file* argument</span>
    <span class="s1">sio = io.StringIO()</span>
    <span class="s1">plt.setp(lines1</span><span class="s0">, </span><span class="s4">'zorder'</span><span class="s0">, </span><span class="s1">file=sio)</span>
    <span class="s0">assert </span><span class="s1">sio.getvalue() == </span><span class="s4">'  zorder: float</span><span class="s0">\n</span><span class="s4">'</span>


<span class="s0">def </span><span class="s1">test_None_zorder():</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">ln</span><span class="s0">, </span><span class="s1">= ax.plot(range(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">, </span><span class="s1">zorder=</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ln.get_zorder() == mlines.Line2D.zorder</span>
    <span class="s1">ln.set_zorder(</span><span class="s3">123456</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ln.get_zorder() == </span><span class="s3">123456</span>
    <span class="s1">ln.set_zorder(</span><span class="s0">None</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">ln.get_zorder() == mlines.Line2D.zorder</span>


<span class="s1">@pytest.mark.parametrize(</span><span class="s4">'accept_clause, expected'</span><span class="s0">, </span><span class="s1">[</span>
    <span class="s1">(</span><span class="s4">''</span><span class="s0">, </span><span class="s4">'unknown'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s4">&quot;ACCEPTS: [ '-' | '--' | '-.' ]&quot;</span><span class="s0">, </span><span class="s4">&quot;[ '-' | '--' | '-.' ]&quot;</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s4">'ACCEPTS: Some description.'</span><span class="s0">, </span><span class="s4">'Some description.'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s4">'.. ACCEPTS: Some description.'</span><span class="s0">, </span><span class="s4">'Some description.'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s4">'arg : int'</span><span class="s0">, </span><span class="s4">'int'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s4">'*arg : int'</span><span class="s0">, </span><span class="s4">'int'</span><span class="s1">)</span><span class="s0">,</span>
    <span class="s1">(</span><span class="s4">'arg : int</span><span class="s0">\n</span><span class="s4">ACCEPTS: Something else.'</span><span class="s0">, </span><span class="s4">'Something else. '</span><span class="s1">)</span><span class="s0">,</span>
<span class="s1">])</span>
<span class="s0">def </span><span class="s1">test_artist_inspector_get_valid_values(accept_clause</span><span class="s0">, </span><span class="s1">expected):</span>
    <span class="s0">class </span><span class="s1">TestArtist(martist.Artist):</span>
        <span class="s0">def </span><span class="s1">set_f(self</span><span class="s0">, </span><span class="s1">arg):</span>
            <span class="s0">pass</span>

    <span class="s1">TestArtist.set_f.__doc__ = </span><span class="s4">&quot;&quot;&quot; 
    Some text. 
 
    %s 
    &quot;&quot;&quot; </span><span class="s1">% accept_clause</span>
    <span class="s1">valid_values = martist.ArtistInspector(TestArtist).get_valid_values(</span><span class="s4">'f'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">valid_values == expected</span>


<span class="s0">def </span><span class="s1">test_artist_inspector_get_aliases():</span>
    <span class="s2"># test the correct format and type of get_aliases method</span>
    <span class="s1">ai = martist.ArtistInspector(mlines.Line2D)</span>
    <span class="s1">aliases = ai.get_aliases()</span>
    <span class="s0">assert </span><span class="s1">aliases[</span><span class="s4">&quot;linewidth&quot;</span><span class="s1">] == {</span><span class="s4">&quot;lw&quot;</span><span class="s1">}</span>


<span class="s0">def </span><span class="s1">test_set_alpha():</span>
    <span class="s1">art = martist.Artist()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">'^alpha must be numeric or None'</span><span class="s1">):</span>
        <span class="s1">art.set_alpha(</span><span class="s4">'string'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">'^alpha must be numeric or None'</span><span class="s1">):</span>
        <span class="s1">art.set_alpha([</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">3</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;outside 0-1 range&quot;</span><span class="s1">):</span>
        <span class="s1">art.set_alpha(</span><span class="s3">1.1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;outside 0-1 range&quot;</span><span class="s1">):</span>
        <span class="s1">art.set_alpha(np.nan)</span>


<span class="s0">def </span><span class="s1">test_set_alpha_for_array():</span>
    <span class="s1">art = martist.Artist()</span>
    <span class="s0">with </span><span class="s1">pytest.raises(TypeError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">'^alpha must be numeric or None'</span><span class="s1">):</span>
        <span class="s1">art._set_alpha_for_array(</span><span class="s4">'string'</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;outside 0-1 range&quot;</span><span class="s1">):</span>
        <span class="s1">art._set_alpha_for_array(</span><span class="s3">1.1</span><span class="s1">)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;outside 0-1 range&quot;</span><span class="s1">):</span>
        <span class="s1">art._set_alpha_for_array(np.nan)</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;alpha must be between 0 and 1&quot;</span><span class="s1">):</span>
        <span class="s1">art._set_alpha_for_array([</span><span class="s3">0.5</span><span class="s0">, </span><span class="s3">1.1</span><span class="s1">])</span>
    <span class="s0">with </span><span class="s1">pytest.raises(ValueError</span><span class="s0">, </span><span class="s1">match=</span><span class="s4">&quot;alpha must be between 0 and 1&quot;</span><span class="s1">):</span>
        <span class="s1">art._set_alpha_for_array([</span><span class="s3">0.5</span><span class="s0">, </span><span class="s1">np.nan])</span>


<span class="s0">def </span><span class="s1">test_callbacks():</span>
    <span class="s0">def </span><span class="s1">func(artist):</span>
        <span class="s1">func.counter += </span><span class="s3">1</span>

    <span class="s1">func.counter = </span><span class="s3">0</span>

    <span class="s1">art = martist.Artist()</span>
    <span class="s1">oid = art.add_callback(func)</span>
    <span class="s0">assert </span><span class="s1">func.counter == </span><span class="s3">0</span>
    <span class="s1">art.pchanged()  </span><span class="s2"># must call the callback</span>
    <span class="s0">assert </span><span class="s1">func.counter == </span><span class="s3">1</span>
    <span class="s1">art.set_zorder(</span><span class="s3">10</span><span class="s1">)  </span><span class="s2"># setting a property must also call the callback</span>
    <span class="s0">assert </span><span class="s1">func.counter == </span><span class="s3">2</span>
    <span class="s1">art.remove_callback(oid)</span>
    <span class="s1">art.pchanged()  </span><span class="s2"># must not call the callback anymore</span>
    <span class="s0">assert </span><span class="s1">func.counter == </span><span class="s3">2</span>


<span class="s0">def </span><span class="s1">test_set_signature():</span>
    <span class="s5">&quot;&quot;&quot;Test autogenerated ``set()`` for Artist subclasses.&quot;&quot;&quot;</span>
    <span class="s0">class </span><span class="s1">MyArtist1(martist.Artist):</span>
        <span class="s0">def </span><span class="s1">set_myparam1(self</span><span class="s0">, </span><span class="s1">val):</span>
            <span class="s0">pass</span>

    <span class="s0">assert </span><span class="s1">hasattr(MyArtist1.set</span><span class="s0">, </span><span class="s4">'_autogenerated_signature'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s4">'myparam1' </span><span class="s0">in </span><span class="s1">MyArtist1.set.__doc__</span>

    <span class="s0">class </span><span class="s1">MyArtist2(MyArtist1):</span>
        <span class="s0">def </span><span class="s1">set_myparam2(self</span><span class="s0">, </span><span class="s1">val):</span>
            <span class="s0">pass</span>

    <span class="s0">assert </span><span class="s1">hasattr(MyArtist2.set</span><span class="s0">, </span><span class="s4">'_autogenerated_signature'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s4">'myparam1' </span><span class="s0">in </span><span class="s1">MyArtist2.set.__doc__</span>
    <span class="s0">assert </span><span class="s4">'myparam2' </span><span class="s0">in </span><span class="s1">MyArtist2.set.__doc__</span>


<span class="s0">def </span><span class="s1">test_set_is_overwritten():</span>
    <span class="s5">&quot;&quot;&quot;set() defined in Artist subclasses should not be overwritten.&quot;&quot;&quot;</span>
    <span class="s0">class </span><span class="s1">MyArtist3(martist.Artist):</span>

        <span class="s0">def </span><span class="s1">set(self</span><span class="s0">, </span><span class="s1">**kwargs):</span>
            <span class="s5">&quot;&quot;&quot;Not overwritten.&quot;&quot;&quot;</span>

    <span class="s0">assert not </span><span class="s1">hasattr(MyArtist3.set</span><span class="s0">, </span><span class="s4">'_autogenerated_signature'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s1">MyArtist3.set.__doc__ == </span><span class="s4">&quot;Not overwritten.&quot;</span>

    <span class="s0">class </span><span class="s1">MyArtist4(MyArtist3):</span>
        <span class="s0">pass</span>

    <span class="s0">assert </span><span class="s1">MyArtist4.set </span><span class="s0">is </span><span class="s1">MyArtist3.set</span>


<span class="s0">def </span><span class="s1">test_format_cursor_data_BoundaryNorm():</span>
    <span class="s5">&quot;&quot;&quot;Test if cursor data is correct when using BoundaryNorm.&quot;&quot;&quot;</span>
    <span class="s1">X = np.empty((</span><span class="s3">3</span><span class="s0">, </span><span class="s3">3</span><span class="s1">))</span>
    <span class="s1">X[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] = </span><span class="s3">0.9</span>
    <span class="s1">X[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s1">] = </span><span class="s3">0.99</span>
    <span class="s1">X[</span><span class="s3">0</span><span class="s0">, </span><span class="s3">2</span><span class="s1">] = </span><span class="s3">0.999</span>
    <span class="s1">X[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] = -</span><span class="s3">1</span>
    <span class="s1">X[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s1">] = </span><span class="s3">0</span>
    <span class="s1">X[</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s1">] = </span><span class="s3">1</span>
    <span class="s1">X[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">0</span><span class="s1">] = </span><span class="s3">0.09</span>
    <span class="s1">X[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">1</span><span class="s1">] = </span><span class="s3">0.009</span>
    <span class="s1">X[</span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s1">] = </span><span class="s3">0.0009</span>

    <span class="s2"># map range -1..1 to 0..256 in 0.1 steps</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;-1..1 to 0..256 in 0.1&quot;</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(np.linspace(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">20</span><span class="s1">)</span><span class="s0">, </span><span class="s3">256</span><span class="s1">)</span>
    <span class="s1">img = ax.imshow(X</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s0">, </span><span class="s1">norm=norm)</span>

    <span class="s1">labels_list = [</span>
        <span class="s4">&quot;[0.9]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[1.]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[1.]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[-1.0]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.0]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[1.0]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.09]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.009]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.0009]&quot;</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(X.flat</span><span class="s0">, </span><span class="s1">labels_list):</span>
        <span class="s2"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.1))</span>
        <span class="s0">assert </span><span class="s1">img.format_cursor_data(v) == label</span>

    <span class="s1">plt.close()</span>

    <span class="s2"># map range -1..1 to 0..256 in 0.01 steps</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;-1..1 to 0..256 in 0.01&quot;</span><span class="s1">)</span>
    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">'RdBu_r'</span><span class="s1">].resampled(</span><span class="s3">200</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(np.linspace(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">200</span><span class="s1">)</span><span class="s0">, </span><span class="s3">200</span><span class="s1">)</span>
    <span class="s1">img = ax.imshow(X</span><span class="s0">, </span><span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm)</span>

    <span class="s1">labels_list = [</span>
        <span class="s4">&quot;[0.90]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.99]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[1.0]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[-1.00]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.00]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[1.00]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.09]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.009]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.0009]&quot;</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(X.flat</span><span class="s0">, </span><span class="s1">labels_list):</span>
        <span class="s2"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.01))</span>
        <span class="s0">assert </span><span class="s1">img.format_cursor_data(v) == label</span>

    <span class="s1">plt.close()</span>

    <span class="s2"># map range -1..1 to 0..256 in 0.01 steps</span>
    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;-1..1 to 0..256 in 0.001&quot;</span><span class="s1">)</span>
    <span class="s1">cmap = mpl.colormaps[</span><span class="s4">'RdBu_r'</span><span class="s1">].resampled(</span><span class="s3">2000</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(np.linspace(-</span><span class="s3">1</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">2000</span><span class="s1">)</span><span class="s0">, </span><span class="s3">2000</span><span class="s1">)</span>
    <span class="s1">img = ax.imshow(X</span><span class="s0">, </span><span class="s1">cmap=cmap</span><span class="s0">, </span><span class="s1">norm=norm)</span>

    <span class="s1">labels_list = [</span>
        <span class="s4">&quot;[0.900]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.990]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.999]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[-1.000]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.000]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[1.000]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.090]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.009]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.0009]&quot;</span><span class="s0">,</span>
    <span class="s1">]</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(X.flat</span><span class="s0">, </span><span class="s1">labels_list):</span>
        <span class="s2"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.001))</span>
        <span class="s0">assert </span><span class="s1">img.format_cursor_data(v) == label</span>

    <span class="s1">plt.close()</span>

    <span class="s2"># different testing data set with</span>
    <span class="s2"># out of bounds values for 0..1 range</span>
    <span class="s1">X = np.empty((</span><span class="s3">7</span><span class="s0">, </span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">X[</span><span class="s3">0</span><span class="s1">] = -</span><span class="s3">1.0</span>
    <span class="s1">X[</span><span class="s3">1</span><span class="s1">] = </span><span class="s3">0.0</span>
    <span class="s1">X[</span><span class="s3">2</span><span class="s1">] = </span><span class="s3">0.1</span>
    <span class="s1">X[</span><span class="s3">3</span><span class="s1">] = </span><span class="s3">0.5</span>
    <span class="s1">X[</span><span class="s3">4</span><span class="s1">] = </span><span class="s3">0.9</span>
    <span class="s1">X[</span><span class="s3">5</span><span class="s1">] = </span><span class="s3">1.0</span>
    <span class="s1">X[</span><span class="s3">6</span><span class="s1">] = </span><span class="s3">2.0</span>

    <span class="s1">labels_list = [</span>
        <span class="s4">&quot;[-1.0]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.0]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.1]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.5]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[0.9]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[1.0]&quot;</span><span class="s0">,</span>
        <span class="s4">&quot;[2.0]&quot;</span><span class="s0">,</span>
    <span class="s1">]</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;noclip, neither&quot;</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(</span>
        <span class="s1">np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s3">256</span><span class="s0">, </span><span class="s1">clip=</span><span class="s0">False, </span><span class="s1">extend=</span><span class="s4">'neither'</span><span class="s1">)</span>
    <span class="s1">img = ax.imshow(X</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s0">, </span><span class="s1">norm=norm)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(X.flat</span><span class="s0">, </span><span class="s1">labels_list):</span>
        <span class="s2"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img.format_cursor_data(v) == label</span>

    <span class="s1">plt.close()</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;noclip, min&quot;</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(</span>
        <span class="s1">np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s3">256</span><span class="s0">, </span><span class="s1">clip=</span><span class="s0">False, </span><span class="s1">extend=</span><span class="s4">'min'</span><span class="s1">)</span>
    <span class="s1">img = ax.imshow(X</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s0">, </span><span class="s1">norm=norm)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(X.flat</span><span class="s0">, </span><span class="s1">labels_list):</span>
        <span class="s2"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img.format_cursor_data(v) == label</span>

    <span class="s1">plt.close()</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;noclip, max&quot;</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(</span>
        <span class="s1">np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s3">256</span><span class="s0">, </span><span class="s1">clip=</span><span class="s0">False, </span><span class="s1">extend=</span><span class="s4">'max'</span><span class="s1">)</span>
    <span class="s1">img = ax.imshow(X</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s0">, </span><span class="s1">norm=norm)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(X.flat</span><span class="s0">, </span><span class="s1">labels_list):</span>
        <span class="s2"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img.format_cursor_data(v) == label</span>

    <span class="s1">plt.close()</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;noclip, both&quot;</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(</span>
        <span class="s1">np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s3">256</span><span class="s0">, </span><span class="s1">clip=</span><span class="s0">False, </span><span class="s1">extend=</span><span class="s4">'both'</span><span class="s1">)</span>
    <span class="s1">img = ax.imshow(X</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s0">, </span><span class="s1">norm=norm)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(X.flat</span><span class="s0">, </span><span class="s1">labels_list):</span>
        <span class="s2"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img.format_cursor_data(v) == label</span>

    <span class="s1">plt.close()</span>

    <span class="s1">fig</span><span class="s0">, </span><span class="s1">ax = plt.subplots()</span>
    <span class="s1">fig.suptitle(</span><span class="s4">&quot;clip, neither&quot;</span><span class="s1">)</span>
    <span class="s1">norm = mcolors.BoundaryNorm(</span>
        <span class="s1">np.linspace(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">1</span><span class="s0">, </span><span class="s3">4</span><span class="s0">, </span><span class="s1">endpoint=</span><span class="s0">True</span><span class="s1">)</span><span class="s0">, </span><span class="s3">256</span><span class="s0">, </span><span class="s1">clip=</span><span class="s0">True, </span><span class="s1">extend=</span><span class="s4">'neither'</span><span class="s1">)</span>
    <span class="s1">img = ax.imshow(X</span><span class="s0">, </span><span class="s1">cmap=</span><span class="s4">'RdBu_r'</span><span class="s0">, </span><span class="s1">norm=norm)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s0">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip(X.flat</span><span class="s0">, </span><span class="s1">labels_list):</span>
        <span class="s2"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img.format_cursor_data(v) == label</span>

    <span class="s1">plt.close()</span>


<span class="s0">def </span><span class="s1">test_auto_no_rasterize():</span>
    <span class="s0">class </span><span class="s1">Gen1(martist.Artist):</span>
        <span class="s1">...</span>

    <span class="s0">assert </span><span class="s4">'draw' </span><span class="s0">in </span><span class="s1">Gen1.__dict__</span>
    <span class="s0">assert </span><span class="s1">Gen1.__dict__[</span><span class="s4">'draw'</span><span class="s1">] </span><span class="s0">is </span><span class="s1">Gen1.draw</span>

    <span class="s0">class </span><span class="s1">Gen2(Gen1):</span>
        <span class="s1">...</span>

    <span class="s0">assert </span><span class="s4">'draw' </span><span class="s0">not in </span><span class="s1">Gen2.__dict__</span>
    <span class="s0">assert </span><span class="s1">Gen2.draw </span><span class="s0">is </span><span class="s1">Gen1.draw</span>


<span class="s0">def </span><span class="s1">test_draw_wraper_forward_input():</span>
    <span class="s0">class </span><span class="s1">TestKlass(martist.Artist):</span>
        <span class="s0">def </span><span class="s1">draw(self</span><span class="s0">, </span><span class="s1">renderer</span><span class="s0">, </span><span class="s1">extra):</span>
            <span class="s0">return </span><span class="s1">extra</span>

    <span class="s1">art = TestKlass()</span>
    <span class="s1">renderer = mbackend_bases.RendererBase()</span>

    <span class="s0">assert </span><span class="s4">'aardvark' </span><span class="s1">== art.draw(renderer</span><span class="s0">, </span><span class="s4">'aardvark'</span><span class="s1">)</span>
    <span class="s0">assert </span><span class="s4">'aardvark' </span><span class="s1">== art.draw(renderer</span><span class="s0">, </span><span class="s1">extra=</span><span class="s4">'aardvark'</span><span class="s1">)</span>
</pre>
</body>
</html>